<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 15 The InnoDB Storage Engine</title>
<link rel="stylesheet" href="mvl.css" type="text/css" />
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2" />
<link rel="start" href="index.html" title="{book-title}" />
<link rel="up" href="" title="" />
<link rel="prev" href="data-dictionary.html" title="Chapter 14 MySQL Data Dictionary" />
<link rel="next" href="storage-engines.html" title="Chapter 16 Alternative Storage Engines" />
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">Chapter 15 The InnoDB Storage Engine</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="data-dictionary.html">Prev</a> </td>
<th width="60%" align="center"></th>
<td width="20%" align="right"> <a accesskey="n" href="storage-engines.html">Next</a></td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="innodb-storage-engine"></a>Chapter 15 The InnoDB Storage Engine</h1>

</div>

</div>

</div>
<div class="toc">
<p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-introduction">15.1 Introduction to InnoDB</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-benefits">15.1.1 Benefits of Using InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-best-practices">15.1.2 Best Practices for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-check-availability">15.1.3 Verifying that InnoDB is the Default Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-benchmarking">15.1.4 Testing and Benchmarking with InnoDB</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#mysql-acid">15.2 InnoDB and the ACID Model</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multi-versioning">15.3 InnoDB Multi-Versioning</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-architecture">15.4 InnoDB Architecture</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-in-memory-structures">15.5 InnoDB In-Memory Structures</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-buffer-pool">15.5.1 Buffer Pool</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-change-buffer">15.5.2 Change Buffer</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-adaptive-hash">15.5.3 Adaptive Hash Index</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-redo-log-buffer">15.5.4 Log Buffer</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-on-disk-structures">15.6 InnoDB On-Disk Structures</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tables">15.6.1 Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-indexes">15.6.2 Indexes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tablespace">15.6.3 Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-doublewrite-buffer">15.6.4 Doublewrite Buffer</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-redo-log">15.6.5 Redo Log</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-undo-logs">15.6.6 Undo Logs</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locking-transaction-model">15.7 InnoDB Locking and Transaction Model</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locking">15.7.1 InnoDB Locking</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transaction-model">15.7.2 InnoDB Transaction Model</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locks-set">15.7.3 Locks Set by Different SQL Statements in InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-next-key-locking">15.7.4 Phantom Rows</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-deadlocks">15.7.5 Deadlocks in InnoDB</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-configuration">15.8 InnoDB Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-init-startup-configuration">15.8.1 InnoDB Startup Configuration</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-read-only-instance">15.8.2 Configuring InnoDB for Read-Only Operation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-buffer-pool">15.8.3 InnoDB Buffer Pool Configuration</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_concurrency">15.8.4 Configuring Thread Concurrency for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-multiple_io_threads">15.8.5 Configuring the Number of Background InnoDB I/O Threads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-linux-native-aio">15.8.6 Using Asynchronous I/O on Linux</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_io_rate">15.8.7 Configuring the InnoDB Master Thread I/O Rate</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-spin_lock_polling">15.8.8 Configuring Spin Lock Polling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-improved-purge-scheduling">15.8.9 Configuring InnoDB Purge Scheduling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-optimizer-statistics">15.8.10 Configuring Optimizer Statistics for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#index-page-merge-threshold">15.8.11 Configuring the Merge Threshold for Index Pages</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-dedicated-server">15.8.12 Enabling Automatic Configuration for a Dedicated MySQL Server</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression">15.9 InnoDB Table and Page Compression</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-compression">15.9.1 InnoDB Table Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-page-compression">15.9.2 InnoDB Page Compression</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format">15.10 InnoDB Row Formats</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-disk-management">15.11 InnoDB Disk I/O and File Space Management</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-disk-io">15.11.1 InnoDB Disk I/O</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-space">15.11.2 File Space Management</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-checkpoints">15.11.3 InnoDB Checkpoints</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-defragmenting">15.11.4 Defragmenting a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-truncate-table-reclaim-space">15.11.5 Reclaiming Disk Space with TRUNCATE TABLE</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl">15.12 InnoDB and Online DDL</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-operations">15.12.1 Online DDL Operations</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-performance">15.12.2 Online DDL Performance and Concurrency</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-space-requirements">15.12.3 Online DDL Space Requirements</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-single-multi">15.12.4 Simplifying DDL Statements with Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-failure-conditions">15.12.5 Online DDL Failure Conditions</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-limitations">15.12.6 Online DDL Limitations</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-parameters">15.13 InnoDB Startup Options and System Variables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema">15.14 InnoDB INFORMATION_SCHEMA Tables</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-compression-tables">15.14.1 InnoDB INFORMATION_SCHEMA Tables about Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-transactions">15.14.2 InnoDB INFORMATION_SCHEMA Transaction and Locking Information</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-system-tables">15.14.3 InnoDB INFORMATION_SCHEMA Schema Object Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-fulltext_index-tables">15.14.4 InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-buffer-pool-tables">15.14.5 InnoDB INFORMATION_SCHEMA Buffer Pool Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-metrics-table">15.14.6 InnoDB INFORMATION_SCHEMA Metrics Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-temp-table-info">15.14.7 InnoDB INFORMATION_SCHEMA Temporary Table Info Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-files-table">15.14.8 Retrieving InnoDB Tablespace Metadata from INFORMATION_SCHEMA.FILES</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-schema">15.15 InnoDB Integration with MySQL Performance Schema</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#monitor-alter-table-performance-schema">15.15.1 Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance
Schema</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#monitor-innodb-mutex-waits-performance-schema">15.15.2 Monitoring InnoDB Mutex Waits Using Performance Schema</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-monitors">15.16 InnoDB Monitors</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-monitor-types">15.16.1 InnoDB Monitor Types</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-enabling-monitors">15.16.2 Enabling InnoDB Monitors</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-standard-monitor">15.16.3 InnoDB Standard Monitor and Lock Monitor Output</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-backup-recovery">15.17 InnoDB Backup and Recovery</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-backup">15.17.1 InnoDB Backup</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-recovery">15.17.2 InnoDB Recovery</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-and-mysql-replication">15.18 InnoDB and MySQL Replication</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached">15.19 InnoDB memcached Plugin</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-benefits">15.19.1 Benefits of the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-intro">15.19.2 InnoDB memcached Architecture</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-setup">15.19.3 Setting Up the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-multiple-get-range-query">15.19.4 InnoDB memcached Multiple get and Range Query Support</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-security">15.19.5 Security Considerations for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-developing">15.19.6 Writing Applications for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-replication">15.19.7 The InnoDB memcached Plugin and Replication</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-internals">15.19.8 InnoDB memcached Plugin Internals</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-troubleshoot">15.19.9 Troubleshooting the InnoDB memcached Plugin</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-troubleshooting">15.20 InnoDB Troubleshooting</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#error-creating-innodb">15.20.1 Troubleshooting InnoDB I/O Problems</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#forcing-innodb-recovery">15.20.2 Forcing InnoDB Recovery</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-troubleshooting-datadict">15.20.3 Troubleshooting InnoDB Data Dictionary Operations</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-error-handling">15.20.4 InnoDB Error Handling</a></span></dt></dl></dd></dl>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-introduction"></a>15.1 Introduction to InnoDB</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-benefits">15.1.1 Benefits of Using InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-best-practices">15.1.2 Best Practices for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-check-availability">15.1.3 Verifying that InnoDB is the Default Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-benchmarking">15.1.4 Testing and Benchmarking with InnoDB</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091653252592"></a><a class="indexterm" name="idm140091653251104"></a><a class="indexterm" name="idm140091653250032"></a><a class="indexterm" name="idm140091653248544"></a><a class="indexterm" name="idm140091653247472"></a><a class="indexterm" name="idm140091653245984"></a><a class="indexterm" name="idm140091653244912"></a><a class="indexterm" name="idm140091653243840"></a><a class="indexterm" name="idm140091653242768"></a><p>
    <code class="literal">InnoDB</code> is a general-purpose storage engine that
    balances high reliability and high performance. In MySQL
    8.0, <code class="literal">InnoDB</code> is the default MySQL
    storage engine. Unless you have configured a different default
    storage engine, issuing a <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE
    TABLE</code></a> statement without an <code class="literal">ENGINE=</code>
    clause creates an <code class="literal">InnoDB</code> table.
</p>
<h3><a name="innodb-key-advantages"></a>Key Advantages of InnoDB</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Its <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations follow the
        <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> model, with
        <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> featuring
        <a class="link" href="glossary.html#glos_commit" title="commit">commit</a>,
        <a class="link" href="glossary.html#glos_rollback" title="rollback">rollback</a>, and
        <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash-recovery</a>
        capabilities to protect user data. See
        <a class="xref" href="innodb-storage-engine.html#mysql-acid" title="15.2 InnoDB and the ACID Model">Section 15.2, “InnoDB and the ACID Model”</a> for more information.
      </p></li><li class="listitem"><p>
        Row-level <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> and
        Oracle-style <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent
        reads</a> increase multi-user concurrency and performance.
        See <a class="xref" href="innodb-storage-engine.html#innodb-locking-transaction-model" title="15.7 InnoDB Locking and Transaction Model">Section 15.7, “InnoDB Locking and Transaction Model”</a> for more
        information.
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code> tables arrange your data on disk to
        optimize queries based on
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary keys</a>. Each
        <code class="literal">InnoDB</code> table has a primary key index called
        the <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
        that organizes the data to minimize I/O for primary key lookups.
        See <a class="xref" href="innodb-storage-engine.html#innodb-index-types" title="15.6.2.1 Clustered and Secondary Indexes">Section 15.6.2.1, “Clustered and Secondary Indexes”</a> for more information.
      </p></li><li class="listitem"><p>
        To maintain data
        <a class="link" href="glossary.html#glos_referential_integrity" title="referential integrity">integrity</a>,
        <code class="literal">InnoDB</code> supports
        <a class="link" href="glossary.html#glos_foreign_key" title="foreign key"><code class="literal">FOREIGN
        KEY</code></a> constraints. With foreign keys, inserts,
        updates, and deletes are checked to ensure they do not result in
        inconsistencies across different tables. See
        <a class="xref" href="innodb-storage-engine.html#innodb-foreign-key-constraints" title="15.6.1.5 InnoDB and FOREIGN KEY Constraints">Section 15.6.1.5, “InnoDB and FOREIGN KEY Constraints”</a> for more
        information.
</p></li></ul>
</div>

<div class="table">
<a name="idm140091653215648"></a><p class="title"><b>Table 15.1 InnoDB Storage Engine Features</b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Features supported by the InnoDB storage engine."><col width="60%"><col width="40%"><thead><tr><th scope="col">Feature</th>
<th scope="col">Support</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>B-tree indexes</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Backup/point-in-time recovery</strong></span> (Implemented in the server, rather than in the storage engine.)</td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Cluster database support</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Clustered indexes</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Compressed data</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Data caches</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Encrypted data</strong></span></td>
<td>Yes (Implemented in the server via encryption functions; In MySQL 5.7 and later, data-at-rest tablespace encryption is supported.)</td>
</tr><tr><td scope="row"><span class="bold"><strong>Foreign key support</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Full-text search indexes</strong></span></td>
<td>Yes (InnoDB support for FULLTEXT indexes is available in MySQL 5.6 and later.)</td>
</tr><tr><td scope="row"><span class="bold"><strong>Geospatial data type support</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Geospatial indexing support</strong></span></td>
<td>Yes (InnoDB support for geospatial indexing is available in MySQL 5.7 and later.)</td>
</tr><tr><td scope="row"><span class="bold"><strong>Hash indexes</strong></span></td>
<td>No (InnoDB utilizes hash indexes internally for its Adaptive Hash Index feature.)</td>
</tr><tr><td scope="row"><span class="bold"><strong>Index caches</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Locking granularity</strong></span></td>
<td>Row</td>
</tr><tr><td scope="row"><span class="bold"><strong>MVCC</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Replication support</strong></span> (Implemented in the server, rather than in the storage engine.)</td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Storage limits</strong></span></td>
<td>64TB</td>
</tr><tr><td scope="row"><span class="bold"><strong>T-tree indexes</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Transactions</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Update statistics for data dictionary</strong></span></td>
<td>Yes</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
    To compare the features of <code class="literal">InnoDB</code> with other
    storage engines provided with MySQL, see the <span class="emphasis"><em>Storage
    Engine Features</em></span> table in
    <a class="xref" href="storage-engines.html" title="Chapter 16 Alternative Storage Engines">Chapter 16, <i>Alternative Storage Engines</i></a>.
</p>
<h3><a name="innodb-enhancements"></a>InnoDB Enhancements and New Features</h3>
<p>
    For information about <code class="literal">InnoDB</code> enhancements and new
    features, refer to:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The <code class="literal">InnoDB</code> enhancements list in
        <a class="xref" href="introduction.html#mysql-nutshell" title="1.4 What Is New in MySQL 8.0">Section 1.4, “What Is New in MySQL 8.0”</a>.
      </p></li><li class="listitem"><p>
        The
        <a class="ulink" href="https://dev.mysql.com/doc/relnotes/mysql/8.0/en/" target="_top">Release
        Notes</a>.
</p></li></ul>
</div>
<h3><a name="innodb-additional-resources"></a>Additional InnoDB Information and Resources</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        For <code class="literal">InnoDB</code>-related terms and definitions, see
        the <a class="xref" href="glossary.html" title="MySQL Glossary">MySQL Glossary</a>.
      </p></li><li class="listitem"><p>
        For a forum dedicated to the <code class="literal">InnoDB</code> storage
        engine, see
        <a class="ulink" href="http://forums.mysql.com/list.php?22" target="_top">MySQL
        Forums::InnoDB</a>.
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code> is published under the same GNU GPL
        License Version 2 (of June 1991) as MySQL. For more information
        on MySQL licensing, see
        <a class="ulink" href="http://www.mysql.com/company/legal/licensing/" target="_top">http://www.mysql.com/company/legal/licensing/</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-benefits"></a>15.1.1 Benefits of Using InnoDB Tables</h3>

</div>

</div>

</div>
<p>
      You may find <code class="literal">InnoDB</code> tables beneficial for the
      following reasons:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If your server crashes because of a hardware or software
          issue, regardless of what was happening in the database at the
          time, you don't need to do anything special after restarting
          the database. <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
          automatically finalizes any changes that were committed before
          the time of the crash, and undoes any changes that were in
          process but not committed. Just restart and continue where you
          left off.
        </p></li><li class="listitem"><p>
          The <code class="literal">InnoDB</code> storage engine maintains its own
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> that
          caches table and index data in main memory as data is
          accessed. Frequently used data is processed directly from
          memory. This cache applies to many types of information and
          speeds up processing. On dedicated database servers, up to 80%
          of physical memory is often assigned to the buffer pool.
        </p></li><li class="listitem"><p>
          If you split up related data into different tables, you can
          set up <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a>
          that enforce
          <a class="link" href="glossary.html#glos_referential_integrity" title="referential integrity">referential
          integrity</a>. Update or delete data, and the related data
          in other tables is updated or deleted automatically. Try to
          insert data into a secondary table without corresponding data
          in the primary table, and the bad data gets kicked out
          automatically.
        </p></li><li class="listitem"><p>
          If data becomes corrupted on disk or in memory, a
          <a class="link" href="glossary.html#glos_checksum" title="checksum">checksum</a> mechanism alerts
          you to the bogus data before you use it.
        </p></li><li class="listitem"><p>
          When you design your database with appropriate
          <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> columns
          for each table, operations involving those columns are
          automatically optimized. It is very fast to reference the
          primary key columns in
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">WHERE</code></a>
          clauses, <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">ORDER
          BY</code></a> clauses,
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">GROUP BY</code></a>
          clauses, and <a class="link" href="glossary.html#glos_join" title="join">join</a> operations.
        </p></li><li class="listitem"><p>
          Inserts, updates, and deletes are optimized by an automatic
          mechanism called <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change
          buffering</a>. <code class="literal">InnoDB</code> not only allows
          concurrent read and write access to the same table, it caches
          changed data to streamline disk I/O.
        </p></li><li class="listitem"><p>
          Performance benefits are not limited to giant tables with
          long-running queries. When the same rows are accessed over and
          over from a table, a feature called the
          <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">Adaptive Hash
          Index</a> takes over to make these lookups even faster, as
          if they came out of a hash table.
        </p></li><li class="listitem"><p>
          You can compress tables and associated indexes.
        </p></li><li class="listitem"><p>
          You can create and drop indexes with much less impact on
          performance and availability.
        </p></li><li class="listitem"><p>
          Truncating a
          <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
          tablespace is very fast, and can free up disk space for the
          operating system to reuse, rather than freeing up space within
          the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> that only <code class="literal">InnoDB</code> can
          reuse.
        </p></li><li class="listitem"><p>
          The storage layout for table data is more efficient for
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and long text fields, with
          the <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a> row
          format.
        </p></li><li class="listitem"><p>
          You can monitor the internal workings of the storage engine by
          querying
          <a class="link" href="glossary.html#glos_information_schema" title="INFORMATION_SCHEMA">INFORMATION_SCHEMA</a>
          tables.
        </p></li><li class="listitem"><p>
          You can monitor the performance details of the storage engine
          by querying
          <a class="link" href="glossary.html#glos_performance_schema" title="Performance Schema">Performance
          Schema</a> tables.
        </p></li><li class="listitem"><p>
          You can freely mix <code class="literal">InnoDB</code> tables with
          tables from other MySQL storage engines, even within the same
          statement. For example, you can use a
          <a class="link" href="glossary.html#glos_join" title="join">join</a> operation to combine
          data from <code class="literal">InnoDB</code> and
          <a class="link" href="storage-engines.html#memory-storage-engine" title="16.3 The MEMORY Storage Engine"><code class="literal">MEMORY</code></a> tables in a single query.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> has been designed for CPU efficiency
          and maximum performance when processing large data volumes.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> tables can handle large quantities
          of data, even on operating systems where file size is limited
          to 2GB.
</p></li></ul>
</div>
<p>
      For <code class="literal">InnoDB</code>-specific tuning techniques you can
      apply in your application code, see
      <a class="xref" href="optimization.html#optimizing-innodb" title="8.5 Optimizing for InnoDB Tables">Section 8.5, “Optimizing for InnoDB Tables”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-best-practices"></a>15.1.2 Best Practices for InnoDB Tables</h3>

</div>

</div>

</div>
<p>
      This section describes best practices when using
      <code class="literal">InnoDB</code> tables.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Specifying a <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
          key</a> for every table using the most frequently queried
          column or columns, or an
          <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
          value if there is no obvious primary key.
        </p></li><li class="listitem"><p>
          Using <a class="link" href="glossary.html#glos_join" title="join">joins</a> wherever data is
          pulled from multiple tables based on identical ID values from
          those tables. For fast join performance, define
          <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a> on the
          join columns, and declare those columns with the same data
          type in each table. Adding foreign keys ensures that
          referenced columns are indexed, which can improve performance.
          Foreign keys also propagate deletes or updates to all affected
          tables, and prevent insertion of data in a child table if the
          corresponding IDs are not present in the parent table.
        </p></li><li class="listitem"><p>
          Turning off <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a>.
          Committing hundreds of times a second puts a cap on
          performance (limited by the write speed of your storage
          device).
        </p></li><li class="listitem"><p>
          Grouping sets of related <a class="link" href="glossary.html#glos_dml" title="DML">DML</a>
          operations into
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, by
          bracketing them with <code class="literal">START TRANSACTION</code> and
          <code class="literal">COMMIT</code> statements. While you don't want to
          commit too often, you also don't want to issue huge batches of
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements that run for
          hours without committing.
        </p></li><li class="listitem"><p>
          Not using <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
          statements. <code class="literal">InnoDB</code> can handle multiple
          sessions all reading and writing to the same table at once,
          without sacrificing reliability or high performance. To get
          exclusive write access to a set of rows, use the
          <a class="link" href="innodb-storage-engine.html#innodb-locking-reads" title="15.7.2.4 Locking Reads"><code class="literal">SELECT
          ... FOR UPDATE</code></a> syntax to lock just the rows you
          intend to update.
        </p></li><li class="listitem"><p>
          Enabling the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option
          or using general tablespaces to put the data and indexes for
          tables into separate files, instead of the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
          option is enabled by default.
        </p></li><li class="listitem"><p>
          Evaluating whether your data and access patterns benefit from
          the <code class="literal">InnoDB</code> table or page
          <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> features.
          You can compress <code class="literal">InnoDB</code> tables without
          sacrificing read/write capability.
        </p></li><li class="listitem"><p>
          Running your server with the option
          <a class="link" href="server-administration.html#sysvar_sql_mode"><code class="literal">--sql_mode=NO_ENGINE_SUBSTITUTION</code></a>
          to prevent tables being created with a different storage
          engine if there is an issue with the engine specified in the
          <code class="literal">ENGINE=</code> clause of
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-check-availability"></a>15.1.3 Verifying that InnoDB is the Default Storage Engine</h3>

</div>

</div>

</div>
<p>
      Issue the <a class="link" href="sql-syntax.html#show-engines" title="13.7.6.16 SHOW ENGINES Syntax"><code class="literal">SHOW ENGINES</code></a> statement to
      view the available MySQL storage engines. Look for
      <code class="literal">DEFAULT</code> in the <code class="literal">InnoDB</code> line.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; SHOW ENGINES;
</pre><p>
      Alternatively, query the
      <a class="link" href="information-schema.html#engines-table" title="25.9 The INFORMATION_SCHEMA ENGINES Table"><code class="literal">INFORMATION_SCHEMA.ENGINES</code></a> table.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; SELECT * FROM INFORMATION_SCHEMA.ENGINES;
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-benchmarking"></a>15.1.4 Testing and Benchmarking with InnoDB</h3>

</div>

</div>

</div>
<p>
      If <code class="literal">InnoDB</code> is not your default storage engine,
      you can determine if your database server or applications work
      correctly with <code class="literal">InnoDB</code> by restarting the server
      with
      <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="literal">--default-storage-engine=InnoDB</code></a>
      defined on the command line or with
      <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="literal">default-storage-engine=innodb</code></a>
      defined in the <code class="literal">[mysqld]</code> section of your MySQL
      server option file.
    </p><p>
      Since changing the default storage engine only affects new tables
      as they are created, run all your application installation and
      setup steps to confirm that everything installs properly. Then
      exercise all the application features to make sure all the data
      loading, editing, and querying features work. If a table relies on
      a feature that is specific to another storage engine, you will
      receive an error; add the
      <code class="literal">ENGINE=<em class="replaceable"><code>other_engine_name</code></em></code>
      clause to the <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
      statement to avoid the error.
    </p><p>
      If you did not make a deliberate decision about the storage
      engine, and you want to preview how certain tables work when
      created using <code class="literal">InnoDB</code>, issue the command
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
      table_name ENGINE=InnoDB;</code></a> for each table. Or, to run
      test queries and other statements without disturbing the original
      table, make a copy:
    </p><pre data-lang="sql" class="programlisting">
CREATE TABLE InnoDB_Table (...) ENGINE=InnoDB AS SELECT * FROM <em class="replaceable"><code>other_engine_table</code></em>;
</pre><p>
      To assess performance with a full application under a realistic
      workload, install the latest MySQL server and run benchmarks.
    </p><p>
      Test the full application lifecycle, from installation, through
      heavy usage, and server restart. Kill the server process while the
      database is busy to simulate a power failure, and verify that the
      data is recovered successfully when you restart the server.
    </p><p>
      Test any replication configurations, especially if you use
      different MySQL versions and options on the master and slaves.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="mysql-acid"></a>15.2 InnoDB and the ACID Model</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140091653032800"></a><p>
    The <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> model is a set of database
    design principles that emphasize aspects of reliability that are
    important for business data and mission-critical applications. MySQL
    includes components such as the <code class="literal">InnoDB</code> storage
    engine that adhere closely to the ACID model, so that data is not
    corrupted and results are not distorted by exceptional conditions
    such as software crashes and hardware malfunctions. When you rely on
    ACID-compliant features, you do not need to reinvent the wheel of
    consistency checking and crash recovery mechanisms. In cases where
    you have additional software safeguards, ultra-reliable hardware, or
    an application that can tolerate a small amount of data loss or
    inconsistency, you can adjust MySQL settings to trade some of the
    ACID reliability for greater performance or throughput.
  </p><p>
    The following sections discuss how MySQL features, in particular the
    <code class="literal">InnoDB</code> storage engine, interact with the
    categories of the ACID model:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <span class="bold"><strong>A</strong></span>: atomicity.
      </p></li><li class="listitem"><p>
        <span class="bold"><strong>C</strong></span>: consistency.
      </p></li><li class="listitem"><p>
        <span class="bold"><strong>I:</strong></span>: isolation.
      </p></li><li class="listitem"><p>
        <span class="bold"><strong>D</strong></span>: durability.
</p></li></ul>
</div>
<h3><a name="idm140091653021520"></a>Atomicity</h3>
<p>
    The <span class="bold"><strong>atomicity</strong></span> aspect of the ACID
    model mainly involves <code class="literal">InnoDB</code>
    <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>. Related MySQL
    features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Autocommit setting.
      </p></li><li class="listitem"><p>
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> statement.
      </p></li><li class="listitem"><p>
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        statement.
      </p></li><li class="listitem"><p>
        Operational data from the <code class="literal">INFORMATION_SCHEMA</code>
        tables.
</p></li></ul>
</div>
<h3><a name="idm140091653011360"></a>Consistency</h3>
<p>
    The <span class="bold"><strong>consistency</strong></span> aspect of the ACID
    model mainly involves internal <code class="literal">InnoDB</code> processing
    to protect data from crashes. Related MySQL features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
        buffer</a>.
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>.
</p></li></ul>
</div>
<h3><a name="idm140091653003744"></a>Isolation</h3>
<p>
    The <span class="bold"><strong>isolation</strong></span> aspect of the ACID
    model mainly involves <code class="literal">InnoDB</code>
    <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, in particular
    the <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a> that
    applies to each transaction. Related MySQL features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="link" href="glossary.html#glos_autocommit" title="autocommit">Autocommit</a> setting.
      </p></li><li class="listitem"><p>
        <code class="literal">SET ISOLATION LEVEL</code> statement.
      </p></li><li class="listitem"><p>
        The low-level details of <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_locking" title="locking">locking</a>. During performance
        tuning, you see these details through
        <code class="literal">INFORMATION_SCHEMA</code> tables.
</p></li></ul>
</div>
<h3><a name="idm140091652992864"></a>Durability</h3>
<p>
    The <span class="bold"><strong>durability</strong></span> aspect of the ACID
    model involves MySQL software features interacting with your
    particular hardware configuration. Because of the many possibilities
    depending on the capabilities of your CPU, network, and storage
    devices, this aspect is the most complicated to provide concrete
    guidelines for. (And those guidelines might take the form of buy
    <span class="quote">“<span class="quote">new hardware</span>”</span>.) Related MySQL features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
        buffer</a>, turned on and off by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a>
        configuration option.
      </p></li><li class="listitem"><p>
        Configuration option
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a>.
      </p></li><li class="listitem"><p>
        Configuration option
        <a class="link" href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a>.
      </p></li><li class="listitem"><p>
        Configuration option
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>.
      </p></li><li class="listitem"><p>
        Write buffer in a storage device, such as a disk drive, SSD, or
        RAID array.
      </p></li><li class="listitem"><p>
        Battery-backed cache in a storage device.
      </p></li><li class="listitem"><p>
        The operating system used to run MySQL, in particular its
        support for the <code class="literal">fsync()</code> system call.
      </p></li><li class="listitem"><p>
        Uninterruptible power supply (UPS) protecting the electrical
        power to all computer servers and storage devices that run MySQL
        servers and store MySQL data.
      </p></li><li class="listitem"><p>
        Your backup strategy, such as frequency and types of backups,
        and backup retention periods.
      </p></li><li class="listitem"><p>
        For distributed or hosted data applications, the particular
        characteristics of the data centers where the hardware for the
        MySQL servers is located, and network connections between the
        data centers.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-multi-versioning"></a>15.3 InnoDB Multi-Versioning</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652972512"></a><a class="indexterm" name="idm140091652971024"></a><p>
    <code class="literal">InnoDB</code> is a
    <a class="link" href="glossary.html#glos_mvcc" title="MVCC">multi-versioned storage engine</a>: it
    keeps information about old versions of changed rows, to support
    transactional features such as concurrency and
    <a class="link" href="glossary.html#glos_rollback" title="rollback">rollback</a>. This information is
    stored in the tablespace in a data structure called a
    <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segment</a> (after
    an analogous data structure in Oracle). <code class="literal">InnoDB</code>
    uses the information in the rollback segment to perform the undo
    operations needed in a transaction rollback. It also uses the
    information to build earlier versions of a row for a
    <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent read</a>.
  </p><p>
    Internally, <code class="literal">InnoDB</code> adds three fields to each row
    stored in the database. A 6-byte <code class="literal">DB_TRX_ID</code> field
    indicates the transaction identifier for the last transaction that
    inserted or updated the row. Also, a deletion is treated internally
    as an update where a special bit in the row is set to mark it as
    deleted. Each row also contains a 7-byte
    <code class="literal">DB_ROLL_PTR</code> field called the roll pointer. The
    roll pointer points to an undo log record written to the rollback
    segment. If the row was updated, the undo log record contains the
    information necessary to rebuild the content of the row before it
    was updated. A 6-byte <code class="literal">DB_ROW_ID</code> field contains a
    row ID that increases monotonically as new rows are inserted. If
    <code class="literal">InnoDB</code> generates a clustered index automatically,
    the index contains row ID values. Otherwise, the
    <code class="literal">DB_ROW_ID</code> column does not appear in any index.
  </p><p>
    Undo logs in the rollback segment are divided into insert and update
    undo logs. Insert undo logs are needed only in transaction rollback
    and can be discarded as soon as the transaction commits. Update undo
    logs are used also in consistent reads, but they can be discarded
    only after there is no transaction present for which
    <code class="literal">InnoDB</code> has assigned a snapshot that in a
    consistent read could need the information in the update undo log to
    build an earlier version of a database row.
  </p><p>
    Commit your transactions regularly, including those transactions
    that issue only consistent reads. Otherwise,
    <code class="literal">InnoDB</code> cannot discard data from the update undo
    logs, and the rollback segment may grow too big, filling up your
    tablespace.
  </p><p>
    The physical size of an undo log record in the rollback segment is
    typically smaller than the corresponding inserted or updated row.
    You can use this information to calculate the space needed for your
    rollback segment.
  </p><p>
    In the <code class="literal">InnoDB</code> multi-versioning scheme, a row is
    not physically removed from the database immediately when you delete
    it with an SQL statement. <code class="literal">InnoDB</code> only physically
    removes the corresponding row and its index records when it discards
    the update undo log record written for the deletion. This removal
    operation is called a <a class="link" href="glossary.html#glos_purge" title="purge">purge</a>, and
    it is quite fast, usually taking the same order of time as the SQL
    statement that did the deletion.
  </p><p>
    If you insert and delete rows in smallish batches at about the same
    rate in the table, the purge thread can start to lag behind and the
    table can grow bigger and bigger because of all the
    <span class="quote">“<span class="quote">dead</span>”</span> rows, making everything disk-bound and very
    slow. In such a case, throttle new row operations, and allocate more
    resources to the purge thread by tuning the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a> system
    variable. See <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="15.13 InnoDB Startup Options and System Variables">Section 15.13, “InnoDB Startup Options and System Variables”</a> for more
    information.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h3 class="title"><a name="innodb-multi-versioning-secondary-indexes"></a>Multi-Versioning and Secondary Indexes</h3>
</div>
</div>
</div>
<p>
      <code class="literal">InnoDB</code> multiversion concurrency control (MVCC)
      treats secondary indexes differently than clustered indexes.
      Records in a clustered index are updated in-place, and their
      hidden system columns point undo log entries from which earlier
      versions of records can be reconstructed. Unlike clustered index
      records, secondary index records do not contain hidden system
      columns nor are they updated in-place.
    </p><p>
      When a secondary index column is updated, old secondary index
      records are delete-marked, new records are inserted, and
      delete-marked records are eventually purged. When a secondary
      index record is delete-marked or the secondary index page is
      updated by a newer transaction, <code class="literal">InnoDB</code> looks up
      the database record in the clustered index. In the clustered
      index, the record's <code class="literal">DB_TRX_ID</code> is checked, and
      the correct version of the record is retrieved from the undo log
      if the record was modified after the reading transaction was
      initiated.
    </p><p>
      If a secondary index record is marked for deletion or the
      secondary index page is updated by a newer transaction, the
      <a class="link" href="glossary.html#glos_covering_index" title="covering index">covering index</a>
      technique is not used. Instead of returning values from the index
      structure, <code class="literal">InnoDB</code> looks up the record in the
      clustered index.
    </p><p>
      However, if the
      <a class="link" href="optimization.html#index-condition-pushdown-optimization" title="8.2.1.5 Index Condition Pushdown Optimization">index
      condition pushdown (ICP)</a> optimization is enabled, and parts
      of the <code class="literal">WHERE</code> condition can be evaluated using
      only fields from the index, the MySQL server still pushes this
      part of the <code class="literal">WHERE</code> condition down to the storage
      engine where it is evaluated using the index. If no matching
      records are found, the clustered index lookup is avoided. If
      matching records are found, even among delete-marked records,
      <code class="literal">InnoDB</code> looks up the record in the clustered
      index.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-architecture"></a>15.4 InnoDB Architecture</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652936112"></a><p>
      The following diagram shows in-memory and on-disk structures that
      comprise the <code class="literal">InnoDB</code> storage engine
      architecture. For information about each structure, see
      <a class="xref" href="innodb-storage-engine.html#innodb-in-memory-structures" title="15.5 InnoDB In-Memory Structures">Section 15.5, “InnoDB In-Memory Structures”</a>, and
      <a class="xref" href="innodb-storage-engine.html#innodb-on-disk-structures" title="15.6 InnoDB On-Disk Structures">Section 15.6, “InnoDB On-Disk Structures”</a>.
</p>
<div class="figure">
<a name="innodb-architecture-diagram"></a><p class="title"><b>Figure 15.1 InnoDB Architecture</b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="images/innodb-architecture.png" width="700" height="538" alt="InnoDB architecture diagram showing in-memory and on-disk structures.">
</div>

</div>

</div>
<br class="figure-break">
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-in-memory-structures"></a>15.5 InnoDB In-Memory Structures</h2>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-buffer-pool">15.5.1 Buffer Pool</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-change-buffer">15.5.2 Change Buffer</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-adaptive-hash">15.5.3 Adaptive Hash Index</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-redo-log-buffer">15.5.4 Log Buffer</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091652923280"></a><p>
    This section describes <code class="literal">InnoDB</code> in-memory
    structures and related topics.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-buffer-pool"></a>15.5.1 Buffer Pool</h3>
</div>
</div>
</div>
<p>
    The buffer pool is an area in main memory where caches table and
    index data as it is accessed. The buffer pool permits frequently
    used data to be processed directly from memory, which speeds up
    processing. On dedicated servers, up to 80% of physical memory is
    often assigned to the buffer pool.
  </p><p>
    For efficiency of high-volume read operations, the buffer pool is
    divided into <a class="link" href="glossary.html#glos_page" title="page">pages</a> that can
    potentially hold multiple rows. For efficiency of cache management,
    the buffer pool is implemented as a linked list of pages; data that
    is rarely used is aged out of the cache using a variation of the
    <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a> algorithm.
  </p><p>
    Knowing how to take advantage of the buffer pool to keep frequently
    accessed data in memory is an important aspect of MySQL tuning.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-buffer-pool-lru"></a>Buffer Pool LRU Algorithm</h4>
</div>
</div>
</div>
<p>
      The buffer pool is managed as a list using a variation of the
      least recently used (LRU) algorithm. When room is needed to add a
      new page to the buffer pool, the least recently used page is
      evicted and a new page is added to the middle of the list. This
      midpoint insertion strategy treats the list as two sublists:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          At the head, a sublist of new (<span class="quote">“<span class="quote">young</span>”</span>) pages
          that were accessed recently
        </p></li><li class="listitem"><p>
          At the tail, a sublist of old pages that were accessed less
          recently
</p></li></ul>
</div>

<div class="figure">
<a name="innodb-buffer-pool-list"></a><p class="title"><b>Figure 15.2 Buffer Pool List</b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="images/innodb-buffer-pool-list.png" width="600" height="616" alt="Content is described in the surrounding text.">
</div>

</div>

</div>
<br class="figure-break"><p>
      The algorithm keeps pages that are heavily used by queries in the
      new sublist. The old sublist contains less-used pages; these pages
      are candidates for <a class="link" href="glossary.html#glos_eviction" title="eviction">eviction</a>.
    </p><p>
      By default, the algorithm operates as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          3/8 of the buffer pool is devoted to the old sublist.
        </p></li><li class="listitem"><p>
          The midpoint of the list is the boundary where the tail of the
          new sublist meets the head of the old sublist.
        </p></li><li class="listitem"><p>
          When <code class="literal">InnoDB</code> reads a page into the buffer
          pool, it initially inserts it at the midpoint (the head of the
          old sublist). A page can be read because it is required for a
          user-specified operation such as an SQL query, or as part of a
          <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> operation
          performed automatically by <code class="literal">InnoDB</code>.
        </p></li><li class="listitem"><p>
          Accessing a page in the old sublist makes it
          <span class="quote">“<span class="quote">young</span>”</span>, moving it to the head of the buffer pool
          (the head of the new sublist). If the page was read because it
          was required, the first access occurs immediately and the page
          is made young. If the page was read due to read-ahead, the
          first access does not occur immediately (and might not occur
          at all before the page is evicted).
        </p></li><li class="listitem"><p>
          As the database operates, pages in the buffer pool that are
          not accessed <span class="quote">“<span class="quote">age</span>”</span> by moving toward the tail of
          the list. Pages in both the new and old sublists age as other
          pages are made new. Pages in the old sublist also age as pages
          are inserted at the midpoint. Eventually, a page that remains
          unused reaches the tail of the old sublist and is evicted.
</p></li></ul>
</div>
<p>
      By default, pages read by queries immediately move into the new
      sublist, meaning they stay in the buffer pool longer. A table scan
      (such as performed for a <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> operation,
      or a <code class="literal">SELECT</code> statement with no
      <code class="literal">WHERE</code> clause) can bring a large amount of data
      into the buffer pool and evict an equivalent amount of older data,
      even if the new data is never used again. Similarly, pages that
      are loaded by the read-ahead background thread and then accessed
      only once move to the head of the new list. These situations can
      push frequently used pages to the old sublist where they become
      subject to eviction. For information about optimizing this
      behavior, see
      <a class="xref" href="innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="15.8.3.3 Making the Buffer Pool Scan Resistant">Section 15.8.3.3, “Making the Buffer Pool Scan Resistant”</a>, and
      <a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="15.8.3.4 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)">Section 15.8.3.4, “Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)”</a>.
    </p><p>
      <code class="literal">InnoDB</code> Standard Monitor output contains several
      fields in the <code class="literal">BUFFER POOL AND MEMORY</code> section
      regarding operation of the buffer pool LRU algorithm. For details,
      see <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-monitoring" title="Monitoring the Buffer Pool Using the InnoDB Standard Monitor">Monitoring the Buffer Pool Using the InnoDB Standard Monitor</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-buffer-pool-configuration"></a>Buffer Pool Configuration</h4>

</div>

</div>

</div>
<p>
      You can configure the various aspects of the buffer pool to
      improve performance.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Ideally, you set the size of the buffer pool to as large a
          value as practical, leaving enough memory for other processes
          on the server to run without excessive paging. The larger the
          buffer pool, the more <code class="literal">InnoDB</code> acts like an
          in-memory database, reading data from disk once and then
          accessing the data from memory during subsequent reads. See
          <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-resize" title="15.8.3.1 Configuring InnoDB Buffer Pool Size">Section 15.8.3.1, “Configuring InnoDB Buffer Pool Size”</a>.
        </p></li><li class="listitem"><p>
          On 64-bit systems with sufficient memory, you can split the
          buffer pool into multiple parts to minimize contention for
          memory structures among concurrent operations. For details,
          see <a class="xref" href="innodb-storage-engine.html#innodb-multiple-buffer-pools" title="15.8.3.2 Configuring Multiple Buffer Pool Instances">Section 15.8.3.2, “Configuring Multiple Buffer Pool Instances”</a>.
        </p></li><li class="listitem"><p>
          You can keep frequently accessed data in memory regardless of
          sudden spikes of activity from operations that would bring
          large amounts of infrequently accessed data into the buffer
          pool. For details, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="15.8.3.3 Making the Buffer Pool Scan Resistant">Section 15.8.3.3, “Making the Buffer Pool Scan Resistant”</a>.
        </p></li><li class="listitem"><p>
          You can control when and how to perform read-ahead requests to
          prefetch pages into the buffer pool asynchronously in
          anticipation that the pages will be needed soon. For details,
          see <a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="15.8.3.4 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)">Section 15.8.3.4, “Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)”</a>.
        </p></li><li class="listitem"><p>
          You can control when background flushing occurs and whether or
          not the rate of flushing is dynamically adjusted based on
          workload. For details, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="15.8.3.5 Configuring InnoDB Buffer Pool Flushing">Section 15.8.3.5, “Configuring InnoDB Buffer Pool Flushing”</a>.
        </p></li><li class="listitem"><p>
          You can fine-tune aspects of buffer pool flushing behavior to
          improve performance. For details, see
          <a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="15.8.3.6 Fine-tuning InnoDB Buffer Pool Flushing">Section 15.8.3.6, “Fine-tuning InnoDB Buffer Pool Flushing”</a>.
        </p></li><li class="listitem"><p>
          You can configure how <code class="literal">InnoDB</code> preserves the
          current buffer pool state to avoid a lengthy warmup period
          after a server restart. For details, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="15.8.3.7 Saving and Restoring the Buffer Pool State">Section 15.8.3.7, “Saving and Restoring the Buffer Pool State”</a>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-buffer-pool-monitoring"></a>Monitoring the Buffer Pool Using the InnoDB Standard Monitor</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652869008"></a><a class="indexterm" name="idm140091652867936"></a><a class="indexterm" name="idm140091652866448"></a><p>
      <code class="literal">InnoDB</code> Standard Monitor output, which can be
      accessed using
      <a class="link" href="innodb-storage-engine.html#innodb-standard-monitor" title="15.16.3 InnoDB Standard Monitor and Lock Monitor Output"><code class="literal">SHOW
      ENGINE INNODB STATUS</code></a>, provides metrics regarding
      operation of the buffer pool. Buffer pool metrics are located in
      the <code class="literal">BUFFER POOL AND MEMORY</code> section of
      <code class="literal">InnoDB</code> Standard Monitor output and appear
      similar to the following:
    </p><pre data-lang="sql" class="programlisting">
----------------------
BUFFER POOL AND MEMORY
----------------------
Total large memory allocated 2198863872
Dictionary memory allocated 776332
Buffer pool size   131072
Free buffers       124908
Database pages     5720
Old database pages 2071
Modified db pages  910
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 4, not young 0
0.10 youngs/s, 0.00 non-youngs/s
Pages read 197, created 5523, written 5060
0.00 reads/s, 190.89 creates/s, 244.94 writes/s
Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not
0 / 1000
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read
ahead 0.00/s
LRU len: 5720, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
</pre><p>
      The following table describes buffer pool metrics reported by the
      <code class="literal">InnoDB</code> Standard Monitor.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        Per second averages provided in <code class="literal">InnoDB</code>
        Standard Monitor output are based on the elapsed time since
        <code class="literal">InnoDB</code> Standard Monitor output was last
        printed.
</p>
</div>

<div class="table">
<a name="innodb-buffer-pool-metrics"></a><p class="title"><b>Table 15.2 InnoDB Buffer Pool Metrics</b></p>
<div class="table-contents">
<table summary="InnoDB buffer pool metrics reported by the InnoDB Standard Monitor."><col width="35%"><col width="65%"><thead><tr>
          <th scope="col">Name</th>
          <th scope="col">Description</th>
        </tr></thead><tbody><tr>
          <td scope="row">Total memory allocated</td>
          <td>The total memory allocated for the buffer pool in bytes.</td>
        </tr><tr>
          <td scope="row">Dictionary memory allocated</td>
          <td>The total memory allocated for the <code class="literal">InnoDB</code> data
            dictionary in bytes.</td>
        </tr><tr>
          <td scope="row">Buffer pool size</td>
          <td>The total size in pages allocated to the buffer pool.</td>
        </tr><tr>
          <td scope="row">Free buffers</td>
          <td>The total size in pages of the buffer pool free list.</td>
        </tr><tr>
          <td scope="row">Database pages</td>
          <td>The total size in pages of the buffer pool LRU list.</td>
        </tr><tr>
          <td scope="row">Old database pages</td>
          <td>The total size in pages of the buffer pool old LRU sublist.</td>
        </tr><tr>
          <td scope="row">Modified db pages</td>
          <td>The current number of pages modified in the buffer pool.</td>
        </tr><tr>
          <td scope="row">Pending reads</td>
          <td>The number of buffer pool pages waiting to be read into the buffer pool.</td>
        </tr><tr>
          <td scope="row">Pending writes LRU</td>
          <td>The number of old dirty pages within the buffer pool to be written from
            the bottom of the LRU list.</td>
        </tr><tr>
          <td scope="row">Pending writes flush list</td>
          <td>The number of buffer pool pages to be flushed during checkpointing.</td>
        </tr><tr>
          <td scope="row">Pending writes single page</td>
          <td>The number of pending independent page writes within the buffer pool.</td>
        </tr><tr>
          <td scope="row">Pages made young</td>
          <td>The total number of pages made young in the buffer pool LRU list (moved
            to the head of sublist of <span class="quote">“<span class="quote">new</span>”</span> pages).</td>
        </tr><tr>
          <td scope="row">Pages made not young</td>
          <td>The total number of pages not made young in the buffer pool LRU list
            (pages that have remained in the <span class="quote">“<span class="quote">old</span>”</span> sublist
            without being made young).</td>
        </tr><tr>
          <td scope="row">youngs/s</td>
          <td>The per second average of accesses to old pages in the buffer pool LRU
            list that have resulted in making pages young. See the notes
            that follow this table for more information.</td>
        </tr><tr>
          <td scope="row">non-youngs/s</td>
          <td>The per second average of accesses to old pages in the buffer pool LRU
            list that have resulted in not making pages young. See the
            notes that follow this table for more information.</td>
        </tr><tr>
          <td scope="row">Pages read</td>
          <td>The total number of pages read from the buffer pool.</td>
        </tr><tr>
          <td scope="row">Pages created</td>
          <td>The total number of pages created within the buffer pool.</td>
        </tr><tr>
          <td scope="row">Pages written</td>
          <td>The total number of pages written from the buffer pool.</td>
        </tr><tr>
          <td scope="row">reads/s</td>
          <td>The per second average number of buffer pool page reads per second.</td>
        </tr><tr>
          <td scope="row">creates/s</td>
          <td>The per second average number of buffer pool pages created per second.</td>
        </tr><tr>
          <td scope="row">writes/s</td>
          <td>The per second average number of buffer pool page writes per second.</td>
        </tr><tr>
          <td scope="row">Buffer pool hit rate</td>
          <td>The buffer pool page hit rate for pages read from the buffer pool memory
            vs from disk storage.</td>
        </tr><tr>
          <td scope="row">young-making rate</td>
          <td>The average hit rate at which page accesses have resulted in making
            pages young. See the notes that follow this table for more
            information.</td>
        </tr><tr>
          <td scope="row">not (young-making rate)</td>
          <td>The average hit rate at which page accesses have not resulted in making
            pages young. See the notes that follow this table for more
            information.</td>
        </tr><tr>
          <td scope="row">Pages read ahead</td>
          <td>The per second average of read ahead operations.</td>
        </tr><tr>
          <td scope="row">Pages evicted without access</td>
          <td>The per second average of the pages evicted without being accessed from
            the buffer pool.</td>
        </tr><tr>
          <td scope="row">Random read ahead</td>
          <td>The per second average of random read ahead operations.</td>
        </tr><tr>
          <td scope="row">LRU len</td>
          <td>The total size in pages of the buffer pool LRU list.</td>
        </tr><tr>
          <td scope="row">unzip_LRU len</td>
          <td>The total size in pages of the buffer pool unzip_LRU list.</td>
        </tr><tr>
          <td scope="row">I/O sum</td>
          <td>The total number of buffer pool LRU list pages accessed, for the last 50
            seconds.</td>
        </tr><tr>
          <td scope="row">I/O cur</td>
          <td>The total number of buffer pool LRU list pages accessed.</td>
        </tr><tr>
          <td scope="row">I/O unzip sum</td>
          <td>The total number of buffer pool unzip_LRU list pages accessed.</td>
        </tr><tr>
          <td scope="row">I/O unzip cur</td>
          <td>The total number of buffer pool unzip_LRU list pages accessed.</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      <span class="bold"><strong>Notes</strong></span>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">youngs/s</code> metric is applicable only to
          old pages. It is based on the number of accesses to pages and
          not the number of pages. There can be multiple accesses to a
          given page, all of which are counted. If you see very low
          <code class="literal">youngs/s</code> values when there are no large
          scans occurring, you might need to reduce the delay time or
          increase the percentage of the buffer pool used for the old
          sublist. Increasing the percentage makes the old sublist
          larger, so pages in that sublist take longer to move to the
          tail, which increases the likelihood that those pages will be
          accessed again and made young.
        </p></li><li class="listitem"><p>
          The <code class="literal">non-youngs/s</code> metric is applicable only
          to old pages. It is based on the number of accesses to pages
          and not the number of pages. There can be multiple accesses to
          a given page, all of which are counted. If you do not see a
          higher <code class="literal">non-youngs/s</code> value when performing
          large table scans (and a higher <code class="literal">youngs/s</code>
          value), increase the delay value.
        </p></li><li class="listitem"><p>
          The <code class="literal">young-making</code> rate accounts for accesses
          to all buffer pool pages, not just accesses to pages in the
          old sublist. The <code class="literal">young-making</code> rate and
          <code class="literal">not</code> rate do not normally add up to the
          overall buffer pool hit rate. Page hits in the old sublist
          cause pages to move to the new sublist, but page hits in the
          new sublist cause pages to move to the head of the list only
          if they are a certain distance from the head.
        </p></li><li class="listitem"><p>
          <code class="literal">not (young-making rate)</code> is the average hit
          rate at which page accesses have not resulted in making pages
          young due to the delay defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> not
          being met, or due to page hits in the new sublist that did not
          result in pages being moved to the head. This rate accounts
          for accesses to all buffer pool pages, not just accesses to
          pages in the old sublist.
</p></li></ul>
</div>
<p>
      Buffer pool <a class="link" href="server-administration.html#server-status-variables" title="5.1.10 Server Status Variables">server status
      variables</a> and the
      <a class="link" href="information-schema.html#innodb-buffer-pool-stats-table" title="25.39.3 The INFORMATION_SCHEMA INNODB_BUFFER_POOL_STATS Table"><code class="literal">INNODB_BUFFER_POOL_STATS</code></a> table
      provide many of the same buffer pool metrics found in
      <code class="literal">InnoDB</code> Standard Monitor output. For more
      information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-buffer-pool-stats-example" title="Example 15.10 Querying the INNODB_BUFFER_POOL_STATS Table">Example 15.10, “Querying the INNODB_BUFFER_POOL_STATS Table”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-change-buffer"></a>15.5.2 Change Buffer</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652746064"></a><a class="indexterm" name="idm140091652744576"></a><p>
    The change buffer is a special data structure that caches changes to
    <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary index</a> pages
    when those pages are not in the
    <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. The buffered
    changes, which may result from
    <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
    <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
    <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations (DML), are merged
    later when the pages are loaded into the buffer pool by other read
    operations.
</p>
<div class="figure">
<a name="innodb-change-buffer-diagram"></a><p class="title"><b>Figure 15.3 Change Buffer</b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="images/innodb-change-buffer.png" width="700" height="386" alt="Content is described in the surrounding text.">
</div>

</div>

</div>
<br class="figure-break"><p>
    Unlike <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered
    indexes</a>, secondary indexes are usually nonunique, and inserts
    into secondary indexes happen in a relatively random order.
    Similarly, deletes and updates may affect secondary index pages that
    are not adjacently located in an index tree. Merging cached changes
    at a later time, when affected pages are read into the buffer pool
    by other operations, avoids substantial random access I/O that would
    be required to read secondary index pages into the buffer pool from
    disk.
  </p><p>
    Periodically, the purge operation that runs when the system is
    mostly idle, or during a slow shutdown, writes the updated index
    pages to disk. The purge operation can write disk blocks for a
    series of index values more efficiently than if each value were
    written to disk immediately.
  </p><p>
    Change buffer merging may take several hours when there are many
    affected rows and numerous secondary indexes to update. During this
    time, disk I/O is increased, which can cause a significant slowdown
    for disk-bound queries. Change buffer merging may also continue to
    occur after a transaction is committed, and even after a server
    shutdown and restart (see <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="15.20.2 Forcing InnoDB Recovery">Section 15.20.2, “Forcing InnoDB Recovery”</a>
    for more information).
  </p><p>
    In memory, the change buffer occupies part of the buffer pool. On
    disk, the change buffer is part of the system tablespace, where
    index changes are buffered when the database server is shut down.
  </p><p>
    The type of data cached in the change buffer is governed by the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a> variable.
    For more information, see
    <a class="xref" href="innodb-storage-engine.html#innodb-change-buffer-configuration" title="Configuring Change Buffering">Configuring Change Buffering</a>. You can also
    configure the maximum change buffer size. For more information, see
    <a class="xref" href="innodb-storage-engine.html#innodb-change-buffer-maximum-size" title="Configuring the Change Buffer Maximum Size">Configuring the Change Buffer Maximum Size</a>.
  </p><p>
    Change buffering is not supported for a secondary index if the index
    contains a descending index column or if the primary key includes a
    descending index column.
  </p><p>
    For answers to frequently asked questions about the change buffer,
    see <a class="xref" href="faqs.html#faqs-innodb-change-buffer" title="A.15 MySQL 8.0 FAQ: InnoDB Change Buffer">Section A.15, “MySQL 8.0 FAQ: InnoDB Change Buffer”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-change-buffer-configuration"></a>Configuring Change Buffering</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091652719584"></a><a class="indexterm" name="idm140091652718512"></a><a class="indexterm" name="idm140091652717024"></a><p>
      When <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations are performed on
      a table, the values of indexed columns (particularly the values of
      secondary keys) are often in an unsorted order, requiring
      substantial I/O to bring secondary indexes up to date. The
      <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">change buffer</a> caches
      changes to secondary index entries when the relevant
      <a class="link" href="glossary.html#glos_page" title="page">page</a> is not in the
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, thus avoiding
      expensive I/O operations by not immediately reading in the page
      from disk. The buffered changes are merged when the page is loaded
      into the buffer pool, and the updated page is later flushed to
      disk. The <code class="literal">InnoDB</code> main thread merges buffered
      changes when the server is nearly idle, and during a
      <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>.
    </p><p>
      Because it can result in fewer disk reads and writes, the change
      buffer feature is most valuable for workloads that are I/O-bound,
      for example applications with a high volume of DML operations such
      as bulk inserts.
    </p><p>
      However, the change buffer occupies a part of the buffer pool,
      reducing the memory available to cache data pages. If the working
      set almost fits in the buffer pool, or if your tables have
      relatively few secondary indexes, it may be useful to disable
      change buffering. If the working data set fits entirely within the
      buffer pool, change buffering does not impose extra overhead,
      because it only applies to pages that are not in the buffer pool.
    </p><p>
      You can control the extent to which <code class="literal">InnoDB</code>
      performs change buffering using the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>
      configuration parameter. You can enable or disable buffering for
      inserts, delete operations (when index records are initially
      marked for deletion) and purge operations (when index records are
      physically deleted). An update operation is a combination of an
      insert and a delete. The default
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a> value is
      <code class="literal">all</code>.
    </p><p>
      Permitted <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>
      values include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">all</code></strong></span>
        </p><p>
          The default value: buffer inserts, delete-marking operations,
          and purges.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">none</code></strong></span>
        </p><p>
          Do not buffer any operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">inserts</code></strong></span>
        </p><p>
          Buffer insert operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">deletes</code></strong></span>
        </p><p>
          Buffer delete-marking operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">changes</code></strong></span>
        </p><p>
          Buffer both inserts and delete-marking operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">purges</code></strong></span>
        </p><p>
          Buffer the physical deletion operations that happen in the
          background.
</p></li></ul>
</div>
<p>
      You can set the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a> parameter
      in the MySQL option file (<code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>) or change it dynamically with the
      <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET GLOBAL</code></a>
      statement, which requires privileges sufficient to set global
      system variables. See
      <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>. Changing the setting
      affects the buffering of new operations; the merging of existing
      buffered entries is not affected.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-change-buffer-maximum-size"></a>Configuring the Change Buffer Maximum Size</h4>

</div>

</div>

</div>
<p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a>
      variable permits configuring the maximum size of the change buffer
      as a percentage of the total size of the buffer pool. By default,
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a> is
      set to 25. The maximum setting is 50.
    </p><p>
      Consider increasing
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a> on
      a MySQL server with heavy insert, update, and delete activity,
      where change buffer merging does not keep pace with new change
      buffer entries, causing the change buffer to reach its maximum
      size limit.
    </p><p>
      Consider decreasing
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a> on
      a MySQL server with static data used for reporting, or if the
      change buffer consumes too much of the memory space shared with
      the buffer pool, causing pages to age out of the buffer pool
      sooner than desired.
    </p><p>
      Test different settings with a representative workload to
      determine an optimal configuration. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size"><code class="literal">innodb_change_buffer_max_size</code></a>
      setting is dynamic, which permits modifying the setting without
      restarting the server.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-change-buffer-monitoring"></a>Monitoring the Change Buffer</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652667488"></a><a class="indexterm" name="idm140091652666000"></a><p>
      The following options are available for change buffer monitoring:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code> Standard Monitor output includes
          change buffer status information. To view monitor data, issue
          the <code class="literal">SHOW ENGINE INNODB STATUS</code> statement.
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>
</pre><p>
          Change buffer status information is located under the
          <code class="literal">INSERT BUFFER AND ADAPTIVE HASH INDEX</code>
          heading and appears similar to the following:
        </p><pre data-lang="sql" class="programlisting">
-------------------------------------
INSERT BUFFER AND ADAPTIVE HASH INDEX
-------------------------------------
Ibuf: size 1, free list len 0, seg size 2, 0 merges
merged operations:
 insert 0, delete mark 0, delete 0
discarded operations:
 insert 0, delete mark 0, delete 0
Hash table size 4425293, used cells 32, node heap has 1 buffer(s)
13577.57 hash searches/s, 202.47 non-hash searches/s
</pre><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-standard-monitor" title="15.16.3 InnoDB Standard Monitor and Lock Monitor Output">Section 15.16.3, “InnoDB Standard Monitor and Lock Monitor Output”</a>.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table provides most of the data points found in
          <code class="literal">InnoDB</code> Standard Monitor output, plus other
          data points. To view change buffer metrics and a description
          of each, issue the following query:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT NAME, COMMENT FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME LIKE '%ibuf%'\G</code></strong>
</pre><p>
          For <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table usage
          information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-metrics-table" title="15.14.6 InnoDB INFORMATION_SCHEMA Metrics Table">Section 15.14.6, “InnoDB INFORMATION_SCHEMA Metrics Table”</a>.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="information-schema.html#innodb-buffer-page-table" title="25.39.1 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></a>
          table provides metadata about each page in the buffer pool,
          including change buffer index and change buffer bitmap pages.
          Change buffer pages are identified by
          <code class="literal">PAGE_TYPE</code>. <code class="literal">IBUF_INDEX</code> is
          the page type for change buffer index pages, and
          <code class="literal">IBUF_BITMAP</code> is the page type for change
          buffer bitmap pages.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
            Querying the <a class="link" href="information-schema.html#innodb-buffer-page-table" title="25.39.1 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a>
            table can introduce significant performance overhead. To
            avoid impacting performance, reproduce the issue you want to
            investigate on a test instance and run your queries on the
            test instance.
</p>
</div>
<p>
          For example, you can query the
          <a class="link" href="information-schema.html#innodb-buffer-page-table" title="25.39.1 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a> table to
          determine the approximate number of
          <code class="literal">IBUF_INDEX</code> and
          <code class="literal">IBUF_BITMAP</code> pages as a percentage of total
          buffer pool pages.
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT (SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></strong>
       <strong class="userinput"><code>WHERE PAGE_TYPE LIKE 'IBUF%') AS change_buffer_pages,</code></strong> 
       <strong class="userinput"><code>(SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE) AS total_pages,</code></strong>
       <strong class="userinput"><code>(SELECT ((change_buffer_pages/total_pages)*100))</code></strong> 
       <strong class="userinput"><code>AS change_buffer_page_percentage;</code></strong>
+---------------------+-------------+-------------------------------+
| change_buffer_pages | total_pages | change_buffer_page_percentage |
+---------------------+-------------+-------------------------------+
|                  25 |        8192 |                        0.3052 |
+---------------------+-------------+-------------------------------+
</pre><p>
          For information about other data provided by the
          <a class="link" href="information-schema.html#innodb-buffer-page-table" title="25.39.1 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a> table, see
          <a class="xref" href="information-schema.html#innodb-buffer-page-table" title="25.39.1 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table">Section 25.39.1, “The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table”</a>. For related usage
          information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-buffer-pool-tables" title="15.14.5 InnoDB INFORMATION_SCHEMA Buffer Pool Tables">Section 15.14.5, “InnoDB INFORMATION_SCHEMA Buffer Pool Tables”</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="performance-schema.html" title="Chapter 26 MySQL Performance Schema">Performance Schema</a>
          provides change buffer mutex wait instrumentation for advanced
          performance monitoring. To view change buffer instrumentation,
          issue the following query:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%wait/synch/mutex/innodb/ibuf%';</code></strong>
+-------------------------------------------------------+---------+-------+
| NAME                                                  | ENABLED | TIMED |
+-------------------------------------------------------+---------+-------+
| wait/synch/mutex/innodb/ibuf_bitmap_mutex             | YES     | YES   |
| wait/synch/mutex/innodb/ibuf_mutex                    | YES     | YES   |
| wait/synch/mutex/innodb/ibuf_pessimistic_insert_mutex | YES     | YES   |
+-------------------------------------------------------+---------+-------+
</pre><p>
          For information about monitoring <code class="literal">InnoDB</code>
          mutex waits, see
          <a class="xref" href="innodb-storage-engine.html#monitor-innodb-mutex-waits-performance-schema" title="15.15.2 Monitoring InnoDB Mutex Waits Using Performance Schema">Section 15.15.2, “Monitoring InnoDB Mutex Waits Using Performance Schema”</a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-adaptive-hash"></a>15.5.3 Adaptive Hash Index</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652622400"></a><a class="indexterm" name="idm140091652620912"></a><p>
      The adaptive hash index feature enables <code class="literal">InnoDB</code>
      to perform more like an in-memory database on systems with
      appropriate combinations of workload and sufficient memory for the
      buffer pool without sacrificing transactional features or
      reliability. The adaptive hash index feature is enabled by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>
      variable, or turned off at server startup by
      <code class="literal">--skip-innodb-adaptive-hash-index</code>.
    </p><p>
      Based on the observed pattern of searches, a hash index is built
      using a prefix of the index key. The prefix can be any length, and
      it may be that only some values in the B-tree appear in the hash
      index. Hash indexes are built on demand for the pages of the index
      that are accessed often.
    </p><p>
      If a table fits almost entirely in main memory, a hash index can
      speed up queries by enabling direct lookup of any element, turning
      the index value into a sort of pointer. <code class="literal">InnoDB</code>
      has a mechanism that monitors index searches. If
      <code class="literal">InnoDB</code> notices that queries could benefit from
      building a hash index, it does so automatically.
    </p><p>
      With some workloads, the speedup from hash index lookups greatly
      outweighs the extra work to monitor index lookups and maintain the
      hash index structure. Access to the adaptive hash index can
      sometimes become a source of contention under heavy workloads,
      such as multiple concurrent joins. Queries with
      <code class="literal">LIKE</code> operators and <code class="literal">%</code>
      wildcards also tend not to benefit. For workloads that do not
      benefit from the adaptive hash index feature, turning it off
      reduces unnecessary performance overhead. Because it is difficult
      to predict in advance whether the adaptive hash index feature is
      appropriate for a particular system and workload, consider running
      benchmarks with it enabled and disabled. Architectural changes in
      MySQL 5.6 make it more suitable to disable the adaptive hash index
      feature than in earlier releases.
    </p><p>
      The adaptive hash index feature is partitioned. Each index is
      bound to a specific partition, and each partition is protected by
      a separate latch. Partitioning is controlled by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index_parts"><code class="literal">innodb_adaptive_hash_index_parts</code></a>
      variable. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index_parts"><code class="literal">innodb_adaptive_hash_index_parts</code></a>
      variable is set to 8 by default. The maximum setting is 512.
    </p><p>
      You can monitor adaptive hash index use and contention in the
      <code class="literal">SEMAPHORES</code> section of
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> output. If there are numerous threads waiting on
      RW-latches created in <code class="filename">btr0sea.c</code>, consider
      increasing the number of adaptive hash index partitions or
      disabling the adaptive hash index feature.
    </p><p>
      For information about the performance characteristics of hash
      indexes, see <a class="xref" href="optimization.html#index-btree-hash" title="8.3.9 Comparison of B-Tree and Hash Indexes">Section 8.3.9, “Comparison of B-Tree and Hash Indexes”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-redo-log-buffer"></a>15.5.4 Log Buffer</h3>

</div>

</div>

</div>
<p>
      The log buffer is the memory area that holds data to be written to
      the log files on disk. Log buffer size is defined by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size"><code class="literal">innodb_log_buffer_size</code></a> variable.
      The default size is 16MB. The contents of the log buffer are
      periodically flushed to disk. A large log buffer enables large
      transactions to run without the need to write redo log data to
      disk before the transactions commit. Thus, if you have
      transactions that update, insert, or delete many rows, increasing
      the size of the log buffer saves disk I/O.
    </p><p>
      The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a>
      variable controls how the contents of the log buffer are written
      and flushed to disk. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_timeout"><code class="literal">innodb_flush_log_at_timeout</code></a>
      variable controls log flushing frequency.
    </p><p>
      For related information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-startup-memory-configuration" title="Memory Configuration">Memory Configuration</a>, and
      <a class="xref" href="optimization.html#optimizing-innodb-logging" title="8.5.4 Optimizing InnoDB Redo Logging">Section 8.5.4, “Optimizing InnoDB Redo Logging”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-on-disk-structures"></a>15.6 InnoDB On-Disk Structures</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tables">15.6.1 Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-indexes">15.6.2 Indexes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tablespace">15.6.3 Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-doublewrite-buffer">15.6.4 Doublewrite Buffer</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-redo-log">15.6.5 Redo Log</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-undo-logs">15.6.6 Undo Logs</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091652593024"></a><p>
    This section describes <code class="literal">InnoDB</code> on-disk structures
    and related topics.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-tables"></a>15.6.1 Tables</h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#using-innodb-tables">15.6.1.1 Creating InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-migration">15.6.1.2 Moving or Copying InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#converting-tables-to-innodb">15.6.1.3 Converting Tables from MyISAM to InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-auto-increment-handling">15.6.1.4 AUTO_INCREMENT Handling in InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-foreign-key-constraints">15.6.1.5 InnoDB and FOREIGN KEY Constraints</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-restrictions">15.6.1.6 Limits on InnoDB Tables</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091652589200"></a><p>
    This section covers topics related to <code class="literal">InnoDB</code>
    tables.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="using-innodb-tables"></a>15.6.1.1 Creating InnoDB Tables</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091652585440"></a><p>
      To create an <code class="literal">InnoDB</code> table, use the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement.
    </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (a INT, b CHAR (20), PRIMARY KEY (a)) ENGINE=InnoDB;
</pre><p>
      You do not need to specify the <code class="literal">ENGINE=InnoDB</code>
      clause if <code class="literal">InnoDB</code> is defined as the default
      storage engine, which it is by default. To check the default
      storage engine, issue the following statement:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@default_storage_engine;</code></strong>
+--------------------------+
| @@default_storage_engine |
+--------------------------+
| InnoDB                   |
+--------------------------+
</pre><p>
      You might still use <code class="literal">ENGINE=InnoDB</code> clause if you
      plan to use <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> or replication to replay
      the <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement on a
      server where the default storage engine is not
      <code class="literal">InnoDB</code>.
    </p><p>
      An <code class="literal">InnoDB</code> table and its indexes can be created
      in the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
      tablespace</a>, in a
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespace, or in a
      <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general tablespace</a>.
      When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
      enabled, which is the default, an <code class="literal">InnoDB</code> table
      is implicitly created in an individual file-per-table tablespace.
      Conversely, when
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
      disabled, an <code class="literal">InnoDB</code> table is implicitly created
      in the <code class="literal">InnoDB</code> system tablespace. To create a
      table in a general tablespace, use
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
      TABLESPACE</code></a> syntax. For more information, see
      <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
    </p><p>
      When you create a table in a file-per-table tablespace, MySQL
      creates an <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd</a> tablespace
      file in a database directory under the MySQL data directory, by
      default. A table created in the <code class="literal">InnoDB</code> system
      tablespace is created in an existing
      <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">ibdata file</a>, which resides in
      the MySQL data directory. A table created in a general tablespace
      is created in an existing general tablespace
      <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd file</a>. General tablespace
      files can be created inside or outside of the MySQL data
      directory. For more information, see
      <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
    </p><p>
      Internally, <code class="literal">InnoDB</code> adds an entry for each table
      to the data dictionary. The entry includes the database name. For
      example, if table <code class="literal">t1</code> is created in the
      <code class="literal">test</code> database, the data dictionary entry for
      the database name is <code class="literal">'test/t1'</code>. This means you
      can create a table of the same name (<code class="literal">t1</code>) in a
      different database, and the table names do not collide inside
      <code class="literal">InnoDB</code>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-tables-row-format"></a>InnoDB Tables and Row Formats</h5>
</div>
</div>
</div>
<a class="indexterm" name="idm140091652550912"></a><p>
        The default row format for <code class="literal">InnoDB</code> tables is
        defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
        configuration option, which has a default value of
        <code class="literal">DYNAMIC</code>.
        <code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">Dynamic</a></code>
        and
        <code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">Compressed</a></code>
        row format allow you to take advantage of
        <code class="literal">InnoDB</code> features such as table compression and
        efficient off-page storage of long column values. To use these
        row formats,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
        enabled (the default).
      </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_file_per_table=1;
CREATE TABLE t3 (a INT, b CHAR (20), PRIMARY KEY (a)) ROW_FORMAT=DYNAMIC;
CREATE TABLE t4 (a INT, b CHAR (20), PRIMARY KEY (a)) ROW_FORMAT=COMPRESSED;
</pre><p>
        Alternatively, you can use
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
        TABLESPACE</code></a> syntax to create an
        <code class="literal">InnoDB</code> table in a general tablespace. General
        tablespaces support all row formats. For more information, see
        <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
      </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (c1 INT PRIMARY KEY) TABLESPACE ts1 ROW_FORMAT=DYNAMIC;
</pre><p>
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
        TABLESPACE</code></a> syntax can also be used to create
        <code class="literal">InnoDB</code> tables with a
        <code class="literal">Dynamic</code> row format in the system tablespace,
        alongside tables with a <code class="literal">Compact</code> or
        <code class="literal">Redundant</code> row format.
      </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (c1 INT PRIMARY KEY) TABLESPACE = innodb_system ROW_FORMAT=DYNAMIC;
</pre><p>
        For more information about <code class="literal">InnoDB</code> row
        formats, see <a class="xref" href="innodb-storage-engine.html#innodb-row-format" title="15.10 InnoDB Row Formats">Section 15.10, “InnoDB Row Formats”</a>. For how to
        determine the row format of an <code class="literal">InnoDB</code> table
        and the physical characteristics of <code class="literal">InnoDB</code>
        row formats, see <a class="xref" href="innodb-storage-engine.html#innodb-row-format" title="15.10 InnoDB Row Formats">Section 15.10, “InnoDB Row Formats”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tables-primary-key"></a>InnoDB Tables and Primary Keys</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652525264"></a><p>
        Always define a <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
        key</a> for an <code class="literal">InnoDB</code> table, specifying
        the column or columns that:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Are referenced by the most important queries.
          </p></li><li class="listitem"><p>
            Are never left blank.
          </p></li><li class="listitem"><p>
            Never have duplicate values.
          </p></li><li class="listitem"><p>
            Rarely if ever change value once inserted.
</p></li></ul>
</div>
<p>
        For example, in a table containing information about people, you
        would not create a primary key on <code class="literal">(firstname,
        lastname)</code> because more than one person can have the
        same name, some people have blank last names, and sometimes
        people change their names. With so many constraints, often there
        is not an obvious set of columns to use as a primary key, so you
        create a new column with a numeric ID to serve as all or part of
        the primary key. You can declare an
        <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a> column
        so that ascending values are filled in automatically as rows are
        inserted:
      </p><pre data-lang="sql" class="programlisting">
# The value of ID can act like a pointer between related items in different tables.
CREATE TABLE t5 (id INT AUTO_INCREMENT, b CHAR (20), PRIMARY KEY (id));

# The primary key can consist of more than one column. Any autoinc column must come first.
CREATE TABLE t6 (id INT AUTO_INCREMENT, a INT, b CHAR (20), PRIMARY KEY (id,a));
</pre><p>
        Although the table works correctly without defining a primary
        key, the primary key is involved with many aspects of
        performance and is a crucial design aspect for any large or
        frequently used table. It is recommended that you always specify
        a primary key in the <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
        statement. If you create the table, load data, and then run
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to add a primary key
        later, that operation is much slower than defining the primary
        key when creating the table.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-viewing-table-properties"></a>Viewing InnoDB Table Properties</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652509520"></a><p>
        To view the properties of an <code class="literal">InnoDB</code> table,
        issue a <a class="link" href="sql-syntax.html#show-table-status" title="13.7.6.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a>
        statement:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW TABLE STATUS FROM test LIKE 't%' \G;</code></strong>
*************************** 1. row ***************************
           Name: t1
         Engine: InnoDB
        Version: 10
     Row_format: Compact
           Rows: 0
 Avg_row_length: 0
    Data_length: 16384
Max_data_length: 0
   Index_length: 0
      Data_free: 0
 Auto_increment: NULL
    Create_time: 2015-03-16 15:13:31
    Update_time: NULL
     Check_time: NULL
      Collation: utf8mb4_0900_ai_ci
       Checksum: NULL
 Create_options:
        Comment:
</pre><p>
        For information about <a class="link" href="sql-syntax.html#show-table-status" title="13.7.6.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE
        STATUS</code></a> output, see
        <a class="xref" href="sql-syntax.html#show-table-status" title="13.7.6.36 SHOW TABLE STATUS Syntax">Section 13.7.6.36, “SHOW TABLE STATUS Syntax”</a>.
      </p><p>
        <code class="literal">InnoDB</code> table properties may also be queried
        using the <code class="literal">InnoDB</code> Information Schema system
        tables:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME='test/t1' \G</code></strong>
*************************** 1. row ***************************
     TABLE_ID: 45
         NAME: test/t1
         FLAG: 1
       N_COLS: 5
        SPACE: 35
   ROW_FORMAT: Compact
ZIP_PAGE_SIZE: 0
   SPACE_TYPE: Single
</pre><p>
        For more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-system-tables" title="15.14.3 InnoDB INFORMATION_SCHEMA Schema Object Tables">Section 15.14.3, “InnoDB INFORMATION_SCHEMA Schema Object Tables”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-migration"></a>15.6.1.2 Moving or Copying InnoDB Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652494592"></a><p>
    This section describes techniques for moving or copying some or all
    <code class="literal">InnoDB</code> tables to a different server or instance.
    For example, you might move an entire MySQL instance to a larger,
    faster server; you might clone an entire MySQL instance to a new
    replication slave server; you might copy individual tables to
    another instance to develop and test an application, or to a data
    warehouse server to produce reports.
  </p><p>
    On Windows, <code class="literal">InnoDB</code> always stores database and
    table names internally in lowercase. To move databases in a binary
    format from Unix to Windows or from Windows to Unix, create all
    databases and tables using lowercase names. A convenient way to
    accomplish this is to add the following line to the
    <code class="literal">[mysqld]</code> section of your
    <code class="filename">my.cnf</code> or <code class="filename">my.ini</code> file
    before creating any databases or tables:
  </p><pre data-lang="ini" class="programlisting">
[mysqld]
lower_case_table_names=1
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
      It is prohibited to start the server with a
      <a class="link" href="server-administration.html#sysvar_lower_case_table_names"><code class="literal">lower_case_table_names</code></a> setting
      that is different from the setting used when the server was
      initialized.
</p>
</div>
<p>
    Techniques for moving or copying <code class="literal">InnoDB</code> tables
    include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#copy-tables-transportable-tablespaces" title="Transportable Tablespaces">Transportable Tablespaces</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#copy-tables-meb" title="MySQL Enterprise Backup">MySQL Enterprise Backup</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#copy-tables-cold-backup" title="Copying Data Files (Cold Backup Method)">Copying Data Files (Cold Backup Method)</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#copy-tables-export-import" title="Export and Import (mysqldump)">Export and Import (mysqldump)</a></p></li></ul>
</div>
<h5><a name="copy-tables-transportable-tablespaces"></a>Transportable Tablespaces</h5>
<p>
    The transportable tablespaces feature uses
    <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
    TABLES ... FOR EXPORT</code></a> to ready <code class="literal">InnoDB</code>
    tables for copying from one server instance to another. To use this
    feature, <code class="literal">InnoDB</code> tables must be created with
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> set to
    <code class="literal">ON</code> so that each <code class="literal">InnoDB</code> table
    has its own tablespace. For usage information, see
    <a class="xref" href="innodb-storage-engine.html#tablespace-copying" title="15.6.3.7 Copying Tablespaces to Another Instance">Section 15.6.3.7, “Copying Tablespaces to Another Instance”</a>.
</p>
<h5><a name="copy-tables-meb"></a>MySQL Enterprise Backup</h5>
<p>
    The MySQL Enterprise Backup product lets you back up a running MySQL
    database with minimal disruption to operations while producing a
    consistent snapshot of the database. When MySQL Enterprise Backup is
    copying tables, reads and writes can continue. In addition, MySQL
    Enterprise Backup can create compressed backup files, and back up
    subsets of tables. In conjunction with the MySQL binary log, you can
    perform point-in-time recovery. MySQL Enterprise Backup is included
    as part of the MySQL Enterprise subscription.
  </p><p>
    For more details about MySQL Enterprise Backup, see
    <a class="xref" href="mysql-enterprise.html#mysql-enterprise-backup" title="30.2 MySQL Enterprise Backup Overview">Section 30.2, “MySQL Enterprise Backup Overview”</a>.
</p>
<h5><a name="copy-tables-cold-backup"></a>Copying Data Files (Cold Backup Method)</h5>
<p>
    You can move an <code class="literal">InnoDB</code> database simply by copying
    all the relevant files listed under "Cold Backups" in
    <a class="xref" href="innodb-storage-engine.html#innodb-backup" title="15.17.1 InnoDB Backup">Section 15.17.1, “InnoDB Backup”</a>.
  </p><p>
    <code class="literal">InnoDB</code> data and log files are binary-compatible
    on all platforms having the same floating-point number format. If
    the floating-point formats differ but you have not used
    <a class="link" href="data-types.html#floating-point-types" title="11.2.3 Floating-Point Types (Approximate Value) - FLOAT, DOUBLE"><code class="literal">FLOAT</code></a> or
    <a class="link" href="data-types.html#floating-point-types" title="11.2.3 Floating-Point Types (Approximate Value) - FLOAT, DOUBLE"><code class="literal">DOUBLE</code></a> data types in your tables,
    then the procedure is the same: simply copy the relevant files.
  </p><p>
    When you move or copy file-per-table <code class="filename">.ibd</code>
    files, the database directory name must be the same on the source
    and destination systems. The table definition stored in the
    <code class="literal">InnoDB</code> shared tablespace includes the database
    name. The transaction IDs and log sequence numbers stored in the
    tablespace files also differ between databases.
  </p><p>
    To move an <code class="filename">.ibd</code> file and the associated table
    from one database to another, use a <a class="link" href="sql-syntax.html#rename-table" title="13.1.36 RENAME TABLE Syntax"><code class="literal">RENAME
    TABLE</code></a> statement:
  </p><pre data-lang="sql" class="programlisting">
RENAME TABLE <em class="replaceable"><code>db1.tbl_name</code></em> TO <em class="replaceable"><code>db2.tbl_name</code></em>;
</pre><a class="indexterm" name="idm140091652454832"></a><a class="indexterm" name="idm140091652453760"></a><p>
    If you have a <span class="quote">“<span class="quote">clean</span>”</span> backup of an
    <code class="filename">.ibd</code> file, you can restore it to the MySQL
    installation from which it originated as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        The table must not have been dropped or truncated since you
        copied the <code class="filename">.ibd</code> file, because doing so
        changes the table ID stored inside the tablespace.
      </p></li><li class="listitem"><p>
        Issue this <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement
        to delete the current <code class="filename">.ibd</code> file:
      </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DISCARD TABLESPACE;
</pre></li><li class="listitem"><p>
        Copy the backup <code class="filename">.ibd</code> file to the proper
        database directory.
      </p></li><li class="listitem"><p>
        Issue this <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement
        to tell <code class="literal">InnoDB</code> to use the new
        <code class="filename">.ibd</code> file for the table:
      </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> IMPORT TABLESPACE;
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
          ... IMPORT TABLESPACE</code></a> feature does not enforce
          foreign key constraints on imported data.
</p>
</div>
</li></ol>
</div>
<p>
    In this context, a <span class="quote">“<span class="quote">clean</span>”</span> <code class="filename">.ibd</code>
    file backup is one for which the following requirements are
    satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        There are no uncommitted modifications by transactions in the
        <code class="filename">.ibd</code> file.
      </p></li><li class="listitem"><p>
        There are no unmerged insert buffer entries in the
        <code class="filename">.ibd</code> file.
      </p></li><li class="listitem"><p>
        Purge has removed all delete-marked index records from the
        <code class="filename">.ibd</code> file.
      </p></li><li class="listitem"><p>
        <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> has flushed all modified pages of the
        <code class="filename">.ibd</code> file from the buffer pool to the file.
</p></li></ul>
</div>
<p>
    You can make a clean backup <code class="filename">.ibd</code> file using the
    following method:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        Stop all activity from the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server and
        commit all transactions.
      </p></li><li class="listitem"><p>
        Wait until <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW
        ENGINE INNODB STATUS</code></a> shows that there are no active
        transactions in the database, and the main thread status of
        <code class="literal">InnoDB</code> is <code class="literal">Waiting for server
        activity</code>. Then you can make a copy of the
        <code class="filename">.ibd</code> file.
</p></li></ol>
</div>
<p>
    Another method for making a clean copy of an
    <code class="filename">.ibd</code> file is to use the MySQL Enterprise Backup
    product:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        Use MySQL Enterprise Backup to back up the
        <code class="literal">InnoDB</code> installation.
      </p></li><li class="listitem"><p>
        Start a second <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server on the backup
        and let it clean up the <code class="filename">.ibd</code> files in the
        backup.
</p></li></ol>
</div>
<h5><a name="copy-tables-export-import"></a>Export and Import (mysqldump)</h5>
<p>
    You can use <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to dump your tables on one
    machine and then import the dump files on the other machine. Using
    this method, it does not matter whether the formats differ or if
    your tables contain floating-point data.
  </p><p>
    One way to increase the performance of this method is to switch off
    <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a> mode when
    importing data, assuming that the tablespace has enough space for
    the big rollback segment that the import transactions generate. Do
    the commit only after importing a whole table or a segment of a
    table.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="converting-tables-to-innodb"></a>15.6.1.3 Converting Tables from MyISAM to InnoDB</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652405216"></a><a class="indexterm" name="idm140091652403296"></a><p>
    If you have <a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables that you want
    to convert to <a class="link" href="innodb-storage-engine.html" title="Chapter 15 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> for better
    reliability and scalability, review the following guidelines and
    tips before converting.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
      Partitioned <code class="literal">MyISAM</code> tables created in previous
      versions of MySQL are not compatible with MySQL 8.0.
      Such tables must be prepared prior to upgrade, either by removing
      the partitioning, or by converting them to
      <code class="literal">InnoDB</code>. See
      <a class="xref" href="partitioning.html#partitioning-limitations-storage-engines" title="23.6.2 Partitioning Limitations Relating to Storage Engines">Section 23.6.2, “Partitioning Limitations Relating to Storage Engines”</a>, for
      more information.
</p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-convert-memory-usage" title="Adjusting Memory Usage for MyISAM and InnoDB">Adjusting Memory Usage for MyISAM and InnoDB</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-convert-transactions" title="Handling Too-Long Or Too-Short Transactions">Handling Too-Long Or Too-Short Transactions</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-convert-deadlock" title="Handling Deadlocks">Handling Deadlocks</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-convert-plan-storage" title="Planning the Storage Layout">Planning the Storage Layout</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-convert-convert" title="Converting an Existing Table">Converting an Existing Table</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-convert-clone" title="Cloning the Structure of a Table">Cloning the Structure of a Table</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-convert-transfer" title="Transferring Existing Data">Transferring Existing Data</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-convert-storage-requirements" title="Storage Requirements">Storage Requirements</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-convert-primary-key" title="Defining a PRIMARY KEY for Each Table">Defining a PRIMARY KEY for Each Table</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-convert-application-performance" title="Application Performance Considerations">Application Performance Considerations</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-convert-understand-files" title="Understanding Files Associated with InnoDB Tables">Understanding Files Associated with InnoDB Tables</a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-convert-memory-usage"></a>Adjusting Memory Usage for MyISAM and InnoDB</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652382160"></a><p>
      As you transition away from <code class="literal">MyISAM</code> tables,
      lower the value of the
      <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a> configuration
      option to free memory no longer needed for caching results.
      Increase the value of the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
      configuration option, which performs a similar role of allocating
      cache memory for <code class="literal">InnoDB</code> tables. The
      <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
      pool</a> caches both table data and index data, speeding up
      lookups for queries and keeping query results in memory for reuse.
      For guidance regarding buffer pool size configuration, see
      <a class="xref" href="optimization.html#memory-use" title="8.12.3.1 How MySQL Uses Memory">Section 8.12.3.1, “How MySQL Uses Memory”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-convert-transactions"></a>Handling Too-Long Or Too-Short Transactions</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652372432"></a><p>
      Because <code class="literal">MyISAM</code> tables do not support
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, you might
      not have paid much attention to the
      <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> configuration option
      and the <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
      statements. These keywords are important to allow multiple
      sessions to read and write <code class="literal">InnoDB</code> tables
      concurrently, providing substantial scalability benefits in
      write-heavy workloads.
    </p><p>
      While a transaction is open, the system keeps a snapshot of the
      data as seen at the beginning of the transaction, which can cause
      substantial overhead if the system inserts, updates, and deletes
      millions of rows while a stray transaction keeps running. Thus,
      take care to avoid transactions that run for too long:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If you are using a <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> session for
          interactive experiments, always
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> (to finalize the
          changes) or
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> (to
          undo the changes) when finished. Close down interactive
          sessions rather than leave them open for long periods, to
          avoid keeping transactions open for long periods by accident.
        </p></li><li class="listitem"><p>
          Make sure that any error handlers in your application also
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
          incomplete changes or <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>
          completed changes.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> is
          a relatively expensive operation, because
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations are written
          to <code class="literal">InnoDB</code> tables prior to the
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>, with the expectation
          that most changes are committed successfully and rollbacks are
          rare. When experimenting with large volumes of data, avoid
          making changes to large numbers of rows and then rolling back
          those changes.
        </p></li><li class="listitem"><p>
          When loading large volumes of data with a sequence of
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statements, periodically
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> the results to avoid
          having transactions that last for hours. In typical load
          operations for data warehousing, if something goes wrong, you
          truncate the table (using <a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE
          TABLE</code></a>) and start over from the beginning rather than
          doing a
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>.
</p></li></ul>
</div>
<p>
      The preceding tips save memory and disk space that can be wasted
      during too-long transactions. When transactions are shorter than
      they should be, the problem is excessive I/O. With each
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>, MySQL makes sure each
      change is safely recorded to disk, which involves some I/O.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          For most operations on <code class="literal">InnoDB</code> tables, you
          should use the setting
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit=0</code></a>. From an
          efficiency perspective, this avoids unnecessary I/O when you
          issue large numbers of consecutive
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements. From a
          safety perspective, this allows you to issue a
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
          statement to recover lost or garbled data if you make a
          mistake on the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> command line, or in an
          exception handler in your application.
        </p></li><li class="listitem"><p>
          The time when <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit=1</code></a> is
          suitable for <code class="literal">InnoDB</code> tables is when running
          a sequence of queries for generating reports or analyzing
          statistics. In this situation, there is no I/O penalty related
          to <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>,
          and <code class="literal">InnoDB</code> can
          <a class="link" href="optimization.html#innodb-performance-ro-txn" title="8.5.3 Optimizing InnoDB Read-Only Transactions">automatically
          optimize the read-only workload</a>.
        </p></li><li class="listitem"><p>
          If you make a series of related changes, finalize all the
          changes at once with a single
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> at the end. For example,
          if you insert related pieces of information into several
          tables, do a single <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>
          after making all the changes. Or if you run many consecutive
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statements, do a single
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> after all the data is
          loaded; if you are doing millions of
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statements, perhaps
          split up the huge transaction by issuing a
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> every ten thousand or
          hundred thousand records, so the transaction does not grow too
          large.
        </p></li><li class="listitem"><p>
          Remember that even a <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a>
          statement opens a transaction, so after running some report or
          debugging queries in an interactive <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a>
          session, either issue a <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>
          or close the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> session.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-convert-deadlock"></a>Handling Deadlocks</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652306176"></a><p>
      You might see warning messages referring to
      <span class="quote">“<span class="quote">deadlocks</span>”</span> in the MySQL error log, or the output of
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a>. Despite the scary-sounding name, a
      <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a> is not a serious
      issue for <code class="literal">InnoDB</code> tables, and often does not
      require any corrective action. When two transactions start
      modifying multiple tables, accessing the tables in a different
      order, they can reach a state where each transaction is waiting
      for the other and neither can proceed. When
      <a class="link" href="glossary.html#glos_deadlock_detection" title="deadlock detection">deadlock detection</a>
      is enabled (the default), MySQL immediately detects this condition
      and cancels (<a class="link" href="glossary.html#glos_rollback" title="rollback">rolls back</a>) the
      <span class="quote">“<span class="quote">smaller</span>”</span> transaction, allowing the other to proceed.
      If deadlock detection is disabled using the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_deadlock_detect"><code class="literal">innodb_deadlock_detect</code></a>
      configuration option, <code class="literal">InnoDB</code> relies on the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> setting
      to roll back transactions in case of a deadlock.
    </p><p>
      Either way, your applications need error-handling logic to restart
      a transaction that is forcibly cancelled due to a deadlock. When
      you re-issue the same SQL statements as before, the original
      timing issue no longer applies. Either the other transaction has
      already finished and yours can proceed, or the other transaction
      is still in progress and your transaction waits until it finishes.
    </p><p>
      If deadlock warnings occur constantly, you might review the
      application code to reorder the SQL operations in a consistent
      way, or to shorten the transactions. You can test with the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a> option
      enabled to see all deadlock warnings in the MySQL error log,
      rather than only the last warning in the
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> output.
    </p><p>
      For more information, see <a class="xref" href="innodb-storage-engine.html#innodb-deadlocks" title="15.7.5 Deadlocks in InnoDB">Section 15.7.5, “Deadlocks in InnoDB”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-convert-plan-storage"></a>Planning the Storage Layout</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652288496"></a><p>
      To get the best performance from <code class="literal">InnoDB</code> tables,
      you can adjust a number of parameters related to storage layout.
    </p><p>
      When you convert <code class="literal">MyISAM</code> tables that are large,
      frequently accessed, and hold vital data, investigate and consider
      the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> configuration
      options, and the
      <a class="link" href="innodb-storage-engine.html#innodb-row-format" title="15.10 InnoDB Row Formats"><code class="literal">ROW_FORMAT</code>
      and <code class="literal">KEY_BLOCK_SIZE</code> clauses</a> of the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement.
    </p><p>
      During your initial experiments, the most important setting is
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>. When this
      setting is enabled, which is the default, new
      <code class="literal">InnoDB</code> tables are implicitly created in
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespaces. In contrast with the <code class="literal">InnoDB</code> system
      tablespace, file-per-table tablespaces allow disk space to be
      reclaimed by the operating system when a table is truncated or
      dropped. File-per-table tablespaces also support
      <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a> and
      <a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a> row
      formats and associated features such as table compression,
      efficient off-page storage for long variable-length columns, and
      large index prefixes. For more information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="15.6.3.2 File-Per-Table Tablespaces">Section 15.6.3.2, “File-Per-Table Tablespaces”</a>.
    </p><p>
      You can also store <code class="literal">InnoDB</code> tables in a shared
      general tablespace, which support multiple tables and all row
      formats. For more information, see
      <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-convert-convert"></a>Converting an Existing Table</h5>

</div>

</div>

</div>
<p>
      To convert a non-<code class="literal">InnoDB</code> table to use
      <code class="literal">InnoDB</code> use <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a>:
    </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>table_name</code></em> ENGINE=InnoDB;
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-convert-clone"></a>Cloning the Structure of a Table</h5>

</div>

</div>

</div>
<p>
      You might make an <code class="literal">InnoDB</code> table that is a clone
      of a MyISAM table, rather than using <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> to perform conversion, to test the old and new
      table side-by-side before switching.
    </p><p>
      Create an empty <code class="literal">InnoDB</code> table with identical
      column and index definitions. Use <code class="literal">SHOW CREATE TABLE
      <em class="replaceable"><code>table_name</code></em>\G</code> to see the full
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement to use.
      Change the <code class="literal">ENGINE</code> clause to
      <code class="literal">ENGINE=INNODB</code>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-convert-transfer"></a>Transferring Existing Data</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652253840"></a><p>
      To transfer a large volume of data into an empty
      <code class="literal">InnoDB</code> table created as shown in the previous
      section, insert the rows with <code class="literal">INSERT INTO
      <em class="replaceable"><code>innodb_table</code></em> SELECT * FROM
      <em class="replaceable"><code>myisam_table</code></em> ORDER BY
      <em class="replaceable"><code>primary_key_columns</code></em></code>.
    </p><p>
      You can also create the indexes for the <code class="literal">InnoDB</code>
      table after inserting the data. Historically, creating new
      secondary indexes was a slow operation for InnoDB, but now you can
      create the indexes after the data is loaded with relatively little
      overhead from the index creation step.
    </p><p>
      If you have <code class="literal">UNIQUE</code> constraints on secondary
      keys, you can speed up a table import by turning off the
      uniqueness checks temporarily during the import operation:
    </p><pre data-lang="sql" class="programlisting">
SET unique_checks=0;
<em class="replaceable"><code>... import operation ...</code></em>
SET unique_checks=1;
</pre><p>
      For big tables, this saves disk I/O because
      <code class="literal">InnoDB</code> can use its
      <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">change buffer</a> to write
      secondary index records as a batch. Be certain that the data
      contains no duplicate keys.
      <a class="link" href="server-administration.html#sysvar_unique_checks"><code class="literal">unique_checks</code></a> permits but does
      not require storage engines to ignore duplicate keys.
    </p><p>
      For better control over the insertion process, you can insert big
      tables in pieces:
    </p><pre data-lang="sql" class="programlisting">
INSERT INTO newtable SELECT * FROM oldtable
   WHERE yourkey &gt; <em class="replaceable"><code>something</code></em> AND yourkey &lt;= <em class="replaceable"><code>somethingelse</code></em>;
</pre><p>
      After all records are inserted, you can rename the tables.
    </p><p>
      During the conversion of big tables, increase the size of the
      <code class="literal">InnoDB</code> buffer pool to reduce disk I/O, to a
      maximum of 80% of physical memory. You can also increase the size
      of <code class="literal">InnoDB</code> log files.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-convert-storage-requirements"></a>Storage Requirements</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652235536"></a><p>
      If you intend to make several temporary copies of your data in
      <code class="literal">InnoDB</code> tables during the conversion process, it
      is recommended that you create the tables in file-per-table
      tablespaces so that you can reclaim the disk space when you drop
      the tables. When the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      configuration option is enabled (the default), newly created
      <code class="literal">InnoDB</code> tables are implicitly created in
      file-per-table tablespaces.
    </p><p>
      Whether you convert the <code class="literal">MyISAM</code> table directly
      or create a cloned <code class="literal">InnoDB</code> table, make sure that
      you have sufficient disk space to hold both the old and new tables
      during the process.
      <span class="bold"><strong><code class="literal">InnoDB</code> tables require
      more disk space than <code class="literal">MyISAM</code> tables.</strong></span>
      If an <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation runs
      out of space, it starts a rollback, and that can take hours if it
      is disk-bound. For inserts, <code class="literal">InnoDB</code> uses the
      insert buffer to merge secondary index records to indexes in
      batches. That saves a lot of disk I/O. For rollback, no such
      mechanism is used, and the rollback can take 30 times longer than
      the insertion.
    </p><p>
      In the case of a runaway rollback, if you do not have valuable
      data in your database, it may be advisable to kill the database
      process rather than wait for millions of disk I/O operations to
      complete. For the complete procedure, see
      <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="15.20.2 Forcing InnoDB Recovery">Section 15.20.2, “Forcing InnoDB Recovery”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-convert-primary-key"></a>Defining a PRIMARY KEY for Each Table</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652221632"></a><p>
      The <code class="literal">PRIMARY KEY</code> clause is a critical factor
      affecting the performance of MySQL queries and the space usage for
      tables and indexes. The primary key uniquely identifies a row in a
      table. Every row in the table must have a primary key value, and
      no two rows can have the same primary key value.
    </p><p>
      These are guidelines for the primary key, followed by more
      detailed explanations.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Declare a <code class="literal">PRIMARY KEY</code> for each table.
          Typically, it is the most important column that you refer to
          in <code class="literal">WHERE</code> clauses when looking up a single
          row.
        </p></li><li class="listitem"><p>
          Declare the <code class="literal">PRIMARY KEY</code> clause in the
          original <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
          statement, rather than adding it later through an
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement.
        </p></li><li class="listitem"><p>
          Choose the column and its data type carefully. Prefer numeric
          columns over character or string ones.
        </p></li><li class="listitem"><p>
          Consider using an auto-increment column if there is not
          another stable, unique, non-null, numeric column to use.
        </p></li><li class="listitem"><p>
          An auto-increment column is also a good choice if there is any
          doubt whether the value of the primary key column could ever
          change. Changing the value of a primary key column is an
          expensive operation, possibly involving rearranging data
          within the table and within each secondary index.
</p></li></ul>
</div>
<p>
      Consider adding a <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
      key</a> to any table that does not already have one. Use the
      smallest practical numeric type based on the maximum projected
      size of the table. This can make each row slightly more compact,
      which can yield substantial space savings for large tables. The
      space savings are multiplied if the table has any
      <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>,
      because the primary key value is repeated in each secondary index
      entry. In addition to reducing data size on disk, a small primary
      key also lets more data fit into the
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, speeding up
      all kinds of operations and improving concurrency.
    </p><p>
      If the table already has a primary key on some longer column, such
      as a <code class="literal">VARCHAR</code>, consider adding a new unsigned
      <code class="literal">AUTO_INCREMENT</code> column and switching the primary
      key to that, even if that column is not referenced in queries.
      This design change can produce substantial space savings in the
      secondary indexes. You can designate the former primary key
      columns as <code class="literal">UNIQUE NOT NULL</code> to enforce the same
      constraints as the <code class="literal">PRIMARY KEY</code> clause, that is,
      to prevent duplicate or null values across all those columns.
    </p><p>
      If you spread related information across multiple tables,
      typically each table uses the same column for its primary key. For
      example, a personnel database might have several tables, each with
      a primary key of employee number. A sales database might have some
      tables with a primary key of customer number, and other tables
      with a primary key of order number. Because lookups using the
      primary key are very fast, you can construct efficient join
      queries for such tables.
    </p><p>
      If you leave the <code class="literal">PRIMARY KEY</code> clause out
      entirely, MySQL creates an invisible one for you. It is a 6-byte
      value that might be longer than you need, thus wasting space.
      Because it is hidden, you cannot refer to it in queries.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-convert-application-performance"></a>Application Performance Considerations</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652197680"></a><p>
      The reliability and scalability features of
      <code class="literal">InnoDB</code> require more disk storage than
      equivalent <code class="literal">MyISAM</code> tables. You might change the
      column and index definitions slightly, for better space
      utilization, reduced I/O and memory consumption when processing
      result sets, and better query optimization plans making efficient
      use of index lookups.
    </p><p>
      If you do set up a numeric ID column for the primary key, use that
      value to cross-reference with related values in any other tables,
      particularly for <a class="link" href="glossary.html#glos_join" title="join">join</a> queries.
      For example, rather than accepting a country name as input and
      doing queries searching for the same name, do one lookup to
      determine the country ID, then do other queries (or a single join
      query) to look up relevant information across several tables.
      Rather than storing a customer or catalog item number as a string
      of digits, potentially using up several bytes, convert it to a
      numeric ID for storing and querying. A 4-byte unsigned
      <a class="link" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">INT</code></a> column can index over 4 billion
      items (with the US meaning of billion: 1000 million). For the
      ranges of the different integer types, see
      <a class="xref" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT">Section 11.2.1, “Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT,
        MEDIUMINT, BIGINT”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-convert-understand-files"></a>Understanding Files Associated with InnoDB Tables</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652188816"></a><p>
      <code class="literal">InnoDB</code> files require more care and planning
      than <code class="literal">MyISAM</code> files do.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          You must not delete the
          <a class="link" href="glossary.html#glos_ibdata_file" title="ibdata file">ibdata files</a> that
          represent the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>.
        </p></li><li class="listitem"><p>
          Methods of moving or copying <code class="literal">InnoDB</code> tables
          to a different server are described in
          <a class="xref" href="innodb-storage-engine.html#innodb-migration" title="15.6.1.2 Moving or Copying InnoDB Tables">Section 15.6.1.2, “Moving or Copying InnoDB Tables”</a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-auto-increment-handling"></a>15.6.1.4 AUTO_INCREMENT Handling in InnoDB</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652178240"></a><a class="indexterm" name="idm140091652177168"></a><p>
      <code class="literal">InnoDB</code> provides a configurable locking
      mechanism that can significantly improve scalability and
      performance of SQL statements that add rows to tables with
      <code class="literal">AUTO_INCREMENT</code> columns. To use the
      <code class="literal">AUTO_INCREMENT</code> mechanism with an
      <code class="literal">InnoDB</code> table, an
      <code class="literal">AUTO_INCREMENT</code> column must be defined as part
      of an index such that it is possible to perform the equivalent of
      an indexed <code class="literal">SELECT
      MAX(<em class="replaceable"><code>ai_col</code></em>)</code> lookup on the
      table to obtain the maximum column value. Typically, this is
      achieved by making the column the first column of some table
      index.
    </p><p>
      This section describes the behavior of
      <code class="literal">AUTO_INCREMENT</code> lock modes, usage implications
      for different <code class="literal">AUTO_INCREMENT</code> lock mode
      settings, and how <code class="literal">InnoDB</code> initializes the
      <code class="literal">AUTO_INCREMENT</code> counter.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-auto-increment-lock-modes" title="InnoDB AUTO_INCREMENT Lock Modes">InnoDB
          AUTO_INCREMENT Lock Modes</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-auto-increment-lock-mode-usage-implications" title="InnoDB AUTO_INCREMENT Lock Mode Usage Implications">InnoDB
          AUTO_INCREMENT Lock Mode Usage Implications</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-auto-increment-initialization" title="InnoDB AUTO_INCREMENT Counter Initialization">InnoDB
          AUTO_INCREMENT Counter Initialization</a>
</p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-auto-increment-lock-modes"></a>InnoDB AUTO_INCREMENT Lock Modes</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091652160096"></a><p>
        This section describes the behavior of
        <code class="literal">AUTO_INCREMENT</code> lock modes used to generate
        auto-increment values, and how each lock mode affects
        replication. Auto-increment lock modes are configured at startup
        using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
        configuration parameter.
      </p><p>
        The following terms are used in describing
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
        settings:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements
          </p><p>
            All statements that generate new rows in a table, including
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>, <a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE Syntax"><code class="literal">REPLACE</code></a>,
            <a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE Syntax"><code class="literal">REPLACE ...
            SELECT</code></a>, and <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD
            DATA</code></a>. Includes <span class="quote">“<span class="quote">simple-inserts</span>”</span>,
            <span class="quote">“<span class="quote">bulk-inserts</span>”</span>, and <span class="quote">“<span class="quote">mixed-mode</span>”</span>
            inserts.
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Simple inserts</span>”</span>
          </p><p>
            Statements for which the number of rows to be inserted can
            be determined in advance (when the statement is initially
            processed). This includes single-row and multiple-row
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> and
            <a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE Syntax"><code class="literal">REPLACE</code></a> statements that do
            not have a nested subquery, but not
            <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.6.2 INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
            ... ON DUPLICATE KEY UPDATE</code></a>.
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Bulk inserts</span>”</span>
          </p><p>
            Statements for which the number of rows to be inserted (and
            the number of required auto-increment values) is not known
            in advance. This includes
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>,
            <a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE Syntax"><code class="literal">REPLACE ...
            SELECT</code></a>, and <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD
            DATA</code></a> statements, but not plain
            <code class="literal">INSERT</code>. <code class="literal">InnoDB</code> assigns
            new values for the <code class="literal">AUTO_INCREMENT</code> column
            one at a time as each row is processed.
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Mixed-mode inserts</span>”</span>
          </p><p>
            These are <span class="quote">“<span class="quote">simple insert</span>”</span> statements that
            specify the auto-increment value for some (but not all) of
            the new rows. An example follows, where
            <code class="literal">c1</code> is an
            <code class="literal">AUTO_INCREMENT</code> column of table
            <code class="literal">t1</code>:
          </p><pre data-lang="sql" class="programlisting">
INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');
</pre><p>
            Another type of <span class="quote">“<span class="quote">mixed-mode insert</span>”</span> is
            <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.6.2 INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
            ... ON DUPLICATE KEY UPDATE</code></a>, which in the worst
            case is in effect an <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>
            followed by a <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, where
            the allocated value for the
            <code class="literal">AUTO_INCREMENT</code> column may or may not be
            used during the update phase.
</p></li></ul>
</div>
<p>
        There are three possible settings for the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
        configuration parameter. The settings are 0, 1, or 2, for
        <span class="quote">“<span class="quote">traditional</span>”</span>, <span class="quote">“<span class="quote">consecutive</span>”</span>, or
        <span class="quote">“<span class="quote">interleaved</span>”</span> lock mode, respectively. As of MySQL
        8.0, interleaved lock mode
        (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode=2</code></a>) is
        the default setting. Prior to MySQL 8.0, consecutive lock mode
        is the default
        (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode=1</code></a>).
      </p><p>
        The default setting of interleaved lock mode in MySQL
        8.0 reflects the change from statement-based
        replication to row based replication as the default replication
        type. Statement-based replication requires the consecutive
        auto-increment lock mode to ensure that auto-increment values
        are assigned in a predictable and repeatable order for a given
        sequence of SQL statements, whereas row-based replication is not
        sensitive to the execution order of SQL statements.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="innodb-auto-increment-lock-mode-traditional"></a>
            <code class="literal">innodb_autoinc_lock_mode = 0</code>
            (<span class="quote">“<span class="quote">traditional</span>”</span> lock mode)
          </p><p>
            The traditional lock mode provides the same behavior that
            existed before the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            configuration parameter was introduced in MySQL 5.1. The
            traditional lock mode option is provided for backward
            compatibility, performance testing, and working around
            issues with “mixed-mode inserts”, due to possible
            differences in semantics.
          </p><p>
            In this lock mode, all <span class="quote">“<span class="quote">INSERT-like</span>”</span> statements
            obtain a special table-level <code class="literal">AUTO-INC</code>
            lock for inserts into tables with
            <code class="literal">AUTO_INCREMENT</code> columns. This lock is
            normally held to the end of the statement (not to the end of
            the transaction) to ensure that auto-increment values are
            assigned in a predictable and repeatable order for a given
            sequence of <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>
            statements, and to ensure that auto-increment values
            assigned by any given statement are consecutive.
          </p><p>
            In the case of statement-based replication, this means that
            when an SQL statement is replicated on a slave server, the
            same values are used for the auto-increment column as on the
            master server. The result of execution of multiple
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statements is
            deterministic, and the slave reproduces the same data as on
            the master. If auto-increment values generated by multiple
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statements were
            interleaved, the result of two concurrent
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statements would be
            nondeterministic, and could not reliably be propagated to a
            slave server using statement-based replication.
          </p><p>
            To make this clear, consider an example that uses this
            table:
          </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (
  c1 INT(11) NOT NULL AUTO_INCREMENT,
  c2 VARCHAR(10) DEFAULT NULL,
  PRIMARY KEY (c1)
) ENGINE=InnoDB;
</pre><p>
            Suppose that there are two transactions running, each
            inserting rows into a table with an
            <code class="literal">AUTO_INCREMENT</code> column. One transaction is
            using an
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a> statement that inserts 1000 rows, and
            another is using a simple
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statement that inserts
            one row:
          </p><pre data-lang="sql" class="programlisting">
Tx1: INSERT INTO t1 (c2) SELECT 1000 rows from another table ...
Tx2: INSERT INTO t1 (c2) VALUES ('xxx');
</pre><p>
            <code class="literal">InnoDB</code> cannot tell in advance how many
            rows are retrieved from the
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> in the
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statement in Tx1, and
            it assigns the auto-increment values one at a time as the
            statement proceeds. With a table-level lock, held to the end
            of the statement, only one
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statement referring to
            table <code class="literal">t1</code> can execute at a time, and the
            generation of auto-increment numbers by different statements
            is not interleaved. The auto-increment value generated by
            the Tx1
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a> statement are consecutive, and the (single)
            auto-increment value used by the
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statement in Tx2 are
            either smaller or larger than all those used for Tx1,
            depending on which statement executes first.
          </p><p>
            As long as the SQL statements execute in the same order when
            replayed from the binary log (when using statement-based
            replication, or in recovery scenarios), the results are the
            same as they were when Tx1 and Tx2 first ran. Thus,
            table-level locks held until the end of a statement make
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statements using
            auto-increment safe for use with statement-based
            replication. However, those table-level locks limit
            concurrency and scalability when multiple transactions are
            executing insert statements at the same time.
          </p><p>
            In the preceding example, if there were no table-level lock,
            the value of the auto-increment column used for the
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> in Tx2 depends on
            precisely when the statement executes. If the
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> of Tx2 executes while
            the <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> of Tx1 is running
            (rather than before it starts or after it completes), the
            specific auto-increment values assigned by the two
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statements are
            nondeterministic, and may vary from run to run.
          </p><p>
            Under the
            <a class="link" href="innodb-storage-engine.html#innodb-auto-increment-lock-mode-consecutive">consecutive</a>
            lock mode, <code class="literal">InnoDB</code> can avoid using
            table-level <code class="literal">AUTO-INC</code> locks for
            <span class="quote">“<span class="quote">simple insert</span>”</span> statements where the number of
            rows is known in advance, and still preserve deterministic
            execution and safety for statement-based replication.
          </p><p>
            If you are not using the binary log to replay SQL statements
            as part of recovery or replication, the
            <a class="link" href="innodb-storage-engine.html#innodb-auto-increment-lock-mode-interleaved">interleaved</a>
            lock mode can be used to eliminate all use of table-level
            <code class="literal">AUTO-INC</code> locks for even greater
            concurrency and performance, at the cost of permitting gaps
            in auto-increment numbers assigned by a statement and
            potentially having the numbers assigned by concurrently
            executing statements interleaved.
          </p></li><li class="listitem"><p><a name="innodb-auto-increment-lock-mode-consecutive"></a>
            <code class="literal">innodb_autoinc_lock_mode = 1</code>
            (<span class="quote">“<span class="quote">consecutive</span>”</span> lock mode)
          </p><p>
            In this mode, <span class="quote">“<span class="quote">bulk inserts</span>”</span> use the special
            <code class="literal">AUTO-INC</code> table-level lock and hold it
            until the end of the statement. This applies to all
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>,
            <a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE Syntax"><code class="literal">REPLACE ...
            SELECT</code></a>, and <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD
            DATA</code></a> statements. Only one statement holding the
            <code class="literal">AUTO-INC</code> lock can execute at a time. If
            the source table of the bulk insert operation is different
            from the target table, the <code class="literal">AUTO-INC</code> lock
            on the target table is taken after a shared lock is taken on
            the first row selected from the source table. If the source
            and target of the bulk insert operation are the same table,
            the <code class="literal">AUTO-INC</code> lock is taken after shared
            locks are taken on all selected rows.
          </p><p>
            <span class="quote">“<span class="quote">Simple inserts</span>”</span> (for which the number of rows
            to be inserted is known in advance) avoid table-level
            <code class="literal">AUTO-INC</code> locks by obtaining the required
            number of auto-increment values under the control of a mutex
            (a light-weight lock) that is only held for the duration of
            the allocation process, <span class="emphasis"><em>not</em></span> until the
            statement completes. No table-level
            <code class="literal">AUTO-INC</code> lock is used unless an
            <code class="literal">AUTO-INC</code> lock is held by another
            transaction. If another transaction holds an
            <code class="literal">AUTO-INC</code> lock, a <span class="quote">“<span class="quote">simple
            insert</span>”</span> waits for the <code class="literal">AUTO-INC</code>
            lock, as if it were a <span class="quote">“<span class="quote">bulk insert</span>”</span>.
          </p><p>
            This lock mode ensures that, in the presence of
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statements where the
            number of rows is not known in advance (and where
            auto-increment numbers are assigned as the statement
            progresses), all auto-increment values assigned by any
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statement are consecutive, and operations are safe for
            statement-based replication.
          </p><p>
            Simply put, this lock mode significantly improves
            scalability while being safe for use with statement-based
            replication. Further, as with <span class="quote">“<span class="quote">traditional</span>”</span>
            lock mode, auto-increment numbers assigned by any given
            statement are <span class="emphasis"><em>consecutive</em></span>. There is
            <span class="emphasis"><em>no change</em></span> in semantics compared to
            <span class="quote">“<span class="quote">traditional</span>”</span> mode for any statement that uses
            auto-increment, with one important exception.
          </p><p>
            The exception is for <span class="quote">“<span class="quote">mixed-mode inserts</span>”</span>,
            where the user provides explicit values for an
            <code class="literal">AUTO_INCREMENT</code> column for some, but not
            all, rows in a multiple-row <span class="quote">“<span class="quote">simple insert</span>”</span>.
            For such inserts, <code class="literal">InnoDB</code> allocates more
            auto-increment values than the number of rows to be
            inserted. However, all values automatically assigned are
            consecutively generated (and thus higher than) the
            auto-increment value generated by the most recently executed
            previous statement. <span class="quote">“<span class="quote">Excess</span>”</span> numbers are lost.
          </p></li><li class="listitem"><p><a name="innodb-auto-increment-lock-mode-interleaved"></a>
            <code class="literal">innodb_autoinc_lock_mode = 2</code>
            (<span class="quote">“<span class="quote">interleaved</span>”</span> lock mode)
          </p><p>
            In this lock mode, no
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements use the table-level <code class="literal">AUTO-INC</code>
            lock, and multiple statements can execute at the same time.
            This is the fastest and most scalable lock mode, but it is
            <span class="emphasis"><em>not safe</em></span> when using statement-based
            replication or recovery scenarios when SQL statements are
            replayed from the binary log.
          </p><p>
            In this lock mode, auto-increment values are guaranteed to
            be unique and monotonically increasing across all
            concurrently executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements. However, because multiple statements can be
            generating numbers at the same time (that is, allocation of
            numbers is <span class="emphasis"><em>interleaved</em></span> across
            statements), the values generated for the rows inserted by
            any given statement may not be consecutive.
          </p><p>
            If the only statements executing are <span class="quote">“<span class="quote">simple
            inserts</span>”</span> where the number of rows to be inserted is
            known ahead of time, there are no gaps in the numbers
            generated for a single statement, except for
            <span class="quote">“<span class="quote">mixed-mode inserts</span>”</span>. However, when <span class="quote">“<span class="quote">bulk
            inserts</span>”</span> are executed, there may be gaps in the
            auto-increment values assigned by any given statement.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-auto-increment-lock-mode-usage-implications"></a>InnoDB AUTO_INCREMENT Lock Mode Usage Implications</h5>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Using auto-increment with replication
          </p><p>
            If you are using statement-based replication, set
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a> to
            0 or 1 and use the same value on the master and its slaves.
            Auto-increment values are not ensured to be the same on the
            slaves as on the master if you use
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a> =
            2 (<span class="quote">“<span class="quote">interleaved</span>”</span>) or configurations where the
            master and slaves do not use the same lock mode.
          </p><p>
            If you are using row-based or mixed-format replication, all
            of the auto-increment lock modes are safe, since row-based
            replication is not sensitive to the order of execution of
            the SQL statements (and the mixed format uses row-based
            replication for any statements that are unsafe for
            statement-based replication).
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Lost</span>”</span> auto-increment values and sequence gaps
          </p><p>
            In all lock modes (0, 1, and 2), if a transaction that
            generated auto-increment values rolls back, those
            auto-increment values are <span class="quote">“<span class="quote">lost</span>”</span>. Once a value
            is generated for an auto-increment column, it cannot be
            rolled back, whether or not the
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statement is completed, and whether or not the containing
            transaction is rolled back. Such lost values are not reused.
            Thus, there may be gaps in the values stored in an
            <code class="literal">AUTO_INCREMENT</code> column of a table.
          </p></li><li class="listitem"><p>
            Specifying NULL or 0 for the
            <code class="literal">AUTO_INCREMENT</code> column
          </p><p>
            In all lock modes (0, 1, and 2), if a user specifies NULL or
            0 for the <code class="literal">AUTO_INCREMENT</code> column in an
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
            <code class="literal">InnoDB</code> treats the row as if the value was
            not specified and generates a new value for it.
          </p></li><li class="listitem"><p>
            Assigning a negative value to the
            <code class="literal">AUTO_INCREMENT</code> column
          </p><p>
            In all lock modes (0, 1, and 2), the behavior of the
            auto-increment mechanism is not defined if you assign a
            negative value to the <code class="literal">AUTO_INCREMENT</code>
            column.
          </p></li><li class="listitem"><p>
            If the <code class="literal">AUTO_INCREMENT</code> value becomes
            larger than the maximum integer for the specified integer
            type
          </p><p>
            In all lock modes (0, 1, and 2), the behavior of the
            auto-increment mechanism is not defined if the value becomes
            larger than the maximum integer that can be stored in the
            specified integer type.
          </p></li><li class="listitem"><p>
            Gaps in auto-increment values for <span class="quote">“<span class="quote">bulk
            inserts</span>”</span>
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 0 (<span class="quote">“<span class="quote">traditional</span>”</span>) or 1
            (<span class="quote">“<span class="quote">consecutive</span>”</span>), the auto-increment values
            generated by any given statement are consecutive, without
            gaps, because the table-level <code class="literal">AUTO-INC</code>
            lock is held until the end of the statement, and only one
            such statement can execute at a time.
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 2 (<span class="quote">“<span class="quote">interleaved</span>”</span>), there may be gaps in
            the auto-increment values generated by <span class="quote">“<span class="quote">bulk
            inserts,</span>”</span> but only if there are concurrently
            executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements.
          </p><p>
            For lock modes 1 or 2, gaps may occur between successive
            statements because for bulk inserts the exact number of
            auto-increment values required by each statement may not be
            known and overestimation is possible.
          </p></li><li class="listitem"><p>
            Auto-increment values assigned by <span class="quote">“<span class="quote">mixed-mode
            inserts</span>”</span>
          </p><p>
            Consider a <span class="quote">“<span class="quote">mixed-mode insert,</span>”</span> where a
            <span class="quote">“<span class="quote">simple insert</span>”</span> specifies the auto-increment
            value for some (but not all) resulting rows. Such a
            statement behaves differently in lock modes 0, 1, and 2. For
            example, assume <code class="literal">c1</code> is an
            <code class="literal">AUTO_INCREMENT</code> column of table
            <code class="literal">t1</code>, and that the most recent
            automatically generated sequence number is 100.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (</code></strong>
    -&gt; <strong class="userinput"><code>c1 INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY, </code></strong>
    -&gt; <strong class="userinput"><code>c2 CHAR(1)</code></strong>
    -&gt; <strong class="userinput"><code>) ENGINE = INNODB;</code></strong>
</pre><p>
            Now, consider the following <span class="quote">“<span class="quote">mixed-mode insert</span>”</span>
            statement:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');</code></strong>
</pre><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 0 (<span class="quote">“<span class="quote">traditional</span>”</span>), the four new rows
            are:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT c1, c2 FROM t1 ORDER BY c2;</code></strong>
+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
| 101 | b    |
|   5 | c    |
| 102 | d    |
+-----+------+
</pre><p>
            The next available auto-increment value is 103 because the
            auto-increment values are allocated one at a time, not all
            at once at the beginning of statement execution. This result
            is true whether or not there are concurrently executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements (of any type).
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 1 (<span class="quote">“<span class="quote">consecutive</span>”</span>), the four new rows are
            also:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT c1, c2 FROM t1 ORDER BY c2;</code></strong>
+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
| 101 | b    |
|   5 | c    |
| 102 | d    |
+-----+------+
</pre><p>
            However, in this case, the next available auto-increment
            value is 105, not 103 because four auto-increment values are
            allocated at the time the statement is processed, but only
            two are used. This result is true whether or not there are
            concurrently executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements (of any type).
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to mode 2 (<span class="quote">“<span class="quote">interleaved</span>”</span>), the four new
            rows are:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT c1, c2 FROM t1 ORDER BY c2;</code></strong>
+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
|   <em class="replaceable"><code>x</code></em> | b    |
|   5 | c    |
|   <em class="replaceable"><code>y</code></em> | d    |
+-----+------+
</pre><p>
            The values of <em class="replaceable"><code>x</code></em> and
            <em class="replaceable"><code>y</code></em> are unique and larger than any
            previously generated rows. However, the specific values of
            <em class="replaceable"><code>x</code></em> and
            <em class="replaceable"><code>y</code></em> depend on the number of
            auto-increment values generated by concurrently executing
            statements.
          </p><p>
            Finally, consider the following statement, issued when the
            most-recently generated sequence number is 100:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (101,'c'), (NULL,'d');</code></strong>
</pre><p>
            With any
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            setting, this statement generates a duplicate-key error
            23000 (<code class="literal">Can't write; duplicate key in
            table</code>) because 101 is allocated for the row
            <code class="literal">(NULL, 'b')</code> and insertion of the row
            <code class="literal">(101, 'c')</code> fails.
          </p></li><li class="listitem"><p>
            Modifying <code class="literal">AUTO_INCREMENT</code> column values in
            the middle of a sequence of
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statements
          </p><p>
            In MySQL 5.7 and earlier, modifying an
            <code class="literal">AUTO_INCREMENT</code> column value in the middle
            of a sequence of <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>
            statements could lead to <span class="quote">“<span class="quote">Duplicate entry</span>”</span>
            errors. For example, if you performed an
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> operation that changed
            an <code class="literal">AUTO_INCREMENT</code> column value to a value
            larger than the current maximum auto-increment value,
            subsequent <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> operations
            that did not specify an unused auto-increment value could
            encounter <span class="quote">“<span class="quote">Duplicate entry</span>”</span> errors. In MySQL
            8.0 and later, if you modify an
            <code class="literal">AUTO_INCREMENT</code> column value to a value
            larger than the current maximum auto-increment value, the
            new value is persisted, and subsequent
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> operations allocate
            auto-increment values starting from the new, larger value.
            This behavior is demonstrated in the following example.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (</code></strong>
    -&gt; <strong class="userinput"><code>c1 INT NOT NULL AUTO_INCREMENT,</code></strong>
    -&gt; <strong class="userinput"><code>PRIMARY KEY (c1)</code></strong>
    -&gt;  <strong class="userinput"><code>) ENGINE = InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>INSERT INTO t1 VALUES(0), (0), (3);</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT c1 FROM t1;</code></strong>
+----+
| c1 |
+----+
|  1 |
|  2 |
|  3 |
+----+

mysql&gt; <strong class="userinput"><code>UPDATE t1 SET c1 = 4 WHERE c1 = 1;</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT c1 FROM t1;</code></strong>
+----+
| c1 |
+----+
|  2 |
|  3 |
|  4 |
+----+

mysql&gt; <strong class="userinput"><code>INSERT INTO t1 VALUES(0);</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT c1 FROM t1;</code></strong>
+----+
| c1 |
+----+
|  2 |
|  3 |
|  4 |
|  5 |
+----+ 
</pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-auto-increment-initialization"></a>InnoDB AUTO_INCREMENT Counter Initialization</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091651941296"></a><p>
        This section describes how <code class="literal">InnoDB</code> initializes
        <code class="literal">AUTO_INCREMENT</code> counters.
      </p><p>
        If you specify an <code class="literal">AUTO_INCREMENT</code> column for
        an <code class="literal">InnoDB</code> table, the in-memory table object
        contains a special counter called the auto-increment counter
        that is used when assigning new values for the column.
      </p><p>
        In MySQL 5.7 and earlier, the auto-increment counter is stored
        only in main memory, not on disk. To initialize an
        auto-increment counter after a server restart,
        <code class="literal">InnoDB</code> would execute the equivalent of the
        following statement on the first insert into a table containing
        an <code class="literal">AUTO_INCREMENT</code> column.
      </p><pre data-lang="sql" class="programlisting">
SELECT MAX(ai_col) FROM <em class="replaceable"><code>table_name</code></em> FOR UPDATE;
</pre><p>
        In MySQL 8.0, this behavior is changed. The current maximum
        auto-increment counter value is written to the redo log each
        time it changes and is saved to an engine-private system table
        on each checkpoint. These changes make the current maximum
        auto-increment counter value persistent across server restarts.
      </p><p>
        On a server restart following a normal shutdown,
        <code class="literal">InnoDB</code> initializes the in-memory
        auto-increment counter using the current maximum auto-increment
        value stored in the data dictionary system table.
      </p><p>
        On a server restart during crash recovery,
        <code class="literal">InnoDB</code> initializes the in-memory
        auto-increment counter using the current maximum auto-increment
        value stored in the data dictionary system table and scans the
        redo log for auto-increment counter values written since the
        last checkpoint. If a redo-logged value is greater than the
        in-memory counter value, the redo-logged value is applied.
        However, in the case of a server crash, reuse of a previously
        allocated auto-increment value cannot be guaranteed. Each time
        the current maximum auto-increment value is changed due to an
        <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> or
        <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> operation, the new value
        is written to the redo log, but if the crash occurs before the
        redo log is flushed to disk, the previously allocated value
        could be reused when the auto-increment counter is initialized
        after the server is restarted.
      </p><p>
        The only circumstance in which <code class="literal">InnoDB</code> uses
        the equivalent of a <code class="literal">SELECT MAX(ai_col) FROM
        <em class="replaceable"><code>table_name</code></em> FOR UPDATE</code>
        statement in MySQL 8.0 and later to initialize an auto-increment
        counter is when <a class="link" href="innodb-storage-engine.html#tablespace-copying" title="15.6.3.7 Copying Tablespaces to Another Instance">importing a
        tablespace</a> without a <code class="filename">.cfg</code> metadata
        file. Otherwise, the current maximum auto-increment counter
        value is read from the <code class="filename">.cfg</code> metadata file.
      </p><p>
        In MySQL 5.7 and earlier, a server restart cancels the effect of
        the <code class="literal">AUTO_INCREMENT = N</code> table option, which
        may be used in a <code class="literal">CREATE TABLE</code> or
        <code class="literal">ALTER TABLE</code> statement to set an initial
        counter value or alter the existing counter value, respectively.
        In MySQL 8.0, a server restart does not cancel the effect of the
        <code class="literal">AUTO_INCREMENT = N</code> table option. If you
        initialize the auto-increment counter to a specific value, or if
        you alter the auto-increment counter value to a larger value,
        the new value is persisted across server restarts.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          AUTO_INCREMENT = N</code></a> can only change the
          auto-increment counter value to a value larger than the
          current maximum.
</p>
</div>
<p>
        In MySQL 5.7 and earlier, a server restart immediately following
        a <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        operation could result in the reuse of auto-increment values
        that were previously allocated to the rolled-back transaction,
        effectively rolling back the current maximum auto-increment
        value. In MySQL 8.0, the current maximum auto-increment value is
        persisted, preventing the reuse of previously allocated values.
      </p><p>
        If a <a class="link" href="sql-syntax.html#show-table-status" title="13.7.6.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> statement
        examines a table before the auto-increment counter is
        initialized, <code class="literal">InnoDB</code> opens the table and
        initializes the counter value using the current maximum
        auto-increment value that is stored in the data dictionary
        system table. The value is stored in memory for use by later
        inserts or updates. Initialization of the counter value uses a
        normal exclusive-locking read on the table which lasts to the
        end of the transaction. <code class="literal">InnoDB</code> follows the
        same procedure when initializing the auto-increment counter for
        a newly created table that has a user-specified auto-increment
        value that is greater than 0.
      </p><p>
        After the auto-increment counter is initialized, if you do not
        explicitly specify an auto-increment value when inserting a row,
        <code class="literal">InnoDB</code> implicitly increments the counter and
        assigns the new value to the column. If you insert a row that
        explicitly specifies an auto-increment column value, and the
        value is greater than the current maximum counter value, the
        counter is set to the specified value.
      </p><p>
        <code class="literal">InnoDB</code> uses the in-memory auto-increment
        counter as long as the server runs. When the server is stopped
        and restarted, <code class="literal">InnoDB</code> reinitializes the
        auto-increment counter, as described earlier.
      </p><p>
        The <a class="link" href="replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a>
        configuration option determines the starting point for the
        <code class="literal">AUTO_INCREMENT</code> column value. The default
        setting is 1.
      </p><p>
        The <a class="link" href="replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a>
        configuration option controls the interval between successive
        column values. The default setting is 1.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-foreign-key-constraints"></a>15.6.1.5 InnoDB and FOREIGN KEY Constraints</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091651900432"></a><a class="indexterm" name="idm140091651898944"></a><a class="indexterm" name="idm140091651897456"></a><p>
      How the <code class="literal">InnoDB</code> storage engine handles foreign
      key constraints is described under the following topics in this
      section:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-foreign-key-definitions" title="Foreign Key Definitions">Foreign Key Definitions</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-foreign-key-referential-actions" title="Referential Actions">Referential Actions</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-foreign-key-generated-columns" title="Foreign Key Restrictions for Generated Columns and Virtual Indexes">Foreign Key Restrictions for Generated Columns and Virtual Indexes</a></p></li></ul>
</div>
<p>
      For foreign key usage information and examples, see
      <a class="xref" href="sql-syntax.html#create-table-foreign-keys" title="13.1.20.6 Using FOREIGN KEY Constraints">Section 13.1.20.6, “Using FOREIGN KEY Constraints”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-foreign-key-definitions"></a>Foreign Key Definitions</h5>
</div>
</div>
</div>
<p>
        Foreign key definitions for <code class="literal">InnoDB</code> tables are
        subject to the following conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">InnoDB</code> permits a foreign key to reference
            any index column or group of columns. However, in the
            referenced table, there must be an index where the
            referenced columns are the <span class="emphasis"><em>first</em></span>
            columns in the same order. Hidden columns that
            <code class="literal">InnoDB</code> adds to an index are also
            considered (see <a class="xref" href="innodb-storage-engine.html#innodb-index-types" title="15.6.2.1 Clustered and Secondary Indexes">Section 15.6.2.1, “Clustered and Secondary Indexes”</a>).
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html" title="Chapter 15 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> does not currently
            support foreign keys for tables with user-defined
            partitioning. This means that no user-partitioned
            <code class="literal">InnoDB</code> table may contain foreign key
            references or columns referenced by foreign keys.
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> allows a foreign key constraint to
            reference a nonunique key. <span class="emphasis"><em>This is an
            <code class="literal">InnoDB</code> extension to standard
            SQL.</em></span>
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-foreign-key-referential-actions"></a>Referential Actions</h5>

</div>

</div>

</div>
<p>
        Referential actions for foreign keys of
        <code class="literal">InnoDB</code> tables are subject to the following
        conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            While <code class="literal">SET DEFAULT</code> is allowed by the MySQL
            Server, it is rejected as invalid by
            <code class="literal">InnoDB</code>. <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE
            TABLE</code></a> and <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
            TABLE</code></a> statements using this clause are not allowed
            for InnoDB tables.
          </p></li><li class="listitem"><p>
            If there are several rows in the parent table that have the
            same referenced key value, <code class="literal">InnoDB</code> acts in
            foreign key checks as if the other parent rows with the same
            key value do not exist. For example, if you have defined a
            <code class="literal">RESTRICT</code> type constraint, and there is a
            child row with several parent rows,
            <code class="literal">InnoDB</code> does not permit the deletion of
            any of those parent rows.
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> performs cascading operations
            through a depth-first algorithm, based on records in the
            indexes corresponding to the foreign key constraints.
          </p></li><li class="listitem"><p>
            If <code class="literal">ON UPDATE CASCADE</code> or <code class="literal">ON
            UPDATE SET NULL</code> recurses to update the
            <span class="emphasis"><em>same table</em></span> it has previously updated
            during the cascade, it acts like
            <code class="literal">RESTRICT</code>. This means that you cannot use
            self-referential <code class="literal">ON UPDATE CASCADE</code> or
            <code class="literal">ON UPDATE SET NULL</code> operations. This is to
            prevent infinite loops resulting from cascaded updates. A
            self-referential <code class="literal">ON DELETE SET NULL</code>, on
            the other hand, is possible, as is a self-referential
            <code class="literal">ON DELETE CASCADE</code>. Cascading operations
            may not be nested more than 15 levels deep.
          </p></li><li class="listitem"><p>
            Like MySQL in general, in an SQL statement that inserts,
            deletes, or updates many rows, <code class="literal">InnoDB</code>
            checks <code class="literal">UNIQUE</code> and <code class="literal">FOREIGN
            KEY</code> constraints row-by-row. When performing
            foreign key checks, <code class="literal">InnoDB</code> sets shared
            row-level locks on child or parent records it has to look
            at. <code class="literal">InnoDB</code> checks foreign key constraints
            immediately; the check is not deferred to transaction
            commit. According to the SQL standard, the default behavior
            should be deferred checking. That is, constraints are only
            checked after the <span class="emphasis"><em>entire SQL statement</em></span>
            has been processed. Until <code class="literal">InnoDB</code>
            implements deferred constraint checking, some things are
            impossible, such as deleting a record that refers to itself
            using a foreign key.
</p></li></ul>
</div>

</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-foreign-key-generated-columns"></a>Foreign Key Restrictions for Generated Columns and Virtual Indexes</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091651851120"></a><a class="indexterm" name="idm140091651849632"></a><a class="indexterm" name="idm140091651848144"></a><a class="indexterm" name="idm140091651846688"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A foreign key constraint on a stored generated column cannot
            use <code class="literal">CASCADE</code>, <code class="literal">SET NULL</code>,
            or <code class="literal">SET DEFAULT</code> as <code class="literal">ON
            UPDATE</code> referential actions, nor can it use
            <code class="literal">SET NULL</code> or <code class="literal">SET
            DEFAULT</code> as <code class="literal">ON DELETE</code>
            referential actions.
          </p></li><li class="listitem"><p>
            A foreign key constraint on the base column of a stored
            generated column cannot use <code class="literal">CASCADE</code>,
            <code class="literal">SET NULL</code>, or <code class="literal">SET
            DEFAULT</code> as <code class="literal">ON UPDATE</code> or
            <code class="literal">ON DELETE</code> referential actions.
          </p></li><li class="listitem"><p>
            A foreign key constraint cannot reference a
            <a class="link" href="glossary.html#glos_virtual_generated_column" title="virtual generated column">virtual
            generated column</a>.
          </p></li><li class="listitem"><p>
            Prior to MySQL 8.0, a foreign key constraint cannot
            reference a secondary index defined on a virtual generated
            column.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-restrictions"></a>15.6.1.6 Limits on InnoDB Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091651830304"></a><a class="indexterm" name="idm140091651828816"></a><a class="indexterm" name="idm140091651827328"></a><a class="indexterm" name="idm140091651825840"></a><a class="indexterm" name="idm140091651824336"></a><p>
      Limits on <code class="literal">InnoDB</code> tables are described under the
      following topics in this section:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-maximums-minimums" title="Maximums and Minimums">Maximums and Minimums</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-table-restrictions" title="Restrictions on InnoDB Tables">Restrictions on InnoDB Tables</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-locking-transactions" title="Locking and Transactions">Locking and Transactions</a></p></li></ul>
</div>

<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
        Before using NFS with <code class="literal">InnoDB</code>, review
        potential issues outlined in <a class="xref" href="optimization.html#disk-issues-nfs" title="Using NFS with MySQL">Using NFS with MySQL</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-maximums-minimums"></a>Maximums and Minimums</h5>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A table can contain a maximum of 1017 columns. Virtual
            generated columns are included in this limit.
          </p></li><li class="listitem"><p>
            A table can contain a maximum of 64
            <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
            indexes</a>.
          </p></li><li class="listitem"><p>
            The index key prefix length limit is 3072 bytes for
            <code class="literal">InnoDB</code> tables that use
            <code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a></code>
            or
            <code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a></code>
            row format.
          </p><p>
            The index key prefix length limit is 767 bytes for
            <code class="literal">InnoDB</code> tables that use
            <code class="literal"><a class="link" href="glossary.html#glos_redundant_row_format" title="redundant row format">REDUNDANT</a></code>
            or
            <code class="literal"><a class="link" href="glossary.html#glos_compact_row_format" title="compact row format">COMPACT</a></code>
            row format. For example, you might hit this limit with a
            <a class="link" href="glossary.html#glos_column_prefix" title="column prefix">column prefix</a>
            index of more than 191 characters on a
            <code class="literal">TEXT</code> or <code class="literal">VARCHAR</code>
            column, assuming a <code class="literal">utf8mb4</code> character set
            and the maximum of 4 bytes for each character.
          </p><p>
            Attempting to use an index key prefix length that exceeds
            the limit returns an error.
          </p><p>
            The limits that apply to index key prefixes also apply to
            full-column index keys.
          </p></li><li class="listitem"><p>
            If you reduce the <code class="literal">InnoDB</code>
            <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a> to 8KB or
            4KB by specifying the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> option
            when creating the MySQL instance, the maximum length of the
            index key is lowered proportionally, based on the limit of
            3072 bytes for a 16KB page size. That is, the maximum index
            key length is 1536 bytes when the page size is 8KB, and 768
            bytes when the page size is 4KB.
          </p></li><li class="listitem"><p>
            A maximum of 16 columns is permitted for multicolumn
            indexes. Exceeding the limit returns an error.
          </p><pre data-lang="sql" class="programlisting">
ERROR 1070 (42000): Too many key parts specified; max 16 parts allowed
</pre></li><li class="listitem"><p>
            The maximum row length, except for variable-length columns
            (<a class="link" href="data-types.html#binary-varbinary" title="11.4.2 The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a>,
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
            <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
            <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a>), is slightly less than
            half of a page for 4KB, 8KB, 16KB, and 32KB page sizes. For
            example, the maximum row length for the default
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> of 16KB is
            about 8000 bytes. For an <code class="literal">InnoDB</code> page size
            of 64KB, the maximum row length is about 16000 bytes.
            <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGBLOB</code></a> and
            <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGTEXT</code></a>
            columns must be less than 4GB, and the total row length,
            including <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
            <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, must be less
            than 4GB.
          </p><p>
            If a row is less than half a page long, all of it is stored
            locally within the page. If it exceeds half a page,
            variable-length columns are chosen for external off-page
            storage until the row fits within half a page, as described
            in <a class="xref" href="innodb-storage-engine.html#innodb-file-space" title="15.11.2 File Space Management">Section 15.11.2, “File Space Management”</a>.
          </p></li><li class="listitem"><p>
            Although <code class="literal">InnoDB</code> supports row sizes larger
            than 65,535 bytes internally, MySQL itself imposes a
            row-size limit of 65,535 for the combined size of all
            columns:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t (a VARCHAR(8000), b VARCHAR(10000),</code></strong>
    -&gt; <strong class="userinput"><code>c VARCHAR(10000), d VARCHAR(10000), e VARCHAR(10000),</code></strong>
    -&gt; <strong class="userinput"><code>f VARCHAR(10000), g VARCHAR(10000)) ENGINE=InnoDB;</code></strong>
ERROR 1118 (42000): Row size too large. The maximum row size for the
used table type, not counting BLOBs, is 65535. You have to change some
columns to TEXT or BLOBs
</pre><p>
            See <a class="xref" href="restrictions.html#column-count-limit" title="C.10.4 Limits on Table Column Count and Row Size">Section C.10.4, “Limits on Table Column Count and Row Size”</a>.
          </p></li><li class="listitem"><p>
            On some older operating systems, files must be less than
            2GB. This is not a limitation of <code class="literal">InnoDB</code>
            itself, but if you require a large tablespace, configure it
            using several smaller data files rather than one large data
            file.
          </p></li><li class="listitem"><p>
            The combined size of the <code class="literal">InnoDB</code> log files
            can be up to 512GB.
          </p></li><li class="listitem"><p>
            The minimum tablespace size is slightly larger than 10MB.
            The maximum tablespace size depends on the
            <code class="literal">InnoDB</code> page size.
</p>
<div class="table">
<a name="idm140091651767872"></a><p class="title"><b>Table 15.3 InnoDB Maximum Tablespace Size</b></p>
<div class="table-contents">
<table summary="The maximum tablespace size for each InnoDB page size."><col width="40%"><col width="60%"><thead><tr>
                <th scope="col">InnoDB Page Size</th>
                <th scope="col">Maximum Tablespace Size</th>
              </tr></thead><tbody><tr>
                <td scope="row">4KB</td>
                <td>16TB</td>
              </tr><tr>
                <td scope="row">8KB</td>
                <td>32TB</td>
              </tr><tr>
                <td scope="row">16KB</td>
                <td>64TB</td>
              </tr><tr>
                <td scope="row">32KB</td>
                <td>128TB</td>
              </tr><tr>
                <td scope="row">64KB</td>
                <td>256TB</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
            The maximum tablespace size is also the maximum size for a
            table.
          </p></li><li class="listitem"><p>
            The path of a tablespace file, including the file name,
            cannot exceed the <code class="literal">MAX_PATH</code> limit on
            Windows. Prior to Windows 10, the
            <code class="literal">MAX_PATH</code> limit is 260 characters. As of
            Windows 10, version 1607, <code class="literal">MAX_PATH</code>
            limitations are removed from common Win32 file and directory
            functions, but you must enable the new behavior.
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140091651745392"></a>

            <a class="indexterm" name="idm140091651743904"></a>

            The default page size in <code class="literal">InnoDB</code> is 16KB.
            You can increase or decrease the page size by configuring
            the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> option
            when creating the MySQL instance.
          </p><p>
            32KB and 64KB page sizes are supported, but
            <code class="literal">ROW_FORMAT=COMPRESSED</code> is unsupported for
            page sizes greater than 16KB. For both 32KB and 64KB page
            sizes, the maximum record size is 16KB. For
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size=32KB</code></a>,
            extent size is 2MB. For
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size=64KB</code></a>,
            extent size is 4MB.
          </p><p>
            A MySQL instance using a particular
            <code class="literal">InnoDB</code> page size cannot use data files or
            log files from an instance that uses a different page size.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-table-restrictions"></a>Restrictions on InnoDB Tables</h5>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> determines
            index cardinality (as displayed in the
            <code class="literal">Cardinality</code> column of
            <a class="link" href="sql-syntax.html#show-index" title="13.7.6.22 SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a> output) by
            performing <a class="link" href="glossary.html#glos_random_dive" title="random dive">random
            dives</a> on each of the index trees and updating index
            cardinality estimates accordingly. Because these are only
            estimates, repeated runs of <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
            TABLE</code></a> could produce different numbers. This makes
            <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> fast on
            <code class="literal">InnoDB</code> tables but not 100% accurate
            because it does not take all rows into account.
          </p><p>
            You can make the
            <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> collected
            by <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> more precise
            and more stable by turning on the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
            configuration option, as explained in
            <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="15.8.10.1 Configuring Persistent Optimizer Statistics Parameters">Section 15.8.10.1, “Configuring Persistent Optimizer Statistics Parameters”</a>. When that setting
            is enabled, it is important to run
            <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> after major
            changes to indexed column data, because the statistics are
            not recalculated periodically (such as after a server
            restart).
          </p><p>
            If the persistent statistics setting is enabled, you can
            change the number of random dives by modifying the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
            system variable. If the persistent statistics setting is
            disabled, modify the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
            system variable instead.
          </p><p>
            MySQL uses index cardinality estimates in join optimization.
            If a join is not optimized in the right way, try using
            <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>. In the few
            cases that <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> does
            not produce values good enough for your particular tables,
            you can use <code class="literal">FORCE INDEX</code> with your queries
            to force the use of a particular index, or set the
            <a class="link" href="server-administration.html#sysvar_max_seeks_for_key"><code class="literal">max_seeks_for_key</code></a> system
            variable to ensure that MySQL prefers index lookups over
            table scans. See <a class="xref" href="error-handling.html#optimizer-issues" title="B.4.5 Optimizer-Related Issues">Section B.4.5, “Optimizer-Related Issues”</a>.
          </p></li><li class="listitem"><p>
            If statements or transactions are running on a table, and
            <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> is run on the
            same table followed by a second <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
            TABLE</code></a> operation, the second
            <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> operation is
            blocked until the statements or transactions are completed.
            This behavior occurs because <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
            TABLE</code></a> marks the currently loaded table definition
            as obsolete when <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
            TABLE</code></a> is finished running. New statements or
            transactions (including a second
            <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> statement) must
            load the new table definition into the table cache, which
            cannot occur until currently running statements or
            transactions are completed and the old table definition is
            purged. Loading multiple concurrent table definitions is not
            supported.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#show-table-status" title="13.7.6.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> does not
            give accurate statistics on <code class="literal">InnoDB</code> tables
            except for the physical size reserved by the table. The row
            count is only a rough estimate used in SQL optimization.
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> does not keep an internal count of
            rows in a table because concurrent transactions might
            <span class="quote">“<span class="quote">see</span>”</span> different numbers of rows at the same
            time. Consequently, <code class="literal">SELECT COUNT(*)</code>
            statements only count rows visible to the current
            transaction.
          </p><p>
            For information about how <code class="literal">InnoDB</code>
            processes <code class="literal">SELECT COUNT(*)</code> statements,
            refer to the <a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a>
            description in <a class="xref" href="functions.html#group-by-functions" title="12.20.1 Aggregate (GROUP BY) Function Descriptions">Section 12.20.1, “Aggregate (GROUP BY) Function Descriptions”</a>.
          </p></li><li class="listitem"><p>
            On Windows, <code class="literal">InnoDB</code> always stores database
            and table names internally in lowercase. To move databases
            in a binary format from Unix to Windows or from Windows to
            Unix, create all databases and tables using lowercase names.
          </p></li><li class="listitem"><p>
            An <code class="literal">AUTO_INCREMENT</code> column
            <em class="replaceable"><code>ai_col</code></em> must be defined as part of
            an index such that it is possible to perform the equivalent
            of an indexed <code class="literal">SELECT
            MAX(<em class="replaceable"><code>ai_col</code></em>)</code> lookup on
            the table to obtain the maximum column value. Typically,
            this is achieved by making the column the first column of
            some table index.
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> sets an exclusive lock on the end
            of the index associated with the
            <code class="literal">AUTO_INCREMENT</code> column while initializing
            a previously specified <code class="literal">AUTO_INCREMENT</code>
            column on a table.
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode=0</code></a>,
            <code class="literal">InnoDB</code> uses a special
            <code class="literal">AUTO-INC</code> table lock mode where the lock
            is obtained and held to the end of the current SQL statement
            while accessing the auto-increment counter. Other clients
            cannot insert into the table while the
            <code class="literal">AUTO-INC</code> table lock is held. The same
            behavior occurs for <span class="quote">“<span class="quote">bulk inserts</span>”</span> with
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode=1</code></a>.
            Table-level <code class="literal">AUTO-INC</code> locks are not used
            with
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode=2</code></a>.
            For more information, See
            <a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-handling" title="15.6.1.4 AUTO_INCREMENT Handling in InnoDB">Section 15.6.1.4, “AUTO_INCREMENT Handling in InnoDB”</a>.
          </p></li><li class="listitem"><p>
            When an <code class="literal">AUTO_INCREMENT</code> integer column
            runs out of values, a subsequent <code class="literal">INSERT</code>
            operation returns a duplicate-key error. This is general
            MySQL behavior.
          </p></li><li class="listitem"><p>
            <code class="literal">DELETE FROM
            <em class="replaceable"><code>tbl_name</code></em></code> does not
            regenerate the table but instead deletes all rows, one by
            one.
          </p></li><li class="listitem"><p>
            Cascaded foreign key actions do not activate triggers.
          </p></li><li class="listitem"><p>
            You cannot create a table with a column name that matches
            the name of an internal <code class="literal">InnoDB</code> column
            (including <code class="literal">DB_ROW_ID</code>,
            <code class="literal">DB_TRX_ID</code>,
            <code class="literal">DB_ROLL_PTR</code>, and
            <code class="literal">DB_MIX_ID</code>). This restriction applies to
            use of the names in any letter case.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (c1 INT, db_row_id INT) ENGINE=INNODB;</code></strong>
ERROR 1166 (42000): Incorrect column name 'db_row_id'
</pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-locking-transactions"></a>Locking and Transactions</h5>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> acquires two
            locks on each table if
            <code class="literal">innodb_table_locks=1</code> (the default). In
            addition to a table lock on the MySQL layer, it also
            acquires an <code class="literal">InnoDB</code> table lock. Versions
            of MySQL before 4.1.2 did not acquire
            <code class="literal">InnoDB</code> table locks; the old behavior can
            be selected by setting
            <code class="literal">innodb_table_locks=0</code>. If no
            <code class="literal">InnoDB</code> table lock is acquired,
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> completes even if
            some records of the tables are being locked by other
            transactions.
          </p><p>
            In MySQL 8.0,
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks=0</code></a> has no
            effect for tables locked explicitly with
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
            WRITE</code></a>. It does have an effect for tables locked
            for read or write by
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
            WRITE</code></a> implicitly (for example, through triggers)
            or by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
            TABLES ... READ</code></a>.
          </p></li><li class="listitem"><p>
            All <code class="literal">InnoDB</code> locks held by a transaction
            are released when the transaction is committed or aborted.
            Thus, it does not make much sense to invoke
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> on
            <code class="literal">InnoDB</code> tables in
            <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit=1</code></a> mode because
            the acquired <code class="literal">InnoDB</code> table locks would be
            released immediately.
          </p></li><li class="listitem"><p>
            You cannot lock additional tables in the middle of a
            transaction because <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
            TABLES</code></a> performs an implicit
            <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a>.
          </p></li><li class="listitem"><p>
            For limits associated with concurrent read-write
            transactions, see <a class="xref" href="innodb-storage-engine.html#innodb-undo-logs" title="15.6.6 Undo Logs">Section 15.6.6, “Undo Logs”</a>.
</p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-indexes"></a>15.6.2 Indexes</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-index-types">15.6.2.1 Clustered and Secondary Indexes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-physical-structure">15.6.2.2 The Physical Structure of an InnoDB Index</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#sorted-index-builds">15.6.2.3 Sorted Index Builds</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-fulltext-index">15.6.2.4 InnoDB FULLTEXT Indexes</a></span></dt></dl>
</div>
<p>
    This section covers topics related to <code class="literal">InnoDB</code>
    indexes.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-index-types"></a>15.6.2.1 Clustered and Secondary Indexes</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091651632032"></a><a class="indexterm" name="idm140091651630576"></a><a class="indexterm" name="idm140091651629088"></a><a class="indexterm" name="idm140091651627600"></a><p>
      Every <code class="literal">InnoDB</code> table has a special index called
      the <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
      where the data for the rows is stored. Typically, the clustered
      index is synonymous with the
      <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a>. To get the
      best performance from queries, inserts, and other database
      operations, you must understand how <code class="literal">InnoDB</code> uses
      the clustered index to optimize the most common lookup and DML
      operations for each table.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          When you define a <code class="literal">PRIMARY KEY</code> on your
          table, <code class="literal">InnoDB</code> uses it as the clustered
          index. Define a primary key for each table that you create. If
          there is no logical unique and non-null column or set of
          columns, add a new
          <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
          column, whose values are filled in automatically.
        </p></li><li class="listitem"><p>
          If you do not define a <code class="literal">PRIMARY KEY</code> for your
          table, MySQL locates the first <code class="literal">UNIQUE</code> index
          where all the key columns are <code class="literal">NOT NULL</code> and
          <code class="literal">InnoDB</code> uses it as the clustered index.
        </p></li><li class="listitem"><p>
          If the table has no <code class="literal">PRIMARY KEY</code> or suitable
          <code class="literal">UNIQUE</code> index, <code class="literal">InnoDB</code>
          internally generates a hidden clustered index named
          <code class="literal">GEN_CLUST_INDEX</code> on a synthetic column
          containing row ID values. The rows are ordered by the ID that
          <code class="literal">InnoDB</code> assigns to the rows in such a table.
          The row ID is a 6-byte field that increases monotonically as
          new rows are inserted. Thus, the rows ordered by the row ID
          are physically in insertion order.
</p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-index-types-query-performance"></a>How the Clustered Index Speeds Up Queries</h5>

</div>

</div>

</div>
<p>
        Accessing a row through the clustered index is fast because the
        index search leads directly to the page with all the row data.
        If a table is large, the clustered index architecture often
        saves a disk I/O operation when compared to storage
        organizations that store row data using a different page from
        the index record.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-index-types-secondary-clustered"></a>How Secondary Indexes Relate to the Clustered Index</h5>

</div>

</div>

</div>
<p>
        All indexes other than the clustered index are known as
        <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>.
        In <code class="literal">InnoDB</code>, each record in a secondary index
        contains the primary key columns for the row, as well as the
        columns specified for the secondary index.
        <code class="literal">InnoDB</code> uses this primary key value to search
        for the row in the clustered index.
      </p><p>
        If the primary key is long, the secondary indexes use more
        space, so it is advantageous to have a short primary key.
      </p><p>
        For guidelines to take advantage of <code class="literal">InnoDB</code>
        clustered and secondary indexes, see
        <a class="xref" href="optimization.html#optimization-indexes" title="8.3 Optimization and Indexes">Section 8.3, “Optimization and Indexes”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-physical-structure"></a>15.6.2.2 The Physical Structure of an InnoDB Index</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091651599696"></a><a class="indexterm" name="idm140091651598240"></a><a class="indexterm" name="idm140091651596752"></a><a class="indexterm" name="idm140091651595264"></a><a class="indexterm" name="idm140091651594192"></a><p>
      With the exception of spatial indexes, <code class="literal">InnoDB</code>
      indexes are <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> data
      structures. Spatial indexes use
      <a class="link" href="glossary.html#glos_r_tree" title="R-tree">R-trees</a>, which are specialized
      data structures for indexing multi-dimensional data. Index records
      are stored in the leaf pages of their B-tree or R-tree data
      structure. The default size of an index page is 16KB.
    </p><p>
      When new records are inserted into an <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>,
      <code class="literal">InnoDB</code> tries to leave 1/16 of the page free for
      future insertions and updates of the index records. If index
      records are inserted in a sequential order (ascending or
      descending), the resulting index pages are about 15/16 full. If
      records are inserted in a random order, the pages are from 1/2 to
      15/16 full.
    </p><p>
      <code class="literal">InnoDB</code> performs a bulk load when creating or
      rebuilding B-tree indexes. This method of index creation is known
      as a sorted index build. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a> configuration
      option defines the percentage of space on each B-tree page that is
      filled during a sorted index build, with the remaining space
      reserved for future index growth. Sorted index builds are not
      supported for spatial indexes. For more information, see
      <a class="xref" href="innodb-storage-engine.html#sorted-index-builds" title="15.6.2.3 Sorted Index Builds">Section 15.6.2.3, “Sorted Index Builds”</a>. An
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a> setting of 100
      leaves 1/16 of the space in clustered index pages free for future
      index growth.
    </p><p>
      If the fill factor of an <code class="literal">InnoDB</code> index page
      drops below the <code class="literal">MERGE_THRESHOLD</code>, which is 50%
      by default if not specified, <code class="literal">InnoDB</code> tries to
      contract the index tree to free the page. The
      <code class="literal">MERGE_THRESHOLD</code> setting applies to both B-tree
      and R-tree indexes. For more information, see
      <a class="xref" href="innodb-storage-engine.html#index-page-merge-threshold" title="15.8.11 Configuring the Merge Threshold for Index Pages">Section 15.8.11, “Configuring the Merge Threshold for Index Pages”</a>.
    </p><p>
      You can define the <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>
      for all <code class="literal">InnoDB</code> tablespaces in a MySQL instance
      by setting the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
      configuration option prior to initializing the MySQL instance.
      Once the page size for an instance is defined, you cannot change
      it without reinitializing the instance. Supported sizes are 64KB,
      32KB, 16KB (default), 8KB, and 4KB.
    </p><p>
      A MySQL instance using a particular <code class="literal">InnoDB</code> page
      size cannot use data files or log files from an instance that uses
      a different page size.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sorted-index-builds"></a>15.6.2.3 Sorted Index Builds</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091651571696"></a><a class="indexterm" name="idm140091651570208"></a><p>
      <code class="literal">InnoDB</code> performs a bulk load instead of
      inserting one index record at a time when creating or rebuilding
      indexes. This method of index creation is also known as a sorted
      index build. Sorted index builds are not supported for spatial
      indexes.
    </p><p>
      There are three phases to an index build. In the first phase, the
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a> is
      scanned, and index entries are generated and added to the sort
      buffer. When the <a class="link" href="glossary.html#glos_sort_buffer" title="sort buffer">sort
      buffer</a> becomes full, entries are sorted and written out to
      a temporary intermediate file. This process is also known as a
      <span class="quote">“<span class="quote">run</span>”</span>. In the second phase, with one or more runs
      written to the temporary intermediate file, a merge sort is
      performed on all entries in the file. In the third and final
      phase, the sorted entries are inserted into the
      <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a>.
    </p><p>
      Prior to the introduction of sorted index builds, index entries
      were inserted into the B-tree one record at a time using insert
      APIs. This method involved opening a B-tree
      <a class="link" href="glossary.html#glos_cursor" title="cursor">cursor</a> to find the insert
      position and then inserting entries into a B-tree page using an
      <a class="link" href="glossary.html#glos_optimistic" title="optimistic">optimistic</a> insert. If an
      insert failed due to a page being full, a
      <a class="link" href="glossary.html#glos_pessimistic" title="pessimistic">pessimistic</a> insert would
      be performed, which involves opening a B-tree cursor and splitting
      and merging B-tree nodes as necessary to find space for the entry.
      The drawbacks of this <span class="quote">“<span class="quote">top-down</span>”</span> method of building
      an index are the cost of searching for an insert position and the
      constant splitting and merging of B-tree nodes.
    </p><p>
      Sorted index builds use a <span class="quote">“<span class="quote">bottom-up</span>”</span> approach to
      building an index. With this approach, a reference to the
      right-most leaf page is held at all levels of the B-tree. The
      right-most leaf page at the necessary B-tree depth is allocated
      and entries are inserted according to their sorted order. Once a
      leaf page is full, a node pointer is appended to the parent page
      and a sibling leaf page is allocated for the next insert. This
      process continues until all entries are inserted, which may result
      in inserts up to the root level. When a sibling page is allocated,
      the reference to the previously pinned leaf page is released, and
      the newly allocated leaf page becomes the right-most leaf page and
      new default insert location.
</p>
<h5><a name="idm140091651557232"></a>Reserving B-tree Page Space for Future Index Growth</h5>
<p>
      To set aside space for future index growth, you can use the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a> configuration
      option to reserve a percentage of B-tree page space. For example,
      setting <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a> to 80
      reserves 20 percent of the space in B-tree pages during a sorted
      index build. This setting applies to both B-tree leaf and non-leaf
      pages. It does not apply to external pages used for
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> or
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> entries. The amount of space
      that is reserved may not be exactly as configured, as the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a> value is
      interpreted as a hint rather than a hard limit.
</p>
<h5><a name="idm140091651549296"></a>Sorted Index Builds and Full-Text Index Support</h5>
<p>
      Sorted index builds are supported for
      <a class="link" href="glossary.html#glos_fulltext_index" title="FULLTEXT index">fulltext indexes</a>.
      Previously, SQL was used to insert entries into a fulltext index.
</p>
<h5><a name="idm140091651547136"></a>Sorted Index Builds and Compressed Tables</h5>
<p>
      For <a class="link" href="glossary.html#glos_compression" title="compression">compressed tables</a>, the
      previous index creation method appended entries to both compressed
      and uncompressed pages. When the modification log (representing
      free space on the compressed page) became full, the compressed
      page would be recompressed. If compression failed due to a lack of
      space, the page would be split. With sorted index builds, entries
      are only appended to uncompressed pages. When an uncompressed page
      becomes full, it is compressed. Adaptive padding is used to ensure
      that compression succeeds in most cases, but if compression fails,
      the page is split and compression is attempted again. This process
      continues until compression is successful. For more information
      about compression of B-Tree pages, see
      <a class="xref" href="innodb-storage-engine.html#innodb-compression-internals" title="15.9.1.5 How Compression Works for InnoDB Tables">Section 15.9.1.5, “How Compression Works for InnoDB Tables”</a>.
</p>
<h5><a name="idm140091651543616"></a>Sorted Index Builds and Redo Logging</h5>
<p>
      <a class="link" href="glossary.html#glos_redo_log" title="redo log">Redo logging</a> is disabled
      during a sorted index build. Instead, there is a
      <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpoint</a> to ensure that
      the index build can withstand a crash or failure. The checkpoint
      forces a write of all dirty pages to disk. During a sorted index
      build, the <a class="link" href="glossary.html#glos_page_cleaner" title="page cleaner">page cleaner</a>
      thread is signaled periodically to flush
      <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> to ensure that
      the checkpoint operation can be processed quickly. Normally, the
      page cleaner thread flushes dirty pages when the number of clean
      pages falls below a set threshold. For sorted index builds, dirty
      pages are flushed promptly to reduce checkpoint overhead and to
      parallelize I/O and CPU activity.
</p>
<h5><a name="idm140091651538464"></a>Sorted Index Builds and Optimizer Statistics</h5>
<p>
      Sorted index builds may result in
      <a class="link" href="glossary.html#glos_optimizer" title="optimizer">optimizer</a> statistics that
      differ from those generated by the previous method of index
      creation. The difference in statistics, which is not expected to
      affect workload performance, is due to the different algorithm
      used to populate the index.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-fulltext-index"></a>15.6.2.4 InnoDB FULLTEXT Indexes</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091651534960"></a><a class="indexterm" name="idm140091651533472"></a><p>
      <code class="literal">FULLTEXT</code> indexes are created on text-based
      columns (<a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a>,
      <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, or
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns) to help speed up
      queries and DML operations on data contained within those columns,
      omitting any words that are defined as stopwords.
    </p><p>
      A <code class="literal">FULLTEXT</code> index is defined as part of a
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement or added to
      an existing table using <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      or <a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>.
    </p><p>
      Full-text search is performed using <a class="link" href="functions.html#function_match"><code class="literal">MATCH()
      ... AGAINST</code></a> syntax. For usage information, see
      <a class="xref" href="functions.html#fulltext-search" title="12.9 Full-Text Search Functions">Section 12.9, “Full-Text Search Functions”</a>.
    </p><p>
      <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> indexes are
      described under the following topics in this section:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index-design" title="InnoDB Full-Text Index Design">InnoDB Full-Text Index Design</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index-tables" title="InnoDB Full-Text Index Tables">InnoDB Full-Text Index Tables</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index-cache" title="InnoDB Full-Text Index Cache">InnoDB Full-Text Index Cache</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index-docid" title="InnoDB Full-Text Index Document ID and FTS_DOC_ID Column">InnoDB Full-Text Index Document ID and FTS_DOC_ID Column</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index-deletion" title="InnoDB Full-Text Index Deletion Handling">InnoDB Full-Text Index Deletion Handling</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index-transaction" title="InnoDB Full-Text Index Transaction Handling">InnoDB Full-Text Index Transaction Handling</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index-monitoring" title="Monitoring InnoDB Full-Text Indexes">Monitoring InnoDB Full-Text Indexes</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-fulltext-index-design"></a>InnoDB Full-Text Index Design</h5>

</div>

</div>

</div>
<p>
        <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> indexes
        have an inverted index design. Inverted indexes store a list of
        words, and for each word, a list of documents that the word
        appears in. To support proximity search, position information
        for each word is also stored, as a byte offset.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-fulltext-index-tables"></a>InnoDB Full-Text Index Tables</h5>

</div>

</div>

</div>
<p>
        When creating an <code class="literal">InnoDB</code>
        <code class="literal">FULLTEXT</code> index, a set of index tables is
        created, as shown in the following example:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE opening_lines (</code></strong>
       <strong class="userinput"><code>id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,</code></strong>
       <strong class="userinput"><code>opening_line TEXT(500),</code></strong>
       <strong class="userinput"><code>author VARCHAR(200),</code></strong>
       <strong class="userinput"><code>title VARCHAR(200),</code></strong>
       <strong class="userinput"><code>FULLTEXT idx (opening_line)</code></strong>
       <strong class="userinput"><code>) ENGINE=InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT table_id, name, space from INFORMATION_SCHEMA.INNODB_TABLES</code></strong>
       <strong class="userinput"><code>WHERE name LIKE 'test/%';</code></strong>
+----------+----------------------------------------------------+-------+
| table_id | name                                               | space |
+----------+----------------------------------------------------+-------+
|      333 | test/fts_0000000000000147_00000000000001c9_index_1 |   289 |
|      334 | test/fts_0000000000000147_00000000000001c9_index_2 |   290 |
|      335 | test/fts_0000000000000147_00000000000001c9_index_3 |   291 |
|      336 | test/fts_0000000000000147_00000000000001c9_index_4 |   292 |
|      337 | test/fts_0000000000000147_00000000000001c9_index_5 |   293 |
|      338 | test/fts_0000000000000147_00000000000001c9_index_6 |   294 |
|      330 | test/fts_0000000000000147_being_deleted            |   286 |
|      331 | test/fts_0000000000000147_being_deleted_cache      |   287 |
|      332 | test/fts_0000000000000147_config                   |   288 |
|      328 | test/fts_0000000000000147_deleted                  |   284 |
|      329 | test/fts_0000000000000147_deleted_cache            |   285 |
|      327 | test/opening_lines                                 |   283 |
+----------+----------------------------------------------------+-------+ 
</pre><p>
        The first six tables represent the inverted index and are
        referred to as auxiliary index tables. When incoming documents
        are tokenized, the individual words (also referred to as
        <span class="quote">“<span class="quote">tokens</span>”</span>) are inserted into the index tables along
        with position information and the associated Document ID
        (<code class="literal">DOC_ID</code>). The words are fully sorted and
        partitioned among the six index tables based on the character
        set sort weight of the word's first character.
      </p><p>
        The inverted index is partitioned into six auxiliary index
        tables to support parallel index creation. By default, two
        threads tokenize, sort, and insert words and associated data
        into the index tables. The number of threads is configurable
        using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_sort_pll_degree"><code class="literal">innodb_ft_sort_pll_degree</code></a>
        option. Consider increasing the number of threads when creating
        <code class="literal">FULLTEXT</code> indexes on large tables.
      </p><p>
        Auxiliary index table names are prefixed with
        <code class="literal">fts_</code> and postfixed with
        <code class="literal">index_*</code>. Each index table is associated with
        the indexed table by a hex value in the index table name that
        matches the <code class="literal">table_id</code> of the indexed table.
        For example, the <code class="literal">table_id</code> of the
        <code class="literal">test/opening_lines</code> table is
        <code class="literal">327</code>, for which the hex value is 0x147. As
        shown in the preceding example, the <span class="quote">“<span class="quote">147</span>”</span> hex value
        appears in the names of index tables that are associated with
        the <code class="literal">test/opening_lines</code> table.
      </p><p>
        A hex value representing the <code class="literal">index_id</code> of the
        <code class="literal">FULLTEXT</code> index also appears in auxiliary
        index table names. For example, in the auxiliary table name
        <code class="literal">test/fts_0000000000000147_00000000000001c9_index_1</code>,
        the hex value <code class="literal">1c9</code> has a decimal value of 457.
        The index defined on the <code class="literal">opening_lines</code> table
        (<code class="literal">idx</code>) can be identified by querying the
        <a class="link" href="information-schema.html#innodb-indexes-table" title="25.39.19 The INFORMATION_SCHEMA INNODB_INDEXES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_INDEXES</code></a>
        table for this value (457).
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT index_id, name, table_id, space from INFORMATION_SCHEMA.INNODB_INDEXES</code></strong>
       <strong class="userinput"><code>WHERE index_id=457;</code></strong>
+----------+------+----------+-------+
| index_id | name | table_id | space |
+----------+------+----------+-------+
|      457 | idx  |      327 |   283 |
+----------+------+----------+-------+
</pre><p>
        Index tables are stored in their own tablespace if the primary
        table is created in a
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespace.
      </p><p>
        The other index tables shown in the preceding example are
        referred to as common index tables and are used for deletion
        handling and storing the internal state of
        <code class="literal">FULLTEXT</code> indexes. Unlike the inverted index
        tables, which are created for each full-text index, this set of
        tables is common to all full-text indexes created on a
        particular table.
      </p><p>
        Common auxiliary tables are retained even if full-text indexes
        are dropped. When a full-text index is dropped, the
        <code class="literal">FTS_DOC_ID</code> column that was created for the
        index is retained, as removing the <code class="literal">FTS_DOC_ID</code>
        column would require rebuilding the table. Common axillary
        tables are required to manage the <code class="literal">FTS_DOC_ID</code>
        column.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">fts_*_deleted</code> and
            <code class="literal">fts_*_deleted_cache</code>
          </p><p>
            Contain the document IDs (DOC_ID) for documents that are
            deleted but whose data is not yet removed from the full-text
            index. The <code class="literal">fts_*_deleted_cache</code> is the
            in-memory version of the <code class="literal">fts_*_deleted</code>
            table.
          </p></li><li class="listitem"><p>
            <code class="literal">fts_*_being_deleted</code> and
            <code class="literal">fts_*_being_deleted_cache</code>
          </p><p>
            Contain the document IDs (DOC_ID) for documents that are
            deleted and whose data is currently in the process of being
            removed from the full-text index. The
            <code class="literal">fts_*_being_deleted_cache</code> table is the
            in-memory version of the
            <code class="literal">fts_*_being_deleted</code> table.
          </p></li><li class="listitem"><p>
            <code class="literal">fts_*_config</code>
          </p><p>
            Stores information about the internal state of the
            <code class="literal">FULLTEXT</code> index. Most importantly, it
            stores the <code class="literal">FTS_SYNCED_DOC_ID</code>, which
            identifies documents that have been parsed and flushed to
            disk. In case of crash recovery,
            <code class="literal">FTS_SYNCED_DOC_ID</code> values are used to
            identify documents that have not been flushed to disk so
            that the documents can be re-parsed and added back to the
            <code class="literal">FULLTEXT</code> index cache. To view the data in
            this table, query the
            <a class="link" href="information-schema.html#innodb-ft-config-table" title="25.39.14 The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INFORMATION_SCHEMA.INNODB_FT_CONFIG</code></a>
            table.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-fulltext-index-cache"></a>InnoDB Full-Text Index Cache</h5>

</div>

</div>

</div>
<p>
        When a document is inserted, it is tokenized, and the individual
        words and associated data are inserted into the
        <code class="literal">FULLTEXT</code> index. This process, even for small
        documents, could result in numerous small insertions into the
        auxiliary index tables, making concurrent access to these tables
        a point of contention. To avoid this problem,
        <code class="literal">InnoDB</code> uses a <code class="literal">FULLTEXT</code>
        index cache to temporarily cache index table insertions for
        recently inserted rows. This in-memory cache structure holds
        insertions until the cache is full and then batch flushes them
        to disk (to the auxiliary index tables). You can query the
        <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="25.39.17 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INFORMATION_SCHEMA.INNODB_FT_INDEX_CACHE</code></a>
        table to view tokenized data for recently inserted rows.
      </p><p>
        The caching and batch flushing behavior avoids frequent updates
        to auxiliary index tables, which could result in concurrent
        access issues during busy insert and update times. The batching
        technique also avoids multiple insertions for the same word, and
        minimizes duplicate entries. Instead of flushing each word
        individually, insertions for the same word are merged and
        flushed to disk as a single entry, improving insertion
        efficiency while keeping auxiliary index tables as small as
        possible.
      </p><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_cache_size"><code class="literal">innodb_ft_cache_size</code></a>
        variable is used to configure the full-text index cache size (on
        a per-table basis), which affects how often the full-text index
        cache is flushed. You can also define a global full-text index
        cache size limit for all tables in a given instance using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size"><code class="literal">innodb_ft_total_cache_size</code></a>
        option.
      </p><p>
        The full-text index cache stores the same information as
        auxiliary index tables. However, the full-text index cache only
        caches tokenized data for recently inserted rows. The data that
        is already flushed to disk (to the full-text auxiliary tables)
        is not brought back into the full-text index cache when queried.
        The data in auxiliary index tables is queried directly, and
        results from the auxiliary index tables are merged with results
        from the full-text index cache before being returned.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-fulltext-index-docid"></a>InnoDB Full-Text Index Document ID and FTS_DOC_ID Column</h5>

</div>

</div>

</div>
<p>
        <code class="literal">InnoDB</code> uses a unique document identifier
        referred to as a Document ID (<code class="literal">DOC_ID</code>) to map
        words in the full-text index to document records where the word
        appears. The mapping requires an <code class="literal">FTS_DOC_ID</code>
        column on the indexed table. If an <code class="literal">FTS_DOC_ID</code>
        column is not defined, <code class="literal">InnoDB</code> automatically
        adds a hidden <code class="literal">FTS_DOC_ID</code> column when the
        full-text index is created. The following example demonstrates
        this behavior.
      </p><p>
        The following table definition does not include an
        <code class="literal">FTS_DOC_ID</code> column:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE opening_lines (</code></strong>
       <strong class="userinput"><code>id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,</code></strong>
       <strong class="userinput"><code>opening_line TEXT(500),</code></strong>
       <strong class="userinput"><code>author VARCHAR(200),</code></strong>
       <strong class="userinput"><code>title VARCHAR(200)</code></strong>
       <strong class="userinput"><code>) ENGINE=InnoDB;</code></strong>   
</pre><p>
        When you create a full-text index on the table using
        <code class="literal">CREATE FULLTEXT INDEX</code> syntax, a warning is
        returned which reports that <code class="literal">InnoDB</code> is
        rebuilding the table to add the <code class="literal">FTS_DOC_ID</code>
        column.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE FULLTEXT INDEX idx ON opening_lines(opening_line);</code></strong>
Query OK, 0 rows affected, 1 warning (0.19 sec)
Records: 0  Duplicates: 0  Warnings: 1

mysql&gt; <strong class="userinput"><code>SHOW WARNINGS;</code></strong>
+---------+------+--------------------------------------------------+
| Level   | Code | Message                                          |
+---------+------+--------------------------------------------------+
| Warning |  124 | InnoDB rebuilding table to add column FTS_DOC_ID |
+---------+------+--------------------------------------------------+
</pre><p>
        The same warning is returned when using
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to add a full-text
        index to a table that does not have an
        <code class="literal">FTS_DOC_ID</code> column. If you create a full-text
        index at <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> time and do
        not specify an <code class="literal">FTS_DOC_ID</code> column,
        <code class="literal">InnoDB</code> adds a hidden
        <code class="literal">FTS_DOC_ID</code> column, without warning.
      </p><p>
        Defining an <code class="literal">FTS_DOC_ID</code> column at
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> time is less
        expensive than creating a full-text index on a table that is
        already loaded with data. If an <code class="literal">FTS_DOC_ID</code>
        column is defined on a table prior to loading data, the table
        and its indexes do not have to be rebuilt to add the new column.
        If you are not concerned with <code class="literal">CREATE FULLTEXT
        INDEX</code> performance, leave out the
        <code class="literal">FTS_DOC_ID</code> column to have
        <code class="literal">InnoDB</code> create it for you.
        <code class="literal">InnoDB</code> creates a hidden
        <code class="literal">FTS_DOC_ID</code> column along with a unique index
        (<code class="literal">FTS_DOC_ID_INDEX</code>) on the
        <code class="literal">FTS_DOC_ID</code> column. If you want to create your
        own <code class="literal">FTS_DOC_ID</code> column, the column must be
        defined as <code class="literal">BIGINT UNSIGNED NOT NULL</code> and named
        <code class="literal">FTS_DOC_ID</code> (all upper case), as in the
        following example:
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The <code class="literal">FTS_DOC_ID</code> column does not need to be
          defined as an <code class="literal">AUTO_INCREMENT</code> column, but
          <code class="literal">AUTO_INCREMENT</code> could make loading data
          easier.
</p>
</div>
<pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE opening_lines (</code></strong>
       <strong class="userinput"><code>FTS_DOC_ID BIGINT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,</code></strong>
       <strong class="userinput"><code>opening_line TEXT(500),</code></strong>
       <strong class="userinput"><code>author VARCHAR(200),</code></strong>
       <strong class="userinput"><code>title VARCHAR(200)</code></strong>
       <strong class="userinput"><code>) ENGINE=InnoDB;</code></strong>    
</pre><p>
        If you choose to define the <code class="literal">FTS_DOC_ID</code> column
        yourself, you are responsible for managing the column to avoid
        empty or duplicate values. <code class="literal">FTS_DOC_ID</code> values
        cannot be reused, which means <code class="literal">FTS_DOC_ID</code>
        values must be ever increasing.
      </p><p>
        Optionally, you can create the required unique
        <code class="literal">FTS_DOC_ID_INDEX</code> (all upper case) on the
        <code class="literal">FTS_DOC_ID</code> column.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE UNIQUE INDEX FTS_DOC_ID_INDEX on opening_lines(FTS_DOC_ID);</code></strong>
</pre><p>
        If you do not create the <code class="literal">FTS_DOC_ID_INDEX</code>,
        <code class="literal">InnoDB</code> creates it automatically.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <code class="literal">FTS_DOC_ID_INDEX</code> cannot be defined as a
          descending index because the <code class="literal">InnoDB</code> SQL
          parser does not use descending indexes.
</p>
</div>
<p>
        The permitted gap between the largest used
        <code class="literal">FTS_DOC_ID</code> value and new
        <code class="literal">FTS_DOC_ID</code> value is 65535.
      </p><p>
        To avoid rebuilding the table, the <code class="literal">FTS_DOC_ID</code>
        column is retained when dropping a full-text index.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-fulltext-index-deletion"></a>InnoDB Full-Text Index Deletion Handling</h5>

</div>

</div>

</div>
<p>
        Deleting a record that has a full-text index column could result
        in numerous small deletions in the auxiliary index tables,
        making concurrent access to these tables a point of contention.
        To avoid this problem, the Document ID
        (<code class="literal">DOC_ID</code>) of a deleted document is logged in a
        special <code class="literal">FTS_*_DELETED</code> table whenever a record
        is deleted from an indexed table, and the indexed record remains
        in the full-text index. Before returning query results,
        information in the <code class="literal">FTS_*_DELETED</code> table is
        used to filter out deleted Document IDs. The benefit of this
        design is that deletions are fast and inexpensive. The drawback
        is that the size of the index is not immediately reduced after
        deleting records. To remove full-text index entries for deleted
        records, run <code class="literal">OPTIMIZE TABLE</code> on the indexed
        table with
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_fulltext_only"><code class="literal">innodb_optimize_fulltext_only=ON</code></a>
        to rebuild the full-text index. For more information, see
        <a class="xref" href="functions.html#fulltext-optimize" title="Optimizing InnoDB Full-Text Indexes">Optimizing InnoDB Full-Text Indexes</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-fulltext-index-transaction"></a>InnoDB Full-Text Index Transaction Handling</h5>

</div>

</div>

</div>
<p>
        <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> indexes
        have special transaction handling characteristics due its
        caching and batch processing behavior. Specifically, updates and
        insertions on a <code class="literal">FULLTEXT</code> index are processed
        at transaction commit time, which means that a
        <code class="literal">FULLTEXT</code> search can only see committed data.
        The following example demonstrates this behavior. The
        <code class="literal">FULLTEXT</code> search only returns a result after
        the inserted lines are committed.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE opening_lines (</code></strong>
       <strong class="userinput"><code>id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,</code></strong>
       <strong class="userinput"><code>opening_line TEXT(500),</code></strong>
       <strong class="userinput"><code>author VARCHAR(200),</code></strong>
       <strong class="userinput"><code>title VARCHAR(200),</code></strong>
       <strong class="userinput"><code>FULLTEXT idx (opening_line)</code></strong>
       <strong class="userinput"><code>) ENGINE=InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>BEGIN;</code></strong>

mysql&gt; <strong class="userinput"><code>INSERT INTO opening_lines(opening_line,author,title) VALUES</code></strong>
       <strong class="userinput"><code>('Call me Ishmael.','Herman Melville','Moby-Dick'),</code></strong>
       <strong class="userinput"><code>('A screaming comes across the sky.','Thomas Pynchon','Gravity\'s Rainbow'),</code></strong>
       <strong class="userinput"><code>('I am an invisible man.','Ralph Ellison','Invisible Man'),</code></strong>
       <strong class="userinput"><code>('Where now? Who now? When now?','Samuel Beckett','The Unnamable'),</code></strong>
       <strong class="userinput"><code>('It was love at first sight.','Joseph Heller','Catch-22'),</code></strong>
       <strong class="userinput"><code>('All this happened, more or less.','Kurt Vonnegut','Slaughterhouse-Five'),</code></strong>
       <strong class="userinput"><code>('Mrs. Dalloway said she would buy the flowers herself.','Virginia Woolf','Mrs. Dalloway'),</code></strong>
       <strong class="userinput"><code>('It was a pleasure to burn.','Ray Bradbury','Fahrenheit 451');</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT COUNT(*) FROM opening_lines WHERE MATCH(opening_line) AGAINST('Ishmael');</code></strong>
+----------+
| COUNT(*) |
+----------+
|        0 |
+----------+

mysql&gt; <strong class="userinput"><code>COMMIT;</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT COUNT(*) FROM opening_lines WHERE MATCH(opening_line) AGAINST('Ishmael');</code></strong>
+----------+
| COUNT(*) |
+----------+
|        1 |
+----------+
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-fulltext-index-monitoring"></a>Monitoring InnoDB Full-Text Indexes</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091651355312"></a><a class="indexterm" name="idm140091651353824"></a><p>
        You can monitor and examine the special text-processing aspects
        of <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> indexes
        by querying the following <code class="literal">INFORMATION_SCHEMA</code>
        tables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-config-table" title="25.39.14 The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INNODB_FT_CONFIG</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-index-table-table" title="25.39.18 The INFORMATION_SCHEMA INNODB_FT_INDEX_TABLE Table"><code class="literal">INNODB_FT_INDEX_TABLE</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="25.39.17 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="25.39.15 The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="25.39.16 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="25.39.13 The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a>
</p></li></ul>
</div>
<p>
        You can also view basic information for
        <code class="literal">FULLTEXT</code> indexes and tables by querying
        <a class="link" href="information-schema.html#innodb-indexes-table" title="25.39.19 The INFORMATION_SCHEMA INNODB_INDEXES Table"><code class="literal">INNODB_INDEXES</code></a> and
        <a class="link" href="information-schema.html#innodb-tables-table" title="25.39.24 The INFORMATION_SCHEMA INNODB_TABLES Table"><code class="literal">INNODB_TABLES</code></a>.
      </p><p>
        For more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-fulltext_index-tables" title="15.14.4 InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables">Section 15.14.4, “InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables”</a>.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-tablespace"></a>15.6.3 Tablespaces</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-system-tablespace">15.6.3.1 The System Tablespace</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multiple-tablespaces">15.6.3.2 File-Per-Table Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#general-tablespaces">15.6.3.3 General Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-undo-tablespaces">15.6.3.4 Undo Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-temporary-tablespace">15.6.3.5 Temporary Tablespaces</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#tablespace-placing">15.6.3.6 Creating a Tablespace Outside of the Data Directory</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#tablespace-copying">15.6.3.7 Copying Tablespaces to Another Instance</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-moving-data-files-offline">15.6.3.8 Moving Tablespace Files While the Server is Offline</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tablespace-encryption">15.6.3.9 InnoDB Data-at-Rest Encryption</a></span></dt></dl>
</div>
<p>
    This section covers topics related to <code class="literal">InnoDB</code>
    tablespaces.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-system-tablespace"></a>15.6.3.1 The System Tablespace</h4>
</div>
</div>
</div>
<p>
      The <code class="literal">InnoDB</code> system tablespace is the storage
      area for the doublewrite buffer and the change buffer. The system
      tablespace also contains table and index data for user-created
      tables created in the system tablespace. In previous releases, the
      system tablespace contained the <code class="literal">InnoDB</code> data
      dictionary. In MySQL 8.0, <code class="literal">InnoDB</code>
      stores metadata in the MySQL data dictionary. See
      <a class="xref" href="data-dictionary.html" title="Chapter 14 MySQL Data Dictionary">Chapter 14, <i>MySQL Data Dictionary</i></a>.
    </p><p>
      The system tablespace can have one or more data files. By default,
      one system tablespace data file, named
      <code class="filename">ibdata1</code>, is created in the data directory.
      The size and number of system tablespace data files is controlled
      by the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
      startup option. For related information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-startup-data-file-configuration" title="System Tablespace Data File Configuration">System Tablespace Data File Configuration</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-resize-system-tablespace"></a>Resizing the System Tablespace</h5>
</div>
</div>
</div>
<a class="indexterm" name="idm140091651320192"></a><p>
        This section describes how to increase or decrease the size of
        the <code class="literal">InnoDB</code> system tablespace.
      </p><h6><a name="idm140091651317488"></a>Increasing the Size of the InnoDB System Tablespace</h6><p>
        The easiest way to increase the size of the
        <code class="literal">InnoDB</code> system tablespace is to configure it
        from the beginning to be auto-extending. Specify the
        <code class="literal">autoextend</code> attribute for the last data file
        in the tablespace definition. Then <code class="literal">InnoDB</code>
        increases the size of that file automatically in 64MB increments
        when it runs out of space. The increment size can be changed by
        setting the value of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
        system variable, which is measured in megabytes.
      </p><p>
        You can expand the system tablespace by a defined amount by
        adding another data file:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Shut down the MySQL server.
          </p></li><li class="listitem"><p>
            If the previous last data file is defined with the keyword
            <code class="literal">autoextend</code>, change its definition to use
            a fixed size, based on how large it has actually grown.
            Check the size of the data file, round it down to the
            closest multiple of 1024 × 1024 bytes (= 1MB), and
            specify this rounded size explicitly in
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>.
          </p></li><li class="listitem"><p>
            Add a new data file to the end of
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>,
            optionally making that file auto-extending. Only the last
            data file in the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> can
            be specified as auto-extending.
          </p></li><li class="listitem"><p>
            Start the MySQL server again.
</p></li></ol>
</div>
<p>
        For example, this tablespace has just one auto-extending data
        file <code class="filename">ibdata1</code>:
      </p><pre data-lang="none" class="programlisting">
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:10M:autoextend
</pre><p>
        Suppose that this data file, over time, has grown to 988MB. Here
        is the configuration line after modifying the original data file
        to use a fixed size and adding a new auto-extending data file:
      </p><pre data-lang="none" class="programlisting">
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:988M;/disk2/ibdata2:50M:autoextend
</pre><p>
        When you add a new data file to the system tablespace
        configuration, make sure that the filename does not refer to an
        existing file. <code class="literal">InnoDB</code> creates and initializes
        the file when you restart the server.
      </p><h6><a name="idm140091651297120"></a>Decreasing the Size of the InnoDB System Tablespace</h6><p>
        You cannot remove a data file from the system tablespace. To
        decrease the system tablespace size, use this procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Use <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to dump all your
            <code class="literal">InnoDB</code> tables, including
            <code class="literal">InnoDB</code> tables located in the MySQL
            database.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT TABLE_NAME from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='mysql' and ENGINE='InnoDB';</code></strong>
+---------------------------+
| TABLE_NAME                |
+---------------------------+
| columns_priv              |
| component                 |
| db                        |
| default_roles             |
| engine_cost               |
| func                      |
| global_grants             |
| gtid_executed             |
| help_category             |
| help_keyword              |
| help_relation             |
| help_topic                |
| innodb_dynamic_metadata   |
| innodb_index_stats        |
| innodb_table_stats        |
| plugin                    |
| procs_priv                |
| proxies_priv              |
| role_edges                |
| server_cost               |
| servers                   |
| slave_master_info         |
| slave_relay_log_info      |
| slave_worker_info         |
| tables_priv               |
| time_zone                 |
| time_zone_leap_second     |
| time_zone_name            |
| time_zone_transition      |
| time_zone_transition_type |
| user                      |
+---------------------------+
</pre></li><li class="listitem"><p>
            Stop the server.
          </p></li><li class="listitem"><p>
            Remove all the existing tablespace files
            (<code class="filename">*.ibd</code>), including the
            <code class="filename">ibdata</code> and <code class="filename">ib_log</code>
            files. Do not forget to remove <code class="filename">*.ibd</code>
            files for tables located in the MySQL database.
          </p></li><li class="listitem"><p>
            Configure a new tablespace.
          </p></li><li class="listitem"><p>
            Restart the server.
          </p></li><li class="listitem"><p>
            Import the dump files.
</p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          If your databases only use the <code class="literal">InnoDB</code>
          engine, it may be simpler to dump
          <span class="bold"><strong>all</strong></span> databases, stop the
          server, remove all databases and <code class="literal">InnoDB</code> log
          files, restart the server, and import the dump files.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-raw-devices"></a>Using Raw Disk Partitions for the System Tablespace</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091651275984"></a><a class="indexterm" name="idm140091651274528"></a><p>
        You can use raw disk partitions as data files in the
        <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
        This technique enables nonbuffered I/O on Windows and on some
        Linux and Unix systems without file system overhead. Perform
        tests with and without raw partitions to verify whether this
        change actually improves performance on your system.
      </p><p>
        When you use a raw disk partition, ensure that the user ID that
        runs the MySQL server has read and write privileges for that
        partition. For example, if you run the server as the
        <code class="literal">mysql</code> user, the partition must be readable
        and writeable by <code class="literal">mysql</code>. If you run the server
        with the <a class="link" href="server-administration.html#option_mysqld_memlock"><code class="option">--memlock</code></a> option, the
        server must be run as <code class="literal">root</code>, so the partition
        must be readable and writeable by <code class="literal">root</code>.
      </p><p>
        The procedures described below involve option file modification.
        For additional information, see <a class="xref" href="programs.html#option-files" title="4.2.2.2 Using Option Files">Section 4.2.2.2, “Using Option Files”</a>.
</p><h6><a name="idm140091651265424"></a>Allocating a Raw Disk Partition on Linux and Unix Systems</h6>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            When you create a new data file, specify the keyword
            <code class="literal">newraw</code> immediately after the data file
            size for the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
            option. The partition must be at least as large as the size
            that you specify. Note that 1MB in <code class="literal">InnoDB</code>
            is 1024 × 1024 bytes, whereas 1MB in disk
            specifications usually means 1,000,000 bytes.
          </p><pre data-lang="none" class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=/dev/hdd1:3Gnewraw;/dev/hdd2:2Gnewraw
</pre></li><li class="listitem"><p>
            Restart the server. <code class="literal">InnoDB</code> notices the
            <code class="literal">newraw</code> keyword and initializes the new
            partition. However, do not create or change any
            <code class="literal">InnoDB</code> tables yet. Otherwise, when you
            next restart the server, <code class="literal">InnoDB</code>
            reinitializes the partition and your changes are lost. (As a
            safety measure <code class="literal">InnoDB</code> prevents users from
            modifying data when any partition with
            <code class="literal">newraw</code> is specified.)
          </p></li><li class="listitem"><p>
            After <code class="literal">InnoDB</code> has initialized the new
            partition, stop the server, change <code class="literal">newraw</code>
            in the data file specification to <code class="literal">raw</code>:
          </p><pre data-lang="none" class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=/dev/hdd1:3Graw;/dev/hdd2:2Graw
</pre></li><li class="listitem"><p>
            Restart the server. <code class="literal">InnoDB</code> now permits
            changes to be made.
</p></li></ol>
</div>
<h6><a name="idm140091651247632"></a>Allocating a Raw Disk Partition on Windows</h6><p>
        On Windows systems, the same steps and accompanying guidelines
        described for Linux and Unix systems apply except that the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> setting
        differs slightly on Windows.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            When you create a new data file, specify the keyword
            <code class="literal">newraw</code> immediately after the data file
            size for the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
            option:
          </p><pre data-lang="none" class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=//./D::10Gnewraw
</pre><p>
            The <code class="filename">//./</code> corresponds to the Windows
            syntax of <code class="filename">\\.\</code> for accessing physical
            drives. In the example above, <code class="literal">D:</code> is the
            drive letter of the partition.
          </p></li><li class="listitem"><p>
            Restart the server. <code class="literal">InnoDB</code> notices the
            <code class="literal">newraw</code> keyword and initializes the new
            partition.
          </p></li><li class="listitem"><p>
            After <code class="literal">InnoDB</code> has initialized the new
            partition, stop the server, change <code class="literal">newraw</code>
            in the data file specification to <code class="literal">raw</code>:
          </p><pre data-lang="none" class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=//./D::10Graw
</pre></li><li class="listitem"><p>
            Restart the server. <code class="literal">InnoDB</code> now permits
            changes to be made.
</p></li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-multiple-tablespaces"></a>15.6.3.2 File-Per-Table Tablespaces</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091651228144"></a><a class="indexterm" name="idm140091651226656"></a><a class="indexterm" name="idm140091651225584"></a><p>
      Historically, <code class="literal">InnoDB</code> tables were stored in the
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      This monolithic approach was targeted at machines dedicated to
      database processing, with carefully planned data growth, where any
      disk storage allocated to MySQL would never be needed for other
      purposes. The <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table
      tablespace</a> feature provides a more flexible alternative,
      where each <code class="literal">InnoDB</code> table is stored in its own
      tablespace data file (<code class="filename">.ibd</code> file). This
      feature is controlled by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      configuration option, which is enabled by default.
</p>
<h5><a name="idm140091651218528"></a>Advantages</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          You can reclaim disk space when truncating or dropping a table
          stored in a file-per-table tablespace. Truncating or dropping
          tables stored in the shared
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> creates free space internally in the system
          tablespace data files (<a class="link" href="glossary.html#glos_ibdata_file" title="ibdata file">ibdata
          files</a>) which can only be used for new
          <code class="literal">InnoDB</code> data.
        </p><p>
          Similarly, a table-copying <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> operation on table that resides in a shared
          tablespace can increase the amount of space used by the
          tablespace. Such operations may require as much additional
          space as the data in the table plus indexes. The additional
          space required for the table-copying
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation is not
          released back to the operating system as it is for
          file-per-table tablespaces.
        </p></li><li class="listitem"><p>
          The <a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> operation is
          faster when run on tables stored in file-per-table
          tablespaces.
        </p></li><li class="listitem"><p>
          You can store specific tables on separate storage devices, for
          I/O optimization, space management, or backup purposes by
          specifying the location of each table using the syntax
          <code class="literal">CREATE TABLE ... DATA DIRECTORY =
          <em class="replaceable"><code>absolute_path_to_directory</code></em></code>,
          as explained in <a class="xref" href="innodb-storage-engine.html#tablespace-placing" title="15.6.3.6 Creating a Tablespace Outside of the Data Directory">Section 15.6.3.6, “Creating a Tablespace Outside of the Data Directory”</a>.
        </p></li><li class="listitem"><p>
          You can run <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> to
          compact or recreate a file-per-table tablespace. When you run
          an <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>,
          <code class="literal">InnoDB</code> creates a new
          <code class="filename">.ibd</code> file with a temporary name, using
          only the space required to store actual data. When the
          optimization is complete, <code class="literal">InnoDB</code> removes
          the old <code class="filename">.ibd</code> file and replaces it with
          the new one. If the previous <code class="filename">.ibd</code> file
          grew significantly but the actual data only accounted for a
          portion of its size, running <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a> can reclaim the unused space.
        </p></li><li class="listitem"><p>
          You can move individual <code class="literal">InnoDB</code> tables
          rather than entire databases.
        </p></li><li class="listitem"><p>
          You can copy individual <code class="literal">InnoDB</code> tables from
          one MySQL instance to another (known as the
          <a class="link" href="glossary.html#glos_transportable_tablespace" title="transportable tablespace">transportable
          tablespace</a> feature).
        </p></li><li class="listitem"><p>
          Tables created in file-per-table tablespaces support features
          associated with
          <a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">compressed</a>
          and <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">dynamic</a> row
          formats.
        </p></li><li class="listitem"><p>
          You can enable more efficient storage for tables with large
          <code class="literal">BLOB</code> or <code class="literal">TEXT</code> columns
          using the <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">dynamic row
          format</a>.
        </p></li><li class="listitem"><p>
          File-per-table tablespaces may improve chances for a
          successful recovery and save time when a corruption occurs,
          when a server cannot be restarted, or when backup and binary
          logs are unavailable.
        </p></li><li class="listitem"><p>
          You can back up or restore individual tables quickly using the
          MySQL Enterprise Backup product, without interrupting the use
          of other <code class="literal">InnoDB</code> tables. This is beneficial
          if you have tables that require backup less frequently or on a
          different backup schedule. See <a class="ulink" href="https://dev.mysql.com/doc/mysql-enterprise-backup/8.0/en/partial.html" target="_top">Making a Partial Backup</a> for
          details.
        </p></li><li class="listitem"><p>
          File-per-table tablespaces are convenient for per-table status
          reporting when copying or backing up tables.
        </p></li><li class="listitem"><p>
          You can monitor table size at a file system level without
          accessing MySQL.
        </p></li><li class="listitem"><p>
          Common Linux file systems do not permit concurrent writes to a
          single file when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> is set to
          <code class="literal">O_DIRECT</code>. As a result, there are possible
          performance improvements when using file-per-table tablespaces
          in conjunction with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a>.
        </p></li><li class="listitem"><p>
          The system tablespace stores the data dictionary and undo
          logs, and is limited in size by <code class="literal">InnoDB</code>
          tablespace size limits. See
          <a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="15.6.1.6 Limits on InnoDB Tables">Section 15.6.1.6, “Limits on InnoDB Tables”</a>. With file-per-table
          tablespaces, each table has its own tablespace, which provides
          room for growth.
</p></li></ul>
</div>
<h5><a name="idm140091651175344"></a>Potential Disadvantages</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          With file-per-table tablespaces, each table may have unused
          space, which can only be utilized by rows of the same table.
          This could lead to wasted space if not properly managed.
        </p></li><li class="listitem"><p>
          <code class="literal">fsync</code> operations must run on each open
          table rather than on a single file. Because there is a
          separate <code class="literal">fsync</code> operation for each file,
          write operations on multiple tables cannot be combined into a
          single I/O operation. This may require
          <code class="literal">InnoDB</code> to perform a higher total number of
          <code class="literal">fsync</code> operations.
        </p></li><li class="listitem"><p>
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> must keep one open file handle per
          table, which may impact performance if you have numerous
          tables in file-per-table tablespaces.
        </p></li><li class="listitem"><p>
          More file descriptors are used.
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          enabled by default in MySQL 5.6 and higher. You may consider
          disabling it if backward compatibility with earlier versions
          of MySQL is a concern.
        </p></li><li class="listitem"><p>
          If many tables are growing there is potential for more
          fragmentation which can impede <a class="link" href="sql-syntax.html#drop-table" title="13.1.32 DROP TABLE Syntax"><code class="literal">DROP
          TABLE</code></a> and table scan performance. However, when
          fragmentation is managed, having files in their own tablespace
          can improve performance.
        </p></li><li class="listitem"><p>
          The buffer pool is scanned when dropping a file-per-table
          tablespace, which can take several seconds for buffer pools
          that are tens of gigabytes in size. The scan is performed with
          a broad internal lock, which may delay other operations.
          Tables in the system tablespace are not affected.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
          variable, which defines increment size (in MB) for extending
          the size of an auto-extending shared tablespace file when it
          becomes full, does not apply to file-per-table tablespace
          files, which are auto-extending regardless of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
          setting. The initial extensions are by small amounts, after
          which extensions occur in increments of 4MB.
</p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="tablespace-enabling"></a>Enabling File-Per-Table Tablespaces</h5>

</div>

</div>

</div>
<p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        option is enabled by default.
      </p><p>
        To set the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option at
        startup, start the server with the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="option">--innodb_file_per_table</code></a>
        command-line option, or add this line to the
        <code class="literal">[mysqld]</code> section of
        <code class="filename">my.cnf</code>:
      </p><pre data-lang="none" class="programlisting">
[mysqld]
innodb_file_per_table=1
</pre><p>
        You can also set
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        dynamically, while the server is running:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_file_per_table=1;</code></strong>
</pre><p>
        With <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        enabled, you can store <code class="literal">InnoDB</code> tables in a
        <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.ibd</code>
        file. Unlike the <code class="literal">MyISAM</code> storage engine, with
        its separate
        <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYD</code> and
        <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYI</code>
        files for indexes and data, <code class="literal">InnoDB</code> stores the
        data and the indexes together in a single
        <code class="filename">.ibd</code> file.
      </p><p>
        If you disable
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> in your
        startup options and restart the server, or disable it with the
        <code class="literal">SET GLOBAL</code> command, <code class="literal">InnoDB</code>
        creates new tables inside the system tablespace unless you have
        explicitly placed the table in file-per-table tablespace or
        general tablespace using the
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">CREATE TABLE ...
        TABLESPACE</code></a> option.
      </p><p>
        You can always read and write any <code class="literal">InnoDB</code>
        tables, regardless of the file-per-table setting.
      </p><p>
        To move a table from the system tablespace to its own
        tablespace, change the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting
        and rebuild the table:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_file_per_table=1;</code></strong>
mysql&gt; <strong class="userinput"><code>ALTER TABLE <em class="replaceable"><code>table_name</code></em> ENGINE=InnoDB;</code></strong>
</pre><p>
        Tables added to the system tablespace using
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
        TABLESPACE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
        TABLESPACE</code></a> syntax are not affected by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting.
        To move these tables from the system tablespace to a
        file-per-table tablespace, they must be moved explicitly using
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
        TABLESPACE</code></a> syntax.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <code class="literal">InnoDB</code> always needs the system tablespace
          because it puts its internal
          <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data dictionary</a>
          and <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a> there. The
          <code class="filename">.ibd</code> files are not sufficient for
          <code class="literal">InnoDB</code> to operate.
        </p><p>
          When a table is moved out of the system tablespace into its
          own <code class="filename">.ibd</code> file, the data files that make
          up the system tablespace remain the same size. The space
          formerly occupied by the table can be reused for new
          <code class="literal">InnoDB</code> data, but is not reclaimed for use
          by the operating system. When moving large
          <code class="literal">InnoDB</code> tables out of the system tablespace,
          where disk space is limited, you may prefer to enable
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and
          recreate the entire instance using the
          <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> command. As mentioned above,
          tables added to the system tablespace using
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
          TABLESPACE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          TABLESPACE</code></a> syntax are not affected by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
          setting. These tables must be moved individually.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="general-tablespaces"></a>15.6.3.3 General Tablespaces</h4>

</div>

</div>

</div>
<p>
      A general tablespace is a shared <code class="literal">InnoDB</code>
      tablespace that is created using <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE
      TABLESPACE</code></a> syntax. General tablespace capabilities and
      features are described under the following topics in this section:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#general-tablespaces-capabilities" title="General Tablespace Capabilities">General Tablespace Capabilities</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#general-tablespaces-creating" title="Creating a General Tablespace">Creating a General Tablespace</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#general-tablespaces-adding-tables" title="Adding Tables to a General Tablespace">Adding Tables to a General Tablespace</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#general-tablespaces-row-format-support" title="General Tablespace Row Format Support">General Tablespace Row Format Support</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#general-tablespaces-moving-non-partitioned-tables" title="Moving Tables Between Tablespaces Using ALTER TABLE">Moving Tables Between Tablespaces Using ALTER TABLE</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#general-tablespaces-renaming" title="Renaming a General Tablespace">Renaming a General Tablespace</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#general-tablespaces-dropping" title="Dropping a General Tablespace">Dropping a General Tablespace</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#general-tablespaces-limitations" title="General Tablespace Limitations">General Tablespace Limitations</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="general-tablespaces-capabilities"></a>General Tablespace Capabilities</h5>

</div>

</div>

</div>
<p>
        The general tablespace feature provides the following
        capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Similar to the system tablespace, general tablespaces are
            shared tablespaces that can store data for multiple tables.
          </p></li><li class="listitem"><p>
            General tablespaces have a potential memory advantage over
            <a class="link" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="15.6.3.2 File-Per-Table Tablespaces">file-per-table
            tablespaces</a>. The server keeps tablespace metadata in
            memory for the lifetime of a tablespace. Multiple tables in
            fewer general tablespaces consume less memory for tablespace
            metadata than the same number of tables in separate
            file-per-table tablespaces.
          </p></li><li class="listitem"><p>
            General tablespace data files may be placed in a directory
            relative to or independent of the MySQL data directory,
            which provides you with many of the data file and storage
            management capabilities of
            <a class="link" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="15.6.3.2 File-Per-Table Tablespaces">file-per-table
            tablespaces</a>. As with file-per-table tablespaces, the
            ability to place data files outside of the MySQL data
            directory allows you to manage performance of critical
            tables separately, setup RAID or DRBD for specific tables,
            or bind tables to particular disks, for example.
          </p></li><li class="listitem"><p>
            General tablespaces support both Antelope and Barracuda file
            formats, and therefore support all table row formats and
            associated features. With support for both file formats,
            general tablespaces have no dependence on
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_file_format" target="_top"><code class="literal">innodb_file_format</code></a> or
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
            settings, nor do these variables have any effect on general
            tablespaces.
          </p></li><li class="listitem"><p>
            The <code class="literal">TABLESPACE</code> option can be used with
            <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> to create tables
            in a general tablespaces, file-per-table tablespace, or in
            the system tablespace.
          </p></li><li class="listitem"><p>
            The <code class="literal">TABLESPACE</code> option can be used with
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to move tables
            between general tablespaces, file-per-table tablespaces, and
            the system tablespace. Previously, it was not possible to
            move a table from a file-per-table tablespace to the system
            tablespace. With the general tablespace feature, you can now
            do so.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="general-tablespaces-creating"></a>Creating a General Tablespace</h5>

</div>

</div>

</div>
<p>
        General tablespaces are created using
        <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE TABLESPACE</code></a> syntax.
      </p><pre data-lang="sql" class="programlisting">CREATE TABLESPACE <em class="replaceable"><code>tablespace_name</code></em>
    [ADD DATAFILE '<em class="replaceable"><code>file_name</code></em>']
    [FILE_BLOCK_SIZE = <em class="replaceable"><code>value</code></em>]
        [ENGINE [=] <em class="replaceable"><code>engine_name</code></em>]</pre><p>
        A general tablespace can be created in the data directory or
        outside of it. To avoid conflicts with implicitly created
        file-per-table tablespaces, creating a general tablespace in a
        subdirectory under the data directory is not supported. When
        creating a general tablespace outside of the data directory, the
        directory must exist and must be known to
        <code class="literal">InnoDB</code> prior to creating the tablespace. To
        make an unknown directory known to <code class="literal">InnoDB</code>,
        add the directory to the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> argument
        value. <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> is a
        read-only startup option. Configuring it requires restarting the
        server.
      </p><p>
        Examples:
      </p><p>
        Creating a general tablespace in the data directory:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLESPACE `ts1` ADD DATAFILE 'ts1.ibd' Engine=InnoDB;</code></strong>
</pre><p>
        or
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLESPACE `ts1` Engine=InnoDB;</code></strong>
</pre><p>
        The <code class="literal">ADD DATAFILE</code> clause is optional as of
        MySQL 8.0.14 and required before that. If the <code class="literal">ADD
        DATAFILE</code> clause is not specified when creating a
        tablespace, a tablespace data file with a unique file name is
        created implicitly. The unique file name is a 128 bit UUID
        formatted into five groups of hexadecimal numbers separated by
        dashes
        (<em class="replaceable"><code>aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee</code></em>).
        General tablespace data files include an
        <code class="filename">.ibd</code> file extension. In a replication
        environment, the data file name created on the master is not the
        same as the data file name created on the slave.
      </p><p>
        Creating a general tablespace in a directory outside of the data
        directory:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLESPACE `ts1` ADD DATAFILE '/my/tablespace/directory/ts1.ibd' Engine=InnoDB;</code></strong>
</pre><p>
        You can specify a path that is relative to the data directory as
        long as the tablespace directory is not under the data
        directory. In this example, the
        <code class="filename">my_tablespace</code> directory is at the same
        level as the data directory:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLESPACE `ts1` ADD DATAFILE '../my_tablespace/ts1.ibd' Engine=InnoDB;</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The <code class="literal">ENGINE = InnoDB</code> clause must be defined
          as part of the <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE
          TABLESPACE</code></a> statement, or <code class="literal">InnoDB</code>
          must be defined as the default storage engine
          (<a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="literal">default_storage_engine=InnoDB</code></a>).
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="general-tablespaces-adding-tables"></a>Adding Tables to a General Tablespace</h5>

</div>

</div>

</div>
<p>
        After creating an <code class="literal">InnoDB</code> general tablespace,
        you can use <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE <em class="replaceable"><code>tbl_name</code></em> ... TABLESPACE [=]
        <em class="replaceable"><code>tablespace_name</code></em></code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
        <em class="replaceable"><code>tbl_name</code></em> TABLESPACE [=]
        <em class="replaceable"><code>tablespace_name</code></em></code></a> to add
        tables to the tablespace, as shown in the following examples:
      </p><p>
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (c1 INT PRIMARY KEY) TABLESPACE ts1;</code></strong>
</pre><p>
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER TABLE t2 TABLESPACE ts1;</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Support for adding table partitions to shared tablespaces was
          deprecated in MySQL 5.7.24 and removed in MySQL 8.0.13. Shared
          tablespaces include the <code class="literal">InnoDB</code> system
          tablespace and general tablespaces.
</p>
</div>
<p>
        For detailed syntax information, see <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a> and <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="general-tablespaces-row-format-support"></a>General Tablespace Row Format Support</h5>

</div>

</div>

</div>
<p>
        General tablespaces support all table row formats
        (<code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code>,
        <code class="literal">DYNAMIC</code>, <code class="literal">COMPRESSED</code>) with
        the caveat that compressed and uncompressed tables cannot
        coexist in the same general tablespace due to different physical
        page sizes.
      </p><p>
        For a general tablespace to contain compressed tables
        (<code class="literal">ROW_FORMAT=COMPRESSED</code>),
        <code class="literal">FILE_BLOCK_SIZE</code> must be specified, and the
        <code class="literal">FILE_BLOCK_SIZE</code> value must be a valid
        compressed page size in relation to the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value. Also,
        the physical page size of the compressed table
        (<code class="literal">KEY_BLOCK_SIZE</code>) must be equal to
        <code class="literal">FILE_BLOCK_SIZE/1024</code>. For example, if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size=16KB</code></a> and
        <code class="literal">FILE_BLOCK_SIZE=8K</code>, the
        <code class="literal">KEY_BLOCK_SIZE</code> of the table must be 8.
      </p><p>
        The following table shows permitted
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>,
        <code class="literal">FILE_BLOCK_SIZE</code>, and
        <code class="literal">KEY_BLOCK_SIZE</code> combinations.
        <code class="literal">FILE_BLOCK_SIZE</code> values may also be specified
        in bytes. To determine a valid <code class="literal">KEY_BLOCK_SIZE</code>
        value for a given <code class="literal">FILE_BLOCK_SIZE</code>, divide the
        <code class="literal">FILE_BLOCK_SIZE</code> value by 1024. Table
        compression is not support for 32K and 64K
        <code class="literal">InnoDB</code> page sizes. For more information about
        <code class="literal">KEY_BLOCK_SIZE</code>, see
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>, and
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-usage" title="15.9.1.2 Creating Compressed Tables">Section 15.9.1.2, “Creating Compressed Tables”</a>.
</p>
<div class="table">
<a name="idm140091651008944"></a><p class="title"><b>Table 15.4 Permitted Page Size, FILE_BLOCK_SIZE, and KEY_BLOCK_SIZE Combinations
for Compressed Tables</b></p>
<div class="table-contents">
<table frame="all"><col width="33%"><col width="33%"><col width="34%"><thead><tr>
            <th scope="col">InnoDB Page Size (innodb_page_size)</th>
            <th scope="col">Permitted FILE_BLOCK_SIZE Value</th>
            <th scope="col">Permitted KEY_BLOCK_SIZE Value</th>
          </tr></thead><tbody><tr>
            <td scope="row">64KB</td>
            <td>64K (65536)</td>
            <td>Compression is not supported</td>
          </tr><tr>
            <td scope="row">32KB</td>
            <td>32K (32768)</td>
            <td>Compression is not supported</td>
          </tr><tr>
            <td scope="row">16KB</td>
            <td>16K (16384)</td>
            <td>N/A: If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> is equal to
              <code class="literal">FILE_BLOCK_SIZE</code>, the tablespace cannot
              contain a compressed table.</td>
          </tr><tr>
            <td scope="row">16KB</td>
            <td>8K (8192)</td>
            <td>8</td>
          </tr><tr>
            <td scope="row">16KB</td>
            <td>4K (4096)</td>
            <td>4</td>
          </tr><tr>
            <td scope="row">16KB</td>
            <td>2K (2048)</td>
            <td>2</td>
          </tr><tr>
            <td scope="row">16KB</td>
            <td>1K (1024)</td>
            <td>1</td>
          </tr><tr>
            <td scope="row">8KB</td>
            <td>8K (8192)</td>
            <td>N/A: If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> is equal to
              <code class="literal">FILE_BLOCK_SIZE</code>, the tablespace cannot
              contain a compressed table.</td>
          </tr><tr>
            <td scope="row">8KB</td>
            <td>4K (4096)</td>
            <td>4</td>
          </tr><tr>
            <td scope="row">8KB</td>
            <td>2K (2048)</td>
            <td>2</td>
          </tr><tr>
            <td scope="row">8KB</td>
            <td>1K (1024)</td>
            <td>1</td>
          </tr><tr>
            <td scope="row">4KB</td>
            <td>4K (4096)</td>
            <td>N/A: If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> is equal to
              <code class="literal">FILE_BLOCK_SIZE</code>, the tablespace cannot
              contain a compressed table.</td>
          </tr><tr>
            <td scope="row">4KB</td>
            <td>2K (2048)</td>
            <td>2</td>
          </tr><tr>
            <td scope="row">4KB</td>
            <td>1K (1024)</td>
            <td>1</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        This example demonstrates creating a general tablespace and
        adding a compressed table. The example assumes a default
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> of 16KB. The
        <code class="literal">FILE_BLOCK_SIZE</code> of 8192 requires that the
        compressed table have a <code class="literal">KEY_BLOCK_SIZE</code> of 8.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLESPACE `ts2` ADD DATAFILE 'ts2.ibd' FILE_BLOCK_SIZE = 8192 Engine=InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE t4 (c1 INT PRIMARY KEY) TABLESPACE ts2 ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=8;</code></strong>
</pre><p>
        If you do not specify <code class="literal">FILE_BLOCK_SIZE</code> when
        creating a general tablespace,
        <code class="literal">FILE_BLOCK_SIZE</code> defaults to
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>. When
        <code class="literal">FILE_BLOCK_SIZE</code> is equal to
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>, the
        tablespace may only contain tables with an uncompressed row
        format (<code class="literal">COMPACT</code>,
        <code class="literal">REDUNDANT</code>, and <code class="literal">DYNAMIC</code> row
        formats).
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="general-tablespaces-moving-non-partitioned-tables"></a>Moving Tables Between Tablespaces Using ALTER TABLE</h5>

</div>

</div>

</div>
<p>
        You can use <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> with the
        <code class="literal">TABLESPACE</code> option to move a table to an
        existing general tablespace, to a new file-per-table tablespace,
        or to the system tablespace.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Support for placing table partitions in shared tablespaces was
          deprecated in MySQL 5.7.24 and removed MySQL 8.0.13. Shared
          tablespaces include the <code class="literal">InnoDB</code> system
          tablespace and general tablespaces.
</p>
</div>
<p>
        To move a table from a file-per-table tablespace or from the
        system tablespace to a general tablespace, specify the name of
        the general tablespace. The general tablespace must exist. See
        <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE TABLESPACE</code></a> for more
        information.
      </p><pre data-lang="sql" class="programlisting">ALTER TABLE tbl_name TABLESPACE [=] <em class="replaceable"><code>tablespace_name</code></em>;</pre><p>
        To move a table from a general tablespace or file-per-table
        tablespace to the system tablespace, specify
        <code class="literal">innodb_system</code> as the tablespace name.
      </p><pre data-lang="sql" class="programlisting">ALTER TABLE tbl_name TABLESPACE [=] innodb_system;</pre><p>
        To move a table from the system tablespace or a general
        tablespace to a file-per-table tablespace, specify
        <code class="literal">innodb_file_per_table</code> as the tablespace name.
      </p><pre data-lang="sql" class="programlisting">ALTER TABLE tbl_name TABLESPACE [=] innodb_file_per_table;</pre><p>
        <code class="literal">ALTER TABLE ... TABLESPACE</code> operations always
        cause a full table rebuild, even if the
        <code class="literal">TABLESPACE</code> attribute has not changed from its
        previous value.
      </p><p>
        <code class="literal">ALTER TABLE ... TABLESPACE</code> syntax does not
        support moving a table from a temporary tablespace to a
        persistent tablespace.
      </p><p>
        The <code class="literal">DATA DIRECTORY</code> clause is permitted with
        <code class="literal">CREATE TABLE ...
        TABLESPACE=innodb_file_per_table</code> but is otherwise not
        supported for use in combination with the
        <code class="literal">TABLESPACE</code> option.
      </p><p>
        Restrictions apply when moving tables from encrypted
        tablespaces. See
        <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-limitations" title="Encryption Limitations">Encryption Limitations</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="general-tablespaces-renaming"></a>Renaming a General Tablespace</h5>

</div>

</div>

</div>
<p>
        Renaming a general tablespace is supported using
        <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">ALTER
        TABLESPACE ... RENAME TO</code></a> syntax.
      </p><pre data-lang="sql" class="programlisting">
ALTER TABLESPACE s1 RENAME TO s2;
</pre><p>
        The <a class="link" href="security.html#priv_create-tablespace"><code class="literal">CREATE TABLESPACE</code></a> privilege
        is required to rename a general tablespace.
      </p><p>
        <code class="literal">RENAME TO</code> operations are implicitly performed
        in <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> mode, regardless
        of the <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> setting.
      </p><p>
        A <code class="literal">RENAME TO</code> operation cannot be performed
        while <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> or
        <a class="link" href="sql-syntax.html#flush" title="13.7.7.3 FLUSH Syntax"><code class="literal">FLUSH TABLES WITH READ
        LOCK</code></a> is in effect for tables that reside in the
        tablespace.
      </p><p>
        Exclusive <a class="link" href="glossary.html#glos_metadata_lock" title="metadata lock">metadata
        locks</a> are taken on tables within a general tablespace
        while the tablespace is renamed, which prevents concurrent DDL.
        Concurrent DML is supported.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="general-tablespaces-dropping"></a>Dropping a General Tablespace</h5>

</div>

</div>

</div>
<p>
        The <a class="link" href="sql-syntax.html#drop-tablespace" title="13.1.33 DROP TABLESPACE Syntax"><code class="literal">DROP TABLESPACE</code></a> statement is
        used to drop an <code class="literal">InnoDB</code> general tablespace.
      </p><p>
        All tables must be dropped from the tablespace prior to a
        <a class="link" href="sql-syntax.html#drop-tablespace" title="13.1.33 DROP TABLESPACE Syntax"><code class="literal">DROP TABLESPACE</code></a> operation. If the
        tablespace is not empty, <a class="link" href="sql-syntax.html#drop-tablespace" title="13.1.33 DROP TABLESPACE Syntax"><code class="literal">DROP
        TABLESPACE</code></a> returns an error.
      </p><p>
        Use a query similar to the following to identify tables in a
        general tablespace.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT a.NAME AS space_name, b.NAME AS table_name FROM INFORMATION_SCHEMA.INNODB_TABLESPACES a,</code></strong> 
       <strong class="userinput"><code>INFORMATION_SCHEMA.INNODB_TABLES b WHERE a.SPACE=b.SPACE AND a.NAME LIKE 'ts1';</code></strong>
+------------+------------+
| space_name | table_name |
+------------+------------+
| ts1        | test/t1    |
| ts1        | test/t2    |
| ts1        | test/t3    |
+------------+------------+
</pre><p>
        A general <code class="literal">InnoDB</code> tablespace is not deleted
        automatically when the last table in the tablespace is dropped.
        The tablespace must be dropped explicitly using
        <a class="link" href="sql-syntax.html#drop-tablespace" title="13.1.33 DROP TABLESPACE Syntax"><code class="literal">DROP TABLESPACE
        <em class="replaceable"><code>tablespace_name</code></em></code></a>.
      </p><p>
        A general tablespace does not belong to any particular database.
        A <a class="link" href="sql-syntax.html#drop-database" title="13.1.24 DROP DATABASE Syntax"><code class="literal">DROP DATABASE</code></a> operation can
        drop tables that belong to a general tablespace but it cannot
        drop the tablespace, even if the <a class="link" href="sql-syntax.html#drop-database" title="13.1.24 DROP DATABASE Syntax"><code class="literal">DROP
        DATABASE</code></a> operation drops all tables that belong to the
        tablespace. A general tablespace must be dropped explicitly
        using <a class="link" href="sql-syntax.html#drop-tablespace" title="13.1.33 DROP TABLESPACE Syntax"><code class="literal">DROP
        TABLESPACE <em class="replaceable"><code>tablespace_name</code></em></code></a>.
      </p><p>
        Similar to the system tablespace, truncating or dropping tables
        stored in a general tablespace creates free space internally in
        the general tablespace <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd data
        file</a> which can only be used for new
        <code class="literal">InnoDB</code> data. Space is not released back to
        the operating system as it is when a file-per-table tablespace
        is deleted during a <a class="link" href="sql-syntax.html#drop-table" title="13.1.32 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a>
        operation.
      </p><p>
        This example demonstrates how to drop an
        <code class="literal">InnoDB</code> general tablespace. The general
        tablespace <code class="literal">ts1</code> is created with a single
        table. The table must be dropped before dropping the tablespace.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLESPACE `ts1` ADD DATAFILE 'ts1.ibd' Engine=InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (c1 INT PRIMARY KEY) TABLESPACE ts10 Engine=InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>DROP TABLE t1;</code></strong>

mysql&gt; <strong class="userinput"><code>DROP TABLESPACE ts1;</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <code class="literal"><em class="replaceable"><code>tablespace_name</code></em></code>
          is a case-sensitive identifier in MySQL.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="general-tablespaces-limitations"></a>General Tablespace Limitations</h5>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A generated or existing tablespace cannot be changed to a
            general tablespace.
          </p></li><li class="listitem"><p>
            Creation of temporary general tablespaces is not supported.
          </p></li><li class="listitem"><p>
            General tablespaces do not support temporary tables.
          </p></li><li class="listitem"><p>
            Similar to the system tablespace, truncating or dropping
            tables stored in a general tablespace creates free space
            internally in the general tablespace
            <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd data file</a> which
            can only be used for new <code class="literal">InnoDB</code> data.
            Space is not released back to the operating system as it is
            for
            <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
            tablespaces.
          </p><p>
            Additionally, a table-copying <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
            TABLE</code></a> operation on table that resides in a shared
            tablespace (a general tablespace or the system tablespace)
            can increase the amount of space used by the tablespace.
            Such operations require as much additional space as the data
            in the table plus indexes. The additional space required for
            the table-copying <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
            operation is not released back to the operating system as it
            is for file-per-table tablespaces.
          </p></li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
            DISCARD TABLESPACE</code></a> and
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
            ...IMPORT TABLESPACE</code></a> are not supported for tables
            that belong to a general tablespace.
          </p></li><li class="listitem"><p>
            Support for placing table partitions in general tablespaces
            was deprecated in MySQL 5.7.24 and removed in MySQL 8.0.13.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-undo-tablespaces"></a>15.6.3.4 Undo Tablespaces</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091650855824"></a><a class="indexterm" name="idm140091650854752"></a><a class="indexterm" name="idm140091650853680"></a><p>
      Undo tablespaces contain undo logs, which are collections of undo
      log records that contain information about how to undo the latest
      change by a transaction to a clustered index record. Undo logs
      exist within undo log segments, which are contained within
      rollback segments. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a> variable
      defines the number of rollback segments allocated to each undo
      tablespace.
    </p><p>
      Two default undo tablespaces are created when the MySQL instance
      is initialized. Default undo tablespaces are created at
      initialization time to provide a location for rollback segments
      that must exist before SQL statements can be accepted. A minimum
      of two undo tablespaces is required to support automated
      truncation of undo tablespaces. See
      <a class="xref" href="innodb-storage-engine.html#truncate-undo-tablespace" title="Truncating Undo Tablespaces">Truncating Undo Tablespaces</a>.
    </p><p>
      Default undo tablespaces are created in the location defined by
      the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
      variable. If the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a> variable is
      undefined, default undo tablespaces are created in the data
      directory. Default undo tablespace data files are named
      <code class="filename">undo_001</code> and <code class="filename">undo_002</code>.
      The corresponding undo tablespace names defined in the data
      dictionary are <code class="literal">innodb_undo_001</code> and
      <code class="literal">innodb_undo_002</code>.
    </p><p></p><p>
      As of MySQL 8.0.14, additional undo tablespaces can be created at
      runtime using SQL. See
      <a class="xref" href="innodb-storage-engine.html#innodb-add-undo-tablespaces" title="Adding Undo Tablespaces">Adding Undo Tablespaces</a>.
    </p><p>
      The initial size of an undo tablespace data file depends on the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value. For the
      default 16KB page size, the initial undo tablespace file size is
      10MiB. For 4KB, 8KB, 32KB, and 64KB page sizes, the initial undo
      tablespace files sizes are 7MiB, 8MiB, 20MiB, and 40MiB,
      respectively.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-add-undo-tablespaces"></a>Adding Undo Tablespaces</h5>
</div>
</div>
</div>
<p>
        Because undo logs can become large during long-running
        transactions, creating additional undo tablespaces can help
        prevent individual undo tablespaces from becoming too large. As
        of MySQL 8.0.14, additional undo tablespaces can be created at
        runtime using
        <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE UNDO
        TABLESPACE</code></a> syntax.
      </p><pre data-lang="sql" class="programlisting">
CREATE UNDO TABLESPACE <em class="replaceable"><code>tablespace_name</code></em> ADD DATAFILE '<em class="replaceable"><code>file_name</code></em>.ibu'     
</pre><p>
        The undo tablespace file name must have an
        <code class="filename">.ibu</code> extension. It is not permitted to
        specify a relative path when defining the undo tablespace file
        name. A fully qualified path is permitted, but the path must be
        known to <code class="literal">InnoDB</code>. Known paths are those
        defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> variable.
      </p><p>
        At startup, directories defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> variable are
        scanned for undo tablespace files. (The scan also traverses
        subdirectories.) Directories defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>, and
        <a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a> variables are
        automatically appended to the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> value,
        regardless of whether the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> variable is
        defined explicitly. An undo tablespace can therefore reside in
        paths defined by any of those variables.
      </p><p>
        If the undo tablespace file name does not include a path, the
        undo tablespace is created in the directory defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a> variable.
        If that variable is undefined, the undo tablespace is created in
        the data directory.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The <code class="literal">InnoDB</code> recovery process requires that
          undo tablespace files reside in known directories. Undo
          tablespace files must be discovered and opened before redo
          recovery and before other data files are opened to permit
          uncommitted transactions and data dictionary changes to be
          rolled back. An undo tablespace not found before recovery
          cannot be used, which can cause database inconsistencies. An
          error message is reported at startup if an undo tablespace
          known to the data dictionary is not found. The known directory
          requirement also supports undo tablespace portability. See
          <a class="xref" href="innodb-storage-engine.html#innodb-move-undo-tablespaces" title="Moving Undo Tablespaces">Moving Undo Tablespaces</a>.
</p>
</div>
<p>
        To create undo tablespaces in a path relative to the data
        directory, set the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a> variable
        to the relative path, and specify the file name only when
        creating an undo tablespace.
      </p><p>
        To view undo tablespace names and paths, query
        <a class="link" href="information-schema.html#files-table" title="25.11 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a>:
      </p><pre data-lang="sql" class="programlisting">
SELECT TABLESPACE_NAME, FILE_NAME FROM INFORMATION_SCHEMA.FILES 
  WHERE FILE_TYPE LIKE 'UNDO LOG';
</pre><p>
        A MySQL instance supports up to 127 undo tablespaces including
        the two default undo tablespaces created when the MySQL instance
        is initialized.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Prior to MySQL 8.0.14, additional undo tablespaces are created
          by configuring the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>
          startup variable. This variable is deprecated and no longer
          configurable as of MySQL 8.0.14.
        </p><p>
          Prior to MySQL 8.0.14, increasing the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>
          setting creates the specified number of undo tablespaces and
          adds them to the list of active undo tablespaces. Decreasing
          the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>
          setting removes undo tablespaces from the list of active undo
          tablespaces. Undo tablespaces that are removed from the active
          list remain active until they are no longer used by existing
          transactions. The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>
          variable can be configured at runtime using a
          <a class="link" href="sql-syntax.html#set-statement" title="13.7.5 SET Syntax"><code class="literal">SET</code></a>
          statement or defined in a configuration file.
        </p><p>
          Prior to MySQL 8.0.14, deactivated undo tablespaces cannot be
          removed. Manual removal of undo tablespace files is possible
          after a slow shutdown but is not recommended, as deactivated
          undo tablespaces may contain active undo logs for some time
          after the server is restarted if open transactions were
          present when shutting down the server. As of MySQL 8.0.14,
          undo tablespaces can be dropped using
          <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">DROP UNDO
          TABALESPACE</code></a> syntax. See
          <a class="xref" href="innodb-storage-engine.html#innodb-drop-undo-tablespaces" title="Dropping Undo Tablespaces">Dropping Undo Tablespaces</a>.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-drop-undo-tablespaces"></a>Dropping Undo Tablespaces</h5>

</div>

</div>

</div>
<p>
        As of MySQL 8.0.14, undo tablespaces created using
        <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE UNDO
        TABLESPACE</code></a> syntax can be dropped at runtime using
        <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">DROP UNDO
        TABALESPACE</code></a> syntax.
      </p><p>
        An undo tablespace must be empty before it can be dropped. To
        empty an undo tablespace, the undo tablespace must first be
        marked as inactive using
        <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">ALTER UNDO
        TABLESPACE</code></a> syntax so that the tablespace is no longer
        used for assigning rollback segments to new transactions.
      </p><pre data-lang="sql" class="programlisting">
ALTER UNDO TABLESPACE <em class="replaceable"><code>tablespace_name</code></em> SET INACTIVE;       
</pre><p>
        After an undo tablespace is marked as inactive, transactions
        currently using rollback segments in the undo tablespace are
        permitted to finish, as are any transactions started before
        those transactions are completed. After transactions are
        completed, the purge system frees the rollback segments in the
        undo tablespace, and the undo tablespace is truncated to its
        initial size. (The same process is used when truncating undo
        tablespaces. See <a class="xref" href="innodb-storage-engine.html#truncate-undo-tablespace" title="Truncating Undo Tablespaces">Truncating Undo Tablespaces</a>.)
        When the undo tablespace is empty, it can be dropped.
      </p><pre data-lang="sql" class="programlisting">
DROP UNDO TABLESPACE <em class="replaceable"><code>tablespace_name</code></em>;
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Alternatively, the undo tablespace can be left in an empty
          state and reactivated later, when needed, by issuing an
          <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">ALTER UNDO
          TABLESPACE <em class="replaceable"><code>tablespace_name</code></em> SET
          ACTIVE</code></a> statement.
</p>
</div>
<p>
        The state of an undo tablespace can be monitored by querying the
        <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TABLESPACES</code></a>
        table.
      </p><pre data-lang="sql" class="programlisting">
SELECT NAME, STATE FROM INFORMATION_SCHEMA.INNODB_TABLESPACES 
  WHERE NAME LIKE <em class="replaceable"><code>tablespace_name</code></em>;
</pre><p>
        An <code class="literal">inactive</code> state indicates that rollback
        segments in an undo tablespace are no longer used by new
        transactions. An <code class="literal">empty</code> state indicates that
        an undo tablespace is empty and ready to be dropped, or made
        active again using an
        <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">ALTER UNDO
        TABLESPACE <em class="replaceable"><code>tablespace_name</code></em> SET
        ACTIVE</code></a> statement. Attempting to drop an undo
        tablespace that is not empty returns an error.
      </p><p>
        The default undo tablespaces (<code class="literal">innodb_undo_001</code>
        and <code class="literal">innodb_undo_002</code>) created when the MySQL
        instance is initialized cannot be dropped. They can, however, be
        made inactive using an
        <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">ALTER UNDO
        TABLESPACE <em class="replaceable"><code>tablespace_name</code></em> SET
        INACTIVE</code></a> statement. Before a default undo tablespace
        can be made inactive, there must be an undo tablespace to take
        its place. A minimum of two active undo tablespaces are required
        at all times to support automated truncation of undo
        tablespaces.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-move-undo-tablespaces"></a>Moving Undo Tablespaces</h5>

</div>

</div>

</div>
<p>
        Undo tablespaces created with
        <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE UNDO
        TABLESPACE</code></a> syntax can be moved while the server is
        offline to any known directory. Known directories are those
        defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> variable.
        Directories defined by
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>, and
        <a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a> are automatically
        appended to the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> value
        regardless of whether the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> variable is
        defined explicitly. Those directories and their subdirectories
        are scanned at startup for undo tablespaces files. An undo
        tablespace file moved to any of those directories is discovered
        at startup and assumed to be the undo tablespace that was moved.
      </p><p>
        The default undo tablespaces (<code class="literal">innodb_undo_001</code>
        and <code class="literal">innodb_undo_002</code>) created when the MySQL
        instance is initialized must always reside in the directory
        defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a> variable.
        If the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
        variable is undefined, default undo tablespaces reside in the
        data directory. If default undo tablespaces are moved while the
        server is offline, the server must be started with the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a> variable
        configured to the new directory.
      </p><p>
        The I/O patterns for undo logs make undo tablespaces good
        candidates for <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> storage.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-undo-tablespace-rollback-segments"></a>Configuring the Number of Rollback Segments</h5>

</div>

</div>

</div>
<p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a>
        variable defines the number of
        <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segments</a>
        allocated to each undo tablespace and to the global temporary
        tablespace. The
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a>
        variable can be configured at startup or while the server is
        running.
      </p><p>
        The default setting for
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a> is
        128, which is also the maximum value. For information about the
        number of transactions that a rollback segment supports, see
        <a class="xref" href="innodb-storage-engine.html#innodb-undo-logs" title="15.6.6 Undo Logs">Section 15.6.6, “Undo Logs”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="truncate-undo-tablespace"></a>Truncating Undo Tablespaces</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091650749680"></a><a class="indexterm" name="idm140091650748608"></a><a class="indexterm" name="idm140091650747536"></a><p>
        There are two methods of truncating undo tablespaces, which can
        be used individually or in combination to manage undo tablespace
        size. One method is automated, enabled using configuration
        variables. The other method is manual, performed using SQL
        statements.
      </p><p>
        The automated method does not require monitoring undo tablespace
        size and, once enabled, it performs deactivation, truncation,
        and reactivation of undo tablespaces without manual
        intervention. The manual truncation method may be preferable if
        you want to control when undo tablespaces are taken offline for
        truncation. For example, you may want to avoid truncating undo
        tablespaces during peak workload times.
      </p><h6><a name="idm140091650744880"></a>Automated Truncation</h6><p>
        Automated truncation of undo tablespaces requires a minimum of
        two active undo tablespaces, which ensures that one undo
        tablespace remains active while the other is taken offline to be
        truncated. By default, two undo tablespaces are created when the
        MySQL instance is initialized.
      </p><p>
        To have undo tablespaces automatically truncated, enable the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate"><code class="literal">innodb_undo_log_truncate</code></a>
        variable. For example:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_undo_log_truncate=ON;</code></strong>
</pre><p>
        When the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate"><code class="literal">innodb_undo_log_truncate</code></a>
        variable is enabled, undo tablespaces that exceed the size limit
        defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size"><code class="literal">innodb_max_undo_log_size</code></a>
        variable are subject to truncation. The
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size"><code class="literal">innodb_max_undo_log_size</code></a>
        variable is dynamic and has a default value of 1073741824 bytes
        (1024 MiB).
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@innodb_max_undo_log_size;</code></strong>
+----------------------------+
| @@innodb_max_undo_log_size |
+----------------------------+
|                 1073741824 |
+----------------------------+
</pre><p>
        When the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate"><code class="literal">innodb_undo_log_truncate</code></a>
        variable is enabled:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Default and user-defined undo tablespaces that exceed the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size"><code class="literal">innodb_max_undo_log_size</code></a>
            setting are marked for truncation. Selection of an undo
            tablespace for truncation is performed in a circular fashion
            to avoid truncating the same undo tablespace each time.
          </p></li><li class="listitem"><p>
            Rollback segments residing in the selected undo tablespace
            are made inactive so that they are not assigned to new
            transactions. Existing transactions that are currently using
            rollback segments are permitted to finish.
          </p></li><li class="listitem"><p>
            The <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> system frees
            rollback segments that are no longer in use.
          </p></li><li class="listitem"><p>
            After all rollback segments in the undo tablespace are
            freed, the truncate operation runs and truncates the undo
            tablespace to its initial size. The initial size of an undo
            tablespace depends on the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value. For
            the default 16KB page size, the initial undo tablespace file
            size is 10MiB. For 4KB, 8KB, 32KB, and 64KB page sizes, the
            initial undo tablespace files sizes are 7MiB, 8MiB, 20MiB,
            and 40MiB, respectively.
          </p><p>
            The size of an undo tablespace after a truncate operation
            may be larger than the initial size due to immediate use
            following the completion of the operation.
          </p><p>
            The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
            variable defines the location of default undo tablespace
            files. If the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
            variable is undefined, default undo tablespaces reside in
            the data directory. The location of all undo tablespace
            files including user-defined undo tablespaces created using
            <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE
            UNDO TABLESPACE</code></a> syntax can be determined by
            querying the
            <a class="link" href="information-schema.html#files-table" title="25.11 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a> table:
          </p><pre data-lang="sql" class="programlisting">SELECT TABLESPACE_NAME, FILE_NAME FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE LIKE 'UNDO LOG';</pre></li><li class="listitem"><p>
            Rollback segments are reactivated so that they can be
            assigned to new transactions.
</p></li></ol>
</div>
<h6><a name="idm140091650715152"></a>Manual Truncation</h6><p>
        Manual truncation of undo tablespaces requires a minimum of
        three active undo tablespaces. Two active undo tablespaces are
        required at all times to support the possibility that automated
        truncation is enabled. A minimum of three undo tablespaces
        satisfies this requirement while permitting an undo tablespace
        to be taken offline manually.
      </p><p>
        To manually initiate truncation of an undo tablespace,
        deactivate the undo tablespace by issuing the following
        statement:
      </p><pre data-lang="sql" class="programlisting">
ALTER UNDO TABLESPACE <em class="replaceable"><code>tablespace_name</code></em> SET INACTIVE;
</pre><p>
        After the undo tablespace is marked as inactive, transactions
        currently using rollback segments in the undo tablespace are
        permitted to finish, as are any transactions started before
        those transactions are completed. After transactions are
        completed, the purge system frees the rollback segments in the
        undo tablespace, the undo tablespace is truncated to its initial
        size, and the undo tablespace state changes from
        <code class="literal">inactive</code> to <code class="literal">empty</code>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          When an <code class="literal">ALTER UNDO TABLESPACE
          <em class="replaceable"><code>tablespace_name</code></em> SET
          INACTIVE</code> statement deactivates an undo tablespace,
          the purge thread looks for that undo tablespaces at the next
          opportunity. Once the undo tablespace is found and marked for
          truncation, the purge thread returns with increased frequency
          to quickly empty and truncate the undo tablespace.
</p>
</div>
<p>
        To check the state of an undo tablespace, query the
        <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TABLESPACES</code></a>
        table.
      </p><pre data-lang="sql" class="programlisting">
SELECT NAME, STATE FROM INFORMATION_SCHEMA.INNODB_TABLESPACES 
  WHERE NAME LIKE <em class="replaceable"><code>tablespace_name</code></em>;
</pre><p>
        Once the undo tablespace is in an <code class="literal">empty</code>
        state, it can be reactivated by issuing the following statement:
      </p><pre data-lang="sql" class="programlisting">
ALTER UNDO TABLESPACE <em class="replaceable"><code>tablespace_name</code></em> SET ACTIVE;
</pre><p>
        An undo tablespace in an <code class="literal">empty</code> state can also
        be dropped. See <a class="xref" href="innodb-storage-engine.html#innodb-drop-undo-tablespaces" title="Dropping Undo Tablespaces">Dropping Undo Tablespaces</a>.
      </p><h6><a name="idm140091650699424"></a>Expediting Automated Truncation of Undo Tablespaces</h6><p>
        The purge thread is responsible for emptying and truncating undo
        tablespaces. By default, the purge thread looks for undo
        tablespaces to truncate once every 128 times that purge is
        invoked. The frequency with which the purge thread looks for
        undo tablespaces to truncate is controlled by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency"><code class="literal">innodb_purge_rseg_truncate_frequency</code></a>
        variable, which has a default setting of 128.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@innodb_purge_rseg_truncate_frequency;</code></strong>
+----------------------------------------+
| @@innodb_purge_rseg_truncate_frequency |
+----------------------------------------+
|                                    128 |
+----------------------------------------+
</pre><p>
        To increase that frequency, decrease the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency"><code class="literal">innodb_purge_rseg_truncate_frequency</code></a>
        setting. For example, to have the purge thread look for undo
        tabespaces once every 32 timees that purge is invoked, set
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency"><code class="literal">innodb_purge_rseg_truncate_frequency</code></a>
        to 32.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_purge_rseg_truncate_frequency=32;</code></strong>
</pre><p>
        When the purge thread finds an undo tablespace that requires
        truncation, the purge thread returns with increased frequency to
        quickly empty and truncate the undo tablespace.
      </p><h6><a name="idm140091650689264"></a>Performance Impact of Truncating Undo Tablespace Files</h6><p>
        When an undo tablespace is truncated, the rollback segments in
        the undo tablespace are deactivated. The active rollback
        segments in other undo tablespaces assume responsibility for the
        entire system load, which may result in a slight performance
        degradation. The amount of performance degradation depends on a
        number of factors:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Number of undo tablespaces
          </p></li><li class="listitem"><p>
            Number of undo logs
          </p></li><li class="listitem"><p>
            Undo tablespace size
          </p></li><li class="listitem"><p>
            Speed of the I/O susbsystem
          </p></li><li class="listitem"><p>
            Existing long running transactions
          </p></li><li class="listitem"><p>
            System load
</p></li></ul>
</div>
<p>
        The easiest way to avoid impacting performance when truncating
        undo tablespaces is to increase the number of undo tablespaces.
      </p><h6><a name="idm140091650681808"></a>Monitoring Undo Tablespace Truncation</h6><p>
        As of MySQL 8.0.16, <code class="literal">undo</code> and
        <code class="literal">purge</code> susbsystem counters are provided for
        monitoring background activities associated with undo log
        truncation. For counter names and descriptions, query the
        <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
        table.
      </p><pre data-lang="sql" class="programlisting">
SELECT NAME, SUBSYSTEM, COMMENT FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME LIKE '%truncate%';
</pre><p>
        For information about enabling counters and querying counter
        data, see
        <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-metrics-table" title="15.14.6 InnoDB INFORMATION_SCHEMA Metrics Table">Section 15.14.6, “InnoDB INFORMATION_SCHEMA Metrics Table”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-temporary-tablespace"></a>15.6.3.5 Temporary Tablespaces</h4>

</div>

</div>

</div>
<p>
      <code class="literal">InnoDB</code> uses session temporary tablespaces and a
      global temporary tablespace.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-session-temporary-tablespaces"></a>Session Temporary Tablespaces</h5>
</div>
</div>
</div>
<p>
        Session temporary tablespaces store user-created temporary
        tables and internal temporary tables created by the optimizer
        when <code class="literal">InnoDB</code> is configured as the storage
        engine for on-disk internal temporary tables. Beginning with
        MySQL 8.0.16, the storage engine used for on-disk internal
        temporary tables is always <code class="literal">InnoDB</code>.
        (Previously, the storage engine was determined by the value of
        <a class="link" href="server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine</code></a>.)
      </p><p>
        Session temporary tablespaces are allocated to a session from a
        pool of temporary tablespaces on the first request to create an
        on-disk temporary table. A maximum of two tablespaces is
        allocated to a session, one for user-created temporary tables
        and the other for internal temporary tables created by the
        optimizer. The temporary tablespaces allocated to a session are
        used for all on-disk temporary tables created by the session.
        When a session disconnects, its temporary tablespaces are
        truncated and released back to the pool. A pool of 10 temporary
        tablespaces is created when the server is started. The size of
        the pool never shrinks and tablespaces are added to the pool
        automatically as necessary. The pool of temporary tablespaces is
        removed on normal shutdown or on an aborted initialization.
        Session temporary tablespace files are five pages in size when
        created and have an <code class="filename">.ibt</code> file name
        extension.
      </p><p>
        A range of 400 thousand space IDs is reserved for session
        temporary tablespaces. Because the pool of session temporary
        tablespaces is recreated each time the server is started, space
        IDs for session temporary tablespaces are not persisted when the
        server is shut down and may be reused.
      </p><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_tablespaces_dir"><code class="literal">innodb_temp_tablespaces_dir</code></a>
        variable defines the location where session temporary
        tablespaces are created. The default location is the
        <code class="filename">#innodb_temp</code> directory in the data
        directory. Startup is refused if the pool of temporary
        tablespaces cannot be created.
      </p><pre data-lang="terminal" class="programlisting">
shell&gt; cd <em class="replaceable"><code>BASEDIR</code></em>/data/#innodb_temp
shell&gt; ls
temp_10.ibt  temp_2.ibt  temp_4.ibt  temp_6.ibt  temp_8.ibt
temp_1.ibt   temp_3.ibt  temp_5.ibt  temp_7.ibt  temp_9.ibt
</pre><p>
        In statement based replication (SBR) mode, temporary tables
        created on a slave reside in a single session temporary
        tablespace that is truncated only when the MySQL server is shut
        down.
      </p><p>
        The <a class="link" href="information-schema.html#innodb-session-temp-tablespaces-table" title="25.39.23 The INFORMATION_SCHEMA INNODB_SESSION_TEMP_TABLESPACES Table"><code class="literal">INNODB_SESSION_TEMP_TABLESPACES</code></a>
        table provides metadata about session temporary tablespaces.
      </p><p>
        The
        <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="25.39.28 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TEMP_TABLE_INFO</code></a>
        table provides metadata about user-created temporary tables that
        are active in an <code class="literal">InnoDB</code> instance.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-global-temporary-tablespace"></a>Global Temporary Tablespace</h5>

</div>

</div>

</div>
<p>
        The global temporary tablespace (<code class="filename">ibtmp1</code>)
        stores rollback segments for changes made to user-created
        temporary tables.
      </p><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>
        variable defines the relative path, name, size, and attributes
        for global temporary tablespace data files. If no value is
        specified for
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>, the
        default behavior is to create a single auto-extending data file
        named <code class="filename">ibtmp1</code> in the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> directory.
        The initial file size is slightly larger than 12MB.
      </p><p>
        The global temporary tablespace is removed on normal shutdown or
        on an aborted initialization, and recreated each time the server
        is started. The global temporary tablespace receives a
        dynamically generated space ID when it is created. Startup is
        refused if the global temporary tablespace cannot be created.
        The global temporary tablespace is not removed if the server
        halts unexpectedly. In this case, a database administrator can
        remove the global temporary tablespace manually or restart the
        MySQL server. Restarting the MySQL server removes and recreates
        the global temporary tablespace automatically.
      </p><p>
        The global temporary tablespace cannot reside on a raw device.
      </p><p>
        <a class="link" href="information-schema.html#files-table" title="25.11 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a> provides
        metadata about the global temporary tablespace. Issue a query
        similar to this one to view global temporary tablespace
        metadata:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.FILES WHERE TABLESPACE_NAME='innodb_temporary'\G</code></strong>
</pre><p>
        By default, the global temporary tablespace data file is
        autoextending and increases in size as necessary.
      </p><p>
        To determine if a global temporary tablespace data file is
        autoextending, check the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>
        setting:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@innodb_temp_data_file_path;</code></strong>
+------------------------------+
| @@innodb_temp_data_file_path |
+------------------------------+
| ibtmp1:12M:autoextend        |
+------------------------------+
</pre><p>
        To check the size of global temporary tablespace data files,
        query the <a class="link" href="information-schema.html#files-table" title="25.11 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a>
        table using a query similar to this one:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT FILE_NAME, TABLESPACE_NAME, ENGINE, INITIAL_SIZE, TOTAL_EXTENTS*EXTENT_SIZE</code></strong> 
       <strong class="userinput"><code>AS TotalSizeBytes, DATA_FREE, MAXIMUM_SIZE FROM INFORMATION_SCHEMA.FILES</code></strong> 
       <strong class="userinput"><code>WHERE TABLESPACE_NAME = 'innodb_temporary'\G</code></strong>
*************************** 1. row ***************************
      FILE_NAME: ./ibtmp1
TABLESPACE_NAME: innodb_temporary
         ENGINE: InnoDB
   INITIAL_SIZE: 12582912
 TotalSizeBytes: 12582912
      DATA_FREE: 6291456
   MAXIMUM_SIZE: NULL
</pre><p>
        <code class="literal">TotalSizeBytes</code> shows the current size of the
        global temporary tablespace data file. For information about
        other field values, see <a class="xref" href="information-schema.html#files-table" title="25.11 The INFORMATION_SCHEMA FILES Table">Section 25.11, “The INFORMATION_SCHEMA FILES Table”</a>.
      </p><p>
        Alternatively, check the global temporary tablespace data file
        size on your operating system. The global temporary tablespace
        data file is located in the directory defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>
        variable.
      </p><p>
        To reclaim disk space occupied by a global temporary tablespace
        data file, restart the MySQL server. Restarting the server
        removes and recreates the global temporary tablespace data file
        according to the attributes defined by
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>.
      </p><p>
        To limit the size of the global temporary tablespace data file,
        configure
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a> to
        specify a maximum file size. For example:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_temp_data_file_path=ibtmp1:12M:autoextend:max:500M
</pre><p>
        Configuring
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>
        requires restarting the server.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="tablespace-placing"></a>15.6.3.6 Creating a Tablespace Outside of the Data Directory</h4>

</div>

</div>

</div>
<p>
      The <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
      DATA DIRECTORY</code></a> clause permits creating a
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespace outside of the data directory. For example, you can use
      the <code class="literal">DATA DIRECTORY</code> clause to create a
      tablespace on a separate storage device with particular
      performance or capacity characteristics, such as a fast
      <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> or a high-capacity
      <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a>.
    </p><p>
      Be sure of the location that you choose. The <code class="literal">DATA
      DIRECTORY</code> clause cannot be used with
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to change the location
      later.
    </p><p>
      The tablespace data file is created in the specified directory,
      within in a subdirectory named for the schema to which the table
      belongs.
    </p><p>
      The following example demonstrates creating a file-per-table
      tablespace outside of the data directory. It is assumed that the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> variable is
      enabled.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
Database changed

mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (c1 INT PRIMARY KEY) DATA DIRECTORY = '<em class="replaceable"><code>/remote/directory</code></em>';</code></strong>

# MySQL creates the tablespace file in a subdirectory that is named
# for the schema to which the table belongs

shell&gt; <strong class="userinput"><code>cd /remote/directory/test</code></strong>
shell&gt; <strong class="userinput"><code>ls</code></strong>
t1.ibd
</pre><p>
      When creating a tablespace outside of the data directory, ensure
      that the directory is known to <code class="literal">InnoDB</code>.
      Otherwise, if the server halts unexpectedly before tablespace data
      file pages are fully flushed, startup fails when the tablespace is
      not found during the pre-recovery discovery phase that searches
      known directories for tablespace data files (see
      <a class="xref" href="innodb-storage-engine.html#innodb-recovery-tablespace-discovery" title="Tablespace Discovery During Crash Recovery">Tablespace Discovery During Crash Recovery</a>). To make a
      directory known, add it to the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> argument
      value. <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> is a
      read-only startup option that defines directories to scan at
      startup for tablespace data files. Configuring it requires
      restarting the server.
    </p><p>
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
      TABLESPACE</code></a> syntax can also be used in combination with
      the <code class="literal">DATA DIRECTORY</code> clause to create a
      file-per-table tablespace outside of the data directory. To do so,
      specify <code class="literal">innodb_file_per_table</code> as the tablespace
      name.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t2 (c1 INT PRIMARY KEY) TABLESPACE = innodb_file_per_table</code></strong>
       <strong class="userinput"><code>DATA DIRECTORY = '/remote/directory';</code></strong>
</pre><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      variable does not need to be enabled when using this method.
</p>
<h5><a name="idm140091650595056"></a>Usage Notes:</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MySQL initially holds the tablespace data file open,
          preventing you from dismounting the device, but might
          eventually close the table if the server is busy. Be careful
          not to accidentally dismount an external device while MySQL is
          running, or start MySQL while the device is disconnected.
          Attempting to access a table when the associated tablespace
          data file is missing causes a serious error that requires a
          server restart.
        </p><p>
          A server restart issues errors and warnings if the tablespace
          data file is not at the expected path. In this case, you can
          restore the tablespace data file from a backup or drop the
          table to remove the information about it from the
          <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data dictionary</a>.
        </p></li><li class="listitem"><p>
          Before placing a tablespace on an NFS-mounted volume, review
          potential issues outlined in
          <a class="xref" href="optimization.html#disk-issues-nfs" title="Using NFS with MySQL">Using NFS with MySQL</a>.
        </p></li><li class="listitem"><p>
          If using an LVM snapshot, file copy, or other file-based
          mechanism to back up the tablespace data file, always use the
          <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
          TABLES ... FOR EXPORT</code></a> statement first to ensure that
          all changes buffered in memory are
          <a class="link" href="glossary.html#glos_flush" title="flush">flushed</a> to disk before the
          backup occurs.
        </p></li><li class="listitem"><p>
          Using the <code class="literal">DATA DIRECTORY</code> clause is an
          alternative to <a class="link" href="optimization.html#symbolic-links" title="8.12.2 Using Symbolic Links">using symbolic
          links</a>, which is not supported.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="tablespace-copying"></a>15.6.3.7 Copying Tablespaces to Another Instance</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091650582816"></a><a class="indexterm" name="idm140091650581776"></a><a class="indexterm" name="idm140091650580288"></a><p>
      This section describes how to copy a
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespaces from one MySQL instance to another, otherwise known as
      the <a class="link" href="glossary.html#glos_transportable_tablespace" title="transportable tablespace">Transportable
      Tablespaces</a> feature. This feature also supports partitioned
      <code class="literal">InnoDB</code> tables and individual
      <code class="literal">InnoDB</code> table partitions and subpartitions.
    </p><p>
      For information about other <code class="literal">InnoDB</code> table
      copying methods, see <a class="xref" href="innodb-storage-engine.html#innodb-migration" title="15.6.1.2 Moving or Copying InnoDB Tables">Section 15.6.1.2, “Moving or Copying InnoDB Tables”</a>.
    </p><p>
      There are many reasons why you might copy an
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespace to a different instance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          To run reports without putting extra load on a production
          server.
        </p></li><li class="listitem"><p>
          To set up identical data for a table on a new
          <a class="link" href="glossary.html#glos_slave_server" title="slave server">slave server</a>.
        </p></li><li class="listitem"><p>
          To restore a backed-up version of a table or partition after a
          problem or mistake.
        </p></li><li class="listitem"><p>
          As a faster way of moving data around than importing the
          results of a <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> command. The data is
          available immediately, rather than having to be re-inserted
          and the indexes rebuilt.
        </p></li><li class="listitem"><p>
          To move a
          <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
          tablespace to a server with storage medium that better suits
          system requirements. For example, you may want to have busy
          tables on an <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> device, or
          large tables on a high-capacity
          <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> device.
</p></li></ul>
</div>
<h5><a name="innodb-transportable-tablespace-limitations"></a>Limitations and Usage Notes</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The tablespace copy procedure is only possible when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          enabled, which is the default setting. Tables residing in the
          shared system tablespace cannot be quiesced.
        </p></li><li class="listitem"><p>
          When a table is quiesced, only read-only transactions are
          allowed on the affected table.
        </p></li><li class="listitem"><p>
          When importing a tablespace, the page size must match the page
          size of the importing instance.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          DISCARD TABLESPACE</code></a> is supported for partitioned
          <code class="literal">InnoDB</code> tables, and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          DISCARD PARTITION ... TABLESPACE</code></a> is supported for
          <code class="literal">InnoDB</code> table partitions.
        </p></li><li class="listitem"><p>
          <code class="literal">DISCARD TABLESPACE</code> is not supported for
          tablespaces with a parent-child (primary key-foreign key)
          relationship when
          <a class="link" href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> is set to
          <code class="literal">1</code>. Before discarding a tablespace for
          parent-child tables, set
          <code class="literal">foreign_key_checks=0</code>. Partitioned
          <code class="literal">InnoDB</code> tables do not support foreign keys.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          IMPORT TABLESPACE</code></a> does not enforce foreign key
          constraints on imported data. If there are foreign key
          constraints between tables, all tables should be exported at
          the same (logical) point in time. Partitioned
          <code class="literal">InnoDB</code> tables do not support foreign keys.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          IMPORT TABLESPACE</code></a> and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          IMPORT PARTITION ... TABLESPACE</code></a> do not require a
          <code class="filename">.cfg</code> metadata file to import a
          tablespace. However, metadata checks are not performed when
          importing without a <code class="filename">.cfg</code> file, and a
          warning similar to the following is issued:
        </p><pre data-lang="none" class="programlisting">
Message: InnoDB: IO Read error: (2, No such file or directory) Error opening '.\
test\t.cfg', will attempt to import without schema verification
1 row in set (0.00 sec)
</pre><p>
          The ability to import without a <code class="filename">.cfg</code> file
          may be more convenient when no schema mismatches are expected.
          Additionally, the ability to import without a
          <code class="filename">.cfg</code> file could be useful in crash
          recovery scenarios in which metadata cannot be collected from
          an <code class="filename">.ibd</code> file.
        </p><p>
          If no <code class="filename">.cfg</code> file is used,
          <code class="literal">InnoDB</code> uses the equivalent of a
          <code class="literal">SELECT MAX(ai_col) FROM
          <em class="replaceable"><code>table_name</code></em> FOR UPDATE</code>
          statement to initialize the in-memory auto-increment counter
          that is used in assigning values for to an
          <code class="literal">AUTO_INCREMENT</code> column. Otherwise, the
          current maximum auto-increment counter value is read from the
          <code class="filename">.cfg</code> metadata file. For related
          information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-initialization" title="InnoDB AUTO_INCREMENT Counter Initialization">InnoDB AUTO_INCREMENT Counter Initialization</a>.
        </p></li><li class="listitem"><p>
          Due to a <code class="literal">.cfg</code> metadata file limitation,
          schema mismatches are not reported for partition type or
          partition definition differences when importing tablespace
          files for partitioned tables. Column differences are reported.
        </p></li><li class="listitem"><p>
          When running
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          DISCARD PARTITION ... TABLESPACE</code></a> and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          IMPORT PARTITION ... TABLESPACE</code></a> on subpartitioned
          tables, both partition and subpartition table names are
          allowed. When a partition name is specified, subpartitions of
          that partition are included in the operation.
        </p></li><li class="listitem"><p>
          Importing a tablespace file from another MySQL server instance
          works if both instances have GA (General Availability) status
          and the server instance into which the file is imported is at
          the same or higher release level within the same release
          series. Importing a tablespace file into a server instance
          running an earlier release of MySQL is not supported.
        </p></li><li class="listitem"><p>
          In replication scenarios,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
          set to <code class="literal">ON</code> on both the master and slave.
        </p></li><li class="listitem"><p>
          On Windows, <code class="literal">InnoDB</code> stores database,
          tablespace, and table names internally in lowercase. To avoid
          import problems on case-sensitive operating systems such as
          Linux and UNIX, create all databases, tablespaces, and tables
          using lowercase names. A convenient way to accomplish this is
          to add the following line to the <code class="literal">[mysqld]</code>
          section of your <code class="filename">my.cnf</code> or
          <code class="filename">my.ini</code> file before creating databases,
          tablespaces, or tables:
        </p><pre data-lang="none" class="programlisting">
[mysqld]
lower_case_table_names=1
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            It is prohibited to start the server with a
            <a class="link" href="server-administration.html#sysvar_lower_case_table_names"><code class="literal">lower_case_table_names</code></a>
            setting that is different from the setting used when the
            server was initialized.
</p>
</div>
</li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          DISCARD TABLESPACE</code></a> and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
          ...IMPORT TABLESPACE</code></a> are not supported with tables
          that belong to an <code class="literal">InnoDB</code> general
          tablespace. For more information, see
          <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE TABLESPACE</code></a>.
        </p></li><li class="listitem"><p>
          The default row format for <code class="literal">InnoDB</code> tables is
          configurable using the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          configuration option. Attempting to import a table that does
          not explicitly define a row format
          (<code class="literal">ROW_FORMAT</code>), or that uses
          <code class="literal">ROW_FORMAT=DEFAULT</code>, could result in a
          schema mismatch error if the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          setting on the source instance differs from the setting on the
          destination instance. For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-row-format-defining" title="Defining the Row Format of a Table">Defining the Row Format of a Table</a>.
        </p></li><li class="listitem"><p>
          When exporting an encrypted tablespace,
          <code class="literal">InnoDB</code> generates a
          <code class="filename">.cfp</code> file in addition to a
          <code class="filename">.cfg</code> metadata file. The
          <code class="filename">.cfp</code> file must be copied to the
          destination instance together with the
          <code class="filename">.cfg</code> file and tablespace file before
          performing the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          IMPORT TABLESPACE</code></a> operation on the destination
          instance. The <code class="filename">.cfp</code> file contains a
          transfer key and an encrypted tablespace key. On import,
          <code class="literal">InnoDB</code> uses the transfer key to decrypt the
          tablespace key. For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption" title="15.6.3.9 InnoDB Data-at-Rest Encryption">Section 15.6.3.9, “InnoDB Data-at-Rest Encryption”</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
          TABLES ... FOR EXPORT</code></a> is not supported on tables
          that have a FULLTEXT index. Full-text search auxiliary tables
          are not flushed. After importing a table with a
          <code class="literal">FULLTEXT</code> index, run
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> to rebuild the
          <code class="literal">FULLTEXT</code> indexes. Alternatively, drop
          <code class="literal">FULLTEXT</code> indexes before the export
          operation and recreate them after importing the table on the
          destination instance.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-transportable-tablespace-examples"></a>15.6.3.7.1 Transportable Tablespace Examples</h5>

</div>

</div>

</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          If you are transporting tables that are encrypted using the
          <code class="literal">InnoDB</code> tablespace encryption, see
          <a class="xref" href="innodb-storage-engine.html#innodb-transportable-tablespace-limitations" title="Limitations and Usage Notes">Limitations and Usage Notes</a>
          before you begin for additional procedural information.
</p>
</div>
<h6><a name="idm140091650482272"></a>Example 1: Copying an InnoDB Table to Another Instance</h6><p>
        This procedure demonstrates how to copy a regular
        <code class="literal">InnoDB</code> table from a running MySQL server
        instance to another running instance. The same procedure with
        minor adjustments can be used to perform a full table restore on
        the same instance.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            On the source instance, create a table if one does not
            exist:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE t(c1 INT) ENGINE=InnoDB;</code></strong>
</pre></li><li class="listitem"><p>
            On the destination instance, create a table if one does not
            exist:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE t(c1 INT) ENGINE=InnoDB;</code></strong>
</pre></li><li class="listitem"><p>
            On the destination instance, discard the existing
            tablespace. (Before a tablespace can be imported,
            <code class="literal">InnoDB</code> must discard the tablespace that
            is attached to the receiving table.)
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER TABLE t DISCARD TABLESPACE;</code></strong>
</pre></li><li class="listitem"><p>
            On the source instance, run
            <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
            TABLES ... FOR EXPORT</code></a> to quiesce the table and
            create the <code class="filename">.cfg</code> metadata file:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>FLUSH TABLES t FOR EXPORT;</code></strong>
</pre><p>
            The metadata (<code class="filename">.cfg</code>) is created in the
            <code class="literal">InnoDB</code> data directory.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The
              <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
              TABLES ... FOR EXPORT</code></a> statement ensures that
              changes to the named table have been flushed to disk so
              that a binary table copy can be made while the instance is
              running. When
              <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
              TABLES ... FOR EXPORT</code></a> is run,
              <code class="literal">InnoDB</code> produces a
              <code class="filename">.cfg</code> file in the same database
              directory as the table. The <code class="filename">.cfg</code> file
              contains metadata used for schema verification when
              importing the tablespace file.
</p>
</div>
</li><li class="listitem"><p>
            Copy the <code class="filename">.ibd</code> file and
            <code class="filename">.cfg</code> metadata file from the source
            instance to the destination instance. For example:
          </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>scp <em class="replaceable"><code>/path/to/datadir</code></em>/test/t.{ibd,cfg} destination-server:<em class="replaceable"><code>/path/to/datadir</code></em>/test</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <code class="filename">.ibd</code> file and
              <code class="filename">.cfg</code> file must be copied before
              releasing the shared locks, as described in the next step.
</p>
</div>
</li><li class="listitem"><p>
            On the source instance, use
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> to release the locks acquired by
            <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
            TABLES ... FOR EXPORT</code></a>:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>UNLOCK TABLES;</code></strong>
</pre></li><li class="listitem"><p>
            On the destination instance, import the tablespace:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>ALTER TABLE t IMPORT TABLESPACE;</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE ... IMPORT TABLESPACE</code></a> feature does not
              enforce foreign key constraints on imported data. If there
              are foreign key constraints between tables, all tables
              should be exported at the same (logical) point in time. In
              this case you would stop updating the tables, commit all
              transactions, acquire shared locks on the tables, and then
              perform the export operation.
</p>
</div>
</li></ol>
</div>
<h6><a name="idm140091650437712"></a>Example 2: Copying an InnoDB Partitioned Table to Another Instance</h6><p>
        This procedure demonstrates how to copy a partitioned
        <code class="literal">InnoDB</code> table from a running MySQL server
        instance to another running instance. The same procedure with
        minor adjustments can be used to perform a full restore of a
        partitioned <code class="literal">InnoDB</code> table on the same
        instance.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            On the source instance, create a partitioned table if one
            does not exist. In the following example, a table with three
            partitions (p0, p1, p2) is created:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (i int) ENGINE = InnoDB PARTITION BY KEY (i) PARTITIONS 3;</code></strong>
</pre><p>
            In the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory, there is a separate tablespace
            (<code class="filename">.ibd</code>) file for each of the three
            partitions.
          </p><pre data-lang="terminal" class="programlisting">
mysql&gt; <strong class="userinput"><code>\! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/</code></strong>
t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd
</pre></li><li class="listitem"><p>
            On the destination instance, create the same partitioned
            table:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (i int) ENGINE = InnoDB PARTITION BY KEY (i) PARTITIONS 3;</code></strong>
</pre><p>
            In the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory, there is a separate tablespace
            (<code class="filename">.ibd</code>) file for each of the three
            partitions.
          </p><pre data-lang="terminal" class="programlisting">
mysql&gt; <strong class="userinput"><code>\! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/</code></strong>
t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd
</pre></li><li class="listitem"><p>
            On the destination instance, discard the tablespace for the
            partitioned table. (Before the tablespace can be imported on
            the destination instance, the tablespace that is attached to
            the receiving table must be discarded.)
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER TABLE t1 DISCARD TABLESPACE;</code></strong>
</pre><p>
            The three <code class="filename">.ibd</code> files that make up the
            tablespace for the partitioned table are discarded from the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory.
          </p></li><li class="listitem"><p>
            On the source instance, run
            <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
            TABLES ... FOR EXPORT</code></a> to quiesce the partitioned
            table and create the <code class="filename">.cfg</code> metadata
            files:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>FLUSH TABLES t1 FOR EXPORT;</code></strong>
</pre><p>
            Metadata (<code class="filename">.cfg</code>) files, one for each
            tablespace (<code class="filename">.ibd</code>) file, are created in
            the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory on the source instance:
          </p><pre data-lang="terminal" class="programlisting">
mysql&gt; <strong class="userinput"><code>\! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/</code></strong>
t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd
t1#P#p0.cfg  t1#P#p1.cfg  t1#P#p2.cfg
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
              TABLES ... FOR EXPORT</code></a> statement ensures that
              changes to the named table have been flushed to disk so
              that binary table copy can be made while the instance is
              running. When
              <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
              TABLES ... FOR EXPORT</code></a> is run,
              <code class="literal">InnoDB</code> produces a
              <code class="filename">.cfg</code> metadata file for the table's
              tablespace files in the same database directory as the
              table. The <code class="filename">.cfg</code> files contain
              metadata used for schema verification when importing
              tablespace files.
              <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
              TABLES ... FOR EXPORT</code></a> can only be run on the
              table, not on individual table partitions.
</p>
</div>
</li><li class="listitem"><p>
            Copy the <code class="filename">.ibd</code> and
            <code class="filename">.cfg</code> files from the source instance
            database directory to the destination instance database
            directory. For example:
          </p><pre data-lang="terminal" class="programlisting">
shell&gt;scp <strong class="userinput"><code><em class="replaceable"><code>/path/to/datadir</code></em>/test/t1*.{ibd,cfg} destination-server:<em class="replaceable"><code>/path/to/datadir</code></em>/test</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <code class="filename">.ibd</code> and
              <code class="filename">.cfg</code> files must be copied before
              releasing the shared locks, as described in the next step.
</p>
</div>
</li><li class="listitem"><p>
            On the source instance, use
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> to release the locks acquired by
            <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
            TABLES ... FOR EXPORT</code></a>:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>UNLOCK TABLES;</code></strong>
</pre></li><li class="listitem"><p>
            On the destination instance, import the tablespace for the
            partitioned table:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>ALTER TABLE t1 IMPORT TABLESPACE;</code></strong>
</pre></li></ol>
</div>
<h6><a name="idm140091650379104"></a>Example 3: Copying InnoDB Table Partitions to Another Instance</h6><p>
        This procedure demonstrates how to copy
        <code class="literal">InnoDB</code> table partitions from a running MySQL
        server instance to another running instance. The same procedure
        with minor adjustments can be used to perform a restore of
        <code class="literal">InnoDB</code> table partitions on the same instance.
        In the following example, a partitioned table with four
        partitions (p0, p1, p2, p3) is created on the source instance.
        Two of the partitions (p2 and p3) are copied to the destination
        instance.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            On the source instance, create a partitioned table if one
            does not exist. In the following example, a table with four
            partitions (p0, p1, p2, p3) is created:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (i int) ENGINE = InnoDB PARTITION BY KEY (i) PARTITIONS 4;</code></strong>
</pre><p>
            In the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory, there is a separate tablespace
            (<code class="filename">.ibd</code>) file for each of the four
            partitions.
          </p><pre data-lang="terminal" class="programlisting">
mysql&gt; <strong class="userinput"><code>\! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/</code></strong>
t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd t1#P#p3.ibd
</pre></li><li class="listitem"><p>
            On the destination instance, create the same partitioned
            table:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (i int) ENGINE = InnoDB PARTITION BY KEY (i) PARTITIONS 4;</code></strong>
</pre><p>
            In the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory, there is a separate tablespace
            (<code class="filename">.ibd</code>) file for each of the four
            partitions.
          </p><pre data-lang="terminal" class="programlisting">
mysql&gt; <strong class="userinput"><code>\! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/</code></strong>
t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd t1#P#p3.ibd
</pre></li><li class="listitem"><p>
            On the destination instance, discard the tablespace
            partitions that you plan to import from the source instance.
            (Before tablespace partitions can be imported on the
            destination instance, the corresponding partitions that are
            attached to the receiving table must be discarded.)
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER TABLE t1 DISCARD PARTITION p2, p3 TABLESPACE;</code></strong>
</pre><p>
            The <code class="literal">.ibd</code> files for the two discarded
            partitions are removed from the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory on the destination instance, leaving the following
            files:
          </p><pre data-lang="terminal" class="programlisting">
mysql&gt; <strong class="userinput"><code>\! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/</code></strong>
t1#P#p0.ibd  t1#P#p1.ibd
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              When <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE ... DISCARD PARTITION ... TABLESPACE</code></a> is
              run on subpartitioned tables, both partition and
              subpartition table names are allowed. When a partition
              name is specified, subpartitions of that partition are
              included in the operation.
</p>
</div>
</li><li class="listitem"><p>
            On the source instance, run
            <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
            TABLES ... FOR EXPORT</code></a> to quiesce the partitioned
            table and create the <code class="filename">.cfg</code> metadata
            files.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>FLUSH TABLES t1 FOR EXPORT;</code></strong>
</pre><p>
            The metadata files (<code class="filename">.cfg</code> files) are
            created in the
            <code class="literal">/<em class="replaceable"><code>datadir</code></em>/test</code>
            directory on the source instance. There is a
            <code class="filename">.cfg</code> file for each tablespace
            (<code class="filename">.ibd</code>) file.
          </p><pre data-lang="terminal" class="programlisting">
mysql&gt; <strong class="userinput"><code>\! ls <em class="replaceable"><code>/path/to/datadir</code></em>/test/</code></strong>
t1#P#p0.ibd  t1#P#p1.ibd  t1#P#p2.ibd t1#P#p3.ibd
t1#P#p0.cfg  t1#P#p1.cfg  t1#P#p2.cfg t1#P#p3.cfg
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
              TABLES ... FOR EXPORT</code></a> statement ensures that
              changes to the named table have been flushed to disk so
              that binary table copy can be made while the instance is
              running. When
              <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
              TABLES ... FOR EXPORT</code></a> is run,
              <code class="literal">InnoDB</code> produces a
              <code class="filename">.cfg</code> metadata file for the table's
              tablespace files in the same database directory as the
              table. The <code class="filename">.cfg</code> files contain
              metadata used for schema verification when importing
              tablespace files.
              <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
              TABLES ... FOR EXPORT</code></a> can only be run on the
              table, not on individual table partitions.
</p>
</div>
</li><li class="listitem"><p>
            Copy the <code class="filename">.ibd</code> and
            <code class="filename">.cfg</code> files from the source instance
            database directory to the destination instance database
            directory. In this example, only the
            <code class="filename">.ibd</code> and <code class="filename">.cfg</code>
            files for partition 2 (p2) and partition 3 (p3) are copied
            to the <code class="filename">data</code> directory on the
            destination instance. Partition 0 (p0) and partition 1 (p1)
            remain on the source instance.
          </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>scp t1#P#p2.ibd  t1#P#p2.cfg t1#P#p3.ibd t1#P#p3.cfg destination-server:<em class="replaceable"><code>/path/to/datadir</code></em>/test</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <code class="filename">.ibd</code> files and
              <code class="filename">.cfg</code> files must be copied before
              releasing the shared locks, as described in the next step.
</p>
</div>
</li><li class="listitem"><p>
            On the source instance, use
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> to release the locks acquired by
            <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
            TABLES ... FOR EXPORT</code></a>:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>UNLOCK TABLES;</code></strong>
</pre></li><li class="listitem"><p>
            On the destination instance, import the tablespace
            partitions (p2 and p3):
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>ALTER TABLE t1 IMPORT PARTITION p2, p3 TABLESPACE;</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              When <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
              TABLE ... IMPORT PARTITION ... TABLESPACE</code></a> is run
              on subpartitioned tables, both partition and subpartition
              table names are allowed. When a partition name is
              specified, subpartitions of that partition are included in
              the operation.
</p>
</div>
</li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-transportable-tablespace-internals"></a>15.6.3.7.2 Transportable Tablespace Internals</h5>

</div>

</div>

</div>
<p>
        The following information describes internals and error log
        messaging for the transportable tablespaces copy procedure for a
        regular <code class="literal">InnoDB</code> table.
      </p><p>
        When <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
        ... DISCARD TABLESPACE</code></a> is run on the destination
        instance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The table is locked in X mode.
          </p></li><li class="listitem"><p>
            The tablespace is detached from the table.
</p></li></ul>
</div>
<p>
        When
        <a class="link" href="sql-syntax.html#flush-tables-for-export-with-list"><code class="literal">FLUSH
        TABLES ... FOR EXPORT</code></a> is run on the source instance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The table being flushed for export is locked in shared mode.
          </p></li><li class="listitem"><p>
            The purge coordinator thread is stopped.
          </p></li><li class="listitem"><p>
            Dirty pages are synchronized to disk.
          </p></li><li class="listitem"><p>
            Table metadata is written to the binary
            <code class="filename">.cfg</code> file.
</p></li></ul>
</div>
<p>
        Expected error log messages for this operation:
      </p><pre data-lang="none" class="programlisting">
2013-09-24T13:10:19.903526Z 2 [Note] InnoDB: Sync to disk of '"test"."t"' started.
2013-09-24T13:10:19.903586Z 2 [Note] InnoDB: Stopping purge
2013-09-24T13:10:19.903725Z 2 [Note] InnoDB: Writing table metadata to './test/t.cfg'
2013-09-24T13:10:19.904014Z 2 [Note] InnoDB: Table '"test"."t"' flushed to disk
 </pre><p>
        When <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
        TABLES</code></a> is run on the source instance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The binary .cfg file is deleted.
          </p></li><li class="listitem"><p>
            The shared lock on the table or tables being imported is
            released and the purge coordinator thread is restarted.
</p></li></ul>
</div>
<p>
        Expected error log messages for this operation:
      </p><pre data-lang="none" class="programlisting">
2013-09-24T13:10:21.181104Z 2 [Note] InnoDB: Deleting the meta-data file './test/t.cfg'
2013-09-24T13:10:21.181180Z 2 [Note] InnoDB: Resuming purge
</pre><p>
        When <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
        ... IMPORT TABLESPACE</code></a> is run on the destination
        instance, the import algorithm performs the following operations
        for each tablespace being imported:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Each tablespace page is checked for corruption.
          </p></li><li class="listitem"><p>
            The space ID and log sequence numbers (LSNs) on each page
            are updated
          </p></li><li class="listitem"><p>
            Flags are validated and LSN updated for the header page.
          </p></li><li class="listitem"><p>
            Btree pages are updated.
          </p></li><li class="listitem"><p>
            The page state is set to dirty so that it is written to
            disk.
</p></li></ul>
</div>
<p>
        Expected error log messages for this operation:
      </p><pre data-lang="none" class="programlisting">
2013-07-18 15:15:01 34960 [Note] InnoDB: Importing tablespace for table 'test/t' that was exported from host 'ubuntu'
2013-07-18 15:15:01 34960 [Note] InnoDB: Phase I - Update all pages
2013-07-18 15:15:01 34960 [Note] InnoDB: Sync to disk
2013-07-18 15:15:01 34960 [Note] InnoDB: Sync to disk - done!
2013-07-18 15:15:01 34960 [Note] InnoDB: Phase III - Flush changes to disk
2013-07-18 15:15:01 34960 [Note] InnoDB: Phase IV - Flush complete</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          You may also receive a warning that a tablespace is discarded
          (if you discarded the tablespace for the destination table)
          and a message stating that statistics could not be calculated
          due to a missing <code class="filename">.ibd</code> file:
        </p><pre data-lang="none" class="programlisting">
2013-07-18 15:14:38 34960 [Warning] InnoDB: Table "test"."t" tablespace is set as discarded.
2013-07-18 15:14:38 7f34d9a37700 InnoDB: cannot calculate statistics for table "test"."t" 
because the .ibd file is missing. For help, please refer to
http://dev.mysql.com/doc/refman/8.0/en/innodb-troubleshooting.html
</pre>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-moving-data-files-offline"></a>15.6.3.8 Moving Tablespace Files While the Server is Offline</h4>

</div>

</div>

</div>
<p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> option,
      which defines directories to scan at startup for tablespace files,
      supports moving or restoring tablespace files to a new location
      while the server is offline. During startup, discovered tablespace
      files are used instead those referenced in the data dictionary,
      and the data dictionary is updated to reference the relocated
      files. If duplicate tablespace files are discovered by the scan,
      startup fails with an error indicating that multiple files were
      found for the same tablespace ID.
    </p><p>
      The directories defined by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>,
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>, and
      <a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a> configuration options are
      automatically appended to the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> argument
      value. These directories are scanned at startup regardless of
      whether the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a>
      option is specified explicitly. The implicit addition of these
      directories permits moving system tablespace files, the data
      directory, or undo tablespace files without configuring the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> setting.
      However, settings must be updated when directories change. For
      example, after relocating the data directory, you must update the
      <a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">--datadir</code></a> setting before
      restarting the server.
    </p><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> option may
      be specified in a startup command or MySQL option file. Quotes are
      used around the argument value because otherwise a semicolon (;)
      is interpreted as a special character by some command
      interpreters. (Unix shells treat it as a command terminator, for
      example.)
    </p><p>
      Startup command:
    </p><pre data-lang="terminal" class="programlisting">
mysqld --innodb-directories="<em class="replaceable"><code>directory_path_1</code></em>;<em class="replaceable"><code>directory_path_2</code></em>"
</pre><p>
      MySQL option file:
    </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_directories="<em class="replaceable"><code>directory_path_1</code></em>;<em class="replaceable"><code>directory_path_2</code></em>"
</pre><p>
      The following procedure is applicable to moving individual
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a> and
      <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general tablespace</a>
      files, <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
      tablespace</a> files, <a class="link" href="glossary.html#glos_undo_tablespace" title="undo tablespace">undo
      tablespace</a> files, or the data directory. Before moving
      files or directories, review the usage notes that follow.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Stop the server.
        </p></li><li class="listitem"><p>
          Move the tablespace files or directories.
        </p></li><li class="listitem"><p>
          Make the new directory known to <code class="literal">InnoDB</code>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If moving individual
              <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
              or <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
              tablespace</a> files, add unknown directories to the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> value.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  The directories defined by the
                  <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>,
                  <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>,
                  and <a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a>
                  configuration options are automatically appended to
                  the
                  <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a>
                  argument value, so you need not specify these.
                </p></li><li class="listitem"><p>
                  A file-per-table tablespace file can only be moved to
                  a directory with same name as the schema. For example,
                  if the <code class="literal">actor</code> table belongs to the
                  <code class="literal">sakila</code> schema, then the
                  <code class="filename">actor.ibd</code> data file can only be
                  moved to a directory named
                  <code class="filename">sakila</code>.
                </p></li><li class="listitem"><p>
                  General tablespace files cannot be moved to the data
                  directory or a subdirectory of the data directory.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              If moving system tablespace files, undo tablespaces, or
              the data directory, update the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>,
              and <a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a> settings, as
              necessary.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          Restart the server.
</p></li></ol>
</div>
<h5><a name="idm140091650230464"></a>Usage Notes</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Wildcard expressions cannot be used in the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> argument
          value.
        </p></li><li class="listitem"><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> scan
          also traverses subdirectories of specified directories.
          Duplicate directories and subdirectories are discarded from
          the list of directories to be scanned.
        </p></li><li class="listitem"><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> option
          only supports moving <code class="literal">InnoDB</code> tablespace
          files. Moving files that belong to a storage engine other than
          <code class="literal">InnoDB</code> is not supported. This restriction
          also applies when moving the entire data directory.
        </p></li><li class="listitem"><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> option
          supports renaming of tablespace files when moving files to a
          scanned directory. It also supports moving tablespaces files
          to other supported operating systems.
        </p></li><li class="listitem"><p>
          When moving tablespace files to a different operating system,
          ensure that tablespace file names do not include prohibited
          characters or characters with a special meaning on the
          destination system.
        </p></li><li class="listitem"><p>
          When moving a data directory from a Windows operating system
          to a Linux operating system, modify the binary log file paths
          in the binary log index file to use backward slashes instead
          of forward slashes. By default, the binary log index file has
          the same base name as the binary log file, with the extension
          '<code class="filename">.index</code>'. The location of the binary log
          index file is defined by
          <a class="link" href="replication.html#option_mysqld_log-bin"><code class="option">--log-bin</code></a>. The default location
          is the data directory.
        </p></li><li class="listitem"><p>
          If moving tablespace files to a different operating system
          introduces cross-platform replication, it is the
          responsibility of the Database Administrator to ensure proper
          replication of DDL statements that contain platform-specific
          directories. Statements that permit specifying directories
          include <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE
          TABLE ... DATA DIRECTORY</code></a> and
          <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE TABLESPACE</code></a>.
        </p></li><li class="listitem"><p>
          The directory of file-per-table and general tablespace files
          created with an absolute path or in a location outside of the
          data directory should be added to the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> argument
          value. Otherwise, <code class="literal">InnoDB</code> is not able to
          locate these files during recovery.
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
          DATA DIRECTORY</code></a> and <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE
          TABLESPACE</code></a> permit creation of tablespace files with
          absolute paths. <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE
          TABLESPACE</code></a> also permits tablespace file directories
          that are relative to the data directory. To view tablespace
          file locations, query the
          <a class="link" href="information-schema.html#files-table" title="25.11 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a> table:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT TABLESPACE_NAME, FILE_NAME FROM INFORMATION_SCHEMA.FILES \G</code></strong>
</pre></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE TABLESPACE</code></a> requires that
          the target directory exists and is known to
          <code class="literal">InnoDB</code>. Known directories include those
          implicitly and explicitly defined by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> option.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-tablespace-encryption"></a>15.6.3.9 InnoDB Data-at-Rest Encryption</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091650196144"></a><a class="indexterm" name="idm140091650195040"></a><a class="indexterm" name="idm140091650193968"></a><a class="indexterm" name="idm140091650192896"></a><a class="indexterm" name="idm140091650191808"></a><a class="indexterm" name="idm140091650190736"></a><a class="indexterm" name="idm140091650189664"></a><a class="indexterm" name="idm140091650188592"></a><p>
      <code class="literal">InnoDB</code> supports data-at-rest encryption for
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespaces,
      <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general</a>
      tablespaces, the <code class="literal">mysql</code> system tablespace, redo
      logs, and undo logs.
    </p><p>
      As of MySQL 8.0.16, setting an encryption default for schemas and
      general tablespaces is also supported, which permits DBAs to
      control whether tables created in those schemas and tablespaces
      are encrypted.
    </p><p>
      <code class="literal">InnoDB</code> data-at-rest encryption features and
      capabilities are described under the following topics in this
      section.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-about" title="About Data-at-Rest Encryption">About Data-at-Rest Encryption</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-encryption-prerequisites" title="Encryption Prerequisites">Encryption Prerequisites</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-schema-tablespace-encryption-default" title="Defining an Encryption Default for Schemas and General Tablespaces">Defining an Encryption Default for Schemas and General Tablespaces</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-enabling-disabling" title="File-Per-Table Tablespace Encryption">File-Per-Table Tablespace Encryption</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-general-tablespace-encryption-enabling-disabling" title="General Tablespace Encryption">General Tablespace Encryption</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-mysql-tablespace-encryption-enabling-disabling" title="mysql System Tablespace Encryption">mysql System Tablespace Encryption</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-redo-log" title="Redo Log Encryption">Redo Log Encryption</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-undo-log" title="Undo Log Encryption">Undo Log Encryption</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-master-key-rotation" title="Master Key Rotation">Master Key Rotation</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-recovery" title="Encryption and Recovery">Encryption and Recovery</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-exporting" title="Exporting Encrypted Tablespaces">Exporting Encrypted Tablespaces</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-replication" title="Encryption and Replication">Encryption and Replication</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-identifying" title="Identifying Encrypted Tablespaces and Schemas">Identifying Encrypted Tablespaces and Schemas</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-progress-monitoring" title="Monitoring Encryption Progress">Monitoring Encryption Progress</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-usage-notes" title="Encryption Usage Notes">Encryption Usage Notes</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-limitations" title="Encryption Limitations">Encryption Limitations</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-about"></a>About Data-at-Rest Encryption</h5>

</div>

</div>

</div>
<p>
        <code class="literal">InnoDB</code> uses a two tier encryption key
        architecture, consisting of a master encryption key and
        tablespace keys. When a tablespace is encrypted, a tablespace
        key is encrypted and stored in the tablespace header. When an
        application or authenticated user wants to access encrypted
        tablespace data, <code class="literal">InnoDB</code> uses a master
        encryption key to decrypt the tablespace key. The decrypted
        version of a tablespace key never changes, but the master
        encryption key can be changed as required. This action is
        referred to as <span class="emphasis"><em>master key rotation</em></span>.
      </p><p>
        The data-at-rest encryption feature relies on a keyring plugin
        for master encryption key management.
      </p><p>
        All MySQL editions provide a <code class="literal">keyring_file</code>
        plugin, which stores keyring data in a file local to the server
        host.
      </p><p>
        MySQL Enterprise Edition offers additional keyring plugins:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">keyring_encrypted_file</code> plugin, which
            stores keyring data in an encrypted file local to the server
            host.
          </p></li><li class="listitem"><p>
            The <code class="literal">keyring_okv</code> plugin, which includes a
            KMIP client (KMIP 1.1) that uses a KMIP-compatible product
            as a back end for keyring storage. Supported KMIP-compatible
            products include centralized key management solutions such
            as Oracle Key Vault, Gemalto KeySecure, Thales Vormetric key
            management server, and Fornetix Key Orchestration.
          </p></li><li class="listitem"><p>
            The <code class="literal">keyring_aws</code> plugin, which
            communicates with the Amazon Web Services Key Management
            Service (AWS KMS) as a back end for key generation and uses
            a local file for key storage.
</p></li></ul>
</div>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p>
          The <code class="literal">keyring_file</code> and
          <code class="literal">keyring_encrypted file</code> plugins are not
          intended as regulatory compliance solutions. Security
          standards such as PCI, FIPS, and others require use of key
          management systems to secure, manage, and protect encryption
          keys in key vaults or hardware security modules (HSMs).
</p>
</div>
<p>
        A secure and robust encryption key management solution is
        critical for security and for compliance with various security
        standards. When the data-at-rest encryption feature uses a
        centralized key management solution, the feature is referred to
        as <span class="quote">“<span class="quote">MySQL Enterprise Transparent Data Encryption
        (TDE)</span>”</span>.
      </p><p>
        The data-at-rest encryption feature supports the Advanced
        Encryption Standard (AES) block-based encryption algorithm. It
        uses Electronic Codebook (ECB) block encryption mode for
        tablespace key encryption and Cipher Block Chaining (CBC) block
        encryption mode for data encryption.
      </p><p>
        For frequently asked questions about the data-at-rest encryption
        feature, see <a class="xref" href="faqs.html#faqs-tablespace-encryption" title="A.16 MySQL 8.0 FAQ: InnoDB Data-at-Rest Encryption">Section A.16, “MySQL 8.0 FAQ: InnoDB Data-at-Rest Encryption”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-encryption-prerequisites"></a>Encryption Prerequisites</h5>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A keyring plugin must be installed and configured. Keyring
            plugin installation is performed at startup using the
            <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">early-plugin-load</code></a> option.
            Early loading ensures that the plugin is available prior to
            initialization of the <code class="literal">InnoDB</code> storage
            engine. For keyring plugin installation and configuration
            instructions, see <a class="xref" href="security.html#keyring" title="6.4.4 The MySQL Keyring">Section 6.4.4, “The MySQL Keyring”</a>.
          </p><p>
            Only one keyring plugin can be enabled at a time. Enabling
            multiple keyring plugins is not supported.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
              Once encrypted tablespaces are created in a MySQL
              instance, the keyring plugin that was loaded when creating
              the encrypted tablespace must continue to be loaded at
              startup using the
              <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">early-plugin-load</code></a> option.
              Failing to do so results in errors when starting the
              server and during <code class="literal">InnoDB</code> recovery.
</p>
</div>
<p>
            To verify that a keyring plugin is active, use the
            <a class="link" href="sql-syntax.html#show-plugins" title="13.7.6.25 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a> statement or
            query the
            <a class="link" href="information-schema.html#plugins-table" title="25.18 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a>
            table. For example:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE 'keyring%';</code></strong>
+--------------+---------------+
| PLUGIN_NAME  | PLUGIN_STATUS |
+--------------+---------------+
| keyring_file | ACTIVE        |
+--------------+---------------+
</pre></li><li class="listitem"><p>
            When encrypting production data, ensure that you take steps
            to prevent loss of the master encryption key. <span class="emphasis"><em>If
            the master encryption key is lost, data stored in encrypted
            tablespace files is unrecoverable.</em></span> If you use the
            <code class="literal">keyring_file</code> or
            <code class="literal">keyring_encrypted_file</code> plugin, create a
            backup of the keyring data file immediately after creating
            the first encrypted tablespace, before master key rotation,
            and after master key rotation. The
            <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a>
            configuration option defines the keyring data file location
            for the <code class="literal">keyring_file</code> plugin. The
            <a class="link" href="security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a>
            configuration option defines the keyring data file location
            for the <code class="literal">keyring_encrypted_file</code> plugin. If
            you use the <code class="literal">keyring_okv</code> or
            <code class="literal">keyring_aws</code> plugin, ensure that you have
            performed the necessary configuration. For instructions, see
            <a class="xref" href="security.html#keyring" title="6.4.4 The MySQL Keyring">Section 6.4.4, “The MySQL Keyring”</a>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-schema-tablespace-encryption-default"></a>Defining an Encryption Default for Schemas and General Tablespaces</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091650121184"></a><p>
        As of MySQL 8.0.16, the
        <a class="link" href="server-administration.html#sysvar_default_table_encryption"><code class="literal">default_table_encryption</code></a>
        variable defines the default encryption setting for schemas and
        general tablespaces. <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE
        TABLESPACE</code></a> and
        <a class="link" href="sql-syntax.html#create-database" title="13.1.12 CREATE DATABASE Syntax"><code class="literal">CREATE
        SCHEMA</code></a> operations apply the
        <a class="link" href="server-administration.html#sysvar_default_table_encryption"><code class="literal">default_table_encryption</code></a>
        setting when an <code class="literal">ENCRYPTION</code> clause is not
        specified explicitly.
      </p><p>
        <a class="link" href="sql-syntax.html#alter-database" title="13.1.2 ALTER DATABASE Syntax"><code class="literal">ALTER
        SCHEMA</code></a> and <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">ALTER
        TABLESPACE</code></a> operations do not apply the
        <a class="link" href="server-administration.html#sysvar_default_table_encryption"><code class="literal">default_table_encryption</code></a>
        setting. An <code class="literal">ENCRYPTION</code> clause must be
        specified explicitly to alter the encryption of an existing
        schema or general tablespace.
      </p><p>
        The <a class="link" href="server-administration.html#sysvar_default_table_encryption"><code class="literal">default_table_encryption</code></a>
        variable can be set for an individual client connection or
        globally using
        <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET</code></a>
        syntax. For example, the following statement enables default
        schema and tablespace encryption globally:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; SET GLOBAL default_table_encryption=ON;
</pre><p>
        The default encryption setting for a schema can also be defined
        using the <code class="literal">DEFAULT ENCRYPTION</code> clause when
        creating or altering a schema, as in this example:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; CREATE SCHEMA test DEFAULT ENCRYPTION = 'Y';
</pre><p>
        If the <code class="literal">DEFAULT ENCRYPTION</code> clause is not
        specified when creating a schema, the
        <a class="link" href="server-administration.html#sysvar_default_table_encryption"><code class="literal">default_table_encryption</code></a>
        setting is applied. The <code class="literal">DEFAULT ENCRYPTION</code>
        clause must be specified to alter the default encryption of an
        existing schema. Otherwise, the schema retains its current
        encryption setting.
      </p><p>
        By default, a table inherits the encryption setting of the
        schema or general tablespace it is created in. For example, a
        table created in an encryption-enabled schema is encrypted by
        default. This behavior enables a DBA to control table encryption
        usage by defining and enforcing schema and general tablespace
        encryption defaults.
      </p><p>
        Encryption defaults are enforced by enabling the
        <a class="link" href="server-administration.html#sysvar_table_encryption_privilege_check"><code class="literal">table_encryption_privilege_check</code></a>
        variable. When
        <a class="link" href="server-administration.html#sysvar_table_encryption_privilege_check"><code class="literal">table_encryption_privilege_check</code></a>
        is enabled, a privilege check occurs when creating or altering a
        schema or general tablespace with an encryption setting that
        differs from the
        <a class="link" href="server-administration.html#sysvar_default_table_encryption"><code class="literal">default_table_encryption</code></a>
        setting, or when creating or altering a table with an encryption
        setting that differs from the default schema encryption. When
        <a class="link" href="server-administration.html#sysvar_table_encryption_privilege_check"><code class="literal">table_encryption_privilege_check</code></a>
        is disabled (the default), the privilege check does not occur
        and the previously mentioned operations are permitted to proceed
        with a warning.
      </p><p>
        The <a class="link" href="security.html#priv_table-encryption-admin"><code class="literal">TABLE_ENCRYPTION_ADMIN</code></a>
        privilege is required to override default encryption settings
        when
        <a class="link" href="server-administration.html#sysvar_table_encryption_privilege_check"><code class="literal">table_encryption_privilege_check</code></a>
        is enabled. A DBA can grant this privilege to enable a user to
        deviate from the
        <a class="link" href="server-administration.html#sysvar_default_table_encryption"><code class="literal">default_table_encryption</code></a>
        setting when creating or altering a schema or general
        tablespace, or to deviate from the default schema encryption
        when creating or altering a table. This privilege does not
        permit deviating from the encryption of a general tablespace
        when creating or altering a table. A table must have the same
        encryption setting as the general tablespace it resides in.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-enabling-disabling"></a>File-Per-Table Tablespace Encryption</h5>

</div>

</div>

</div>
<p>
        As of MySQL 8.0.16, a file-per-table tablespace inherits the
        default encryption of the schema in which the table is created
        unless an <code class="literal">ENCRYPTION</code> clause is specified
        explcitly in the <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
        statement. Prior to MySQL 8.0.16, the
        <code class="literal">ENCRYPTION</code> clause must be specified to enable
        encryption.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (c1 INT) ENCRYPTION = 'Y';</code></strong>
</pre><p>
        To alter the encryption of an existing file-per-table
        tablespace, an <code class="literal">ENCRYPTION</code> clause must be
        specified.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER TABLE t1 ENCRYPTION = 'Y';</code></strong>
</pre><p>
        As of MySQL 8.0.16, if the
        <a class="link" href="server-administration.html#sysvar_table_encryption_privilege_check"><code class="literal">table_encryption_privilege_check</code></a>
        variable is enabled, specifying an <code class="literal">ENCRYPTION</code>
        clause with a setting that differs from the default schema
        encryption requires the
        <a class="link" href="security.html#priv_table-encryption-admin"><code class="literal">TABLE_ENCRYPTION_ADMIN</code></a> privilege.
        See
        <a class="xref" href="innodb-storage-engine.html#innodb-schema-tablespace-encryption-default" title="Defining an Encryption Default for Schemas and General Tablespaces">Defining an Encryption Default for Schemas and General Tablespaces</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-general-tablespace-encryption-enabling-disabling"></a>General Tablespace Encryption</h5>

</div>

</div>

</div>
<p>
        As of MySQL 8.0.16, the
        <a class="link" href="server-administration.html#sysvar_default_table_encryption"><code class="literal">default_table_encryption</code></a>
        variable determines the encryption of a newly created general
        tablespace unless an <code class="literal">ENCRYPTION</code> clause is
        specified explicitly in the <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE
        TABLESPACE</code></a> statement. Prior to MySQL 8.0.16, an
        <code class="literal">ENCRYPTION</code> clause must be specified to enable
        encryption.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLESPACE `ts1` ADD DATAFILE 'ts1.ibd' ENCRYPTION = 'Y' Engine=InnoDB;</code></strong>
</pre><p>
        To alter the encryption of an existing general tablespace, an
        <code class="literal">ENCRYPTION</code> clause must be specified.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER TABLESPACE ts1 ENCRYPTION = 'Y';</code></strong>
</pre><p>
        As of MySQL 8.0.16, if the
        <a class="link" href="server-administration.html#sysvar_table_encryption_privilege_check"><code class="literal">table_encryption_privilege_check</code></a>
        variable is enabled, specifying an <code class="literal">ENCRYPTION</code>
        clause with a setting that differs from the
        <a class="link" href="server-administration.html#sysvar_default_table_encryption"><code class="literal">default_table_encryption</code></a>
        setting requires the
        <a class="link" href="security.html#priv_table-encryption-admin"><code class="literal">TABLE_ENCRYPTION_ADMIN</code></a> privilege.
        See
        <a class="xref" href="innodb-storage-engine.html#innodb-schema-tablespace-encryption-default" title="Defining an Encryption Default for Schemas and General Tablespaces">Defining an Encryption Default for Schemas and General Tablespaces</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-mysql-tablespace-encryption-enabling-disabling"></a>mysql System Tablespace Encryption</h5>

</div>

</div>

</div>
<p>
        Encryption support for the <code class="literal">mysql</code> system
        tablespace is available as of MySQL 8.0.16.
      </p><p>
        The <code class="literal">mysql</code> system tablespace contains the
        <code class="literal">mysql</code> system database and MySQL data
        dictionary tables. It is unencrypted by default. To enable
        encryption for the <code class="literal">mysql</code> system tablespace,
        specify the tablespace name and the
        <code class="literal">ENCRYPTION</code> option in an
        <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">ALTER TABLESPACE</code></a> statement.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; ALTER TABLESPACE mysql ENCRYPTION = 'Y';
</pre><p>
        To disable encryption for the <code class="literal">mysql</code> system
        tablespace, set <code class="literal">ENCRYPTION = 'N'</code> using an
        <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">ALTER TABLESPACE</code></a> statement.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; ALTER TABLESPACE mysql ENCRYPTION = 'N';
</pre><p>
        Enabling or disabling encryption for the
        <code class="literal">mysql</code> system tablespace requires the
        <a class="link" href="security.html#priv_create-tablespace"><code class="literal">CREATE TABLESPACE</code></a> privilege on
        all tables in the instance (<code class="literal">CREATE TABLESPACE on
        *.*)</code>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-redo-log"></a>Redo Log Encryption</h5>

</div>

</div>

</div>
<p>
        Redo log data encryption is enabled using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_redo_log_encrypt"><code class="literal">innodb_redo_log_encrypt</code></a>
        configuration option. Redo log encryption is disabled by
        default.
      </p><p>
        As with tablespace data, redo log data encryption occurs when
        redo log data is written to disk, and decryption occurs when
        redo log data is read from disk. Once redo log data is read into
        memory, it is in unencrypted form. Redo log data is encrypted
        and decrypted using the tablespace encryption key.
      </p><p>
        When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_redo_log_encrypt"><code class="literal">innodb_redo_log_encrypt</code></a> is
        enabled, unencrypted redo log pages that are present on disk
        remain unencrypted, and new redo log pages are written to disk
        in encrypted form. Likewise, when
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_redo_log_encrypt"><code class="literal">innodb_redo_log_encrypt</code></a> is
        disabled, encrypted redo log pages that are present on disk
        remain encrypted, and new redo log pages are written to disk in
        unencrypted form.
      </p><p>
        Redo log encryption metadata, including the tablespace
        encryption key, is stored in the header of the first redo log
        file (<code class="filename">ib_logfile0</code>). If this file is
        removed, redo log encryption is disabled.
      </p><p>
        Once redo log encryption is enabled, a normal restart without
        the keyring plugin or without the encryption key is not
        possible, as <code class="literal">InnoDB</code> must be able to scan redo
        pages during startup, which is not possible if redo log pages
        are encrypted. Without the keyring plugin or the encryption key,
        only a forced startup without the redo logs
        (<code class="literal">SRV_FORCE_NO_LOG_REDO</code>) is possible. See
        <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="15.20.2 Forcing InnoDB Recovery">Section 15.20.2, “Forcing InnoDB Recovery”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-undo-log"></a>Undo Log Encryption</h5>

</div>

</div>

</div>
<p>
        Undo log data encryption is enabled using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_encrypt"><code class="literal">innodb_undo_log_encrypt</code></a>
        configuration option. Undo log encryption applies to undo logs
        that reside in <a class="link" href="glossary.html#glos_undo_tablespace" title="undo tablespace">undo
        tablespaces</a>. See
        <a class="xref" href="innodb-storage-engine.html#innodb-undo-tablespaces" title="15.6.3.4 Undo Tablespaces">Section 15.6.3.4, “Undo Tablespaces”</a>. Undo log data
        encryption is disabled by default.
      </p><p>
        As with tablespace data, undo log data encryption occurs when
        undo log data is written to disk, and decryption occurs when
        undo log data is read from disk. Once undo log data is read into
        memory, it is in unencrypted form. Undo log data is encrypted
        and decrypted using the tablespace encryption key.
      </p><p>
        When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_encrypt"><code class="literal">innodb_undo_log_encrypt</code></a> is
        enabled, unencrypted undo log pages that are present on disk
        remain unencrypted, and new undo log pages are written to disk
        in encrypted form. Likewise, when
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_encrypt"><code class="literal">innodb_undo_log_encrypt</code></a> is
        disabled, encrypted undo log pages that are present on disk
        remain encrypted, and new undo log pages are written to disk in
        unencrypted form.
      </p><p>
        Undo log encryption metadata, including the tablespace
        encryption key, is stored in the header of the undo log file.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-master-key-rotation"></a>Master Key Rotation</h5>

</div>

</div>

</div>
<p>
        The master encryption key should be rotated periodically and
        whenever you suspect that the key has been compromised.
      </p><p>
        Master key rotation is an atomic, instance-level operation. Each
        time the master encryption key is rotated, all tablespace keys
        in the MySQL instance are re-encrypted and saved back to their
        respective tablespace headers. As an atomic operation,
        re-encryption must succeed for all tablespace keys once a
        rotation operation is initiated. If master key rotation is
        interrupted by a server failure, <code class="literal">InnoDB</code> rolls
        the operation forward on server restart. For more information,
        see <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-recovery" title="Encryption and Recovery">Encryption and Recovery</a>.
      </p><p>
        Rotating the master encryption key only changes the master
        encryption key and re-encrypts tablespace keys. It does not
        decrypt or re-encrypt associated tablespace data.
      </p><p>
        Rotating the master encryption key requires the
        <a class="link" href="security.html#priv_encryption-key-admin"><code class="literal">ENCRYPTION_KEY_ADMIN</code></a> or
        <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege.
      </p><p>
        To rotate the master encryption key, run:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER INSTANCE ROTATE INNODB MASTER KEY;</code></strong>
</pre><p>
        <a class="link" href="sql-syntax.html#alter-instance-rotate-innodb-master-key"><code class="literal">ALTER INSTANCE ROTATE INNODB MASTER
        KEY</code></a> supports concurrent DML. However, it cannot be run
        concurrently with tablespace encryption operations, and locks
        are taken to prevent conflicts that could arise from concurrent
        execution. If an <a class="link" href="sql-syntax.html#alter-instance-rotate-innodb-master-key"><code class="literal">ALTER INSTANCE ROTATE
        INNODB MASTER KEY</code></a> operation is running, it must finish
        before a tablespace encryption operation can proceed, and vice
        versa.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-recovery"></a>Encryption and Recovery</h5>

</div>

</div>

</div>
<p>
        If a server failure occurs during an encryption operation, the
        operation is rolled forward when the server is restarted. For
        general tablespaces, the encryption operation is resumed in a
        background thread from the last processed page.
      </p><p>
        If a server failure occurs during master key rotation,
        <code class="literal">InnoDB</code> continues the operation on server
        restart.
      </p><p>
        The keyring plugin must be loaded prior to storage engine
        initialization so that the information necessary to decrypt
        tablespace data pages can be retrieved from tablespace headers
        before <code class="literal">InnoDB</code> initialization and recovery
        activities access tablespace data. (See
        <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-encryption-prerequisites" title="Encryption Prerequisites">Encryption Prerequisites</a>.)
      </p><p>
        When <code class="literal">InnoDB</code> initialization and recovery
        begin, the master key rotation operation resumes. Due to the
        server failure, some tablespace keys may already be encrypted
        using the new master encryption key. <code class="literal">InnoDB</code>
        reads the encryption data from each tablespace header, and if
        the data indicates that the tablespace key is encrypted using
        the old master encryption key, <code class="literal">InnoDB</code>
        retrieves the old key from the keyring and uses it to decrypt
        the tablespace key. <code class="literal">InnoDB</code> then re-encrypts
        the tablespace key using the new master encryption key and saves
        the re-encrypted tablespace key back to the tablespace header.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-exporting"></a>Exporting Encrypted Tablespaces</h5>

</div>

</div>

</div>
<p>
        Tablespace export is only supported for file-per-table
        tablespaces.
      </p><p>
        When an encrypted tablespace is exported,
        <code class="literal">InnoDB</code> generates a <span class="emphasis"><em>transfer
        key</em></span> that is used to encrypt the tablespace key. The
        encrypted tablespace key and transfer key are stored in a
        <code class="filename"><em class="replaceable"><code>tablespace_name</code></em>.cfp</code>
        file. This file together with the encrypted tablespace file is
        required to perform an import operation. On import,
        <code class="literal">InnoDB</code> uses the transfer key to decrypt the
        tablespace key in the
        <code class="filename"><em class="replaceable"><code>tablespace_name</code></em>.cfp</code>
        file. For related information, see
        <a class="xref" href="innodb-storage-engine.html#tablespace-copying" title="15.6.3.7 Copying Tablespaces to Another Instance">Section 15.6.3.7, “Copying Tablespaces to Another Instance”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-replication"></a>Encryption and Replication</h5>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <a class="link" href="sql-syntax.html#alter-instance-rotate-innodb-master-key"><code class="literal">ALTER INSTANCE ROTATE INNODB MASTER
            KEY</code></a> statement is only supported in replication
            environments where the master and slaves run a version of
            MySQL that supports tablespace encryption.
          </p></li><li class="listitem"><p>
            Successful <a class="link" href="sql-syntax.html#alter-instance-rotate-innodb-master-key"><code class="literal">ALTER INSTANCE ROTATE INNODB
            MASTER KEY</code></a> statements are written to the binary
            log for replication on slaves.
          </p></li><li class="listitem"><p>
            If an <a class="link" href="sql-syntax.html#alter-instance-rotate-innodb-master-key"><code class="literal">ALTER INSTANCE ROTATE INNODB
            MASTER KEY</code></a> statement fails, it is not logged to
            the binary log and is not replicated on slaves.
          </p></li><li class="listitem"><p>
            Replication of an <a class="link" href="sql-syntax.html#alter-instance-rotate-innodb-master-key"><code class="literal">ALTER INSTANCE ROTATE
            INNODB MASTER KEY</code></a> operation fails if the keyring
            plugin is installed on the master but not on the slave.
          </p></li><li class="listitem"><p>
            If the <code class="literal">keyring_file</code> or
            <code class="literal">keyring_encrypted_file</code> plugin is
            installed on both the master and a slave but the slave does
            not have a keyring data file, the replicated
            <a class="link" href="sql-syntax.html#alter-instance-rotate-innodb-master-key"><code class="literal">ALTER INSTANCE ROTATE INNODB MASTER
            KEY</code></a> statement creates the keyring data file on the
            slave, assuming the keyring file data is not cached in
            memory. <a class="link" href="sql-syntax.html#alter-instance-rotate-innodb-master-key"><code class="literal">ALTER INSTANCE ROTATE INNODB
            MASTER KEY</code></a> uses keyring file data that is cached
            in memory, if available.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-identifying"></a>Identifying Encrypted Tablespaces and Schemas</h5>

</div>

</div>

</div>
<p>
        The
        <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TABLESPACES</code></a>
        table, introduced in MySQL 8.0.13, includes an
        <code class="literal">ENCRYPTION</code> column that can be used to
        identify encrypted tablespaces.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SPACE, NAME, SPACE_TYPE, ENCRYPTION FROM INFORMATION_SCHEMA.INNODB_TABLESPACES</code></strong>
       <strong class="userinput"><code>WHERE ENCRYPTION='Y'\G</code></strong>
*************************** 1. row ***************************
     SPACE: 4294967294
      NAME: mysql
SPACE_TYPE: General
ENCRYPTION: Y
*************************** 2. row ***************************
     SPACE: 2
      NAME: test/t1
SPACE_TYPE: Single
ENCRYPTION: Y
*************************** 3. row ***************************
     SPACE: 3
      NAME: ts1
SPACE_TYPE: General
ENCRYPTION: Y     
</pre><p>
        When the <code class="literal">ENCRYPTION</code> option is specified in a
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement, it is
        recorded in the <code class="literal">CREATE_OPTIONS</code> column of
        <a class="link" href="information-schema.html#tables-table" title="25.30 The INFORMATION_SCHEMA TABLES Table"><code class="literal">INFORMATION_SCHEMA.TABLES</code></a>. This
        column can be queried to identify tables that reside in
        encrypted file-per-table tablespaces.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT TABLE_SCHEMA, TABLE_NAME, CREATE_OPTIONS FROM INFORMATION_SCHEMA.TABLES</code></strong>
       <strong class="userinput"><code>WHERE CREATE_OPTIONS LIKE '%ENCRYPTION%';</code></strong>
+--------------+------------+----------------+
| TABLE_SCHEMA | TABLE_NAME | CREATE_OPTIONS |
+--------------+------------+----------------+
| test         | t1         | ENCRYPTION="Y" |
+--------------+------------+----------------+
</pre><p>
        Query
        <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TABLESPACES</code></a>
        to retrieve information about the tablespace associated with a
        particular schema and table.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SPACE, NAME, SPACE_TYPE FROM INFORMATION_SCHEMA.INNODB_TABLESPACES WHERE NAME='test/t1';</code></strong>
+-------+---------+------------+
| SPACE | NAME    | SPACE_TYPE |
+-------+---------+------------+
|     3 | test/t1 | Single     |
+-------+---------+------------+
</pre><p>
        You can identify encryption-enabled schemas by querying the
        <a class="link" href="information-schema.html#schemata-table" title="25.24 The INFORMATION_SCHEMA SCHEMATA Table"><code class="literal">INFORMATION_SCHEMA.SCHEMATA</code></a> table.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SCHEMA_NAME, DEFAULT_ENCRYPTION FROM INFORMATION_SCHEMA.SCHEMATA</code></strong>
       <strong class="userinput"><code>WHERE DEFAULT_ENCRYPTION='YES';</code></strong> 
+-------------+--------------------+
| SCHEMA_NAME | DEFAULT_ENCRYPTION |
+-------------+--------------------+
| test        | YES                |
+-------------+--------------------+
</pre><p>
        <a class="link" href="sql-syntax.html#show-create-database" title="13.7.6.6 SHOW CREATE DATABASE Syntax"><code class="literal">SHOW
        CREATE SCHEMA</code></a> also shows the <code class="literal">DEFAULT
        ENCRYPTION</code> clause.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-progress-monitoring"></a>Monitoring Encryption Progress</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091649949168"></a><a class="indexterm" name="idm140091649947680"></a><p>
        You can monitor general tablespace and <code class="literal">mysql</code>
        system tablespace encryption progress using
        <a class="link" href="performance-schema.html" title="Chapter 26 MySQL Performance Schema">Performance Schema</a>.
      </p><p>
        The <code class="literal">stage/innodb/alter tablespace
        (encryption)</code> stage event instrument reports
        <code class="literal">WORK_ESTIMATED</code> and
        <code class="literal">WORK_COMPLETED</code> information for general
        tablespace encryption operations.
      </p><p>
        The following example demonstrates how to enable the
        <code class="literal">stage/innodb/alter tablespace (encryption)</code>
        stage event instrument and related consumer tables to monitor
        general tablespace or <code class="literal">mysql</code> system tablespace
        encryption progress. For information about Performance Schema
        stage event instruments and related consumers, see
        <a class="xref" href="performance-schema.html#performance-schema-stage-tables" title="26.12.5 Performance Schema Stage Event Tables">Section 26.12.5, “Performance Schema Stage Event Tables”</a>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Enable the <code class="literal">stage/innodb/alter tablespace
            (encryption)</code> instrument:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE performance_schema;</code></strong>
mysql&gt; <strong class="userinput"><code>UPDATE setup_instruments SET ENABLED = 'YES'</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE 'stage/innodb/alter tablespace (encryption)';</code></strong>
</pre></li><li class="listitem"><p>
            Enable the stage event consumer tables, which include
            <a class="link" href="performance-schema.html#events-stages-current-table" title="26.12.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a>,
            <a class="link" href="performance-schema.html#events-stages-history-table" title="26.12.5.2 The events_stages_history Table"><code class="literal">events_stages_history</code></a>, and
            <a class="link" href="performance-schema.html#events-stages-history-long-table" title="26.12.5.3 The events_stages_history_long Table"><code class="literal">events_stages_history_long</code></a>.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>UPDATE setup_consumers SET ENABLED = 'YES' WHERE NAME LIKE '%stages%';</code></strong>
</pre></li><li class="listitem"><p>
            Run a tablespace encryption operation. In this example, a
            general tablespace named <code class="literal">ts1</code> is
            encrypted.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER TABLESPACE ts1 ENCRYPTION = 'Y';</code></strong>
</pre></li><li class="listitem"><p>
            Check the progress of the encryption operation by querying
            the Performance Schema
            <a class="link" href="performance-schema.html#events-stages-current-table" title="26.12.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a> table.
            <code class="literal">WORK_ESTIMATED</code> reports the total number
            of pages in the tablespace.
            <code class="literal">WORK_COMPLETED</code> reports the number of
            pages processed.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT EVENT_NAME, WORK_ESTIMATED, WORK_COMPLETED FROM events_stages_current;</code></strong>
+--------------------------------------------+----------------+----------------+
| EVENT_NAME                                 | WORK_COMPLETED | WORK_ESTIMATED |
+--------------------------------------------+----------------+----------------+
| stage/innodb/alter tablespace (encryption) |           1056 |           1407 |
+--------------------------------------------+----------------+----------------+
</pre><p>
            The <a class="link" href="performance-schema.html#events-stages-current-table" title="26.12.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a> table
            returns an empty set if the encryption operation has
            completed. In this case, you can check the
            <a class="link" href="performance-schema.html#events-stages-history-table" title="26.12.5.2 The events_stages_history Table"><code class="literal">events_stages_history</code></a> table to
            view event data for the completed operation. For example:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT EVENT_NAME, WORK_COMPLETED, WORK_ESTIMATED FROM events_stages_history;</code></strong>
+--------------------------------------------+----------------+----------------+
| EVENT_NAME                                 | WORK_COMPLETED | WORK_ESTIMATED |
+--------------------------------------------+----------------+----------------+
| stage/innodb/alter tablespace (encryption) |           1407 |           1407 |
+--------------------------------------------+----------------+----------------+
</pre></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-usage-notes"></a>Encryption Usage Notes</h5>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Plan appropriately when altering an existing file-per-table
            tablespace with the <code class="literal">ENCRYPTION</code> option.
            Tables residing in file-per-table tablespaces are rebuilt
            using the <code class="literal">COPY</code> algorithm. The
            <code class="literal">INPLACE</code> algorithm is used when altering
            the <code class="literal">ENCRYPTION</code> attribute of a general
            tablespace or the <code class="literal">mysql</code> system
            tablespace. The <code class="literal">INPLACE</code> algorithm permits
            concurrent DML on tables that reside in the general
            tablespace. Concurrent DDL is blocked.
          </p></li><li class="listitem"><p>
            When a general tablespace or the <code class="literal">mysql</code>
            system tablespace is encrypted, all tables residing in the
            tablespace are encrypted. Likewise, a table created in an
            encrypted tablespace is encrypted.
          </p></li><li class="listitem"><p>
            If the server exits or is stopped during normal operation,
            it is recommended to restart the server using the same
            encryption settings that were configured previously.
          </p></li><li class="listitem"><p>
            The first master encryption key is generated when the first
            new or existing tablespace is encrypted.
          </p></li><li class="listitem"><p>
            Master key rotation re-encrypts tablespaces keys but does
            not change the tablespace key itself. To change a tablespace
            key, you must disable and re-enable encryption. For
            file-per-table tablespaces, re-encrypting the tablespace is
            an <code class="literal">ALGORITHM=COPY</code> operation that rebuilds
            the table. For general tablespaces and the
            <code class="literal">mysql</code> system tablespace, it is an
            <code class="literal">ALGORITHM=INPLACE</code> operation, which does
            not require rebuilding tables that reside in the tablespace.
          </p></li><li class="listitem"><p>
            If a table is created with both the
            <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">COMPRESSION</code></a>
            and
            <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">ENCRYPTION</code></a>
            options, compression is performed before tablespace data is
            encrypted.
          </p></li><li class="listitem"><p>
            If a keyring data file (the file named by
            <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> or
            <a class="link" href="security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a>)
            is empty or missing, the first execution of
            <a class="link" href="sql-syntax.html#alter-instance-rotate-innodb-master-key"><code class="literal">ALTER INSTANCE ROTATE INNODB MASTER
            KEY</code></a> creates a master encryption key.
          </p></li><li class="listitem"><p>
            Uninstalling the <code class="literal">keyring_file</code> or
            <code class="literal">keyring_encrypted_file</code> plugin does not
            remove an existing keyring data file.
          </p></li><li class="listitem"><p>
            It is recommended that you not place a keyring data file
            under the same directory as tablespace data files.
          </p></li><li class="listitem"><p>
            Modifying the
            <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> or
            <a class="link" href="security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a>
            setting at runtime or when restarting the server can cause
            previously encrypted tablespaces to become inaccessible,
            resulting in lost data.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-tablespace-encryption-limitations"></a>Encryption Limitations</h5>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Advanced Encryption Standard (AES) is the only supported
            encryption algorithm. <code class="literal">InnoDB</code> tablespace
            encryption uses Electronic Codebook (ECB) block encryption
            mode for tablespace key encryption and Cipher Block Chaining
            (CBC) block encryption mode for data encryption.
          </p></li><li class="listitem"><p>
            Encryption is only supported for
            <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
            tablespaces,
            <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general</a>
            tablespaces, and the <code class="literal">mysql</code> system
            tablespace. Encryption support for general tablespaces was
            introduced in MySQL 8.0.13. Encryption support for the
            <code class="literal">mysql</code> system tablespace is available as
            of MySQL 8.0.16. Encryption is not supported for other
            tablespace types including the <code class="literal">InnoDB</code>
            <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
            tablespace</a>.
          </p></li><li class="listitem"><p>
            You cannot move or copy a table from an encrypted
            <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
            tablespace,
            <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general</a>
            tablespace, or the <code class="literal">mysql</code> system
            tablespace to a tablespace type that does not support
            encryption.
          </p></li><li class="listitem"><p>
            You cannot move or copy a table from an encrypted tablespace
            to an unencrypted tablespace. However, moving a table from
            an unencrypted tablespace to an encrypted one is permitted.
            For example, you can move or copy a table from a unencrypted
            <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a> or
            <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general</a>
            tablespace to an encrypted general tablespace.
          </p></li><li class="listitem"><p>
            By default, tablespace encryption only applies to data in
            the tablespace. Redo log and undo log data can be encrypted
            by enabling
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_redo_log_encrypt"><code class="literal">innodb_redo_log_encrypt</code></a> and
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_encrypt"><code class="literal">innodb_undo_log_encrypt</code></a>.
            See <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-redo-log" title="Redo Log Encryption">Redo Log Encryption</a>,
            and <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-undo-log" title="Undo Log Encryption">Undo Log Encryption</a>.
            Binary log data is not encrypted.
          </p></li><li class="listitem"><p>
            It is not permitted to change the storage engine of a table
            that resides in, or previously resided in, an encrypted
            tablespace.
</p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-doublewrite-buffer"></a>15.6.4 Doublewrite Buffer</h3>

</div>

</div>

</div>
<p>
      The doublewrite buffer is a storage area located in the system
      tablespace where <code class="literal">InnoDB</code> writes pages that are
      flushed from the <code class="literal">InnoDB</code> buffer pool, before the
      pages are written to their proper positions in the data file. Only
      after flushing and writing pages to the doublewrite buffer, does
      <code class="literal">InnoDB</code> write pages to their proper positions.
      If there is an operating system, storage subsystem, or
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process crash in the middle of a page
      write, <code class="literal">InnoDB</code> can later find a good copy of the
      page from the doublewrite buffer during crash recovery.
    </p><p>
      Although data is always written twice, the doublewrite buffer does
      not require twice as much I/O overhead or twice as many I/O
      operations. Data is written to the doublewrite buffer itself as a
      large sequential chunk, with a single <code class="literal">fsync()</code>
      call to the operating system.
    </p><p>
      The doublewrite buffer is enabled by default in most cases. To
      disable the doublewrite buffer, set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a> to 0.
    </p><p>
      If system tablespace files (<span class="quote">“<span class="quote">ibdata files</span>”</span>) are
      located on Fusion-io devices that support atomic writes,
      doublewrite buffering is automatically disabled and Fusion-io
      atomic writes are used for all data files. Because the doublewrite
      buffer setting is global, doublewrite buffering is also disabled
      for data files residing on non-Fusion-io hardware. This feature is
      only supported on Fusion-io hardware and is only enabled for
      Fusion-io NVMFS on Linux. To take full advantage of this feature,
      an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> setting of
      <code class="literal">O_DIRECT</code> is recommended.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-redo-log"></a>15.6.5 Redo Log</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091649846960"></a><a class="indexterm" name="idm140091649845472"></a><p>
      The redo log is a disk-based data structure used during crash
      recovery to correct data written by incomplete transactions.
      During normal operations, the redo log encodes requests to change
      table data that result from SQL statements or low-level API calls.
      Modifications that did not finish updating the data files before
      an unexpected shutdown are replayed automatically during
      initialization, and before the connections are accepted. For
      information about the role of the redo log in crash recovery, see
      <a class="xref" href="innodb-storage-engine.html#innodb-recovery" title="15.17.2 InnoDB Recovery">Section 15.17.2, “InnoDB Recovery”</a>.
    </p><p>
      By default, the redo log is physically represented on disk by two
      files named <code class="filename">ib_logfile0</code> and
      <code class="filename">ib_logfile1</code>. MySQL writes to the redo log
      files in a circular fashion. Data in the redo log is encoded in
      terms of records affected; this data is collectively referred to
      as redo. The passage of data through the redo log is represented
      by an ever-increasing <a class="link" href="glossary.html#glos_lsn" title="LSN">LSN</a> value.
    </p><p>
      For related information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-startup-log-file-configuration" title="Redo Log File Configuration">Redo Log File Configuration</a>, and
      <a class="xref" href="optimization.html#optimizing-innodb-logging" title="8.5.4 Optimizing InnoDB Redo Logging">Section 8.5.4, “Optimizing InnoDB Redo Logging”</a>.
    </p><p>
      For information about data-at-rest encryption for redo logs, see
      <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-redo-log" title="Redo Log Encryption">Redo Log Encryption</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-redo-log-file-reconfigure"></a>Changing the Number or Size of Redo Log Files</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091649834656"></a><a class="indexterm" name="idm140091649833168"></a><p>
        To change the number or the size of
        <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> files, perform the
        following steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Stop the MySQL server and make sure that it shuts down
            without errors.
          </p></li><li class="listitem"><p>
            Edit <code class="filename">my.cnf</code> to change the log file
            configuration. To change the log file size, configure
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>. To
            increase the number of log files, configure
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>.
          </p></li><li class="listitem"><p>
            Start the MySQL server again.
</p></li></ol>
</div>
<p>
        If <code class="literal">InnoDB</code> detects that the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> differs
        from the redo log file size, it writes a log checkpoint, closes
        and removes the old log files, creates new log files at the
        requested size, and opens the new log files.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-performance-group_commit"></a>Group Commit for Redo Log Flushing</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091649820096"></a><p>
        <code class="literal">InnoDB</code>, like any other
        <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a>-compliant database engine,
        flushes the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> of a
        transaction before it is committed. <code class="literal">InnoDB</code>
        uses <a class="link" href="glossary.html#glos_group_commit" title="group commit">group commit</a>
        functionality to group multiple such flush requests together to
        avoid one flush for each commit. With group commit,
        <code class="literal">InnoDB</code> issues a single write to the log file
        to perform the commit action for multiple user transactions that
        commit at about the same time, significantly improving
        throughput.
      </p><p>
        For more information about performance of
        <code class="literal">COMMIT</code> and other transactional operations,
        see <a class="xref" href="optimization.html#optimizing-innodb-transaction-management" title="8.5.2 Optimizing InnoDB Transaction Management">Section 8.5.2, “Optimizing InnoDB Transaction Management”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-undo-logs"></a>15.6.6 Undo Logs</h3>

</div>

</div>

</div>
<p>
      An undo log is a collection of undo log records associated with a
      single read-write transaction. An undo log record contains
      information about how to undo the latest change by a transaction
      to a <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
      record. If another transaction needs to see the original data as
      part of a consistent read operation, the unmodified data is
      retrieved from undo log records. Undo logs exist within
      <a class="link" href="glossary.html#glos_undo_log_segment" title="undo log segment">undo log segments</a>,
      which are contained within
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segments</a>.
      Rollback segments reside in
      <a class="link" href="glossary.html#glos_undo_tablespace" title="undo tablespace">undo tablespaces</a> and
      in the <a class="link" href="glossary.html#glos_global_temporary_tablespace" title="global temporary tablespace">global
      temporary tablespace</a>.
    </p><p>
      Undo logs that reside in the global temporary tablespace are used
      for transactions that modify data in user-defined temporary
      tables. These undo logs are not redo-logged, as they are not
      required for crash recovery. They are used only for rollback while
      the server is running. This type of undo log benefits performance
      by avoiding redo logging I/O.
    </p><p>
      For information about data-at-rest encryption for undo logs, see
      <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-undo-log" title="Undo Log Encryption">Undo Log Encryption</a>.
    </p><p>
      Each undo tablespace and the global temporary tablespace
      individually support a maximum of 128 rollback segments. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a> variable
      defines the number of rollback segments.
    </p><p>
      The number of transactions that a rollback segment supports
      depends on the number of undo slots in the rollback segment and
      the number of undo logs required by each transaction.
    </p><p>
      The number of undo slots in a rollback segment differs according
      to <code class="literal">InnoDB</code> page size.
</p>
<div class="informaltable">
<table summary="Number of undo slots in a rollback segment for each InnoDB page size"><col width="50%"><col width="50%"><thead><tr>
          <th scope="col">InnoDB Page Size</th>
          <th scope="col">Number of Undo Slots in a Rollback Segment (InnoDB Page Size / 16)</th>
        </tr></thead><tbody><tr>
          <td scope="row"><code class="literal">4096 (4KB)</code></td>
          <td><code class="literal">256</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">8192 (8KB)</code></td>
          <td><code class="literal">512</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">16384 (16KB)</code></td>
          <td><code class="literal">1024</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">32768 (32KB)</code></td>
          <td><code class="literal">2048</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">65536 (64KB)</code></td>
          <td><code class="literal">4096</code></td>
</tr></tbody></table>
</div>
<p>
      A transaction is assigned up to four undo logs, one for each of
      the following operation types:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> operations on
          user-defined tables
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations on
          user-defined tables
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> operations on
          user-defined temporary tables
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations on
          user-defined temporary tables
</p></li></ol>
</div>
<p>
      Undo logs are assigned as needed. For example, a transaction that
      performs <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations on regular and
      temporary tables requires a full assignment of four undo logs. A
      transaction that performs only
      <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> operations on regular tables
      requires a single undo log.
    </p><p>
      A transaction that performs operations on regular tables is
      assigned undo logs from an assigned undo tablespace rollback
      segment. A transaction that performs operations on temporary
      tables is assigned undo logs from an assigned global temporary
      tablespace rollback segment.
    </p><p>
      An undo log assigned to a transaction remains tied to the
      transaction for its duration. For example, an undo log assigned to
      a transaction for an <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>
      operation on a regular table is used for all
      <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> operations on regular tables
      performed by that transaction.
    </p><p>
      Given the factors described above, the following formulas can be
      used to estimate the number of concurrent read-write transactions
      that <code class="literal">InnoDB</code> is capable of supporting.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        A transaction can encounter a concurrent transaction limit error
        before reaching the number of concurrent read-write transactions
        that <code class="literal">InnoDB</code> is capable of supporting. This
        occurs when a rollback segment assigned to a transaction runs
        out of undo slots. In such cases, try rerunning the transaction.
      </p><p>
        When transactions perform operations on temporary tables, the
        number of concurrent read-write transactions that
        <code class="literal">InnoDB</code> is capable of supporting is
        constrained by the number of rollback segments allocated to the
        global temporary tablespace, which is 128 by default.
</p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If each transaction performs either an
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>
          <span class="bold"><strong>or</strong></span> an
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operation, the number of
          concurrent read-write transactions that
          <code class="literal">InnoDB</code> is capable of supporting is:
        </p><pre data-lang="none" class="programlisting">
(innodb_page_size / 16) * innodb_rollback_segments * number of undo tablespaces
</pre></li><li class="listitem"><p>
          If each transaction performs an
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>
          <span class="bold"><strong>and</strong></span> an
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operation, the number of
          concurrent read-write transactions that
          <code class="literal">InnoDB</code> is capable of supporting is:
        </p><pre data-lang="none" class="programlisting">
(innodb_page_size / 16 / 2) * innodb_rollback_segments * number of undo tablespaces
</pre></li><li class="listitem"><p>
          If each transaction performs an
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> operation on a temporary
          table, the number of concurrent read-write transactions that
          <code class="literal">InnoDB</code> is capable of supporting is:
        </p><pre data-lang="none" class="programlisting">
(innodb_page_size / 16) * innodb_rollback_segments 
</pre></li><li class="listitem"><p>
          If each transaction performs an
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>
          <span class="bold"><strong>and</strong></span> an
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operation on a temporary
          table, the number of concurrent read-write transactions that
          <code class="literal">InnoDB</code> is capable of supporting is:
        </p><pre data-lang="none" class="programlisting">
(innodb_page_size / 16 / 2) * innodb_rollback_segments 
</pre></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-locking-transaction-model"></a>15.7 InnoDB Locking and Transaction Model</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locking">15.7.1 InnoDB Locking</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transaction-model">15.7.2 InnoDB Transaction Model</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locks-set">15.7.3 Locks Set by Different SQL Statements in InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-next-key-locking">15.7.4 Phantom Rows</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-deadlocks">15.7.5 Deadlocks in InnoDB</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091649724448"></a><a class="indexterm" name="idm140091649722960"></a><a class="indexterm" name="idm140091649721472"></a><a class="indexterm" name="idm140091649720400"></a><p>
    To implement a large-scale, busy, or highly reliable database
    application, to port substantial code from a different database
    system, or to tune MySQL performance, it is important to understand
    <code class="literal">InnoDB</code> locking and the <code class="literal">InnoDB</code>
    transaction model.
  </p><p>
    This section discusses several topics related to
    <code class="literal">InnoDB</code> locking and the <code class="literal">InnoDB</code>
    transaction model with which you should be familiar.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="xref" href="innodb-storage-engine.html#innodb-locking" title="15.7.1 InnoDB Locking">Section 15.7.1, “InnoDB Locking”</a> describes lock types used by
        <code class="literal">InnoDB</code>.
      </p></li><li class="listitem"><p>
        <a class="xref" href="innodb-storage-engine.html#innodb-transaction-model" title="15.7.2 InnoDB Transaction Model">Section 15.7.2, “InnoDB Transaction Model”</a> describes transaction
        isolation levels and the locking strategies used by each. It
        also discusses the use of
        <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a>, consistent
        non-locking reads, and locking reads.
      </p></li><li class="listitem"><p>
        <a class="xref" href="innodb-storage-engine.html#innodb-locks-set" title="15.7.3 Locks Set by Different SQL Statements in InnoDB">Section 15.7.3, “Locks Set by Different SQL Statements in InnoDB”</a> discusses specific types of
        locks set in <code class="literal">InnoDB</code> for various statements.
      </p></li><li class="listitem"><p>
        <a class="xref" href="innodb-storage-engine.html#innodb-next-key-locking" title="15.7.4 Phantom Rows">Section 15.7.4, “Phantom Rows”</a> describes how
        <code class="literal">InnoDB</code> uses next-key locking to avoid phantom
        rows.
      </p></li><li class="listitem"><p>
        <a class="xref" href="innodb-storage-engine.html#innodb-deadlocks" title="15.7.5 Deadlocks in InnoDB">Section 15.7.5, “Deadlocks in InnoDB”</a> provides a deadlock example,
        discusses deadlock detection and rollback, and provides tips for
        minimizing and handling deadlocks in <code class="literal">InnoDB</code>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-locking"></a>15.7.1 InnoDB Locking</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091649701376"></a><a class="indexterm" name="idm140091649699888"></a><a class="indexterm" name="idm140091649698400"></a><a class="indexterm" name="idm140091649696912"></a><a class="indexterm" name="idm140091649695424"></a><a class="indexterm" name="idm140091649693936"></a><a class="indexterm" name="idm140091649692448"></a><a class="indexterm" name="idm140091649690960"></a><a class="indexterm" name="idm140091649689472"></a><a class="indexterm" name="idm140091649687984"></a><a class="indexterm" name="idm140091649686496"></a><a class="indexterm" name="idm140091649685424"></a><a class="indexterm" name="idm140091649684352"></a><a class="indexterm" name="idm140091649683280"></a><a class="indexterm" name="idm140091649682208"></a><a class="indexterm" name="idm140091649681136"></a><a class="indexterm" name="idm140091649680064"></a><p>
      This section describes lock types used by
      <code class="literal">InnoDB</code>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-shared-exclusive-locks" title="Shared and Exclusive Locks">Shared and Exclusive Locks</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-intention-locks" title="Intention Locks">Intention Locks</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-record-locks" title="Record Locks">Record Locks</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-gap-locks" title="Gap Locks">Gap Locks</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-next-key-locks" title="Next-Key Locks">Next-Key Locks</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-insert-intention-locks" title="Insert Intention Locks">Insert Intention Locks</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-auto-inc-locks" title="AUTO-INC Locks">AUTO-INC Locks</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-predicate-locks" title="Predicate Locks for Spatial Indexes">Predicate Locks for Spatial Indexes</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-shared-exclusive-locks"></a>Shared and Exclusive Locks</h4>

</div>

</div>

</div>
<p>
        <code class="literal">InnoDB</code> implements standard row-level locking
        where there are two types of locks,
        <a class="link" href="glossary.html#glos_shared_lock" title="shared lock">shared (<code class="literal">S</code>)
        locks</a> and <a class="link" href="glossary.html#glos_exclusive_lock" title="exclusive lock">exclusive
        (<code class="literal">X</code>) locks</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A <a class="link" href="glossary.html#glos_shared_lock" title="shared lock">shared
            (<code class="literal">S</code>) lock</a> permits the transaction
            that holds the lock to read a row.
          </p></li><li class="listitem"><p>
            An <a class="link" href="glossary.html#glos_exclusive_lock" title="exclusive lock">exclusive
            (<code class="literal">X</code>) lock</a> permits the transaction
            that holds the lock to update or delete a row.
</p></li></ul>
</div>
<p>
        If transaction <code class="literal">T1</code> holds a shared
        (<code class="literal">S</code>) lock on row <code class="literal">r</code>, then
        requests from some distinct transaction <code class="literal">T2</code>
        for a lock on row <code class="literal">r</code> are handled as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A request by <code class="literal">T2</code> for an
            <code class="literal">S</code> lock can be granted immediately. As a
            result, both <code class="literal">T1</code> and <code class="literal">T2</code>
            hold an <code class="literal">S</code> lock on <code class="literal">r</code>.
          </p></li><li class="listitem"><p>
            A request by <code class="literal">T2</code> for an
            <code class="literal">X</code> lock cannot be granted immediately.
</p></li></ul>
</div>
<p>
        If a transaction <code class="literal">T1</code> holds an exclusive
        (<code class="literal">X</code>) lock on row <code class="literal">r</code>, a
        request from some distinct transaction <code class="literal">T2</code> for
        a lock of either type on <code class="literal">r</code> cannot be granted
        immediately. Instead, transaction <code class="literal">T2</code> has to
        wait for transaction <code class="literal">T1</code> to release its lock
        on row <code class="literal">r</code>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-intention-locks"></a>Intention Locks</h4>

</div>

</div>

</div>
<p>
        <code class="literal">InnoDB</code> supports <span class="emphasis"><em>multiple
        granularity locking</em></span> which permits coexistence of row
        locks and table locks. For example, a statement such as
        <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
        WRITE</code></a> takes an exclusive lock (an <code class="literal">X</code>
        lock) on the specified table. To make locking at multiple
        granularity levels practical, <code class="literal">InnoDB</code> uses
        <a class="link" href="glossary.html#glos_intention_lock" title="intention lock">intention locks</a>.
        Intention locks are table-level locks that indicate which type
        of lock (shared or exclusive) a transaction requires later for a
        row in a table. There are two types of intention locks:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            An <a class="link" href="glossary.html#glos_intention_shared_lock" title="intention shared lock">intention
            shared lock</a> (<code class="literal">IS</code>) indicates that a
            transaction intends to set a <span class="emphasis"><em>shared</em></span>
            lock on individual rows in a table.
          </p></li><li class="listitem"><p>
            An <a class="link" href="glossary.html#glos_intention_exclusive_lock" title="intention exclusive lock">intention
            exclusive lock</a> (<code class="literal">IX</code>) indicates that
            a transaction intends to set an exclusive lock on individual
            rows in a table.
</p></li></ul>
</div>
<p>
        For example, <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ...
        FOR SHARE</code></a> sets an <code class="literal">IS</code> lock, and
        <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ... FOR
        UPDATE</code></a> sets an <code class="literal">IX</code> lock.
      </p><p>
        The intention locking protocol is as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Before a transaction can acquire a shared lock on a row in a
            table, it must first acquire an <code class="literal">IS</code> lock
            or stronger on the table.
          </p></li><li class="listitem"><p>
            Before a transaction can acquire an exclusive lock on a row
            in a table, it must first acquire an <code class="literal">IX</code>
            lock on the table.
</p></li></ul>
</div>
<p>
        Table-level lock type compatibility is summarized in the
        following matrix.
</p>
<div class="informaltable">
<table summary='A matrix showing table-level lock type compatibility. Each cell in the matrix is marked as either "Compatible" or "Conflict".'><col width="20%"><col width="20%"><col width="20%"><col width="20%"><col width="20%"><thead><tr>
            <th scope="col"></th>
            <th scope="col"><code class="literal">X</code></th>
            <th scope="col"><code class="literal">IX</code></th>
            <th scope="col"><code class="literal">S</code></th>
            <th scope="col"><code class="literal">IS</code></th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">X</code></td>
            <td>Conflict</td>
            <td>Conflict</td>
            <td>Conflict</td>
            <td>Conflict</td>
          </tr><tr>
            <td scope="row"><code class="literal">IX</code></td>
            <td>Conflict</td>
            <td>Compatible</td>
            <td>Conflict</td>
            <td>Compatible</td>
          </tr><tr>
            <td scope="row"><code class="literal">S</code></td>
            <td>Conflict</td>
            <td>Conflict</td>
            <td>Compatible</td>
            <td>Compatible</td>
          </tr><tr>
            <td scope="row"><code class="literal">IS</code></td>
            <td>Conflict</td>
            <td>Compatible</td>
            <td>Compatible</td>
            <td>Compatible</td>
</tr></tbody></table>
</div>
<p>
        A lock is granted to a requesting transaction if it is
        compatible with existing locks, but not if it conflicts with
        existing locks. A transaction waits until the conflicting
        existing lock is released. If a lock request conflicts with an
        existing lock and cannot be granted because it would cause
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>, an error occurs.
      </p><p>
        Intention locks do not block anything except full table requests
        (for example, <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
        TABLES ... WRITE</code></a>). The main purpose of intention locks
        is to show that someone is locking a row, or going to lock a row
        in the table.
      </p><p>
        Transaction data for an intention lock appears similar to the
        following in <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW
        ENGINE INNODB STATUS</code></a> and
        <a class="link" href="innodb-storage-engine.html#innodb-standard-monitor" title="15.16.3 InnoDB Standard Monitor and Lock Monitor Output">InnoDB monitor</a>
        output:
      </p><pre data-lang="sql" class="programlisting">
TABLE LOCK table `test`.`t` trx id 10080 lock mode IX
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-record-locks"></a>Record Locks</h4>

</div>

</div>

</div>
<p>
        A record lock is a lock on an index record. For example,
        <code class="literal">SELECT c1 FROM t WHERE c1 = 10 FOR UPDATE;</code>
        prevents any other transaction from inserting, updating, or
        deleting rows where the value of <code class="literal">t.c1</code> is
        <code class="literal">10</code>.
      </p><p>
        Record locks always lock index records, even if a table is
        defined with no indexes. For such cases,
        <code class="literal">InnoDB</code> creates a hidden clustered index and
        uses this index for record locking. See
        <a class="xref" href="innodb-storage-engine.html#innodb-index-types" title="15.6.2.1 Clustered and Secondary Indexes">Section 15.6.2.1, “Clustered and Secondary Indexes”</a>.
      </p><p>
        Transaction data for a record lock appears similar to the
        following in <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW
        ENGINE INNODB STATUS</code></a> and
        <a class="link" href="innodb-storage-engine.html#innodb-standard-monitor" title="15.16.3 InnoDB Standard Monitor and Lock Monitor Output">InnoDB monitor</a>
        output:
      </p><pre data-lang="sql" class="programlisting">
RECORD LOCKS space id 58 page no 3 n bits 72 index `PRIMARY` of table `test`.`t` 
trx id 10078 lock_mode X locks rec but not gap
Record lock, heap no 2 PHYSICAL RECORD: n_fields 3; compact format; info bits 0
 0: len 4; hex 8000000a; asc     ;;
 1: len 6; hex 00000000274f; asc     'O;;
 2: len 7; hex b60000019d0110; asc        ;;
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-gap-locks"></a>Gap Locks</h4>

</div>

</div>

</div>
<p>
        A gap lock is a lock on a gap between index records, or a lock
        on the gap before the first or after the last index record. For
        example, <code class="literal">SELECT c1 FROM t WHERE c1 BETWEEN 10 and 20
        FOR UPDATE;</code> prevents other transactions from inserting
        a value of <code class="literal">15</code> into column
        <code class="literal">t.c1</code>, whether or not there was already any
        such value in the column, because the gaps between all existing
        values in the range are locked.
      </p><p>
        A gap might span a single index value, multiple index values, or
        even be empty.
      </p><p>
        Gap locks are part of the tradeoff between performance and
        concurrency, and are used in some transaction isolation levels
        and not others.
      </p><p>
        Gap locking is not needed for statements that lock rows using a
        unique index to search for a unique row. (This does not include
        the case that the search condition includes only some columns of
        a multiple-column unique index; in that case, gap locking does
        occur.) For example, if the <code class="literal">id</code> column has a
        unique index, the following statement uses only an index-record
        lock for the row having <code class="literal">id</code> value 100 and it
        does not matter whether other sessions insert rows in the
        preceding gap:
      </p><pre data-lang="sql" class="programlisting">
SELECT * FROM child WHERE id = 100;
</pre><p>
        If <code class="literal">id</code> is not indexed or has a nonunique
        index, the statement does lock the preceding gap.
      </p><p>
        It is also worth noting here that conflicting locks can be held
        on a gap by different transactions. For example, transaction A
        can hold a shared gap lock (gap S-lock) on a gap while
        transaction B holds an exclusive gap lock (gap X-lock) on the
        same gap. The reason conflicting gap locks are allowed is that
        if a record is purged from an index, the gap locks held on the
        record by different transactions must be merged.
      </p><p>
        Gap locks in <code class="literal">InnoDB</code> are <span class="quote">“<span class="quote">purely
        inhibitive</span>”</span>, which means that their only purpose is to
        prevent other transactions from inserting to the gap. Gap locks
        can co-exist. A gap lock taken by one transaction does not
        prevent another transaction from taking a gap lock on the same
        gap. There is no difference between shared and exclusive gap
        locks. They do not conflict with each other, and they perform
        the same function.
      </p><p>
        Gap locking can be disabled explicitly. This occurs if you
        change the transaction isolation level to
        <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>. Under these
        circumstances, gap locking is disabled for searches and index
        scans and is used only for foreign-key constraint checking and
        duplicate-key checking.
      </p><p>
        There are also other effects of using the
        <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level. Record locks for nonmatching rows are released after
        MySQL has evaluated the <code class="literal">WHERE</code> condition. For
        <code class="literal">UPDATE</code> statements, <code class="literal">InnoDB</code>
        does a <span class="quote">“<span class="quote">semi-consistent</span>”</span> read, such that it returns
        the latest committed version to MySQL so that MySQL can
        determine whether the row matches the <code class="literal">WHERE</code>
        condition of the <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-next-key-locks"></a>Next-Key Locks</h4>

</div>

</div>

</div>
<p>
        A next-key lock is a combination of a record lock on the index
        record and a gap lock on the gap before the index record.
      </p><p>
        <code class="literal">InnoDB</code> performs row-level locking in such a
        way that when it searches or scans a table index, it sets shared
        or exclusive locks on the index records it encounters. Thus, the
        row-level locks are actually index-record locks. A next-key lock
        on an index record also affects the <span class="quote">“<span class="quote">gap</span>”</span> before
        that index record. That is, a next-key lock is an index-record
        lock plus a gap lock on the gap preceding the index record. If
        one session has a shared or exclusive lock on record
        <code class="literal">R</code> in an index, another session cannot insert
        a new index record in the gap immediately before
        <code class="literal">R</code> in the index order.
      </p><p>
        Suppose that an index contains the values 10, 11, 13, and 20.
        The possible next-key locks for this index cover the following
        intervals, where a round bracket denotes exclusion of the
        interval endpoint and a square bracket denotes inclusion of the
        endpoint:
      </p><pre data-lang="none" class="programlisting">
(negative infinity, 10]
(10, 11]
(11, 13]
(13, 20]
(20, positive infinity)
</pre><p>
        For the last interval, the next-key lock locks the gap above the
        largest value in the index and the <span class="quote">“<span class="quote">supremum</span>”</span>
        pseudo-record having a value higher than any value actually in
        the index. The supremum is not a real index record, so, in
        effect, this next-key lock locks only the gap following the
        largest index value.
      </p><p>
        By default, <code class="literal">InnoDB</code> operates in
        <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> transaction
        isolation level. In this case, <code class="literal">InnoDB</code> uses
        next-key locks for searches and index scans, which prevents
        phantom rows (see <a class="xref" href="innodb-storage-engine.html#innodb-next-key-locking" title="15.7.4 Phantom Rows">Section 15.7.4, “Phantom Rows”</a>).
      </p><p>
        Transaction data for a next-key lock appears similar to the
        following in <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW
        ENGINE INNODB STATUS</code></a> and
        <a class="link" href="innodb-storage-engine.html#innodb-standard-monitor" title="15.16.3 InnoDB Standard Monitor and Lock Monitor Output">InnoDB monitor</a>
        output:
      </p><pre data-lang="sql" class="programlisting">
RECORD LOCKS space id 58 page no 3 n bits 72 index `PRIMARY` of table `test`.`t` 
trx id 10080 lock_mode X
Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0
 0: len 8; hex 73757072656d756d; asc supremum;;

Record lock, heap no 2 PHYSICAL RECORD: n_fields 3; compact format; info bits 0
 0: len 4; hex 8000000a; asc     ;;
 1: len 6; hex 00000000274f; asc     'O;;
 2: len 7; hex b60000019d0110; asc        ;;
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-insert-intention-locks"></a>Insert Intention Locks</h4>

</div>

</div>

</div>
<p>
        An insert intention lock is a type of gap lock set by
        <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> operations prior to row
        insertion. This lock signals the intent to insert in such a way
        that multiple transactions inserting into the same index gap
        need not wait for each other if they are not inserting at the
        same position within the gap. Suppose that there are index
        records with values of 4 and 7. Separate transactions that
        attempt to insert values of 5 and 6, respectively, each lock the
        gap between 4 and 7 with insert intention locks prior to
        obtaining the exclusive lock on the inserted row, but do not
        block each other because the rows are nonconflicting.
      </p><p>
        The following example demonstrates a transaction taking an
        insert intention lock prior to obtaining an exclusive lock on
        the inserted record. The example involves two clients, A and B.
      </p><p>
        Client A creates a table containing two index records (90 and
        102) and then starts a transaction that places an exclusive lock
        on index records with an ID greater than 100. The exclusive lock
        includes a gap lock before record 102:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE child (id int(11) NOT NULL, PRIMARY KEY(id)) ENGINE=InnoDB;</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO child (id) values (90),(102);</code></strong>

mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT * FROM child WHERE id &gt; 100 FOR UPDATE;</code></strong>
+-----+
| id  |
+-----+
| 102 |
+-----+
</pre><p>
        Client B begins a transaction to insert a record into the gap.
        The transaction takes an insert intention lock while it waits to
        obtain an exclusive lock.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO child (id) VALUES (101);</code></strong>
</pre><p>
        Transaction data for an insert intention lock appears similar to
        the following in
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> and
        <a class="link" href="innodb-storage-engine.html#innodb-standard-monitor" title="15.16.3 InnoDB Standard Monitor and Lock Monitor Output">InnoDB monitor</a>
        output:
      </p><pre data-lang="sql" class="programlisting">
RECORD LOCKS space id 31 page no 3 n bits 72 index `PRIMARY` of table `test`.`child`
trx id 8731 lock_mode X locks gap before rec <span class="bold"><strong>insert intention</strong></span> waiting
Record lock, heap no 3 PHYSICAL RECORD: n_fields 3; compact format; info bits 0
 0: len 4; hex 80000066; asc    f;;
 1: len 6; hex 000000002215; asc     " ;;
 2: len 7; hex 9000000172011c; asc     r  ;;...
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-auto-inc-locks"></a>AUTO-INC Locks</h4>

</div>

</div>

</div>
<p>
        An <code class="literal">AUTO-INC</code> lock is a special table-level
        lock taken by transactions inserting into tables with
        <code class="literal">AUTO_INCREMENT</code> columns. In the simplest case,
        if one transaction is inserting values into the table, any other
        transactions must wait to do their own inserts into that table,
        so that rows inserted by the first transaction receive
        consecutive primary key values.
      </p><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
        configuration option controls the algorithm used for
        auto-increment locking. It allows you to choose how to trade off
        between predictable sequences of auto-increment values and
        maximum concurrency for insert operations.
      </p><p>
        For more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-handling" title="15.6.1.4 AUTO_INCREMENT Handling in InnoDB">Section 15.6.1.4, “AUTO_INCREMENT Handling in InnoDB”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-predicate-locks"></a>Predicate Locks for Spatial Indexes</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091649505712"></a><a class="indexterm" name="idm140091649504672"></a><p>
        <code class="literal">InnoDB</code> supports <code class="literal">SPATIAL</code>
        indexing of columns containing spatial columns (see
        <a class="xref" href="data-types.html#optimizing-spatial-analysis" title="11.5.9 Optimizing Spatial Analysis">Section 11.5.9, “Optimizing Spatial Analysis”</a>).
      </p><p>
        To handle locking for operations involving
        <code class="literal">SPATIAL</code> indexes, next-key locking does not
        work well to support <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE
        READ</code></a> or
        <a class="link" href="innodb-storage-engine.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a> transaction
        isolation levels. There is no absolute ordering concept in
        multidimensional data, so it is not clear which is the
        <span class="quote">“<span class="quote">next</span>”</span> key.
      </p><p>
        To enable support of isolation levels for tables with
        <code class="literal">SPATIAL</code> indexes, <code class="literal">InnoDB</code>
        uses predicate locks. A <code class="literal">SPATIAL</code> index
        contains minimum bounding rectangle (MBR) values, so
        <code class="literal">InnoDB</code> enforces consistent read on the index
        by setting a predicate lock on the MBR value used for a query.
        Other transactions cannot insert or modify a row that would
        match the query condition.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-transaction-model"></a>15.7.2 InnoDB Transaction Model</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transaction-isolation-levels">15.7.2.1 Transaction Isolation Levels</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-autocommit-commit-rollback">15.7.2.2 autocommit, Commit, and Rollback</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-consistent-read">15.7.2.3 Consistent Nonlocking Reads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locking-reads">15.7.2.4 Locking Reads</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091649491200"></a><p>
      In the <code class="literal">InnoDB</code> transaction model, the goal is to
      combine the best properties of a
      <a class="link" href="glossary.html#glos_mvcc" title="MVCC">multi-versioning</a> database with
      traditional two-phase locking. <code class="literal">InnoDB</code> performs
      locking at the row level and runs queries as nonlocking
      <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent reads</a> by
      default, in the style of Oracle. The lock information in
      <code class="literal">InnoDB</code> is stored space-efficiently so that lock
      escalation is not needed. Typically, several users are permitted
      to lock every row in <code class="literal">InnoDB</code> tables, or any
      random subset of the rows, without causing
      <code class="literal">InnoDB</code> memory exhaustion.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-transaction-isolation-levels"></a>15.7.2.1 Transaction Isolation Levels</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091649482464"></a><a class="indexterm" name="idm140091649480976"></a><p>
        Transaction isolation is one of the foundations of database
        processing. Isolation is the I in the acronym
        <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a>; the isolation level is
        the setting that fine-tunes the balance between performance and
        reliability, consistency, and reproducibility of results when
        multiple transactions are making changes and performing queries
        at the same time.
      </p><p>
        <code class="literal">InnoDB</code> offers all four transaction isolation
        levels described by the SQL:1992 standard:
        <a class="link" href="innodb-storage-engine.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>,
        <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>,
        <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>, and
        <a class="link" href="innodb-storage-engine.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>. The default
        isolation level for <code class="literal">InnoDB</code> is
        <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>.
      </p><p>
        A user can change the isolation level for a single session or
        for all subsequent connections with the <a class="link" href="sql-syntax.html#set-transaction" title="13.3.7 SET TRANSACTION Syntax"><code class="literal">SET
        TRANSACTION</code></a> statement. To set the server's default
        isolation level for all connections, use the
        <a class="link" href="server-administration.html#option_mysqld_transaction-isolation"><code class="option">--transaction-isolation</code></a> option on
        the command line or in an option file. For detailed information
        about isolation levels and level-setting syntax, see
        <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.7 SET TRANSACTION Syntax">Section 13.3.7, “SET TRANSACTION Syntax”</a>.
      </p><p>
        <code class="literal">InnoDB</code> supports each of the transaction
        isolation levels described here using different
        <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> strategies. You can
        enforce a high degree of consistency with the default
        <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> level, for
        operations on crucial data where
        <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> compliance is important.
        Or you can relax the consistency rules with
        <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> or even
        <a class="link" href="innodb-storage-engine.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>, in
        situations such as bulk reporting where precise consistency and
        repeatable results are less important than minimizing the amount
        of overhead for locking.
        <a class="link" href="innodb-storage-engine.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a> enforces even
        stricter rules than <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE
        READ</code></a>, and is used mainly in specialized situations,
        such as with <a class="link" href="glossary.html#glos_xa" title="XA">XA</a> transactions and
        for troubleshooting issues with concurrency and
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a>.
      </p><p>
        The following list describes how MySQL supports the different
        transaction levels. The list goes from the most commonly used
        level to the least used.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="isolevel_repeatable-read"></a>
            <a class="indexterm" name="idm140091649453360"></a>

            <a class="indexterm" name="idm140091649451904"></a>

            <code class="literal">REPEATABLE READ</code>
          </p><p>
            This is the default isolation level for
            <code class="literal">InnoDB</code>.
            <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">Consistent reads</a>
            within the same transaction read the
            <a class="link" href="glossary.html#glos_snapshot" title="snapshot">snapshot</a> established by
            the first read. This means that if you issue several plain
            (nonlocking) <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a>
            statements within the same transaction, these
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> statements are
            consistent also with respect to each other. See
            <a class="xref" href="innodb-storage-engine.html#innodb-consistent-read" title="15.7.2.3 Consistent Nonlocking Reads">Section 15.7.2.3, “Consistent Nonlocking Reads”</a>.
          </p><p>
            For <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking reads</a>
            (<a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> with <code class="literal">FOR
            UPDATE</code> or <code class="literal">FOR SHARE</code>),
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
            <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements, locking
            depends on whether the statement uses a unique index with a
            unique search condition, or a range-type search condition.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                For a unique index with a unique search condition,
                <code class="literal">InnoDB</code> locks only the index record
                found, not the <a class="link" href="glossary.html#glos_gap" title="gap">gap</a>
                before it.
              </p></li><li class="listitem"><p>
                For other search conditions, <code class="literal">InnoDB</code>
                locks the index range scanned, using
                <a class="link" href="glossary.html#glos_gap_lock" title="gap lock">gap locks</a> or
                <a class="link" href="glossary.html#glos_next_key_lock" title="next-key lock">next-key locks</a>
                to block insertions by other sessions into the gaps
                covered by the range. For information about gap locks
                and next-key locks, see
                <a class="xref" href="innodb-storage-engine.html#innodb-locking" title="15.7.1 InnoDB Locking">Section 15.7.1, “InnoDB Locking”</a>.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="isolevel_read-committed"></a>
            <a class="indexterm" name="idm140091649428064"></a>

            <a class="indexterm" name="idm140091649426592"></a>

            <code class="literal">READ COMMITTED</code>
          </p><p>
            Each consistent read, even within the same transaction, sets
            and reads its own fresh snapshot. For information about
            consistent reads, see
            <a class="xref" href="innodb-storage-engine.html#innodb-consistent-read" title="15.7.2.3 Consistent Nonlocking Reads">Section 15.7.2.3, “Consistent Nonlocking Reads”</a>.
          </p><p>
            For locking reads (<a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a>
            with <code class="literal">FOR UPDATE</code> or <code class="literal">FOR
            SHARE</code>), <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>
            statements, and <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a>
            statements, <code class="literal">InnoDB</code> locks only index
            records, not the gaps before them, and thus permits the free
            insertion of new records next to locked records. Gap locking
            is only used for foreign-key constraint checking and
            duplicate-key checking.
          </p><p>
            Because gap locking is disabled, phantom problems may occur,
            as other sessions can insert new rows into the gaps. For
            information about phantoms, see
            <a class="xref" href="innodb-storage-engine.html#innodb-next-key-locking" title="15.7.4 Phantom Rows">Section 15.7.4, “Phantom Rows”</a>.
          </p><p>
            Only row-based binary logging is supported with the
            <code class="literal">READ COMMITTED</code> isolation level. If you
            use <code class="literal">READ COMMITTED</code> with
            <a class="link" href="replication.html#sysvar_binlog_format"><code class="literal">binlog_format=MIXED</code></a>, the
            server automatically uses row-based logging.
          </p><p>
            Using <code class="literal">READ COMMITTED</code> has additional
            effects:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                For <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> or
                <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements,
                <code class="literal">InnoDB</code> holds locks only for rows that
                it updates or deletes. Record locks for nonmatching rows
                are released after MySQL has evaluated the
                <code class="literal">WHERE</code> condition. This greatly reduces
                the probability of deadlocks, but they can still happen.
              </p></li><li class="listitem"><p>
                For <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> statements, if
                a row is already locked, <code class="literal">InnoDB</code>
                performs a <span class="quote">“<span class="quote">semi-consistent</span>”</span> read,
                returning the latest committed version to MySQL so that
                MySQL can determine whether the row matches the
                <code class="literal">WHERE</code> condition of the
                <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>. If the row
                matches (must be updated), MySQL reads the row again and
                this time <code class="literal">InnoDB</code> either locks it or
                waits for a lock on it.
</p></li></ul>
</div>
<p>
            Consider the following example, beginning with this table:
          </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t (a INT NOT NULL, b INT) ENGINE = InnoDB;
INSERT INTO t VALUES (1,2),(2,3),(3,2),(4,3),(5,2);
COMMIT;
</pre><p>
            In this case, the table has no indexes, so searches and
            index scans use the hidden clustered index for record
            locking (see <a class="xref" href="innodb-storage-engine.html#innodb-index-types" title="15.6.2.1 Clustered and Secondary Indexes">Section 15.6.2.1, “Clustered and Secondary Indexes”</a>) rather
            than indexed columns.
          </p><p>
            Suppose that one session performs an
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> using these
            statements:
          </p><pre data-lang="sql" class="programlisting">
# Session A
START TRANSACTION;
UPDATE t SET b = 5 WHERE b = 3;
</pre><p>
            Suppose also that a second session performs an
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> by executing these
            statements following those of the first session:
          </p><pre data-lang="sql" class="programlisting">
# Session B
UPDATE t SET b = 4 WHERE b = 2;
</pre><p>
            As <a class="link" href="innodb-storage-engine.html" title="Chapter 15 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> executes each
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, it first acquires an
            exclusive lock for each row, and then determines whether to
            modify it. If <a class="link" href="innodb-storage-engine.html" title="Chapter 15 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> does not
            modify the row, it releases the lock. Otherwise,
            <a class="link" href="innodb-storage-engine.html" title="Chapter 15 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> retains the lock until
            the end of the transaction. This affects transaction
            processing as follows.
          </p><p>
            When using the default <code class="literal">REPEATABLE READ</code>
            isolation level, the first
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> acquires an x-lock on
            each row that it reads and does not release any of them:
          </p><pre data-lang="none" class="programlisting">
x-lock(1,2); retain x-lock
x-lock(2,3); update(2,3) to (2,5); retain x-lock
x-lock(3,2); retain x-lock
x-lock(4,3); update(4,3) to (4,5); retain x-lock
x-lock(5,2); retain x-lock
</pre><p>
            The second <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> blocks as
            soon as it tries to acquire any locks (because first update
            has retained locks on all rows), and does not proceed until
            the first <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> commits or
            rolls back:
          </p><pre data-lang="none" class="programlisting">
x-lock(1,2); block and wait for first UPDATE to commit or roll back
</pre><p>
            If <code class="literal">READ COMMITTED</code> is used instead, the
            first <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> acquires an
            x-lock on each row that it reads and releases those for rows
            that it does not modify:
          </p><pre data-lang="none" class="programlisting">
x-lock(1,2); unlock(1,2)
x-lock(2,3); update(2,3) to (2,5); retain x-lock
x-lock(3,2); unlock(3,2)
x-lock(4,3); update(4,3) to (4,5); retain x-lock
x-lock(5,2); unlock(5,2)
</pre><p>
            For the second <code class="literal">UPDATE</code>,
            <code class="literal">InnoDB</code> does a
            <span class="quote">“<span class="quote">semi-consistent</span>”</span> read, returning the latest
            committed version of each row that it reads to MySQL so that
            MySQL can determine whether the row matches the
            <code class="literal">WHERE</code> condition of the
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>:
          </p><pre data-lang="none" class="programlisting">
x-lock(1,2); update(1,2) to (1,4); retain x-lock
x-lock(2,3); unlock(2,3)
x-lock(3,2); update(3,2) to (3,4); retain x-lock
x-lock(4,3); unlock(4,3)
x-lock(5,2); update(5,2) to (5,4); retain x-lock
</pre><p>
            However, if the <code class="literal">WHERE</code> condition includes
            an indexed column, and <code class="literal">InnoDB</code> uses the
            index, only the indexed column is considered when taking and
            retaining record locks. In the following example, the first
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> takes and retains an
            x-lock on each row where b = 2. The second
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> blocks when it tries
            to acquire x-locks on the same records, as it also uses the
            index defined on column b.
          </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t (a INT NOT NULL, b INT, c INT, INDEX (b)) ENGINE = InnoDB;
INSERT INTO t VALUES (1,2,3),(2,2,4);
COMMIT;

# Session A
START TRANSACTION;
UPDATE t SET b = 3 WHERE b = 2 AND c = 3;

# Session B
UPDATE t SET b = 4 WHERE b = 2 AND c = 4;
</pre><p>
            The effects of using the <code class="literal">READ COMMITTED</code>
            isolation level are the same as enabling the deprecated
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_locks_unsafe_for_binlog" target="_top"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
            configuration option, with these exceptions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Enabling
                <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_locks_unsafe_for_binlog" target="_top"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
                is a global setting and affects all sessions, whereas
                the isolation level can be set globally for all
                sessions, or individually per session.
              </p></li><li class="listitem"><p>
                <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_locks_unsafe_for_binlog" target="_top"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
                can be set only at server startup, whereas the isolation
                level can be set at startup or changed at runtime.
</p></li></ul>
</div>
<p>
            <code class="literal">READ COMMITTED</code> therefore offers finer and
            more flexible control than
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_locks_unsafe_for_binlog" target="_top"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>.
          </p></li><li class="listitem"><p><a name="isolevel_read-uncommitted"></a>
            <a class="indexterm" name="idm140091649351760"></a>

            <a class="indexterm" name="idm140091649350304"></a>

            <code class="literal">READ UNCOMMITTED</code>
          </p><p>
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> statements are
            performed in a nonlocking fashion, but a possible earlier
            version of a row might be used. Thus, using this isolation
            level, such reads are not consistent. This is also called a
            <a class="link" href="glossary.html#glos_dirty_read" title="dirty read">dirty read</a>.
            Otherwise, this isolation level works like
            <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>.
          </p></li><li class="listitem"><p><a name="isolevel_serializable"></a>
            <a class="indexterm" name="idm140091649342928"></a>

            <a class="indexterm" name="idm140091649341456"></a>

            <code class="literal">SERIALIZABLE</code>
          </p><p>
            This level is like <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE
            READ</code></a>, but <code class="literal">InnoDB</code> implicitly
            converts all plain <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a>
            statements to <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT
            ... FOR SHARE</code></a> if
            <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> is disabled. If
            <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> is enabled, the
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> is its own
            transaction. It therefore is known to be read only and can
            be serialized if performed as a consistent (nonlocking) read
            and need not block for other transactions. (To force a plain
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> to block if other
            transactions have modified the selected rows, disable
            <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a>.)
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-autocommit-commit-rollback"></a>15.7.2.2 autocommit, Commit, and Rollback</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091649326096"></a><a class="indexterm" name="idm140091649324608"></a><p>
        In <code class="literal">InnoDB</code>, all user activity occurs inside a
        transaction. If <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> mode
        is enabled, each SQL statement forms a single transaction on its
        own. By default, MySQL starts the session for each new
        connection with <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a>
        enabled, so MySQL does a commit after each SQL statement if that
        statement did not return an error. If a statement returns an
        error, the commit or rollback behavior depends on the error. See
        <a class="xref" href="innodb-storage-engine.html#innodb-error-handling" title="15.20.4 InnoDB Error Handling">Section 15.20.4, “InnoDB Error Handling”</a>.
      </p><p>
        A session that has <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a>
        enabled can perform a multiple-statement transaction by starting
        it with an explicit
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
        TRANSACTION</code></a> or
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">BEGIN</code></a>
        statement and ending it with a
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        statement. See <a class="xref" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax">Section 13.3.1, “START TRANSACTION, COMMIT, and ROLLBACK Syntax”</a>.
      </p><p>
        If <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> mode is disabled
        within a session with <code class="literal">SET autocommit = 0</code>, the
        session always has a transaction open. A
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        statement ends the current transaction and a new one starts.
      </p><p>
        If a session that has
        <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> disabled ends
        without explicitly committing the final transaction, MySQL rolls
        back that transaction.
      </p><p>
        Some statements implicitly end a transaction, as if you had done
        a <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> before executing the
        statement. For details, see <a class="xref" href="sql-syntax.html#implicit-commit" title="13.3.3 Statements That Cause an Implicit Commit">Section 13.3.3, “Statements That Cause an Implicit Commit”</a>.
      </p><p>
        A <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> means that the changes
        made in the current transaction are made permanent and become
        visible to other sessions. A
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        statement, on the other hand, cancels all modifications made by
        the current transaction. Both
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        release all <code class="literal">InnoDB</code> locks that were set during
        the current transaction.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-transactions-with-different-apis"></a>Grouping DML Operations with Transactions</h5>
</div>
</div>
</div>
<a class="indexterm" name="idm140091649294480"></a><p>
          By default, connection to the MySQL server begins with
          <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a> mode
          enabled, which automatically commits every SQL statement as
          you execute it. This mode of operation might be unfamiliar if
          you have experience with other database systems, where it is
          standard practice to issue a sequence of
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements and commit them
          or roll them back all together.
        </p><p>
          To use multiple-statement
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, switch
          autocommit off with the SQL statement <code class="literal">SET autocommit
          = 0</code> and end each transaction with
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> as
          appropriate. To leave autocommit on, begin each transaction
          with <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
          TRANSACTION</code></a> and end it with
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>.
          The following example shows two transactions. The first is
          committed; the second is rolled back.
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql test</code></strong>
</pre><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE customer (a INT, b CHAR (20), INDEX (a));</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>-- Do a transaction with autocommit turned on.</code></strong>
mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>INSERT INTO customer VALUES (10, 'Heikki');</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>COMMIT;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>-- Do another transaction with autocommit turned off.</code></strong>
mysql&gt; <strong class="userinput"><code>SET autocommit=0;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>INSERT INTO customer VALUES (15, 'John');</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>INSERT INTO customer VALUES (20, 'Paul');</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>DELETE FROM customer WHERE b = 'Heikki';</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>-- Now we undo those last 2 inserts and the delete.</code></strong>
mysql&gt; <strong class="userinput"><code>ROLLBACK;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>SELECT * FROM customer;</code></strong>
+------+--------+
| a    | b      |
+------+--------+
|   10 | Heikki |
+------+--------+
1 row in set (0.00 sec)
mysql&gt;
</pre><h6><a name="idm140091649269040"></a>Transactions in Client-Side Languages</h6><p>
          In APIs such as PHP, Perl DBI, JDBC, ODBC, or the standard C
          call interface of MySQL, you can send transaction control
          statements such as <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> to
          the MySQL server as strings just like any other SQL statements
          such as <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> or
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>. Some APIs also offer
          separate special transaction commit and rollback functions or
          methods.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-consistent-read"></a>15.7.2.3 Consistent Nonlocking Reads</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091649262448"></a><a class="indexterm" name="idm140091649260992"></a><p>
        A <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent read</a>
        means that <code class="literal">InnoDB</code> uses multi-versioning to
        present to a query a snapshot of the database at a point in
        time. The query sees the changes made by transactions that
        committed before that point of time, and no changes made by
        later or uncommitted transactions. The exception to this rule is
        that the query sees the changes made by earlier statements
        within the same transaction. This exception causes the following
        anomaly: If you update some rows in a table, a
        <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> sees the latest version of
        the updated rows, but it might also see older versions of any
        rows. If other sessions simultaneously update the same table,
        the anomaly means that you might see the table in a state that
        never existed in the database.
      </p><p>
        If the transaction
        <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a> is
        <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> (the default
        level), all consistent reads within the same transaction read
        the snapshot established by the first such read in that
        transaction. You can get a fresher snapshot for your queries by
        committing the current transaction and after that issuing new
        queries.
      </p><p>
        With <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level, each consistent read within a transaction sets and reads
        its own fresh snapshot.
      </p><p>
        Consistent read is the default mode in which
        <code class="literal">InnoDB</code> processes
        <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> statements in
        <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> and
        <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> isolation
        levels. A consistent read does not set any locks on the tables
        it accesses, and therefore other sessions are free to modify
        those tables at the same time a consistent read is being
        performed on the table.
      </p><p>
        Suppose that you are running in the default
        <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> isolation
        level. When you issue a consistent read (that is, an ordinary
        <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> statement),
        <code class="literal">InnoDB</code> gives your transaction a timepoint
        according to which your query sees the database. If another
        transaction deletes a row and commits after your timepoint was
        assigned, you do not see the row as having been deleted. Inserts
        and updates are treated similarly.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The snapshot of the database state applies to
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> statements within a
          transaction, not necessarily to
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements. If you insert
          or modify some rows and then commit that transaction, a
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> or
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> statement issued from
          another concurrent <code class="literal">REPEATABLE READ</code>
          transaction could affect those just-committed rows, even
          though the session could not query them. If a transaction does
          update or delete rows committed by a different transaction,
          those changes do become visible to the current transaction.
          For example, you might encounter a situation like the
          following:
        </p><pre data-lang="sql" class="programlisting">
SELECT COUNT(c1) FROM t1 WHERE c1 = 'xyz';
-- Returns 0: no rows match.
DELETE FROM t1 WHERE c1 = 'xyz';
-- Deletes several rows recently committed by other transaction.

SELECT COUNT(c2) FROM t1 WHERE c2 = 'abc';
-- Returns 0: no rows match.
UPDATE t1 SET c2 = 'cba' WHERE c2 = 'abc';
-- Affects 10 rows: another txn just committed 10 rows with 'abc' values.
SELECT COUNT(c2) FROM t1 WHERE c2 = 'cba';
-- Returns 10: this txn can now see the rows it just updated.
</pre>
</div>
<p>
        You can advance your timepoint by committing your transaction
        and then doing another <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> or
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START TRANSACTION WITH
        CONSISTENT SNAPSHOT</code></a>.
      </p><p>
        This is called <span class="firstterm">multi-versioned
        concurrency control</span>.
      </p><p>
        In the following example, session A sees the row inserted by B
        only when B has committed the insert and A has committed as
        well, so that the timepoint is advanced past the commit of B.
      </p><pre data-lang="sql" class="programlisting">
             Session A              Session B

           SET autocommit=0;      SET autocommit=0;
time
|          SELECT * FROM t;
|          empty set
|                                 INSERT INTO t VALUES (1, 2);
|
v          SELECT * FROM t;
           empty set
                                  COMMIT;

           SELECT * FROM t;
           empty set

           COMMIT;

           SELECT * FROM t;
           ---------------------
           |    1    |    2    |
           ---------------------
</pre><p>
        If you want to see the <span class="quote">“<span class="quote">freshest</span>”</span> state of the
        database, use either the <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ
        COMMITTED</code></a> isolation level or a
        <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking read</a>:
      </p><pre data-lang="sql" class="programlisting">
SELECT * FROM t FOR SHARE;
</pre><p>
        With <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
        level, each consistent read within a transaction sets and reads
        its own fresh snapshot. With <code class="literal">FOR SHARE</code>, a
        locking read occurs instead: A <code class="literal">SELECT</code> blocks
        until the transaction containing the freshest rows ends (see
        <a class="xref" href="innodb-storage-engine.html#innodb-locking-reads" title="15.7.2.4 Locking Reads">Section 15.7.2.4, “Locking Reads”</a>).
      </p><p>
        Consistent read does not work over certain DDL statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Consistent read does not work over <a class="link" href="sql-syntax.html#drop-table" title="13.1.32 DROP TABLE Syntax"><code class="literal">DROP
            TABLE</code></a>, because MySQL cannot use a table that has
            been dropped and <code class="literal">InnoDB</code> destroys the
            table.
          </p></li><li class="listitem"><p>
            Consistent read does not work over
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, because that
            statement makes a temporary copy of the original table and
            deletes the original table when the temporary copy is built.
            When you reissue a consistent read within a transaction,
            rows in the new table are not visible because those rows did
            not exist when the transaction's snapshot was taken. In this
            case, the transaction returns an error:
            <a class="link" href="error-handling.html#error_er_table_def_changed"><code class="literal">ER_TABLE_DEF_CHANGED</code></a>,
            <span class="quote">“<span class="quote">Table definition has changed, please retry
            transaction</span>”</span>.
</p></li></ul>
</div>
<p>
        The type of read varies for selects in clauses like
        <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT INTO ...
        SELECT</code></a>, <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE
        ... (SELECT)</code></a>, and
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
        SELECT</code></a> that do not specify <code class="literal">FOR
        UPDATE</code> or <code class="literal">FOR SHARE</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            By default, <code class="literal">InnoDB</code> uses stronger locks
            and the <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> part acts like
            <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>, where
            each consistent read, even within the same transaction, sets
            and reads its own fresh snapshot.
          </p></li><li class="listitem"><p>
            To use a consistent read in such cases, set the isolation
            level of the transaction to <a class="link" href="innodb-storage-engine.html#isolevel_read-uncommitted"><code class="literal">READ
            UNCOMMITTED</code></a>, <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ
            COMMITTED</code></a>, or <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE
            READ</code></a> (that is, anything other than
            <a class="link" href="innodb-storage-engine.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>). In this
            case, no locks are set on rows read from the selected table.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-locking-reads"></a>15.7.2.4 Locking Reads</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091649194464"></a><p>
        If you query data and then insert or update related data within
        the same transaction, the regular <code class="literal">SELECT</code>
        statement does not give enough protection. Other transactions
        can update or delete the same rows you just queried.
        <code class="literal">InnoDB</code> supports two types of
        <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking reads</a> that
        offer extra safety:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ... FOR
            SHARE</code></a>
          </p><p>
            Sets a shared mode lock on any rows that are read. Other
            sessions can read the rows, but cannot modify them until
            your transaction commits. If any of these rows were changed
            by another transaction that has not yet committed, your
            query waits until that transaction ends and then uses the
            latest values.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              <code class="literal">SELECT ... FOR SHARE</code> is a replacement
              for <code class="literal">SELECT ... LOCK IN SHARE MODE</code>, but
              <code class="literal">LOCK IN SHARE MODE</code> remains available
              for backward compatibility. The statements are equivalent.
              However, <code class="literal">FOR SHARE</code> supports <code class="literal">OF
              <em class="replaceable"><code>table_name</code></em></code>,
              <code class="literal">NOWAIT</code>, and <code class="literal">SKIP
              LOCKED</code> options. See
              <a class="xref" href="innodb-storage-engine.html#innodb-locking-reads-nowait-skip-locked" title="Locking Read Concurrency with NOWAIT and SKIP LOCKED">Locking Read Concurrency with NOWAIT and SKIP LOCKED</a>.
</p>
</div>
</li><li class="listitem"><p>
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ... FOR
            UPDATE</code></a>
          </p><p>
            For index records the search encounters, locks the rows and
            any associated index entries, the same as if you issued an
            <code class="literal">UPDATE</code> statement for those rows. Other
            transactions are blocked from updating those rows, from
            doing <code class="literal">SELECT ... FOR SHARE</code>, or from
            reading the data in certain transaction isolation levels.
            Consistent reads ignore any locks set on the records that
            exist in the read view. (Old versions of a record cannot be
            locked; they are reconstructed by applying
            <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a> on an
            in-memory copy of the record.)
</p></li></ul>
</div>
<p>
        These clauses are primarily useful when dealing with
        tree-structured or graph-structured data, either in a single
        table or split across multiple tables. You traverse edges or
        tree branches from one place to another, while reserving the
        right to come back and change any of these
        <span class="quote">“<span class="quote">pointer</span>”</span> values.
      </p><p>
        All locks set by <code class="literal">FOR SHARE</code> and <code class="literal">FOR
        UPDATE</code> queries are released when the transaction is
        committed or rolled back.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Locking reads are only possible when autocommit is disabled
          (either by beginning transaction with
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
          TRANSACTION</code></a> or by setting
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> to 0.
</p>
</div>
<p>
        A locking read clause in an outer statement does not lock the
        rows of a table in a nested subquery unless a locking read
        clause is also specified in the subquery. For example, the
        following statement does not lock rows in table
        <code class="literal">t2</code>.
      </p><pre data-lang="sql" class="programlisting">
SELECT * FROM t1 WHERE c1 = (SELECT c1 FROM t2) FOR UPDATE;
</pre><p>
        To lock rows in table <code class="literal">t2</code>, add a locking read
        clause to the subquery:
      </p><pre data-lang="sql" class="programlisting">
SELECT * FROM t1 WHERE c1 = (SELECT c1 FROM t2 FOR UPDATE) FOR UPDATE;
</pre>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-locking-reads-examples"></a>Locking Read Examples</h5>
</div>
</div>
</div>
<p>
          Suppose that you want to insert a new row into a table
          <code class="literal">child</code>, and make sure that the child row has
          a parent row in table <code class="literal">parent</code>. Your
          application code can ensure referential integrity throughout
          this sequence of operations.
        </p><p>
          First, use a consistent read to query the table
          <code class="literal">PARENT</code> and verify that the parent row
          exists. Can you safely insert the child row to table
          <code class="literal">CHILD</code>? No, because some other session could
          delete the parent row in the moment between your
          <code class="literal">SELECT</code> and your <code class="literal">INSERT</code>,
          without you being aware of it.
        </p><p>
          To avoid this potential issue, perform the
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> using <code class="literal">FOR
          SHARE</code>:
        </p><pre data-lang="sql" class="programlisting">
SELECT * FROM parent WHERE NAME = 'Jones' FOR SHARE;
</pre><p>
          After the <code class="literal">FOR SHARE</code> query returns the
          parent <code class="literal">'Jones'</code>, you can safely add the
          child record to the <code class="literal">CHILD</code> table and commit
          the transaction. Any transaction that tries to acquire an
          exclusive lock in the applicable row in the
          <code class="literal">PARENT</code> table waits until you are finished,
          that is, until the data in all tables is in a consistent
          state.
        </p><p>
          For another example, consider an integer counter field in a
          table <code class="literal">CHILD_CODES</code>, used to assign a unique
          identifier to each child added to table
          <code class="literal">CHILD</code>. Do not use either consistent read or
          a shared mode read to read the present value of the counter,
          because two users of the database could see the same value for
          the counter, and a duplicate-key error occurs if two
          transactions attempt to add rows with the same identifier to
          the <code class="literal">CHILD</code> table.
        </p><p>
          Here, <code class="literal">FOR SHARE</code> is not a good solution
          because if two users read the counter at the same time, at
          least one of them ends up in deadlock when it attempts to
          update the counter.
        </p><p>
          To implement reading and incrementing the counter, first
          perform a locking read of the counter using <code class="literal">FOR
          UPDATE</code>, and then increment the counter. For example:
        </p><pre data-lang="sql" class="programlisting">
SELECT counter_field FROM child_codes FOR UPDATE;
UPDATE child_codes SET counter_field = counter_field + 1;
</pre><p>
          A <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ... FOR
          UPDATE</code></a> reads the latest available data, setting
          exclusive locks on each row it reads. Thus, it sets the same
          locks a searched SQL <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>
          would set on the rows.
        </p><p>
          The preceding description is merely an example of how
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ... FOR
          UPDATE</code></a> works. In MySQL, the specific task of
          generating a unique identifier actually can be accomplished
          using only a single access to the table:
        </p><pre data-lang="sql" class="programlisting">
UPDATE child_codes SET counter_field = LAST_INSERT_ID(counter_field + 1);
SELECT LAST_INSERT_ID();
</pre><p>
          The <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> statement merely
          retrieves the identifier information (specific to the current
          connection). It does not access any table.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-locking-reads-nowait-skip-locked"></a>Locking Read Concurrency with NOWAIT and SKIP LOCKED</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091649134192"></a><a class="indexterm" name="idm140091649133120"></a><a class="indexterm" name="idm140091649131632"></a><p>
          If a row is locked by a transaction, a <code class="literal">SELECT ... FOR
          UPDATE</code> or <code class="literal">SELECT ... FOR SHARE</code>
          transaction that requests the same locked row must wait until
          the blocking transaction releases the row lock. This behavior
          prevents transactions from updating or deleting rows that are
          queried for updates by other transactions. However, waiting
          for a row lock to be released is not necessary if you want the
          query to return immediately when a requested row is locked, or
          if excluding locked rows from the result set is acceptable.
        </p><p>
          To avoid waiting for other transactions to release row locks,
          <code class="literal">NOWAIT</code> and <code class="literal">SKIP LOCKED</code>
          options may be used with <code class="literal">SELECT ... FOR
          UPDATE</code> or <code class="literal">SELECT ... FOR SHARE</code>
          locking read statements.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">NOWAIT</code>
            </p><p>
              A locking read that uses <code class="literal">NOWAIT</code> never
              waits to acquire a row lock. The query executes
              immediately, failing with an error if a requested row is
              locked.
            </p></li><li class="listitem"><p>
              <code class="literal">SKIP LOCKED</code>
            </p><p>
              A locking read that uses <code class="literal">SKIP LOCKED</code>
              never waits to acquire a row lock. The query executes
              immediately, removing locked rows from the result set.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                Queries that skip locked rows return an inconsistent
                view of the data. <code class="literal">SKIP LOCKED</code> is
                therefore not suitable for general transactional work.
                However, it may be used to avoid lock contention when
                multiple sessions access the same queue-like table.
</p>
</div>
</li></ul>
</div>
<p>
          <code class="literal">NOWAIT</code> and <code class="literal">SKIP LOCKED</code>
          only apply to row-level locks.
        </p><p>
          Statements that use <code class="literal">NOWAIT</code> or <code class="literal">SKIP
          LOCKED</code> are unsafe for statement based replication.
        </p><p>
          The following example demonstrates <code class="literal">NOWAIT</code>
          and <code class="literal">SKIP LOCKED</code>. Session 1 starts a
          transaction that takes a row lock on a single record. Session
          2 attempts a locking read on the same record using the
          <code class="literal">NOWAIT</code> option. Because the requested row is
          locked by Session 1, the locking read returns immediately with
          an error. In Session 3, the locking read with <code class="literal">SKIP
          LOCKED</code> returns the requested rows except for the row
          that is locked by Session 1.
        </p><pre data-lang="sql" class="programlisting">
# Session 1:

mysql&gt; <strong class="userinput"><code>CREATE TABLE t (i INT, PRIMARY KEY (i)) ENGINE = InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>INSERT INTO t (i) VALUES(1),(2),(3);</code></strong>

mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT * FROM t WHERE i = 2 FOR UPDATE;</code></strong>
+---+
| i |
+---+
| 2 |
+---+

# Session 2:

mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT * FROM t WHERE i = 2 FOR UPDATE NOWAIT;</code></strong>
ERROR 3572 (HY000): Do not wait for lock.

# Session 3:

mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT * FROM t FOR UPDATE SKIP LOCKED;</code></strong>
+---+
| i |
+---+
| 1 |
| 3 |
+---+          
</pre>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-locks-set"></a>15.7.3 Locks Set by Different SQL Statements in InnoDB</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091649100512"></a><a class="indexterm" name="idm140091649099472"></a><p>
      A <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking read</a>, an
      <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or a
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> generally set record locks
      on every index record that is scanned in the processing of the SQL
      statement. It does not matter whether there are
      <code class="literal">WHERE</code> conditions in the statement that would
      exclude the row. <code class="literal">InnoDB</code> does not remember the
      exact <code class="literal">WHERE</code> condition, but only knows which
      index ranges were scanned. The locks are normally
      <a class="link" href="glossary.html#glos_next_key_lock" title="next-key lock">next-key locks</a> that also
      block inserts into the <span class="quote">“<span class="quote">gap</span>”</span> immediately before the
      record. However, <a class="link" href="glossary.html#glos_gap_lock" title="gap lock">gap locking</a>
      can be disabled explicitly, which causes next-key locking not to
      be used. For more information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-locking" title="15.7.1 InnoDB Locking">Section 15.7.1, “InnoDB Locking”</a>. The transaction isolation level
      also can affect which locks are set; see
      <a class="xref" href="innodb-storage-engine.html#innodb-transaction-isolation-levels" title="15.7.2.1 Transaction Isolation Levels">Section 15.7.2.1, “Transaction Isolation Levels”</a>.
    </p><p>
      If a secondary index is used in a search and index record locks to
      be set are exclusive, <code class="literal">InnoDB</code> also retrieves the
      corresponding clustered index records and sets locks on them.
    </p><p>
      If you have no indexes suitable for your statement and MySQL must
      scan the entire table to process the statement, every row of the
      table becomes locked, which in turn blocks all inserts by other
      users to the table. It is important to create good indexes so that
      your queries do not unnecessarily scan many rows.
    </p><p>
      <code class="literal">InnoDB</code> sets specific types of locks as follows.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ...
          FROM</code></a> is a consistent read, reading a snapshot of the
          database and setting no locks unless the transaction isolation
          level is set to
          <a class="link" href="innodb-storage-engine.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>. For
          <a class="link" href="innodb-storage-engine.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a> level, the
          search sets shared next-key locks on the index records it
          encounters. However, only an index record lock is required for
          statements that lock rows using a unique index to search for a
          unique row.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ... FOR
          UPDATE</code></a> and
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ... FOR
          SHARE</code></a> statements that use a unique index acquire
          locks for scanned rows, and release the locks for rows that do
          not qualify for inclusion in the result set (for example, if
          they do not meet the criteria given in the
          <code class="literal">WHERE</code> clause). However, in some cases, rows
          might not be unlocked immediately because the relationship
          between a result row and its original source is lost during
          query execution. For example, in a
          <a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION Syntax"><code class="literal">UNION</code></a>, scanned (and locked)
          rows from a table might be inserted into a temporary table
          before evaluation whether they qualify for the result set. In
          this circumstance, the relationship of the rows in the
          temporary table to the rows in the original table is lost and
          the latter rows are not unlocked until the end of query
          execution.
        </p></li><li class="listitem"><p>
          For <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking reads</a>
          (<a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> with <code class="literal">FOR
          UPDATE</code> or <code class="literal">FOR SHARE</code>),
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements, the locks
          that are taken depend on whether the statement uses a unique
          index with a unique search condition, or a range-type search
          condition.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              For a unique index with a unique search condition,
              <code class="literal">InnoDB</code> locks only the index record
              found, not the <a class="link" href="glossary.html#glos_gap" title="gap">gap</a> before
              it.
            </p></li><li class="listitem"><p>
              For other search conditions, and for non-unique indexes,
              <code class="literal">InnoDB</code> locks the index range scanned,
              using <a class="link" href="glossary.html#glos_gap_lock" title="gap lock">gap locks</a> or
              <a class="link" href="glossary.html#glos_next_key_lock" title="next-key lock">next-key locks</a>
              to block insertions by other sessions into the gaps
              covered by the range. For information about gap locks and
              next-key locks, see <a class="xref" href="innodb-storage-engine.html#innodb-locking" title="15.7.1 InnoDB Locking">Section 15.7.1, “InnoDB Locking”</a>.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          For index records the search encounters,
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ... FOR
          UPDATE</code></a> blocks other sessions from doing
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ... FOR
          SHARE</code></a> or from reading in certain transaction
          isolation levels. Consistent reads ignore any locks set on the
          records that exist in the read view.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE ... WHERE
          ...</code></a> sets an exclusive next-key lock on every record
          the search encounters. However, only an index record lock is
          required for statements that lock rows using a unique index to
          search for a unique row.
        </p></li><li class="listitem"><p>
          When <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> modifies a
          clustered index record, implicit locks are taken on affected
          secondary index records. The
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> operation also takes
          shared locks on affected secondary index records when
          performing duplicate check scans prior to inserting new
          secondary index records, and when inserting new secondary
          index records.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE FROM ... WHERE
          ...</code></a> sets an exclusive next-key lock on every record
          the search encounters. However, only an index record lock is
          required for statements that lock rows using a unique index to
          search for a unique row.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> sets an exclusive lock
          on the inserted row. This lock is an index-record lock, not a
          next-key lock (that is, there is no gap lock) and does not
          prevent other sessions from inserting into the gap before the
          inserted row.
        </p><p>
          Prior to inserting the row, a type of gap lock called an
          insert intention gap lock is set. This lock signals the intent
          to insert in such a way that multiple transactions inserting
          into the same index gap need not wait for each other if they
          are not inserting at the same position within the gap. Suppose
          that there are index records with values of 4 and 7. Separate
          transactions that attempt to insert values of 5 and 6 each
          lock the gap between 4 and 7 with insert intention locks prior
          to obtaining the exclusive lock on the inserted row, but do
          not block each other because the rows are nonconflicting.
        </p><p>
          If a duplicate-key error occurs, a shared lock on the
          duplicate index record is set. This use of a shared lock can
          result in deadlock should there be multiple sessions trying to
          insert the same row if another session already has an
          exclusive lock. This can occur if another session deletes the
          row. Suppose that an <code class="literal">InnoDB</code> table
          <code class="literal">t1</code> has the following structure:
        </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (i INT, PRIMARY KEY (i)) ENGINE = InnoDB;
</pre><p>
          Now suppose that three sessions perform the following
          operations in order:
        </p><p>
          Session 1:
        </p><pre data-lang="sql" class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
          Session 2:
        </p><pre data-lang="sql" class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
          Session 3:
        </p><pre data-lang="sql" class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
          Session 1:
        </p><pre data-lang="sql" class="programlisting">
ROLLBACK;
</pre><p>
          The first operation by session 1 acquires an exclusive lock
          for the row. The operations by sessions 2 and 3 both result in
          a duplicate-key error and they both request a shared lock for
          the row. When session 1 rolls back, it releases its exclusive
          lock on the row and the queued shared lock requests for
          sessions 2 and 3 are granted. At this point, sessions 2 and 3
          deadlock: Neither can acquire an exclusive lock for the row
          because of the shared lock held by the other.
        </p><p>
          A similar situation occurs if the table already contains a row
          with key value 1 and three sessions perform the following
          operations in order:
        </p><p>
          Session 1:
        </p><pre data-lang="sql" class="programlisting">
START TRANSACTION;
DELETE FROM t1 WHERE i = 1;
</pre><p>
          Session 2:
        </p><pre data-lang="sql" class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
          Session 3:
        </p><pre data-lang="sql" class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
          Session 1:
        </p><pre data-lang="sql" class="programlisting">
COMMIT;
</pre><p>
          The first operation by session 1 acquires an exclusive lock
          for the row. The operations by sessions 2 and 3 both result in
          a duplicate-key error and they both request a shared lock for
          the row. When session 1 commits, it releases its exclusive
          lock on the row and the queued shared lock requests for
          sessions 2 and 3 are granted. At this point, sessions 2 and 3
          deadlock: Neither can acquire an exclusive lock for the row
          because of the shared lock held by the other.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.6.2 INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
          ... ON DUPLICATE KEY UPDATE</code></a> differs from a simple
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> in that an exclusive
          lock rather than a shared lock is placed on the row to be
          updated when a duplicate-key error occurs. An exclusive
          index-record lock is taken for a duplicate primary key value.
          An exclusive next-key lock is taken for a duplicate unique key
          value.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE Syntax"><code class="literal">REPLACE</code></a> is done like an
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> if there is no collision
          on a unique key. Otherwise, an exclusive next-key lock is
          placed on the row to be replaced.
        </p></li><li class="listitem"><p>
          <code class="literal">INSERT INTO T SELECT ... FROM S WHERE ...</code>
          sets an exclusive index record lock (without a gap lock) on
          each row inserted into <code class="literal">T</code>. If the
          transaction isolation level is <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ
          COMMITTED</code></a>, <code class="literal">InnoDB</code> does the search
          on <code class="literal">S</code> as a consistent read (no locks).
          Otherwise, <code class="literal">InnoDB</code> sets shared next-key
          locks on rows from <code class="literal">S</code>.
          <code class="literal">InnoDB</code> has to set locks in the latter case:
          During roll-forward recovery using a statement-based binary
          log, every SQL statement must be executed in exactly the same
          way it was done originally.
        </p><p>
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
          SELECT ...</code></a> performs the
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> with shared next-key
          locks or as a consistent read, as for
          <a class="link" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
          SELECT</code></a>.
        </p><p>
          When a <code class="literal">SELECT</code> is used in the constructs
          <code class="literal">REPLACE INTO t SELECT ... FROM s WHERE ...</code>
          or <code class="literal">UPDATE t ... WHERE col IN (SELECT ... FROM s
          ...)</code>, <code class="literal">InnoDB</code> sets shared next-key
          locks on rows from table <code class="literal">s</code>.
        </p></li><li class="listitem"><p>
          While initializing a previously specified
          <code class="literal">AUTO_INCREMENT</code> column on a table,
          <code class="literal">InnoDB</code> sets an exclusive lock on the end of
          the index associated with the
          <code class="literal">AUTO_INCREMENT</code> column. In accessing the
          auto-increment counter, <code class="literal">InnoDB</code> uses a
          specific <code class="literal">AUTO-INC</code> table lock mode where the
          lock lasts only to the end of the current SQL statement, not
          to the end of the entire transaction. Other sessions cannot
          insert into the table while the <code class="literal">AUTO-INC</code>
          table lock is held; see
          <a class="xref" href="innodb-storage-engine.html#innodb-transaction-model" title="15.7.2 InnoDB Transaction Model">Section 15.7.2, “InnoDB Transaction Model”</a>.
        </p><p>
          <code class="literal">InnoDB</code> fetches the value of a previously
          initialized <code class="literal">AUTO_INCREMENT</code> column without
          setting any locks.
        </p></li><li class="listitem"><p>
          If a <code class="literal">FOREIGN KEY</code> constraint is defined on a
          table, any insert, update, or delete that requires the
          constraint condition to be checked sets shared record-level
          locks on the records that it looks at to check the constraint.
          <code class="literal">InnoDB</code> also sets these locks in the case
          where the constraint fails.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> sets table locks,
          but it is the higher MySQL layer above the
          <code class="literal">InnoDB</code> layer that sets these locks.
          <code class="literal">InnoDB</code> is aware of table locks if
          <code class="literal">innodb_table_locks = 1</code> (the default) and
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>, and the MySQL
          layer above <code class="literal">InnoDB</code> knows about row-level
          locks.
        </p><p>
          Otherwise, <code class="literal">InnoDB</code>'s automatic deadlock
          detection cannot detect deadlocks where such table locks are
          involved. Also, because in this case the higher MySQL layer
          does not know about row-level locks, it is possible to get a
          table lock on a table where another session currently has
          row-level locks. However, this does not endanger transaction
          integrity, as discussed in
          <a class="xref" href="innodb-storage-engine.html#innodb-deadlock-detection" title="15.7.5.2 Deadlock Detection and Rollback">Section 15.7.5.2, “Deadlock Detection and Rollback”</a>. See also
          <a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="15.6.1.6 Limits on InnoDB Tables">Section 15.6.1.6, “Limits on InnoDB Tables”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-next-key-locking"></a>15.7.4 Phantom Rows</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648983568"></a><a class="indexterm" name="idm140091648982496"></a><a class="indexterm" name="idm140091648981008"></a><a class="indexterm" name="idm140091648979520"></a><a class="indexterm" name="idm140091648978032"></a><a class="indexterm" name="idm140091648976544"></a><a class="indexterm" name="idm140091648975056"></a><a class="indexterm" name="idm140091648973568"></a><a class="indexterm" name="idm140091648972080"></a><p>
      The so-called <span class="firstterm">phantom</span>
      problem occurs within a transaction when the same query produces
      different sets of rows at different times. For example, if a
      <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> is executed twice, but
      returns a row the second time that was not returned the first
      time, the row is a <span class="quote">“<span class="quote">phantom</span>”</span> row.
    </p><p>
      Suppose that there is an index on the <code class="literal">id</code> column
      of the <code class="literal">child</code> table and that you want to read
      and lock all rows from the table having an identifier value larger
      than 100, with the intention of updating some column in the
      selected rows later:
    </p><pre data-lang="sql" class="programlisting">
SELECT * FROM child WHERE id &gt; 100 FOR UPDATE;
</pre><p>
      The query scans the index starting from the first record where
      <code class="literal">id</code> is bigger than 100. Let the table contain
      rows having <code class="literal">id</code> values of 90 and 102. If the
      locks set on the index records in the scanned range do not lock
      out inserts made in the gaps (in this case, the gap between 90 and
      102), another session can insert a new row into the table with an
      <code class="literal">id</code> of 101. If you were to execute the same
      <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> within the same transaction,
      you would see a new row with an <code class="literal">id</code> of 101 (a
      <span class="quote">“<span class="quote">phantom</span>”</span>) in the result set returned by the query.
      If we regard a set of rows as a data item, the new phantom child
      would violate the isolation principle of transactions that a
      transaction should be able to run so that the data it has read
      does not change during the transaction.
    </p><p>
      To prevent phantoms, <code class="literal">InnoDB</code> uses an algorithm
      called <span class="firstterm">next-key locking</span> that
      combines index-row locking with gap locking.
      <code class="literal">InnoDB</code> performs row-level locking in such a way
      that when it searches or scans a table index, it sets shared or
      exclusive locks on the index records it encounters. Thus, the
      row-level locks are actually index-record locks. In addition, a
      next-key lock on an index record also affects the
      <span class="quote">“<span class="quote">gap</span>”</span> before that index record. That is, a next-key
      lock is an index-record lock plus a gap lock on the gap preceding
      the index record. If one session has a shared or exclusive lock on
      record <code class="literal">R</code> in an index, another session cannot
      insert a new index record in the gap immediately before
      <code class="literal">R</code> in the index order.
    </p><p>
      When <code class="literal">InnoDB</code> scans an index, it can also lock
      the gap after the last record in the index. Just that happens in
      the preceding example: To prevent any insert into the table where
      <code class="literal">id</code> would be bigger than 100, the locks set by
      <code class="literal">InnoDB</code> include a lock on the gap following
      <code class="literal">id</code> value 102.
    </p><p>
      You can use next-key locking to implement a uniqueness check in
      your application: If you read your data in share mode and do not
      see a duplicate for a row you are going to insert, then you can
      safely insert your row and know that the next-key lock set on the
      successor of your row during the read prevents anyone meanwhile
      inserting a duplicate for your row. Thus, the next-key locking
      enables you to <span class="quote">“<span class="quote">lock</span>”</span> the nonexistence of something
      in your table.
    </p><p>
      Gap locking can be disabled as discussed in
      <a class="xref" href="innodb-storage-engine.html#innodb-locking" title="15.7.1 InnoDB Locking">Section 15.7.1, “InnoDB Locking”</a>. This may cause phantom problems
      because other sessions can insert new rows into the gaps when gap
      locking is disabled.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-deadlocks"></a>15.7.5 Deadlocks in InnoDB</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-deadlock-example">15.7.5.1 An InnoDB Deadlock Example</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-deadlock-detection">15.7.5.2 Deadlock Detection and Rollback</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-deadlocks-handling">15.7.5.3 How to Minimize and Handle Deadlocks</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091648946608"></a><a class="indexterm" name="idm140091648945120"></a><a class="indexterm" name="idm140091648943216"></a><a class="indexterm" name="idm140091648941728"></a><p>
      A deadlock is a situation where different transactions are unable
      to proceed because each holds a lock that the other needs. Because
      both transactions are waiting for a resource to become available,
      neither ever release the locks it holds.
    </p><p>
      A deadlock can occur when transactions lock rows in multiple
      tables (through statements such as
      <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> or
      <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ... FOR
      UPDATE</code></a>), but in the opposite order. A deadlock can also
      occur when such statements lock ranges of index records and gaps,
      with each transaction acquiring some locks but not others due to a
      timing issue. For a deadlock example, see
      <a class="xref" href="innodb-storage-engine.html#innodb-deadlock-example" title="15.7.5.1 An InnoDB Deadlock Example">Section 15.7.5.1, “An InnoDB Deadlock Example”</a>.
    </p><p>
      To reduce the possibility of deadlocks, use transactions rather
      than <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> statements; keep
      transactions that insert or update data small enough that they do
      not stay open for long periods of time; when different
      transactions update multiple tables or large ranges of rows, use
      the same order of operations (such as
      <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ... FOR
      UPDATE</code></a>) in each transaction; create indexes on the
      columns used in <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT ...
      FOR UPDATE</code></a> and
      <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE ... WHERE</code></a>
      statements. The possibility of deadlocks is not affected by the
      isolation level, because the isolation level changes the behavior
      of read operations, while deadlocks occur because of write
      operations. For more information about avoiding and recovering
      from deadlock conditions, see
      <a class="xref" href="innodb-storage-engine.html#innodb-deadlocks-handling" title="15.7.5.3 How to Minimize and Handle Deadlocks">Section 15.7.5.3, “How to Minimize and Handle Deadlocks”</a>.
    </p><p>
      When deadlock detection is enabled (the default) and a deadlock
      does occur, <code class="literal">InnoDB</code> detects the condition and
      rolls back one of the transactions (the victim). If deadlock
      detection is disabled using the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_deadlock_detect"><code class="literal">innodb_deadlock_detect</code></a>
      configuration option, <code class="literal">InnoDB</code> relies on the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> setting
      to roll back transactions in case of a deadlock. Thus, even if
      your application logic is correct, you must still handle the case
      where a transaction must be retried. To see the last deadlock in
      an <code class="literal">InnoDB</code> user transaction, use the
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> command. If frequent deadlocks highlight a
      problem with transaction structure or application error handling,
      run with the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a>
      setting enabled to print information about all deadlocks to the
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> error log. For more information about
      how deadlocks are automatically detected and handled, see
      <a class="xref" href="innodb-storage-engine.html#innodb-deadlock-detection" title="15.7.5.2 Deadlock Detection and Rollback">Section 15.7.5.2, “Deadlock Detection and Rollback”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-deadlock-example"></a>15.7.5.1 An InnoDB Deadlock Example</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091648917504"></a><a class="indexterm" name="idm140091648916048"></a><p>
        The following example illustrates how an error can occur when a
        lock request would cause a deadlock. The example involves two
        clients, A and B.
      </p><p>
        First, client A creates a table containing one row, and then
        begins a transaction. Within the transaction, A obtains an
        <code class="literal">S</code> lock on the row by selecting it in share
        mode:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t (i INT) ENGINE = InnoDB;</code></strong>
Query OK, 0 rows affected (1.07 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t (i) VALUES(1);</code></strong>
Query OK, 1 row affected (0.09 sec)

mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT * FROM t WHERE i = 1 FOR SHARE;</code></strong>
+------+
| i    |
+------+
|    1 |
+------+
</pre><p>
        Next, client B begins a transaction and attempts to delete the
        row from the table:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>DELETE FROM t WHERE i = 1;</code></strong>
</pre><p>
        The delete operation requires an <code class="literal">X</code> lock. The
        lock cannot be granted because it is incompatible with the
        <code class="literal">S</code> lock that client A holds, so the request
        goes on the queue of lock requests for the row and client B
        blocks.
      </p><p>
        Finally, client A also attempts to delete the row from the
        table:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>DELETE FROM t WHERE i = 1;</code></strong>
ERROR 1213 (40001): Deadlock found when trying to get lock;
try restarting transaction
</pre><p>
        Deadlock occurs here because client A needs an
        <code class="literal">X</code> lock to delete the row. However, that lock
        request cannot be granted because client B already has a request
        for an <code class="literal">X</code> lock and is waiting for client A to
        release its <code class="literal">S</code> lock. Nor can the
        <code class="literal">S</code> lock held by A be upgraded to an
        <code class="literal">X</code> lock because of the prior request by B for
        an <code class="literal">X</code> lock. As a result,
        <code class="literal">InnoDB</code> generates an error for one of the
        clients and releases its locks. The client returns this error:
      </p><pre data-lang="sql" class="programlisting">
ERROR 1213 (40001): Deadlock found when trying to get lock;
try restarting transaction
</pre><p>
        At that point, the lock request for the other client can be
        granted and it deletes the row from the table.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-deadlock-detection"></a>15.7.5.2 Deadlock Detection and Rollback</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648893328"></a><a class="indexterm" name="idm140091648891840"></a><a class="indexterm" name="idm140091648890768"></a><a class="indexterm" name="idm140091648889280"></a><a class="indexterm" name="idm140091648887376"></a><a class="indexterm" name="idm140091648885888"></a><p>
        When <a class="link" href="glossary.html#glos_deadlock_detection" title="deadlock detection">deadlock
        detection</a> is enabled (the default),
        <code class="literal">InnoDB</code> automatically detects transaction
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> and rolls back a
        transaction or transactions to break the deadlock.
        <code class="literal">InnoDB</code> tries to pick small transactions to
        roll back, where the size of a transaction is determined by the
        number of rows inserted, updated, or deleted.
      </p><p>
        <code class="literal">InnoDB</code> is aware of table locks if
        <code class="literal">innodb_table_locks = 1</code> (the default) and
        <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>, and the MySQL
        layer above it knows about row-level locks. Otherwise,
        <code class="literal">InnoDB</code> cannot detect deadlocks where a table
        lock set by a MySQL <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
        statement or a lock set by a storage engine other than
        <code class="literal">InnoDB</code> is involved. Resolve these situations
        by setting the value of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> system
        variable.
      </p><p>
        When <code class="literal">InnoDB</code> performs a complete rollback of a
        transaction, all locks set by the transaction are released.
        However, if just a single SQL statement is rolled back as a
        result of an error, some of the locks set by the statement may
        be preserved. This happens because <code class="literal">InnoDB</code>
        stores row locks in a format such that it cannot know afterward
        which lock was set by which statement.
      </p><p>
        If a <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> calls a stored
        function in a transaction, and a statement within the function
        fails, that statement rolls back. Furthermore, if
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> is
        executed after that, the entire transaction rolls back.
      </p><p>
        If the <code class="literal">LATEST DETECTED DEADLOCK</code> section of
        <code class="literal">InnoDB</code> Monitor output includes a message
        stating, <span class="quote">“<span class="quote"><span class="errortext">TOO DEEP OR LONG SEARCH IN THE LOCK
        TABLE WAITS-FOR GRAPH, WE WILL ROLL BACK FOLLOWING
        TRANSACTION</span>,</span>”</span> this indicates that the number
        of transactions on the wait-for list has reached a limit of 200.
        A wait-for list that exceeds 200 transactions is treated as a
        deadlock and the transaction attempting to check the wait-for
        list is rolled back. The same error may also occur if the
        locking thread must look at more than 1,000,000 locks owned by
        transactions on the wait-for list.
      </p><p>
        For techniques to organize database operations to avoid
        deadlocks, see <a class="xref" href="innodb-storage-engine.html#innodb-deadlocks" title="15.7.5 Deadlocks in InnoDB">Section 15.7.5, “Deadlocks in InnoDB”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-disable-deadlock-detection"></a>Disabling Deadlock Detection</h5>
</div>
</div>
</div>
<p>
          On high concurrency systems, deadlock detection can cause a
          slowdown when numerous threads wait for the same lock. At
          times, it may be more efficient to disable deadlock detection
          and rely on the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>
          setting for transaction rollback when a deadlock occurs.
          Deadlock detection can be disabled using the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_deadlock_detect"><code class="literal">innodb_deadlock_detect</code></a>
          configuration option.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-deadlocks-handling"></a>15.7.5.3 How to Minimize and Handle Deadlocks</h4>

</div>

</div>

</div>
<p>
        This section builds on the conceptual information about
        deadlocks in <a class="xref" href="innodb-storage-engine.html#innodb-deadlock-detection" title="15.7.5.2 Deadlock Detection and Rollback">Section 15.7.5.2, “Deadlock Detection and Rollback”</a>. It
        explains how to organize database operations to minimize
        deadlocks and the subsequent error handling required in
        applications.
      </p><p>
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">Deadlocks</a> are a classic
        problem in transactional databases, but they are not dangerous
        unless they are so frequent that you cannot run certain
        transactions at all. Normally, you must write your applications
        so that they are always prepared to re-issue a transaction if it
        gets rolled back because of a deadlock.
      </p><p>
        <code class="literal">InnoDB</code> uses automatic row-level locking. You
        can get deadlocks even in the case of transactions that just
        insert or delete a single row. That is because these operations
        are not really <span class="quote">“<span class="quote">atomic</span>”</span>; they automatically set
        locks on the (possibly several) index records of the row
        inserted or deleted.
      </p><p>
        You can cope with deadlocks and reduce the likelihood of their
        occurrence with the following techniques:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            At any time, issue the
            <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
            INNODB STATUS</code></a> command to determine the cause of
            the most recent deadlock. That can help you to tune your
            application to avoid deadlocks.
          </p></li><li class="listitem"><p>
            If frequent deadlock warnings cause concern, collect more
            extensive debugging information by enabling the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a>
            configuration option. Information about each deadlock, not
            just the latest one, is recorded in the MySQL
            <a class="link" href="glossary.html#glos_error_log" title="error log">error log</a>. Disable
            this option when you are finished debugging.
          </p></li><li class="listitem"><p>
            Always be prepared to re-issue a transaction if it fails due
            to deadlock. Deadlocks are not dangerous. Just try again.
          </p></li><li class="listitem"><p>
            Keep transactions small and short in duration to make them
            less prone to collision.
          </p></li><li class="listitem"><p>
            Commit transactions immediately after making a set of
            related changes to make them less prone to collision. In
            particular, do not leave an interactive
            <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> session open for a long time with
            an uncommitted transaction.
          </p></li><li class="listitem"><p>
            If you use <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking
            reads</a> (<a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT
            ... FOR UPDATE</code></a> or
            <code class="literal">SELECT ... FOR SHARE</code>),
            try using a lower isolation level such as
            <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>.
          </p></li><li class="listitem"><p>
            When modifying multiple tables within a transaction, or
            different sets of rows in the same table, do those
            operations in a consistent order each time. Then
            transactions form well-defined queues and do not deadlock.
            For example, organize database operations into functions
            within your application, or call stored routines, rather
            than coding multiple similar sequences of
            <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, and
            <code class="literal">DELETE</code> statements in different places.
          </p></li><li class="listitem"><p>
            Add well-chosen indexes to your tables. Then your queries
            need to scan fewer index records and consequently set fewer
            locks. Use <a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN Syntax"><code class="literal">EXPLAIN
            SELECT</code></a> to determine which indexes the MySQL server
            regards as the most appropriate for your queries.
          </p></li><li class="listitem"><p>
            Use less locking. If you can afford to permit a
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> to return data from an
            old snapshot, do not add the clause <code class="literal">FOR
            UPDATE</code> or <code class="literal">FOR SHARE</code> to it.
            Using the <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>
            isolation level is good here, because each consistent read
            within the same transaction reads from its own fresh
            snapshot.
          </p></li><li class="listitem"><p>
            If nothing else helps, serialize your transactions with
            table-level locks. The correct way to use
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> with
            transactional tables, such as <code class="literal">InnoDB</code>
            tables, is to begin a transaction with <code class="literal">SET
            autocommit = 0</code> (not
            <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
            TRANSACTION</code></a>) followed by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
            TABLES</code></a>, and to not call
            <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
            TABLES</code></a> until you commit the transaction
            explicitly. For example, if you need to write to table
            <code class="literal">t1</code> and read from table
            <code class="literal">t2</code>, you can do this:
          </p><pre data-lang="sql" class="programlisting">
SET autocommit=0;
LOCK TABLES t1 WRITE, t2 READ, ...;
<em class="replaceable"><code>... do something with tables t1 and t2 here ...</code></em>
COMMIT;
UNLOCK TABLES;
</pre><p>
            Table-level locks prevent concurrent updates to the table,
            avoiding deadlocks at the expense of less responsiveness for
            a busy system.
          </p></li><li class="listitem"><p>
            Another way to serialize transactions is to create an
            auxiliary <span class="quote">“<span class="quote">semaphore</span>”</span> table that contains just
            a single row. Have each transaction update that row before
            accessing other tables. In that way, all transactions happen
            in a serial fashion. Note that the <code class="literal">InnoDB</code>
            instant deadlock detection algorithm also works in this
            case, because the serializing lock is a row-level lock. With
            MySQL table-level locks, the timeout method must be used to
            resolve deadlocks.
</p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-configuration"></a>15.8 InnoDB Configuration</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-init-startup-configuration">15.8.1 InnoDB Startup Configuration</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-read-only-instance">15.8.2 Configuring InnoDB for Read-Only Operation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-buffer-pool">15.8.3 InnoDB Buffer Pool Configuration</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_concurrency">15.8.4 Configuring Thread Concurrency for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-multiple_io_threads">15.8.5 Configuring the Number of Background InnoDB I/O Threads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-linux-native-aio">15.8.6 Using Asynchronous I/O on Linux</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_io_rate">15.8.7 Configuring the InnoDB Master Thread I/O Rate</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-spin_lock_polling">15.8.8 Configuring Spin Lock Polling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-improved-purge-scheduling">15.8.9 Configuring InnoDB Purge Scheduling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-optimizer-statistics">15.8.10 Configuring Optimizer Statistics for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#index-page-merge-threshold">15.8.11 Configuring the Merge Threshold for Index Pages</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-dedicated-server">15.8.12 Enabling Automatic Configuration for a Dedicated MySQL Server</a></span></dt></dl>
</div>
<p>
    This section provides configuration information and procedures for
    <code class="literal">InnoDB</code> initialization, startup, and various
    components and features of the <code class="literal">InnoDB</code> storage
    engine. For information about optimizing database operations for
    <code class="literal">InnoDB</code> tables, see
    <a class="xref" href="optimization.html#optimizing-innodb" title="8.5 Optimizing for InnoDB Tables">Section 8.5, “Optimizing for InnoDB Tables”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-init-startup-configuration"></a>15.8.1 InnoDB Startup Configuration</h3>
</div>
</div>
</div>
<p>
      The first decisions to make about <code class="literal">InnoDB</code>
      configuration involve the configuration of data files, log files,
      page size, and memory buffers. It is recommended that you define
      data file, log file, and page size configuration before creating
      the <code class="literal">InnoDB</code> instance. Modifying data file or log
      file configuration after the <code class="literal">InnoDB</code> instance is
      created may involve a non-trivial procedure, and page size can
      only be defined when the <code class="literal">InnoDB</code> instance is
      first initialized.
    </p><p>
      In addition to these topics, this section provides information
      about specifying <code class="literal">InnoDB</code> options in a
      configuration file, viewing <code class="literal">InnoDB</code>
      initialization information, and important storage considerations.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-startup-mysql-configuration-file" title="Specifying Options in a MySQL Configuration File">Specifying Options in a MySQL Configuration File</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-startup-initialization-information" title="Viewing InnoDB Initialization Information">Viewing InnoDB Initialization Information</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-startup-storage-considerations" title="Important Storage Considerations">Important Storage Considerations</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-startup-data-file-configuration" title="System Tablespace Data File Configuration">System Tablespace Data File Configuration</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-startup-log-file-configuration" title="Redo Log File Configuration">Redo Log File Configuration</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-startup-undo-tablespace" title="Undo Tablespace Configuration">Undo Tablespace Configuration</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-startup-temporary-tablespace" title="Global Temporary Tablespace Configuration">Global Temporary Tablespace Configuration</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-startup-session-temporary-tablespaces" title="Session Temporary Tablespace Configuration">Session Temporary Tablespace Configuration</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-startup-page-size" title="Page Size Configuration">Page Size Configuration</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-startup-memory-configuration" title="Memory Configuration">Memory Configuration</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-startup-mysql-configuration-file"></a>Specifying Options in a MySQL Configuration File</h4>

</div>

</div>

</div>
<p>
        Because MySQL uses data file, log file, and page size
        configuration settings to initialize the
        <code class="literal">InnoDB</code> instance, it is recommended that you
        define these settings in a configuration file that MySQL reads
        at startup, prior to initializing <code class="literal">InnoDB</code> for
        the first time. <code class="literal">InnoDB</code> is initialized when
        the MySQL server is started, and the first initialization of
        <code class="literal">InnoDB</code> normally occurs the first time you
        start the MySQL server.
      </p><p>
        You can place <code class="literal">InnoDB</code> options in the
        <code class="literal">[mysqld]</code> group of any option file that your
        server reads when it starts. The locations of MySQL option files
        are described in <a class="xref" href="programs.html#option-files" title="4.2.2.2 Using Option Files">Section 4.2.2.2, “Using Option Files”</a>.
      </p><p>
        To make sure that <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> reads options only
        from a specific file (and <code class="filename">mysqld-auto.cnf</code>),
        use the <a class="link" href="programs.html#option_general_defaults-file"><code class="option">--defaults-file</code></a> option
        as the first option on the command line when starting the
        server:
      </p><pre data-lang="terminal" class="programlisting">
mysqld --defaults-file=<em class="replaceable"><code>path_to_configuration_file</code></em>
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-startup-initialization-information"></a>Viewing InnoDB Initialization Information</h4>

</div>

</div>

</div>
<p>
        To view <code class="literal">InnoDB</code> initialization information
        during startup, start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> from a command
        prompt. When <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is started from a command
        prompt, initialization information is printed to the console.
      </p><p>
        For example, on Windows, if <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is located
        in <code class="filename">C:\Program Files\MySQL\MySQL Server
        8.0\bin</code>, start the MySQL server like
        this:
      </p><pre data-lang="terminal" class="programlisting">
C:\&gt; <strong class="userinput"><code>"C:\Program Files\MySQL\MySQL Server 8.0\bin\mysqld" --console</code></strong>
</pre><p>
        On Unix-like systems, <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is located in
        the <code class="filename">bin</code> directory of your MySQL
        installation:
      </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>bin/mysqld --user=mysql &amp;</code></strong>
</pre><p>
        If you do not send server output to the console, check the error
        log after startup to see the initialization information
        <code class="literal">InnoDB</code> printed during the startup process.
      </p><p>
        For information about starting MySQL using other methods, see
        <a class="xref" href="installing.html#automatic-start" title="2.10.5 Starting and Stopping MySQL Automatically">Section 2.10.5, “Starting and Stopping MySQL Automatically”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <code class="literal">InnoDB</code> does not open all user tables and
          associated data files at startup. However,
          <code class="literal">InnoDB</code> does check for the existence of
          tablespace files (<code class="filename">*.ibd</code> files) that are
          referenced in the data dictionary. If a tablespace file is not
          found, <code class="literal">InnoDB</code> logs an error and continues
          the startup sequence. Tablespace files that are referenced in
          the redo log may be opened during crash recovery for redo
          application.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-startup-storage-considerations"></a>Important Storage Considerations</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648756800"></a><a class="indexterm" name="idm140091648755344"></a><p>
        Review the following storage-related considerations before
        proceeding with your startup configuration.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            In some cases, database performance improves if the data is
            not all placed on the same physical disk. Putting log files
            on a different disk from data is very often beneficial for
            performance. For example, you can place system tablespace
            data files and log files on different disks. You can also
            use raw disk partitions (raw devices) for
            <code class="literal">InnoDB</code> data files, which may speed up
            I/O. See <a class="xref" href="innodb-storage-engine.html#innodb-raw-devices" title="Using Raw Disk Partitions for the System Tablespace">Using Raw Disk Partitions for the System Tablespace</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> is a transaction-safe (ACID
            compliant) storage engine for MySQL that has commit,
            rollback, and crash-recovery capabilities to protect user
            data. <span class="bold"><strong>However, it cannot do
            so</strong></span> if the underlying operating system or hardware
            does not work as advertised. Many operating systems or disk
            subsystems may delay or reorder write operations to improve
            performance. On some operating systems, the very
            <code class="literal">fsync()</code> system call that should wait
            until all unwritten data for a file has been flushed might
            actually return before the data has been flushed to stable
            storage. Because of this, an operating system crash or a
            power outage may destroy recently committed data, or in the
            worst case, even corrupt the database because of write
            operations having been reordered. If data integrity is
            important to you, perform some <span class="quote">“<span class="quote">pull-the-plug</span>”</span>
            tests before using anything in production. On OS X 10.3 and
            higher, <code class="literal">InnoDB</code> uses a special
            <code class="literal">fcntl()</code> file flush method. Under Linux,
            it is advisable to <span class="bold"><strong>disable the
            write-back cache</strong></span>.
          </p><p>
            On ATA/SATA disk drives, a command such <code class="literal">hdparm -W0
            /dev/hda</code> may work to disable the write-back cache.
            <span class="bold"><strong>Beware that some drives or disk
            controllers may be unable to disable the write-back
            cache.</strong></span>
          </p></li><li class="listitem"><p>
            With regard to <code class="literal">InnoDB</code> recovery
            capabilities that protect user data,
            <code class="literal">InnoDB</code> uses a file flush technique
            involving a structure called the
            <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
            buffer</a>, which is enabled by default
            (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite=ON</code></a>).
            The doublewrite buffer adds safety to recovery following a
            crash or power outage, and improves performance on most
            varieties of Unix by reducing the need for
            <code class="literal">fsync()</code> operations. It is recommended
            that the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a>
            option remains enabled if you are concerned with data
            integrity or possible failures. For additional information
            about the doublewrite buffer, see
            <a class="xref" href="innodb-storage-engine.html#innodb-disk-io" title="15.11.1 InnoDB Disk I/O">Section 15.11.1, “InnoDB Disk I/O”</a>.
          </p></li><li class="listitem"><p>
            Before using NFS with <code class="literal">InnoDB</code>, review
            potential issues outlined in
            <a class="xref" href="optimization.html#disk-issues-nfs" title="Using NFS with MySQL">Using NFS with MySQL</a>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-startup-data-file-configuration"></a>System Tablespace Data File Configuration</h4>

</div>

</div>

</div>
<p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
        configuration option defines the name, size, and attributes of
        <code class="literal">InnoDB</code> system tablespace data files. If you
        do not specify a value for
        <code class="literal">innodb_data_file_path</code>, the default behavior
        is to create a single auto-extending data file, slightly larger
        than 12MB, named <code class="filename">ibdata1</code>.
      </p><p>
        To specify more than one data file, separate them by semicolon
        (<code class="literal">;</code>) characters:
      </p><pre data-lang="ini" class="programlisting">
innodb_data_file_path=<em class="replaceable"><code>datafile_spec1</code></em>[;<em class="replaceable"><code>datafile_spec2</code></em>]...
</pre><p>
        The following setting configures a single 12MB data file named
        <code class="filename">ibdata1</code> that is auto-extending. No location
        for the file is given, so by default, <code class="literal">InnoDB</code>
        creates it in the MySQL data directory:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_data_file_path=ibdata1:12M:autoextend
</pre><p>
        File size is specified using <code class="literal">K</code>,
        <code class="literal">M</code>, or <code class="literal">G</code> suffix letters to
        indicate units of KB, MB, or GB. If specifying the data file
        size in kilobytes (KB), do so in multiples of 1024. Otherwise,
        KB values are rounded to nearest megabyte (MB) boundary. The sum
        of the sizes of the files must be at least slightly larger than
        12MB.
      </p><p>
        A minimum file size is enforced for the
        <span class="emphasis"><em>first</em></span> system tablespace data file to ensure
        that there is enough space for doublewrite buffer pages:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            For an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
            value of 16KB or less, the minimum file size is 3MB.
          </p></li><li class="listitem"><p>
            For an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
            value of 32KB, the minimum file size is 6MB.
          </p></li><li class="listitem"><p>
            For an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
            value of 64KB, the minimum file size is 12MB.
</p></li></ul>
</div>
<p>
        A system tablespace with a fixed-size 50MB data file named
        <code class="filename">ibdata1</code> and a 50MB auto-extending file
        named <code class="filename">ibdata2</code> can be configured like this:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend
</pre><p>
        The full syntax for a data file specification includes the file
        name, file size, and optional <code class="literal">autoextend</code> and
        <code class="literal">max</code> attributes:
      </p><pre data-lang="ini" class="programlisting">
<em class="replaceable"><code>file_name</code></em>:<em class="replaceable"><code>file_size</code></em>[:autoextend[:max:<em class="replaceable"><code>max_file_size</code></em>]]
</pre><p>
        The <code class="literal">autoextend</code> and <code class="literal">max</code>
        attributes can be used only for the data file that is specified
        last in the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> setting.
      </p><p>
        If you specify the <code class="literal">autoextend</code> option for the
        last data file, <code class="literal">InnoDB</code> extends the data file
        if it runs out of free space in the tablespace. The
        <code class="literal">autoextend</code> increment is 64MB at a time by
        default. To modify the increment, change the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
        system variable.
      </p><p>
        If the disk becomes full, you might want to add another data
        file on another disk. For instructions, see
        <a class="xref" href="innodb-storage-engine.html#innodb-resize-system-tablespace" title="Resizing the System Tablespace">Resizing the System Tablespace</a>.
      </p><p>
        The size limit of individual files is determined by your
        operating system. You can set the file size to more than 4GB on
        operating systems that support large files. You can also
        <a class="link" href="innodb-storage-engine.html#innodb-raw-devices" title="Using Raw Disk Partitions for the System Tablespace">use raw disk partitions as
        data files</a>.
      </p><p>
        <code class="literal">InnoDB</code> is not aware of the file system
        maximum file size, so be cautious on file systems where the
        maximum file size is a small value such as 2GB. To specify a
        maximum size for an auto-extending data file, use the
        <code class="literal">max</code> attribute following the
        <code class="literal">autoextend</code> attribute. Use the
        <code class="literal">max</code> attribute only in cases where
        constraining disk usage is of critical importance, because
        exceeding the maximum size causes a fatal error, possibly
        causing the server to exit. The following configuration permits
        <code class="filename">ibdata1</code> to grow to a limit of 500MB:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_data_file_path=ibdata1:12M:autoextend:max:500M
</pre><p>
        <code class="literal">InnoDB</code> creates system tablespace files in the
        MySQL data directory by default
        (<a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a>). To specify a
        location explicitly, use the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> option.
        For example, to create two files named
        <code class="filename">ibdata1</code> and <code class="filename">ibdata2</code> in
        a directory named <code class="filename">myibdata</code>, configure
        <code class="literal">InnoDB</code> like this:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_data_home_dir = /path/to/myibdata/
innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          A trailing slash is required when specifying a value for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>.
        </p><p>
          <code class="literal">InnoDB</code> does not create directories, so make
          sure that the <code class="filename">myibdata</code> directory exists
          before you start the server. Use the Unix or DOS
          <code class="literal">mkdir</code> command to create directories.
        </p><p>
          Make sure that the MySQL server has the proper access rights
          to create files in the data directory. More generally, the
          server must have access rights in any directory where it needs
          to create data files.
</p>
</div>
<p>
        <code class="literal">InnoDB</code> forms the directory path for each data
        file by textually concatenating the value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> to the
        data file name. If the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> option is
        not specified, the default value is the <span class="quote">“<span class="quote">dot</span>”</span>
        directory <code class="filename">./</code>, which means the MySQL data
        directory. (The MySQL server changes its current working
        directory to its data directory when it begins executing.)
      </p><p>
        If you specify
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> as an
        empty string, you can specify absolute paths for data files
        listed in the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> value.
        The following example is equivalent to the preceding one:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_data_home_dir =
innodb_data_file_path=/path/to/myibdata/ibdata1:50M;/path/to/myibdata/ibdata2:50M:autoextend
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-startup-log-file-configuration"></a>Redo Log File Configuration</h4>

</div>

</div>

</div>
<p>
        By default, <code class="literal">InnoDB</code> creates two 5MB redo log
        files in the data directory named
        <code class="filename">ib_logfile0</code> and
        <code class="filename">ib_logfile1</code>.
      </p><p>
        The following options can be used to modify the default
        configuration:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_group_home_dir"><code class="literal">innodb_log_group_home_dir</code></a>
            defines directory path to the <code class="literal">InnoDB</code> log
            files (the redo logs). If this option is not configured,
            <code class="literal">InnoDB</code> log files are created in the MySQL
            data directory (<a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a>).
          </p><p>
            You might use this option to place <code class="literal">InnoDB</code>
            log files in a different physical storage location than
            <code class="literal">InnoDB</code> data files to avoid potential I/O
            resource conflicts. For example:
          </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_log_group_home_dir = /dr3/iblogs
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              <code class="literal">InnoDB</code> does not create directories, so
              make sure that the log directory exists before you start
              the server. Use the Unix or DOS <code class="literal">mkdir</code>
              command to create any necessary directories.
            </p><p>
              Make sure that the MySQL server has the proper access
              rights to create files in the log directory. More
              generally, the server must have access rights in any
              directory where it needs to create log files.
</p>
</div>
</li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>
            defines the number of log files in the log group. The
            default and recommended value is 2.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>
            defines the size in bytes of each log file in the log group.
            The combined size of log files
            (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> *
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>)
            cannot exceed a maximum value that is slightly less than
            512GB. A pair of 255 GB log files, for example, approaches
            the limit but does not exceed it. The default log file size
            is 48MB. Generally, the combined size of the log files
            should be large enough that the server can smooth out peaks
            and troughs in workload activity, which often means that
            there is enough redo log space to handle more than an hour
            of write activity. The larger the value, the less checkpoint
            flush activity is needed in the buffer pool, saving disk
            I/O. For additional information, see
            <a class="xref" href="optimization.html#optimizing-innodb-logging" title="8.5.4 Optimizing InnoDB Redo Logging">Section 8.5.4, “Optimizing InnoDB Redo Logging”</a>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-startup-undo-tablespace"></a>Undo Tablespace Configuration</h4>

</div>

</div>

</div>
<p>
        By default, undo logs reside in two undo tablespaces that are
        created when the MySQL instance is initialized. The I/O patterns
        for undo logs make undo tablespaces good candidates for
        <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> storage.
      </p><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
        variable defines the path where <code class="literal">InnoDB</code>
        creates default undo tablespaces. If that variable is undefined,
        default undo tablespaces are created in the data directory. The
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a> variable
        is not dynamic. Configuring it requires restarting the server.
      </p><p>
        For information about configuring additional undo tablespaces,
        see <a class="xref" href="innodb-storage-engine.html#innodb-undo-tablespaces" title="15.6.3.4 Undo Tablespaces">Section 15.6.3.4, “Undo Tablespaces”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-startup-temporary-tablespace"></a>Global Temporary Tablespace Configuration</h4>

</div>

</div>

</div>
<p>
        The global temporary tablespace stores rollback segments for
        changes made to user-created temporary tables.
      </p><p>
        By default, <code class="literal">InnoDB</code> creates a single
        auto-extending global temporary tablespace data file named
        <code class="filename">ibtmp1</code> in the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> directory.
        The initial file size is slightly larger than 12MB.
      </p><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>
        variable specifies the path, file name, and file size for global
        temporary tablespace data files. File size is specified in KB,
        MB, or GB by appending K, M, or G to the size value. The sum of
        the sizes of the files must be slightly larger than 12MB.
      </p><p>
        To specify an alternate location for global temporary tablespace
        data files, configure the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>
        variable at startup.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-startup-session-temporary-tablespaces"></a>Session Temporary Tablespace Configuration</h4>

</div>

</div>

</div>
<p>
        In MySQL 8.0.15 and earlier, session temporary tablespaces store
        user-created temporary tables and internal temporary tables
        created by the optimizer when <code class="literal">InnoDB</code> is
        configured as the on-disk storage engine for internal temporary
        tables
        (<a class="link" href="server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine=InnoDB</code></a>).
        In MySQL 8.0.16 and later, the <code class="literal">InnoDB</code> storage
        engine is always used for internal temporary tables on disk.
      </p><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_tablespaces_dir"><code class="literal">innodb_temp_tablespaces_dir</code></a>
        variable defines the location where <code class="literal">InnoDB</code>
        creates session temporary tablespaces. The default location is
        the <code class="filename">#innodb_temp</code> directory in the data
        directory.
      </p><p>
        To specify an alternate location for session temporary
        tablespaces, configure the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_tablespaces_dir"><code class="literal">innodb_temp_tablespaces_dir</code></a>
        variable at startup. A fully qualified path or path relative to
        the data directory is permitted.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-startup-page-size"></a>Page Size Configuration</h4>

</div>

</div>

</div>
<p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> option
        specifies the page size for all <code class="literal">InnoDB</code>
        tablespaces in a MySQL instance. This value is set when the
        instance is created and remains constant afterward. Valid values
        are 64KB, 32KB, 16KB (the default), 8KB, and 4KB. Alternatively,
        you can specify page size in bytes (65536, 32768, 16384, 8192,
        4096).
      </p><p>
        The default page size of 16KB is appropriate for a wide range of
        workloads, particularly for queries involving table scans and
        DML operations involving bulk updates. Smaller page sizes might
        be more efficient for OLTP workloads involving many small
        writes, where contention can be an issue when a single page
        contains many rows. Smaller pages might also be efficient with
        SSD storage devices, which typically use small block sizes.
        Keeping the <code class="literal">InnoDB</code> page size close to the
        storage device block size minimizes the amount of unchanged data
        that is rewritten to disk.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-startup-memory-configuration"></a>Memory Configuration</h4>

</div>

</div>

</div>
<p>
        MySQL allocates memory to various caches and buffers to improve
        performance of database operations. When allocating memory for
        <code class="literal">InnoDB</code>, always consider memory required by
        the operating system, memory allocated to other applications,
        and memory allocated for other MySQL buffers and caches. For
        example, if you use <code class="literal">MyISAM</code> tables, consider
        the amount of memory allocated for the key buffer
        (<a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>). For an
        overview of MySQL buffers and caches, see
        <a class="xref" href="optimization.html#memory-use" title="8.12.3.1 How MySQL Uses Memory">Section 8.12.3.1, “How MySQL Uses Memory”</a>.
      </p><p>
        Buffers specific to <code class="literal">InnoDB</code> are configured
        using the following parameters:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
            defines size of the buffer pool, which is the memory area
            that holds cached data for <code class="literal">InnoDB</code> tables,
            indexes, and other auxiliary buffers. The size of the buffer
            pool is important for system performance, and it is
            typically recommended that
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> is
            configured to 50 to 75 percent of system memory. The default
            buffer pool size is 128MB. For additional guidance, see
            <a class="xref" href="optimization.html#memory-use" title="8.12.3.1 How MySQL Uses Memory">Section 8.12.3.1, “How MySQL Uses Memory”</a>. For information about how to
            configure <code class="literal">InnoDB</code> buffer pool size, see
            <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-resize" title="15.8.3.1 Configuring InnoDB Buffer Pool Size">Section 15.8.3.1, “Configuring InnoDB Buffer Pool Size”</a>. Buffer pool
            size can be configured at startup or dynamically.
          </p><p>
            On systems with a large amount of memory, you can improve
            concurrency by dividing the buffer pool into multiple buffer
            pool instances. The number of buffer pool instances is
            controlled by the by
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
            option. By default, <code class="literal">InnoDB</code> creates one
            buffer pool instance. The number of buffer pool instances
            can be configured at startup. For more information, see
            <a class="xref" href="innodb-storage-engine.html#innodb-multiple-buffer-pools" title="15.8.3.2 Configuring Multiple Buffer Pool Instances">Section 15.8.3.2, “Configuring Multiple Buffer Pool Instances”</a>.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size"><code class="literal">innodb_log_buffer_size</code></a>
            defines the size in bytes of the buffer that
            <code class="literal">InnoDB</code> uses to write to the log files on
            disk. The default size is 16MB. A large log buffer enables
            large transactions to run without a need to write the log to
            disk before the transactions commit. If you have
            transactions that update, insert, or delete many rows, you
            might consider increasing the size of the log buffer to save
            disk I/O.
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size"><code class="literal">innodb_log_buffer_size</code></a> can
            be configured at startup. For related information, see
            <a class="xref" href="optimization.html#optimizing-innodb-logging" title="8.5.4 Optimizing InnoDB Redo Logging">Section 8.5.4, “Optimizing InnoDB Redo Logging”</a>.
</p></li></ul>
</div>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p>
          On 32-bit GNU/Linux x86, be careful not to set memory usage
          too high. <code class="literal">glibc</code> may permit the process heap
          to grow over thread stacks, which crashes your server. It is a
          risk if the memory allocated to the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
          process for global and per-thread buffers and caches is close
          to or exceeds 2GB.
        </p><p>
          A formula similar to the following that calculates global and
          per-thread memory allocation for MySQL can be used to estimate
          MySQL memory usage. You may need to modify the formula to
          account for buffers and caches in your MySQL version and
          configuration. For an overview of MySQL buffers and caches,
          see <a class="xref" href="optimization.html#memory-use" title="8.12.3.1 How MySQL Uses Memory">Section 8.12.3.1, “How MySQL Uses Memory”</a>.
        </p><pre data-lang="none" class="programlisting">
innodb_buffer_pool_size
+ key_buffer_size
+ max_connections*(sort_buffer_size+read_buffer_size+binlog_cache_size)
+ max_connections*2MB
</pre><p>
          Each thread uses a stack (often 2MB, but only 256KB in MySQL
          binaries provided by Oracle Corporation.) and in the worst
          case also uses <code class="literal">sort_buffer_size +
          read_buffer_size</code> additional memory.
</p>
</div>
<p>
        On Linux, if the kernel is enabled for large page support,
        <code class="literal">InnoDB</code> can use large pages to allocate memory
        for its buffer pool. See <a class="xref" href="optimization.html#large-page-support" title="8.12.3.2 Enabling Large Page Support">Section 8.12.3.2, “Enabling Large Page Support”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-read-only-instance"></a>15.8.2 Configuring InnoDB for Read-Only Operation</h3>

</div>

</div>

</div>
<p>
      You can now query <code class="literal">InnoDB</code> tables where the MySQL
      data directory is on read-only media, by enabling the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">--innodb-read-only</code></a> configuration
      option at server startup.
</p>
<h4><a name="idm140091648572880"></a>How to Enable</h4>
<p>
      To prepare an instance for read-only operation, make sure all the
      necessary information is <a class="link" href="glossary.html#glos_flush" title="flush">flushed</a>
      to the data files before storing it on the read-only medium. Run
      the server with change buffering disabled
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=0</code></a>) and
      do a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>.
    </p><p>
      To enable read-only mode for an entire MySQL instance, specify the
      following configuration options at server startup:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">--innodb-read-only=1</code></a>
        </p></li><li class="listitem"><p>
          If the instance is on read-only media such as a DVD or CD, or
          the <code class="filename">/var</code> directory is not writeable by
          all:
          <code class="literal">--pid-file=<em class="replaceable"><code>path_on_writeable_media</code></em></code>
          and <code class="literal">--event-scheduler=disabled</code>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">--innodb-temp-data-file-path</code></a>.
          This option specifies the path, file name, and file size for
          <code class="literal">InnoDB</code> temporary tablespace data files. The
          default setting is <code class="literal">ibtmp1:12M:autoextend</code>,
          which creates the <code class="filename">ibtmp1</code> temporary
          tablespace data file in the data directory. To prepare an
          instance for read-only operation, set
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a> to
          a location outside of the data directory. The path must be
          relative to the data directory. For example:
        </p><pre data-lang="terminal" class="programlisting">
--innodb-temp-data-file-path=../../../tmp/ibtmp1:12M:autoextend         
</pre></li></ul>
</div>
<p>
      As of MySQL 8.0, enabling
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">innodb_read_only</code></a> prevents table
      creation and drop operations for all storage engines. These
      operations modify data dictionary tables in the
      <code class="literal">mysql</code> system database, but those tables use the
      <code class="literal">InnoDB</code> storage engine and cannot be modified
      when <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">innodb_read_only</code></a> is enabled.
      The same restriction applies to any operation that modifies data
      dictionary tables, such as <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
      TABLE</code></a> and
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
      <em class="replaceable"><code>tbl_name</code></em>
      ENGINE=<em class="replaceable"><code>engine_name</code></em></code></a>.
    </p><p>
      In addition, other tables in the <code class="literal">mysql</code> system
      database use the <code class="literal">InnoDB</code> storage engine in MySQL
      8.0. Making those tables read only results in
      restrictions on operations that modify them. For example,
      <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
      <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>,
      <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a>, and
      <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> operations are not
      permitted in read-only mode.
</p>
<h4><a name="idm140091648540672"></a>Usage Scenarios</h4>
<p>
      This mode of operation is appropriate in situations such as:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Distributing a MySQL application, or a set of MySQL data, on a
          read-only storage medium such as a DVD or CD.
        </p></li><li class="listitem"><p>
          Multiple MySQL instances querying the same data directory
          simultaneously, typically in a data warehousing configuration.
          You might use this technique to avoid
          <a class="link" href="glossary.html#glos_bottleneck" title="bottleneck">bottlenecks</a> that can
          occur with a heavily loaded MySQL instance, or you might use
          different configuration options for the various instances to
          tune each one for particular kinds of queries.
        </p></li><li class="listitem"><p>
          Querying data that has been put into a read-only state for
          security or data integrity reasons, such as archived backup
          data.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        This feature is mainly intended for flexibility in distribution
        and deployment, rather than raw performance based on the
        read-only aspect. See
        <a class="xref" href="optimization.html#innodb-performance-ro-txn" title="8.5.3 Optimizing InnoDB Read-Only Transactions">Section 8.5.3, “Optimizing InnoDB Read-Only Transactions”</a> for ways to tune the
        performance of read-only queries, which do not require making
        the entire server read-only.
</p>
</div>
<h4><a name="idm140091648533392"></a>How It Works</h4>
<p>
      When the server is run in read-only mode through the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">--innodb-read-only</code></a> option,
      certain <code class="literal">InnoDB</code> features and components are
      reduced or turned off entirely:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          No <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change
          buffering</a> is done, in particular no merges from the
          change buffer. To make sure the change buffer is empty when
          you prepare the instance for read-only operation, disable
          change buffering
          (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=0</code></a>)
          and do a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow
          shutdown</a> first.
        </p></li><li class="listitem"><p>
          There is no <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash
          recovery</a> phase at startup. The instance must have
          performed a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow
          shutdown</a> before being put into the read-only state.
        </p></li><li class="listitem"><p>
          Because the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> is
          not used in read-only operation, you can set
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> to the
          smallest size possible (1 MB) before making the instance
          read-only.
        </p></li><li class="listitem"><p>
          All background threads other than I/O read threads are turned
          off. As a consequence, a read-only instance cannot encounter
          any <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>.
        </p></li><li class="listitem"><p>
          Information about deadlocks, monitor output, and so on is not
          written to temporary files. As a consequence,
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> does not produce any output.
        </p></li><li class="listitem"><p>
          Changes to configuration option settings that would normally
          change the behavior of write operations, have no effect when
          the server is in read-only mode.
        </p></li><li class="listitem"><p>
          The <a class="link" href="glossary.html#glos_mvcc" title="MVCC">MVCC</a> processing to
          enforce <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation
          levels</a> is turned off. All queries read the latest
          version of a record, because update and deletes are not
          possible.
        </p></li><li class="listitem"><p>
          The <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo log</a> is not used.
          Disable any settings for the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a> and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
          configuration options.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-buffer-pool"></a>15.8.3 InnoDB Buffer Pool Configuration</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-buffer-pool-resize">15.8.3.1 Configuring InnoDB Buffer Pool Size</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multiple-buffer-pools">15.8.3.2 Configuring Multiple Buffer Pool Instances</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-midpoint_insertion">15.8.3.3 Making the Buffer Pool Scan Resistant</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-read_ahead">15.8.3.4 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-adaptive_flushing">15.8.3.5 Configuring InnoDB Buffer Pool Flushing</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-lru-background-flushing">15.8.3.6 Fine-tuning InnoDB Buffer Pool Flushing</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-preload-buffer-pool">15.8.3.7 Saving and Restoring the Buffer Pool State</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-buffer-pool-in-core-file">15.8.3.8 Excluding Buffer Pool Pages from Core Files</a></span></dt></dl>
</div>
<p>
      This section provides configuration and tuning information for the
      <code class="literal">InnoDB</code> buffer pool.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-buffer-pool-resize"></a>15.8.3.1 Configuring InnoDB Buffer Pool Size</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091648504912"></a><a class="indexterm" name="idm140091648503840"></a><a class="indexterm" name="idm140091648502768"></a><p>
        You can configure <code class="literal">InnoDB</code> buffer pool size
        offline (at startup) or online, while the server is running.
        Behavior described in this section applies to both methods. For
        additional information about configuring buffer pool size
        online, see <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-online-resize" title="Configuring InnoDB Buffer Pool Size Online">Configuring InnoDB Buffer Pool Size Online</a>.
      </p><p>
        When increasing or decreasing
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>, the
        operation is performed in chunks. Chunk size is defined by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
        configuration option, which has a default of
        <code class="literal">128M</code>. For more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-chunk-size" title="Configuring InnoDB Buffer Pool Chunk Size">Configuring InnoDB Buffer Pool Chunk Size</a>.
      </p><p>
        Buffer pool size must always be equal to or a multiple of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a> *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
        If you configure
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> to a
        value that is not equal to or a multiple of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a> *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>,
        buffer pool size is automatically adjusted to a value that is
        equal to or a multiple of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a> *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
      </p><p>
        In the following example,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> is set
        to <code class="literal">8G</code>, and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a> is
        set to <code class="literal">16</code>.
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
        is <code class="literal">128M</code>, which is the default value.
      </p><p>
        <code class="literal">8G</code> is a valid
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> value
        because <code class="literal">8G</code> is a multiple of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances=16</code></a>
        *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size=128M</code></a>,
        which is <code class="literal">2G</code>.
      </p><pre data-lang="ini" class="programlisting">
shell&gt; <strong class="userinput"><code>mysqld --innodb-buffer-pool-size=8G --innodb-buffer-pool-instances=16</code></strong>
</pre><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_size/1024/1024/1024;</code></strong>
+------------------------------------------+
| @@innodb_buffer_pool_size/1024/1024/1024 |
+------------------------------------------+
|                           8.000000000000 |
+------------------------------------------+
</pre><p>
        In this example,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> is set
        to <code class="literal">9G</code>, and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a> is
        set to <code class="literal">16</code>.
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
        is <code class="literal">128M</code>, which is the default value. In this
        case, <code class="literal">9G</code> is not a multiple of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances=16</code></a>
        *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size=128M</code></a>,
        so <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> is
        adjusted to <code class="literal">10G</code>, which is a multiple of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a> *
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
      </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysqld --innodb-buffer-pool-size=9G --innodb-buffer-pool-instances=16</code></strong>
</pre><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_size/1024/1024/1024;</code></strong>
+------------------------------------------+
| @@innodb_buffer_pool_size/1024/1024/1024 |
+------------------------------------------+
|                          10.000000000000 |
+------------------------------------------+
</pre>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-buffer-pool-chunk-size"></a>Configuring InnoDB Buffer Pool Chunk Size</h5>
</div>
</div>
</div>
<p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          can be increased or decreased in 1MB (1048576 byte) units but
          can only be modified at startup, in a command line string or
          in a MySQL configuration file.
        </p><p>
          Command line:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysqld --innodb-buffer-pool-chunk-size=134217728</code></strong>
</pre><p>
          Configuration file:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_buffer_pool_chunk_size=134217728
</pre><p>
          The following conditions apply when altering
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the new <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">
              innodb_buffer_pool_chunk_size</code></a> value *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
              is larger than the current buffer pool size when the
              buffer pool is initialized,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              is truncated to
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> /
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
            </p><p>
              For example, if the buffer pool is initialized with a size
              of <code class="literal">2GB</code> (2147483648 bytes),
              <code class="literal">4</code> buffer pool instances, and a chunk
              size of <code class="literal">1GB</code> (1073741824 bytes), chunk
              size is truncated to a value equal to
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> /
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>,
              as shown below:
            </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysqld --innodb-buffer-pool-size=2147483648 --innodb-buffer-pool-instances=4</code></strong>
<strong class="userinput"><code>--innodb-buffer-pool-chunk-size=1073741824;</code></strong>
</pre><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_size;</code></strong>
+---------------------------+
| @@innodb_buffer_pool_size |
+---------------------------+
|                2147483648 |
+---------------------------+

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_instances;</code></strong>
+--------------------------------+
| @@innodb_buffer_pool_instances |
+--------------------------------+
|                              4 |
+--------------------------------+

# Chunk size was set to 1GB (1073741824 bytes) on startup but was
# truncated to innodb_buffer_pool_size / innodb_buffer_pool_instances

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_chunk_size;</code></strong>
+---------------------------------+
| @@innodb_buffer_pool_chunk_size |
+---------------------------------+
|                       536870912 |
+---------------------------------+
</pre></li><li class="listitem"><p>
              Buffer pool size must always be equal to or a multiple of
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
              If you alter
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
              is automatically adjusted to a value that is equal to or a
              multiple of
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
              The adjustment occurs when the buffer pool is initialized.
              This behavior is demonstrated in the following example:
            </p><pre data-lang="sql" class="programlisting">
# The buffer pool has a default size of 128MB (134217728 bytes)

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_size;</code></strong>
+---------------------------+
| @@innodb_buffer_pool_size |
+---------------------------+
|                 134217728 |
+---------------------------+

# The chunk size is also 128MB (134217728 bytes)

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_chunk_size;</code></strong>
+---------------------------------+
| @@innodb_buffer_pool_chunk_size |
+---------------------------------+
|                       134217728 |
+---------------------------------+

# There is a single buffer pool instance

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_instances;</code></strong>
+--------------------------------+
| @@innodb_buffer_pool_instances |
+--------------------------------+
|                              1 |
+--------------------------------+

# Chunk size is decreased by 1MB (1048576 bytes) at startup
# (134217728 - 1048576 = 133169152):

shell&gt; <strong class="userinput"><code>mysqld --innodb-buffer-pool-chunk-size=133169152</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_chunk_size;</code></strong>
+---------------------------------+
| @@innodb_buffer_pool_chunk_size |
+---------------------------------+
|                       133169152 |
+---------------------------------+

# Buffer pool size increases from 134217728 to 266338304
# Buffer pool size is automatically adjusted to a value that is equal to
# or a multiple of innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_size;</code></strong>
+---------------------------+
| @@innodb_buffer_pool_size |
+---------------------------+
|                 266338304 |
+---------------------------+</pre><p>
              This example demonstrates the same behavior but with
              multiple buffer pool instances:
            </p><pre data-lang="sql" class="programlisting">
# The buffer pool has a default size of 2GB (2147483648 bytes)

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_size;</code></strong>
+---------------------------+
| @@innodb_buffer_pool_size |
+---------------------------+
|                2147483648 |
+---------------------------+

# The chunk size is .5 GB (536870912 bytes)

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_chunk_size;</code></strong>
+---------------------------------+
| @@innodb_buffer_pool_chunk_size |
+---------------------------------+
|                       536870912 |
+---------------------------------+

# There are 4 buffer pool instances

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_instances;</code></strong>
+--------------------------------+
| @@innodb_buffer_pool_instances |
+--------------------------------+
|                              4 |
+--------------------------------+

# Chunk size is decreased by 1MB (1048576 bytes) at startup
# (536870912 - 1048576 = 535822336):

shell&gt; <strong class="userinput"><code>mysqld --innodb-buffer-pool-chunk-size=535822336</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_chunk_size;</code></strong>
+---------------------------------+
| @@innodb_buffer_pool_chunk_size |
+---------------------------------+
|                       535822336 |
+---------------------------------+

# Buffer pool size increases from 2147483648 to 4286578688
# Buffer pool size is automatically adjusted to a value that is equal to
# or a multiple of innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances

mysql&gt; <strong class="userinput"><code>SELECT @@innodb_buffer_pool_size;</code></strong>
+---------------------------+
| @@innodb_buffer_pool_size |
+---------------------------+
|                4286578688 |
+---------------------------+
</pre><p>
              Care should be taken when changing
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
              as changing this value can increase the size of the buffer
              pool, as shown in the examples above. Before you change
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
              calculate the effect on
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
              to ensure that the resulting buffer pool size is
              acceptable.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            To avoid potential performance issues, the number of chunks
            (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> /
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>)
            should not exceed 1000.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-buffer-pool-online-resize"></a>Configuring InnoDB Buffer Pool Size Online</h5>

</div>

</div>

</div>
<p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
          configuration option can be set dynamically using a
          <a class="link" href="data-types.html#set" title="11.4.5 The SET Type"><code class="literal">SET</code></a> statement, allowing you to
          resize the buffer pool without restarting the server. For
          example:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_buffer_pool_size=402653184;</code></strong>
</pre><p>
          Active transactions and operations performed through
          <code class="literal">InnoDB</code> APIs should be completed before
          resizing the buffer pool. When initiating a resizing
          operation, the operation does not start until all active
          transactions are completed. Once the resizing operation is in
          progress, new transactions and operations that require access
          to the buffer pool must wait until the resizing operation
          finishes. The exception to the rule is that concurrent access
          to the buffer pool is permitted while the buffer pool is
          defragmented and pages are withdrawn when buffer pool size is
          decreased. A drawback of allowing concurrent access is that it
          could result in a temporary shortage of available pages while
          pages are being withdrawn.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Nested transactions could fail if initiated after the buffer
            pool resizing operation begins.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-buffer-pool-online-resize-monitoring"></a>Monitoring Online Buffer Pool Resizing Progress</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648380128"></a><a class="indexterm" name="idm140091648378640"></a><p>
          The
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_resize_status"><code class="literal">Innodb_buffer_pool_resize_status</code></a>
          reports buffer pool resizing progress. For example:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS WHERE Variable_name='InnoDB_buffer_pool_resize_status';</code></strong>
+----------------------------------+----------------------------------+
| Variable_name                    | Value                            |
+----------------------------------+----------------------------------+
| Innodb_buffer_pool_resize_status | Resizing also other hash tables. |
+----------------------------------+----------------------------------+
</pre><p>
          Buffer pool resizing progress is also logged in the server
          error log. This example shows notes that are logged when
          increasing the size of the buffer pool:
        </p><pre data-lang="terminal" class="programlisting">
[Note] InnoDB: Resizing buffer pool from 134217728 to 4294967296. (unit=134217728)
[Note] InnoDB: disabled adaptive hash index.
[Note] InnoDB: buffer pool 0 : 31 chunks (253952 blocks) was added.
[Note] InnoDB: buffer pool 0 : hash tables were resized.
[Note] InnoDB: Resized hash tables at lock_sys, adaptive hash index, dictionary.
[Note] InnoDB: completed to resize buffer pool from 134217728 to 4294967296.
[Note] InnoDB: re-enabled adaptive hash index.
</pre><p>
          This example shows notes that are logged when decreasing the
          size of the buffer pool:
        </p><pre data-lang="terminal" class="programlisting">
[Note] InnoDB: Resizing buffer pool from 4294967296 to 134217728. (unit=134217728)
[Note] InnoDB: disabled adaptive hash index.
[Note] InnoDB: buffer pool 0 : start to withdraw the last 253952 blocks.
[Note] InnoDB: buffer pool 0 : withdrew 253952 blocks from free list. tried to relocate 0 pages.
(253952/253952)
[Note] InnoDB: buffer pool 0 : withdrawn target 253952 blocks.
[Note] InnoDB: buffer pool 0 : 31 chunks (253952 blocks) was freed.
[Note] InnoDB: buffer pool 0 : hash tables were resized.
[Note] InnoDB: Resized hash tables at lock_sys, adaptive hash index, dictionary.
[Note] InnoDB: completed to resize buffer pool from 4294967296 to 134217728.
[Note] InnoDB: re-enabled adaptive hash index.
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-buffer-pool-online-resize-internals"></a>Online Buffer Pool Resizing Internals</h5>

</div>

</div>

</div>
<p>
          The resizing operation is performed by a background thread.
          When increasing the size of the buffer pool, the resizing
          operation:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Adds pages in <code class="literal">chunks</code> (chunk size is
              defined by
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>)
            </p></li><li class="listitem"><p>
              Coverts hash tables, lists, and pointers to use new
              addresses in memory
            </p></li><li class="listitem"><p>
              Adds new pages to the free list
</p></li></ul>
</div>
<p>
          While these operations are in progress, other threads are
          blocked from accessing the buffer pool.
        </p><p>
          When decreasing the size of the buffer pool, the resizing
          operation:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Defragments the buffer pool and withdraws (frees) pages
            </p></li><li class="listitem"><p>
              Removes pages in <code class="literal">chunks</code> (chunk size is
              defined by
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>)
            </p></li><li class="listitem"><p>
              Converts hash tables, lists, and pointers to use new
              addresses in memory
</p></li></ul>
</div>
<p>
          Of these operations, only defragmenting the buffer pool and
          withdrawing pages allow other threads to access to the buffer
          pool concurrently.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-multiple-buffer-pools"></a>15.8.3.2 Configuring Multiple Buffer Pool Instances</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648354592"></a><a class="indexterm" name="idm140091648353520"></a><a class="indexterm" name="idm140091648352448"></a><p>
        For systems with buffer pools in the multi-gigabyte range,
        dividing the buffer pool into separate instances can improve
        concurrency, by reducing contention as different threads read
        and write to cached pages. This feature is typically intended
        for systems with a <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
        pool</a> size in the multi-gigabyte range. Multiple buffer
        pool instances are configured using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
        configuration option, and you might also adjust the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> value.
      </p><p>
        When the <code class="literal">InnoDB</code> buffer pool is large, many
        data requests can be satisfied by retrieving from memory. You
        might encounter bottlenecks from multiple threads trying to
        access the buffer pool at once. You can enable multiple buffer
        pools to minimize this contention. Each page that is stored in
        or read from the buffer pool is assigned to one of the buffer
        pools randomly, using a hashing function. Each buffer pool
        manages its own free lists, flush lists, LRUs, and all other
        data structures connected to a buffer pool. Prior to MySQL 8.0,
        each buffer pool was protected by its own buffer pool mutex. In
        MySQL 8.0 and later, the buffer pool mutex was replaced by
        several list and hash protecting mutexes, to reduce contention.
      </p><p>
        To enable multiple buffer pool instances, set the
        <code class="literal">innodb_buffer_pool_instances</code> configuration
        option to a value greater than 1 (the default) up to 64 (the
        maximum). This option takes effect only when you set
        <code class="literal">innodb_buffer_pool_size</code> to a size of 1GB or
        more. The total size you specify is divided among all the buffer
        pools. For best efficiency, specify a combination of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
        and <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> so
        that each buffer pool instance is at least 1GB.
      </p><p>
        For information about modifying <code class="literal">InnoDB</code> buffer
        pool size, see <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-resize" title="15.8.3.1 Configuring InnoDB Buffer Pool Size">Section 15.8.3.1, “Configuring InnoDB Buffer Pool Size”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-midpoint_insertion"></a>15.8.3.3 Making the Buffer Pool Scan Resistant</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648337312"></a><a class="indexterm" name="idm140091648336240"></a><a class="indexterm" name="idm140091648335168"></a><a class="indexterm" name="idm140091648334096"></a><a class="indexterm" name="idm140091648333024"></a><a class="indexterm" name="idm140091648331952"></a><a class="indexterm" name="idm140091648330880"></a><p>
        Rather than using a strict <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a>
        algorithm, <code class="literal">InnoDB</code> uses a technique to
        minimize the amount of data that is brought into the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> and never
        accessed again. The goal is to make sure that frequently
        accessed (<span class="quote">“<span class="quote">hot</span>”</span>) pages remain in the buffer pool,
        even as <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> and
        <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full table scans</a>
        bring in new blocks that might or might not be accessed
        afterward.
      </p><p>
        Newly read blocks are inserted into the middle of the LRU list.
        All newly read pages are inserted at a location that by default
        is <code class="literal">3/8</code> from the tail of the LRU list. The
        pages are moved to the front of the list (the most-recently used
        end) when they are accessed in the buffer pool for the first
        time. Thus, pages that are never accessed never make it to the
        front portion of the LRU list, and <span class="quote">“<span class="quote">age out</span>”</span> sooner
        than with a strict LRU approach. This arrangement divides the
        LRU list into two segments, where the pages downstream of the
        insertion point are considered <span class="quote">“<span class="quote">old</span>”</span> and are
        desirable victims for LRU eviction.
      </p><p>
        For an explanation of the inner workings of the
        <code class="literal">InnoDB</code> buffer pool and specifics about the
        LRU algorithm, see <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool" title="15.5.1 Buffer Pool">Section 15.5.1, “Buffer Pool”</a>.
      </p><p>
        You can control the insertion point in the LRU list and choose
        whether <code class="literal">InnoDB</code> applies the same optimization
        to blocks brought into the buffer pool by table or index scans.
        The configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> controls
        the percentage of <span class="quote">“<span class="quote">old</span>”</span> blocks in the LRU list. The
        default value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> is
        <code class="literal">37</code>, corresponding to the original fixed ratio
        of 3/8. The value range is <code class="literal">5</code> (new pages in
        the buffer pool age out very quickly) to <code class="literal">95</code>
        (only 5% of the buffer pool is reserved for hot pages, making
        the algorithm close to the familiar LRU strategy).
      </p><p>
        The optimization that keeps the buffer pool from being churned
        by read-ahead can avoid similar problems due to table or index
        scans. In these scans, a data page is typically accessed a few
        times in quick succession and is never touched again. The
        configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
        specifies the time window (in milliseconds) after the first
        access to a page during which it can be accessed without being
        moved to the front (most-recently used end) of the LRU list. The
        default value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> is
        <code class="literal">1000</code>. Increasing this value makes more and
        more blocks likely to age out faster from the buffer pool.
      </p><p>
        Both <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> can be
        specified in the MySQL option file (<code class="literal">my.cnf</code> or
        <code class="literal">my.ini</code>) or changed at runtime with the
        <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
        GLOBAL</code></a> statement. Changing the value at runtime
        requires privileges sufficient to set global system variables.
        See <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>.
      </p><p>
        To help you gauge the effect of setting these parameters, the
        <code class="literal">SHOW ENGINE INNODB STATUS</code> command reports
        buffer pool statistics. For details, see
        <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-monitoring" title="Monitoring the Buffer Pool Using the InnoDB Standard Monitor">Monitoring the Buffer Pool Using the InnoDB Standard Monitor</a>.
      </p><p>
        Because the effects of these parameters can vary widely based on
        your hardware configuration, your data, and the details of your
        workload, always benchmark to verify the effectiveness before
        changing these settings in any performance-critical or
        production environment.
      </p><p>
        In mixed workloads where most of the activity is OLTP type with
        periodic batch reporting queries which result in large scans,
        setting the value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> during
        the batch runs can help keep the working set of the normal
        workload in the buffer pool.
      </p><p>
        When scanning large tables that cannot fit entirely in the
        buffer pool, setting
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> to a
        small value keeps the data that is only read once from consuming
        a significant portion of the buffer pool. For example, setting
        <code class="literal">innodb_old_blocks_pct=5</code> restricts this data
        that is only read once to 5% of the buffer pool.
      </p><p>
        When scanning small tables that do fit into memory, there is
        less overhead for moving pages around within the buffer pool, so
        you can leave
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> at its
        default value, or even higher, such as
        <code class="literal">innodb_old_blocks_pct=50</code>.
      </p><p>
        The effect of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
        parameter is harder to predict than the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        parameter, is relatively small, and varies more with the
        workload. To arrive at an optimal value, conduct your own
        benchmarks if the performance improvement from adjusting
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> is not
        sufficient.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-read_ahead"></a>15.8.3.4 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648286784"></a><a class="indexterm" name="idm140091648285712"></a><a class="indexterm" name="idm140091648284640"></a><a class="indexterm" name="idm140091648283600"></a><a class="indexterm" name="idm140091648282112"></a><p>
        A <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> request is
        an I/O request to prefetch multiple pages in the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>
        asynchronously, in anticipation that these pages will be needed
        soon. The requests bring in all the pages in one
        <a class="link" href="glossary.html#glos_extent" title="extent">extent</a>.
        <code class="literal">InnoDB</code> uses two read-ahead algorithms to
        improve I/O performance:
      </p><p>
        <span class="strong"><strong>Linear</strong></span> read-ahead is a
        technique that predicts what pages might be needed soon based on
        pages in the buffer pool being accessed sequentially. You
        control when <code class="literal">InnoDB</code> performs a read-ahead
        operation by adjusting the number of sequential page accesses
        required to trigger an asynchronous read request, using the
        configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>.
        Before this parameter was added, <code class="literal">InnoDB</code> would
        only calculate whether to issue an asynchronous prefetch request
        for the entire next extent when it read the last page of the
        current extent.
      </p><p>
        The configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>
        controls how sensitive <code class="literal">InnoDB</code> is in detecting
        patterns of sequential page access. If the number of pages read
        sequentially from an extent is greater than or equal to
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>,
        <code class="literal">InnoDB</code> initiates an asynchronous read-ahead
        operation of the entire following extent.
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a> can
        be set to any value from 0-64. The default value is 56. The
        higher the value, the more strict the access pattern check. For
        example, if you set the value to 48, <code class="literal">InnoDB</code>
        triggers a linear read-ahead request only when 48 pages in the
        current extent have been accessed sequentially. If the value is
        8, <code class="literal">InnoDB</code> triggers an asynchronous read-ahead
        even if as few as 8 pages in the extent are accessed
        sequentially. You can set the value of this parameter in the
        MySQL <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration
        file</a>, or change it dynamically with the
        <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
        GLOBAL</code></a> statement, which requires privileges sufficient
        to set global system variables. See
        <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>.
      </p><p>
        <span class="strong"><strong>Random</strong></span> read-ahead is a
        technique that predicts when pages might be needed soon based on
        pages already in the buffer pool, regardless of the order in
        which those pages were read. If 13 consecutive pages from the
        same extent are found in the buffer pool,
        <code class="literal">InnoDB</code> asynchronously issues a request to
        prefetch the remaining pages of the extent. To enable this
        feature, set the configuration variable
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead"><code class="literal">innodb_random_read_ahead</code></a> to
        <code class="literal">ON</code>.
      </p><p>
        The <code class="literal">SHOW ENGINE INNODB STATUS</code> command
        displays statistics to help you evaluate the effectiveness of
        the read-ahead algorithm. Statistics include counter information
        for the following global status variables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead"><code class="literal">Innodb_buffer_pool_read_ahead</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted"><code class="literal">Innodb_buffer_pool_read_ahead_evicted</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_rnd"><code class="literal">Innodb_buffer_pool_read_ahead_rnd</code></a>
</p></li></ul>
</div>
<p>
        This information can be useful when fine-tuning the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead"><code class="literal">innodb_random_read_ahead</code></a>
        setting.
      </p><p>
        For more information about I/O performance, see
        <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a> and
        <a class="xref" href="optimization.html#disk-issues" title="8.12.1 Optimizing Disk I/O">Section 8.12.1, “Optimizing Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-adaptive_flushing"></a>15.8.3.5 Configuring InnoDB Buffer Pool Flushing</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648244480"></a><a class="indexterm" name="idm140091648243408"></a><a class="indexterm" name="idm140091648242336"></a><a class="indexterm" name="idm140091648241248"></a><a class="indexterm" name="idm140091648240160"></a><a class="indexterm" name="idm140091648238640"></a><a class="indexterm" name="idm140091648237152"></a><p>
        <code class="literal">InnoDB</code> performs certain tasks in the
        background, including <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a>
        of <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> (those
        pages that have been changed but are not yet written to the
        database files) from the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
        pool</a>.
      </p><p>
        <code class="literal">InnoDB</code> starts flushing buffer pool pages when
        the percentage of dirty pages in the buffer pool reaches the low
        water mark setting defined by
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm</code></a>.
        This option is intended to control the ratio of dirty pages in
        the buffer pool and ideally prevent the percentage of dirty
        pages from reaching
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>. If
        the percentage of dirty pages in the buffer pool exceeds
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>,
        <code class="literal">InnoDB</code> begins to aggressively flush buffer
        pool pages.
      </p><p>
        <code class="literal">InnoDB</code> uses an algorithm to estimate the
        required rate of flushing, based on the speed of redo log
        generation and the current rate of flushing. The intent is to
        smooth overall performance by ensuring that buffer flush
        activity keeps up with the need to keep the buffer pool
        <span class="quote">“<span class="quote">clean</span>”</span>. Automatically adjusting the rate of
        flushing can help to avoid sudden dips in throughput, when
        excessive buffer pool flushing limits the I/O capacity available
        for ordinary read and write activity.
      </p><p>
        <code class="literal">InnoDB</code> uses its log files in a circular
        fashion. Before reusing a portion of a log file,
        <code class="literal">InnoDB</code> flushes to disk all dirty buffer pool
        pages whose redo entries are contained in that portion of the
        log file, a process known as a
        <a class="link" href="glossary.html#glos_sharp_checkpoint" title="sharp checkpoint">sharp checkpoint</a>.
        If a workload is write-intensive, it generates a lot of redo
        information, all written to the log file. If all available space
        in the log files is used up, a sharp checkpoint occurs, causing
        a temporary reduction in throughput. This situation can happen
        even if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a> is
        not reached.
      </p><p>
        <code class="literal">InnoDB</code> uses a heuristic-based algorithm to
        avoid such a scenario, by measuring the number of dirty pages in
        the buffer pool and the rate at which redo is being generated.
        Based on these numbers, <code class="literal">InnoDB</code> decides how
        many dirty pages to flush from the buffer pool each second. This
        self-adapting algorithm is able to deal with sudden changes in
        workload.
      </p><p>
        Internal benchmarking has shown that this algorithm not only
        maintains throughput over time, but can also improve overall
        throughput significantly.
      </p><p>
        Because adaptive flushing can significantly affect the I/O
        pattern of a workload, the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>
        configuration parameter lets you turn off this feature. The
        default value for
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a> is
        <code class="literal">ON</code>, enabling the adaptive flushing algorithm.
        You can set the value of this parameter in the MySQL option file
        (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or
        change it dynamically with the
        <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
        GLOBAL</code></a> statement, which requires privileges sufficient
        to set global system variables. See
        <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>.
      </p><p>
        For information about fine-tuning <code class="literal">InnoDB</code>
        buffer pool flushing behavior, see
        <a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="15.8.3.6 Fine-tuning InnoDB Buffer Pool Flushing">Section 15.8.3.6, “Fine-tuning InnoDB Buffer Pool Flushing”</a>.
      </p><p>
        For more information about <code class="literal">InnoDB</code> I/O
        performance, see <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-lru-background-flushing"></a>15.8.3.6 Fine-tuning InnoDB Buffer Pool Flushing</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648204320"></a><a class="indexterm" name="idm140091648203248"></a><p>
        The configuration options
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_neighbors"><code class="literal">innodb_flush_neighbors</code></a> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lru_scan_depth"><code class="literal">innodb_lru_scan_depth</code></a> let you
        fine-tune aspects of the
        <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> process for the
        <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_neighbors"><code class="literal">innodb_flush_neighbors</code></a>
          </p><p>
            Specifies whether flushing a page from the buffer pool also
            flushes other dirty pages in the same extent. When the table
            data is stored on a traditional
            <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> storage device, flushing
            neighbor pages in one operation reduces I/O overhead
            (primarily for disk seek operations) compared to flushing
            individual pages at different times. For table data stored
            on <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a>, seek time is not a
            significant factor and you can disable this setting to
            spread out write operations.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lru_scan_depth"><code class="literal">innodb_lru_scan_depth</code></a>
          </p><p>
            Specifies, per buffer pool instance, how far down the buffer
            pool LRU list the page cleaner thread scans looking for
            dirty pages to flush. This is a background operation
            performed once per second.
</p></li></ul>
</div>
<p>
        These options primarily help write-intensive
        <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>. With heavy
        <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> activity, flushing can fall
        behind if it is not aggressive enough, resulting in excessive
        memory use in the buffer pool; or, disk writes due to flushing
        can saturate your I/O capacity if that mechanism is too
        aggressive. The ideal settings depend on your workload, data
        access patterns, and storage configuration (for example, whether
        data is stored on HDD or SSD devices).
      </p><p>
        For systems with constant heavy
        <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>, or workloads
        that fluctuate widely, several configuration options let you
        fine-tune the <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a>
        behavior for <code class="literal">InnoDB</code> tables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing_lwm"><code class="literal">innodb_adaptive_flushing_lwm</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a>
</p></li></ul>
</div>
<p>
        These options feed into the formula used by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>
        option.
      </p><p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
        options are limited or extended by the following options:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing_lwm"><code class="literal">innodb_adaptive_flushing_lwm</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm</code></a>
</p></li></ul>
</div>
<p>
        The <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_adaptive_flushing" title="adaptive flushing">adaptive flushing</a>
        mechanism is not appropriate in all cases. It gives the most
        benefit when the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a>
        is in danger of filling up. The
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing_lwm"><code class="literal">innodb_adaptive_flushing_lwm</code></a>
        option specifies a <span class="quote">“<span class="quote">low water mark</span>”</span> percentage of
        redo log capacity; when that threshold is crossed,
        <code class="literal">InnoDB</code> turns on adaptive flushing even if not
        specified by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>
        option.
      </p><p>
        If flushing activity falls far behind, <code class="literal">InnoDB</code>
        can flush more aggressively than specified by
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>.
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>
        represents an upper limit on the I/O capacity used in such
        emergency situations, so that the spike in I/O does not consume
        all the capacity of the server.
      </p><p>
        <code class="literal">InnoDB</code> tries to flush data from the buffer
        pool so that the percentage of dirty pages does not exceed the
        value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>. The
        default value for
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a> is
        75.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
          setting establishes a target for flushing activity. It does
          not affect the rate of flushing. For information about
          managing the rate of flushing, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="15.8.3.5 Configuring InnoDB Buffer Pool Flushing">Section 15.8.3.5, “Configuring InnoDB Buffer Pool Flushing”</a>.
</p>
</div>
<p>
        The
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm</code></a>
        option specifies a <span class="quote">“<span class="quote">low water mark</span>”</span> value that
        represents the percentage of dirty pages where pre-flushing is
        enabled to control the dirty page ratio and ideally prevent the
        percentage of dirty pages from reaching
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>. A
        value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm"><code class="literal">innodb_max_dirty_pages_pct_lwm=0</code></a>
        disables the <span class="quote">“<span class="quote">pre-flushing</span>”</span> behavior.
      </p><p>
        Most of the options referenced above are most applicable to
        servers that run write-heavy workloads for long periods of time
        and have little reduced load time to catch up with changes
        waiting to be written to disk.
      </p><p>
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a>
        defines the number of iterations for which
        <code class="literal">InnoDB</code> keeps the previously calculated
        snapshot of the flushing state, which controls how quickly
        adaptive flushing responds to foreground load changes. Setting a
        high value for
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a> means
        that <code class="literal">InnoDB</code> keeps the previously calculated
        snapshot longer, so adaptive flushing responds more slowly. A
        high value also reduces positive feedback between foreground and
        background work, but when setting a high value it is important
        to ensure that <code class="literal">InnoDB</code> redo log utilization
        does not reach 75% (the hardcoded limit at which async flushing
        starts) and that the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
        setting keeps the number of dirty pages to a level that is
        appropriate for the workload.
      </p><p>
        Systems with consistent workloads, a large
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>, and small
        spikes that do not reach 75% redo log space utilization should
        use a high
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a> value
        to keep flushing as smooth as possible. For systems with extreme
        load spikes or log files that do not provide a lot of space,
        consider a smaller
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops"><code class="literal">innodb_flushing_avg_loops</code></a>
        value. A smaller value allows flushing to closely track the load
        and helps avoid reaching 75% redo log space utilization.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-preload-buffer-pool"></a>15.8.3.7 Saving and Restoring the Buffer Pool State</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648124464"></a><a class="indexterm" name="idm140091648123392"></a><p>
        To reduce the <a class="link" href="glossary.html#glos_warm_up" title="warm up">warmup</a> period
        after restarting the server, <code class="literal">InnoDB</code> saves a
        percentage of the most recently used pages for each buffer pool
        at server shutdown and restores these pages at server startup.
        The percentage of recently used pages that is stored is defined
        by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
        configuration option.
      </p><p>
        After restarting a busy server, there is typically a warmup
        period with steadily increasing throughput, as disk pages that
        were in the buffer pool are brought back into memory (as the
        same data is queried, updated, and so on). The ability to
        restore the buffer pool at startup shortens the warmup period by
        reloading disk pages that were in the buffer pool before the
        restart rather than waiting for DML operations to access
        corresponding rows. Also, I/O requests can be performed in large
        batches, making the overall I/O faster. Page loading happens in
        the background, and does not delay database startup.
      </p><p>
        In addition to saving the buffer pool state at shutdown and
        restoring it at startup, you can save and restore the buffer
        pool state at any time, while the server is running. For
        example, you can save the state of the buffer pool after
        reaching a stable throughput under a steady workload. You could
        also restore the previous buffer pool state after running
        reports or maintenance jobs that bring data pages into the
        buffer pool that are only requited for those operations, or
        after running some other non-typical workload.
      </p><p>
        Even though a buffer pool can be many gigabytes in size, the
        buffer pool data that <code class="literal">InnoDB</code> saves to disk is
        tiny by comparison. Only tablespace IDs and page IDs necessary
        to locate the appropriate pages are saved to disk. This
        information is derived from the
        <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="25.39.2 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a>
        <code class="literal">INFORMATION_SCHEMA</code> table. By default,
        tablespace ID and page ID data is saved in a file named
        <code class="filename">ib_buffer_pool</code>, which is saved to the
        <code class="literal">InnoDB</code> data directory. The file name and
        location can be modified using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_filename"><code class="literal">innodb_buffer_pool_filename</code></a>
        configuration parameter.
      </p><p>
        Because data is cached in and aged out of the buffer pool as it
        is with regular database operations, there is no problem if the
        disk pages are recently updated, or if a DML operation involves
        data that has not yet been loaded. The loading mechanism skips
        requested pages that no longer exist.
      </p><p>
        The underlying mechanism involves a background thread that is
        dispatched to perform the dump and load operations.
      </p><p>
        Disk pages from compressed tables are loaded into the buffer
        pool in their compressed form. Pages are uncompressed as usual
        when page contents are accessed during DML operations. Because
        uncompressing pages is a CPU-intensive process, it is more
        efficient for concurrency to perform the operation in a
        connection thread rather than in the single thread that performs
        the buffer pool restore operation.
      </p><p>
        Operations related to saving and restoring the buffer pool state
        are described in the following topics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool-dump-pct" title="Configuring the Dump Percentage for Buffer Pool Pages">Configuring the Dump Percentage for Buffer Pool Pages</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool-offline" title="Saving the Buffer Pool State at Shutdown and Restoring it at Startup">Saving the Buffer Pool State at Shutdown and Restoring it at Startup</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool-online" title="Saving and Restoring the Buffer Pool State Online">Saving and Restoring the Buffer Pool State Online</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool-dump-progress" title="Displaying Buffer Pool Dump Progress">Displaying Buffer Pool Dump Progress</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool-load-progress" title="Displaying Buffer Pool Load Progress">Displaying Buffer Pool Load Progress</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool-abort-load" title="Aborting a Buffer Pool Load Operation">Aborting a Buffer Pool Load Operation</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#monitor-buffer-pool-load-performance-schema" title="Monitoring Buffer Pool Load Progress Using Performance Schema">Monitoring Buffer Pool Load Progress Using Performance Schema</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="innodb-preload-buffer-pool-dump-pct"></a>Configuring the Dump Percentage for Buffer Pool Pages</h5>

</div>

</div>

</div>
<p>
          Before dumping pages from the buffer pool, you can configure
          the percentage of most-recently-used buffer pool pages that
          you want to dump by setting the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
          option. If you plan to dump buffer pool pages while the server
          is running, you can configure the option dynamically:
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_buffer_pool_dump_pct=40;
</pre><p>
          If you plan to dump buffer pool pages at server shutdown, set
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
          in your configuration file.
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_buffer_pool_dump_pct=40
</pre><p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
          default value is 25 (dump 25% of most-recently-used pages).
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-preload-buffer-pool-offline"></a>Saving the Buffer Pool State at Shutdown and Restoring it at Startup</h5>

</div>

</div>

</div>
<p>
          To save the state of the buffer pool at server shutdown, issue
          the following statement prior to shutting down the server:
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_buffer_pool_dump_at_shutdown=ON;
</pre><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
          is enabled by default.
        </p><p>
          To restore the buffer pool state at server startup, specify
          the <code class="literal">--innodb-buffer-pool-load-at-startup</code>
          option when starting the server:
        </p><pre data-lang="terminal" class="programlisting">
mysqld --innodb-buffer-pool-load-at-startup=ON;
</pre><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>
          is enabled by default.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-preload-buffer-pool-online"></a>Saving and Restoring the Buffer Pool State Online</h5>

</div>

</div>

</div>
<p>
          To save the state of the buffer pool while MySQL server is
          running, issue the following statement:
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_buffer_pool_dump_now=ON;
</pre><p>
          To restore the buffer pool state while MySQL is running, issue
          the following statement:
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_buffer_pool_load_now=ON;
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-preload-buffer-pool-dump-progress"></a>Displaying Buffer Pool Dump Progress</h5>

</div>

</div>

</div>
<p>
          To display progress when saving the buffer pool state to disk,
          issue the following statement:
        </p><pre data-lang="sql" class="programlisting">
SHOW STATUS LIKE 'Innodb_buffer_pool_dump_status';
</pre><p>
          If the operation has not yet started, <span class="quote">“<span class="quote">not
          started</span>”</span> is returned. If the operation is complete, the
          completion time is printed (e.g. Finished at 110505 12:18:02).
          If the operation is in progress, status information is
          provided (e.g. Dumping buffer pool 5/7, page 237/2873).
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-preload-buffer-pool-load-progress"></a>Displaying Buffer Pool Load Progress</h5>

</div>

</div>

</div>
<p>
          To display progress when loading the buffer pool, issue the
          following statement:
        </p><pre data-lang="sql" class="programlisting">
SHOW STATUS LIKE 'Innodb_buffer_pool_load_status';
</pre><p>
          If the operation has not yet started, <span class="quote">“<span class="quote">not
          started</span>”</span> is returned. If the operation is complete, the
          completion time is printed (e.g. Finished at 110505 12:23:24).
          If the operation is in progress, status information is
          provided (e.g. Loaded 123/22301 pages).
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-preload-buffer-pool-abort-load"></a>Aborting a Buffer Pool Load Operation</h5>

</div>

</div>

</div>
<p>
          To abort a buffer pool load operation, issue the following
          statement:
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_buffer_pool_load_abort=ON;
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="monitor-buffer-pool-load-performance-schema"></a>Monitoring Buffer Pool Load Progress Using Performance Schema</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648066240"></a><a class="indexterm" name="idm140091648064752"></a><p>
          You can monitor buffer pool load progress using
          <a class="link" href="performance-schema.html" title="Chapter 26 MySQL Performance Schema">Performance Schema</a>.
        </p><p>
          The following example demonstrates how to enable the
          <code class="literal">stage/innodb/buffer pool load</code> stage event
          instrument and related consumer tables to monitor buffer pool
          load progress.
        </p><p>
          For information about buffer pool dump and load procedures
          used in this example, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="15.8.3.7 Saving and Restoring the Buffer Pool State">Section 15.8.3.7, “Saving and Restoring the Buffer Pool State”</a>. For information
          about Performance Schema stage event instruments and related
          consumers, see
          <a class="xref" href="performance-schema.html#performance-schema-stage-tables" title="26.12.5 Performance Schema Stage Event Tables">Section 26.12.5, “Performance Schema Stage Event Tables”</a>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Enable the <code class="literal">stage/innodb/buffer pool
              load</code> instrument:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>UPDATE performance_schema.setup_instruments SET ENABLED = 'YES' </code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE 'stage/innodb/buffer%';</code></strong>
</pre></li><li class="listitem"><p>
              Enable the stage event consumer tables, which include
              <a class="link" href="performance-schema.html#events-stages-current-table" title="26.12.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a>,
              <a class="link" href="performance-schema.html#events-stages-history-table" title="26.12.5.2 The events_stages_history Table"><code class="literal">events_stages_history</code></a>, and
              <a class="link" href="performance-schema.html#events-stages-history-long-table" title="26.12.5.3 The events_stages_history_long Table"><code class="literal">events_stages_history_long</code></a>.
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>UPDATE performance_schema.setup_consumers SET ENABLED = 'YES' </code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%stages%';</code></strong>
</pre></li><li class="listitem"><p>
              Dump the current buffer pool state by enabling
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_now"><code class="literal">innodb_buffer_pool_dump_now</code></a>.
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_buffer_pool_dump_now=ON;</code></strong>
</pre></li><li class="listitem"><p>
              Check the buffer pool dump status to ensure that the
              operation has completed.
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Innodb_buffer_pool_dump_status'\G</code></strong>
*************************** 1. row ***************************
Variable_name: Innodb_buffer_pool_dump_status
        Value: Buffer pool(s) dump completed at 150202 16:38:58
</pre></li><li class="listitem"><p>
              Load the buffer pool by enabling
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_now"><code class="literal">innodb_buffer_pool_load_now</code></a>:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_buffer_pool_load_now=ON;</code></strong>
</pre></li><li class="listitem"><p>
              Check the current status of the buffer pool load operation
              by querying the Performance Schema
              <a class="link" href="performance-schema.html#events-stages-current-table" title="26.12.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a> table.
              The <code class="literal">WORK_COMPLETED</code> column shows the
              number of buffer pool pages loaded. The
              <code class="literal">WORK_ESTIMATED</code> column provides an
              estimate of the remaining work, in pages.
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT EVENT_NAME, WORK_COMPLETED, WORK_ESTIMATED</code></strong>
       <strong class="userinput"><code>FROM performance_schema.events_stages_current;</code></strong>
+-------------------------------+----------------+----------------+
| EVENT_NAME                    | WORK_COMPLETED | WORK_ESTIMATED |
+-------------------------------+----------------+----------------+
| stage/innodb/buffer pool load |           5353 |           7167 |
+-------------------------------+----------------+----------------+
</pre><p>
              The <a class="link" href="performance-schema.html#events-stages-current-table" title="26.12.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a>
              table returns an empty set if the buffer pool load
              operation has completed. In this case, you can check the
              <a class="link" href="performance-schema.html#events-stages-history-table" title="26.12.5.2 The events_stages_history Table"><code class="literal">events_stages_history</code></a> table
              to view data for the completed event. For example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT EVENT_NAME, WORK_COMPLETED, WORK_ESTIMATED </code></strong>
       <strong class="userinput"><code>FROM performance_schema.events_stages_history;</code></strong>
+-------------------------------+----------------+----------------+
| EVENT_NAME                    | WORK_COMPLETED | WORK_ESTIMATED |
+-------------------------------+----------------+----------------+
| stage/innodb/buffer pool load |           7167 |           7167 |
+-------------------------------+----------------+----------------+
</pre></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            You can also monitor buffer pool load progress using
            Performance Schema when loading the buffer pool at startup
            using
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>.
            In this case, the <code class="literal">stage/innodb/buffer pool
            load</code> instrument and related consumers must be
            enabled at startup. For more information, see
            <a class="xref" href="performance-schema.html#performance-schema-startup-configuration" title="26.3 Performance Schema Startup Configuration">Section 26.3, “Performance Schema Startup Configuration”</a>.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-buffer-pool-in-core-file"></a>15.8.3.8 Excluding Buffer Pool Pages from Core Files</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091648019008"></a><a class="indexterm" name="idm140091648017520"></a><a class="indexterm" name="idm140091648016448"></a><a class="indexterm" name="idm140091648015408"></a><p>
        A core file records the status and memory image of a running
        process. Because the buffer pool resides in main memory, and the
        memory image of a running process is dumped to the core file,
        systems with large buffer pools can produce large core files
        when the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process dies.
      </p><p>
        Large core files can be problematic for a number of reasons
        including the time it takes to write them, the amount of disk
        space they consume, and the challenges associated with
        transferring large files.
      </p><p>
        To reduce core file size, you can disable the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file"><code class="literal">innodb_buffer_pool_in_core_file</code></a>
        variable to omit buffer pool pages from core dumps. The
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file"><code class="literal">innodb_buffer_pool_in_core_file</code></a>
        variable was introduced in MySQL 8.0.14 and is enabled by
        default.
      </p><p>
        Excluding buffer pool pages may also be desirable from a
        security perspective if you have concerns about dumping database
        pages to core files that may be shared inside or outside of your
        organization for debugging purposes.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Access to the data present in buffer pool pages at the time
          the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process died may be beneficial
          in some debugging scenarios. If in doubt whether to include or
          exclude buffer pool pages, consult MySQL Support.
</p>
</div>
<p>
        Disabling
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file"><code class="literal">innodb_buffer_pool_in_core_file</code></a>
        takes effect only if the
        <a class="link" href="server-administration.html#sysvar_core_file"><code class="literal">core_file</code></a> variable is enabled
        and the operating system supports the
        <code class="literal">MADV_DONTDUMP</code> non-POSIX extension to the
        <a class="ulink" href="http://man7.org/linux/man-pages/man2/madvise.2.html" target="_top">madvise()</a>
        system call, which is supported in Linux 3.4 and later. The
        <code class="literal">MADV_DONTDUMP</code> extension causes pages in a
        specified range to be excluded from core dumps.
      </p><p>
        Assuming the operating system supports the
        <code class="literal">MADV_DONTDUMP</code> extension, start the server
        with the <a class="link" href="server-administration.html#option_mysqld_core-file"><code class="option">--core-file</code></a> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file"><code class="literal">--innodb-buffer-pool-in-core-file=OFF</code></a>
        options to generate core files without buffer pool pages.
      </p><pre data-lang="terminal" class="programlisting">shell&gt; mysqld --core-file --innodb-buffer-pool-in-core-file=OFF</pre><p>
        The <a class="link" href="server-administration.html#sysvar_core_file"><code class="literal">core_file</code></a> variable is read
        only and disabled by default. It is enabled by specifying the
        <a class="link" href="server-administration.html#option_mysqld_core-file"><code class="option">--core-file</code></a> option at startup.
        The
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file"><code class="literal">innodb_buffer_pool_in_core_file</code></a>
        variable is dynamic. It can be specified at startup or
        configured at runtime using a
        <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET</code></a>
        statement.
      </p><pre data-lang="sql" class="programlisting">mysql&gt; SET GLOBAL innodb_buffer_pool_in_core_file=OFF;</pre><p>
        If the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file"><code class="literal">innodb_buffer_pool_in_core_file</code></a>
        variable is disabled but <code class="literal">MADV_DONTDUMP</code> is not
        supported by the operating system, or an
        <code class="literal">madvise()</code> failure occurs, a warning is
        written to the MySQL server error log and the
        <a class="link" href="server-administration.html#sysvar_core_file"><code class="literal">core_file</code></a> variable is disabled
        to prevent writing core files that unintentionally include
        buffer pool pages. If the read-only
        <a class="link" href="server-administration.html#sysvar_core_file"><code class="literal">core_file</code></a> variable becomes
        disabled, the server must be restarted to enable it again.
      </p><p>
        The following table shows configuration and
        <code class="literal">MADV_DONTDUMP</code> support scenarios that
        determine whether core files are generated and whether they
        include buffer pool pages.
</p>
<div class="table">
<a name="innodb-buffer-pool-in-core-file-configuration-scenarios"></a><p class="title"><b>Table 15.5 Core File Configuration Scenarios</b></p>
<div class="table-contents">
<table summary="Core file configuration and         MADV_DONTDUMP support scenarios."><col width="20%"><col width="20%"><col width="20%"><col width="40%"><thead><tr>
            <th scope="col"><a class="link" href="server-administration.html#sysvar_core_file"><code class="literal">core_file</code></a> variable</th>
            <th scope="col"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file"><code class="literal">innodb_buffer_pool_in_core_file</code></a>
              variable</th>
            <th scope="col">madvise() MADV_DONTDUMP Support</th>
            <th scope="col">Outcome</th>
          </tr></thead><tbody><tr>
            <td scope="row">OFF (default)</td>
            <td>Not relevant to outcome</td>
            <td>Not relevant to outcome</td>
            <td>Core file is not generated</td>
          </tr><tr>
            <td scope="row">ON</td>
            <td>ON (default)</td>
            <td>Not relevant to outcome</td>
            <td>Core file is generated with buffer pool pages</td>
          </tr><tr>
            <td scope="row">ON</td>
            <td>OFF</td>
            <td>Yes</td>
            <td>Core file is generated without buffer pool pages</td>
          </tr><tr>
            <td scope="row">ON</td>
            <td>OFF</td>
            <td>No</td>
            <td>Core file is not generated, <a class="link" href="server-administration.html#sysvar_core_file"><code class="literal">core_file</code></a>
              is disabled, and a warning is written to the server error
              log</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The reduction in core file size achieved by disabling the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file"><code class="literal">innodb_buffer_pool_in_core_file</code></a>
        variable depends on the size of the buffer pool, but it is also
        affected by the <code class="literal">InnoDB</code> page size. A smaller
        page size means more pages are required for the same amount of
        data, and more pages means more page metadata. The following
        table provides size reduction examples that you might see for a
        1GB buffer pool with different pages sizes.
</p>
<div class="table">
<a name="innodb-buffer-pool-in-core-file-size-examples"></a><p class="title"><b>Table 15.6 Core File Size with Buffer Pool Pages Included and Excluded</b></p>
<div class="table-contents">
<table summary="Core file size reduction examples for different pages sizes."><col width="20%"><col width="20%"><col width="20%"><thead><tr>
            <th scope="col"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> Setting</th>
            <th scope="col">Buffer Pool Pages Included
              (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file"><code class="literal">innodb_buffer_pool_in_core_file=ON</code></a>)</th>
            <th scope="col">Buffer Pool Pages Excluded
              (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file"><code class="literal">innodb_buffer_pool_in_core_file=OFF</code></a>)</th>
          </tr></thead><tbody><tr>
            <td scope="row">4KB</td>
            <td>2.1GB</td>
            <td>0.9GB</td>
          </tr><tr>
            <td scope="row">64KB</td>
            <td>1.7GB</td>
            <td>0.7GB</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-thread_concurrency"></a>15.8.4 Configuring Thread Concurrency for InnoDB</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091647928560"></a><a class="indexterm" name="idm140091647927520"></a><a class="indexterm" name="idm140091647926432"></a><a class="indexterm" name="idm140091647925344"></a><p>
      <code class="literal">InnoDB</code> uses operating system
      <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> to process requests
      from user transactions. (Transactions may issue many requests to
      <code class="literal">InnoDB</code> before they commit or roll back.) On
      modern operating systems and servers with multi-core processors,
      where context switching is efficient, most workloads run well
      without any limit on the number of concurrent threads.
    </p><p>
      In situations where it is helpful to minimize context switching
      between threads, <code class="literal">InnoDB</code> can use a number of
      techniques to limit the number of concurrently executing operating
      system threads (and thus the number of requests that are processed
      at any one time). When <code class="literal">InnoDB</code> receives a new
      request from a user session, if the number of threads concurrently
      executing is at a pre-defined limit, the new request sleeps for a
      short time before it tries again. A request that cannot be
      rescheduled after the sleep is put in a first-in/first-out queue
      and eventually is processed. Threads waiting for locks are not
      counted in the number of concurrently executing threads.
    </p><p>
      You can limit the number of concurrent threads by setting the
      configuration parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>. Once
      the number of executing threads reaches this limit, additional
      threads sleep for a number of microseconds, set by the
      configuration parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a>, before
      being placed into the queue.
    </p><p>
      You can set the configuration option
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_max_sleep_delay"><code class="literal">innodb_adaptive_max_sleep_delay</code></a>
      to the highest value you would allow for
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a>, and
      <code class="literal">InnoDB</code> automatically adjusts
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a> up or
      down depending on the current thread-scheduling activity. This
      dynamic adjustment helps the thread scheduling mechanism to work
      smoothly during times when the system is lightly loaded and when
      it is operating near full capacity.
    </p><p>
      The default value for
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> and the
      implied default limit on the number of concurrent threads has been
      changed in various releases of MySQL and
      <code class="literal">InnoDB</code>. The default value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
      <code class="literal">0</code>, so that by default there is no limit on the
      number of concurrently executing threads.
    </p><p>
      <code class="literal">InnoDB</code> causes threads to sleep only when the
      number of concurrent threads is limited. When there is no limit on
      the number of threads, all contend equally to be scheduled. That
      is, if <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
      is <code class="literal">0</code>, the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a> is
      ignored.
    </p><p>
      When there is a limit on the number of threads (when
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is &gt;
      0), <code class="literal">InnoDB</code> reduces context switching overhead
      by permitting multiple requests made during the execution of a
      <span class="emphasis"><em>single SQL statement</em></span> to enter
      <code class="literal">InnoDB</code> without observing the limit set by
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>. Since
      an SQL statement (such as a join) may comprise multiple row
      operations within <code class="literal">InnoDB</code>,
      <code class="literal">InnoDB</code> assigns a specified number of
      <span class="quote">“<span class="quote">tickets</span>”</span> that allow a thread to be scheduled
      repeatedly with minimal overhead.
    </p><p>
      When a new SQL statement starts, a thread has no tickets, and it
      must observe
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>. Once
      the thread is entitled to enter <code class="literal">InnoDB</code>, it is
      assigned a number of tickets that it can use for subsequently
      entering <code class="literal">InnoDB</code> to perform row operations. If
      the tickets run out, the thread is evicted, and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
      observed again which may place the thread back into the
      first-in/first-out queue of waiting threads. When the thread is
      once again entitled to enter <code class="literal">InnoDB</code>, tickets
      are assigned again. The number of tickets assigned is specified by
      the global option
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>, which
      is 5000 by default. A thread that is waiting for a lock is given
      one ticket once the lock becomes available.
    </p><p>
      The correct values of these variables depend on your environment
      and workload. Try a range of different values to determine what
      value works for your applications. Before limiting the number of
      concurrently executing threads, review configuration options that
      may improve the performance of <code class="literal">InnoDB</code> on
      multi-core and multi-processor computers, such as
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>.
    </p><p>
      For general performance information about MySQL thread handling,
      see <a class="xref" href="optimization.html#client-connections" title="8.12.4.1 How MySQL Handles Client Connections">Section 8.12.4.1, “How MySQL Handles Client Connections”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-multiple_io_threads"></a>15.8.5 Configuring the Number of Background InnoDB I/O Threads</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091647881040"></a><a class="indexterm" name="idm140091647879968"></a><a class="indexterm" name="idm140091647878896"></a><a class="indexterm" name="idm140091647877408"></a><p>
      <code class="literal">InnoDB</code> uses background
      <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> to service various
      types of I/O requests. You can configure the number of background
      threads that service read and write I/O on data pages using the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>
      configuration parameters. These parameters signify the number of
      background threads used for read and write requests, respectively.
      They are effective on all supported platforms. You can set values
      for these parameters in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>); you
      cannot change values dynamically. The default value for these
      parameters is <code class="literal">4</code> and permissible values range
      from <code class="literal">1-64</code>.
    </p><p>
      The purpose of these configuration options to make
      <code class="literal">InnoDB</code> more scalable on high end systems. Each
      background thread can handle up to 256 pending I/O requests. A
      major source of background I/O is
      <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> requests.
      <code class="literal">InnoDB</code> tries to balance the load of incoming
      requests in such way that most background threads share work
      equally. <code class="literal">InnoDB</code> also attempts to allocate read
      requests from the same extent to the same thread, to increase the
      chances of coalescing the requests. If you have a high end I/O
      subsystem and you see more than 64 ×
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> pending
      read requests in <code class="literal">SHOW ENGINE INNODB STATUS</code>
      output, you might improve performance by increasing the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>.
    </p><p>
      On Linux systems, <code class="literal">InnoDB</code> uses the asynchronous
      I/O subsystem by default to perform read-ahead and write requests
      for data file pages, which changes the way that
      <code class="literal">InnoDB</code> background threads service these types
      of I/O requests. For more information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-linux-native-aio" title="15.8.6 Using Asynchronous I/O on Linux">Section 15.8.6, “Using Asynchronous I/O on Linux”</a>.
    </p><p>
      For more information about <code class="literal">InnoDB</code> I/O
      performance, see <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-linux-native-aio"></a>15.8.6 Using Asynchronous I/O on Linux</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091647854720"></a><a class="indexterm" name="idm140091647853264"></a><a class="indexterm" name="idm140091647851776"></a><a class="indexterm" name="idm140091647850704"></a><p>
      <code class="literal">InnoDB</code> uses the asynchronous I/O subsystem
      (native AIO) on Linux to perform read-ahead and write requests for
      data file pages. This behavior is controlled by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio</code></a>
      configuration option, which applies to Linux systems only and is
      enabled by default. On other Unix-like systems,
      <code class="literal">InnoDB</code> uses synchronous I/O only. Historically,
      <code class="literal">InnoDB</code> only used asynchronous I/O on Windows
      systems. Using the asynchronous I/O subsystem on Linux requires
      the <code class="literal">libaio</code> library.
    </p><p>
      With synchronous I/O, query threads queue I/O requests, and
      <code class="literal">InnoDB</code> background threads retrieve the queued
      requests one at a time, issuing a synchronous I/O call for each.
      When an I/O request is completed and the I/O call returns, the
      <code class="literal">InnoDB</code> background thread that is handling the
      request calls an I/O completion routine and returns to process the
      next request. The number of requests that can be processed in
      parallel is <em class="replaceable"><code>n</code></em>, where
      <em class="replaceable"><code>n</code></em> is the number of
      <code class="literal">InnoDB</code> background threads. The number of
      <code class="literal">InnoDB</code> background threads is controlled by
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>. See
      <a class="xref" href="innodb-storage-engine.html#innodb-performance-multiple_io_threads" title="15.8.5 Configuring the Number of Background InnoDB I/O Threads">Section 15.8.5, “Configuring the Number of Background InnoDB I/O Threads”</a>.
    </p><p>
      With native AIO, query threads dispatch I/O requests directly to
      the operating system, thereby removing the limit imposed by the
      number of background threads. <code class="literal">InnoDB</code> background
      threads wait for I/O events to signal completed requests. When a
      request is completed, a background thread calls an I/O completion
      routine and resumes waiting for I/O events.
    </p><p>
      The advantage of native AIO is scalability for heavily I/O-bound
      systems that typically show many pending reads/writes in
      <code class="literal">SHOW ENGINE INNODB STATUS\G</code> output. The
      increase in parallel processing when using native AIO means that
      the type of I/O scheduler or properties of the disk array
      controller have a greater influence on I/O performance.
    </p><p>
      A potential disadvantage of native AIO for heavily I/O-bound
      systems is lack of control over the number of I/O write requests
      dispatched to the operating system at once. Too many I/O write
      requests dispatched to the operating system for parallel
      processing could, in some cases, result in I/O read starvation,
      depending on the amount of I/O activity and system capabilities.
    </p><p>
      If a problem with the asynchronous I/O subsystem in the OS
      prevents <code class="literal">InnoDB</code> from starting, you can start
      the server with
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio=0</code></a>. This
      option may also be disabled automatically during startup if
      <code class="literal">InnoDB</code> detects a potential problem such as a
      combination of <code class="literal">tmpdir</code> location,
      <code class="literal">tmpfs</code> file system, and Linux kernel that does
      not support asynchronous I/O on <code class="literal">tmpfs</code>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-thread_io_rate"></a>15.8.7 Configuring the InnoDB Master Thread I/O Rate</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091647826144"></a><a class="indexterm" name="idm140091647825072"></a><p>
      The <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a> in
      InnoDB is a thread that performs various tasks in the background.
      Most of these tasks are I/O related, such as flushing dirty pages
      from the buffer pool or writing changes from the insert buffer to
      the appropriate secondary indexes. The master thread attempts to
      perform these tasks in a way that does not adversely affect the
      normal working of the server. It tries to estimate the free I/O
      bandwidth available and tune its activities to take advantage of
      this free capacity. Historically, InnoDB has used a hard coded
      value of 100 IOPs (input/output operations per second) as the
      total I/O capacity of the server.
    </p><p>
      The parameter <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
      indicates the overall I/O capacity available to InnoDB. This
      parameter should be set to approximately the number of I/O
      operations that the system can perform per second. The value
      depends on your system configuration. When
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> is set, the
      master threads estimates the I/O bandwidth available for
      background tasks based on the set value. Setting the value to
      <code class="literal">100</code> reverts to the old behavior.
    </p><p>
      You can set the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> to any number
      100 or greater. The default value is <code class="literal">200</code>,
      reflecting that the performance of typical modern I/O devices is
      higher than in the early days of MySQL. Typically, values around
      the previous default of 100 are appropriate for consumer-level
      storage devices, such as hard drives up to 7200 RPMs. Faster hard
      drives, RAID configurations, and SSDs benefit from higher values.
    </p><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting is
      a total limit for all buffer pool instances. When dirty pages are
      flushed, the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
      limit is divided equally among buffer pool instances. For more
      information, see the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> system
      variable description.
    </p><p>
      You can set the value of this parameter in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      it dynamically with the
      <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET GLOBAL</code></a>
      statement, which requires privileges sufficient to set global
      system variables. See
      <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>.
    </p><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync"><code class="literal">innodb_flush_sync</code></a>
      configuration option causes the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting to be
      ignored during bursts of I/O activity that occur at checkpoints.
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync"><code class="literal">innodb_flush_sync</code></a> is enabled by
      default.
    </p><p>
      In earlier MySQL releases, the <code class="literal">InnoDB</code> master
      thread also performed any needed
      <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operations. Those I/O
      operations are now performed by other background threads, whose
      number is controlled by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads"><code class="literal">innodb_purge_threads</code></a>
      configuration option.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-spin_lock_polling"></a>15.8.8 Configuring Spin Lock Polling</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091647795680"></a><a class="indexterm" name="idm140091647794608"></a><a class="indexterm" name="idm140091647793536"></a><p>
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_mutex" title="mutex">mutexes</a> and
      <a class="link" href="glossary.html#glos_rw_lock" title="rw-lock">rw-locks</a> are typically
      reserved for short intervals. On a multi-core system, it can be
      more efficient for a thread to continuously check if it can
      acquire a mutex or rw-lock for a period of time before it sleeps.
      If the mutex or rw-lock becomes available during this period, the
      thread can continue immediately, in the same time slice. However,
      too-frequent polling of a shared object such as a mutex or rw-lock
      by multiple threads can cause <span class="quote">“<span class="quote">cache ping pong</span>”</span>,
      which results in processors invalidating portions of each
      other's cache. <code class="literal">InnoDB</code> minimizes this issue
      by forcing a random delay between polls to desychronize polling
      activity. The random delay is implemented as a spin-wait loop.
    </p><p>
      The duration of a spin-wait loop is determined by the number of
      PAUSE instructions that occur in the loop. That number is
      generated by randomly selecting an integer ranging from 0 up to
      but not including the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a> value, and
      multiplying that value by 50. (The multiplier value, 50, is
      hardcoded before MySQL 8.0.16, and configurable thereafter.) For
      example, an integer is randomly selected from the following range
      for an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a>
      setting of 6:
    </p><pre data-lang="none" class="programlisting">{0,1,2,3,4,5}</pre><p>
      The selected integer is multiplied by 50, resulting in one of six
      possible PAUSE instruction values:
    </p><pre data-lang="none" class="programlisting">{0,50,100,150,200,250}</pre><p>
      For that set of values, 250 is the maximum number of PAUSE
      instructions that can occur in a spin-wait loop. An
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a> setting of
      5 results in a set of five possible values
      <code class="literal">{0,50,100,150,200}</code>, where 200 is the maximum
      number of PAUSE instructions, and so on. In this way, the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a> setting
      controls the maximum delay between spin lock polls.
    </p><p>
      On a system where all processor cores share a fast cache memory,
      you might reduce the maximum delay or disable the busy loop
      altogether by setting
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay=0</code></a>. On a
      system with multiple processor chips, the effect of cache
      invalidation can be more significant and you might increase the
      maximum delay.
    </p><p>
      In the 100MHz Pentium era, an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a> unit was
      calibrated to be equivalent to one microsecond. That time
      equivalence did not hold, but PAUSE instruction duration remained
      fairly constant in terms of processor cycles relative to other CPU
      instructions until the introduction of the Skylake generation of
      processors, which have a comparatively longer PAUSE instruction.
      The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_pause_multiplier"><code class="literal">innodb_spin_wait_pause_multiplier</code></a>
      variable was introduced in MySQL 8.0.16 to provide a way to
      account for differences in PAUSE instruction duration.
    </p><p>
      The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_pause_multiplier"><code class="literal">innodb_spin_wait_pause_multiplier</code></a>
      variable controls the size of PAUSE instruction values. For
      example, assuming an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a> setting of
      6, decreasing the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_pause_multiplier"><code class="literal">innodb_spin_wait_pause_multiplier</code></a>
      value from 50 (the default and previously hardcoded value) to 5
      generates a set of smaller PAUSE instruction values:
    </p><pre data-lang="none" class="programlisting">{0,5,10,15,20,25}</pre><p>
      The ability to increase or decrease PAUSE instruction values
      permits fine tuning <code class="literal">InnoDB</code> for different
      processor architectures. Smaller PAUSE instruction values would be
      appropriate for processor architectures with a comparatively
      longer PAUSE instruction, for example.
    </p><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_pause_multiplier"><code class="literal">innodb_spin_wait_pause_multiplier</code></a>
      variables are dynamic. They can be specified in a MySQL option
      file or modified at runtime using a
      <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET GLOBAL</code></a>
      statement. Modifying the variables at runtime requires privileges
      sufficient to set global system variables. See
      <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-improved-purge-scheduling"></a>15.8.9 Configuring InnoDB Purge Scheduling</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091647759264"></a><p>
      The <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operations (a type of
      garbage collection) that InnoDB performs automatically may be
      performed by one or more separate threads rather than as part of
      the <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a>. The
      use of separate threads improves scalability by allowing the main
      database operations to run independently from maintenance work
      happening in the background.
    </p><p>
      To control this feature, increase the value of the configuration
      option <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads"><code class="literal">innodb_purge_threads</code></a>. If
      DML action is concentrated on a single table or a few tables, keep
      the setting low so that the threads do not contend with each other
      for access to the busy tables. If DML operations are spread across
      many tables, increase the setting. Its maximum is 32.
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads"><code class="literal">innodb_purge_threads</code></a> is a
      non-dynamic configuration option, which means it cannot be
      configured at runtime.
    </p><p>
      There is another related configuration option,
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_batch_size"><code class="literal">innodb_purge_batch_size</code></a> with a
      default value of 300 and maximum value of 5000. This option is
      mainly intended for experimentation and tuning of purge
      operations, and should not be interesting to typical users.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-optimizer-statistics"></a>15.8.10 Configuring Optimizer Statistics for InnoDB</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-persistent-stats">15.8.10.1 Configuring Persistent Optimizer Statistics Parameters</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-statistics-estimation">15.8.10.2 Configuring Non-Persistent Optimizer Statistics Parameters</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-analyze-table-complexity">15.8.10.3 Estimating ANALYZE TABLE Complexity for InnoDB Tables</a></span></dt></dl>
</div>
<p>
      This section describes how to configure persistent and
      non-persistent optimizer statistics for <code class="literal">InnoDB</code>
      tables.
    </p><p>
      Persistent optimizer statistics are persisted across server
      restarts, allowing for greater
      <a class="link" href="glossary.html#glos_plan_stability" title="plan stability">plan stability</a> and more
      consistent query performance. Persistent optimizer statistics also
      provide control and flexibility with these additional benefits:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          You can use the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
          configuration option to control whether statistics are updated
          automatically after substantial changes to a table.
        </p></li><li class="listitem"><p>
          You can use the <code class="literal">STATS_PERSISTENT</code>,
          <code class="literal">STATS_AUTO_RECALC</code>, and
          <code class="literal">STATS_SAMPLE_PAGES</code> clauses with
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements to
          configure optimizer statistics for individual tables.
        </p></li><li class="listitem"><p>
          You can query optimizer statistics data in the
          <code class="literal">mysql.innodb_table_stats</code> and
          <code class="literal">mysql.innodb_index_stats</code> tables.
        </p></li><li class="listitem"><p>
          You can view the <code class="literal">last_update</code> column of the
          <code class="literal">mysql.innodb_table_stats</code> and
          <code class="literal">mysql.innodb_index_stats</code> tables to see when
          statistics were last updated.
        </p></li><li class="listitem"><p>
          You can manually modify the
          <code class="literal">mysql.innodb_table_stats</code> and
          <code class="literal">mysql.innodb_index_stats</code> tables to force a
          specific query optimization plan or to test alternative plans
          without modifying the database.
</p></li></ul>
</div>
<p>
      The persistent optimizer statistics feature is enabled by default
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent=ON</code></a>).
    </p><p>
      Non-persistent optimizer statistics are cleared on each server
      restart and after some other operations, and recomputed on the
      next table access. As a result, different estimates could be
      produced when recomputing statistics, leading to different choices
      in execution plans and variations in query performance.
    </p><p>
      This section also provides information about estimating
      <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> complexity, which may
      be useful when attempting to achieve a balance between accurate
      statistics and <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
      execution time.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-persistent-stats"></a>15.8.10.1 Configuring Persistent Optimizer Statistics Parameters</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091647722400"></a><a class="indexterm" name="idm140091647720928"></a><a class="indexterm" name="idm140091647719424"></a><a class="indexterm" name="idm140091647717920"></a><a class="indexterm" name="idm140091647716416"></a><p>
        The persistent optimizer statistics feature improves
        <a class="link" href="glossary.html#glos_plan_stability" title="plan stability">plan stability</a> by
        storing statistics to disk and making them persistent across
        server restarts so that the
        <a class="link" href="glossary.html#glos_optimizer" title="optimizer">optimizer</a> is more likely
        to make consistent choices each time for a given query.
      </p><p>
        Optimizer statistics are persisted to disk when
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent=ON</code></a> or
        when individual tables are created or altered with
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">STATS_PERSISTENT=1</code></a>.
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a> is
        enabled by default.
      </p><p>
        Formerly, optimizer statistics were cleared on each server
        restart and after some other operations, and recomputed on the
        next table access. Consequently, different estimates could be
        produced when recalculating statistics, leading to different
        choices in query execution plans and thus variations in query
        performance.
      </p><p>
        Persistent statistics are stored in the
        <code class="literal">mysql.innodb_table_stats</code> and
        <code class="literal">mysql.innodb_index_stats</code> tables, as described
        in <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats-tables" title="15.8.10.1.5 InnoDB Persistent Statistics Tables">Section 15.8.10.1.5, “InnoDB Persistent Statistics Tables”</a>.
      </p><p>
        To revert to using non-persistent optimizer statistics, you can
        modify tables using an <code class="literal">ALTER TABLE
        <em class="replaceable"><code>tbl_name</code></em> STATS_PERSISTENT=0</code>
        statement. For related information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="15.8.10.2 Configuring Non-Persistent Optimizer Statistics Parameters">Section 15.8.10.2, “Configuring Non-Persistent Optimizer Statistics Parameters”</a>
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-auto-recalc"></a>15.8.10.1.1 Configuring Automatic Statistics Calculation for Persistent Optimizer
Statistics</h5>
</div>
</div>
</div>
<p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
          configuration option, which is enabled by default, determines
          whether statistics are calculated automatically whenever a
          table undergoes substantial changes (to more than 10% of the
          rows). You can also configure automatic statistics
          recalculation for individual tables using a
          <code class="literal">STATS_AUTO_RECALC</code> clause in a
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement.
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a> is
          enabled by default.
        </p><p>
          Because of the asynchronous nature of automatic statistics
          recalculation (which occurs in the background), statistics may
          not be recalculated instantly after running a DML operation
          that affects more than 10% of a table, even when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a> is
          enabled. In some cases, statistics recalculation may be
          delayed by a few seconds. If up-to-date statistics are
          required immediately after changing significant portions of a
          table, run <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> to
          initiate a synchronous (foreground) recalculation of
          statistics.
        </p><p>
          If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
          is disabled, ensure the accuracy of optimizer statistics by
          issuing the <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
          statement for each applicable table after making substantial
          changes to indexed columns. You might run this statement in
          your setup scripts after representative data has been loaded
          into the table, and run it periodically after DML operations
          significantly change the contents of indexed columns, or on a
          schedule at times of low activity. When a new index is added
          to an existing table, or a column is added or dropped, index
          statistics are calculated and added to the
          <code class="literal">innodb_index_stats</code> table regardless of the
          value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>.
</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p>
            To ensure statistics are gathered when a new index is
            created, either enable the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
            option, or run <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
            after creating each new index when the persistent statistics
            mode is enabled.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-table-configuration"></a>15.8.10.1.2 Configuring Optimizer Statistics Parameters for Individual Tables</h5>

</div>

</div>

</div>
<p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>, and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          are global configuration options. To override these
          system-wide settings and configure optimizer statistics
          parameters for individual tables, you can define
          <code class="literal">STATS_PERSISTENT</code>,
          <code class="literal">STATS_AUTO_RECALC</code>, and
          <code class="literal">STATS_SAMPLE_PAGES</code> clauses in
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">STATS_PERSISTENT</code> specifies whether to
              enable
              <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_persistent_statistics" target="_top">persistent
              statistics</a> for an <code class="literal">InnoDB</code> table.
              The value <code class="literal">DEFAULT</code> causes the persistent
              statistics setting for the table to be determined by the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
              configuration option. The value <code class="literal">1</code>
              enables persistent statistics for the table, while the
              value <code class="literal">0</code> turns off this feature. After
              enabling persistent statistics through a <code class="literal">CREATE
              TABLE</code> or <code class="literal">ALTER TABLE</code>
              statement, issue an <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
              TABLE</code></a> statement to calculate the statistics,
              after loading representative data into the table.
            </p></li><li class="listitem"><p>
              <code class="literal">STATS_AUTO_RECALC</code> specifies whether to
              automatically recalculate
              <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_persistent_statistics" target="_top">persistent
              statistics</a> for an <code class="literal">InnoDB</code> table.
              The value <code class="literal">DEFAULT</code> causes the persistent
              statistics setting for the table to be determined by the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a>
              configuration option. The value <code class="literal">1</code>
              causes statistics to be recalculated when 10% of the data
              in the table has changed. The value <code class="literal">0</code>
              prevents automatic recalculation for this table; with this
              setting, issue an <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
              TABLE</code></a> statement to recalculate the statistics
              after making substantial changes to the table.
            </p></li><li class="listitem"><p>
              <code class="literal">STATS_SAMPLE_PAGES</code> specifies the number
              of index pages to sample when estimating cardinality and
              other statistics for an indexed column, such as those
              calculated by <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
              TABLE</code></a>.
</p></li></ul>
</div>
<p>
          All three clauses are specified in the following
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> example:
        </p><pre data-lang="sql" class="programlisting">
CREATE TABLE `t1` (
`id` int(8) NOT NULL auto_increment,
`data` varchar(255),
`date` datetime,
PRIMARY KEY  (`id`),
INDEX `DATE_IX` (`date`)
) ENGINE=InnoDB,
  STATS_PERSISTENT=1,
  STATS_AUTO_RECALC=1,
  STATS_SAMPLE_PAGES=25;
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-pages-sampled"></a>15.8.10.1.3 Configuring the Number of Sampled Pages for InnoDB Optimizer Statistics</h5>

</div>

</div>

</div>
<p>
          The MySQL query optimizer uses estimated
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> about key
          distributions to choose the indexes for an execution plan,
          based on the relative
          <a class="link" href="glossary.html#glos_selectivity" title="selectivity">selectivity</a> of the
          index. Operations such as <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a> cause <code class="literal">InnoDB</code> to sample
          random pages from each index on a table to estimate the
          <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> of the
          index. (This technique is known as
          <a class="link" href="glossary.html#glos_random_dive" title="random dive">random dives</a>.)
        </p><p>
          To give you control over the quality of the statistics
          estimate (and thus better information for the query
          optimizer), you can change the number of sampled pages using
          the parameter
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>,
          which can be set at runtime.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          has a default value of 20. As a general guideline, consider
          modifying this parameter when encountering the following
          issues:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              <span class="emphasis"><em>Statistics are not accurate enough and the
              optimizer chooses suboptimal plans</em></span>, as shown by
              <a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a> output. The
              accuracy of statistics can be checked by comparing the
              actual cardinality of an index (as returned by running
              <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT
              DISTINCT</code></a> on the index columns) with the
              estimates provided in the
              <code class="literal">mysql.innodb_index_stats</code> persistent
              statistics table.
            </p><p>
              If it is determined that statistics are not accurate
              enough, the value of
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
              should be increased until the statistics estimates are
              sufficiently accurate. Increasing
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
              too much, however, could cause
              <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> to run
              slowly.
            </p></li><li class="listitem"><p>
              <span class="emphasis"><em><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> is
              too slow</em></span>. In this case
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
              should be decreased until <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
              TABLE</code></a> execution time is acceptable. Decreasing
              the value too much, however, could lead to the first
              problem of inaccurate statistics and suboptimal query
              execution plans.
            </p><p>
              If a balance cannot be achieved between accurate
              statistics and <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
              TABLE</code></a> execution time, consider decreasing the
              number of indexed columns in the table or limiting the
              number of partitions to reduce
              <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> complexity.
              The number of columns in the table's primary key is also
              important to consider, as primary key columns are appended
              to each nonunique index.
            </p><p>
              For related information, see
              <a class="xref" href="innodb-storage-engine.html#innodb-analyze-table-complexity" title="15.8.10.3 Estimating ANALYZE TABLE Complexity for InnoDB Tables">Section 15.8.10.3, “Estimating ANALYZE TABLE Complexity for InnoDB Tables”</a>.
</p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-delete-marked"></a>15.8.10.1.4 Including Delete-marked Records in Persistent Statistics Calculations</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091647615296"></a><a class="indexterm" name="idm140091647614192"></a><p>
          By default, <code class="literal">InnoDB</code> reads uncommitted data
          when calculating statistics. In the case of an uncommitted
          transaction that deletes rows from a table,
          <code class="literal">InnoDB</code> excludes records that are
          delete-marked when calculating row estimates and index
          statistics, which can lead to non-optimal execution plans for
          other transactions that are operating on the table
          concurrently using a transaction isolation level other than
          <a class="link" href="innodb-storage-engine.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>. To avoid
          this scenario,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_include_delete_marked"><code class="literal">innodb_stats_include_delete_marked</code></a>
          can be enabled to ensure that <code class="literal">InnoDB</code>
          includes delete-marked records when calculating persistent
          optimizer statistics.
        </p><p>
          When
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_include_delete_marked"><code class="literal">innodb_stats_include_delete_marked</code></a>
          is enabled, <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
          considers delete-marked records when recalculating statistics.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_include_delete_marked"><code class="literal">innodb_stats_include_delete_marked</code></a>
          is a global setting that affects all <code class="literal">InnoDB</code>
          tables, and it is only applicable to persistent optimizer
          statistics.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-tables"></a>15.8.10.1.5 InnoDB Persistent Statistics Tables</h5>

</div>

</div>

</div>
<p>
          The persistent statistics feature relies on the internally
          managed tables in the <code class="literal">mysql</code> database, named
          <code class="literal">innodb_table_stats</code> and
          <code class="literal">innodb_index_stats</code>. These tables are set up
          automatically in all install, upgrade, and build-from-source
          procedures.
</p>
<div class="table">
<a name="innodb-table-stats-table"></a><p class="title"><b>Table 15.7 Columns of innodb_table_stats</b></p>
<div class="table-contents">
<table summary="Columns of the mysql.innodb_table_stats table."><col width="30%"><col width="70%"><thead><tr>
              <th scope="col">Column name</th>
              <th scope="col">Description</th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">database_name</code></td>
              <td>Database name</td>
            </tr><tr>
              <td scope="row"><code class="literal">table_name</code></td>
              <td>Table name, partition name, or subpartition name</td>
            </tr><tr>
              <td scope="row"><code class="literal">last_update</code></td>
              <td>A timestamp indicating the last time that <code class="literal">InnoDB</code>
                updated this row</td>
            </tr><tr>
              <td scope="row"><code class="literal">n_rows</code></td>
              <td>The number of rows in the table</td>
            </tr><tr>
              <td scope="row"><code class="literal">clustered_index_size</code></td>
              <td>The size of the primary index, in pages</td>
            </tr><tr>
              <td scope="row"><code class="literal">sum_of_other_index_sizes</code></td>
              <td>The total size of other (non-primary) indexes, in pages</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="table">
<a name="innodb-index-stats-table"></a><p class="title"><b>Table 15.8 Columns of innodb_index_stats</b></p>
<div class="table-contents">
<table summary="Columns of the mysql.innodb_index_stats table."><col width="30%"><col width="70%"><thead><tr>
              <th scope="col">Column name</th>
              <th scope="col">Description</th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">database_name</code></td>
              <td>Database name</td>
            </tr><tr>
              <td scope="row"><code class="literal">table_name</code></td>
              <td>Table name, partition name, or subpartition name</td>
            </tr><tr>
              <td scope="row"><code class="literal">index_name</code></td>
              <td>Index name</td>
            </tr><tr>
              <td scope="row"><code class="literal">last_update</code></td>
              <td>A timestamp indicating the last time that <code class="literal">InnoDB</code>
                updated this row</td>
            </tr><tr>
              <td scope="row"><code class="literal">stat_name</code></td>
              <td>The name of the statistic, whose value is reported in the
                <code class="literal">stat_value</code> column</td>
            </tr><tr>
              <td scope="row"><code class="literal">stat_value</code></td>
              <td>The value of the statistic that is named in <code class="literal">stat_name</code>
                column</td>
            </tr><tr>
              <td scope="row"><code class="literal">sample_size</code></td>
              <td>The number of pages sampled for the estimate provided in the
                <code class="literal">stat_value</code> column</td>
            </tr><tr>
              <td scope="row"><code class="literal">stat_description</code></td>
              <td>Description of the statistic that is named in the
                <code class="literal">stat_name</code> column</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
          Both the <code class="literal">innodb_table_stats</code> and
          <code class="literal">innodb_index_stats</code> tables include a
          <code class="literal">last_update</code> column showing when
          <code class="literal">InnoDB</code> last updated index statistics, as
          shown in the following example:
        </p><pre data-lang="sql" class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM innodb_table_stats \G</code></strong>
*************************** 1. row ***************************
           database_name: sakila
              table_name: actor
             last_update: 2014-05-28 16:16:44
                  n_rows: 200
    clustered_index_size: 1
sum_of_other_index_sizes: 1
...</pre><pre data-lang="sql" class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT * FROM innodb_index_stats \G</code></strong>
*************************** 1. row ***************************
   database_name: sakila
      table_name: actor
      index_name: PRIMARY
     last_update: 2014-05-28 16:16:44
       stat_name: n_diff_pfx01
      stat_value: 200
     sample_size: 1
     ...</pre><p>
          The <code class="literal">innodb_table_stats</code> and
          <code class="literal">innodb_index_stats</code> tables are ordinary
          tables and can be updated manually. The ability to update
          statistics manually makes it possible to force a specific
          query optimization plan or test alternative plans without
          modifying the database. If you manually update statistics,
          issue the <code class="literal">FLUSH TABLE
          <em class="replaceable"><code>tbl_name</code></em></code> command to make
          MySQL reload the updated statistics.
        </p><p>
          Persistent statistics are considered local information,
          because they relate to the server instance. The
          <code class="literal">innodb_table_stats</code> and
          <code class="literal">innodb_index_stats</code> tables are therefore not
          replicated when automatic statistics recalculation takes
          place. If you run <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
          to initiate a synchronous recalculation of statistics, this
          statement is replicated (unless you suppressed logging for
          it), and recalculation takes place on the replication slaves.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-tables-example"></a>15.8.10.1.6 InnoDB Persistent Statistics Tables Example</h5>

</div>

</div>

</div>
<p>
          The <code class="literal">innodb_table_stats</code> table contains one
          row per table. The data collected is demonstrated in the
          following example.
        </p><p>
          Table <code class="literal">t1</code> contains a primary index (columns
          <code class="literal">a</code>, <code class="literal">b</code>) secondary index
          (columns <code class="literal">c</code>, <code class="literal">d</code>), and
          unique index (columns <code class="literal">e</code>,<code class="literal">
          f</code>):
        </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (
a INT, b INT, c INT, d INT, e INT, f INT,
PRIMARY KEY (a, b), KEY i1 (c, d), UNIQUE KEY i2uniq (e, f)
) ENGINE=INNODB;
</pre><p>
          After inserting five rows of sample data, the table appears as
          follows:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM t1;</code></strong>
+---+---+------+------+------+------+
| a | b | c    | d    | e    | f    |
+---+---+------+------+------+------+
| 1 | 1 |   10 |   11 |  100 |  101 |
| 1 | 2 |   10 |   11 |  200 |  102 |
| 1 | 3 |   10 |   11 |  100 |  103 |
| 1 | 4 |   10 |   12 |  200 |  104 |
| 1 | 5 |   10 |   12 |  100 |  105 |
+---+---+------+------+------+------+
</pre><p>
          To immediately update statistics, run
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> (if
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc"><code class="literal">innodb_stats_auto_recalc</code></a> is
          enabled, statistics are updated automatically within a few
          seconds assuming that the 10% threshold for changed table rows
          is reached):
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ANALYZE TABLE t1;</code></strong>
+---------+---------+----------+----------+
| Table   | Op      | Msg_type | Msg_text |
+---------+---------+----------+----------+
| test.t1 | analyze | status   | OK       |
+---------+---------+----------+----------+
</pre><p>
          Table statistics for table <code class="literal">t1</code> show the last
          time <code class="literal">InnoDB</code> updated the table statistics
          (<code class="literal">2014-03-14 14:36:34</code>), the number of rows
          in the table (<code class="literal">5</code>), the clustered index size
          (<code class="literal">1</code> page), and the combined size of the
          other indexes (<code class="literal">2</code> pages).
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM mysql.innodb_table_stats WHERE table_name like 't1'\G</code></strong>
*************************** 1. row ***************************
           database_name: test
              table_name: t1
             last_update: 2014-03-14 14:36:34
                  n_rows: 5
    clustered_index_size: 1
sum_of_other_index_sizes: 2
</pre><p>
          The <code class="literal">innodb_index_stats</code> table contains
          multiple rows for each index. Each row in the
          <code class="literal">innodb_index_stats</code> table provides data
          related to a particular index statistic which is named in the
          <code class="literal">stat_name</code> column and described in the
          <code class="literal">stat_description</code> column. For example:
        </p><pre data-lang="sql" class="programlisting">mysql&gt; <strong class="userinput"><code>SELECT index_name, stat_name, stat_value, stat_description</code></strong>
       <strong class="userinput"><code>FROM mysql.innodb_index_stats WHERE table_name like 't1';</code></strong>
+------------+--------------+------------+-----------------------------------+
| index_name | stat_name    | stat_value | stat_description                  |
+------------+--------------+------------+-----------------------------------+
| PRIMARY    | n_diff_pfx01 |          1 | a                                 |
| PRIMARY    | n_diff_pfx02 |          5 | a,b                               |
| PRIMARY    | n_leaf_pages |          1 | Number of leaf pages in the index |
| PRIMARY    | size         |          1 | Number of pages in the index      |
| i1         | n_diff_pfx01 |          1 | c                                 |
| i1         | n_diff_pfx02 |          2 | c,d                               |
| i1         | n_diff_pfx03 |          2 | c,d,a                             |
| i1         | n_diff_pfx04 |          5 | c,d,a,b                           |
| i1         | n_leaf_pages |          1 | Number of leaf pages in the index |
| i1         | size         |          1 | Number of pages in the index      |
| i2uniq     | n_diff_pfx01 |          2 | e                                 |
| i2uniq     | n_diff_pfx02 |          5 | e,f                               |
| i2uniq     | n_leaf_pages |          1 | Number of leaf pages in the index |
| i2uniq     | size         |          1 | Number of pages in the index      |
+------------+--------------+------------+-----------------------------------+
</pre><p>
          The <code class="literal">stat_name</code> column shows the following
          types of statistics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">size</code>: Where
              <code class="literal">stat_name</code>=<code class="literal">size</code>, the
              <code class="literal">stat_value</code> column displays the total
              number of pages in the index.
            </p></li><li class="listitem"><p>
              <code class="literal">n_leaf_pages</code>: Where
              <code class="literal">stat_name</code>=<code class="literal">n_leaf_pages</code>,
              the <code class="literal">stat_value</code> column displays the
              number of leaf pages in the index.
            </p></li><li class="listitem"><p>
              <code class="literal">n_diff_pfx<em class="replaceable"><code>NN</code></em></code>:
              Where
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx01</code>,
              the <code class="literal">stat_value</code> column displays the
              number of distinct values in the first column of the
              index. Where
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx02</code>,
              the <code class="literal">stat_value</code> column displays the
              number of distinct values in the first two columns of the
              index, and so on. Additionally, where
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx<em class="replaceable"><code>NN</code></em></code>,
              the <code class="literal">stat_description</code> column shows a
              comma separated list of the index columns that are
              counted.
</p></li></ul>
</div>
<p>
          To further illustrate the
          <code class="literal">n_diff_pfx<em class="replaceable"><code>NN</code></em></code>
          statistic, which provides cardinality data, consider once
          again the <code class="literal">t1</code> table example that was
          introduced previously. As shown below, the
          <code class="literal">t1</code> table is created with a primary index
          (columns <code class="literal">a</code>, <code class="literal">b</code>), a
          secondary index (columns <code class="literal">c</code>,
          <code class="literal">d</code>), and a unique index (columns
          <code class="literal">e</code>, <code class="literal">f</code>):
        </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (
  a INT, b INT, c INT, d INT, e INT, f INT,
  PRIMARY KEY (a, b), KEY i1 (c, d), UNIQUE KEY i2uniq (e, f)
) ENGINE=INNODB;
</pre><p>
          After inserting five rows of sample data, the table appears as
          follows:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM t1;</code></strong>
+---+---+------+------+------+------+
| a | b | c    | d    | e    | f    |
+---+---+------+------+------+------+
| 1 | 1 |   10 |   11 |  100 |  101 |
| 1 | 2 |   10 |   11 |  200 |  102 |
| 1 | 3 |   10 |   11 |  100 |  103 |
| 1 | 4 |   10 |   12 |  200 |  104 |
| 1 | 5 |   10 |   12 |  100 |  105 |
+---+---+------+------+------+------+
</pre><p>
          When you query the <code class="literal">index_name</code>,
          <code class="literal">stat_name</code>, <code class="literal">stat_value</code>,
          and <code class="literal">stat_description</code> where
          <code class="literal">stat_name LIKE 'n_diff%'</code>, the following
          result set is returned:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT index_name, stat_name, stat_value, stat_description</code></strong>
       <strong class="userinput"><code>FROM mysql.innodb_index_stats</code></strong>
       <strong class="userinput"><code>WHERE table_name like 't1' AND stat_name LIKE 'n_diff%';</code></strong>
+------------+--------------+------------+------------------+
| index_name | stat_name    | stat_value | stat_description |
+------------+--------------+------------+------------------+
| PRIMARY    | n_diff_pfx01 |          1 | a                |
| PRIMARY    | n_diff_pfx02 |          5 | a,b              |
| i1         | n_diff_pfx01 |          1 | c                |
| i1         | n_diff_pfx02 |          2 | c,d              |
| i1         | n_diff_pfx03 |          2 | c,d,a            |
| i1         | n_diff_pfx04 |          5 | c,d,a,b          |
| i2uniq     | n_diff_pfx01 |          2 | e                |
| i2uniq     | n_diff_pfx02 |          5 | e,f              |
+------------+--------------+------------+------------------+
</pre><p>
          For the <code class="literal">PRIMARY</code> index, there are two
          <code class="literal">n_diff%</code> rows. The number of rows is equal
          to the number of columns in the index.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            For nonunique indexes, <code class="literal">InnoDB</code> appends the
            columns of the primary key.
</p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Where
              <code class="literal">index_name</code>=<code class="literal">PRIMARY</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx01</code>,
              the <code class="literal">stat_value</code> is <code class="literal">1</code>,
              which indicates that there is a single distinct value in
              the first column of the index (column
              <code class="literal">a</code>). The number of distinct values in
              column <code class="literal">a</code> is confirmed by viewing the
              data in column <code class="literal">a</code> in table
              <code class="literal">t1</code>, in which there is a single distinct
              value (<code class="literal">1</code>). The counted column
              (<code class="literal">a</code>) is shown in the
              <code class="literal">stat_description</code> column of the result
              set.
            </p></li><li class="listitem"><p>
              Where
              <code class="literal">index_name</code>=<code class="literal">PRIMARY</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx02</code>,
              the <code class="literal">stat_value</code> is <code class="literal">5</code>,
              which indicates that there are five distinct values in the
              two columns of the index (<code class="literal">a,b</code>). The
              number of distinct values in columns <code class="literal">a</code>
              and <code class="literal">b</code> is confirmed by viewing the data
              in columns <code class="literal">a</code> and <code class="literal">b</code>
              in table <code class="literal">t1</code>, in which there are five
              distinct values: (<code class="literal">1,1</code>),
              (<code class="literal">1,2</code>), (<code class="literal">1,3</code>),
              (<code class="literal">1,4</code>) and (<code class="literal">1,5</code>). The
              counted columns (<code class="literal">a,b</code>) are shown in the
              <code class="literal">stat_description</code> column of the result
              set.
</p></li></ul>
</div>
<p>
          For the secondary index (<code class="literal">i1</code>), there are
          four <code class="literal">n_diff%</code> rows. Only two columns are
          defined for the secondary index (<code class="literal">c,d</code>) but
          there are four <code class="literal">n_diff%</code> rows for the
          secondary index because <code class="literal">InnoDB</code> suffixes all
          nonunique indexes with the primary key. As a result, there are
          four <code class="literal">n_diff%</code> rows instead of two to account
          for the both the secondary index columns
          (<code class="literal">c,d</code>) and the primary key columns
          (<code class="literal">a,b</code>).
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Where <code class="literal">index_name</code>=<code class="literal">i1</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx01</code>,
              the <code class="literal">stat_value</code> is <code class="literal">1</code>,
              which indicates that there is a single distinct value in
              the first column of the index (column
              <code class="literal">c</code>). The number of distinct values in
              column <code class="literal">c</code> is confirmed by viewing the
              data in column <code class="literal">c</code> in table
              <code class="literal">t1</code>, in which there is a single distinct
              value: (<code class="literal">10</code>). The counted column
              (<code class="literal">c</code>) is shown in the
              <code class="literal">stat_description</code> column of the result
              set.
            </p></li><li class="listitem"><p>
              Where <code class="literal">index_name</code>=<code class="literal">i1</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx02</code>,
              the <code class="literal">stat_value</code> is <code class="literal">2</code>,
              which indicates that there are two distinct values in the
              first two columns of the index (<code class="literal">c,d</code>).
              The number of distinct values in columns
              <code class="literal">c</code> an <code class="literal">d</code> is confirmed
              by viewing the data in columns <code class="literal">c</code> and
              <code class="literal">d</code> in table <code class="literal">t1</code>, in
              which there are two distinct values:
              (<code class="literal">10,11</code>) and (<code class="literal">10,12</code>).
              The counted columns (<code class="literal">c,d</code>) are shown in
              the <code class="literal">stat_description</code> column of the
              result set.
            </p></li><li class="listitem"><p>
              Where <code class="literal">index_name</code>=<code class="literal">i1</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx03</code>,
              the <code class="literal">stat_value</code> is <code class="literal">2</code>,
              which indicates that there are two distinct values in the
              first three columns of the index
              (<code class="literal">c,d,a</code>). The number of distinct values
              in columns <code class="literal">c</code>, <code class="literal">d</code>, and
              <code class="literal">a</code> is confirmed by viewing the data in
              column <code class="literal">c</code>, <code class="literal">d</code>, and
              <code class="literal">a</code> in table <code class="literal">t1</code>, in
              which there are two distinct values:
              (<code class="literal">10,11,1</code>) and
              (<code class="literal">10,12,1</code>). The counted columns
              (<code class="literal">c,d,a</code>) are shown in the
              <code class="literal">stat_description</code> column of the result
              set.
            </p></li><li class="listitem"><p>
              Where <code class="literal">index_name</code>=<code class="literal">i1</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx04</code>,
              the <code class="literal">stat_value</code> is <code class="literal">5</code>,
              which indicates that there are five distinct values in the
              four columns of the index (<code class="literal">c,d,a,b</code>).
              The number of distinct values in columns
              <code class="literal">c</code>, <code class="literal">d</code>,
              <code class="literal">a</code> and <code class="literal">b</code> is confirmed
              by viewing the data in columns <code class="literal">c</code>,
              <code class="literal">d</code>, <code class="literal">a</code>, and
              <code class="literal">b</code> in table <code class="literal">t1</code>, in
              which there are five distinct values:
              (<code class="literal">10,11,1,1</code>),
              (<code class="literal">10,11,1,2</code>),
              (<code class="literal">10,11,1,3</code>),
              (<code class="literal">10,12,1,4</code>) and
              (<code class="literal">10,12,1,5</code>). The counted columns
              (<code class="literal">c,d,a,b</code>) are shown in the
              <code class="literal">stat_description</code> column of the result
              set.
</p></li></ul>
</div>
<p>
          For the unique index (<code class="literal">i2uniq</code>), there are
          two <code class="literal">n_diff%</code> rows.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Where
              <code class="literal">index_name</code>=<code class="literal">i2uniq</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx01</code>,
              the <code class="literal">stat_value</code> is <code class="literal">2</code>,
              which indicates that there are two distinct values in the
              first column of the index (column <code class="literal">e</code>).
              The number of distinct values in column
              <code class="literal">e</code> is confirmed by viewing the data in
              column <code class="literal">e</code> in table
              <code class="literal">t1</code>, in which there are two distinct
              values: (<code class="literal">100</code>) and
              (<code class="literal">200</code>). The counted column
              (<code class="literal">e</code>) is shown in the
              <code class="literal">stat_description</code> column of the result
              set.
            </p></li><li class="listitem"><p>
              Where
              <code class="literal">index_name</code>=<code class="literal">i2uniq</code>
              and
              <code class="literal">stat_name</code>=<code class="literal">n_diff_pfx02</code>,
              the <code class="literal">stat_value</code> is <code class="literal">5</code>,
              which indicates that there are five distinct values in the
              two columns of the index (<code class="literal">e,f</code>). The
              number of distinct values in columns <code class="literal">e</code>
              and <code class="literal">f</code> is confirmed by viewing the data
              in columns <code class="literal">e</code> and <code class="literal">f</code>
              in table <code class="literal">t1</code>, in which there are five
              distinct values: (<code class="literal">100,101</code>),
              (<code class="literal">200,102</code>),
              (<code class="literal">100,103</code>), (<code class="literal">200,104</code>)
              and (<code class="literal">100,105</code>). The counted columns
              (<code class="literal">e,f</code>) are shown in the
              <code class="literal">stat_description</code> column of the result
              set.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-persistent-stats-tables-index-size"></a>15.8.10.1.7 Retrieving Index Size Using the innodb_index_stats Table</h5>

</div>

</div>

</div>
<p>
          The size of indexes for tables, partitions, or subpartitions
          can be retrieved using the
          <code class="literal">innodb_index_stats</code> table. In the following
          example, index sizes are retrieved for table
          <code class="literal">t1</code>. For a definition of table
          <code class="literal">t1</code> and corresponding index statistics, see
          <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats-tables-example" title="15.8.10.1.6 InnoDB Persistent Statistics Tables Example">Section 15.8.10.1.6, “InnoDB Persistent Statistics Tables Example”</a>.
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SUM(stat_value) pages, index_name,</code></strong>
       <strong class="userinput"><code>SUM(stat_value)*@@innodb_page_size size</code></strong>
       <strong class="userinput"><code>FROM mysql.innodb_index_stats WHERE table_name='t1'</code></strong>
       <strong class="userinput"><code>AND stat_name = 'size' GROUP BY index_name;</code></strong>
+-------+------------+-------+
| pages | index_name | size  |
+-------+------------+-------+
|     1 | PRIMARY    | 16384 |
|     1 | i1         | 16384 |
|     1 | i2uniq     | 16384 |
+-------+------------+-------+
</pre><p>
          For partitions or subpartitions, the same query with a
          modified <code class="literal">WHERE</code> clause can be used to
          retrieve index sizes. For example, the following query
          retrieves index sizes for partitions of table
          <code class="literal">t1</code>:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SUM(stat_value) pages, index_name,</code></strong>
       <strong class="userinput"><code>SUM(stat_value)*@@innodb_page_size size</code></strong>
       <strong class="userinput"><code>FROM mysql.innodb_index_stats WHERE table_name like 't1#P%'</code></strong>
       <strong class="userinput"><code>AND stat_name = 'size' GROUP BY index_name;</code></strong>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-statistics-estimation"></a>15.8.10.2 Configuring Non-Persistent Optimizer Statistics Parameters</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091647326544"></a><a class="indexterm" name="idm140091647325472"></a><a class="indexterm" name="idm140091647324432"></a><p>
        This section describes how to configure non-persistent optimizer
        statistics. Optimizer statistics are not persisted to disk when
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent=OFF</code></a> or
        when individual tables are created or altered with
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">STATS_PERSISTENT=0</code></a>.
        Instead, statistics are stored in memory, and are lost when the
        server is shut down. Statistics are also updated periodically by
        certain operations and under certain conditions.
      </p><p>
        Optimizer statistics are persisted to disk by default, enabled
        by the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
        configuration option. For information about persistent optimizer
        statistics, see <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="15.8.10.1 Configuring Persistent Optimizer Statistics Parameters">Section 15.8.10.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
</p>
<h5><a name="innodb-statistics-estimation-update"></a>Optimizer Statistics Updates</h5>
<p>
        Non-persistent optimizer statistics are updated when:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Running <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>.
          </p></li><li class="listitem"><p>
            Running <a class="link" href="sql-syntax.html#show-table-status" title="13.7.6.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a>,
            <a class="link" href="sql-syntax.html#show-index" title="13.7.6.22 SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a>, or querying the
            <a class="link" href="information-schema.html#tables-table" title="25.30 The INFORMATION_SCHEMA TABLES Table"><code class="literal">INFORMATION_SCHEMA.TABLES</code></a> or
            <a class="link" href="information-schema.html#statistics-table" title="25.26 The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">INFORMATION_SCHEMA.STATISTICS</code></a>
            tables with the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a>
            option enabled.
          </p><p>
            The default setting for
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a> is
            <code class="literal">OFF</code>. Enabling
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a>
            may reduce access speed for schemas that have a large number
            of tables or indexes, and reduce stability of execution
            plans for queries that involve <code class="literal">InnoDB</code>
            tables.
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a> is
            configured globally using a
            <a class="link" href="data-types.html#set" title="11.4.5 The SET Type"><code class="literal">SET</code></a> statement.
          </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_stats_on_metadata=ON
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a>
              only applies when optimizer
              <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> are
              configured to be non-persistent (when
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
              is disabled).
</p>
</div>
</li><li class="listitem"><p>
            Starting a <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client with the
            <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">--auto-rehash</code></a> option enabled,
            which is the default. The
            <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">auto-rehash</code></a> option causes all
            <code class="literal">InnoDB</code> tables to be opened, and the open
            table operations cause statistics to be recalculated.
          </p><p>
            To improve the start up time of the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a>
            client and to updating statistics, you can turn off
            <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">auto-rehash</code></a> using the
            <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">--disable-auto-rehash</code></a>
            option. The <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">auto-rehash</code></a>
            feature enables automatic name completion of database,
            table, and column names for interactive users.
          </p></li><li class="listitem"><p>
            A table is first opened.
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> detects that 1 / 16 of table has
            been modified since the last time statistics were updated.
</p></li></ul>
</div>
<h5><a name="idm140091647281728"></a>Configuring the Number of Sampled Pages</h5>
<p>
        The MySQL query optimizer uses estimated
        <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> about key
        distributions to choose the indexes for an execution plan, based
        on the relative
        <a class="link" href="glossary.html#glos_selectivity" title="selectivity">selectivity</a> of the
        index. When <code class="literal">InnoDB</code> updates optimizer
        statistics, it samples random pages from each index on a table
        to estimate the
        <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> of the
        index. (This technique is known as
        <a class="link" href="glossary.html#glos_random_dive" title="random dive">random dives</a>.)
      </p><p>
        To give you control over the quality of the statistics estimate
        (and thus better information for the query optimizer), you can
        change the number of sampled pages using the parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>.
        The default number of sampled pages is 8, which could be
        insufficient to produce an accurate estimate, leading to poor
        index choices by the query optimizer. This technique is
        especially important for large tables and tables used in
        <a class="link" href="glossary.html#glos_join" title="join">joins</a>. Unnecessary
        <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full table scans</a> for
        such tables can be a substantial performance issue. See
        <a class="xref" href="optimization.html#table-scan-avoidance" title="8.2.1.22 Avoiding Full Table Scans">Section 8.2.1.22, “Avoiding Full Table Scans”</a> for tips on tuning such
        queries.
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
        is a global parameter that can be set at runtime.
      </p><p>
        The value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
        affects the index sampling for all <code class="literal">InnoDB</code>
        tables and indexes when
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent=0</code></a>. Be
        aware of the following potentially significant impacts when you
        change the index sample size:

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Small values like 1 or 2 can result in inaccurate
              estimates of cardinality.
            </p></li><li class="listitem"><p>
              Increasing the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
              value might require more disk reads. Values much larger
              than 8 (say, 100), can cause a significant slowdown in the
              time it takes to open a table or execute <code class="literal">SHOW
              TABLE STATUS</code>.
            </p></li><li class="listitem"><p>
              The optimizer might choose very different query plans
              based on different estimates of index selectivity.
</p></li></ul>
</div>
<p>
      </p><p>
        Whatever value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
        works best for a system, set the option and leave it at that
        value. Choose a value that results in reasonably accurate
        estimates for all tables in your database without requiring
        excessive I/O. Because the statistics are automatically
        recalculated at various times other than on execution of
        <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>, it does not make
        sense to increase the index sample size, run
        <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>, then decrease
        sample size again.
      </p><p>
        Smaller tables generally require fewer index samples than larger
        tables. If your database has many large tables, consider using a
        higher value for
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
        than if you have mostly smaller tables.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-analyze-table-complexity"></a>15.8.10.3 Estimating ANALYZE TABLE Complexity for InnoDB Tables</h4>

</div>

</div>

</div>
<p>
        <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> complexity for
        <code class="literal">InnoDB</code> tables is dependent on:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The number of pages sampled, as defined by
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>.
          </p></li><li class="listitem"><p>
            The number of indexed columns in a table
          </p></li><li class="listitem"><p>
            The number of partitions. If a table has no partitions, the
            number of partitions is considered to be 1.
</p></li></ul>
</div>
<p>
        Using these parameters, an approximate formula for estimating
        <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> complexity would
        be:
      </p><p>
        The value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
        * number of indexed columns in a table * the number of
        partitions
      </p><p>
        Typically, the greater the resulting value, the greater the
        execution time for <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          defines the number of pages sampled at a global level. To set
          the number of pages sampled for an individual table, use the
          <code class="literal">STATS_SAMPLE_PAGES</code> option with
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>. For more
          information, see <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="15.8.10.1 Configuring Persistent Optimizer Statistics Parameters">Section 15.8.10.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
        </p><p>
          If
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent=OFF</code></a>,
          the number of pages sampled is defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>.
          See <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="15.8.10.2 Configuring Non-Persistent Optimizer Statistics Parameters">Section 15.8.10.2, “Configuring Non-Persistent Optimizer Statistics Parameters”</a> for
          additional information.
</p>
</div>
<p>
        For a more in-depth approach to estimating <code class="literal">ANALYZE
        TABLE</code> complexity, consider the following example.
      </p><p>
        In <a class="ulink" href="http://en.wikipedia.org/wiki/Big_O_notation" target="_top">Big
        O notation</a>, <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
        complexity is described as:
      </p><pre data-lang="none" class="programlisting"> O(n_sample
  * (n_cols_in_uniq_i
     + n_cols_in_non_uniq_i
     + n_cols_in_pk * (1 + n_non_uniq_i))
  * n_part)          
</pre><p>
        where:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">n_sample</code> is the number of pages sampled
            (defined by
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>)
          </p></li><li class="listitem"><p>
            <code class="literal">n_cols_in_uniq_i</code> is total number of all
            columns in all unique indexes (not counting the primary key
            columns)
          </p></li><li class="listitem"><p>
            <code class="literal">n_cols_in_non_uniq_i</code> is the total number
            of all columns in all nonunique indexes
          </p></li><li class="listitem"><p>
            <code class="literal">n_cols_in_pk</code> is the number of columns in
            the primary key (if a primary key is not defined,
            <code class="literal">InnoDB</code> creates a single column primary
            key internally)
          </p></li><li class="listitem"><p>
            <code class="literal">n_non_uniq_i</code> is the number of nonunique
            indexes in the table
          </p></li><li class="listitem"><p>
            <code class="literal">n_part</code> is the number of partitions. If no
            partitions are defined, the table is considered to be a
            single partition.
</p></li></ul>
</div>
<p>
        Now, consider the following table (table <code class="literal">t</code>),
        which has a primary key (2 columns), a unique index (2 columns),
        and two nonunique indexes (two columns each):
      </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t (
  a INT,
  b INT,
  c INT,
  d INT,
  e INT,
  f INT,
  g INT,
  h INT,
  PRIMARY KEY (a, b),
  UNIQUE KEY i1uniq (c, d),
  KEY i2nonuniq (e, f),
  KEY i3nonuniq (g, h)
);
</pre><p>
        For the column and index data required by the algorithm
        described above, query the
        <code class="literal">mysql.innodb_index_stats</code> persistent index
        statistics table for table <code class="literal">t</code>. The
        <code class="literal">n_diff_pfx%</code> statistics show the columns that
        are counted for each index. For example, columns
        <code class="literal">a</code> and <code class="literal">b</code> are counted for
        the primary key index. For the nonunique indexes, the primary
        key columns (a,b) are counted in addition to the user defined
        columns.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          For additional information about the <code class="literal">InnoDB</code>
          persistent statistics tables, see
          <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="15.8.10.1 Configuring Persistent Optimizer Statistics Parameters">Section 15.8.10.1, “Configuring Persistent Optimizer Statistics Parameters”</a>
</p>
</div>
<pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT index_name, stat_name, stat_description</code></strong>
       <strong class="userinput"><code>FROM mysql.innodb_index_stats WHERE</code></strong>
       <strong class="userinput"><code>database_name='test' AND</code></strong>
       <strong class="userinput"><code>table_name='t' AND</code></strong>
       <strong class="userinput"><code>stat_name like 'n_diff_pfx%';</code></strong>
  +------------+--------------+------------------+
  | index_name | stat_name    | stat_description |
  +------------+--------------+------------------+
  | PRIMARY    | n_diff_pfx01 | a                |
  | PRIMARY    | n_diff_pfx02 | a,b              |
  | i1uniq     | n_diff_pfx01 | c                |
  | i1uniq     | n_diff_pfx02 | c,d              |
  | i2nonuniq  | n_diff_pfx01 | e                |
  | i2nonuniq  | n_diff_pfx02 | e,f              |
  | i2nonuniq  | n_diff_pfx03 | e,f,a            |
  | i2nonuniq  | n_diff_pfx04 | e,f,a,b          |
  | i3nonuniq  | n_diff_pfx01 | g                |
  | i3nonuniq  | n_diff_pfx02 | g,h              |
  | i3nonuniq  | n_diff_pfx03 | g,h,a            |
  | i3nonuniq  | n_diff_pfx04 | g,h,a,b          |
  +------------+--------------+------------------+   
</pre><p>
        Based on the index statistics data shown above and the table
        definition, the following values can be determined:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">n_cols_in_uniq_i</code>, the total number of all
            columns in all unique indexes not counting the primary key
            columns, is 2 (<code class="literal">c</code> and
            <code class="literal">d</code>)
          </p></li><li class="listitem"><p>
            <code class="literal">n_cols_in_non_uniq_i</code>, the total number of
            all columns in all nonunique indexes, is 4
            (<code class="literal">e</code>, <code class="literal">f</code>,
            <code class="literal">g</code> and <code class="literal">h</code>)
          </p></li><li class="listitem"><p>
            <code class="literal">n_cols_in_pk</code>, the number of columns in
            the primary key, is 2 (<code class="literal">a</code> and
            <code class="literal">b</code>)
          </p></li><li class="listitem"><p>
            <code class="literal">n_non_uniq_i</code>, the number of nonunique
            indexes in the table, is 2 (<code class="literal">i2nonuniq</code> and
            <code class="literal">i3nonuniq</code>))
          </p></li><li class="listitem"><p>
            <code class="literal">n_part</code>, the number of partitions, is 1.
</p></li></ul>
</div>
<p>
        You can now calculate
        <code class="literal">innodb_stats_persistent_sample_pages</code> * (2 + 4
        + 2 * (1 + 2)) * 1 to determine the number of leaf pages that
        are scanned. With
        <code class="literal">innodb_stats_persistent_sample_pages</code> set to
        the default value of <code class="literal">20</code>, and with a default
        page size of 16 <code class="literal">KiB</code>
        (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>=16384), you
        can then estimate that 20 * 12 * 16384 <code class="literal">bytes</code>
        are read for table <code class="literal">t</code>, or about 4
        <code class="literal">MiB</code>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          All 4 <code class="literal">MiB</code> may not be read from disk, as
          some leaf pages may already be cached in the buffer pool.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="index-page-merge-threshold"></a>15.8.11 Configuring the Merge Threshold for Index Pages</h3>

</div>

</div>

</div>
<p>
      You can configure the <code class="literal">MERGE_THRESHOLD</code> value for
      index pages. If the <span class="quote">“<span class="quote">page-full</span>”</span> percentage for an
      index page falls below the <code class="literal">MERGE_THRESHOLD</code>
      value when a row is deleted or when a row is shortened by an
      <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> operation,
      <code class="literal">InnoDB</code> attempts to merge the index page with a
      neighboring index page. The default
      <code class="literal">MERGE_THRESHOLD</code> value is 50, which is the
      previously hardcoded value. The minimum
      <code class="literal">MERGE_THRESHOLD</code> value is 1 and the maximum
      value is 50.
    </p><p>
      When the <span class="quote">“<span class="quote">page-full</span>”</span> percentage for an index page
      falls below 50%, which is the default
      <code class="literal">MERGE_THRESHOLD</code> setting,
      <code class="literal">InnoDB</code> attempts to merge the index page with a
      neighboring page. If both pages are close to 50% full, a page
      split can occur soon after the pages are merged. If this
      merge-split behavior occurs frequently, it can have an adverse
      affect on performance. To avoid frequent merge-splits, you can
      lower the <code class="literal">MERGE_THRESHOLD</code> value so that
      <code class="literal">InnoDB</code> attempts page merges at a lower
      <span class="quote">“<span class="quote">page-full</span>”</span> percentage. Merging pages at a lower
      page-full percentage leaves more room in index pages and helps
      reduce merge-split behavior.
    </p><p>
      The <code class="literal">MERGE_THRESHOLD</code> for index pages can be
      defined for a table or for individual indexes. A
      <code class="literal">MERGE_THRESHOLD</code> value defined for an individual
      index takes priority over a <code class="literal">MERGE_THRESHOLD</code>
      value defined for the table. If undefined, the
      <code class="literal">MERGE_THRESHOLD</code> value defaults to 50.
</p>
<h4><a name="idm140091647160672"></a>Setting MERGE_THRESHOLD for a Table</h4>
<p>
      You can set the <code class="literal">MERGE_THRESHOLD</code> value for a
      table using the <em class="replaceable"><code>table_option</code></em>
      <code class="literal">COMMENT</code> clause of the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. For
      example:
    </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (
   id INT,
  KEY id_index (id)
) COMMENT='MERGE_THRESHOLD=45';
</pre><p>
      You can also set the <code class="literal">MERGE_THRESHOLD</code> value for
      an existing table using the
      <em class="replaceable"><code>table_option</code></em> <code class="literal">COMMENT</code>
      clause with <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>:
    </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (
   id INT,
  KEY id_index (id)
);

ALTER TABLE t1 COMMENT='MERGE_THRESHOLD=40';    
</pre>
<h4><a name="idm140091647150864"></a>Setting MERGE_THRESHOLD for Individual Indexes</h4>
<p>
      To set the <code class="literal">MERGE_THRESHOLD</code> value for an
      individual index, you can use the
      <em class="replaceable"><code>index_option</code></em> <code class="literal">COMMENT</code>
      clause with <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, or
      <a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>, as shown in the
      following examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Setting <code class="literal">MERGE_THRESHOLD</code> for an individual
          index using <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>:
        </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (
   id INT,
  KEY id_index (id) COMMENT 'MERGE_THRESHOLD=40'
);
</pre></li><li class="listitem"><p>
          Setting <code class="literal">MERGE_THRESHOLD</code> for an individual
          index using <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>:
        </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (
   id INT,
  KEY id_index (id)
);

ALTER TABLE t1 DROP KEY id_index;
ALTER TABLE t1 ADD KEY id_index (id) COMMENT 'MERGE_THRESHOLD=40';
</pre></li><li class="listitem"><p>
          Setting <code class="literal">MERGE_THRESHOLD</code> for an individual
          index using <a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>:
        </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (id INT);
CREATE INDEX id_index ON t1 (id) COMMENT 'MERGE_THRESHOLD=40';
</pre></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        You cannot modify the <code class="literal">MERGE_THRESHOLD</code> value
        at the index level for <code class="literal">GEN_CLUST_INDEX</code>, which
        is the clustered index created by <code class="literal">InnoDB</code> when
        an <code class="literal">InnoDB</code> table is created without a primary
        key or unique key index. You can only modify the
        <code class="literal">MERGE_THRESHOLD</code> value for
        <code class="literal">GEN_CLUST_INDEX</code> by setting
        <code class="literal">MERGE_THRESHOLD</code> for the table.
</p>
</div>
<h4><a name="idm140091647126272"></a>Querying the MERGE_THRESHOLD Value for an Index</h4>
<p>
      The current <code class="literal">MERGE_THRESHOLD</code> value for an index
      can be obtained by querying the
      <a class="link" href="information-schema.html#innodb-indexes-table" title="25.39.19 The INFORMATION_SCHEMA INNODB_INDEXES Table"><code class="literal">INNODB_INDEXES</code></a> table. For example:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_INDEXES WHERE NAME='id_index' \G</code></strong>
*************************** 1. row ***************************
       INDEX_ID: 91
           NAME: id_index
       TABLE_ID: 68
           TYPE: 0
       N_FIELDS: 1
        PAGE_NO: 4
          SPACE: 57
MERGE_THRESHOLD: 40
</pre><p>
      You can use <a class="link" href="sql-syntax.html#show-create-table" title="13.7.6.10 SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a> to
      view the <code class="literal">MERGE_THRESHOLD</code> value for a table, if
      explicitly defined using the
      <em class="replaceable"><code>table_option</code></em> <code class="literal">COMMENT</code>
      clause:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW CREATE TABLE t2 \G</code></strong>
*************************** 1. row ***************************
       Table: t2
Create Table: CREATE TABLE `t2` (
  `id` int(11) DEFAULT NULL,
  KEY `id_index` (`id`) COMMENT 'MERGE_THRESHOLD=40'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        A <code class="literal">MERGE_THRESHOLD</code> value defined at the index
        level takes priority over a <code class="literal">MERGE_THRESHOLD</code>
        value defined for the table. If undefined,
        <code class="literal">MERGE_THRESHOLD</code> defaults to 50%
        (<code class="literal">MERGE_THRESHOLD=50</code>, which is the previously
        hardcoded value.
</p>
</div>
<p>
      Likewise, you can use <a class="link" href="sql-syntax.html#show-index" title="13.7.6.22 SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a> to
      view the <code class="literal">MERGE_THRESHOLD</code> value for an index, if
      explicitly defined using the
      <em class="replaceable"><code>index_option</code></em> <code class="literal">COMMENT</code>
      clause:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW INDEX FROM t2 \G</code></strong>
*************************** 1. row ***************************
        Table: t2
   Non_unique: 1
     Key_name: id_index
 Seq_in_index: 1
  Column_name: id
    Collation: A
  Cardinality: 0
     Sub_part: NULL
       Packed: NULL
         Null: YES
   Index_type: BTREE
      Comment:
Index_comment: MERGE_THRESHOLD=40
</pre>
<h4><a name="idm140091647106384"></a>Measuring the Effect of MERGE_THRESHOLD Settings</h4>
<p>
      The <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table provides two
      counters that can be used to measure the effect of a
      <code class="literal">MERGE_THRESHOLD</code> setting on index page merges.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT NAME, COMMENT FROM INFORMATION_SCHEMA.INNODB_METRICS</code></strong>
       <strong class="userinput"><code>WHERE NAME like '%index_page_merge%';</code></strong>
+-----------------------------+----------------------------------------+
| NAME                        | COMMENT                                |
+-----------------------------+----------------------------------------+
| index_page_merge_attempts   | Number of index page merge attempts    |
| index_page_merge_successful | Number of successful index page merges |
+-----------------------------+----------------------------------------+
</pre><p>
      When lowering the <code class="literal">MERGE_THRESHOLD</code> value, the
      objectives are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A smaller number of page merge attempts and successful page
          merges
        </p></li><li class="listitem"><p>
          A similar number of page merge attempts and successful page
          merges
</p></li></ul>
</div>
<p>
      A <code class="literal">MERGE_THRESHOLD</code> setting that is too small
      could result in large data files due to an excessive amount of
      empty page space.
    </p><p>
      For information about using
      <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> counters, see
      <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-metrics-table" title="15.14.6 InnoDB INFORMATION_SCHEMA Metrics Table">Section 15.14.6, “InnoDB INFORMATION_SCHEMA Metrics Table”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-dedicated-server"></a>15.8.12 Enabling Automatic Configuration for a Dedicated MySQL Server</h3>

</div>

</div>

</div>
<p>
      When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_dedicated_server"><code class="literal">innodb_dedicated_server</code></a> is
      enabled, <code class="literal">InnoDB</code> automatically configures the
      following variables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a> (as
          of MySQL 8.0.14)
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a>
</p></li></ul>
</div>
<p>
      Only consider enabling
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_dedicated_server"><code class="literal">innodb_dedicated_server</code></a> if the
      MySQL instance resides on a dedicated server where it can use all
      available system resources. For example, consider enabling if you
      run MySQL Server in a Docker container or dedicated VM. Enabling
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_dedicated_server"><code class="literal">innodb_dedicated_server</code></a> is not
      recommended if the MySQL instance shares system resources with
      other applications.
    </p><p>
      The information that follows describes how each variable is
      automatically configured.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
        </p><p>
          Buffer pool size is configured according to the amount of
          memory detected on the server.
</p>
<div class="table">
<a name="dedicated-server-buffer-pool-size"></a><p class="title"><b>Table 15.9 Automatically Configured Buffer Pool Size</b></p>
<div class="table-contents">
<table summary="The first column shows the amount of detected server memory. The second column shows the automatically configured buffer pool size."><col width="50%"><col width="50%"><thead><tr>
              <th scope="col">Detected Server Memory</th>
              <th scope="col">Buffer Pool Size</th>
            </tr></thead><tbody><tr>
              <td scope="row">Less than 1GB</td>
              <td>128MiB (the default value)</td>
            </tr><tr>
              <td scope="row">1GB to 4GB</td>
              <td><em class="replaceable"><code>detected server memory</code></em> * 0.5</td>
            </tr><tr>
              <td scope="row">Greater than 4GB</td>
              <td><em class="replaceable"><code>detected server memory</code></em> * 0.75</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>
        </p><p>
          As of MySQL 8.0.14, log file size is configured according to
          the automatically configured buffer pool size.
</p>
<div class="table">
<a name="dedicated-server-log-file-size"></a><p class="title"><b>Table 15.10 Automatically Configured Log File Size</b></p>
<div class="table-contents">
<table summary="The first column shows the buffer pool size. The second column shows the automatically configured log file size."><col width="50%"><col width="50%"><thead><tr>
              <th scope="col">Buffer Pool Size</th>
              <th scope="col">Log File Size</th>
            </tr></thead><tbody><tr>
              <td scope="row">Less than 8GB</td>
              <td>512MiB</td>
            </tr><tr>
              <td scope="row">8GB to 128GB</td>
              <td>1024MiB</td>
            </tr><tr>
              <td scope="row">Greater than 128GB</td>
              <td>2048MiB</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Prior to MySQL 8.0.14, the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>
            variable was automatically configured according to the
            amount of memory detected on the server, as shown below:
</p>
<div class="table">
<a name="dedicated-server-log-file-size-old"></a><p class="title"><b>Table 15.11 Automatically Configured Log File Size (MySQL 8.0.13 and Earlier)</b></p>
<div class="table-contents">
<table summary="The first column shows the amount of detected server memory. The second column shows the automatically configured log file size based on the amount of detected server memory."><col width="50%"><col width="50%"><thead><tr>
                <th scope="col">Detected Server Memory</th>
                <th scope="col">Log File Size</th>
              </tr></thead><tbody><tr>
                <td scope="row">&lt; 1GB</td>
                <td>48MiB (the default value)</td>
              </tr><tr>
                <td scope="row">&lt;= 4GB</td>
                <td>128MiB</td>
              </tr><tr>
                <td scope="row">&lt;= 8GB</td>
                <td>512MiB</td>
              </tr><tr>
                <td scope="row">&lt;= 16GB</td>
                <td>1024MiB</td>
              </tr><tr>
                <td scope="row">&gt; 16GB</td>
                <td>2048MiB</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
</li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>
        </p><p>
          The number of log files is configured according to the
          automatically configured buffer pool size (in gigabytes).
          Automatic configuration of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>
          variable was added in MySQL 8.0.14.
</p>
<div class="table">
<a name="dedicated-server-log-files"></a><p class="title"><b>Table 15.12 Automatically Configured Number of Log Files</b></p>
<div class="table-contents">
<table summary="The first column shows the buffer pool size. The second column shows the automatically configured number of log files."><col width="50%"><col width="50%"><thead><tr>
              <th scope="col">Buffer Pool Size</th>
              <th scope="col">Number of Log Files</th>
            </tr></thead><tbody><tr>
              <td scope="row">Less than 8GB</td>
              <td>ROUND(<em class="replaceable"><code>buffer pool size</code></em>)</td>
            </tr><tr>
              <td scope="row">8GB to 128GB</td>
              <td>ROUND(<em class="replaceable"><code>buffer pool size</code></em> * 0.75)</td>
            </tr><tr>
              <td scope="row">Greater than 128GB</td>
              <td>64</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a>
        </p><p>
          The flush method is set to
          <code class="literal">O_DIRECT_NO_FSYNC</code> when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_dedicated_server"><code class="literal">innodb_dedicated_server</code></a> is
          enabled. If the <code class="literal">O_DIRECT_NO_FSYNC</code> setting
          is not available, the default
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> setting
          is used.
        </p><p>
          <code class="literal">InnoDB</code> uses <code class="literal">O_DIRECT</code>
          during flushing I/O, but skips the <code class="literal">fsync()</code>
          system call after each write operation.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
            Prior to MySQL 8.0.14, this setting is not suitable for file
            systems such as XFS and EXT4, which require an
            <code class="literal">fsync()</code> system call to synchronize file
            system metadata changes.
          </p><p>
            As of MySQL 8.0.14, <code class="literal">fsync()</code> is called
            after creating a new file, after increasing file size, and
            after closing a file, to ensure that file system metadata
            changes are synchronized. The <code class="literal">fsync()</code>
            system call is still skipped after each write operation.
          </p><p>
            On storage devices with cache, data loss is possible if data
            files and redo log files reside on different storage
            devices, and a crash occurs before data file writes are
            flushed from the device cache. If you use or intend to use
            different storage devices for redo logs and data files, use
            <code class="literal">O_DIRECT</code> instead.
</p>
</div>
</li></ul>
</div>
<p>
      If an automatically configured option is configured explicitly in
      an option file or elsewhere, the explicitly specified setting is
      used, and a startup warning similar to this is printed to
      <code class="literal">stderr</code>:
    </p><p>
      <span class="errortext">[Warning] [000000] InnoDB: Option
      innodb_dedicated_server is ignored for innodb_buffer_pool_size
      because innodb_buffer_pool_size=134217728 is specified
      explicitly.</span>
    </p><p>
      Explicit configuration of one option does not prevent the
      automatic configuration of other options. For example, if
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_dedicated_server"><code class="literal">innodb_dedicated_server</code></a> is
      enabled and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> is
      configured explicitly in an option file,
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a> are
      automatically configured based on the implicit buffer pool size
      that is calculated according to the amount of memory detected on
      the server.
    </p><p>
      Automatically configured settings are evaluated and reconfigured
      if necessary each time the MySQL server is started.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-compression"></a>15.9 InnoDB Table and Page Compression</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-compression">15.9.1 InnoDB Table Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-page-compression">15.9.2 InnoDB Page Compression</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091646979680"></a><a class="indexterm" name="idm140091646978640"></a><p>
    This section provides information about the
    <code class="literal">InnoDB</code> table compression and
    <code class="literal">InnoDB</code> page compression features. The page
    compression feature is also referred to as
    <a class="link" href="glossary.html#glos_transparent_page_compression" title="transparent page compression">transparent page
    compression</a>.
  </p><p>
    Using the compression features of <code class="literal">InnoDB</code>, you can
    create tables where the data is stored in compressed form.
    Compression can help to improve both raw performance and
    scalability. The compression means less data is transferred between
    disk and memory, and takes up less space on disk and in memory. The
    benefits are amplified for tables with
    <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>,
    because index data is compressed also. Compression can be especially
    important for <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> storage devices,
    because they tend to have lower capacity than
    <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> devices.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-table-compression"></a>15.9.1 InnoDB Table Compression</h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-background">15.9.1.1 Overview of Table Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-usage">15.9.1.2 Creating Compressed Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-tuning">15.9.1.3 Tuning Compression for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-tuning-monitoring">15.9.1.4 Monitoring InnoDB Table Compression at Runtime</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-internals">15.9.1.5 How Compression Works for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-compression-oltp">15.9.1.6 Compression for OLTP Workloads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-syntax-warnings">15.9.1.7 SQL Compression Syntax Warnings and Errors</a></span></dt></dl>
</div>
<p>
      This section describes <code class="literal">InnoDB</code> table
      compression, which is supported with <code class="literal">InnoDB</code>
      tables that reside in
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file_per_table</a>
      tablespaces or <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
      tablespaces</a>. Table compression is enabled using the
      <code class="literal">ROW_FORMAT=COMPRESSED</code> attribute with
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-background"></a>15.9.1.1 Overview of Table Compression</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091646961360"></a><p>
        Because processors and cache memories have increased in speed
        more than disk storage devices, many workloads are
        <a class="link" href="glossary.html#glos_disk_bound" title="disk-bound">disk-bound</a>. Data
        <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> enables
        smaller database size, reduced I/O, and improved throughput, at
        the small cost of increased CPU utilization. Compression is
        especially valuable for read-intensive applications, on systems
        with enough RAM to keep frequently used data in memory.
      </p><p>
        An <code class="literal">InnoDB</code> table created with
        <code class="literal">ROW_FORMAT=COMPRESSED</code> can use a smaller
        <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a> on disk than the
        configured <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
        value. Smaller pages require less I/O to read from and write to
        disk, which is especially valuable for
        <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> devices.
      </p><p>
        The compressed page size is specified through the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        <code class="literal">KEY_BLOCK_SIZE</code> parameter. The different page
        size requires that the table be placed in a
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespace or <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespace</a> rather than in the
        <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>,
        as the system tablespace cannot store compressed tables. For
        more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="15.6.3.2 File-Per-Table Tablespaces">Section 15.6.3.2, “File-Per-Table Tablespaces”</a>, and
        <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
      </p><p>
        The level of compression is the same regardless of the
        <code class="literal">KEY_BLOCK_SIZE</code> value. As you specify smaller
        values for <code class="literal">KEY_BLOCK_SIZE</code>, you get the I/O
        benefits of increasingly smaller pages. But if you specify a
        value that is too small, there is additional overhead to
        reorganize the pages when data values cannot be compressed
        enough to fit multiple rows in each page. There is a hard limit
        on how small <code class="literal">KEY_BLOCK_SIZE</code> can be for a
        table, based on the lengths of the key columns for each of its
        indexes. Specify a value that is too small, and the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement fails.
      </p><p>
        In the buffer pool, the compressed data is held in small pages,
        with a page size based on the <code class="literal">KEY_BLOCK_SIZE</code>
        value. For extracting or updating the column values, MySQL also
        creates an uncompressed page in the buffer pool with the
        uncompressed data. Within the buffer pool, any updates to the
        uncompressed page are also re-written back to the equivalent
        compressed page. You might need to size your buffer pool to
        accommodate the additional data of both compressed and
        uncompressed pages, although the uncompressed pages are
        <a class="link" href="glossary.html#glos_eviction" title="eviction">evicted</a> from the buffer
        pool when space is needed, and then uncompressed again on the
        next access.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-usage"></a>15.9.1.2 Creating Compressed Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091646935136"></a><a class="indexterm" name="idm140091646933648"></a><a class="indexterm" name="idm140091646932576"></a><a class="indexterm" name="idm140091646931088"></a><a class="indexterm" name="idm140091646930016"></a><p>
        Compressed tables can be created in
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespaces or in
        <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespaces</a>. Table compression is not available for the
        InnoDB <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
        tablespace</a>. The system tablespace (space 0, the
        <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibdata files</a>) can contain
        user-created tables, but it also contains internal system data,
        which is never compressed. Thus, compression applies only to
        tables (and indexes) stored in file-per-table or general
        tablespaces.
</p>
<h5><a name="idm140091646924384"></a>Creating a Compressed Table in File-Per-Table Tablespace</h5>
<p>
        To create a compressed table in a file-per-table tablespace,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
        enabled (the default). You can set this parameter in the MySQL
        configuration file (<code class="filename">my.cnf</code> or
        <code class="filename">my.ini</code>) or dynamically, using a
        <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET</code></a>
        statement.
      </p><p>
        After the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        option is configured, specify the
        <code class="literal">ROW_FORMAT=COMPRESSED</code> clause or
        <code class="literal">KEY_BLOCK_SIZE</code> clause, or both, in a
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement to create a
        compressed table in a file-per-table tablespace.
      </p><p>
        For example, you might use the following statements:
      </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_file_per_table=1;
CREATE TABLE t1
 (c1 INT PRIMARY KEY)
 ROW_FORMAT=COMPRESSED
 KEY_BLOCK_SIZE=8;
</pre>
<h5><a name="idm140091646911904"></a>Creating a Compressed Table in a General Tablespace</h5>
<p>
        To create a compressed table in a general tablespace,
        <code class="literal">FILE_BLOCK_SIZE</code> must be defined for the
        general tablespace, which is specified when the tablespace is
        created. The <code class="literal">FILE_BLOCK_SIZE</code> value must be a
        valid compressed page size in relation to the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value, and the
        page size of the compressed table, defined by the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        <code class="literal">KEY_BLOCK_SIZE</code> clause, must be equal to
        <code class="literal">FILE_BLOCK_SIZE/1024</code>. For example, if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size=16384</code></a> and
        <code class="literal">FILE_BLOCK_SIZE=8192</code>, the
        <code class="literal">KEY_BLOCK_SIZE</code> of the table must be 8. For
        more information, see <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
      </p><p>
        The following example demonstrates creating a general tablespace
        and adding a compressed table. The example assumes a default
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> of 16K. The
        <code class="literal">FILE_BLOCK_SIZE</code> of 8192 requires that the
        compressed table have a <code class="literal">KEY_BLOCK_SIZE</code> of 8.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLESPACE `ts2` ADD DATAFILE 'ts2.ibd' FILE_BLOCK_SIZE = 8192 Engine=InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE t4 (c1 INT PRIMARY KEY) TABLESPACE ts2 ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=8;</code></strong>
</pre>
<h5><a name="idm140091646894752"></a>Notes</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            As of MySQL 8.0, the tablespace file for a
            compressed table is created using the physical page size
            instead of the <code class="literal">InnoDB</code> page size, which
            makes the initial size of a tablespace file for an empty
            compressed table smaller than in previous MySQL releases.
          </p></li><li class="listitem"><p>
            If you specify <code class="literal">ROW_FORMAT=COMPRESSED</code>, you
            can omit <code class="literal">KEY_BLOCK_SIZE</code>; the
            <code class="literal">KEY_BLOCK_SIZE</code> setting defaults to half
            the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value.
          </p></li><li class="listitem"><p>
            If you specify a valid <code class="literal">KEY_BLOCK_SIZE</code>
            value, you can omit
            <code class="literal">ROW_FORMAT=COMPRESSED</code>; compression is
            enabled automatically.
          </p></li><li class="listitem"><p>
            To determine the best value for
            <code class="literal">KEY_BLOCK_SIZE,</code> typically you create
            several copies of the same table with different values for
            this clause, then measure the size of the resulting
            <code class="filename">.ibd</code> files and see how well each
            performs with a realistic
            <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>. For general
            tablespaces, keep in mind that dropping a table does not
            reduce the size of the general tablespace
            <code class="filename">.ibd</code> file, nor does it return disk
            space to the operating system. For more information, see
            <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
          </p></li><li class="listitem"><p>
            The <code class="literal">KEY_BLOCK_SIZE</code> value is treated as a
            hint; a different size could be used by
            <code class="literal">InnoDB</code> if necessary. For file-per-table
            tablespaces, the <code class="literal">KEY_BLOCK_SIZE</code> can only
            be less than or equal to the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value. If
            you specify a value greater than the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value, the
            specified value is ignored, a warning is issued, and
            <code class="literal">KEY_BLOCK_SIZE</code> is set to half of the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value. If
            <code class="literal">innodb_strict_mode=ON</code>, specifying an
            invalid <code class="literal">KEY_BLOCK_SIZE</code> value returns an
            error. For general tablespaces, valid
            <code class="literal">KEY_BLOCK_SIZE</code> values depend on the
            <code class="literal">FILE_BLOCK_SIZE</code> setting of the
            tablespace. For more information, see
            <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> supports 32KB and 64KB page sizes
            but these page sizes do not support compression. For more
            information, refer to the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
            documentation.
          </p></li><li class="listitem"><p>
            The default uncompressed size of <code class="literal">InnoDB</code>
            data <a class="link" href="glossary.html#glos_page" title="page">pages</a> is 16KB.
            Depending on the combination of option values, MySQL uses a
            page size of 1KB, 2KB, 4KB, 8KB, or 16KB for the tablespace
            data file (<code class="filename">.ibd</code> file). The actual
            compression algorithm is not affected by the
            <code class="literal">KEY_BLOCK_SIZE</code> value; the value
            determines how large each compressed chunk is, which in turn
            affects how many rows can be packed into each compressed
            page.
          </p></li><li class="listitem"><p>
            When creating a compressed table in a file-per-table
            tablespace, setting <code class="literal">KEY_BLOCK_SIZE</code> equal
            to the <code class="literal">InnoDB</code>
            <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a> does not
            typically result in much compression. For example, setting
            <code class="literal">KEY_BLOCK_SIZE=16</code> typically would not
            result in much compression, since the normal
            <code class="literal">InnoDB</code> page size is 16KB. This setting
            may still be useful for tables with many long
            <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> or
            <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, because such
            values often do compress well, and might therefore require
            fewer <a class="link" href="glossary.html#glos_overflow_page" title="overflow page">overflow
            pages</a> as described in
            <a class="xref" href="innodb-storage-engine.html#innodb-compression-internals" title="15.9.1.5 How Compression Works for InnoDB Tables">Section 15.9.1.5, “How Compression Works for InnoDB Tables”</a>. For general
            tablespaces, a <code class="literal">KEY_BLOCK_SIZE</code> value equal
            to the <code class="literal">InnoDB</code> page size is not permitted.
            For more information, see
            <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
          </p></li><li class="listitem"><p>
            All indexes of a table (including the
            <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>)
            are compressed using the same page size, as specified in the
            <code class="literal">CREATE TABLE</code> or <code class="literal">ALTER
            TABLE</code> statement. Table attributes such as
            <code class="literal">ROW_FORMAT</code> and
            <code class="literal">KEY_BLOCK_SIZE</code> are not part of the
            <code class="literal">CREATE INDEX</code> syntax for
            <code class="literal">InnoDB</code> tables, and are ignored if they
            are specified (although, if specified, they will appear in
            the output of the <a class="link" href="sql-syntax.html#show-create-table" title="13.7.6.10 SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE
            TABLE</code></a> statement).
          </p></li><li class="listitem"><p>
            For performance-related configuration options, see
            <a class="xref" href="innodb-storage-engine.html#innodb-compression-tuning" title="15.9.1.3 Tuning Compression for InnoDB Tables">Section 15.9.1.3, “Tuning Compression for InnoDB Tables”</a>.
</p></li></ul>
</div>
<h5><a name="idm140091646839936"></a>Restrictions on Compressed Tables</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Compressed tables cannot be stored in the
            <code class="literal">InnoDB</code> system tablespace.
          </p></li><li class="listitem"><p>
            General tablespaces can contain multiple tables, but
            compressed and uncompressed tables cannot coexist within the
            same general tablespace.
          </p></li><li class="listitem"><p>
            Compression applies to an entire table and all its
            associated indexes, not to individual rows, despite the
            clause name <code class="literal">ROW_FORMAT</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> does not support compressed
            temporary tables. When
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
            enabled (the default),
            <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE
            TEMPORARY TABLE</code></a> returns errors if
            <code class="literal">ROW_FORMAT=COMPRESSED</code> or
            <code class="literal">KEY_BLOCK_SIZE</code> is specified. If
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
            disabled, warnings are issued and the temporary table is
            created using a non-compressed row format. The same
            restrictions apply to <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
            TABLE</code></a> operations on temporary tables.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-tuning"></a>15.9.1.3 Tuning Compression for InnoDB Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091646825120"></a><a class="indexterm" name="idm140091646823632"></a><p>
        Most often, the internal optimizations described in
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-internals-storage" title="InnoDB Data Storage and Compression">InnoDB Data Storage and Compression</a> ensure
        that the system runs well with compressed data. However, because
        the efficiency of compression depends on the nature of your
        data, you can make decisions that affect the performance of
        compressed tables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Which tables to compress.
          </p></li><li class="listitem"><p>
            What compressed page size to use.
          </p></li><li class="listitem"><p>
            Whether to adjust the size of the buffer pool based on
            run-time performance characteristics, such as the amount of
            time the system spends compressing and uncompressing data.
            Whether the workload is more like a
            <a class="link" href="glossary.html#glos_data_warehouse" title="data warehouse">data warehouse</a>
            (primarily queries) or an
            <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a> system (mix of queries
            and <a class="link" href="glossary.html#glos_dml" title="DML">DML</a>).
          </p></li><li class="listitem"><p>
            If the system performs DML operations on compressed tables,
            and the way the data is distributed leads to expensive
            <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
            failures</a> at runtime, you might adjust additional
            advanced configuration options.
</p></li></ul>
</div>
<p>
        Use the guidelines in this section to help make those
        architectural and configuration choices. When you are ready to
        conduct long-term testing and put compressed tables into
        production, see
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-tuning-monitoring" title="15.9.1.4 Monitoring InnoDB Table Compression at Runtime">Section 15.9.1.4, “Monitoring InnoDB Table Compression at Runtime”</a> for ways
        to verify the effectiveness of those choices under real-world
        conditions.
</p>
<h5><a name="innodb-compression-tuning-when"></a>When to Use Compression</h5>
<p>
        In general, compression works best on tables that include a
        reasonable number of character string columns and where the data
        is read far more often than it is written. Because there are no
        guaranteed ways to predict whether or not compression benefits a
        particular situation, always test with a specific
        <a class="link" href="glossary.html#glos_workload" title="workload">workload</a> and data set
        running on a representative configuration. Consider the
        following factors when deciding which tables to compress.
</p>
<h5><a name="innodb-compression-tuning-when-data"></a>Data Characteristics and Compression</h5>
<a class="indexterm" name="idm140091646806720"></a><p>
        A key determinant of the efficiency of compression in reducing
        the size of data files is the nature of the data itself. Recall
        that compression works by identifying repeated strings of bytes
        in a block of data. Completely randomized data is the worst
        case. Typical data often has repeated values, and so compresses
        effectively. Character strings often compress well, whether
        defined in <code class="literal">CHAR</code>, <code class="literal">VARCHAR</code>,
        <code class="literal">TEXT</code> or <code class="literal">BLOB</code> columns. On
        the other hand, tables containing mostly binary data (integers
        or floating point numbers) or data that is previously compressed
        (for example <acronym class="acronym">JPEG</acronym> or <acronym class="acronym">PNG</acronym>
        images) may not generally compress well, significantly or at
        all.
      </p><p>
        You choose whether to turn on compression for each InnoDB table.
        A table and all of its indexes use the same (compressed)
        <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>. It might be
        that the <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a>
        (clustered) index, which contains the data for all columns of a
        table, compresses more effectively than the secondary indexes.
        For those cases where there are long rows, the use of
        compression might result in long column values being stored
        <span class="quote">“<span class="quote">off-page</span>”</span>, as discussed in
        <a class="xref" href="innodb-storage-engine.html#innodb-row-format-dynamic" title="DYNAMIC Row Format">DYNAMIC Row Format</a>. Those overflow
        pages may compress well. Given these considerations, for many
        applications, some tables compress more effectively than others,
        and you might find that your workload performs best only with a
        subset of tables compressed.
      </p><p>
        To determine whether or not to compress a particular table,
        conduct experiments. You can get a rough estimate of how
        efficiently your data can be compressed by using a utility that
        implements LZ77 compression (such as <code class="literal">gzip</code> or
        WinZip) on a copy of the <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd
        file</a> for an uncompressed table. You can expect less
        compression from a MySQL compressed table than from file-based
        compression tools, because MySQL compresses data in chunks based
        on the <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>, 16KB by
        default. In addition to user data, the page format includes some
        internal system data that is not compressed. File-based
        compression utilities can examine much larger chunks of data,
        and so might find more repeated strings in a huge file than
        MySQL can find in an individual page.
      </p><p>
        Another way to test compression on a specific table is to copy
        some data from your uncompressed table to a similar, compressed
        table (having all the same indexes) in a
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespace and look at the size of the resulting
        <code class="literal">.ibd</code> file. For example:
      </p><pre data-lang="sql" class="programlisting">
USE test;
SET GLOBAL innodb_file_per_table=1;
SET GLOBAL autocommit=0;

-- Create an uncompressed table with a million or two rows.
CREATE TABLE big_table AS SELECT * FROM information_schema.columns;
INSERT INTO big_table SELECT * FROM big_table;
INSERT INTO big_table SELECT * FROM big_table;
INSERT INTO big_table SELECT * FROM big_table;
INSERT INTO big_table SELECT * FROM big_table;
INSERT INTO big_table SELECT * FROM big_table;
INSERT INTO big_table SELECT * FROM big_table;
INSERT INTO big_table SELECT * FROM big_table;
INSERT INTO big_table SELECT * FROM big_table;
INSERT INTO big_table SELECT * FROM big_table;
INSERT INTO big_table SELECT * FROM big_table;
COMMIT;
ALTER TABLE big_table ADD id int unsigned NOT NULL PRIMARY KEY auto_increment;

SHOW CREATE TABLE big_table\G

select count(id) from big_table;

-- Check how much space is needed for the uncompressed table.
\! ls -l data/test/big_table.ibd

CREATE TABLE key_block_size_4 LIKE big_table;
ALTER TABLE key_block_size_4 key_block_size=4 row_format=compressed;

INSERT INTO key_block_size_4 SELECT * FROM big_table;
commit;

-- Check how much space is needed for a compressed table
-- with particular compression settings.
\! ls -l data/test/key_block_size_4.ibd
</pre><p>
        This experiment produced the following numbers, which of course
        could vary considerably depending on your table structure and
        data:
      </p><pre data-lang="terminal" class="programlisting">
-rw-rw----  1 cirrus  staff  310378496 Jan  9 13:44 data/test/big_table.ibd
-rw-rw----  1 cirrus  staff  83886080 Jan  9 15:10 data/test/key_block_size_4.ibd
</pre><p>
        To see whether compression is efficient for your particular
        <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            For simple tests, use a MySQL instance with no other
            compressed tables and run queries against the
            <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP</code></a>
            table.
          </p></li><li class="listitem"><p>
            For more elaborate tests involving workloads with multiple
            compressed tables, run queries against the
            <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="25.39.7 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP_PER_INDEX</code></a>
            table. Because the statistics in the
            <code class="literal">INNODB_CMP_PER_INDEX</code> table are expensive
            to collect, you must enable the configuration option
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_cmp_per_index_enabled"><code class="literal">innodb_cmp_per_index_enabled</code></a>
            before querying that table, and you might restrict such
            testing to a development server or a non-critical
            <a class="link" href="glossary.html#glos_slave_server" title="slave server">slave server</a>.
          </p></li><li class="listitem"><p>
            Run some typical SQL statements against the compressed table
            you are testing.
          </p></li><li class="listitem"><p>
            Examine the ratio of successful compression operations to
            overall compression operations by querying the
            <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP</code></a>
            or
            <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="25.39.7 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP_PER_INDEX</code></a>
            table, and comparing <code class="literal">COMPRESS_OPS</code> to
            <code class="literal">COMPRESS_OPS_OK</code>.
          </p></li><li class="listitem"><p>
            If a high percentage of compression operations complete
            successfully, the table might be a good candidate for
            compression.
          </p></li><li class="listitem"><p>
            If you get a high proportion of
            <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
            failures</a>, you can adjust
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_level"><code class="literal">innodb_compression_level</code></a>,
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct"><code class="literal">innodb_compression_failure_threshold_pct</code></a>,
            and
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max"><code class="literal">innodb_compression_pad_pct_max</code></a>
            options as described in
            <a class="xref" href="innodb-storage-engine.html#innodb-performance-compression-oltp" title="15.9.1.6 Compression for OLTP Workloads">Section 15.9.1.6, “Compression for OLTP Workloads”</a>, and
            try further tests.
</p></li></ul>
</div>
<h5><a name="innodb-compression-application"></a>Database Compression versus Application Compression</h5>
<a class="indexterm" name="idm140091646762736"></a><p>
        Decide whether to compress data in your application or in the
        table; do not use both types of compression for the same data.
        When you compress the data in the application and store the
        results in a compressed table, extra space savings are extremely
        unlikely, and the double compression just wastes CPU cycles.
</p>
<h5><a name="innodb-compression-in-database"></a>Compressing in the Database</h5>
<p>
        When enabled, MySQL table compression is automatic and applies
        to all columns and index values. The columns can still be tested
        with operators such as <code class="literal">LIKE</code>, and sort
        operations can still use indexes even when the index values are
        compressed. Because indexes are often a significant fraction of
        the total size of a database, compression could result in
        significant savings in storage, I/O or processor time. The
        compression and decompression operations happen on the database
        server, which likely is a powerful system that is sized to
        handle the expected load.
</p>
<h5><a name="innodb-compression-in-application"></a>Compressing in the Application</h5>
<p>
        If you compress data such as text in your application, before it
        is inserted into the database, You might save overhead for data
        that does not compress well by compressing some columns and not
        others. This approach uses CPU cycles for compression and
        uncompression on the client machine rather than the database
        server, which might be appropriate for a distributed application
        with many clients, or where the client machine has spare CPU
        cycles.
</p>
<h5><a name="innodb-compression-hybrid"></a>Hybrid Approach</h5>
<p>
        Of course, it is possible to combine these approaches. For some
        applications, it may be appropriate to use some compressed
        tables and some uncompressed tables. It may be best to
        externally compress some data (and store it in uncompressed
        tables) and allow MySQL to compress (some of) the other tables
        in the application. As always, up-front design and real-life
        testing are valuable in reaching the right decision.
</p>
<h5><a name="innodb-compression-tuning-when-workload"></a>Workload Characteristics and Compression</h5>
<a class="indexterm" name="idm140091646751536"></a><p>
        In addition to choosing which tables to compress (and the page
        size), the workload is another key determinant of performance.
        If the application is dominated by reads, rather than updates,
        fewer pages need to be reorganized and recompressed after the
        index page runs out of room for the per-page <span class="quote">“<span class="quote">modification
        log</span>”</span> that MySQL maintains for compressed data. If the
        updates predominantly change non-indexed columns or those
        containing <code class="literal">BLOB</code>s or large strings that happen
        to be stored <span class="quote">“<span class="quote">off-page</span>”</span>, the overhead of
        compression may be acceptable. If the only changes to a table
        are <code class="literal">INSERT</code>s that use a monotonically
        increasing primary key, and there are few secondary indexes,
        there is little need to reorganize and recompress index pages.
        Since MySQL can <span class="quote">“<span class="quote">delete-mark</span>”</span> and delete rows on
        compressed pages <span class="quote">“<span class="quote">in place</span>”</span> by modifying
        uncompressed data, <code class="literal">DELETE</code> operations on a
        table are relatively efficient.
      </p><p>
        For some environments, the time it takes to load data can be as
        important as run-time retrieval. Especially in data warehouse
        environments, many tables may be read-only or read-mostly. In
        those cases, it might or might not be acceptable to pay the
        price of compression in terms of increased load time, unless the
        resulting savings in fewer disk reads or in storage cost is
        significant.
      </p><p>
        Fundamentally, compression works best when the CPU time is
        available for compressing and uncompressing data. Thus, if your
        workload is I/O bound, rather than CPU-bound, you might find
        that compression can improve overall performance. When you test
        your application performance with different compression
        configurations, test on a platform similar to the planned
        configuration of the production system.
</p>
<h5><a name="innodb-compression-tuning-when-config"></a>Configuration Characteristics and Compression</h5>
<a class="indexterm" name="idm140091646741840"></a><p>
        Reading and writing database
        <a class="link" href="glossary.html#glos_page" title="page">pages</a> from and to disk is the
        slowest aspect of system performance. Compression attempts to
        reduce I/O by using CPU time to compress and uncompress data,
        and is most effective when I/O is a relatively scarce resource
        compared to processor cycles.
      </p><p>
        This is often especially the case when running in a multi-user
        environment with fast, multi-core CPUs. When a page of a
        compressed table is in memory, MySQL often uses additional
        memory, typically 16KB, in the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> for an
        uncompressed copy of the page. The adaptive LRU algorithm
        attempts to balance the use of memory between compressed and
        uncompressed pages to take into account whether the workload is
        running in an I/O-bound or CPU-bound manner. Still, a
        configuration with more memory dedicated to the buffer pool
        tends to run better when using compressed tables than a
        configuration where memory is highly constrained.
</p>
<h5><a name="innodb-compression-tuning-when-size"></a>Choosing the Compressed Page Size</h5>
<a class="indexterm" name="idm140091646735248"></a><a class="indexterm" name="idm140091646733760"></a><a class="indexterm" name="idm140091646732272"></a><a class="indexterm" name="idm140091646730784"></a><p>
        The optimal setting of the compressed page size depends on the
        type and distribution of data that the table and its indexes
        contain. The compressed page size should always be bigger than
        the maximum record size, or operations may fail as noted in
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-internals-storage-btree" title="Compression of B-Tree Pages">Compression of B-Tree Pages</a>.
      </p><p>
        Setting the compressed page size too large wastes some space,
        but the pages do not have to be compressed as often. If the
        compressed page size is set too small, inserts or updates may
        require time-consuming recompression, and the
        <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> nodes may have to be
        split more frequently, leading to bigger data files and less
        efficient indexing.
      </p><p>
        Typically, you set the compressed page size to 8K or 4K bytes.
        Given that the maximum row size for an InnoDB table is around
        8K, <code class="literal">KEY_BLOCK_SIZE=8</code> is usually a safe
        choice.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-tuning-monitoring"></a>15.9.1.4 Monitoring InnoDB Table Compression at Runtime</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091646723840"></a><a class="indexterm" name="idm140091646722352"></a><p>
        Overall application performance, CPU and I/O utilization and the
        size of disk files are good indicators of how effective
        compression is for your application. This section builds on the
        performance tuning advice from
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-tuning" title="15.9.1.3 Tuning Compression for InnoDB Tables">Section 15.9.1.3, “Tuning Compression for InnoDB Tables”</a>, and shows how to
        find problems that might not turn up during initial testing.
      </p><p>
        To dig deeper into performance considerations for compressed
        tables, you can monitor compression performance at runtime using
        the <a class="link" href="glossary.html#glos_information_schema" title="INFORMATION_SCHEMA">Information
        Schema</a> tables described in
        <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-examples-compression" title="Example 15.1 Using the Compression Information Schema Tables">Example 15.1, “Using the Compression Information Schema Tables”</a>.
        These tables reflect the internal use of memory and the rates of
        compression used overall.
      </p><p>
        The <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> table reports
        information about compression activity for each compressed page
        size (<code class="literal">KEY_BLOCK_SIZE</code>) in use. The information
        in these tables is system-wide: it summarizes the compression
        statistics across all compressed tables in your database. You
        can use this data to help decide whether or not to compress a
        table by examining these tables when no other compressed tables
        are being accessed. It involves relatively low overhead on the
        server, so you might query it periodically on a production
        server to check the overall efficiency of the compression
        feature.
      </p><p>
        The <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="25.39.7 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INNODB_CMP_PER_INDEX</code></a> table
        reports information about compression activity for individual
        tables and indexes. This information is more targeted and more
        useful for evaluating compression efficiency and diagnosing
        performance issues one table or index at a time. (Because that
        each <code class="literal">InnoDB</code> table is represented as a
        clustered index, MySQL does not make a big distinction between
        tables and indexes in this context.) The
        <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="25.39.7 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INNODB_CMP_PER_INDEX</code></a> table does
        involve substantial overhead, so it is more suitable for
        development servers, where you can compare the effects of
        different <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>, data,
        and compression settings in isolation. To guard against imposing
        this monitoring overhead by accident, you must enable the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_cmp_per_index_enabled"><code class="literal">innodb_cmp_per_index_enabled</code></a>
        configuration option before you can query the
        <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="25.39.7 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INNODB_CMP_PER_INDEX</code></a> table.
      </p><p>
        The key statistics to consider are the number of, and amount of
        time spent performing, compression and uncompression operations.
        Since MySQL splits <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a>
        nodes when they are too full to contain the compressed data
        following a modification, compare the number of
        <span class="quote">“<span class="quote">successful</span>”</span> compression operations with the number
        of such operations overall. Based on the information in the
        <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
        <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="25.39.7 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INNODB_CMP_PER_INDEX</code></a> tables and
        overall application performance and hardware resource
        utilization, you might make changes in your hardware
        configuration, adjust the size of the buffer pool, choose a
        different page size, or select a different set of tables to
        compress.
      </p><p>
        If the amount of CPU time required for compressing and
        uncompressing is high, changing to faster or multi-core CPUs can
        help improve performance with the same data, application
        workload and set of compressed tables. Increasing the size of
        the buffer pool might also help performance, so that more
        uncompressed pages can stay in memory, reducing the need to
        uncompress pages that exist in memory only in compressed form.
      </p><p>
        A large number of compression operations overall (compared to
        the number of <code class="literal">INSERT</code>,
        <code class="literal">UPDATE</code> and <code class="literal">DELETE</code>
        operations in your application and the size of the database)
        could indicate that some of your compressed tables are being
        updated too heavily for effective compression. If so, choose a
        larger page size, or be more selective about which tables you
        compress.
      </p><p>
        If the number of <span class="quote">“<span class="quote">successful</span>”</span> compression
        operations (<code class="literal">COMPRESS_OPS_OK</code>) is a high
        percentage of the total number of compression operations
        (<code class="literal">COMPRESS_OPS</code>), then the system is likely
        performing well. If the ratio is low, then MySQL is
        reorganizing, recompressing, and splitting B-tree nodes more
        often than is desirable. In this case, avoid compressing some
        tables, or increase <code class="literal">KEY_BLOCK_SIZE</code> for some
        of the compressed tables. You might turn off compression for
        tables that cause the number of <span class="quote">“<span class="quote">compression
        failures</span>”</span> in your application to be more than 1% or 2% of
        the total. (Such a failure ratio might be acceptable during a
        temporary operation such as a data load).
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-internals"></a>15.9.1.5 How Compression Works for InnoDB Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091646692672"></a><p>
        This section describes some internal implementation details
        about <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> for
        InnoDB tables. The information presented here may be helpful in
        tuning for performance, but is not necessary to know for basic
        use of compression.
</p>
<h5><a name="innodb-compression-internals-algorithms"></a>Compression Algorithms</h5>
<a class="indexterm" name="idm140091646688528"></a><p>
        Some operating systems implement compression at the file system
        level. Files are typically divided into fixed-size blocks that
        are compressed into variable-size blocks, which easily leads
        into fragmentation. Every time something inside a block is
        modified, the whole block is recompressed before it is written
        to disk. These properties make this compression technique
        unsuitable for use in an update-intensive database system.
      </p><p>
        MySQL implements compression with the help of the well-known
        <a class="ulink" href="http://www.zlib.net/" target="_top">zlib library</a>, which
        implements the LZ77 compression algorithm. This compression
        algorithm is mature, robust, and efficient in both CPU
        utilization and in reduction of data size. The algorithm is
        <span class="quote">“<span class="quote">lossless</span>”</span>, so that the original uncompressed data
        can always be reconstructed from the compressed form. LZ77
        compression works by finding sequences of data that are repeated
        within the data to be compressed. The patterns of values in your
        data determine how well it compresses, but typical user data
        often compresses by 50% or more.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <code class="literal">InnoDB</code> supports the <code class="literal">zlib</code>
          library up to version 1.2.11, which is the version bundled
          with MySQL 8.0.
</p>
</div>
<p>
        Unlike compression performed by an application, or compression
        features of some other database management systems, InnoDB
        compression applies both to user data and to indexes. In many
        cases, indexes can constitute 40-50% or more of the total
        database size, so this difference is significant. When
        compression is working well for a data set, the size of the
        InnoDB data files (the
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespace or <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespace</a> <code class="literal">.ibd</code> files) is 25% to 50%
        of the uncompressed size or possibly smaller. Depending on the
        <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>, this smaller
        database can in turn lead to a reduction in I/O, and an increase
        in throughput, at a modest cost in terms of increased CPU
        utilization. You can adjust the balance between compression
        level and CPU overhead by modifying the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_level"><code class="literal">innodb_compression_level</code></a>
        configuration option.
</p>
<h5><a name="innodb-compression-internals-storage"></a>InnoDB Data Storage and Compression</h5>
<a class="indexterm" name="idm140091646674832"></a><p>
        All user data in InnoDB tables is stored in pages comprising a
        <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> index (the
        <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>). In
        some other database systems, this type of index is called an
        <span class="quote">“<span class="quote">index-organized table</span>”</span>. Each row in the index node
        contains the values of the (user-specified or system-generated)
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> and all the
        other columns of the table.
      </p><p>
        <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">Secondary indexes</a> in
        InnoDB tables are also B-trees, containing pairs of values: the
        index key and a pointer to a row in the clustered index. The
        pointer is in fact the value of the primary key of the table,
        which is used to access the clustered index if columns other
        than the index key and primary key are required. Secondary index
        records must always fit on a single B-tree page.
      </p><p>
        The compression of B-tree nodes (of both clustered and secondary
        indexes) is handled differently from compression of
        <a class="link" href="glossary.html#glos_overflow_page" title="overflow page">overflow pages</a> used to
        store long <code class="literal">VARCHAR</code>, <code class="literal">BLOB</code>,
        or <code class="literal">TEXT</code> columns, as explained in the
        following sections.
</p>
<h5><a name="innodb-compression-internals-storage-btree"></a>Compression of B-Tree Pages</h5>
<a class="indexterm" name="idm140091646663264"></a><p>
        Because they are frequently updated, B-tree pages require
        special treatment. It is important to minimize the number of
        times B-tree nodes are split, as well as to minimize the need to
        uncompress and recompress their content.
      </p><p>
        One technique MySQL uses is to maintain some system information
        in the B-tree node in uncompressed form, thus facilitating
        certain in-place updates. For example, this allows rows to be
        delete-marked and deleted without any compression operation.
      </p><p>
        In addition, MySQL attempts to avoid unnecessary uncompression
        and recompression of index pages when they are changed. Within
        each B-tree page, the system keeps an uncompressed
        <span class="quote">“<span class="quote">modification log</span>”</span> to record changes made to the
        page. Updates and inserts of small records may be written to
        this modification log without requiring the entire page to be
        completely reconstructed.
      </p><p>
        When the space for the modification log runs out, InnoDB
        uncompresses the page, applies the changes and recompresses the
        page. If recompression fails (a situation known as a
        <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
        failure</a>), the B-tree nodes are split and the process is
        repeated until the update or insert succeeds.
      </p><p>
        To avoid frequent compression failures in write-intensive
        workloads, such as for <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a>
        applications, MySQL sometimes reserves some empty space
        (padding) in the page, so that the modification log fills up
        sooner and the page is recompressed while there is still enough
        room to avoid splitting it. The amount of padding space left in
        each page varies as the system keeps track of the frequency of
        page splits. On a busy server doing frequent writes to
        compressed tables, you can adjust the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct"><code class="literal">innodb_compression_failure_threshold_pct</code></a>,
        and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max"><code class="literal">innodb_compression_pad_pct_max</code></a>
        configuration options to fine-tune this mechanism.
      </p><p>
        Generally, MySQL requires that each B-tree page in an InnoDB
        table can accommodate at least two records. For compressed
        tables, this requirement has been relaxed. Leaf pages of B-tree
        nodes (whether of the primary key or secondary indexes) only
        need to accommodate one record, but that record must fit, in
        uncompressed form, in the per-page modification log. If
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
        <code class="literal">ON</code>, MySQL checks the maximum row size during
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>. If the row does not
        fit, the following error message is issued: <code class="literal">ERROR
        HY000: Too big row</code>.
      </p><p>
        If you create a table when
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is OFF, and
        a subsequent <code class="literal">INSERT</code> or
        <code class="literal">UPDATE</code> statement attempts to create an index
        entry that does not fit in the size of the compressed page, the
        operation fails with <code class="literal">ERROR 42000: Row size too
        large</code>. (This error message does not name the index for
        which the record is too large, or mention the length of the
        index record or the maximum record size on that particular index
        page.) To solve this problem, rebuild the table with
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> and select a larger
        compressed page size (<code class="literal">KEY_BLOCK_SIZE</code>),
        shorten any column prefix indexes, or disable compression
        entirely with <code class="literal">ROW_FORMAT=DYNAMIC</code> or
        <code class="literal">ROW_FORMAT=COMPACT</code>.
      </p><p>
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is not
        applicable to general tablespaces, which also support compressed
        tables. Tablespace management rules for general tablespaces are
        strictly enforced independently of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>. For more
        information, see <a class="xref" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax">Section 13.1.21, “CREATE TABLESPACE Syntax”</a>.
</p>
<h5><a name="innodb-compression-internals-storage-blobs"></a>Compressing BLOB, VARCHAR, and TEXT Columns</h5>
<a class="indexterm" name="idm140091646633824"></a><a class="indexterm" name="idm140091646632336"></a><p>
        In an InnoDB table, <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
        <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, and
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns that are not part of
        the primary key may be stored on separately allocated
        <a class="link" href="glossary.html#glos_overflow_page" title="overflow page">overflow pages</a>. We
        refer to these columns as
        <a class="link" href="glossary.html#glos_off_page_column" title="off-page column">off-page columns</a>.
        Their values are stored on singly-linked lists of overflow
        pages.
      </p><p>
        For tables created in <code class="literal">ROW_FORMAT=DYNAMIC</code> or
        <code class="literal">ROW_FORMAT=COMPRESSED</code>, the values of
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a>, or
        <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns may be stored
        fully off-page, depending on their length and the length of the
        entire row. For columns that are stored off-page, the clustered
        index record only contains 20-byte pointers to the overflow
        pages, one per column. Whether any columns are stored off-page
        depends on the page size and the total size of the row. When the
        row is too long to fit entirely within the page of the clustered
        index, MySQL chooses the longest columns for off-page storage
        until the row fits on the clustered index page. As noted above,
        if a row does not fit by itself on a compressed page, an error
        occurs.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          For tables created in <code class="literal">ROW_FORMAT=DYNAMIC</code> or
          <code class="literal">ROW_FORMAT=COMPRESSED</code>,
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> and
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns that are less than
          or equal to 40 bytes are always stored in-line.
</p>
</div>
<p>
        Tables that use <code class="literal">ROW_FORMAT=REDUNDANT</code> and
        <code class="literal">ROW_FORMAT=COMPACT</code> store the first 768 bytes
        of <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
        <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, and
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns in the clustered
        index record along with the primary key. The 768-byte prefix is
        followed by a 20-byte pointer to the overflow pages that contain
        the rest of the column value.
      </p><p>
        When a table is in <code class="literal">COMPRESSED</code> format, all
        data written to overflow pages is compressed <span class="quote">“<span class="quote">as
        is</span>”</span>; that is, MySQL applies the zlib compression
        algorithm to the entire data item. Other than the data,
        compressed overflow pages contain an uncompressed header and
        trailer comprising a page checksum and a link to the next
        overflow page, among other things. Therefore, very significant
        storage savings can be obtained for longer
        <code class="literal">BLOB</code>, <code class="literal">TEXT</code>, or
        <code class="literal">VARCHAR</code> columns if the data is highly
        compressible, as is often the case with text data. Image data,
        such as <code class="literal">JPEG</code>, is typically already compressed
        and so does not benefit much from being stored in a compressed
        table; the double compression can waste CPU cycles for little or
        no space savings.
      </p><p>
        The overflow pages are of the same size as other pages. A row
        containing ten columns stored off-page occupies ten overflow
        pages, even if the total length of the columns is only 8K bytes.
        In an uncompressed table, ten uncompressed overflow pages occupy
        160K bytes. In a compressed table with an 8K page size, they
        occupy only 80K bytes. Thus, it is often more efficient to use
        compressed table format for tables with long column values.
      </p><p>
        For <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespaces, using a 16K compressed page size can reduce storage
        and I/O costs for <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
        <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, or
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, because such data
        often compress well, and might therefore require fewer overflow
        pages, even though the B-tree nodes themselves take as many
        pages as in the uncompressed form. General tablespaces do not
        support a 16K compressed page size
        (<code class="literal">KEY_BLOCK_SIZE</code>). For more information, see
        <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
</p>
<h5><a name="innodb-compression-internals-pool"></a>Compression and the InnoDB Buffer Pool</h5>
<a class="indexterm" name="idm140091646593888"></a><a class="indexterm" name="idm140091646592384"></a><p>
        In a compressed <code class="literal">InnoDB</code> table, every
        compressed page (whether 1K, 2K, 4K or 8K) corresponds to an
        uncompressed page of 16K bytes (or a smaller size if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> is set). To
        access the data in a page, MySQL reads the compressed page from
        disk if it is not already in the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, then
        uncompresses the page to its original form. This section
        describes how <code class="literal">InnoDB</code> manages the buffer pool
        with respect to pages of compressed tables.
      </p><p>
        To minimize I/O and to reduce the need to uncompress a page, at
        times the buffer pool contains both the compressed and
        uncompressed form of a database page. To make room for other
        required database pages, MySQL can
        <a class="link" href="glossary.html#glos_eviction" title="eviction">evict</a> from the buffer pool
        an uncompressed page, while leaving the compressed page in
        memory. Or, if a page has not been accessed in a while, the
        compressed form of the page might be written to disk, to free
        space for other data. Thus, at any given time, the buffer pool
        might contain both the compressed and uncompressed forms of the
        page, or only the compressed form of the page, or neither.
      </p><p>
        MySQL keeps track of which pages to keep in memory and which to
        evict using a least-recently-used
        (<a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a>) list, so that
        <a class="link" href="glossary.html#glos_hot" title="hot">hot</a> (frequently accessed) data
        tends to stay in memory. When compressed tables are accessed,
        MySQL uses an adaptive LRU algorithm to achieve an appropriate
        balance of compressed and uncompressed pages in memory. This
        adaptive algorithm is sensitive to whether the system is running
        in an <a class="link" href="glossary.html#glos_io_bound" title="I/O-bound">I/O-bound</a> or
        <a class="link" href="glossary.html#glos_cpu_bound" title="CPU-bound">CPU-bound</a> manner. The goal
        is to avoid spending too much processing time uncompressing
        pages when the CPU is busy, and to avoid doing excess I/O when
        the CPU has spare cycles that can be used for uncompressing
        compressed pages (that may already be in memory). When the
        system is I/O-bound, the algorithm prefers to evict the
        uncompressed copy of a page rather than both copies, to make
        more room for other disk pages to become memory resident. When
        the system is CPU-bound, MySQL prefers to evict both the
        compressed and uncompressed page, so that more memory can be
        used for <span class="quote">“<span class="quote">hot</span>”</span> pages and reducing the need to
        uncompress data in memory only in compressed form.
</p>
<h5><a name="innodb-compression-internals-log"></a>Compression and the InnoDB Redo Log Files</h5>
<a class="indexterm" name="idm140091646577568"></a><p>
        Before a compressed page is written to a
        <a class="link" href="glossary.html#glos_data_files" title="data files">data file</a>, MySQL writes a
        copy of the page to the redo log (if it has been recompressed
        since the last time it was written to the database). This is
        done to ensure that redo logs are usable for
        <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>, even
        in the unlikely case that the <code class="literal">zlib</code> library is
        upgraded and that change introduces a compatibility problem with
        the compressed data. Therefore, some increase in the size of
        <a class="link" href="glossary.html#glos_log_file" title="log file">log files</a>, or a need for
        more frequent
        <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpoints</a>, can be
        expected when using compression. The amount of increase in the
        log file size or checkpoint frequency depends on the number of
        times compressed pages are modified in a way that requires
        reorganization and recompression.
      </p><p>
        To create a compressed table in a file-per-table tablespace,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
        enabled. There is no dependence on the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting
        when creating a compressed table in a general tablespace. For
        more information, see <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-compression-oltp"></a>15.9.1.6 Compression for OLTP Workloads</h4>

</div>

</div>

</div>
<p>
        Traditionally, the <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> feature was
        recommended primarily for read-only or read-mostly
        <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>, such as in a
        <a class="link" href="glossary.html#glos_data_warehouse" title="data warehouse">data warehouse</a>
        configuration. The rise of <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a>
        storage devices, which are fast but relatively small and
        expensive, makes compression attractive also for
        <code class="literal">OLTP</code> workloads: high-traffic, interactive
        websites can reduce their storage requirements and their I/O
        operations per second (<a class="link" href="glossary.html#glos_iops" title="IOPS">IOPS</a>) by
        using compressed tables with applications that do frequent
        <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations.
      </p><p>
        These configuration options let you adjust the way compression
        works for a particular MySQL instance, with an emphasis on
        performance and scalability for write-intensive operations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_level"><code class="literal">innodb_compression_level</code></a>
            lets you turn the degree of compression up or down. A higher
            value lets you fit more data onto a storage device, at the
            expense of more CPU overhead during compression. A lower
            value lets you reduce CPU overhead when storage space is not
            critical, or you expect the data is not especially
            compressible.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct"><code class="literal">innodb_compression_failure_threshold_pct</code></a>
            specifies a cutoff point for
            <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
            failures</a> during updates to a compressed table. When
            this threshold is passed, MySQL begins to leave additional
            free space within each new compressed page, dynamically
            adjusting the amount of free space up to the percentage of
            page size specified by
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max"><code class="literal">innodb_compression_pad_pct_max</code></a>
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max"><code class="literal">innodb_compression_pad_pct_max</code></a>
            lets you adjust the maximum amount of space reserved within
            each <a class="link" href="glossary.html#glos_page" title="page">page</a> to record changes
            to compressed rows, without needing to compress the entire
            page again. The higher the value, the more changes can be
            recorded without recompressing the page. MySQL uses a
            variable amount of free space for the pages within each
            compressed table, only when a designated percentage of
            compression operations
            <span class="quote">“<span class="quote"><a class="link" href="glossary.html#glos_compression_failure" title="compression failure">fail</a></span>”</span>
            at runtime, requiring an expensive operation to split the
            compressed page.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_compressed_pages"><code class="literal">innodb_log_compressed_pages</code></a>
            lets you disable writing of images of
            <a class="link" href="glossary.html#glos_compression" title="compression">re-compressed</a>
            <a class="link" href="glossary.html#glos_page" title="page">pages</a> to the
            <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a>.
            Re-compression may occur when changes are made to compressed
            data. This option is enabled by default to prevent
            corruption that could occur if a different version of the
            <code class="literal">zlib</code> compression algorithm is used during
            recovery. If you are certain that the
            <code class="literal">zlib</code> version will not change, disable
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_compressed_pages"><code class="literal">innodb_log_compressed_pages</code></a>
            to reduce redo log generation for workloads that modify
            compressed data.
</p></li></ul>
</div>
<p>
        Because working with compressed data sometimes involves keeping
        both compressed and uncompressed versions of a page in memory at
        the same time, when using compression with an OLTP-style
        workload, be prepared to increase the value of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
        configuration option.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-compression-syntax-warnings"></a>15.9.1.7 SQL Compression Syntax Warnings and Errors</h4>

</div>

</div>

</div>
<p>
        This section describes syntax warnings and errors that you may
        encounter when using the table compression feature with
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespaces and <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespaces</a>.
</p>
<h5><a name="idm140091646529872"></a>SQL Compression Syntax Warnings and Errors for File-Per-Table
Tablespaces</h5>
<p>
        When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
        enabled (the default), specifying
        <code class="literal">ROW_FORMAT=COMPRESSED</code> or
        <code class="literal">KEY_BLOCK_SIZE</code> in <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a> or <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        statements produces the following error if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
        disabled.
      </p><pre data-lang="terminal" class="programlisting">
ERROR 1031 (HY000): Table storage engine for 't1' doesn't have this option
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The table is not created if the current configuration does not
          permit using compressed tables.
</p>
</div>
<p>
        When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
        disabled, specifying <code class="literal">ROW_FORMAT=COMPRESSED</code> or
        <code class="literal">KEY_BLOCK_SIZE</code> in <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE
        TABLE</code></a> or <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        statements produces the following warnings if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
        disabled.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW WARNINGS;</code></strong>
+---------+------+---------------------------------------------------------------+
| Level   | Code | Message                                                       |
+---------+------+---------------------------------------------------------------+
| Warning | 1478 | InnoDB: KEY_BLOCK_SIZE requires innodb_file_per_table.        |
| Warning | 1478 | InnoDB: ignoring KEY_BLOCK_SIZE=4.                            |
| Warning | 1478 | InnoDB: ROW_FORMAT=COMPRESSED requires innodb_file_per_table. |
| Warning | 1478 | InnoDB: assuming ROW_FORMAT=DYNAMIC.                          |
+---------+------+---------------------------------------------------------------+
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          These messages are only warnings, not errors, and the table is
          created without compression, as if the options were not
          specified.
</p>
</div>
<p>
        The <span class="quote">“<span class="quote">non-strict</span>”</span> behavior lets you import a
        <code class="literal">mysqldump</code> file into a database that does not
        support compressed tables, even if the source database contained
        compressed tables. In that case, MySQL creates the table in
        <code class="literal">ROW_FORMAT=DYNAMIC</code> instead of preventing the
        operation.
      </p><p>
        To import the dump file into a new database, and have the tables
        re-created as they exist in the original database, ensure the
        server has the proper setting for the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        configuration parameter.
      </p><p>
        The attribute <code class="literal">KEY_BLOCK_SIZE</code> is permitted
        only when <code class="literal">ROW_FORMAT</code> is specified as
        <code class="literal">COMPRESSED</code> or is omitted. Specifying a
        <code class="literal">KEY_BLOCK_SIZE</code> with any other
        <code class="literal">ROW_FORMAT</code> generates a warning that you can
        view with <code class="literal">SHOW WARNINGS</code>. However, the table
        is non-compressed; the specified
        <code class="literal">KEY_BLOCK_SIZE</code> is ignored).
</p>
<div class="informaltable">
<table summary="Warning level, error code, and message text for messages that could be generated when using conflicting clauses for InnoDB table compression."><col width="20%"><col width="20%"><col width="60%"><thead><tr>
            <th scope="col">Level</th>
            <th scope="col">Code</th>
            <th scope="col">Message</th>
          </tr></thead><tbody><tr>
            <td scope="row">Warning</td>
            <td>1478</td>
            <td><code class="literal"> InnoDB: ignoring KEY_BLOCK_SIZE=<em class="replaceable"><code>n</code></em>
              unless ROW_FORMAT=COMPRESSED. </code></td>
</tr></tbody></table>
</div>
<p>
        If you are running with
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> enabled, the
        combination of a <code class="literal">KEY_BLOCK_SIZE</code> with any
        <code class="literal">ROW_FORMAT</code> other than
        <code class="literal">COMPRESSED</code> generates an error, not a warning,
        and the table is not created.
      </p><p>
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-create-and-alter-options-table" title="Table 15.13 ROW_FORMAT and KEY_BLOCK_SIZE Options">Table 15.13, “ROW_FORMAT and KEY_BLOCK_SIZE Options”</a>
        provides an overview the <code class="literal">ROW_FORMAT</code> and
        <code class="literal">KEY_BLOCK_SIZE</code> options that are used with
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
</p>
<div class="table">
<a name="innodb-compression-create-and-alter-options-table"></a><p class="title"><b>Table 15.13 ROW_FORMAT and KEY_BLOCK_SIZE Options</b></p>
<div class="table-contents">
<table summary="ROW_FORMAT and KEY_BLOCK_SIZE option usage notes and descriptions."><col width="20%"><col width="40%"><col width="40%"><thead><tr>
            <th scope="col">Option</th>
            <th scope="col">Usage Notes</th>
            <th scope="col">Description</th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">ROW_FORMAT=​REDUNDANT</code></td>
            <td>Storage format used prior to MySQL 5.0.3</td>
            <td>Less efficient than <code class="literal">ROW_FORMAT=COMPACT</code>; for backward
              compatibility</td>
          </tr><tr>
            <td scope="row"><code class="literal">ROW_FORMAT=​COMPACT</code></td>
            <td>Default storage format since MySQL 5.0.3</td>
            <td>Stores a prefix of 768 bytes of long column values in the clustered
              index page, with the remaining bytes stored in an overflow
              page</td>
          </tr><tr>
            <td scope="row"><code class="literal">ROW_FORMAT=​DYNAMIC</code></td>
            <td></td>
            <td>Store values within the clustered index page if they fit; if not, stores
              only a 20-byte pointer to an overflow page (no prefix)</td>
          </tr><tr>
            <td scope="row"><code class="literal">ROW_FORMAT=​COMPRESSED</code></td>
            <td></td>
            <td>Compresses the table and indexes using zlib</td>
          </tr><tr>
            <td scope="row"><code class="literal">KEY_BLOCK_​SIZE=<em class="replaceable"><code>n</code></em></code></td>
            <td></td>
            <td>Specifies compressed page size of 1, 2, 4, 8 or 16 kilobytes; implies
              <code class="literal">ROW_FORMAT=COMPRESSED</code>. For general
              tablespaces, a <code class="literal">KEY_BLOCK_SIZE</code> value
              equal to the <code class="literal">InnoDB</code> page size is not
              permitted.</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        <a class="xref" href="innodb-storage-engine.html#innodb-compression-create-and-alter-errors-table" title="Table 15.14 CREATE/ALTER TABLE Warnings and Errors when InnoDB Strict Mode is OFF">Table 15.14, “CREATE/ALTER TABLE Warnings and Errors when InnoDB Strict Mode is OFF”</a>
        summarizes error conditions that occur with certain combinations
        of configuration parameters and options on the
        <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements, and how
        the options appear in the output of <code class="literal">SHOW TABLE
        STATUS</code>.
      </p><p>
        When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
        <code class="literal">OFF</code>, MySQL creates or alters the table, but
        ignores certain settings as shown below. You can see the warning
        messages in the MySQL error log. When
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
        <code class="literal">ON</code>, these specified combinations of options
        generate errors, and the table is not created or altered. To see
        the full description of the error condition, issue the
        <code class="literal">SHOW ERRORS</code> statement: example:

</p><pre class="screen">
mysql&gt; <strong class="userinput"><code>CREATE TABLE x (id INT PRIMARY KEY, c INT)
</code></strong>
-&gt; <strong class="userinput"><code>ENGINE=INNODB KEY_BLOCK_SIZE=33333;
</code></strong>
ERROR 1005 (HY000): Can't create table 'test.x' (errno: 1478)

mysql&gt; <strong class="userinput"><code>SHOW ERRORS;</code></strong>
+-------+------+-------------------------------------------+
| Level | Code | Message                                   |
+-------+------+-------------------------------------------+
| Error | 1478 | InnoDB: invalid KEY_BLOCK_SIZE=33333.     |
| Error | 1005 | Can't create table 'test.x' (errno: 1478) |
+-------+------+-------------------------------------------+
</pre><p>
</p>
<div class="table">
<a name="innodb-compression-create-and-alter-errors-table"></a><p class="title"><b>Table 15.14 CREATE/ALTER TABLE Warnings and Errors when InnoDB Strict Mode is OFF</b></p>
<div class="table-contents">
<table summary="CREATE and ALTER TABLE warnings and errors when InnoDB strict mode is OFF."><col width="33%"><col width="33%"><col width="33%"><thead><tr>
            <th scope="col">Syntax</th>
            <th scope="col">Warning or Error Condition</th>
            <th scope="col">Resulting <code class="literal">ROW_FORMAT</code>, as shown in <code class="literal">SHOW TABLE
              STATUS</code></th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">ROW_FORMAT=REDUNDANT</code></td>
            <td>None</td>
            <td><code class="literal">REDUNDANT</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">ROW_FORMAT=COMPACT</code></td>
            <td>None</td>
            <td><code class="literal">COMPACT</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">ROW_FORMAT=COMPRESSED</code> or
              <code class="literal">ROW_FORMAT=DYNAMIC</code> or
              <code class="literal">KEY_BLOCK_SIZE</code> is specified</td>
            <td>Ignored for file-per-table tablespaces unless
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
              enabled. General tablespaces support all row formats. See
              <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.</td>
            <td><code class="literal">the default row format for file-per-table tablespaces; the
              specified row format for general tablespaces</code></td>
          </tr><tr>
            <td scope="row">Invalid <code class="literal">KEY_BLOCK_SIZE</code> is specified (not 1, 2, 4, 8
              or 16)</td>
            <td><code class="literal">KEY_BLOCK_SIZE</code> is ignored</td>
            <td>the specified row format, or the default row format</td>
          </tr><tr>
            <td scope="row"><code class="literal">ROW_FORMAT=COMPRESSED</code> and valid
              <code class="literal">KEY_BLOCK_SIZE</code> are specified</td>
            <td>None; <code class="literal">KEY_BLOCK_SIZE</code> specified is used</td>
            <td><code class="literal">COMPRESSED</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">KEY_BLOCK_SIZE</code> is specified with
              <code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code>
              or <code class="literal">DYNAMIC</code> row format</td>
            <td><code class="literal">KEY_BLOCK_SIZE</code> is ignored</td>
            <td><code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code> or
              <code class="literal">DYNAMIC</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">ROW_FORMAT</code> is not one of
              <code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code>,
              <code class="literal">DYNAMIC</code> or
              <code class="literal">COMPRESSED</code></td>
            <td>Ignored if recognized by the MySQL parser. Otherwise, an error is
              issued.</td>
            <td>the default row format or N/A</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        When <code class="literal">innodb_strict_mode</code> is
        <code class="literal">ON</code>, MySQL rejects invalid
        <code class="literal">ROW_FORMAT</code> or
        <code class="literal">KEY_BLOCK_SIZE</code> parameters and issues errors.
        Strict mode is <code class="literal">ON</code> by default. When
        <code class="literal">innodb_strict_mode</code> is <code class="literal">OFF</code>,
        MySQL issues warnings instead of errors for ignored invalid
        parameters.
      </p><p>
        It is not possible to see the chosen
        <code class="literal">KEY_BLOCK_SIZE</code> using <code class="literal">SHOW TABLE
        STATUS</code>. The statement <code class="literal">SHOW CREATE
        TABLE</code> displays the <code class="literal">KEY_BLOCK_SIZE</code>
        (even if it was ignored when creating the table). The real
        compressed page size of the table cannot be displayed by MySQL.
</p>
<h5><a name="idm140091646375088"></a>SQL Compression Syntax Warnings and Errors for General Tablespaces</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If <code class="literal">FILE_BLOCK_SIZE</code> was not defined for
            the general tablespace when the tablespace was created, the
            tablespace cannot contain compressed tables. If you attempt
            to add a compressed table, an error is returned, as shown in
            the following example:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLESPACE `ts1` ADD DATAFILE 'ts1.ibd' Engine=InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (c1 INT PRIMARY KEY) TABLESPACE ts1 ROW_FORMAT=COMPRESSED</code></strong>
       <strong class="userinput"><code>KEY_BLOCK_SIZE=8;</code></strong>
ERROR 1478 (HY000): InnoDB: Tablespace `ts1` cannot contain a COMPRESSED table
</pre></li><li class="listitem"><p>
            Attempting to add a table with an invalid
            <code class="literal">KEY_BLOCK_SIZE</code> to a general tablespace
            returns an error, as shown in the following example:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLESPACE `ts2` ADD DATAFILE 'ts2.ibd' FILE_BLOCK_SIZE = 8192 Engine=InnoDB;</code></strong>
  
mysql&gt; <strong class="userinput"><code>CREATE TABLE t2 (c1 INT PRIMARY KEY) TABLESPACE ts2 ROW_FORMAT=COMPRESSED</code></strong>
       <strong class="userinput"><code>KEY_BLOCK_SIZE=4;</code></strong>
ERROR 1478 (HY000): InnoDB: Tablespace `ts2` uses block size 8192 and cannot
contain a table with physical page size 4096</pre><p>
            For general tablespaces, the
            <code class="literal">KEY_BLOCK_SIZE</code> of the table must be equal
            to the <code class="literal">FILE_BLOCK_SIZE</code> of the tablespace
            divided by 1024. For example, if the
            <code class="literal">FILE_BLOCK_SIZE</code> of the tablespace is
            8192, the <code class="literal">KEY_BLOCK_SIZE</code> of the table
            must be 8.
          </p></li><li class="listitem"><p>
            Attempting to add a table with an uncompressed row format to
            a general tablespace configured to store compressed tables
            returns an error, as shown in the following example:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLESPACE `ts3` ADD DATAFILE 'ts3.ibd' FILE_BLOCK_SIZE = 8192 Engine=InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE t3 (c1 INT PRIMARY KEY) TABLESPACE ts3 ROW_FORMAT=COMPACT;</code></strong>
ERROR 1478 (HY000): InnoDB: Tablespace `ts3` uses block size 8192 and cannot
contain a table with physical page size 16384</pre></li></ul>
</div>
<p>
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is not
        applicable to general tablespaces. Tablespace management rules
        for general tablespaces are strictly enforced independently of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>. For more
        information, see <a class="xref" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax">Section 13.1.21, “CREATE TABLESPACE Syntax”</a>.
      </p><p>
        For more information about using compressed tables with general
        tablespaces, see <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-page-compression"></a>15.9.2 InnoDB Page Compression</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091646350592"></a><a class="indexterm" name="idm140091646349520"></a><p>
      <code class="literal">InnoDB</code> supports page-level compression for
      tables that reside in
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespaces. This feature is referred to as <span class="emphasis"><em>Transparent
      Page Compression</em></span>. Page compression is enabled by
      specifying the <code class="literal">COMPRESSION</code> attribute with
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>. Supported compression
      algorithms include <code class="literal">Zlib</code> and
      <code class="literal">LZ4</code>.
</p>
<h4><a name="idm140091646341312"></a>Supported Platforms</h4>
<p>
      Page compression requires sparse file and hole punching support.
      Page compression is supported on Windows with NTFS, and on the
      following subset of MySQL-supported Linux platforms where the
      kernel level provides hole punching support:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          RHEL 7 and derived distributions that use kernel version
          3.10.0-123 or higher
        </p></li><li class="listitem"><p>
          OEL 5.10 (UEK2) kernel version 2.6.39 or higher
        </p></li><li class="listitem"><p>
          OEL 6.5 (UEK3) kernel version 3.8.13 or higher
        </p></li><li class="listitem"><p>
          OEL 7.0 kernel version 3.8.13 or higher
        </p></li><li class="listitem"><p>
          SLE11 kernel version 3.0-x
        </p></li><li class="listitem"><p>
          SLE12 kernel version 3.12-x
        </p></li><li class="listitem"><p>
          OES11 kernel version 3.0-x
        </p></li><li class="listitem"><p>
          Ubuntu 14.0.4 LTS kernel version 3.13 or higher
        </p></li><li class="listitem"><p>
          Ubuntu 12.0.4 LTS kernel version 3.2 or higher
        </p></li><li class="listitem"><p>
          Debian 7 kernel version 3.2 or higher
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        All of the available file systems for a given Linux distribution
        may not support hole punching.
</p>
</div>
<h4><a name="idm140091646330192"></a>How Page Compression Works</h4>
<p>
      When a page is written, it is compressed using the specified
      compression algorithm. The compressed data is written to disk,
      where the hole punching mechanism releases empty blocks from the
      end of the page. If compression fails, data is written out as-is.
</p>
<h4><a name="idm140091646328784"></a>Hole Punch Size on Linux</h4>
<p>
      On Linux systems, the file system block size is the unit size used
      for hole punching. Therefore, page compression only works if page
      data can be compressed to a size that is less than or equal to the
      <code class="literal">InnoDB</code> page size minus the file system block
      size. For example, if
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size=16K</code></a> and the file
      system block size is 4K, page data must compress to less than or
      equal to 12K to make hole punching possible.
</p>
<h4><a name="idm140091646325296"></a>Hole Punch Size on Windows</h4>
<p>
      On Windows systems, the underlying infrastructure for sparse files
      is based on NTFS compression. Hole punching size is the NTFS
      compression unit, which is 16 times the NTFS cluster size. Cluster
      sizes and their compression units are shown in the following
      table:
</p>
<div class="table">
<a name="idm140091646323872"></a><p class="title"><b>Table 15.15 Windows NTFS Cluster Size and Compression Units</b></p>
<div class="table-contents">
<table frame="all" summary="Windows NTFS cluster size and compression units."><col width="50%"><col width="50%"><thead><tr>
          <th scope="col">Cluster Size</th>
          <th scope="col">Compression Unit</th>
        </tr></thead><tbody><tr>
          <td scope="row">512 Bytes</td>
          <td>8 KB</td>
        </tr><tr>
          <td scope="row">1 KB</td>
          <td>16 KB</td>
        </tr><tr>
          <td scope="row">2 KB</td>
          <td>32 KB</td>
        </tr><tr>
          <td scope="row">4 KB</td>
          <td>64 KB</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      Page compression on Windows systems only works if page data can be
      compressed to a size that is less than or equal to the
      <code class="literal">InnoDB</code> page size minus the compression unit
      size.
    </p><p>
      The default NTFS cluster size is 4KB, for which the compression
      unit size is 64KB. This means that page compression has no benefit
      for an out-of-the box Windows NTFS configuration, as the maximum
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> is also 64KB.
    </p><p>
      For page compression to work on Windows, the file system must be
      created with a cluster size smaller than 4K, and the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> must be at least
      twice the size of the compression unit. For example, for page
      compression to work on Windows, you could build the file system
      with a cluster size of 512 Bytes (which has a compression unit of
      8KB) and initialize <code class="literal">InnoDB</code> with an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value of 16K or
      greater.
</p>
<h4><a name="idm140091646300800"></a>Enabling Page Compression</h4>
<p>
      To enable page compression, specify the
      <code class="literal">COMPRESSION</code> attribute in the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. For
      example:
    </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (c1 INT) COMPRESSION="zlib";
</pre><p>
      You can also enable page compression in an
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. However,
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
      COMPRESSION</code></a> only updates the tablespace compression
      attribute. Writes to the tablespace that occur after setting the
      new compression algorithm use the new setting, but to apply the
      new compression algorithm to existing pages, you must rebuild the
      table using <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>.
    </p><pre data-lang="sql" class="programlisting">
ALTER TABLE t1 COMPRESSION="zlib";
OPTIMIZE TABLE t1;
</pre>
<h4><a name="idm140091646291280"></a>Disabling Page Compression</h4>
<p>
      To disable page compression, set
      <code class="literal">COMPRESSION=None</code> using
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>. Writes to the
      tablespace that occur after setting
      <code class="literal">COMPRESSION=None</code> no longer use page
      compression. To uncompress existing pages, you must rebuild the
      table using <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> after
      setting <code class="literal">COMPRESSION=None</code>.
    </p><pre data-lang="sql" class="programlisting">
ALTER TABLE t1 COMPRESSION="None";
OPTIMIZE TABLE t1;
</pre>
<h4><a name="idm140091646284384"></a>Page Compression Metadata</h4>
<p>
      Page compression metadata is found in the
      <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TABLESPACES</code></a>
      table, in the following columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">FS_BLOCK_SIZE</code>: The file system block size,
          which is the unit size used for hole punching.
        </p></li><li class="listitem"><p>
          <code class="literal">FILE_SIZE</code>: The apparent size of the file,
          which represents the maximum size of the file, uncompressed.
        </p></li><li class="listitem"><p>
          <code class="literal">ALLOCATED_SIZE</code>: The actual size of the
          file, which is the amount of space allocated on disk.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        On Unix-like systems, <code class="literal">ls -l
        <em class="replaceable"><code>tablespace_name.ibd</code></em></code> shows
        the apparent file size (equivalent to
        <code class="literal">FILE_SIZE</code>) in bytes. To view the actual
        amount of space allocated on disk (equivalent to
        <code class="literal">ALLOCATED_SIZE</code>), use <code class="literal">du
        --block-size=1
        <em class="replaceable"><code>tablespace_name.ibd</code></em></code>. The
        <code class="literal">--block-size=1</code> option prints the allocated
        space in bytes instead of blocks, so that it can be compared to
        <code class="literal">ls -l</code> output.
      </p><p>
        Use <a class="link" href="sql-syntax.html#show-create-table" title="13.7.6.10 SHOW CREATE TABLE Syntax"><code class="literal">SHOW CREATE TABLE</code></a> to view the
        current page compression setting (<code class="literal">Zlib</code>,
        <code class="literal">Lz4</code>, or <code class="literal">None</code>). A table may
        contain a mix of pages with different compression settings.
</p>
</div>
<p>
      In the following example, page compression metadata for the
      employees table is retrieved from the
      <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TABLESPACES</code></a>
      table.
    </p><pre data-lang="sql" class="programlisting">
# Create the employees table with Zlib page compression

CREATE TABLE employees (
    emp_no      INT             NOT NULL,
    birth_date  DATE            NOT NULL,
    first_name  VARCHAR(14)     NOT NULL,
    last_name   VARCHAR(16)     NOT NULL,
    gender      ENUM ('M','F')  NOT NULL,  
    hire_date   DATE            NOT NULL,
    PRIMARY KEY (emp_no)
) COMPRESSION="zlib";

# Insert data (not shown)
  
# Query page compression metadata in INFORMATION_SCHEMA.INNODB_TABLESPACES
  
mysql&gt; <strong class="userinput"><code>SELECT SPACE, NAME, FS_BLOCK_SIZE, FILE_SIZE, ALLOCATED_SIZE FROM</code></strong>
       <strong class="userinput"><code>INFORMATION_SCHEMA.INNODB_TABLESPACES WHERE NAME='employees/employees'\G</code></strong>
*************************** 1. row ***************************
SPACE: 45
NAME: employees/employees
FS_BLOCK_SIZE: 4096
FILE_SIZE: 23068672
ALLOCATED_SIZE: 19415040
</pre><p>
      Page compression metadata for the employees table shows that the
      apparent file size is 23068672 bytes while the actual file size
      (with page compression) is 19415040 bytes. The file system block
      size is 4096 bytes, which is the block size used for hole
      punching.
</p>
<h4><a name="idm140091646260848"></a>Page Compression Limitations and Usage Notes</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Page compression is disabled if the file system block size (or
          compression unit size on Windows) * 2 &gt;
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>.
        </p></li><li class="listitem"><p>
          Page compression is not supported for tables that reside in
          shared tablespaces, which include the system tablespace,
          temporary tablespaces, and general tablespaces.
        </p></li><li class="listitem"><p>
          Page compression is not supported for undo log tablespaces.
        </p></li><li class="listitem"><p>
          Page compression is not supported for redo log pages.
        </p></li><li class="listitem"><p>
          R-tree pages, which are used for spatial indexes, are not
          compressed.
        </p></li><li class="listitem"><p>
          Pages that belong to compressed tables
          (<code class="literal">ROW_FORMAT=COMPRESSED</code>) are left as-is.
        </p></li><li class="listitem"><p>
          During recovery, updated pages are written out in an
          uncompressed form.
        </p></li><li class="listitem"><p>
          Loading a page-compressed tablespace on a server that does not
          support the compression algorithm that was used causes an I/O
          error.
        </p></li><li class="listitem"><p>
          Before downgrading to an earlier version of MySQL that does
          not support page compression, uncompress the tables that use
          the page compression feature. To uncompress a table, run
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          COMPRESSION=None</code></a> and <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a>.
        </p></li><li class="listitem"><p>
          Page-compressed tablespaces can be copied between Linux and
          Windows servers if the compression algorithm that was used is
          available on both servers.
        </p></li><li class="listitem"><p>
          Preserving page compression when moving a page-compressed
          tablespace file from one host to another requires a utility
          that preserves sparse files.
        </p></li><li class="listitem"><p>
          Better page compression may be achieved on Fusion-io hardware
          with NVMFS than on other platforms, as NVMFS is designed to
          take advantage of punch hole functionality.
        </p></li><li class="listitem"><p>
          Using the page compression feature with a large
          <code class="literal">InnoDB</code> page size and relatively small file
          system block size could result in write amplification. For
          example, a maximum <code class="literal">InnoDB</code> page size of 64KB
          with a 4KB file system block size may improve compression but
          may also increase demand on the buffer pool, leading to
          increased I/O and potential write amplification.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-row-format"></a>15.10 InnoDB Row Formats</h2>

</div>

</div>

</div>
<p>
    The row format of a table determines how its rows are physically
    stored, which in turn can affect the performance of queries and DML
    operations. As more rows fit into a single disk page, queries and
    index lookups can work faster, less cache memory is required in the
    buffer pool, and less I/O is required to write out updated values.
  </p><p>
    The data in each table is divided into pages. The pages that make up
    each table are arranged in a tree data structure called a B-tree
    index. Table data and secondary indexes both use this type of
    structure. The B-tree index that represents an entire table is known
    as the clustered index, which is organized according to the primary
    key columns. The nodes of a clustered index data structure contain
    the values of all columns in the row. The nodes of a secondary index
    structure contain the values of index columns and primary key
    columns.
  </p><p>
    Variable-length columns are an exception to the rule that column
    values are stored in B-tree index nodes. Variable-length columns
    that are too long to fit on a B-tree page are stored on separately
    allocated disk pages called overflow pages. Such columns are
    referred to as off-page columns. The values of off-page columns are
    stored in singly-linked lists of overflow pages, with each such
    column having its own list of one or more overflow pages. Depending
    on column length, all or a prefix of variable-length column values
    are stored in the B-tree to avoid wasting storage and having to read
    a separate page.
  </p><p>
    The <code class="literal">InnoDB</code> storage engine supports four row
    formats: <code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code>,
    <code class="literal">DYNAMIC</code>, and <code class="literal">COMPRESSED</code>.
</p>
<div class="table">
<a name="innodb-row-format-overview"></a><p class="title"><b>Table 15.16 InnoDB Row Format Overview</b></p>
<div class="table-contents">
<table summary="Overview of InnoDB row formats incuding a description, supported features, and supported tablespace types."><col width="10%"><col width="18%"><col width="18%"><col width="18%"><col width="18%"><col width="18%"><thead><tr>
        <th scope="col">Row Format</th>
        <th scope="col">Compact Storage Characteristics</th>
        <th scope="col">Enhanced Variable-Length Column Storage</th>
        <th scope="col">Large Index Key Prefix Support</th>
        <th scope="col">Compression Support</th>
        <th scope="col">Supported Tablespace Types</th>
      </tr></thead><tbody><tr>
        <td scope="row"><code class="literal">REDUNDANT</code></td>
        <td>No</td>
        <td>No</td>
        <td>No</td>
        <td>No</td>
        <td>system, file-per-table, general</td>
      </tr><tr>
        <td scope="row"><code class="literal">COMPACT</code></td>
        <td>Yes</td>
        <td>No</td>
        <td>No</td>
        <td>No</td>
        <td>system, file-per-table, general</td>
      </tr><tr>
        <td scope="row"><code class="literal">DYNAMIC</code></td>
        <td>Yes</td>
        <td>Yes</td>
        <td>Yes</td>
        <td>No</td>
        <td>system, file-per-table, general</td>
      </tr><tr>
        <td scope="row"><code class="literal">COMPRESSED</code></td>
        <td>Yes</td>
        <td>Yes</td>
        <td>Yes</td>
        <td>Yes</td>
        <td>file-per-table, general</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
    The topics that follow describe row format storage characteristics
    and how to define and determine the row format of a table.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-row-format-redundant" title="REDUNDANT Row Format">REDUNDANT Row Format</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-row-format-compact" title="COMPACT Row Format">COMPACT Row Format</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-row-format-dynamic" title="DYNAMIC Row Format">DYNAMIC Row Format</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-row-format-compressed" title="COMPRESSED Row Format">COMPRESSED Row Format</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-row-format-defining" title="Defining the Row Format of a Table">Defining the Row Format of a Table</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-row-format-detrmining" title="Determining the Row Format of a Table">Determining the Row Format of a Table</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h3 class="title"><a name="innodb-row-format-redundant"></a>REDUNDANT Row Format</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091646185664"></a><a class="indexterm" name="idm140091646184176"></a><p>
      The <code class="literal">REDUNDANT</code> format provides compatibility
      with older versions of MySQL.
    </p><p>
      Tables that use the <code class="literal">REDUNDANT</code> row format store
      the first 768 bytes of variable-length column values
      (<a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
      <a class="link" href="data-types.html#binary-varbinary" title="11.4.2 The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a>, and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> types) in the index record
      within the B-tree node, with the remainder stored on overflow
      pages. Fixed-length columns greater than or equal to 768 bytes are
      encoded as variable-length columns, which can be stored off-page.
      For example, a <code class="literal">CHAR(255)</code> column can exceed 768
      bytes if the maximum byte length of the character set is greater
      than 3, as it is with <code class="literal">utf8mb4</code>.
    </p><p>
      If the value of a column is 768 bytes or less, an overflow page is
      not used, and some savings in I/O may result, since the value is
      stored entirely in the B-tree node. This works well for relatively
      short <code class="literal">BLOB</code> column values, but may cause B-tree
      nodes to fill with data rather than key values, reducing their
      efficiency. Tables with many <code class="literal">BLOB</code> columns could
      cause B-tree nodes to become too full, and contain too few rows,
      making the entire index less efficient than if rows were shorter
      or column values were stored off-page.
</p>
<h4><a name="innodb-redundant-row-format-characteristics"></a>REDUNDANT Row Format Storage Characteristics</h4>
<a class="indexterm" name="idm140091646170352"></a><p>
      The <code class="literal">REDUNDANT</code> row format has the following
      storage characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Each index record contains a 6-byte header. The header is used
          to link together consecutive records, and for row-level
          locking.
        </p></li><li class="listitem"><p>
          Records in the clustered index contain fields for all
          user-defined columns. In addition, there is a 6-byte
          transaction ID field and a 7-byte roll pointer field.
        </p></li><li class="listitem"><p>
          If no primary key is defined for a table, each clustered index
          record also contains a 6-byte row ID field.
        </p></li><li class="listitem"><p>
          Each secondary index record contains all the primary key
          columns defined for the clustered index key that are not in
          the secondary index.
        </p></li><li class="listitem"><p>
          A record contains a pointer to each field of the record. If
          the total length of the fields in a record is less than 128
          bytes, the pointer is one byte; otherwise, two bytes. The
          array of pointers is called the record directory. The area
          where the pointers point is the data part of the record.
        </p></li><li class="listitem"><p>
          Internally, fixed-length character columns such as
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(10)</code></a> in stored in
          fixed-length format. Trailing spaces are not truncated from
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
        </p></li><li class="listitem"><p>
          Fixed-length columns greater than or equal to 768 bytes are
          encoded as variable-length columns, which can be stored
          off-page. For example, a <code class="literal">CHAR(255)</code> column
          can exceed 768 bytes if the maximum byte length of the
          character set is greater than 3, as it is with
          <code class="literal">utf8mb4</code>.
        </p></li><li class="listitem"><p>
          An SQL <code class="literal">NULL</code> value reserves one or two bytes
          in the record directory. An SQL <code class="literal">NULL</code> value
          reserves zero bytes in the data part of the record if stored
          in a variable-length column. For a fixed-length column, the
          fixed length of the column is reserved in the data part of the
          record. Reserving fixed space for <code class="literal">NULL</code>
          values permits columns to be updated in place from
          <code class="literal">NULL</code> to non-<code class="literal">NULL</code> values
          without causing index page fragmentation.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="innodb-row-format-compact"></a>COMPACT Row Format</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091646150256"></a><a class="indexterm" name="idm140091646148768"></a><p>
      The <code class="literal">COMPACT</code> row format reduces row storage
      space by about 20% compared to the <code class="literal">REDUNDANT</code>
      row format, at the cost of increasing CPU use for some operations.
      If your workload is a typical one that is limited by cache hit
      rates and disk speed, <code class="literal">COMPACT</code> format is likely
      to be faster. If the workload is limited by CPU speed, compact
      format might be slower.
    </p><p>
      Tables that use the <code class="literal">COMPACT</code> row format store
      the first 768 bytes of variable-length column values
      (<a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
      <a class="link" href="data-types.html#binary-varbinary" title="11.4.2 The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a>, and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> types) in the index record
      within the <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> node, with
      the remainder stored on overflow pages. Fixed-length columns
      greater than or equal to 768 bytes are encoded as variable-length
      columns, which can be stored off-page. For example, a
      <code class="literal">CHAR(255)</code> column can exceed 768 bytes if the
      maximum byte length of the character set is greater than 3, as it
      is with <code class="literal">utf8mb4</code>.
    </p><p>
      If the value of a column is 768 bytes or less, an overflow page is
      not used, and some savings in I/O may result, since the value is
      stored entirely in the B-tree node. This works well for relatively
      short <code class="literal">BLOB</code> column values, but may cause B-tree
      nodes to fill with data rather than key values, reducing their
      efficiency. Tables with many <code class="literal">BLOB</code> columns could
      cause B-tree nodes to become too full, and contain too few rows,
      making the entire index less efficient than if rows were shorter
      or column values were stored off-page.
</p>
<h4><a name="innodb-compact-row-format-characteristics"></a>COMPACT Row Format Storage Characteristics</h4>
<a class="indexterm" name="idm140091646132432"></a><p>
      The <code class="literal">COMPACT</code> row format has the following
      storage characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Each index record contains a 5-byte header that may be
          preceded by a variable-length header. The header is used to
          link together consecutive records, and for row-level locking.
        </p></li><li class="listitem"><p>
          The variable-length part of the record header contains a bit
          vector for indicating <code class="literal">NULL</code> columns. If the
          number of columns in the index that can be
          <code class="literal">NULL</code> is <em class="replaceable"><code>N</code></em>, the
          bit vector occupies
          <code class="literal">CEILING(<em class="replaceable"><code>N</code></em>/8)</code>
          bytes. (For example, if there are anywhere from 9 to 16
          columns that can be <code class="literal">NULL</code>, the bit vector
          uses two bytes.) Columns that are <code class="literal">NULL</code> do
          not occupy space other than the bit in this vector. The
          variable-length part of the header also contains the lengths
          of variable-length columns. Each length takes one or two
          bytes, depending on the maximum length of the column. If all
          columns in the index are <code class="literal">NOT NULL</code> and have
          a fixed length, the record header has no variable-length part.
        </p></li><li class="listitem"><p>
          For each non-<code class="literal">NULL</code> variable-length field,
          the record header contains the length of the column in one or
          two bytes. Two bytes are only needed if part of the column is
          stored externally in overflow pages or the maximum length
          exceeds 255 bytes and the actual length exceeds 127 bytes. For
          an externally stored column, the 2-byte length indicates the
          length of the internally stored part plus the 20-byte pointer
          to the externally stored part. The internal part is 768 bytes,
          so the length is 768+20. The 20-byte pointer stores the true
          length of the column.
        </p></li><li class="listitem"><p>
          The record header is followed by the data contents of
          non-<code class="literal">NULL</code> columns.
        </p></li><li class="listitem"><p>
          Records in the clustered index contain fields for all
          user-defined columns. In addition, there is a 6-byte
          transaction ID field and a 7-byte roll pointer field.
        </p></li><li class="listitem"><p>
          If no primary key is defined for a table, each clustered index
          record also contains a 6-byte row ID field.
        </p></li><li class="listitem"><p>
          Each secondary index record contains all the primary key
          columns defined for the clustered index key that are not in
          the secondary index. If any of the primary key columns are
          variable length, the record header for each secondary index
          has a variable-length part to record their lengths, even if
          the secondary index is defined on fixed-length columns.
        </p></li><li class="listitem"><p>
          Internally, for nonvariable-length character sets,
          fixed-length character columns such as
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(10)</code></a> are stored in a
          fixed-length format.
        </p><p>
          Trailing spaces are not truncated from
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
        </p></li><li class="listitem"><p>
          Internally, for variable-length character sets such as
          <code class="literal">utf8mb3</code> and <code class="literal">utf8mb4</code>,
          <code class="literal">InnoDB</code> attempts to store
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
          in <em class="replaceable"><code>N</code></em> bytes by trimming trailing
          spaces. If the byte length of a
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
          column value exceeds <em class="replaceable"><code>N</code></em> bytes,
          trailing spaces are trimmed to a minimum of the column value
          byte length. The maximum length of a
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
          column is the maximum character byte length ×
          <em class="replaceable"><code>N</code></em>.
        </p><p>
          A minimum of <em class="replaceable"><code>N</code></em> bytes is reserved
          for
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>.
          Reserving the minimum space <em class="replaceable"><code>N</code></em> in
          many cases enables column updates to be done in place without
          causing index page fragmentation. By comparison,
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
          columns occupy the maximum character byte length ×
          <em class="replaceable"><code>N</code></em> when using the
          <code class="literal">REDUNDANT</code> row format.
        </p><p>
          Fixed-length columns greater than or equal to 768 bytes are
          encoded as variable-length fields, which can be stored
          off-page. For example, a <code class="literal">CHAR(255)</code> column
          can exceed 768 bytes if the maximum byte length of the
          character set is greater than 3, as it is with
          <code class="literal">utf8mb4</code>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="innodb-row-format-dynamic"></a>DYNAMIC Row Format</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091646092048"></a><a class="indexterm" name="idm140091646090560"></a><p>
      The <code class="literal">DYNAMIC</code> row format offers the same storage
      characteristics as the <code class="literal">COMPACT</code> row format but
      adds enhanced storage capabilities for long variable-length
      columns and supports large index key prefixes.
    </p><p>
      When a table is created with
      <code class="literal">ROW_FORMAT=DYNAMIC</code>, <code class="literal">InnoDB</code>
      can store long variable-length column values (for
      <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
      <a class="link" href="data-types.html#binary-varbinary" title="11.4.2 The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a>, and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> types) fully off-page, with
      the clustered index record containing only a 20-byte pointer to
      the overflow page. Fixed-length fields greater than or equal to
      768 bytes are encoded as variable-length fields. For example, a
      <code class="literal">CHAR(255)</code> column can exceed 768 bytes if the
      maximum byte length of the character set is greater than 3, as it
      is with <code class="literal">utf8mb4</code>.
    </p><p>
      Whether columns are stored off-page depends on the page size and
      the total size of the row. When a row is too long, the longest
      columns are chosen for off-page storage until the clustered index
      record fits on the <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> page.
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns that are less than or
      equal to 40 bytes are stored in line.
    </p><p>
      The <code class="literal">DYNAMIC</code> row format maintains the efficiency
      of storing the entire row in the index node if it fits (as do the
      <code class="literal">COMPACT</code> and <code class="literal">REDUNDANT</code>
      formats), but the <code class="literal">DYNAMIC</code> row format avoids the
      problem of filling B-tree nodes with a large number of data bytes
      of long columns. The <code class="literal">DYNAMIC</code> row format is
      based on the idea that if a portion of a long data value is stored
      off-page, it is usually most efficient to store the entire value
      off-page. With <code class="literal">DYNAMIC</code> format, shorter columns
      are likely to remain in the B-tree node, minimizing the number of
      overflow pages required for a given row.
    </p><p>
      The <code class="literal">DYNAMIC</code> row format supports index key
      prefixes up to 3072 bytes.
    </p><p>
      Tables that use the <code class="literal">DYNAMIC</code> row format can be
      stored in the system tablespace, file-per-table tablespaces, and
      general tablespaces. To store <code class="literal">DYNAMIC</code> tables in
      the system tablespace, either disable
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and use a
      regular <code class="literal">CREATE TABLE</code> or <code class="literal">ALTER
      TABLE</code> statement, or use the <code class="literal">TABLESPACE [=]
      innodb_system</code> table option with <code class="literal">CREATE
      TABLE</code> or <code class="literal">ALTER TABLE</code>. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> variable is
      not applicable to general tablespaces, nor is it applicable when
      using the <code class="literal">TABLESPACE [=] innodb_system</code> table
      option to store <code class="literal">DYNAMIC</code> tables in the system
      tablespace.
</p>
<h4><a name="innodb-dynamic-row-format-characteristics"></a>DYNAMIC Row Format Storage Characteristics</h4>
<a class="indexterm" name="idm140091646057392"></a><p>
      The <code class="literal">DYNAMIC</code> row format is a variation of the
      <code class="literal">COMPACT</code> row format. For storage
      characteristics, see
      <a class="xref" href="innodb-storage-engine.html#innodb-compact-row-format-characteristics" title="COMPACT Row Format Storage Characteristics">COMPACT Row Format Storage Characteristics</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="innodb-row-format-compressed"></a>COMPRESSED Row Format</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091646051920"></a><a class="indexterm" name="idm140091646050432"></a><p>
      The <code class="literal">COMPRESSED</code> row format offers the same
      storage characteristics and capabilities as the
      <code class="literal">DYNAMIC</code> row format but adds support for table
      and index data compression.
    </p><p>
      The <code class="literal">COMPRESSED</code> row format uses similar internal
      details for off-page storage as the <code class="literal">DYNAMIC</code> row
      format, with additional storage and performance considerations
      from the table and index data being compressed and using smaller
      page sizes. With the <code class="literal">COMPRESSED</code> row format, the
      <code class="literal">KEY_BLOCK_SIZE</code> option controls how much column
      data is stored in the clustered index, and how much is placed on
      overflow pages. For more information about the
      <code class="literal">COMPRESSED</code> row format, see
      <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="15.9 InnoDB Table and Page Compression">Section 15.9, “InnoDB Table and Page Compression”</a>.
    </p><p>
      The <code class="literal">COMPRESSED</code> row format supports index key
      prefixes up to 3072 bytes.
    </p><p>
      Tables that use the <code class="literal">COMPRESSED</code> row format can
      be created in file-per-table tablespaces or general tablespaces.
      The system tablespace does not support the
      <code class="literal">COMPRESSED</code> row format. To store a
      <code class="literal">COMPRESSED</code> table in a file-per-table
      tablespace, the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> variable
      must be enabled. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> variable is
      not applicable to general tablespaces. General tablespaces support
      all row formats with the caveat that compressed and uncompressed
      tables cannot coexist in the same general tablespace due to
      different physical page sizes. For more information, see
      <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
</p>
<h4><a name="innodb-compressed-row-format-characteristics"></a>Compressed Row Format Storage Characteristics</h4>
<a class="indexterm" name="idm140091646033664"></a><p>
      The <code class="literal">COMPRESSED</code> row format is a variation of the
      <code class="literal">COMPACT</code> row format. For storage
      characteristics, see
      <a class="xref" href="innodb-storage-engine.html#innodb-compact-row-format-characteristics" title="COMPACT Row Format Storage Characteristics">COMPACT Row Format Storage Characteristics</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="innodb-row-format-defining"></a>Defining the Row Format of a Table</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091646028224"></a><a class="indexterm" name="idm140091646026736"></a><a class="indexterm" name="idm140091646025248"></a><p>
      The default row format for <code class="literal">InnoDB</code> tables is
      defined by
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
      variable, which has a default value of <code class="literal">DYNAMIC</code>.
      The default row format is used when the
      <code class="literal">ROW_FORMAT</code> table option is not defined
      explicitly or when <code class="literal">ROW_FORMAT=DEFAULT</code> is
      specified.
    </p><p>
      The row format of a table can be defined explicitly using the
      <code class="literal">ROW_FORMAT</code> table option in a
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. For example:
    </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (c1 INT) ROW_FORMAT=DYNAMIC;
</pre><p>
      An explicitly defined <code class="literal">ROW_FORMAT</code> setting
      overrides the default row format. Specifying
      <code class="literal">ROW_FORMAT=DEFAULT</code> is equivalent to using the
      implicit default.
    </p><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
      variable can be set dynamically:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_default_row_format=DYNAMIC;</code></strong>
</pre><p>
      Valid <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
      options include <code class="literal">DYNAMIC</code>,
      <code class="literal">COMPACT</code>, and <code class="literal">REDUNDANT</code>. The
      <code class="literal">COMPRESSED</code> row format, which is not supported
      for use in the system tablespace, cannot be defined as the
      default. It can only be specified explicitly in a
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. Attempting
      to set the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
      variable to <code class="literal">COMPRESSED</code> returns an error:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_default_row_format=COMPRESSED;</code></strong>
ERROR 1231 (42000): Variable 'innodb_default_row_format'
can't be set to the value of 'COMPRESSED'
</pre><p>
      Newly created tables use the row format defined by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
      variable when a <code class="literal">ROW_FORMAT</code> option is not
      specified explicitly, or when
      <code class="literal">ROW_FORMAT=DEFAULT</code> is used. For example, the
      following <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements
      use the row format defined by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
      variable.
    </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (c1 INT);
</pre><pre data-lang="sql" class="programlisting">
CREATE TABLE t2 (c1 INT) ROW_FORMAT=DEFAULT;
</pre><p>
      When a <code class="literal">ROW_FORMAT</code> option is not specified
      explicitly, or when <code class="literal">ROW_FORMAT=DEFAULT</code> is used,
      an operation that rebuilds a table silently changes the row format
      of the table to the format defined by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
      variable.
    </p><p>
      Table-rebuilding operations include <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> operations that use
      <code class="literal">ALGORITHM=COPY</code> or
      <code class="literal">ALGORITHM=INPLACE</code> where table rebuilding is
      required. See <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-operations" title="15.12.1 Online DDL Operations">Section 15.12.1, “Online DDL Operations”</a> for
      more information. <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> is
      also a table-rebuilding operation.
    </p><p>
      The following example demonstrates a table-rebuilding operation
      that silently changes the row format of a table created without an
      explicitly defined row format.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@innodb_default_row_format;</code></strong>
+-----------------------------+
| @@innodb_default_row_format |
+-----------------------------+
| dynamic                     |
+-----------------------------+

mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (c1 INT);</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME LIKE 'test/t1' \G</code></strong>
*************************** 1. row ***************************
     TABLE_ID: 54
         NAME: test/t1
         FLAG: 33
       N_COLS: 4
        SPACE: 35
   ROW_FORMAT: Dynamic
ZIP_PAGE_SIZE: 0
   SPACE_TYPE: Single

mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_default_row_format=COMPACT;</code></strong>

mysql&gt; <strong class="userinput"><code>ALTER TABLE t1 ADD COLUMN (c2 INT);</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME LIKE 'test/t1' \G</code></strong>
*************************** 1. row ***************************
     TABLE_ID: 55
         NAME: test/t1
         FLAG: 1
       N_COLS: 5
        SPACE: 36
   ROW_FORMAT: Compact
ZIP_PAGE_SIZE: 0
   SPACE_TYPE: Single
</pre><p>
      Consider the following potential issues before changing the row
      format of existing tables from <code class="literal">REDUNDANT</code> or
      <code class="literal">COMPACT</code> to <code class="literal">DYNAMIC</code>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">REDUNDANT</code> and
          <code class="literal">COMPACT</code> row formats support a maximum index
          key prefix length of 767 bytes whereas
          <code class="literal">DYNAMIC</code> and <code class="literal">COMPRESSED</code>
          row formats support an index key prefix length of 3072 bytes.
          In a replication environment, if the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          variable is set to <code class="literal">DYNAMIC</code> on the master,
          and set to <code class="literal">COMPACT</code> on the slave, the
          following DDL statement, which does not explicitly define a
          row format, succeeds on the master but fails on the slave:
        </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 VARCHAR(5000), KEY i1(c2(3070)));
</pre><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="15.6.1.6 Limits on InnoDB Tables">Section 15.6.1.6, “Limits on InnoDB Tables”</a>.
        </p></li><li class="listitem"><p>
          Importing a table that does not explicitly define a row format
          results in a schema mismatch error if the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          setting on the source server differs from the setting on the
          destination server. For more information, refer to the
          limitations outlined in <a class="xref" href="innodb-storage-engine.html#tablespace-copying" title="15.6.3.7 Copying Tablespaces to Another Instance">Section 15.6.3.7, “Copying Tablespaces to Another Instance”</a>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="innodb-row-format-detrmining"></a>Determining the Row Format of a Table</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091645959024"></a><p>
      To determine the row format of a table, use
      <a class="link" href="sql-syntax.html#show-table-status" title="13.7.6.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a>:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW TABLE STATUS IN test1\G</code></strong>
*************************** 1. row ***************************
           Name: t1
         Engine: InnoDB
        Version: 10
     Row_format: Dynamic
           Rows: 0
 Avg_row_length: 0
    Data_length: 16384
Max_data_length: 0
   Index_length: 16384
      Data_free: 0
 Auto_increment: 1
    Create_time: 2016-09-14 16:29:38
    Update_time: NULL
     Check_time: NULL
      Collation: utf8mb4_0900_ai_ci
       Checksum: NULL
 Create_options: 
        Comment: 
</pre><p>
      Alternatively, query the
      <a class="link" href="information-schema.html#innodb-tables-table" title="25.39.24 The INFORMATION_SCHEMA INNODB_TABLES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TABLES</code></a>
      table:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT NAME, ROW_FORMAT FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME='test1/t1';</code></strong>
+----------+------------+
| NAME     | ROW_FORMAT |
+----------+------------+
| test1/t1 | Dynamic    |
+----------+------------+
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-disk-management"></a>15.11 InnoDB Disk I/O and File Space Management</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-disk-io">15.11.1 InnoDB Disk I/O</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-space">15.11.2 File Space Management</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-checkpoints">15.11.3 InnoDB Checkpoints</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-defragmenting">15.11.4 Defragmenting a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-truncate-table-reclaim-space">15.11.5 Reclaiming Disk Space with TRUNCATE TABLE</a></span></dt></dl>
</div>
<p>
    As a DBA, you must manage disk I/O to keep the I/O subsystem from
    becoming saturated, and manage disk space to avoid filling up
    storage devices. The <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> design
    model requires a certain amount of I/O that might seem redundant,
    but helps to ensure data reliability. Within these constraints,
    <code class="literal">InnoDB</code> tries to optimize the database work and
    the organization of disk files to minimize the amount of disk I/O.
    Sometimes, I/O is postponed until the database is not busy, or until
    everything needs to be brought to a consistent state, such as during
    a database restart after a <a class="link" href="glossary.html#glos_fast_shutdown" title="fast shutdown">fast
    shutdown</a>.
  </p><p>
    This section discusses the main considerations for I/O and disk
    space with the default kind of MySQL tables (also known as
    <code class="literal">InnoDB</code> tables):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Controlling the amount of background I/O used to improve query
        performance.
      </p></li><li class="listitem"><p>
        Enabling or disabling features that provide extra durability at
        the expense of additional I/O.
      </p></li><li class="listitem"><p>
        Organizing tables into many small files, a few larger files, or
        a combination of both.
      </p></li><li class="listitem"><p>
        Balancing the size of redo log files against the I/O activity
        that occurs when the log files become full.
      </p></li><li class="listitem"><p>
        How to reorganize a table for optimal query performance.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-disk-io"></a>15.11.1 InnoDB Disk I/O</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091645938112"></a><p>
      <code class="literal">InnoDB</code> uses asynchronous disk I/O where
      possible, by creating a number of threads to handle I/O
      operations, while permitting other database operations to proceed
      while the I/O is still in progress. On Linux and Windows
      platforms, <code class="literal">InnoDB</code> uses the available OS and
      library functions to perform <span class="quote">“<span class="quote">native</span>”</span> asynchronous
      I/O. On other platforms, <code class="literal">InnoDB</code> still uses I/O
      threads, but the threads may actually wait for I/O requests to
      complete; this technique is known as <span class="quote">“<span class="quote">simulated</span>”</span>
      asynchronous I/O.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-disk-io-read-ahead"></a>Read-Ahead</h4>
</div>
</div>
</div>
<p>
        If <code class="literal">InnoDB</code> can determine there is a high
        probability that data might be needed soon, it performs
        read-ahead operations to bring that data into the buffer pool so
        that it is available in memory. Making a few large read requests
        for contiguous data can be more efficient than making several
        small, spread-out requests. There are two read-ahead heuristics
        in <code class="literal">InnoDB</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            In sequential read-ahead, if <code class="literal">InnoDB</code>
            notices that the access pattern to a segment in the
            tablespace is sequential, it posts in advance a batch of
            reads of database pages to the I/O system.
          </p></li><li class="listitem"><p>
            In random read-ahead, if <code class="literal">InnoDB</code> notices
            that some area in a tablespace seems to be in the process of
            being fully read into the buffer pool, it posts the
            remaining reads to the I/O system.
</p></li></ul>
</div>
<p>
        For information about configuring read-ahead heuristics, see
        <a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="15.8.3.4 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)">Section 15.8.3.4, “Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-disk-io-doublewrite"></a>Doublewrite Buffer</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091645922992"></a><a class="indexterm" name="idm140091645921920"></a><p>
        <code class="literal">InnoDB</code> uses a novel file flush technique
        involving a structure called the
        <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
        buffer</a>, which is enabled by default in most cases
        (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite=ON</code></a>). It
        adds safety to recovery following a crash or power outage, and
        improves performance on most varieties of Unix by reducing the
        need for <code class="literal">fsync()</code> operations.
      </p><p>
        Before writing pages to a data file, <code class="literal">InnoDB</code>
        first writes them to a contiguous tablespace area called the
        doublewrite buffer. Only after the write and the flush to the
        doublewrite buffer has completed does <code class="literal">InnoDB</code>
        write the pages to their proper positions in the data file. If
        there is an operating system, storage subsystem, or
        <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process crash in the middle of a page
        write (causing a <a class="link" href="glossary.html#glos_torn_page" title="torn page">torn page</a>
        condition), <code class="literal">InnoDB</code> can later find a good copy
        of the page from the doublewrite buffer during recovery.
      </p><p>
        If system tablespace files (<span class="quote">“<span class="quote">ibdata files</span>”</span>) are
        located on Fusion-io devices that support atomic writes,
        doublewrite buffering is automatically disabled and Fusion-io
        atomic writes are used for all data files. Because the
        doublewrite buffer setting is global, doublewrite buffering is
        also disabled for data files residing on non-Fusion-io hardware.
        This feature is only supported on Fusion-io hardware and is only
        enabled for Fusion-io NVMFS on Linux. To take full advantage of
        this feature, an
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> setting of
        <code class="literal">O_DIRECT</code> is recommended.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-space"></a>15.11.2 File Space Management</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091645906656"></a><p>
      The data files that you define in the configuration file using the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
      configuration option form the <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      The files are logically concatenated to form the system
      tablespace. There is no striping in use. You cannot define where
      within the system tablespace your tables are allocated. In a newly
      created system tablespace, <code class="literal">InnoDB</code> allocates
      space starting from the first data file.
    </p><p>
      To avoid the issues that come with storing all tables and indexes
      inside the system tablespace, you can enable the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      configuration option (the default), which stores each newly
      created table in a separate tablespace file (with extension
      <code class="literal">.ibd</code>). For tables stored this way, there is
      less fragmentation within the disk file, and when the table is
      truncated, the space is returned to the operating system rather
      than still being reserved by InnoDB within the system tablespace.
      For more information, see
      <a class="xref" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="15.6.3.2 File-Per-Table Tablespaces">Section 15.6.3.2, “File-Per-Table Tablespaces”</a>.
    </p><p>
      You can also store tables in
      <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
      tablespaces</a>. General tablespaces are shared tablespaces
      created using <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE TABLESPACE</code></a>
      syntax. They can be created outside of the MySQL data directory,
      are capable of holding multiple tables, and support tables of all
      row formats. For more information, see
      <a class="xref" href="innodb-storage-engine.html#general-tablespaces" title="15.6.3.3 General Tablespaces">Section 15.6.3.3, “General Tablespaces”</a>.
</p>
<h4><a name="idm140091645893904"></a>Pages, Extents, Segments, and Tablespaces</h4>
<p>
      Each tablespace consists of database
      <a class="link" href="glossary.html#glos_page" title="page">pages</a>. Every tablespace in a
      MySQL instance has the same <a class="link" href="glossary.html#glos_page_size" title="page size">page
      size</a>. By default, all tablespaces have a page size of 16KB;
      you can reduce the page size to 8KB or 4KB by specifying the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> option when you
      create the MySQL instance. You can also increase the page size to
      32KB or 64KB. For more information, refer to the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> documentation.
    </p><p>
      The pages are grouped into
      <a class="link" href="glossary.html#glos_extent" title="extent">extents</a> of size 1MB for pages
      up to 16KB in size (64 consecutive 16KB pages, or 128 8KB pages,
      or 256 4KB pages). For a page size of 32KB, extent size is 2MB.
      For page size of 64KB, extent size is 4MB. The
      <span class="quote">“<span class="quote">files</span>”</span> inside a tablespace are called
      <a class="link" href="glossary.html#glos_segment" title="segment">segments</a> in
      <code class="literal">InnoDB</code>. (These segments are different from the
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segment</a>,
      which actually contains many tablespace segments.)
    </p><p>
      When a segment grows inside the tablespace,
      <code class="literal">InnoDB</code> allocates the first 32 pages to it one
      at a time. After that, <code class="literal">InnoDB</code> starts to
      allocate whole extents to the segment. <code class="literal">InnoDB</code>
      can add up to 4 extents at a time to a large segment to ensure
      good sequentiality of data.
    </p><p>
      Two segments are allocated for each index in
      <code class="literal">InnoDB</code>. One is for nonleaf nodes of the
      <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a>, the other is for the
      leaf nodes. Keeping the leaf nodes contiguous on disk enables
      better sequential I/O operations, because these leaf nodes contain
      the actual table data.
    </p><p>
      Some pages in the tablespace contain bitmaps of other pages, and
      therefore a few extents in an <code class="literal">InnoDB</code> tablespace
      cannot be allocated to segments as a whole, but only as individual
      pages.
    </p><p>
      When you ask for available free space in the tablespace by issuing
      a <a class="link" href="sql-syntax.html#show-table-status" title="13.7.6.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> statement,
      <code class="literal">InnoDB</code> reports the extents that are definitely
      free in the tablespace. <code class="literal">InnoDB</code> always reserves
      some extents for cleanup and other internal purposes; these
      reserved extents are not included in the free space.
    </p><p>
      When you delete data from a table, <code class="literal">InnoDB</code>
      contracts the corresponding B-tree indexes. Whether the freed
      space becomes available for other users depends on whether the
      pattern of deletes frees individual pages or extents to the
      tablespace. Dropping a table or deleting all rows from it is
      guaranteed to release the space to other users, but remember that
      deleted rows are physically removed only by the
      <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation, which happens
      automatically some time after they are no longer needed for
      transaction rollbacks or consistent reads. (See
      <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="15.3 InnoDB Multi-Versioning">Section 15.3, “InnoDB Multi-Versioning”</a>.)
</p>
<h4><a name="idm140091645870864"></a>How Pages Relate to Table Rows</h4>
<p>
      The maximum row length is slightly less than half a database page
      for 4KB, 8KB, 16KB, and 32KB
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> settings. For
      example, the maximum row length is slightly less than 8KB for the
      default 16KB <code class="literal">InnoDB</code> page size. For 64KB pages,
      the maximum row length is slightly less than 16KB.
    </p><p>
      If a row does not exceed the maximum row length, all of it is
      stored locally within the page. If a row exceeds the maximum row
      length, <a class="link" href="glossary.html#glos_variable_length_type" title="variable-length type">variable-length
      columns</a> are chosen for external off-page storage until the
      row fits within the maximum row length limit. External off-page
      storage for variable-length columns differs by row format:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="emphasis"><em>COMPACT and REDUNDANT Row Formats</em></span>
        </p><p>
          When a variable-length column is chosen for external off-page
          storage, <code class="literal">InnoDB</code> stores the first 768 bytes
          locally in the row, and the rest externally into overflow
          pages. Each such column has its own list of overflow pages.
          The 768-byte prefix is accompanied by a 20-byte value that
          stores the true length of the column and points into the
          overflow list where the rest of the value is stored. See
          <a class="xref" href="innodb-storage-engine.html#innodb-row-format" title="15.10 InnoDB Row Formats">Section 15.10, “InnoDB Row Formats”</a>.
        </p></li><li class="listitem"><p>
          <span class="emphasis"><em>DYNAMIC and COMPRESSED Row Formats</em></span>
        </p><p>
          When a variable-length column is chosen for external off-page
          storage, <code class="literal">InnoDB</code> stores a 20-byte pointer
          locally in the row, and the rest externally into overflow
          pages. See <a class="xref" href="innodb-storage-engine.html#innodb-row-format" title="15.10 InnoDB Row Formats">Section 15.10, “InnoDB Row Formats”</a>.
</p></li></ul>
</div>
<p>
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGBLOB</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGTEXT</code></a> columns
      must be less than 4GB, and the total row length, including
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, must be less than
      4GB.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-checkpoints"></a>15.11.3 InnoDB Checkpoints</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091645852064"></a><p>
      Making your <a class="link" href="glossary.html#glos_log_file" title="log file">log files</a> very
      large may reduce disk I/O during
      <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpointing</a>. It often
      makes sense to set the total size of the log files as large as the
      buffer pool or even larger.
</p>
<h4><a name="idm140091645848352"></a>How Checkpoint Processing Works</h4>
<p>
      <code class="literal">InnoDB</code> implements a
      <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpoint</a> mechanism known
      as <a class="link" href="glossary.html#glos_fuzzy_checkpointing" title="fuzzy checkpointing">fuzzy
      checkpointing</a>. <code class="literal">InnoDB</code> flushes modified
      database pages from the buffer pool in small batches. There is no
      need to flush the buffer pool in one single batch, which would
      disrupt processing of user SQL statements during the checkpointing
      process.
    </p><p>
      During <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>,
      <code class="literal">InnoDB</code> looks for a checkpoint label written to
      the log files. It knows that all modifications to the database
      before the label are present in the disk image of the database.
      Then <code class="literal">InnoDB</code> scans the log files forward from
      the checkpoint, applying the logged modifications to the database.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-defragmenting"></a>15.11.4 Defragmenting a Table</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091645839424"></a><a class="indexterm" name="idm140091645837520"></a><p>
      Random insertions into or deletions from a secondary index can
      cause the index to become fragmented. Fragmentation means that the
      physical ordering of the index pages on the disk is not close to
      the index ordering of the records on the pages, or that there are
      many unused pages in the 64-page blocks that were allocated to the
      index.
    </p><p>
      One symptom of fragmentation is that a table takes more space than
      it <span class="quote">“<span class="quote">should</span>”</span> take. How much that is exactly, is
      difficult to determine. All <code class="literal">InnoDB</code> data and
      indexes are stored in <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-trees</a>,
      and their <a class="link" href="glossary.html#glos_fill_factor" title="fill factor">fill factor</a> may
      vary from 50% to 100%. Another symptom of fragmentation is that a
      table scan such as this takes more time than it
      <span class="quote">“<span class="quote">should</span>”</span> take:
    </p><pre data-lang="sql" class="programlisting">
SELECT COUNT(*) FROM t WHERE <em class="replaceable"><code>non_indexed_column</code></em> &lt;&gt; 12345;
</pre><p>
      The preceding query requires MySQL to perform a full table scan,
      the slowest type of query for a large table.
    </p><p>
      To speed up index scans, you can periodically perform a
      <span class="quote">“<span class="quote">null</span>”</span> <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      operation, which causes MySQL to rebuild the table:
    </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ENGINE=INNODB
</pre><p>
      You can also use
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
      <em class="replaceable"><code>tbl_name</code></em> FORCE</code></a> to perform a
      <span class="quote">“<span class="quote">null</span>”</span> alter operation that rebuilds the table.
    </p><p>
      Both <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
      <em class="replaceable"><code>tbl_name</code></em> ENGINE=INNODB</code></a> and
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
      <em class="replaceable"><code>tbl_name</code></em> FORCE</code></a> use
      <a class="link" href="innodb-storage-engine.html#innodb-online-ddl" title="15.12 InnoDB and Online DDL">online DDL</a>. For more
      information, see <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl" title="15.12 InnoDB and Online DDL">Section 15.12, “InnoDB and Online DDL”</a>.
    </p><p>
      Another way to perform a defragmentation operation is to use
      <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to dump the table to a text file,
      drop the table, and reload it from the dump file.
    </p><p>
      If the insertions into an index are always ascending and records
      are deleted only from the end, the <code class="literal">InnoDB</code>
      filespace management algorithm guarantees that fragmentation in
      the index does not occur.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-truncate-table-reclaim-space"></a>15.11.5 Reclaiming Disk Space with TRUNCATE TABLE</h3>

</div>

</div>

</div>
<p>
      To reclaim operating system disk space when
      <a class="link" href="glossary.html#glos_truncate" title="truncate">truncating</a> an
      <code class="literal">InnoDB</code> table, the table must be stored in its
      own <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd</a> file. For a table to
      be stored in its own <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd</a>
      file, <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must
      enabled when the table is created. Additionally, there cannot be a
      <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign key</a> constraint
      between the table being truncated and other tables, otherwise the
      <code class="literal">TRUNCATE TABLE</code> operation fails. A foreign key
      constraint between two columns in the same table, however, is
      permitted.
    </p><p>
      When a table is truncated, it is dropped and re-created in a new
      <code class="filename">.ibd</code> file, and the freed space is returned to
      the operating system. This is in contrast to truncating
      <code class="literal">InnoDB</code> tables that are stored within the
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>
      (tables created when <code class="literal">innodb_file_per_table=OFF</code>)
      and tables stored in shared
      <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
      tablespaces</a>, where only <code class="literal">InnoDB</code> can use
      the freed space after the table is truncated.
    </p><p>
      The ability to truncate tables and return disk space to the
      operating system also means that
      <a class="link" href="glossary.html#glos_physical_backup" title="physical backup">physical backups</a> can
      be smaller. Truncating tables that are stored in the system
      tablespace (tables created when
      <code class="literal">innodb_file_per_table=OFF</code>) or in a general
      tablespace leaves blocks of unused space in the tablespace.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-online-ddl"></a>15.12 InnoDB and Online DDL</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-operations">15.12.1 Online DDL Operations</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-performance">15.12.2 Online DDL Performance and Concurrency</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-space-requirements">15.12.3 Online DDL Space Requirements</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-single-multi">15.12.4 Simplifying DDL Statements with Online DDL</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-failure-conditions">15.12.5 Online DDL Failure Conditions</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-online-ddl-limitations">15.12.6 Online DDL Limitations</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091645796752"></a><a class="indexterm" name="idm140091645795680"></a><p>
    The online DDL feature provides support for instant and in-place
    table alterations and concurrent DML. Benefits of this feature
    include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Improved responsiveness and availability in busy production
        environments, where making a table unavailable for minutes or
        hours is not practical.
      </p></li><li class="listitem"><p>
        For in-place operations, the ability to adjust the balance
        between performance and concurrency during DDL operations using
        the <code class="literal">LOCK</code> clause. See
        <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-locking-options" title="The LOCK clause">The LOCK clause</a>.
      </p></li><li class="listitem"><p>
        Less disk space usage and I/O overhead than the table-copy
        method.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
      <code class="literal">ALGORITHM=INSTANT</code> support is available for
      <code class="literal">ADD COLUMN</code> and other operations in MySQL
      8.0.12.
</p>
</div>
<p>
    Typically, you do not need to do anything special to enable online
    DDL. By default, MySQL performs the operation instantly or in place,
    as permitted, with as little locking as possible.
  </p><p>
    You can control aspects of a DDL operation using the
    <code class="literal">ALGORITHM</code> and <code class="literal">LOCK</code> clauses of
    the <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. These
    clauses are placed at the end of the statement, separated from the
    table and column specifications by commas. For example:
  </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ADD PRIMARY KEY (<em class="replaceable"><code>column</code></em>), ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
    The <code class="literal">LOCK</code> clause may be used for operations that
    are performed in place and is useful for fine-tuning the degree of
    concurrent access to the table during operations. Only
    <code class="literal">LOCK=DEFAULT</code> is supported for operations that are
    performed instantly. The <code class="literal">ALGORITHM</code> clause is
    primarily intended for performance comparisons and as a fallback to
    the older table-copying behavior in case you encounter any issues.
    For example:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        To avoid accidentally making the table unavailable for reads,
        writes, or both, during an in-place <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> operation, specify a clause on the
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement such as
        <code class="literal">LOCK=NONE</code> (permit reads and writes) or
        <code class="literal">LOCK=SHARED</code> (permit reads). The operation
        halts immediately if the requested level of concurrency is not
        available.
      </p></li><li class="listitem"><p>
        To compare performance between algorithms, run a statement with
        <code class="literal">ALGORITHM=INSTANT</code>,
        <code class="literal">ALGORITHM=INPLACE</code> and
        <code class="literal">ALGORITHM=COPY</code>. You can also run a statement
        with the <a class="link" href="server-administration.html#sysvar_old_alter_table"><code class="literal">old_alter_table</code></a>
        configuration option enabled to force the use of
        <code class="literal">ALGORITHM=COPY</code>.
      </p></li><li class="listitem"><p>
        To avoid tying up the server with an <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> operation that copies the table, include
        <code class="literal">ALGORITHM=INSTANT</code> or
        <code class="literal">ALGORITHM=INPLACE</code>. The statement halts
        immediately if it cannot use the specified algorithm.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-online-ddl-operations"></a>15.12.1 Online DDL Operations</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091645762736"></a><p>
      Online support details, syntax examples, and usage notes for DDL
      operations are provided under the following topics in this
      section.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#online-ddl-index-operations" title="Index Operations">Index Operations</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#online-ddl-primary-key-operations" title="Primary Key Operations">Primary Key Operations</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#online-ddl-column-operations" title="Column Operations">Column Operations</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#online-ddl-generated-column-operations" title="Generated Column Operations">Generated Column Operations</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#online-ddl-foreign-key-operations" title="Foreign Key Operations">Foreign Key Operations</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#online-ddl-table-operations" title="Table Operations">Table Operations</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#online-ddl-tablespace-operations" title="Tablespace Operations">Tablespace Operations</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#online-ddl-partitioning" title="Partitioning Operations">Partitioning Operations</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="online-ddl-index-operations"></a>Index Operations</h4>

</div>

</div>

</div>
<p>
        The following table provides an overview of online DDL support
        for index operations. An asterisk indicates additional
        information, an exception, or a dependency. For details, see
        <a class="xref" href="innodb-storage-engine.html#online-ddl-index-syntax-notes" title="Syntax and Usage Notes">Syntax and Usage Notes</a>.
</p>
<div class="table">
<a name="online-ddl-index-operations-table"></a><p class="title"><b>Table 15.17 Online DDL Support for Index Operations</b></p>
<div class="table-contents">
<table summary="Online DDL support for index operations indicating whether the operation is performed in place, rebuilds the table, permits concurrent DML, or only modifies metadata."><col width="16%" align="left"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><thead><tr>
            <th scope="col">Operation</th>
            <th scope="col">Instant</th>
            <th scope="col">In Place</th>
            <th scope="col">Rebuilds Table</th>
            <th scope="col">Permits Concurrent DML</th>
            <th scope="col">Only Modifies Metadata</th>
          </tr></thead><tbody><tr>
            <td scope="row">Creating or adding a secondary index</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Dropping an index</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row">Renaming an index</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row">Adding a <code class="literal">FULLTEXT</code> index</td>
            <td>No</td>
            <td>Yes*</td>
            <td>No*</td>
            <td>No</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Adding a <code class="literal">SPATIAL</code> index</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>No</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Changing the index type</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<h5><a name="online-ddl-index-syntax-notes"></a>Syntax and Usage Notes</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Creating or adding a secondary index
          </p><pre data-lang="sql" class="programlisting">
CREATE INDEX <em class="replaceable"><code>name</code></em> ON <em class="replaceable"><code>table</code></em> (<em class="replaceable"><code>col_list</code></em>);
</pre><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ADD INDEX <em class="replaceable"><code>name</code></em> (<em class="replaceable"><code>col_list</code></em>);
</pre><p>
            The table remains available for read and write operations
            while the index is being created. The
            <a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statement only
            finishes after all transactions that are accessing the table
            are completed, so that the initial state of the index
            reflects the most recent contents of the table.
          </p><p>
            Online DDL support for adding secondary indexes means that
            you can generally speed the overall process of creating and
            loading a table and associated indexes by creating the table
            without secondary indexes, then adding secondary indexes
            after the data is loaded.
          </p><p>
            A newly created secondary index contains only the committed
            data in the table at the time the
            <a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> or
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement
            finishes executing. It does not contain any uncommitted
            values, old versions of values, or values marked for
            deletion but not yet removed from the old index.
          </p><p>
            Some factors affect the performance, space usage, and
            semantics of this operation. For details, see
            <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-limitations" title="15.12.6 Online DDL Limitations">Section 15.12.6, “Online DDL Limitations”</a>.
          </p></li><li class="listitem"><p>
            Dropping an index
          </p><pre data-lang="sql" class="programlisting">
DROP INDEX <em class="replaceable"><code>name</code></em> ON <em class="replaceable"><code>table</code></em>;
</pre><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DROP INDEX <em class="replaceable"><code>name</code></em>;
</pre><p>
            The table remains available for read and write operations
            while the index is being dropped. The
            <a class="link" href="sql-syntax.html#drop-index" title="13.1.27 DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a> statement only
            finishes after all transactions that are accessing the table
            are completed, so that the initial state of the index
            reflects the most recent contents of the table.
          </p></li><li class="listitem"><p>
            Renaming an index
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> RENAME INDEX <em class="replaceable"><code>old_index_name</code></em> TO <em class="replaceable"><code>new_index_name</code></em>, ALGORITHM=INPLACE, LOCK=NONE;      
</pre></li><li class="listitem"><p>
            Adding a <code class="literal">FULLTEXT</code> index
          </p><pre data-lang="sql" class="programlisting">
CREATE FULLTEXT INDEX <em class="replaceable"><code>name</code></em> ON table(<em class="replaceable"><code>column</code></em>);          
</pre><p>
            Adding the first <code class="literal">FULLTEXT</code> index rebuilds
            the table if there is no user-defined
            <code class="literal">FTS_DOC_ID</code> column. Additional
            <code class="literal">FULLTEXT</code> indexes may be added without
            rebuilding the table.
          </p></li><li class="listitem"><p>
            Adding a <code class="literal">SPATIAL</code> index
          </p><pre data-lang="sql" class="programlisting">
CREATE TABLE geom (g GEOMETRY NOT NULL);
ALTER TABLE geom ADD SPATIAL INDEX(g), ALGORITHM=INPLACE, LOCK=SHARED;          
</pre><p>
            Adding the first <code class="literal">FULLTEXT</code> index rebuilds
            the table if there is no user-defined
            <code class="literal">FTS_DOC_ID</code> column. Additional
            <code class="literal">FULLTEXT</code> indexes may be added without
            rebuilding the table.
          </p></li><li class="listitem"><p>
            Changing the index type (<code class="literal">USING {BTREE |
            HASH}</code>)
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DROP INDEX i1, ADD INDEX i1(<em class="replaceable"><code>key_part,...</code></em>) USING BTREE, ALGORITHM=INSTANT;
</pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="online-ddl-primary-key-operations"></a>Primary Key Operations</h4>

</div>

</div>

</div>
<p>
        The following table provides an overview of online DDL support
        for primary key operations. An asterisk indicates additional
        information, an exception, or a dependency. See
        <a class="xref" href="innodb-storage-engine.html#online-ddl-primary-key-syntax-notes" title="Syntax and Usage Notes">Syntax and Usage Notes</a>.
</p>
<div class="table">
<a name="online-ddl-primary-key-operations-table"></a><p class="title"><b>Table 15.18 Online DDL Support for Primary Key Operations</b></p>
<div class="table-contents">
<table summary="Online DDL support for primary key operations indicating whether the operation is performed in place, rebuilds the table, permits concurrent DML, or only modifies metadata."><col width="16%" align="left"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><thead><tr>
            <th scope="col">Operation</th>
            <th scope="col">Instant</th>
            <th scope="col">In Place</th>
            <th scope="col">Rebuilds Table</th>
            <th scope="col">Permits Concurrent DML</th>
            <th scope="col">Only Modifies Metadata</th>
          </tr></thead><tbody><tr>
            <td scope="row">Adding a primary key</td>
            <td>No</td>
            <td>Yes*</td>
            <td>Yes*</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Dropping a primary key</td>
            <td>No</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Dropping a primary key and adding another</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<h5><a name="online-ddl-primary-key-syntax-notes"></a>Syntax and Usage Notes</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Adding a primary key
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ADD PRIMARY KEY (<em class="replaceable"><code>column</code></em>), ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
            Rebuilds the table in place. Data is reorganized
            substantially, making it an expensive operation.
            <code class="literal">ALGORITHM=INPLACE</code> is not permitted under
            certain conditions if columns have to be converted to
            <code class="literal">NOT NULL</code>.
          </p><p>
            Restructuring the
            <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
            always requires copying of table data. Thus, it is best to
            define the <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
            key</a> when you create a table, rather than issuing
            <code class="literal">ALTER TABLE ... ADD PRIMARY KEY</code> later.
          </p><p>
            When you create a <code class="literal">UNIQUE</code> or
            <code class="literal">PRIMARY KEY</code> index, MySQL must do some
            extra work. For <code class="literal">UNIQUE</code> indexes, MySQL
            checks that the table contains no duplicate values for the
            key. For a <code class="literal">PRIMARY KEY</code> index, MySQL also
            checks that none of the <code class="literal">PRIMARY KEY</code>
            columns contains a <code class="literal">NULL</code>.
          </p><p>
            

            When you add a primary key using the
            <code class="literal">ALGORITHM=COPY</code> clause, MySQL converts
            <code class="literal">NULL</code> values in the associated columns to
            default values: 0 for numbers, an empty string for
            character-based columns and BLOBs, and 0000-00-00 00:00:00
            for <code class="literal">DATETIME</code>. This is a non-standard
            behavior that Oracle recommends you not rely on. Adding a
            primary key using <code class="literal">ALGORITHM=INPLACE</code> is
            only permitted when the
            <a class="link" href="server-administration.html#sysvar_sql_mode"><code class="literal">SQL_MODE</code></a> setting includes
            the <code class="literal">strict_trans_tables</code> or
            <code class="literal">strict_all_tables</code> flags; when the
            <code class="literal">SQL_MODE</code> setting is strict,
            <code class="literal">ALGORITHM=INPLACE</code> is permitted, but the
            statement can still fail if the requested primary key
            columns contain <code class="literal">NULL</code> values. The
            <code class="literal">ALGORITHM=INPLACE</code> behavior is more
            standard-compliant.
          </p><p>
            If you create a table without a primary key,
            <code class="literal">InnoDB</code> chooses one for you, which can be
            the first <code class="literal">UNIQUE</code> key defined on
            <code class="literal">NOT NULL</code> columns, or a system-generated
            key. To avoid uncertainty and the potential space
            requirement for an extra hidden column, specify the
            <code class="literal">PRIMARY KEY</code> clause as part of the
            <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement.
          </p><p>
            MySQL creates a new clustered index by copying the existing
            data from the original table to a temporary table that has
            the desired index structure. Once the data is completely
            copied to the temporary table, the original table is renamed
            with a different temporary table name. The temporary table
            comprising the new clustered index is renamed with the name
            of the original table, and the original table is dropped
            from the database.
          </p><p>
            The online performance enhancements that apply to operations
            on secondary indexes do not apply to the primary key index.
            The rows of an InnoDB table are stored in a
            <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
            organized based on the
            <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a>, forming
            what some database systems call an <span class="quote">“<span class="quote">index-organized
            table</span>”</span>. Because the table structure is closely tied
            to the primary key, redefining the primary key still
            requires copying the data.
          </p><p>
            When an operation on the primary key uses
            <code class="literal">ALGORITHM=INPLACE</code>, even though the data
            is still copied, it is more efficient than using
            <code class="literal">ALGORITHM=COPY</code> because:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                No undo logging or associated redo logging is required
                for <code class="literal">ALGORITHM=INPLACE</code>. These
                operations add overhead to DDL statements that use
                <code class="literal">ALGORITHM=COPY</code>.
              </p></li><li class="listitem"><p>
                The secondary index entries are pre-sorted, and so can
                be loaded in order.
              </p></li><li class="listitem"><p>
                The change buffer is not used, because there are no
                random-access inserts into the secondary indexes.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            Dropping a primary key
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DROP PRIMARY KEY, ALGORITHM=COPY;
</pre><p>
            Only <code class="literal">ALGORITHM=COPY</code> supports dropping a
            primary key without adding a new one in the same
            <code class="literal">ALTER TABLE</code> statement.
          </p></li><li class="listitem"><p>
            Dropping a primary key and adding another
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DROP PRIMARY KEY, ADD PRIMARY KEY (<em class="replaceable"><code>column</code></em>), ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
            Data is reorganized substantially, making it an expensive
            operation.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="online-ddl-column-operations"></a>Column Operations</h4>

</div>

</div>

</div>
<p>
        The following table provides an overview of online DDL support
        for column operations. An asterisk indicates additional
        information, an exception, or a dependency. For details, see
        <a class="xref" href="innodb-storage-engine.html#online-ddl-column-syntax-notes" title="Syntax and Usage Notes">Syntax and Usage Notes</a>.
</p>
<div class="table">
<a name="online-ddl-column-operations-table"></a><p class="title"><b>Table 15.19 Online DDL Support for Column Operations</b></p>
<div class="table-contents">
<table summary="Online DDL support for column operations indicating whether the operation is performed in place, rebuilds the table, permits concurrent DML, or only modifies metadata."><col width="16%" align="left"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><thead><tr>
            <th scope="col">Operation</th>
            <th scope="col">Instant</th>
            <th scope="col">In Place</th>
            <th scope="col">Rebuilds Table</th>
            <th scope="col">Permits Concurrent DML</th>
            <th scope="col">Only Modifies Metadata</th>
          </tr></thead><tbody><tr>
            <td scope="row">Adding a column</td>
            <td>Yes*</td>
            <td>Yes</td>
            <td>No*</td>
            <td>Yes*</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Dropping a column</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Renaming a column</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes*</td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row">Reordering columns</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Setting a column default value</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row">Changing the column data type</td>
            <td>No</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Extending <code class="literal">VARCHAR</code> column size</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row">Dropping the column default value</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row">Changing the auto-increment value</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>No*</td>
          </tr><tr>
            <td scope="row">Making a column <code class="literal">NULL</code></td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes*</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Making a column <code class="literal">NOT NULL</code></td>
            <td>No</td>
            <td>Yes*</td>
            <td>Yes*</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Modifying the definition of an <code class="literal">ENUM</code> or
              <code class="literal">SET</code> column</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<h5><a name="online-ddl-column-syntax-notes"></a>Syntax and Usage Notes</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Adding a column
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ADD COLUMN <em class="replaceable"><code>column_name</code></em> <em class="replaceable"><code>column_definition</code></em>, ALGORITHM=INSTANT;
</pre><p>
            The following limitations apply when the
            <code class="literal">INSTANT</code> algorithm is used to add a
            column:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Adding a column cannot be combined in the same statement
                with other <code class="literal">ALTER TABLE</code> actions that
                do not support <code class="literal">ALGORITHM=INSTANT</code>.
              </p></li><li class="listitem"><p>
                A column can only be added as the last column of the
                table. Adding a column to any other position among other
                columns is not supported.
              </p></li><li class="listitem"><p>
                Columns cannot be added to tables that use
                <code class="literal">ROW_FORMAT=COMPRESSED</code>.
              </p></li><li class="listitem"><p>
                Columns cannot be added to tables that include a
                <code class="literal">FULLTEXT</code> index.
              </p></li><li class="listitem"><p>
                Columns cannot be added to temporary tables. Temporary
                tables only support <code class="literal">ALGORITHM=COPY</code>.
              </p></li><li class="listitem"><p>
                Columns cannot be added to tables that reside in the
                data dictionary tablespace.
              </p></li><li class="listitem"><p>
                Row size limits are not evaluated when adding a column.
                However, row size limits are checked during DML
                operations that insert and update rows in the table.
</p></li></ul>
</div>
<p>
            Multiple columns may be added in the same
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. For
            example:
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE t1 ADD COLUMN c2 INT, ADD COLUMN c3 INT, ALGORITHM=INSTANT;            
</pre><p>
            <a class="link" href="information-schema.html#innodb-tables-table" title="25.39.24 The INFORMATION_SCHEMA INNODB_TABLES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TABLES</code></a>
            and
            <a class="link" href="information-schema.html#innodb-columns-table" title="25.39.8 The INFORMATION_SCHEMA INNODB_COLUMNS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_COLUMNS</code></a>
            provide metadata for instantly added columns.
            <code class="literal">INFORMATION_SCHEMA.INNODB_TABLES.INSTANT_COLS</code>
            shows number of columns in the table prior to adding the
            first instant column.
            <code class="literal">INFORMATION_SCHEMA.INNODB_COLUMNS.HAS_DEFAULT</code>
            and <code class="literal">DEFAULT_VALUE</code> provide metadata about
            default values for instantly added columns.
          </p><p>
            Concurrent DML is not permitted when adding an
            <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
            column. Data is reorganized substantially, making it an
            expensive operation. At a minimum,
            <code class="literal">ALGORITHM=INPLACE, LOCK=SHARED</code> is
            required.
          </p><p>
            The table is rebuilt if <code class="literal">ALGORITHM=INPLACE</code>
            is used to add a column.
          </p></li><li class="listitem"><p>
            Dropping a column
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DROP COLUMN <em class="replaceable"><code>column_name</code></em>, ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
            Data is reorganized substantially, making it an expensive
            operation.
          </p></li><li class="listitem"><p>
            Renaming a column
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl</code></em> CHANGE <em class="replaceable"><code>old_col_name</code></em> <em class="replaceable"><code>new_col_name</code></em> <em class="replaceable"><code>data_type</code></em>, ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
            To permit concurrent DML, keep the same data type and only
            change the column name.
          </p><p>
            When you keep the same data type and <code class="literal">[NOT]
            NULL</code> attribute, only changing the column name, the
            operation can always be performed online.
          </p><p>
            You can also rename a column that is part of a foreign key
            constraint. The foreign key definition is automatically
            updated to use the new column name. Renaming a column
            participating in a foreign key only works with
            <code class="literal">ALGORITHM=INPLACE</code>. If you use the
            <code class="literal">ALGORITHM=COPY</code> clause, or some other
            condition causes the command to use
            <code class="literal">ALGORITHM=COPY</code> behind the scenes, the
            <code class="literal">ALTER TABLE</code> statement fails.
          </p><p>
            <code class="literal">ALGORITHM=INPLACE</code> is not supported for
            renaming a <a class="link" href="glossary.html#glos_generated_column" title="generated column">generated
            column</a>.
          </p></li><li class="listitem"><p>
            Reordering columns
          </p><p>
            To reorder columns, use <code class="literal">FIRST</code> or
            <code class="literal">AFTER</code> in <code class="literal">CHANGE</code> or
            <code class="literal">MODIFY</code> operations.
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> MODIFY COLUMN <em class="replaceable"><code>col_name</code></em> <em class="replaceable"><code>column_definition</code></em> FIRST, ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
            Data is reorganized substantially, making it an expensive
            operation.
          </p></li><li class="listitem"><p>
            Changing the column data type
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> CHANGE c1 c1 BIGINT, ALGORITHM=COPY;  
</pre><p>
            Changing the column data type is only supported with
            <code class="literal">ALGORITHM=COPY</code>.
          </p></li><li class="listitem"><p>
            Extending <code class="literal">VARCHAR</code> column size
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> CHANGE COLUMN c1 c1 VARCHAR(255), ALGORITHM=INPLACE, LOCK=NONE;  
</pre><p>
            The number of length bytes required by a
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> column must remain
            the same. For <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns
            of 0 to 255 bytes in size, one length byte is required to
            encode the value. For <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>
            columns of 256 bytes in size or more, two length bytes are
            required. As a result, in-place <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
            TABLE</code></a> only supports increasing
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> column size from 0 to
            255 bytes, or from 256 bytes to a greater size. In-place
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> does not support
            increasing the size of a
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> column from less than
            256 bytes to a size equal to or greater than 256 bytes. In
            this case, the number of required length bytes changes from
            1 to 2, which is only supported by a table copy
            (<code class="literal">ALGORITHM=COPY</code>). For example, attempting
            to change <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> column size
            for a single byte character set from VARCHAR(255) to
            VARCHAR(256) using in-place <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
            TABLE</code></a> returns this error:
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ALGORITHM=INPLACE, CHANGE COLUMN c1 c1 VARCHAR(256);
ERROR 0A000: ALGORITHM=INPLACE is not supported. Reason: Cannot change
column type INPLACE. Try ALGORITHM=COPY.
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The byte length of a <code class="literal">VARCHAR</code> column is
              dependant on the byte length of the character set.
</p>
</div>
<p>
            Decreasing <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> size using
            in-place <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> is not
            supported. Decreasing <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>
            size requires a table copy
            (<code class="literal">ALGORITHM=COPY</code>).
          </p></li><li class="listitem"><p>
            Setting a column default value
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ALTER COLUMN <em class="replaceable"><code>col</code></em> SET DEFAULT <em class="replaceable"><code>literal</code></em>, ALGORITHM=INSTANT;
</pre><p>
            Only modifies table metadata. Default column values are
            stored in the <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data
            dictionary</a>.
          </p></li><li class="listitem"><p>
            Dropping a column default value
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl</code></em> ALTER COLUMN <em class="replaceable"><code>col</code></em> DROP DEFAULT, ALGORITHM=INSTANT;
</pre></li><li class="listitem"><p>
            Changing the auto-increment value
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>table</code></em> AUTO_INCREMENT=<em class="replaceable"><code>next_value</code></em>, ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
            Modifies a value stored in memory, not the data file.
          </p><p>
            In a distributed system using replication or sharding, you
            sometimes reset the auto-increment counter for a table to a
            specific value. The next row inserted into the table uses
            the specified value for its auto-increment column. You might
            also use this technique in a data warehousing environment
            where you periodically empty all the tables and reload them,
            and restart the auto-increment sequence from 1.
          </p></li><li class="listitem"><p>
            Making a column <code class="literal">NULL</code>
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE tbl_name MODIFY COLUMN <em class="replaceable"><code>column_name</code></em> <em class="replaceable"><code>data_type</code></em> NULL, ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
            Rebuilds the table in place. Data is reorganized
            substantially, making it an expensive operation.
          </p></li><li class="listitem"><p>
            Making a column <code class="literal">NOT NULL</code>
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> MODIFY COLUMN <em class="replaceable"><code>column_name</code></em> <em class="replaceable"><code>data_type</code></em> NOT NULL, ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
            Rebuilds the table in place.
            <code class="literal">STRICT_ALL_TABLES</code> or
            <code class="literal">STRICT_TRANS_TABLES</code>
            <a class="link" href="server-administration.html#sysvar_sql_mode"><code class="literal">SQL_MODE</code></a> is required for
            the operation to succeed. The operation fails if the column
            contains NULL values. The server prohibits changes to
            foreign key columns that have the potential to cause loss of
            referential integrity. See <a class="xref" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax">Section 13.1.9, “ALTER TABLE Syntax”</a>.
            Data is reorganized substantially, making it an expensive
            operation.
          </p></li><li class="listitem"><p>
            Modifying the definition of an <code class="literal">ENUM</code> or
            <code class="literal">SET</code> column
          </p><pre data-lang="sql" class="programlisting">
CREATE TABLE t1 (c1 ENUM('a', 'b', 'c'));
ALTER TABLE t1 MODIFY COLUMN c1 ENUM('a', 'b', 'c', 'd'), ALGORITHM=INSTANT;
</pre><p>
            Modifying the definition of an
            <a class="link" href="data-types.html#enum" title="11.4.4 The ENUM Type"><code class="literal">ENUM</code></a> or
            <a class="link" href="data-types.html#set" title="11.4.5 The SET Type"><code class="literal">SET</code></a> column by adding new
            enumeration or set members to the <span class="emphasis"><em>end</em></span>
            of the list of valid member values may be performed
            instantly or in place, as long as the storage size of the
            data type does not change. For example, adding a member to a
            <a class="link" href="data-types.html#set" title="11.4.5 The SET Type"><code class="literal">SET</code></a> column that has 8 members
            changes the required storage per value from 1 byte to 2
            bytes; this requires a table copy. Adding members in the
            middle of the list causes renumbering of existing members,
            which requires a table copy.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="online-ddl-generated-column-operations"></a>Generated Column Operations</h4>

</div>

</div>

</div>
<p>
        The following table provides an overview of online DDL support
        for generated column operations. For details, see
        <a class="xref" href="innodb-storage-engine.html#online-ddl-generated-column-syntax-notes" title="Syntax and Usage Notes">Syntax and Usage Notes</a>.
</p>
<div class="table">
<a name="online-ddl-generated-column-operations-table"></a><p class="title"><b>Table 15.20 Online DDL Support for Generated Column Operations</b></p>
<div class="table-contents">
<table summary="Online DDL support for generated column operations indicating whether the operation is performed in place, rebuilds the table, permits concurrent DML, or only modifies metadata."><col width="16%" align="left"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><thead><tr>
            <th scope="col">Operation</th>
            <th scope="col">Instant</th>
            <th scope="col">In Place</th>
            <th scope="col">Rebuilds Table</th>
            <th scope="col">Permits Concurrent DML</th>
            <th scope="col">Only Modifies Metadata</th>
          </tr></thead><tbody><tr>
            <td scope="row">Adding a <code class="literal">STORED</code> column</td>
            <td>No</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Modifying <code class="literal">STORED</code> column order</td>
            <td>No</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Dropping a <code class="literal">STORED</code> column</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Adding a <code class="literal">VIRTUAL</code> column</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row">Modifying <code class="literal">VIRTUAL</code> column order</td>
            <td>No</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Dropping a <code class="literal">VIRTUAL</code> column</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<h5><a name="online-ddl-generated-column-syntax-notes"></a>Syntax and Usage Notes</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Adding a <code class="literal">STORED</code> column
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE t1 ADD COLUMN (c2 INT GENERATED ALWAYS AS (c1 + 1) STORED), ALGORITHM=COPY;
</pre><p>
            <code class="literal">ADD COLUMN</code> is not an in-place operation
            for stored columns (done without using a temporary table)
            because the expression must be evaluated by the server.
          </p></li><li class="listitem"><p>
            Modifying <code class="literal">STORED</code> column order
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE t1 MODIFY COLUMN c2 INT GENERATED ALWAYS AS (c1 + 1) STORED FIRST, ALGORITHM=COPY;
</pre><p>
            Rebuilds the table in place.
          </p></li><li class="listitem"><p>
            Dropping a <code class="literal">STORED</code> column
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE t1 DROP COLUMN c2, ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
            Rebuilds the table in place.
          </p></li><li class="listitem"><p>
            Adding a <code class="literal">VIRTUAL</code> column
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE t1 ADD COLUMN (c2 INT GENERATED ALWAYS AS (c1 + 1) VIRTUAL), ALGORITHM=INSTANT;
</pre><p>
            Adding a virtual column can be performed instantly or in
            place for non-partitioned tables.
          </p><p>
            Adding a <code class="literal">VIRTUAL</code> is not an in-place
            operation for partitioned tables.
          </p></li><li class="listitem"><p>
            Modifying <code class="literal">VIRTUAL</code> column order
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE t1 MODIFY COLUMN c2 INT GENERATED ALWAYS AS (c1 + 1) VIRTUAL FIRST, ALGORITHM=COPY;
</pre></li><li class="listitem"><p>
            Dropping a <code class="literal">VIRTUAL</code> column
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE t1 DROP COLUMN c2, ALGORITHM=INSTANT;
</pre><p>
            Dropping a <code class="literal">VIRTUAL</code> column can be
            performed instantly or in place for non-partitioned tables.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="online-ddl-foreign-key-operations"></a>Foreign Key Operations</h4>

</div>

</div>

</div>
<p>
        The following table provides an overview of online DDL support
        for foreign key operations. An asterisk indicates additional
        information, an exception, or a dependency. For details, see
        <a class="xref" href="innodb-storage-engine.html#online-ddl-foreign-key-syntax-notes" title="Syntax and Usage Notes">Syntax and Usage Notes</a>.
</p>
<div class="table">
<a name="online-ddl-foreign-key-operations-table"></a><p class="title"><b>Table 15.21 Online DDL Support for Foreign Key Operations</b></p>
<div class="table-contents">
<table summary="Online DDL support for foreign key operations indicating whether the operation is performed in place, rebuilds the table, permits concurrent DML, or only modifies metadata."><col width="16%" align="left"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><thead><tr>
            <th scope="col">Operation</th>
            <th scope="col">Instant</th>
            <th scope="col">In Place</th>
            <th scope="col">Rebuilds Table</th>
            <th scope="col">Permits Concurrent DML</th>
            <th scope="col">Only Modifies Metadata</th>
          </tr></thead><tbody><tr>
            <td scope="row">Adding a foreign key constraint</td>
            <td>No</td>
            <td>Yes*</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row">Dropping a foreign key constraint</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<h5><a name="online-ddl-foreign-key-syntax-notes"></a>Syntax and Usage Notes</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Adding a foreign key constraint
          </p><p>
            The <code class="literal">INPLACE</code> algorithm is supported when
            <a class="link" href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> is
            disabled. Otherwise, only the <code class="literal">COPY</code>
            algorithm is supported.
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl1</code></em> ADD CONSTRAINT <em class="replaceable"><code>fk_name</code></em> FOREIGN KEY <em class="replaceable"><code>index</code></em> (<em class="replaceable"><code>col1</code></em>) 
  REFERENCES <em class="replaceable"><code>tbl2</code></em>(<em class="replaceable"><code>col2</code></em>) <em class="replaceable"><code>referential_actions</code></em>;
</pre></li><li class="listitem"><p>
            Dropping a foreign key constraint
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl</code></em> DROP FOREIGN KEY <em class="replaceable"><code>fk_name</code></em>;
</pre><p>
            Dropping a foreign key can be performed online with the
            <a class="link" href="server-administration.html#sysvar_foreign_key_checks"><code class="literal">foreign_key_checks</code></a> option
            enabled or disabled.
          </p><p>
            If you do not know the names of the foreign key constraints
            on a particular table, issue the following statement and
            find the constraint name in the
            <code class="literal">CONSTRAINT</code> clause for each foreign key:
          </p><pre data-lang="sql" class="programlisting">
SHOW CREATE TABLE <em class="replaceable"><code>table</code></em>\G
</pre><p>
            Or, query the
            <a class="link" href="information-schema.html#table-constraints-table" title="25.32 The INFORMATION_SCHEMA TABLE_CONSTRAINTS Table"><code class="literal">INFORMATION_SCHEMA.TABLE_CONSTRAINTS</code></a>
            table and use the <code class="literal">CONSTRAINT_NAME</code> and
            <code class="literal">CONSTRAINT_TYPE</code> columns to identify the
            foreign key names.
          </p><p>
            You can also drop a foreign key and its associated index in
            a single statement:
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>table</code></em> DROP FOREIGN KEY <em class="replaceable"><code>constraint</code></em>, DROP INDEX <em class="replaceable"><code>index</code></em>;
</pre></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          If <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a> are
          already present in the table being altered (that is, it is a
          <a class="link" href="glossary.html#glos_child_table" title="child table">child table</a> containing
          a <code class="literal">FOREIGN KEY ... REFERENCE</code> clause),
          additional restrictions apply to online DDL operations, even
          those not directly involving the foreign key columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              An <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> on the child
              table could wait for another transaction to commit, if a
              change to the parent table causes associated changes in
              the child table through an <code class="literal">ON UPDATE</code> or
              <code class="literal">ON DELETE</code> clause using the
              <code class="literal">CASCADE</code> or <code class="literal">SET NULL</code>
              parameters.
            </p></li><li class="listitem"><p>
              In the same way, if a table is the
              <a class="link" href="glossary.html#glos_parent_table" title="parent table">parent table</a> in a
              foreign key relationship, even though it does not contain
              any <code class="literal">FOREIGN KEY</code> clauses, it could wait
              for the <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to
              complete if an <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
              <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
              <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statement causes an
              <code class="literal">ON UPDATE</code> or <code class="literal">ON
              DELETE</code> action in the child table.
</p></li></ul>
</div>

</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="online-ddl-table-operations"></a>Table Operations</h4>

</div>

</div>

</div>
<p>
        The following table provides an overview of online DDL support
        for table operations. An asterisk indicates additional
        information, an exception, or a dependency. For details, see
        <a class="xref" href="innodb-storage-engine.html#online-ddl-table-syntax-notes" title="Syntax and Usage Notes">Syntax and Usage Notes</a>.
</p>
<div class="table">
<a name="online-ddl-table-operations-table"></a><p class="title"><b>Table 15.22 Online DDL Support for Table Operations</b></p>
<div class="table-contents">
<table summary="Online DDL support for table operations indicating whether the operation is performed in place, rebuilds the table, permits concurrent DML, or only modifies metadata."><col width="16%" align="left"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><thead><tr>
            <th scope="col">Operation</th>
            <th scope="col">Instant</th>
            <th scope="col">In Place</th>
            <th scope="col">Rebuilds Table</th>
            <th scope="col">Permits Concurrent DML</th>
            <th scope="col">Only Modifies Metadata</th>
          </tr></thead><tbody><tr>
            <td scope="row">Changing the <code class="literal">ROW_FORMAT</code></td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Changing the <code class="literal">KEY_BLOCK_SIZE</code></td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Setting persistent table statistics</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row">Specifying a character set</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes*</td>
            <td>No</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Converting a character set</td>
            <td>No</td>
            <td>No</td>
            <td>Yes*</td>
            <td>No</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Optimizing a table</td>
            <td>No</td>
            <td>Yes*</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Rebuilding with the <code class="literal">FORCE</code> option</td>
            <td>No</td>
            <td>Yes*</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Performing a null rebuild</td>
            <td>No</td>
            <td>Yes*</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Renaming a table</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<h5><a name="online-ddl-table-syntax-notes"></a>Syntax and Usage Notes</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Changing the <code class="literal">ROW_FORMAT</code>
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ROW_FORMAT = <em class="replaceable"><code>row_format</code></em>, ALGORITHM=INPLACE, LOCK=NONE;  
</pre><p>
            Data is reorganized substantially, making it an expensive
            operation.
          </p><p>
            For additional information about the
            <code class="literal">ROW_FORMAT</code> option, see
            <a class="xref" href="sql-syntax.html#create-table-options" title="Table Options">Table Options</a>.
          </p></li><li class="listitem"><p>
            Changing the <code class="literal">KEY_BLOCK_SIZE</code>
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> KEY_BLOCK_SIZE = <em class="replaceable"><code>value</code></em>, ALGORITHM=INPLACE, LOCK=NONE;  
</pre><p>
            Data is reorganized substantially, making it an expensive
            operation.
          </p><p>
            For additional information about the
            <code class="literal">KEY_BLOCK_SIZE</code> option, see
            <a class="xref" href="sql-syntax.html#create-table-options" title="Table Options">Table Options</a>.
          </p></li><li class="listitem"><p>
            Setting persistent table statistics options
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> STATS_PERSISTENT=0, STATS_SAMPLE_PAGES=20, STATS_AUTO_RECALC=1, ALGORITHM=INPLACE, LOCK=NONE;  
</pre><p>
            Only modifies table metadata.
          </p><p>
            Persistent statistics include
            <code class="literal">STATS_PERSISTENT</code>,
            <code class="literal">STATS_AUTO_RECALC</code>, and
            <code class="literal">STATS_SAMPLE_PAGES</code>. For more information,
            see <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="15.8.10.1 Configuring Persistent Optimizer Statistics Parameters">Section 15.8.10.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
          </p></li><li class="listitem"><p>
            Specifying a character set
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> CHARACTER SET = <em class="replaceable"><code>charset_name</code></em>, ALGORITHM=INPLACE, LOCK=NONE;  
</pre><p>
            Rebuilds the table if the new character encoding is
            different.
          </p></li><li class="listitem"><p>
            Converting a character set
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> CONVERT TO CHARACTER SET <em class="replaceable"><code>charset_name</code></em>, ALGORITHM=COPY;  
</pre><p>
            Rebuilds the table if the new character encoding is
            different.
          </p></li><li class="listitem"><p>
            Optimizing a table
          </p><pre data-lang="sql" class="programlisting">
OPTIMIZE TABLE <em class="replaceable"><code>tbl_name</code></em>;  
</pre><p>
            In-place operation is not supported for tables with
            <code class="literal">FULLTEXT</code> indexes. The operation uses the
            <code class="literal">INPLACE</code> algorithm, but
            <code class="literal">ALGORITHM</code> and <code class="literal">LOCK</code>
            syntax is not permitted.
          </p></li><li class="listitem"><p>
            Rebuilding a table with the <code class="literal">FORCE</code> option
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> FORCE, ALGORITHM=INPLACE, LOCK=NONE;    
</pre><p>
            Uses <code class="literal">ALGORITHM=INPLACE</code> as of MySQL
            5.6.17<code class="literal"></code>. <code class="literal">ALGORITHM=INPLACE</code> is
            not supported for tables with <code class="literal">FULLTEXT</code>
            indexes.
          </p></li><li class="listitem"><p>
            Performing a "null" rebuild
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ENGINE=InnoDB, ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
            Uses <code class="literal">ALGORITHM=INPLACE</code> as of MySQL
            5.6.17. <code class="literal">ALGORITHM=INPLACE</code> is not
            supported for tables with <code class="literal">FULLTEXT</code>
            indexes.
          </p></li><li class="listitem"><p>
            Renaming a table
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>old_tbl_name</code></em> RENAME TO <em class="replaceable"><code>new_tbl_name</code></em>, ALGORITHM=INSTANT;
</pre><p>
            Renaming a table can be performed instantly or in place.
            MySQL renames files that correspond to the table
            <em class="replaceable"><code>tbl_name</code></em> without making a copy.
            (You can also use the <a class="link" href="sql-syntax.html#rename-table" title="13.1.36 RENAME TABLE Syntax"><code class="literal">RENAME
            TABLE</code></a> statement to rename tables. See
            <a class="xref" href="sql-syntax.html#rename-table" title="13.1.36 RENAME TABLE Syntax">Section 13.1.36, “RENAME TABLE Syntax”</a>.) Privileges granted
            specifically for the renamed table are not migrated to the
            new name. They must be changed manually.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="online-ddl-tablespace-operations"></a>Tablespace Operations</h4>

</div>

</div>

</div>
<p>
        The following table provides an overview of online DDL support
        for tablespace operations. For details, see
        <a class="xref" href="innodb-storage-engine.html#online-ddl-tablespace-syntax-notes" title="Syntax and Usage Notes">Syntax and Usage Notes</a>.
</p>
<div class="table">
<a name="online-ddl-tablespace-operations-table"></a><p class="title"><b>Table 15.23 Online DDL Support for Tablespace Operations</b></p>
<div class="table-contents">
<table summary="Online DDL support for tablespace operations indicating whether the operation is performed in place, rebuilds tables within the tablespace, permits concurrent DML, or only modifies metadata."><col width="16%" align="left"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><col width="16%" align="center"><thead><tr>
            <th scope="col">Operation</th>
            <th scope="col">Instant</th>
            <th scope="col">In Place</th>
            <th scope="col">Rebuilds Table</th>
            <th scope="col">Permits Concurrent DML</th>
            <th scope="col">Only Modifies Metadata</th>
          </tr></thead><tbody><tr>
            <td scope="row">Renaming a general tablespace</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row">Enabling or disabling general tablespace encryption</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
          </tr><tr>
            <td scope="row">Enabling or disabling file-per-table tablespace encryption</td>
            <td>No</td>
            <td>No</td>
            <td>Yes</td>
            <td>No</td>
            <td>No</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<h5><a name="online-ddl-tablespace-syntax-notes"></a>Syntax and Usage Notes</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Renaming a general tablespace
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLESPACE <em class="replaceable"><code>tablespace_name</code></em> RENAME TO <em class="replaceable"><code>new_tablespace_name</code></em>;
</pre><p>
            <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">ALTER
            TABLESPACE ... RENAME TO</code></a> uses the
            <code class="literal">INPLACE</code> algorithm but does not support
            the <code class="literal">ALGORITHM</code> clause.
          </p></li><li class="listitem"><p>
            Enabling or disabling general tablespace encryption
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLESPACE <em class="replaceable"><code>tablespace_name</code></em> ENCRYPTION='Y';
</pre><p>
            <a class="link" href="sql-syntax.html#alter-tablespace" title="13.1.10 ALTER TABLESPACE Syntax"><code class="literal">ALTER
            TABLESPACE ... ENCRYPTION</code></a> uses the
            <code class="literal">INPLACE</code> algorithm but does not support
            the <code class="literal">ALGORITHM</code> clause.
          </p><p>
            For related information, see
            <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption" title="15.6.3.9 InnoDB Data-at-Rest Encryption">Section 15.6.3.9, “InnoDB Data-at-Rest Encryption”</a>.
          </p></li><li class="listitem"><p>
            Enabling or disabling file-per-table tablespace encryption
          </p><pre data-lang="sql" class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ENCRYPTION='Y', ALGORITHM=COPY;
</pre><p>
            For related information, see
            <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption" title="15.6.3.9 InnoDB Data-at-Rest Encryption">Section 15.6.3.9, “InnoDB Data-at-Rest Encryption”</a>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="online-ddl-partitioning"></a>Partitioning Operations</h4>

</div>

</div>

</div>
<p>
        With the exception of some <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> partitioning clauses, online DDL operations for
        partitioned <code class="literal">InnoDB</code> tables follow the same
        rules that apply to regular <code class="literal">InnoDB</code> tables.
      </p><p>
        Some <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> partitioning
        clauses do not go through the same internal online DDL API as
        regular non-partitioned <code class="literal">InnoDB</code> tables. As a
        result, online support for <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> partitioning clauses varies.
      </p><p>
        The following table shows the online status for each
        <code class="literal">ALTER TABLE</code> partitioning statement.
        Regardless of the online DDL API that is used, MySQL attempts to
        minimize data copying and locking where possible.
      </p><p>
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> partitioning options
        that use <code class="literal">ALGORITHM=COPY</code> or that only permit
        <span class="quote">“<span class="quote"><code class="literal">ALGORITHM=DEFAULT,
        LOCK=DEFAULT</code></span>”</span>, repartition the table using the
        <code class="literal">COPY</code> algorithm. In other words, a new
        partitioned table is created with the new partitioning scheme.
        The newly created table includes any changes applied by the
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement, and table
        data is copied into the new table structure.
</p>
<div class="table">
<a name="innodb-online-ddl-partitioning-clauses"></a><p class="title"><b>Table 15.24 Online DDL Support for Partitioning Operations</b></p>
<div class="table-contents">
<table summary="Online DDL support for partitioning operations indicating whether the operation is performed in place and permits concurrent DML."><col width="24%" align="left"><col width="8%" align="center"><col width="8%" align="center"><col width="12%" align="center"><col width="32%" align="left"><thead><tr>
            <th scope="col">Partitioning Clause</th>
            <th scope="col">Instant</th>
            <th scope="col">In Place</th>
            <th scope="col">Permits DML</th>
            <th scope="col">Notes</th>
          </tr></thead><tbody><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">PARTITION BY</code></a></td>
            <td>No</td>
            <td>No</td>
            <td>No</td>
            <td>Permits <code class="literal">ALGORITHM=COPY</code>,
              <code class="literal">LOCK={DEFAULT|SHARED|EXCLUSIVE}</code></td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ADD PARTITION</code></a></td>
            <td>No</td>
            <td>Yes*</td>
            <td>Yes*</td>
            <td><code class="literal">ALGORITHM=INPLACE,
              LOCK={DEFAULT|NONE|SHARED|EXCLUSISVE}</code> is
              supported for <code class="literal">RANGE</code> and
              <code class="literal">LIST</code> partitions,
              <code class="literal">ALGORITHM=INPLACE,
              LOCK={DEFAULT|SHARED|EXCLUSISVE}</code> for
              <code class="literal">HASH</code> and <code class="literal">KEY</code>
              partitions, and <code class="literal">ALGORITHM=COPY,
              LOCK={SHARED|EXCLUSIVE}</code> for all partition types.
              Does not copy existing data for tables partitioned by
              <code class="literal">RANGE</code> or <code class="literal">LIST</code>.
              Concurrent queries are permitted with
              <code class="literal">ALGORITHM=COPY</code> for tables partitioned
              by <code class="literal">HASH</code> or <code class="literal">LIST</code>, as
              MySQL copies the data while holding a shared lock.</td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">DROP PARTITION</code></a></td>
            <td>No</td>
            <td>Yes*</td>
            <td>Yes*</td>
            <td><p>
                <code class="literal">ALGORITHM=INPLACE,
                LOCK={DEFAULT|NONE|SHARED|EXCLUSIVE}</code> is
                supported. Does not copy data for tables partitioned by
                <code class="literal">RANGE</code> or <code class="literal">LIST</code>.
              </p><p>
                <code class="literal">DROP PARTITION</code> with
                <code class="literal">ALGORITHM=INPLACE</code> deletes data stored
                in the partition and drops the partition. However,
                <code class="literal">DROP PARTITION</code> with
                <code class="literal">ALGORITHM=COPY</code> or
                <a class="link" href="server-administration.html#sysvar_old_alter_table"><code class="literal">old_alter_table=ON</code></a>
                rebuilds the partitioned table and attempts to move data
                from the dropped partition to another partition with a
                compatible <code class="literal">PARTITION ... VALUES</code>
                definition. Data that cannot be moved to another
                partition is deleted.
              </p></td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">DISCARD PARTITION</code></a></td>
            <td>No</td>
            <td>No</td>
            <td>No</td>
            <td>Only permits <code class="literal">ALGORITHM=DEFAULT</code>,
              <code class="literal">LOCK=DEFAULT</code></td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">IMPORT PARTITION</code></a></td>
            <td>No</td>
            <td>No</td>
            <td>No</td>
            <td>Only permits <code class="literal">ALGORITHM=DEFAULT</code>,
              <code class="literal">LOCK=DEFAULT</code></td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">TRUNCATE
              PARTITION</code></a></td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
            <td>Does not copy existing data. It merely deletes rows; it does not alter
              the definition of the table itself, or of any of its
              partitions.</td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">COALESCE
              PARTITION</code></a></td>
            <td>No</td>
            <td>Yes*</td>
            <td>No</td>
            <td><code class="literal">ALGORITHM=INPLACE, LOCK={DEFAULT|SHARED|EXCLUSIVE}</code> is
              supported.</td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">REORGANIZE
              PARTITION</code></a></td>
            <td>No</td>
            <td>Yes*</td>
            <td>No</td>
            <td><code class="literal">ALGORITHM=INPLACE, LOCK={DEFAULT|SHARED|EXCLUSIVE}</code> is
              supported.</td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">EXCHANGE
              PARTITION</code></a></td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
            <td></td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ANALYZE PARTITION</code></a></td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
            <td></td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">CHECK PARTITION</code></a></td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
            <td></td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">OPTIMIZE
              PARTITION</code></a></td>
            <td>No</td>
            <td>No</td>
            <td>No</td>
            <td><code class="literal">ALGORITHM</code> and <code class="literal">LOCK</code> clauses are
              ignored. Rebuilds the entire table. See
              <a class="xref" href="partitioning.html#partitioning-maintenance" title="23.3.4 Maintenance of Partitions">Section 23.3.4, “Maintenance of Partitions”</a>.</td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">REBUILD PARTITION</code></a></td>
            <td>No</td>
            <td>Yes*</td>
            <td>No</td>
            <td><code class="literal">ALGORITHM=INPLACE, LOCK={DEFAULT|SHARED|EXCLUSIVE}</code> is
              supported.</td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">REPAIR PARTITION</code></a></td>
            <td>No</td>
            <td>Yes</td>
            <td>Yes</td>
            <td></td>
          </tr><tr>
            <td scope="row"><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">REMOVE
              PARTITIONING</code></a></td>
            <td>No</td>
            <td>No</td>
            <td>No</td>
            <td>Permits <code class="literal">ALGORITHM=COPY</code>,
              <code class="literal">LOCK={DEFAULT|SHARED|EXCLUSIVE}</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        Non-partitioning online <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> operations on partitioned tables follow the same
        rules that apply to regular tables. However,
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> performs online
        operations on each table partition, which causes increased
        demand on system resources due to operations being performed on
        multiple partitions.
      </p><p>
        For additional information about <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> partitioning clauses, see
        <a class="xref" href="sql-syntax.html#alter-table-partition-options" title="Partitioning Options">Partitioning Options</a>, and
        <a class="xref" href="sql-syntax.html#alter-table-partition-operations" title="13.1.9.1 ALTER TABLE Partition Operations">Section 13.1.9.1, “ALTER TABLE Partition Operations”</a>. For
        information about partitioning in general, see
        <a class="xref" href="partitioning.html" title="Chapter 23 Partitioning">Chapter 23, <i>Partitioning</i></a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-online-ddl-performance"></a>15.12.2 Online DDL Performance and Concurrency</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091644900352"></a><p>
      Online DDL improves several aspects of MySQL operation:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Applications that access the table are more responsive because
          queries and DML operations on the table can proceed while the
          DDL operation is in progress. Reduced locking and waiting for
          MySQL server resources leads to greater scalability, even for
          operations that are not involved in the DDL operation.
        </p></li><li class="listitem"><p>
          Instant operations only modify metadata in the data
          dictionary. No metadata locks are taken on the table, and
          table data is unaffected, making operations instantaneous.
          Concurrent DML is unaffected.
        </p></li><li class="listitem"><p>
          Online operations avoid the disk I/O and CPU cycles associated
          with the table-copy method, which minimizes overall load on
          the database. Minimizing load helps maintain good performance
          and high throughput during the DDL operation.
        </p></li><li class="listitem"><p>
          Online operations read less data into the buffer pool than
          table-copy operations, which reduces purging of frequently
          accessed data from memory. Purging of frequently accessed data
          can cause a temporary performance dip after a DDL operation.
</p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-online-ddl-locking-options"></a>The LOCK clause</h4>

</div>

</div>

</div>
<p>
        By default, MySQL uses as little locking as possible during a
        DDL operation. The <code class="literal">LOCK</code> clause can be
        specified for in-place operations and some copy operations to
        enforce more restrictive locking, if required. If the
        <code class="literal">LOCK</code> clause specifies a less restrictive
        level of locking than is permitted for a particular DDL
        operation, the statement fails with an error.
        <code class="literal">LOCK</code> clauses are described below, in order of
        least to most restrictive:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">LOCK=NONE</code>:
          </p><p>
            Permits concurrent queries and DML.
          </p><p>
            For example, use this clause for tables involving customer
            signups or purchases, to avoid making the tables unavailable
            during lengthy DDL operations.
          </p></li><li class="listitem"><p>
            <code class="literal">LOCK=SHARED</code>:
          </p><p>
            Permits concurrent queries but blocks DML.
          </p><p>
            For example, use this clause on data warehouse tables, where
            you can delay data load operations until the DDL operation
            is finished, but queries cannot be delayed for long periods.
          </p></li><li class="listitem"><p>
            <code class="literal">LOCK=DEFAULT</code>:
          </p><p>
            Permits as much concurrency as possible (concurrent queries,
            DML, or both). Omitting the <code class="literal">LOCK</code> clause
            is the same as specifying <code class="literal">LOCK=DEFAULT</code>.
          </p><p>
            Use this clause when you know that the default locking level
            of the DDL statement will not cause availability problems
            for the table.
          </p></li><li class="listitem"><p>
            <code class="literal">LOCK=EXCLUSIVE</code>:
          </p><p>
            Blocks concurrent queries and DML.
          </p><p>
            Use this clause if the primary concern is finishing the DDL
            operation in the shortest amount of time possible, and
            concurrent query and DML access is not necessary. You might
            also use this clause if the server is supposed to be idle,
            to avoid unexpected table accesses.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-online-ddl-metadata-locks"></a>Online DDL and Metadata Locks</h4>

</div>

</div>

</div>
<p>
        Online DDL operations can be viewed as having three phases:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="emphasis"><em>Phase 1: Initialization</em></span>
          </p><p>
            In the initialization phase, the server determines how much
            concurrency is permitted during the operation, taking into
            account storage engine capabilities, operations specified in
            the statement, and user-specified
            <code class="literal">ALGORITHM</code> and <code class="literal">LOCK</code>
            options. During this phase, a shared upgradeable metadata
            lock is taken to protect the current table definition.
          </p></li><li class="listitem"><p>
            <span class="emphasis"><em>Phase 2: Execution</em></span>
          </p><p>
            In this phase, the statement is prepared and executed.
            Whether the metadata lock is upgraded to exclusive depends
            on the factors assessed in the initialization phase. If an
            exclusive metadata lock is required, it is only taken
            briefly during statement preparation.
          </p></li><li class="listitem"><p>
            <span class="emphasis"><em>Phase 3: Commit Table Definition</em></span>
          </p><p>
            In the commit table definition phase, the metadata lock is
            upgraded to exclusive to evict the old table definition and
            commit the new one. Once granted, the duration of the
            exclusive metadata lock is brief.
</p></li></ul>
</div>
<p>
        Due to the exclusive metadata lock requirements outlined above,
        an online DDL operation may have to wait for concurrent
        transactions that hold metadata locks on the table to commit or
        rollback. Transactions started before or during the DDL
        operation can hold metadata locks on the table being altered. In
        the case of a long running or inactive transaction, an online
        DDL operation can time out waiting for an exclusive metadata
        lock. Additionally, a pending exclusive metadata lock requested
        by an online DDL operation blocks subsequent transactions on the
        table.
      </p><p>
        The following example demonstrates an online DDL operation
        waiting for an exclusive metadata lock, and how a pending
        metadata lock blocks subsequent transactions on the table.
      </p><p>
        Session 1:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; CREATE TABLE t1 (c1 INT) ENGINE=InnoDB;
mysql&gt; START TRANSACTION;
mysql&gt; SELECT * FROM t1;
</pre><p>
        The session 1 <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> statement
        takes a shared metadata lock on table t1.
      </p><p>
        Session 2:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; ALTER TABLE t1 ADD COLUMN x INT, ALGORITHM=INPLACE, LOCK=NONE;
</pre><p>
        The online DDL operation in session 2, which requires an
        exclusive metadata lock on table t1 to commit table definition
        changes, must wait for the session 1 transaction to commit or
        roll back.
      </p><p>
        Session 3:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; SELECT * FROM t1; 
</pre><p>
        The <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> statement issued in
        session 3 is blocked waiting for the exclusive metadata lock
        requested by the <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
        operation in session 2 to be granted.
      </p><p>
        You can use
        <a class="link" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST Syntax"><code class="literal">SHOW FULL
        PROCESSLIST</code></a> to determine if transactions are waiting
        for a metadata lock.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW FULL PROCESSLIST\G</code></strong>
...
*************************** 2. row ***************************
     Id: 5
   User: root
   Host: localhost
     db: test
Command: Query
   Time: 44
  State: Waiting for table metadata lock
   Info: ALTER TABLE t1 ADD COLUMN x INT, ALGORITHM=INPLACE, LOCK=NONE
...
*************************** 4. row ***************************
     Id: 7
   User: root
   Host: localhost
     db: test
Command: Query
   Time: 5
  State: Waiting for table metadata lock
   Info: SELECT * FROM t1
4 rows in set (0.00 sec)  
</pre><p>
        Metadata lock information is also exposed through the
        Performance Schema <a class="link" href="performance-schema.html#metadata-locks-table" title="26.12.12.3 The metadata_locks Table"><code class="literal">metadata_locks</code></a>
        table, which provides information about metadata lock
        dependencies between sessions, the metadata lock a session is
        waiting for, and the session that currently holds the metadata
        lock. For more information, see
        <a class="xref" href="performance-schema.html#metadata-locks-table" title="26.12.12.3 The metadata_locks Table">Section 26.12.12.3, “The metadata_locks Table”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-online-ddl-performance-comparison"></a>Online DDL Performance</h4>

</div>

</div>

</div>
<p>
        The performance of a DDL operation is largely determined by
        whether the operation is performed instantly, in place, and
        whether it rebuilds the table.
      </p><p>
        To assess the relative performance of a DDL operation, you can
        compare results using <code class="literal">ALGORITHM=INSTANT</code>,
        <code class="literal">ALGORITHM=INPLACE</code>, and
        <code class="literal">ALGORITHM=COPY</code>. A statement can also be run
        with <a class="link" href="server-administration.html#sysvar_old_alter_table"><code class="literal">old_alter_table</code></a> enabled to
        force the use of <code class="literal">ALGORITHM=COPY</code>.
      </p><p>
        For DDL operations that modify table data, you can determine
        whether a DDL operation performs changes in place or performs a
        table copy by looking at the <span class="quote">“<span class="quote">rows affected</span>”</span> value
        displayed after the command finishes. For example:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Changing the default value of a column (fast, does not
            affect the table data):
          </p><pre data-lang="sql" class="programlisting">
Query OK, 0 rows affected (0.07 sec)
</pre></li><li class="listitem"><p>
            Adding an index (takes time, but <code class="literal">0 rows
            affected</code> shows that the table is not copied):
          </p><pre data-lang="sql" class="programlisting">
Query OK, 0 rows affected (21.42 sec)
</pre></li><li class="listitem"><p>
            Changing the data type of a column (takes substantial time
            and requires rebuilding all the rows of the table):
          </p><pre data-lang="sql" class="programlisting">
Query OK, 1671168 rows affected (1 min 35.54 sec)
</pre></li></ul>
</div>
<p>
        Before running a DDL operation on a large table, check whether
        the operation is fast or slow as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Clone the table structure.
          </p></li><li class="listitem"><p>
            Populate the cloned table with a small amount of data.
          </p></li><li class="listitem"><p>
            Run the DDL operation on the cloned table.
          </p></li><li class="listitem"><p>
            Check whether the <span class="quote">“<span class="quote">rows affected</span>”</span> value is zero
            or not. A nonzero value means the operation copies table
            data, which might require special planning. For example, you
            might do the DDL operation during a period of scheduled
            downtime, or on each replication slave server one at a time.
</p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          For a greater understanding of the MySQL processing associated
          with a DDL operation, examine Performance Schema and
          <code class="literal">INFORMATION_SCHEMA</code> tables related to
          <code class="literal">InnoDB</code> before and after DDL operations to
          see the number of physical reads, writes, memory allocations,
          and so on.
        </p><p>
          Performance Schema stage events can be used to monitor
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> progress. See
          <a class="xref" href="innodb-storage-engine.html#monitor-alter-table-performance-schema" title="15.15.1 Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance Schema">Section 15.15.1, “Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance
      Schema”</a>.
</p>
</div>
<p>
        Because there is some processing work involved with recording
        the changes made by concurrent DML operations, then applying
        those changes at the end, an online DDL operation could take
        longer overall than the table-copy mechanism that blocks table
        access from other sessions. The reduction in raw performance is
        balanced against better responsiveness for applications that use
        the table. When evaluating the techniques for changing table
        structure, consider end-user perception of performance, based on
        factors such as load times for web pages.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-online-ddl-space-requirements"></a>15.12.3 Online DDL Space Requirements</h3>

</div>

</div>

</div>
<p>
      Space requirements for in-place online DDL operations are outlined
      below. Space requirements do not apply to operations that are
      performed instantly.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Space for temporary log files
        </p><p>
          A temporary log file records concurrent DML when an online DDL
          operation creates an index or alters a table. The temporary
          log file is extended as required by the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_sort_buffer_size"><code class="literal">innodb_sort_buffer_size</code></a> up to
          a maximum specified by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_online_alter_log_max_size"><code class="literal">innodb_online_alter_log_max_size</code></a>.
          If a temporary log file exceeds the size limit, the online DDL
          operation fails, and uncommitted concurrent DML operations are
          rolled back. A large
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_online_alter_log_max_size"><code class="literal">innodb_online_alter_log_max_size</code></a>
          setting permits more DML during an online DDL operation, but
          it also extends the period of time at the end of the DDL
          operation when the table is locked to apply logged DML.
        </p><p>
          If the operation takes a long time and concurrent DML modifies
          the table so much that the size of the temporary log file
          exceeds the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_online_alter_log_max_size"><code class="literal">innodb_online_alter_log_max_size</code></a>,
          the online DDL operation fails with a
          <code class="literal">DB_ONLINE_LOG_TOO_BIG</code> error.
        </p></li><li class="listitem"><p>
          Space for temporary sort files
        </p><p>
          Online DDL operations that rebuild the table write temporary
          sort files to the MySQL temporary directory
          (<code class="literal">$TMPDIR</code> on Unix, <code class="literal">%TEMP%</code>
          on Windows, or the directory specified by
          <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">--tmpdir</code></a>) during index
          creation. Temporary sort files are not created in the
          directory that contains the original table. Each temporary
          sort file is large enough to hold all secondary index columns
          plus the primary key columns of the clustered index. Temporary
          sort files are removed as soon as their contents are merged
          into the final table or index. Temporary sort files may
          require space equal to the amount of data in the table plus
          indexes. An online DDL operation that rebuilds the table
          reports an error if it uses all of the available disk space on
          the file system where the data directory resides.
        </p><p>
          If the MySQL temporary directory is not large enough to hold
          the sort files, set <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a> to
          a different directory. Alternatively, define a separate
          temporary directory for online DDL operations using
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_tmpdir"><code class="literal">innodb_tmpdir</code></a>. This option
          was introduced to help avoid temporary directory overflows
          that could occur as a result of large temporary sort files.
        </p></li><li class="listitem"><p>
          Space for an intermediate table file
        </p><p>
          Some online DDL operations that rebuild the table create a
          temporary intermediate table file in the same directory as the
          original table. An intermediate table file may require space
          equal to the size of the original table. Intermediate table
          file names begin with <code class="filename">#sql-ib</code> prefix and
          only appear briefly during the online DDL operation.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_tmpdir"><code class="literal">innodb_tmpdir</code></a> option is
          not applicable to intermediate table files.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-online-ddl-single-multi"></a>15.12.4 Simplifying DDL Statements with Online DDL</h3>

</div>

</div>

</div>
<p>
      Before the introduction of <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online
      DDL</a>, it was common practice to combine many DDL operations
      into a single <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement. Because each <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement involved copying and rebuilding the table, it was more
      efficient to make several changes to the same table at once, since
      those changes could all be done with a single rebuild operation
      for the table. The downside was that SQL code involving DDL
      operations was harder to maintain and to reuse in different
      scripts. If the specific changes were different each time, you
      might have to construct a new complex <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> for each slightly different scenario.
    </p><p>
      For DDL operations that can be done online, you can separate them
      into individual <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statements for easier scripting and maintenance, without
      sacrificing efficiency. For example, you might take a complicated
      statement such as:
    </p><pre data-lang="sql" class="programlisting">
ALTER TABLE t1 ADD INDEX i1(c1), ADD UNIQUE INDEX i2(c2),
  CHANGE c4_old_name c4_new_name INTEGER UNSIGNED;
</pre><p>
      and break it down into simpler parts that can be tested and
      performed independently, such as:
    </p><pre data-lang="sql" class="programlisting">
ALTER TABLE t1 ADD INDEX i1(c1);
ALTER TABLE t1 ADD UNIQUE INDEX i2(c2);
ALTER TABLE t1 CHANGE c4_old_name c4_new_name INTEGER UNSIGNED NOT NULL;
</pre><p>
      You might still use multi-part <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> statements for:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Operations that must be performed in a specific sequence, such
          as creating an index followed by a foreign key constraint that
          uses that index.
        </p></li><li class="listitem"><p>
          Operations all using the same specific <code class="literal">LOCK</code>
          clause, that you want to either succeed or fail as a group.
        </p></li><li class="listitem"><p>
          Operations that cannot be performed online, that is, that
          still use the table-copy method.
        </p></li><li class="listitem"><p>
          Operations for which you specify
          <code class="literal">ALGORITHM=COPY</code> or
          <a class="link" href="server-administration.html#sysvar_old_alter_table"><code class="literal">old_alter_table=1</code></a>, to force
          the table-copying behavior if needed for precise
          backward-compatibility in specialized scenarios.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-online-ddl-failure-conditions"></a>15.12.5 Online DDL Failure Conditions</h3>

</div>

</div>

</div>
<p>
      The failure of an online DDL operation is typically due to one of
      the following conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          An <code class="literal">ALGORITHM</code> clause specifies an algorithm
          that is not compatible with the particular type of DDL
          operation or storage engine.
        </p></li><li class="listitem"><p>
          A <code class="literal">LOCK</code> clause specifies a low degree of
          locking (<code class="literal">SHARED</code> or <code class="literal">NONE</code>)
          that is not compatible with the particular type of DDL
          operation.
        </p></li><li class="listitem"><p>
          A timeout occurs while waiting for an
          <a class="link" href="glossary.html#glos_exclusive_lock" title="exclusive lock">exclusive lock</a> on
          the table, which may be needed briefly during the initial and
          final phases of the DDL operation.
        </p></li><li class="listitem"><p>
          The <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a> or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_tmpdir"><code class="literal">innodb_tmpdir</code></a> file system
          runs out of disk space, while MySQL writes temporary sort
          files on disk during index creation. For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-space-requirements" title="15.12.3 Online DDL Space Requirements">Section 15.12.3, “Online DDL Space Requirements”</a>.
        </p></li><li class="listitem"><p>
          The operation takes a long time and concurrent DML modifies
          the table so much that the size of the temporary online log
          exceeds the value of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_online_alter_log_max_size"><code class="literal">innodb_online_alter_log_max_size</code></a>
          configuration option. This condition causes a
          <code class="literal">DB_ONLINE_LOG_TOO_BIG</code> error.
        </p></li><li class="listitem"><p>
          Concurrent DML makes changes to the table that are allowed
          with the original table definition, but not with the new one.
          The operation only fails at the very end, when MySQL tries to
          apply all the changes from concurrent DML statements. For
          example, you might insert duplicate values into a column while
          a unique index is being created, or you might insert
          <code class="literal">NULL</code> values into a column while creating a
          <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> index on
          that column. The changes made by the concurrent DML take
          precedence, and the <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          operation is effectively <a class="link" href="glossary.html#glos_rollback" title="rollback">rolled
          back</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-online-ddl-limitations"></a>15.12.6 Online DDL Limitations</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091644759280"></a><a class="indexterm" name="idm140091644757792"></a><a class="indexterm" name="idm140091644756304"></a><p>
      The following limitations apply to online DDL operations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The table is copied when creating an index on a
          <code class="literal">TEMPORARY TABLE</code>.
        </p></li><li class="listitem"><p>
          The <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> clause
          <code class="literal">LOCK=NONE</code> is not permitted if there are
          <code class="literal">ON...CASCADE</code> or <code class="literal">ON...SET
          NULL</code> constraints on the table.
        </p></li><li class="listitem"><p>
          Before an in-place online DDL operation can finish, it must
          wait for transactions that hold metadata locks on the table to
          commit or roll back. An online DDL operation may briefly
          require an exclusive metadata lock on the table during its
          execution phase, and always requires one in the final phase of
          the operation when updating the table definition.
          Consequently, transactions holding metadata locks on the table
          can cause an online DDL operation to block. The transactions
          that hold metadata locks on the table may have been started
          before or during the online DDL operation. A long running or
          inactive transaction that holds a metadata lock on the table
          can cause an online DDL operation to timeout.
        </p></li><li class="listitem"><p>
          When running an in-place online DDL operation, the thread that
          runs the <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement
          applies an online log of DML operations that were run
          concurrently on the same table from other connection threads.
          When the DML operations are applied, it is possible to
          encounter a duplicate key entry error (<span class="errortext">ERROR 1062
          (23000): Duplicate entry</span>), even if the duplicate
          entry is only temporary and would be reverted by a later entry
          in the online log. This is similar to the idea of a foreign
          key constraint check in <code class="literal">InnoDB</code> in which
          constraints must hold during a transaction.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> for an
          <code class="literal">InnoDB</code> table is mapped to an
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation to
          rebuild the table and update index statistics and free unused
          space in the clustered index. Secondary indexes are not
          created as efficiently because keys are inserted in the order
          they appeared in the primary key.
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> is supported
          with the addition of online DDL support for rebuilding regular
          and partitioned <code class="literal">InnoDB</code> tables.
        </p></li><li class="listitem"><p>
          Tables created before MySQL 5.6 that include temporal columns
          (<a class="link" href="data-types.html#datetime" title="11.3.1 The DATE, DATETIME, and TIMESTAMP Types"><code class="literal">DATE</code></a>,
          <a class="link" href="data-types.html#datetime" title="11.3.1 The DATE, DATETIME, and TIMESTAMP Types"><code class="literal">DATETIME</code></a> or
          <a class="link" href="data-types.html#datetime" title="11.3.1 The DATE, DATETIME, and TIMESTAMP Types"><code class="literal">TIMESTAMP</code></a>) and have not been
          rebuilt using <code class="literal"> ALGORITHM=COPY</code> do not
          support <code class="literal">ALGORITHM=INPLACE</code>. In this case, an
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE ...
          ALGORITHM=INPLACE</code></a> operation returns the following
          error:
        </p><pre data-lang="sql" class="programlisting">
ERROR 1846 (0A000): ALGORITHM=INPLACE is not supported.
Reason: Cannot change column type INPLACE. Try ALGORITHM=COPY.
</pre></li><li class="listitem"><p>
          The following limitations are generally applicable to online
          DDL operations on large tables that involve rebuilding the
          table:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              There is no mechanism to pause an online DDL operation or
              to throttle I/O or CPU usage for an online DDL operation.
            </p></li><li class="listitem"><p>
              Rollback of an online DDL operation can be expensive
              should the operation fail.
            </p></li><li class="listitem"><p>
              Long running online DDL operations can cause replication
              lag. An online DDL operation must finish running on the
              master before it is run on the slave. Also, DML that was
              processed concurrently on the master is only processed on
              the slave after the DDL operation on the slave is
              completed.
</p></li></ul>
</div>
<p>
          For additional information related to running online DDL
          operations on large tables, see
          <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-performance" title="15.12.2 Online DDL Performance and Concurrency">Section 15.12.2, “Online DDL Performance and Concurrency”</a>.
</p></li></ul>
</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-parameters"></a>15.13 InnoDB Startup Options and System Variables</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140091644719088"></a><a class="indexterm" name="idm140091644717648"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          System variables that are true or false can be enabled at
          server startup by naming them, or disabled by using a
          <code class="literal">--skip-</code> prefix. For example, to enable or
          disable the <code class="literal">InnoDB</code> adaptive hash index, you
          can use
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="option">--innodb-adaptive-hash-index</code></a> or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="option">--skip-innodb-adaptive-hash-index</code></a>
          on the command line, or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a> or
          <code class="literal">skip_innodb_adaptive_hash_index</code> in an
          option file.
        </p></li><li class="listitem"><p>
          System variables that take a numeric value can be specified as
          <code class="option">--<em class="replaceable"><code>var_name</code></em>=<em class="replaceable"><code>value</code></em></code>
          on the command line or as
          <code class="literal"><em class="replaceable"><code>var_name</code></em>=<em class="replaceable"><code>value</code></em></code>
          in option files.
        </p></li><li class="listitem"><p>
          Many system variables can be changed at runtime (see
          <a class="xref" href="server-administration.html#dynamic-system-variables" title="5.1.9.2 Dynamic System Variables">Section 5.1.9.2, “Dynamic System Variables”</a>).
        </p></li><li class="listitem"><p>
          For information about <code class="literal">GLOBAL</code> and
          <code class="literal">SESSION</code> variable scope modifiers, refer to
          the
          <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET</code></a>
          statement documentation.
        </p></li><li class="listitem"><p>
          Certain options control the locations and layout of the
          <code class="literal">InnoDB</code> data files.
          <a class="xref" href="innodb-storage-engine.html#innodb-init-startup-configuration" title="15.8.1 InnoDB Startup Configuration">Section 15.8.1, “InnoDB Startup Configuration”</a> explains
          how to use these options.
        </p></li><li class="listitem"><p>
          Some options, which you might not use initially, help tune
          <code class="literal">InnoDB</code> performance characteristics based on
          machine capacity and your database
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
        </p></li><li class="listitem"><p>
          For more information on specifying options and system
          variables, see <a class="xref" href="programs.html#program-options" title="4.2.2 Specifying Program Options">Section 4.2.2, “Specifying Program Options”</a>.
</p></li></ul>
</div>

<div class="table">
<a name="idm140091644694480"></a><p class="title"><b>Table 15.25 InnoDB Option and Variable Reference</b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Reference for InnoDB command-line options and system variables."><col width="20%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><thead><tr><th scope="col">Name</th>
<th scope="col">Cmd-Line</th>
<th scope="col">Option File</th>
<th scope="col">System Var</th>
<th scope="col">Status Var</th>
<th scope="col">Var Scope</th>
<th scope="col">Dynamic</th>
</tr></thead><tbody><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_enable_binlog">daemon_memcached_enable_binlog</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_name">daemon_memcached_engine_lib_name</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_path">daemon_memcached_engine_lib_path</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option">daemon_memcached_option</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size">daemon_memcached_r_batch_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size">daemon_memcached_w_batch_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_foreign_key_checks">foreign_key_checks</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Both</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#option_mysqld_ignore-builtin-innodb">ignore-builtin-innodb</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="innodb-storage-engine.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#option_mysqld_innodb">innodb</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing">innodb_adaptive_flushing</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing_lwm">innodb_adaptive_flushing_lwm</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index">innodb_adaptive_hash_index</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index_parts">innodb_adaptive_hash_index_parts</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_max_sleep_delay">innodb_adaptive_max_sleep_delay</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_bk_commit_interval">innodb_api_bk_commit_interval</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_disable_rowlock">innodb_api_disable_rowlock</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_binlog">innodb_api_enable_binlog</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_mdl">innodb_api_enable_mdl</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level">innodb_api_trx_level</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment">innodb_autoextend_increment</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode">innodb_autoinc_lock_mode</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_available_undo_logs">Innodb_available_undo_logs</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_background_drop_list_empty">innodb_background_drop_list_empty</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_bytes_data">Innodb_buffer_pool_bytes_data</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_bytes_dirty">Innodb_buffer_pool_bytes_dirty</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size">innodb_buffer_pool_chunk_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_debug">innodb_buffer_pool_debug</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown">innodb_buffer_pool_dump_at_shutdown</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_now">innodb_buffer_pool_dump_now</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct">innodb_buffer_pool_dump_pct</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_dump_status">Innodb_buffer_pool_dump_status</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_filename">innodb_buffer_pool_filename</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file">innodb_buffer_pool_in_core_file</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances">innodb_buffer_pool_instances</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_abort">innodb_buffer_pool_load_abort</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup">innodb_buffer_pool_load_at_startup</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_now">innodb_buffer_pool_load_now</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_load_status">Innodb_buffer_pool_load_status</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_data">Innodb_buffer_pool_pages_data</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_dirty">Innodb_buffer_pool_pages_dirty</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_flushed">Innodb_buffer_pool_pages_flushed</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_free">Innodb_buffer_pool_pages_free</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_latched">Innodb_buffer_pool_pages_latched</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_misc">Innodb_buffer_pool_pages_misc</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_total">Innodb_buffer_pool_pages_total</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead">Innodb_buffer_pool_read_ahead</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted">Innodb_buffer_pool_read_ahead_evicted</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_rnd">Innodb_buffer_pool_read_ahead_rnd</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_requests">Innodb_buffer_pool_read_requests</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_reads">Innodb_buffer_pool_reads</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_resize_status">Innodb_buffer_pool_resize_status</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size">innodb_buffer_pool_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_wait_free">Innodb_buffer_pool_wait_free</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_write_requests">Innodb_buffer_pool_write_requests</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size">innodb_change_buffer_max_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering">innodb_change_buffering</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering_debug">innodb_change_buffering_debug</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_checkpoint_disabled">innodb_checkpoint_disabled</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm">innodb_checksum_algorithm</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_cmp_per_index_enabled">innodb_cmp_per_index_enabled</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_commit_concurrency">innodb_commit_concurrency</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compress_debug">innodb_compress_debug</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct">innodb_compression_failure_threshold_pct</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_level">innodb_compression_level</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max">innodb_compression_pad_pct_max</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets">innodb_concurrency_tickets</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path">innodb_data_file_path</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_fsyncs">Innodb_data_fsyncs</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir">innodb_data_home_dir</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_fsyncs">Innodb_data_pending_fsyncs</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_reads">Innodb_data_pending_reads</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_writes">Innodb_data_pending_writes</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_read">Innodb_data_read</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_reads">Innodb_data_reads</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_writes">Innodb_data_writes</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_written">Innodb_data_written</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_dblwr_pages_written">Innodb_dblwr_pages_written</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_dblwr_writes">Innodb_dblwr_writes</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ddl_log_crash_reset_debug">innodb_ddl_log_crash_reset_debug</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_deadlock_detect">innodb_deadlock_detect</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_dedicated_server">innodb_dedicated_server</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format">innodb_default_row_format</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories">innodb_directories</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_disable_sort_file_cache">innodb_disable_sort_file_cache</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite">innodb_doublewrite</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown">innodb_fast_shutdown</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fil_make_page_dirty_debug">innodb_fil_make_page_dirty_debug</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table">innodb_file_per_table</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor">innodb_fill_factor</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_timeout">innodb_flush_log_at_timeout</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit">innodb_flush_log_at_trx_commit</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method">innodb_flush_method</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_neighbors">innodb_flush_neighbors</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync">innodb_flush_sync</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops">innodb_flushing_avg_loops</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_load_corrupted">innodb_force_load_corrupted</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery">innodb_force_recovery</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fsync_threshold">innodb_fsync_threshold</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_aux_table">innodb_ft_aux_table</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_cache_size">innodb_ft_cache_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_diag_print">innodb_ft_enable_diag_print</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_stopword">innodb_ft_enable_stopword</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Both</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_max_token_size">innodb_ft_max_token_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_min_token_size">innodb_ft_min_token_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_num_word_optimize">innodb_ft_num_word_optimize</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_result_cache_limit">innodb_ft_result_cache_limit</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_server_stopword_table">innodb_ft_server_stopword_table</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_sort_pll_degree">innodb_ft_sort_pll_degree</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size">innodb_ft_total_cache_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_user_stopword_table">innodb_ft_user_stopword_table</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Both</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_have_atomic_builtins">Innodb_have_atomic_builtins</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity">innodb_io_capacity</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max">innodb_io_capacity_max</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_limit_optimistic_insert_debug">innodb_limit_optimistic_insert_debug</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout">innodb_lock_wait_timeout</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Both</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size">innodb_log_buffer_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Varies</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checkpoint_fuzzy_now">innodb_log_checkpoint_fuzzy_now</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checkpoint_now">innodb_log_checkpoint_now</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checksums">innodb_log_checksums</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_compressed_pages">innodb_log_compressed_pages</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size">innodb_log_file_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group">innodb_log_files_in_group</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_group_home_dir">innodb_log_group_home_dir</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_spin_cpu_abs_lwm">innodb_log_spin_cpu_abs_lwm</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_spin_cpu_pct_hwm">innodb_log_spin_cpu_pct_hwm</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_wait_for_flush_spin_hwm">innodb_log_wait_for_flush_spin_hwm</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_waits">Innodb_log_waits</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size">innodb_log_write_ahead_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_write_requests">Innodb_log_write_requests</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_writes">Innodb_log_writes</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_lru_scan_depth">innodb_lru_scan_depth</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct">innodb_max_dirty_pages_pct</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm">innodb_max_dirty_pages_pct_lwm</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag">innodb_max_purge_lag</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag_delay">innodb_max_purge_lag_delay</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size">innodb_max_undo_log_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_merge_threshold_set_all_debug">innodb_merge_threshold_set_all_debug</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_disable">innodb_monitor_disable</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable">innodb_monitor_enable</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset">innodb_monitor_reset</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset_all">innodb_monitor_reset_all</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_num_open_files">Innodb_num_open_files</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_numa_interleave">innodb_numa_interleave</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct">innodb_old_blocks_pct</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time">innodb_old_blocks_time</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_online_alter_log_max_size">innodb_online_alter_log_max_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_open_files">innodb_open_files</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_fulltext_only">innodb_optimize_fulltext_only</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_fsyncs">Innodb_os_log_fsyncs</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_pending_fsyncs">Innodb_os_log_pending_fsyncs</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_pending_writes">Innodb_os_log_pending_writes</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_written">Innodb_os_log_written</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_cleaners">innodb_page_cleaners</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_page_size">Innodb_page_size</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size">innodb_page_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_created">Innodb_pages_created</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_read">Innodb_pages_read</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_written">Innodb_pages_written</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_parallel_read_threads">innodb_parallel_read_threads</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Session</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks">innodb_print_all_deadlocks</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_ddl_logs">innodb_print_ddl_logs</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_batch_size">innodb_purge_batch_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency">innodb_purge_rseg_truncate_frequency</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads">innodb_purge_threads</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead">innodb_random_read_ahead</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold">innodb_read_ahead_threshold</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads">innodb_read_io_threads</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only">innodb_read_only</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_redo_log_encrypt">innodb_redo_log_encrypt</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_replication_delay">innodb_replication_delay</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout">innodb_rollback_on_timeout</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments">innodb_rollback_segments</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_current_waits">Innodb_row_lock_current_waits</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time">Innodb_row_lock_time</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time_avg">Innodb_row_lock_time_avg</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time_max">Innodb_row_lock_time_max</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_waits">Innodb_row_lock_waits</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_deleted">Innodb_rows_deleted</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_inserted">Innodb_rows_inserted</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_read">Innodb_rows_read</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_updated">Innodb_rows_updated</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_saved_page_number_debug">innodb_saved_page_number_debug</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_scan_directories">innodb_scan_directories</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sort_buffer_size">innodb_sort_buffer_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay">innodb_spin_wait_delay</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_pause_multiplier">innodb_spin_wait_pause_multiplier</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc">innodb_stats_auto_recalc</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_include_delete_marked">innodb_stats_include_delete_marked</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_method">innodb_stats_method</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata">innodb_stats_on_metadata</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent">innodb_stats_persistent</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages">innodb_stats_persistent_sample_pages</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages">innodb_stats_transient_sample_pages</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#option_mysqld_innodb-status-file">innodb-status-file</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output">innodb_status_output</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks">innodb_status_output_locks</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode">innodb_strict_mode</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Both</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_array_size">innodb_sync_array_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_debug">innodb_sync_debug</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_spin_loops">innodb_sync_spin_loops</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks">innodb_table_locks</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Both</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path">innodb_temp_data_file_path</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_tablespaces_dir">innodb_temp_tablespaces_dir</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency">innodb_thread_concurrency</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay">innodb_thread_sleep_delay</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_tmpdir">innodb_tmpdir</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Both</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_truncated_status_writes">Innodb_truncated_status_writes</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_trx_purge_view_update_only_debug">innodb_trx_purge_view_update_only_debug</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_trx_rseg_n_slots_debug">innodb_trx_rseg_n_slots_debug</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory">innodb_undo_directory</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_encrypt">innodb_undo_log_encrypt</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate">innodb_undo_log_truncate</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs">innodb_undo_logs</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces">innodb_undo_tablespaces</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Varies</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio">innodb_use_native_aio</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_version">innodb_version</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads">innodb_write_io_threads</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_unique_checks">unique_checks</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Both</td>
<td>Yes</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<h3><a name="idm140091643153024"></a>InnoDB Command Options</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_ignore-builtin-innodb"></a>
          <a class="indexterm" name="idm140091643151120"></a>

          <a class="indexterm" name="idm140091643149664"></a>

          <code class="option">--ignore-builtin-innodb</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for ignore-builtin-innodb"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--ignore-builtin-innodb[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td>
<td>Yes (removed in 8.0.3)</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr></tbody></table>
</div>
<p>
          In earlier versions of MySQL, this option caused the server to
          behave as if the built-in <code class="literal">InnoDB</code> were not
          present, which enabled the <code class="literal">InnoDB Plugin</code> to
          be used instead. In MySQL 8.0,
          <code class="literal">InnoDB</code> is the default storage engine and
          <code class="literal">InnoDB Plugin</code> is not used. This option was
          removed in MySQL 8.0.
        </p></li><li class="listitem"><p><a name="option_mysqld_innodb"></a>
          <a class="indexterm" name="idm140091643115872"></a>

          <a class="indexterm" name="idm140091643114416"></a>

          <code class="option">--innodb[=<em class="replaceable"><code>value</code></em>]</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb[=value]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">ON</code></p><p class="valid-value"><code class="literal">FORCE</code></p></td>
</tr></tbody></table>
</div>
<p>
          Controls loading of the <code class="literal">InnoDB</code> storage
          engine, if the server was compiled with
          <code class="literal">InnoDB</code> support. This option has a tristate
          format, with possible values of <code class="literal">OFF</code>,
          <code class="literal">ON</code>, or <code class="literal">FORCE</code>. See
          <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>.
        </p><p>
          To disable <code class="literal">InnoDB</code>, use
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a>
          or
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>.
          In this case, because the default storage engine is
          <a class="link" href="innodb-storage-engine.html" title="Chapter 15 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>, the server does not start
          unless you also use
          <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="option">--default-storage-engine</code></a> and
          <a class="link" href="server-administration.html#sysvar_default_tmp_storage_engine"><code class="option">--default-tmp-storage-engine</code></a> to
          set the default to some other engine for both permanent and
          <code class="literal">TEMPORARY</code> tables.
        </p><p>
          The <code class="literal">InnoDB</code> storage engine can no longer be
          disabled, and the
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a>
          and
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
          options are deprecated and have no effect. Their use results
          in a warning. These options will be removed in a future MySQL
          release.
        </p></li><li class="listitem"><p><a name="option_mysqld_innodb-status-file"></a>
          <a class="indexterm" name="idm140091643072832"></a>

          <a class="indexterm" name="idm140091643071376"></a>

          <code class="option">--innodb-status-file</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb-status-file"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-status-file[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          The <code class="option">--innodb-status-file</code> startup option
          controls whether <code class="literal">InnoDB</code> creates a file
          named
          <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
          in the data directory and writes
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> output to it every 15 seconds,
          approximately.
        </p><p>
          The
          <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
          file is not created by default. To create it, start
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
          <code class="option">--innodb-status-file</code> option.
          <code class="literal">InnoDB</code> removes the file when the server is
          shut down normally. If an abnormal shutdown occurs, the status
          file may have to be removed manually.
        </p><p>
          The <code class="option">--innodb-status-file</code> option is intended
          for temporary use, as
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> output generation can affect
          performance, and the
          <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
          file can become quite large over time.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-enabling-monitors" title="15.16.2 Enabling InnoDB Monitors">Section 15.16.2, “Enabling InnoDB Monitors”</a>.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140091643040560"></a>

          <a class="indexterm" name="idm140091643039072"></a>

          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
        </p><p>
          Disable the <code class="literal">InnoDB</code> storage engine. See the
          description of <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb</code></a>.
</p></li></ul>
</div>
<h3><a name="idm140091643034192"></a>InnoDB System Variables</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_daemon_memcached_enable_binlog"></a>
          <a class="indexterm" name="idm140091643032224"></a>

          <code class="literal">daemon_memcached_enable_binlog</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for daemon_memcached_enable_binlog"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--daemon-memcached-enable-binlog[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_enable_binlog">daemon_memcached_enable_binlog</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enable this option on the
          <a class="link" href="glossary.html#glos_master_server" title="master server">master server</a> to use
          the <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
          plugin (<code class="literal">daemon_memcached</code>) with the MySQL
          <a class="link" href="glossary.html#glos_binary_log" title="binary log">binary log</a>. This option
          can only be set at server startup. You must also enable the
          MySQL binary log on the master server using the
          <a class="link" href="replication.html#sysvar_log_bin"><code class="literal">--log-bin</code></a> option.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached-replication" title="15.19.7 The InnoDB memcached Plugin and Replication">Section 15.19.7, “The InnoDB memcached Plugin and Replication”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_engine_lib_name"></a>
          <a class="indexterm" name="idm140091642994528"></a>

          <code class="literal">daemon_memcached_engine_lib_name</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for daemon_memcached_engine_lib_name"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--daemon-memcached-engine-lib-name=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_name">daemon_memcached_engine_lib_name</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>File name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">innodb_engine.so</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies the shared library that implements the
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached-setup" title="15.19.3 Setting Up the InnoDB memcached Plugin">Section 15.19.3, “Setting Up the InnoDB memcached Plugin”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_engine_lib_path"></a>
          <a class="indexterm" name="idm140091642960768"></a>

          <code class="literal">daemon_memcached_engine_lib_path</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for daemon_memcached_engine_lib_path"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--daemon-memcached-engine-lib-path=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_path">daemon_memcached_engine_lib_path</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Directory name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
          The path of the directory containing the shared library that
          implements the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> plugin. The default value is
          NULL, representing the MySQL plugin directory. You should not
          need to modify this parameter unless specifying a
          <code class="literal">memcached</code> plugin for a different storage
          engine that is located outside of the MySQL plugin directory.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached-setup" title="15.19.3 Setting Up the InnoDB memcached Plugin">Section 15.19.3, “Setting Up the InnoDB memcached Plugin”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_option"></a>
          <a class="indexterm" name="idm140091642926176"></a>

          <code class="literal">daemon_memcached_option</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for daemon_memcached_option"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--daemon-memcached-option=options</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option">daemon_memcached_option</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal"></code></td>
</tr></tbody></table>
</div>
<p>
          Used to pass space-separated memcached options to the
          underlying <span class="command"><strong>memcached</strong></span> memory object caching
          daemon on startup. For example, you might change the port that
          <span class="command"><strong>memcached</strong></span> listens on, reduce the maximum
          number of simultaneous connections, change the maximum memory
          size for a key-value pair, or enable debugging messages for
          the error log.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-memcached-setup" title="15.19.3 Setting Up the InnoDB memcached Plugin">Section 15.19.3, “Setting Up the InnoDB memcached Plugin”</a> for usage
          details. For information about <span class="command"><strong>memcached</strong></span>
          options, refer to the <span class="command"><strong>memcached</strong></span> man page.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_r_batch_size"></a>
          <a class="indexterm" name="idm140091642891040"></a>

          <code class="literal">daemon_memcached_r_batch_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for daemon_memcached_r_batch_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--daemon-memcached-r-batch-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size">daemon_memcached_r_batch_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies how many <span class="command"><strong>memcached</strong></span> read
          operations (<code class="literal">get</code> operations) to perform
          before doing a <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> to start
          a new transaction. Counterpart of
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>.
        </p><p>
          This value is set to 1 by default, so that any changes made to
          the table through SQL statements are immediately visible to
          <span class="command"><strong>memcached</strong></span> operations. You might increase it
          to reduce the overhead from frequent commits on a system where
          the underlying table is only being accessed through the
          <span class="command"><strong>memcached</strong></span> interface. If you set the value
          too large, the amount of undo or redo data could impose some
          storage overhead, as with any long-running transaction.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached-setup" title="15.19.3 Setting Up the InnoDB memcached Plugin">Section 15.19.3, “Setting Up the InnoDB memcached Plugin”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_daemon_memcached_w_batch_size"></a>
          <a class="indexterm" name="idm140091642852656"></a>

          <code class="literal">daemon_memcached_w_batch_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for daemon_memcached_w_batch_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--daemon-memcached-w-batch-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size">daemon_memcached_w_batch_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies how many <span class="command"><strong>memcached</strong></span> write
          operations, such as <code class="literal">add</code>,
          <code class="literal">set</code>, and <code class="literal">incr</code>, to
          perform before doing a <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>
          to start a new transaction. Counterpart of
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>.
        </p><p>
          This value is set to 1 by default, on the assumption that data
          being stored is important to preserve in case of an outage and
          should immediately be committed. When storing non-critical
          data, you might increase this value to reduce the overhead
          from frequent commits; but then the last
          <em class="replaceable"><code>N</code></em>-1 uncommitted write operations
          could be lost if a crash occurs.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached-setup" title="15.19.3 Setting Up the InnoDB memcached Plugin">Section 15.19.3, “Setting Up the InnoDB memcached Plugin”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_ignore_builtin_innodb"></a>
          <a class="indexterm" name="idm140091642813936"></a>

          <a class="indexterm" name="idm140091642812896"></a>

          <code class="literal">ignore_builtin_innodb</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for ignore-builtin-innodb"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--ignore-builtin-innodb[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td>
<td>Yes (removed in 8.0.3)</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr></tbody></table>
</div>
<p>
          See the description of
          <a class="link" href="innodb-storage-engine.html#option_mysqld_ignore-builtin-innodb"><code class="option">--ignore-builtin-innodb</code></a> under
          <span class="quote">“<span class="quote">InnoDB Command Options</span>”</span> earlier in this section.
          This variable was removed in MySQL 8.0.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_flushing"></a>
          <a class="indexterm" name="idm140091642780384"></a>

          <a class="indexterm" name="idm140091642779280"></a>

          <code class="literal">innodb_adaptive_flushing</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_adaptive_flushing"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-adaptive-flushing[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing">innodb_adaptive_flushing</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<a class="indexterm" name="idm140091642749504"></a><p>
          Specifies whether to dynamically adjust the rate of flushing
          <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> in the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> based on
          the workload. Adjusting the flush rate dynamically is intended
          to avoid bursts of I/O activity. This setting is enabled by
          default. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="15.8.3.5 Configuring InnoDB Buffer Pool Flushing">Section 15.8.3.5, “Configuring InnoDB Buffer Pool Flushing”</a> for
          more information. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_flushing_lwm"></a>
          <a class="indexterm" name="idm140091642742800"></a>

          <code class="literal">innodb_adaptive_flushing_lwm</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_adaptive_flushing_lwm"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-adaptive-flushing-lwm=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing_lwm">innodb_adaptive_flushing_lwm</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">10</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">70</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the low water mark representing percentage of
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> capacity at
          which <a class="link" href="glossary.html#glos_adaptive_flushing" title="adaptive flushing">adaptive
          flushing</a> is enabled. For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="15.8.3.6 Fine-tuning InnoDB Buffer Pool Flushing">Section 15.8.3.6, “Fine-tuning InnoDB Buffer Pool Flushing”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_hash_index"></a>
          <a class="indexterm" name="idm140091642703232"></a>

          <a class="indexterm" name="idm140091642702128"></a>

          <code class="literal">innodb_adaptive_hash_index</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_adaptive_hash_index"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-adaptive-hash-index[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index">innodb_adaptive_hash_index</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          Whether the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
          index</a> is enabled or disabled. It may be desirable,
          depending on your workload, to dynamically enable or disable
          <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
          indexing</a> to improve query performance. Because the
          adaptive hash index may not be useful for all workloads,
          conduct benchmarks with it both enabled and disabled, using
          realistic workloads. See
          <a class="xref" href="innodb-storage-engine.html#innodb-adaptive-hash" title="15.5.3 Adaptive Hash Index">Section 15.5.3, “Adaptive Hash Index”</a> for details.
        </p><p>
          This variable is enabled by default. You can modify this
          parameter using the <code class="literal">SET GLOBAL</code> statement,
          without restarting the server. Changing the setting at runtime
          requires privileges sufficient to set global system variables.
          See <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>. You can also
          use <code class="option">--skip-innodb-adaptive-hash-index</code> at
          server startup to disable it.
        </p><p>
          Disabling the adaptive hash index empties the hash table
          immediately. Normal operations can continue while the hash
          table is emptied, and executing queries that were using the
          hash table access the index B-trees directly instead. When the
          adaptive hash index is re-enabled, the hash table is populated
          again during normal operation.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_hash_index_parts"></a>
          <a class="indexterm" name="idm140091642664000"></a>

          <a class="indexterm" name="idm140091642662896"></a>

          <code class="literal">innodb_adaptive_hash_index_parts</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_adaptive_hash_index_parts"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-adaptive-hash-index-parts=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index_parts">innodb_adaptive_hash_index_parts</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Numeric</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">8</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">512</code></td>
</tr></tbody></table>
</div>
<p>
          Partitions the adaptive hash index search system. Each index
          is bound to a specific partition, with each partition
          protected by a separate latch.
        </p><p>
          The adaptive hash index search system is partitioned into 8
          parts by default. The maximum setting is 512.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-adaptive-hash" title="15.5.3 Adaptive Hash Index">Section 15.5.3, “Adaptive Hash Index”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_max_sleep_delay"></a>
          <a class="indexterm" name="idm140091642623600"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_max_sleep_delay"><code class="literal">innodb_adaptive_max_sleep_delay</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_adaptive_max_sleep_delay"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-adaptive-max-sleep-delay=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_max_sleep_delay">innodb_adaptive_max_sleep_delay</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">150000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">1000000</code></td>
</tr></tbody></table>
</div>
<p>
          Permits <code class="literal">InnoDB</code> to automatically adjust the
          value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a> up
          or down according to the current workload. Any nonzero value
          enables automated, dynamic adjustment of the
          <code class="literal">innodb_thread_sleep_delay</code> value, up to the
          maximum value specified in the
          <code class="literal">innodb_adaptive_max_sleep_delay</code> option. The
          value represents the number of microseconds. This option can
          be useful in busy systems, with greater than 16
          <code class="literal">InnoDB</code> threads. (In practice, it is most
          valuable for MySQL systems with hundreds or thousands of
          simultaneous connections.)
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="15.8.4 Configuring Thread Concurrency for InnoDB">Section 15.8.4, “Configuring Thread Concurrency for InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_bk_commit_interval"></a>
          <a class="indexterm" name="idm140091642580080"></a>

          <code class="literal">innodb_api_bk_commit_interval</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_api_bk_commit_interval"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-api-bk-commit-interval=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_bk_commit_interval">innodb_api_bk_commit_interval</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">5</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">1073741824</code></td>
</tr></tbody></table>
</div>
<p>
          How often to auto-commit idle connections that use the
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
          interface, in seconds. For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached-txn" title="15.19.6.4 Controlling Transactional Behavior of the InnoDB memcached Plugin">Section 15.19.6.4, “Controlling Transactional Behavior of the InnoDB memcached Plugin”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_disable_rowlock"></a>
          <a class="indexterm" name="idm140091642540608"></a>

          <code class="literal">innodb_api_disable_rowlock</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_api_disable_rowlock"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-api-disable-rowlock[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_disable_rowlock">innodb_api_disable_rowlock</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Use this option to disable row locks when
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
          performs DML operations. By default,
          <code class="literal">innodb_api_disable_rowlock</code> is disabled,
          which means that <span class="command"><strong>memcached</strong></span> requests row
          locks for <code class="literal">get</code> and <code class="literal">set</code>
          operations. When <code class="literal">innodb_api_disable_rowlock</code>
          is enabled, <span class="command"><strong>memcached</strong></span> requests a table lock
          instead of row locks.
        </p><p>
          <code class="literal">innodb_api_disable_rowlock</code> is not dynamic.
          It must be specified on the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> command
          line or entered in the MySQL configuration file. Configuration
          takes effect when the plugin is installed, which occurs when
          the MySQL server is started.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached-txn" title="15.19.6.4 Controlling Transactional Behavior of the InnoDB memcached Plugin">Section 15.19.6.4, “Controlling Transactional Behavior of the InnoDB memcached Plugin”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_enable_binlog"></a>
          <a class="indexterm" name="idm140091642500048"></a>

          <code class="literal">innodb_api_enable_binlog</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_api_enable_binlog"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-api-enable-binlog[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_binlog">innodb_api_enable_binlog</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Lets you use the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> plugin with the MySQL
          <a class="link" href="glossary.html#glos_binary_log" title="binary log">binary log</a>. For more
          information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached-replication-enable-binlog" title="Enabling the InnoDB memcached Binary Log">Enabling the InnoDB memcached Binary Log</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_enable_mdl"></a>
          <a class="indexterm" name="idm140091642466000"></a>

          <code class="literal">innodb_api_enable_mdl</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_api_enable_mdl"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-api-enable-mdl[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_mdl">innodb_api_enable_mdl</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Locks the table used by the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> plugin, so that it cannot be
          dropped or altered by <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a>
          through the SQL interface. For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached-txn" title="15.19.6.4 Controlling Transactional Behavior of the InnoDB memcached Plugin">Section 15.19.6.4, “Controlling Transactional Behavior of the InnoDB memcached Plugin”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_api_trx_level"></a>
          <a class="indexterm" name="idm140091642432096"></a>

          <code class="literal">innodb_api_trx_level</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_api_trx_level"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-api-trx-level=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level">innodb_api_trx_level</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p>
          Controls the transaction
          <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a> on
          queries processed by the <span class="command"><strong>memcached</strong></span>
          interface. The constants corresponding to the familiar names
          are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              0 = <a class="link" href="innodb-storage-engine.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>
            </p></li><li class="listitem"><p>
              1 = <a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>
            </p></li><li class="listitem"><p>
              2 = <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>
            </p></li><li class="listitem"><p>
              3 = <a class="link" href="innodb-storage-engine.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>
</p></li></ul>
</div>
<p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-memcached-txn" title="15.19.6.4 Controlling Transactional Behavior of the InnoDB memcached Plugin">Section 15.19.6.4, “Controlling Transactional Behavior of the InnoDB memcached Plugin”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_autoextend_increment"></a>
          <a class="indexterm" name="idm140091642389952"></a>

          <a class="indexterm" name="idm140091642388848"></a>

          <code class="literal">innodb_autoextend_increment</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_autoextend_increment"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-autoextend-increment=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment">innodb_autoextend_increment</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">64</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">1000</code></td>
</tr></tbody></table>
</div>
<p>
          The increment size (in megabytes) for extending the size of an
          auto-extending <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> file when it becomes full. The default value
          is 64. For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-startup-data-file-configuration" title="System Tablespace Data File Configuration">System Tablespace Data File Configuration</a>, and
          <a class="xref" href="innodb-storage-engine.html#innodb-resize-system-tablespace" title="Resizing the System Tablespace">Resizing the System Tablespace</a>.
        </p><p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
          setting does not affect
          <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
          tablespace files or
          <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
          tablespace</a> files. These files are auto-extending
          regardless of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
          setting. The initial extensions are by small amounts, after
          which extensions occur in increments of 4MB.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_autoinc_lock_mode"></a>
          <a class="indexterm" name="idm140091642343328"></a>

          <a class="indexterm" name="idm140091642342224"></a>

          <code class="literal">innodb_autoinc_lock_mode</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_autoinc_lock_mode"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-autoinc-lock-mode=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode">innodb_autoinc_lock_mode</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&gt;= 8.0.3)</td>
<td><code class="literal">2</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&lt;= 8.0.2)</td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p><p class="valid-value"><code class="literal">2</code></p></td>
</tr></tbody></table>
</div>
<p>
          The <a class="link" href="glossary.html#glos_lock_mode" title="lock mode">lock mode</a> to use for
          generating
          <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
          values. Permissible values are 0, 1, or 2, for traditional,
          consecutive, or interleaved, respectively.
        </p><p>
          The default setting is 2 (interleaved) as of MySQL 8.0, and 1
          (consecutive) before that. The change to interleaved lock mode
          as the default setting reflects the change from
          statement-based to row-based replication as the default
          replication type, which occurred in MySQL 5.7.
          Statement-based replication requires the consecutive
          auto-increment lock mode to ensure that auto-increment values
          are assigned in a predictable and repeatable order for a given
          sequence of SQL statements, whereas row-based replication is
          not sensitive to the execution order of SQL statements.
        </p><p>
          For the characteristics of each lock mode, see
          <a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-lock-modes" title="InnoDB AUTO_INCREMENT Lock Modes">InnoDB AUTO_INCREMENT Lock Modes</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_background_drop_list_empty"></a>
          <a class="indexterm" name="idm140091642297824"></a>

          <a class="indexterm" name="idm140091642296784"></a>

          <code class="literal">innodb_background_drop_list_empty</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_background_drop_list_empty"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-background-drop-list-empty[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_background_drop_list_empty">innodb_background_drop_list_empty</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enabling the
          <code class="literal">innodb_background_drop_list_empty</code> debug
          option helps avoid test case failures by delaying table
          creation until the background drop list is empty. For example,
          if test case A places table <code class="literal">t1</code> on the
          background drop list, test case B waits until the background
          drop list is empty before creating table
          <code class="literal">t1</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_chunk_size"></a>
          <a class="indexterm" name="idm140091642262944"></a>

          <a class="indexterm" name="idm140091642261840"></a>

          <code class="literal">innodb_buffer_pool_chunk_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_chunk_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-chunk-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size">innodb_buffer_pool_chunk_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">134217728</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1048576</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">innodb_buffer_pool_size / innodb_buffer_pool_instances</code></td>
</tr></tbody></table>
</div>
<p>
          <code class="literal">innodb_buffer_pool_chunk_size</code> defines the
          chunk size for <code class="literal">InnoDB</code> buffer pool resizing
          operations. The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
          parameter is dynamic, which allows you to resize the buffer
          pool without restarting the server.
        </p><p>
          To avoid copying all buffer pool pages during resizing
          operations, the operation is performed in
          <span class="quote">“<span class="quote">chunks</span>”</span>. By default,
          <code class="literal">innodb_buffer_pool_chunk_size</code> is 128MB
          (134217728 bytes). The number of pages contained in a chunk
          depends on the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>.
          <code class="literal">innodb_buffer_pool_chunk_size</code> can be
          increased or decreased in units of 1MB (1048576 bytes).
        </p><p>
          The following conditions apply when altering the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          value:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">
              innodb_buffer_pool_chunk_size</code></a> *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
              is larger than the current buffer pool size when the
              buffer pool is initialized,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              is truncated to
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> /
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
            </p></li><li class="listitem"><p>
              Buffer pool size must always be equal to or a multiple of
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
              If you alter
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
              is automatically rounded to a value that is equal to or a
              multiple of
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
              *
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
              The adjustment occurs when the buffer pool is initialized.
</p></li></ul>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Important
</div>
<p>
            Care should be taken when changing
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
            as changing this value can automatically increase the size
            of the buffer pool. Before changing
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>,
            calculate the effect it will have on
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> to
            ensure that the resulting buffer pool size is acceptable.
</p>
</div>
<p>
          To avoid potential performance issues, the number of chunks
          (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> /
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>)
          should not exceed 1000.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-resize" title="15.8.3.1 Configuring InnoDB Buffer Pool Size">Section 15.8.3.1, “Configuring InnoDB Buffer Pool Size”</a> for more
          information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_debug"></a>
          <a class="indexterm" name="idm140091642190160"></a>

          <a class="indexterm" name="idm140091642189120"></a>

          <code class="literal">innodb_buffer_pool_debug</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_debug"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-debug[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_debug">innodb_buffer_pool_debug</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enabling this option permits multiple buffer pool instances
          when the buffer pool is less than 1GB in size, ignoring the
          1GB minimum buffer pool size constraint imposed on
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
          The <code class="literal">innodb_buffer_pool_debug</code> option is only
          available if debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_dump_at_shutdown"></a>
          <a class="indexterm" name="idm140091642153744"></a>

          <code class="literal">innodb_buffer_pool_dump_at_shutdown</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_dump_at_shutdown"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-dump-at-shutdown[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown">innodb_buffer_pool_dump_at_shutdown</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies whether to record the pages cached in the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> when the
          MySQL server is shut down, to shorten the
          <a class="link" href="glossary.html#glos_warm_up" title="warm up">warmup</a> process at the next
          restart. Typically used in combination with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>.
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
          option defines the percentage of most recently used buffer
          pool pages to dump.
        </p><p>
          Both
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
          and <code class="literal">innodb_buffer_pool_load_at_startup</code> are
          enabled by default.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="15.8.3.7 Saving and Restoring the Buffer Pool State">Section 15.8.3.7, “Saving and Restoring the Buffer Pool State”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_dump_now"></a>
          <a class="indexterm" name="idm140091642113840"></a>

          <code class="literal">innodb_buffer_pool_dump_now</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_dump_now"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-dump-now[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_now">innodb_buffer_pool_dump_now</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Immediately records the pages cached in the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. Typically
          used in combination with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_now"><code class="literal">innodb_buffer_pool_load_now</code></a>.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="15.8.3.7 Saving and Restoring the Buffer Pool State">Section 15.8.3.7, “Saving and Restoring the Buffer Pool State”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_dump_pct"></a>
          <a class="indexterm" name="idm140091642078816"></a>

          <code class="literal">innodb_buffer_pool_dump_pct</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_dump_pct"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-dump-pct=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct">innodb_buffer_pool_dump_pct</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">25</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">100</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies the percentage of the most recently used pages for
          each buffer pool to read out and dump. The range is 1 to 100.
          The default value is 25. For example, if there are 4 buffer
          pools with 100 pages each, and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_pct"><code class="literal">innodb_buffer_pool_dump_pct</code></a>
          is set to 25, the 25 most recently used pages from each buffer
          pool are dumped.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_filename"></a>
          <a class="indexterm" name="idm140091642040112"></a>

          <code class="literal">innodb_buffer_pool_filename</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_filename"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-filename=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_filename">innodb_buffer_pool_filename</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>File name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ib_buffer_pool</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies the name of the file that holds the list of
          tablespace IDs and page IDs produced by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
          or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_now"><code class="literal">innodb_buffer_pool_dump_now</code></a>.
          Tablespace IDs and page IDs are saved in the following format:
          <code class="literal">space, page_id</code>. By default, the file is
          named <code class="filename">ib_buffer_pool</code> and is located in
          the <code class="literal">InnoDB</code> data directory. A non-default
          location must be specified relative to the data directory.
        </p><p>
          A file name can be specified at runtime, using a
          <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET</code></a>
          statement:
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_buffer_pool_filename=<em class="replaceable"><code>'file_name'</code></em>;
</pre><p>
          You can also specify a file name at startup, in a startup
          string or MySQL configuration file. When specifying a file
          name at startup, the file must exist or
          <code class="literal">InnoDB</code> will return a startup error
          indicating that there is no such file or directory.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="15.8.3.7 Saving and Restoring the Buffer Pool State">Section 15.8.3.7, “Saving and Restoring the Buffer Pool State”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_in_core_file"></a>
          <a class="indexterm" name="idm140091641998432"></a>

          <a class="indexterm" name="idm140091641997328"></a>

          <code class="literal">innodb_buffer_pool_in_core_file</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_in_core_file"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-in-core-file[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.14</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_in_core_file">innodb_buffer_pool_in_core_file</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          Disabling the
          <code class="literal">innodb_buffer_pool_in_core_file</code> variable
          reduces the size of core files by excluding
          <code class="literal">InnoDB</code> buffer pool pages. To use this
          variable, the <a class="link" href="server-administration.html#sysvar_core_file"><code class="literal">core_file</code></a>
          variable must be enabled and the operating system must support
          the <code class="literal">MADV_DONTDUMP</code> non-POSIX extension to
          <code class="literal">madvise()</code>, which is supported in Linux 3.4
          and later. For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-in-core-file" title="15.8.3.8 Excluding Buffer Pool Pages from Core Files">Section 15.8.3.8, “Excluding Buffer Pool Pages from Core Files”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_instances"></a>
          <a class="indexterm" name="idm140091641958128"></a>

          <a class="indexterm" name="idm140091641957024"></a>

          <code class="literal">innodb_buffer_pool_instances</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_instances"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-instances=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances">innodb_buffer_pool_instances</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (Other)</td>
<td><code class="literal">8 (or 1 if innodb_buffer_pool_size &lt; 1GB</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (Windows, 32-bit platforms)</td>
<td><code class="literal">(autosized)</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">64</code></td>
</tr></tbody></table>
</div>
<p>
          The number of regions that the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> is divided
          into. For systems with buffer pools in the multi-gigabyte
          range, dividing the buffer pool into separate instances can
          improve concurrency, by reducing contention as different
          threads read and write to cached pages. Each page that is
          stored in or read from the buffer pool is assigned to one of
          the buffer pool instances randomly, using a hashing function.
          Each buffer pool manages its own free lists,
          <a class="link" href="glossary.html#glos_flush_list" title="flush list">flush lists</a>,
          <a class="link" href="glossary.html#glos_lru" title="LRU">LRUs</a>, and all other data
          structures connected to a buffer pool, and is protected by its
          own buffer pool <a class="link" href="glossary.html#glos_mutex" title="mutex">mutex</a>.
        </p><p>
          This option only takes effect when setting
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> to
          1GB or more. The total buffer pool size is divided among all
          the buffer pools. For best efficiency, specify a combination
          of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
          and <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
          so that each buffer pool instance is at least 1GB.
        </p><p>
          The default value on 32-bit Windows systems depends on the
          value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>, as
          described below:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
              is greater than 1.3GB, the default for
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
              is
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>/128MB,
              with individual memory allocation requests for each chunk.
              1.3GB was chosen as the boundary at which there is
              significant risk for 32-bit Windows to be unable to
              allocate the contiguous address space needed for a single
              buffer pool.
            </p></li><li class="listitem"><p>
              Otherwise, the default is 1.
</p></li></ul>
</div>
<p>
          On all other platforms, the default value is 8 when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> is
          greater than or equal to 1GB. Otherwise, the default is 1.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-resize" title="15.8.3.1 Configuring InnoDB Buffer Pool Size">Section 15.8.3.1, “Configuring InnoDB Buffer Pool Size”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_load_abort"></a>
          <a class="indexterm" name="idm140091641895760"></a>

          <code class="literal">innodb_buffer_pool_load_abort</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_load_abort"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-load-abort[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_abort">innodb_buffer_pool_load_abort</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Interrupts the process of restoring <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> contents
          triggered by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup"><code class="literal">innodb_buffer_pool_load_at_startup</code></a>
          or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_now"><code class="literal">innodb_buffer_pool_load_now</code></a>.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="15.8.3.7 Saving and Restoring the Buffer Pool State">Section 15.8.3.7, “Saving and Restoring the Buffer Pool State”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_load_at_startup"></a>
          <a class="indexterm" name="idm140091641859344"></a>

          <code class="literal">innodb_buffer_pool_load_at_startup</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_load_at_startup"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-load-at-startup[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_at_startup">innodb_buffer_pool_load_at_startup</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies that, on MySQL server startup, the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> is
          automatically <a class="link" href="glossary.html#glos_warm_up" title="warm up">warmed up</a> by
          loading the same pages it held at an earlier time. Typically
          used in combination with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>.
        </p><p>
          Both
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_dump_at_shutdown"><code class="literal">innodb_buffer_pool_dump_at_shutdown</code></a>
          and <code class="literal">innodb_buffer_pool_load_at_startup</code> are
          enabled by default.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="15.8.3.7 Saving and Restoring the Buffer Pool State">Section 15.8.3.7, “Saving and Restoring the Buffer Pool State”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_load_now"></a>
          <a class="indexterm" name="idm140091641820896"></a>

          <code class="literal">innodb_buffer_pool_load_now</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_load_now"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-load-now[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_load_now">innodb_buffer_pool_load_now</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Immediately <a class="link" href="glossary.html#glos_warm_up" title="warm up">warms up</a> the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> by loading
          a set of data pages, without waiting for a server restart. Can
          be useful to bring cache memory back to a known state during
          benchmarking, or to ready the MySQL server to resume its
          normal workload after running queries for reports or
          maintenance.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="15.8.3.7 Saving and Restoring the Buffer Pool State">Section 15.8.3.7, “Saving and Restoring the Buffer Pool State”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_size"></a>
          <a class="indexterm" name="idm140091641786112"></a>

          <a class="indexterm" name="idm140091641785072"></a>

          <code class="literal">innodb_buffer_pool_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_buffer_pool_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-buffer-pool-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size">innodb_buffer_pool_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">134217728</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">5242880</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (64-bit platforms)</td>
<td><code class="literal">2**64-1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (32-bit platforms)</td>
<td><code class="literal">2**32-1</code></td>
</tr></tbody></table>
</div>
<p>
          The size in bytes of the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, the
          memory area where <code class="literal">InnoDB</code> caches table and
          index data. The default value is 134217728 bytes (128MB). The
          maximum value depends on the CPU architecture; the maximum is
          4294967295 (2<sup>32</sup>-1) on 32-bit
          systems and 18446744073709551615
          (2<sup>64</sup>-1) on 64-bit systems. On
          32-bit systems, the CPU architecture and operating system may
          impose a lower practical maximum size than the stated maximum.
          When the size of the buffer pool is greater than 1GB, setting
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
          to a value greater than 1 can improve the scalability on a
          busy server.
        </p><p>
          A larger buffer pool requires less disk I/O to access the same
          table data more than once. On a dedicated database server, you
          might set the buffer pool size to 80% of the machine's
          physical memory size. Be aware of the following potential
          issues when configuring buffer pool size, and be prepared to
          scale back the size of the buffer pool if necessary.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Competition for physical memory can cause paging in the
              operating system.
            </p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code> reserves additional memory for
              buffers and control structures, so that the total
              allocated space is approximately 10% greater than the
              specified buffer pool size.
            </p></li><li class="listitem"><p>
              Address space for the buffer pool must be contiguous,
              which can be an issue on Windows systems with DLLs that
              load at specific addresses.
            </p></li><li class="listitem"><p>
              The time to initialize the buffer pool is roughly
              proportional to its size. On instances with large buffer
              pools, initialization time might be significant. To reduce
              the initialization period, you can save the buffer pool
              state at server shutdown and restore it at server startup.
              See <a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="15.8.3.7 Saving and Restoring the Buffer Pool State">Section 15.8.3.7, “Saving and Restoring the Buffer Pool State”</a>.
</p></li></ul>
</div>
<p>
          When you increase or decrease buffer pool size, the operation
          is performed in chunks. Chunk size is defined by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          configuration option, which has a default of 128 MB.
        </p><p>
          Buffer pool size must always be equal to or a multiple of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          *
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
          If you alter the buffer pool size to a value that is not equal
          to or a multiple of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          *
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>,
          buffer pool size is automatically adjusted to a value that is
          equal to or a multiple of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_chunk_size"><code class="literal">innodb_buffer_pool_chunk_size</code></a>
          *
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
        </p><p>
          <code class="literal">innodb_buffer_pool_size</code> can be set
          dynamically, which allows you to resize the buffer pool
          without restarting the server. The
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_resize_status"><code class="literal">Innodb_buffer_pool_resize_status</code></a>
          status variable reports the status of online buffer pool
          resizing operations. See
          <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-resize" title="15.8.3.1 Configuring InnoDB Buffer Pool Size">Section 15.8.3.1, “Configuring InnoDB Buffer Pool Size”</a> for more
          information.
        </p><p>
          If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_dedicated_server"><code class="literal">innodb_dedicated_server</code></a> is
          enabled, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> value
          is automatically configured if it is not explicitly defined.
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-dedicated-server" title="15.8.12 Enabling Automatic Configuration for a Dedicated MySQL Server">Section 15.8.12, “Enabling Automatic Configuration for a Dedicated MySQL Server”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_change_buffer_max_size"></a>
          <a class="indexterm" name="idm140091641715872"></a>

          <code class="literal">innodb_change_buffer_max_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_change_buffer_max_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-change-buffer-max-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffer_max_size">innodb_change_buffer_max_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">25</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">50</code></td>
</tr></tbody></table>
</div>
<p>
          Maximum size for the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">change buffer</a>, as a
          percentage of the total size of the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. You might
          increase this value for a MySQL server with heavy insert,
          update, and delete activity, or decrease it for a MySQL server
          with unchanging data used for reporting. For more information,
          see <a class="xref" href="innodb-storage-engine.html#innodb-change-buffer" title="15.5.2 Change Buffer">Section 15.5.2, “Change Buffer”</a>. For general I/O
          tuning advice, see <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_change_buffering"></a>
          <a class="indexterm" name="idm140091641674624"></a>

          <a class="indexterm" name="idm140091641673584"></a>

          <code class="literal">innodb_change_buffering</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_change_buffering"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-change-buffering=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering">innodb_change_buffering</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">all</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">none</code></p><p class="valid-value"><code class="literal">inserts</code></p><p class="valid-value"><code class="literal">deletes</code></p><p class="valid-value"><code class="literal">changes</code></p><p class="valid-value"><code class="literal">purges</code></p><p class="valid-value"><code class="literal">all</code></p></td>
</tr></tbody></table>
</div>
<p>
          Whether <code class="literal">InnoDB</code> performs
          <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change buffering</a>,
          an optimization that delays write operations to secondary
          indexes so that the I/O operations can be performed
          sequentially. Permitted values are described in the following
          table. Values may also be specified numerically.
</p>
<div class="table">
<a name="innodb-change-buffer-permitted-values"></a><p class="title"><b>Table 15.26 Permitted Values for innodb_change_buffering</b></p>
<div class="table-contents">
<table summary="Permitted values for the innodb_chansge_buffering configuration option. The first column defines the value. The second column describes the option effect."><col width="20%"><col width="20%"><col width="60%"><thead><tr>
              <th scope="col">Value</th>
              <th scope="col">Numeric Value</th>
              <th scope="col">Description</th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">none</code></td>
              <td><code class="literal">0</code></td>
              <td>Do not buffer any operations.</td>
            </tr><tr>
              <td scope="row"><code class="literal">inserts</code></td>
              <td><code class="literal">1</code></td>
              <td>Buffer insert operations.</td>
            </tr><tr>
              <td scope="row"><code class="literal">deletes</code></td>
              <td><code class="literal">2</code></td>
              <td>Buffer delete marking operations; strictly speaking, the writes that
                mark index records for later deletion during a purge
                operation.</td>
            </tr><tr>
              <td scope="row"><code class="literal">changes</code></td>
              <td><code class="literal">3</code></td>
              <td>Buffer inserts and delete-marking operations.</td>
            </tr><tr>
              <td scope="row"><code class="literal">purges</code></td>
              <td><code class="literal">4</code></td>
              <td>Buffer the physical deletion operations that happen in the background.</td>
            </tr><tr>
              <td scope="row"><code class="literal">all</code></td>
              <td><code class="literal">5</code></td>
              <td>The default. Buffer inserts, delete-marking operations, and purges.</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-change-buffer" title="15.5.2 Change Buffer">Section 15.5.2, “Change Buffer”</a>. For general I/O tuning
          advice, see <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_change_buffering_debug"></a>
          <a class="indexterm" name="idm140091641597104"></a>

          <a class="indexterm" name="idm140091641596064"></a>

          <code class="literal">innodb_change_buffering_debug</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_change_buffering_debug"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-change-buffering-debug=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering_debug">innodb_change_buffering_debug</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2</code></td>
</tr></tbody></table>
</div>
<p>
          Sets a debug flag for <code class="literal">InnoDB</code> change
          buffering. A value of 1 forces all changes to the change
          buffer. A value of 2 causes a crash at merge. A default value
          of 0 indicates that the change buffering debug flag is not
          set. This option is only available when debugging support is
          compiled in using the <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_checkpoint_disabled"></a>
          <a class="indexterm" name="idm140091641558912"></a>

          <a class="indexterm" name="idm140091641557808"></a>

          <code class="literal">innodb_checkpoint_disabled</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_checkpoint_disabled"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-checkpoint-disabled[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.2</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_checkpoint_disabled">innodb_checkpoint_disabled</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          This is a debug option that is only intended for expert
          debugging use. It disables checkpoints so that a deliberate
          server exit always initiates <code class="literal">InnoDB</code>
          recovery. It should only be enabled for a short interval,
          typically before running DML operations that write redo log
          entries that would require recovery following a server exit.
          This option is only available if debugging support is compiled
          in using the <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_checksum_algorithm"></a>
          <a class="indexterm" name="idm140091641520944"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_checksum_algorithm"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-checksum-algorithm=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm">innodb_checksum_algorithm</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">crc32</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">innodb</code></p><p class="valid-value"><code class="literal">crc32</code></p><p class="valid-value"><code class="literal">none</code></p><p class="valid-value"><code class="literal">strict_innodb</code></p><p class="valid-value"><code class="literal">strict_crc32</code></p><p class="valid-value"><code class="literal">strict_none</code></p></td>
</tr></tbody></table>
</div>
<p>
          Specifies how to generate and verify the
          <a class="link" href="glossary.html#glos_checksum" title="checksum">checksum</a> stored in the
          disk blocks of <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>. The
          default value for <code class="literal">innodb_checksum_algorithm</code>
          is <code class="literal">crc32</code>.
        </p><p>
          Versions of <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="30.2 MySQL Enterprise Backup Overview">MySQL
          Enterprise Backup</a> up to 3.8.0 do not support backing up
          tablespaces that use CRC32 checksums.
          <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="30.2 MySQL Enterprise Backup Overview">MySQL Enterprise
          Backup</a> adds CRC32 checksum support in 3.8.1, with some
          limitations. Refer to the
          <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="30.2 MySQL Enterprise Backup Overview">MySQL Enterprise
          Backup</a> 3.8.1 Change History for more information.
        </p><p>
          The value <code class="literal">innodb</code> is backward-compatible
          with earlier versions of MySQL. The value
          <code class="literal">crc32</code> uses an algorithm that is faster to
          compute the checksum for every modified block, and to check
          the checksums for each disk read. It scans blocks 32 bits at a
          time, which is faster than the <code class="literal">innodb</code>
          checksum algorithm, which scans blocks 8 bits at a time. The
          value <code class="literal">none</code> writes a constant value in the
          checksum field rather than computing a value based on the
          block data. The blocks in a tablespace can use a mix of old,
          new, and no checksum values, being updated gradually as the
          data is modified; once blocks in a tablespace are modified to
          use the <code class="literal">crc32</code> algorithm, the associated
          tables cannot be read by earlier versions of MySQL.
        </p><p>
          The strict form of a checksum algorithm reports an error if it
          encounters a valid but non-matching checksum value in a
          tablespace. It is recommended that you only use strict
          settings in a new instance, to set up tablespaces for the
          first time. Strict settings are somewhat faster, because they
          do not need to compute all checksum values during disk reads.
        </p><p>
          The following table shows the difference between the
          <code class="literal">none</code>, <code class="literal">innodb</code>, and
          <code class="literal">crc32</code> option values, and their strict
          counterparts. <code class="literal">none</code>,
          <code class="literal">innodb</code>, and <code class="literal">crc32</code> write
          the specified type of checksum value into each data block, but
          for compatibility accept other checksum values when verifying
          a block during a read operation. Strict settings also accept
          valid checksum values but print an error message when a valid
          non-matching checksum value is encountered. Using the strict
          form can make verification faster if all
          <code class="literal">InnoDB</code> data files in an instance are
          created under an identical
          <code class="literal">innodb_checksum_algorithm</code> value.
</p>
<div class="table">
<a name="innodb-checksum-algorithm-values"></a><p class="title"><b>Table 15.27 Permitted innodb_checksum_algorithm Values</b></p>
<div class="table-contents">
<table summary="Permitted values for the innodb_checksum_algorithm configuration option. The first column defines the checksum value. The second column describes the generated checksum. The third column describes compatible checksums."><col width="20%"><col width="40%"><col width="40%"><thead><tr>
              <th scope="col">Value</th>
              <th scope="col">Generated checksum (when writing)</th>
              <th scope="col">Permitted checksums (when reading)</th>
            </tr></thead><tbody><tr>
              <td scope="row">none</td>
              <td>A constant number.</td>
              <td>Any of the checksums generated by <code class="literal">none</code>,
                <code class="literal">innodb</code>, or <code class="literal">crc32</code>.</td>
            </tr><tr>
              <td scope="row">innodb</td>
              <td>A checksum calculated in software, using the original algorithm from
                <code class="literal">InnoDB</code>.</td>
              <td>Any of the checksums generated by <code class="literal">none</code>,
                <code class="literal">innodb</code>, or <code class="literal">crc32</code>.</td>
            </tr><tr>
              <td scope="row">crc32</td>
              <td>A checksum calculated using the <code class="literal">crc32</code> algorithm,
                possibly done with a hardware assist.</td>
              <td>Any of the checksums generated by <code class="literal">none</code>,
                <code class="literal">innodb</code>, or <code class="literal">crc32</code>.</td>
            </tr><tr>
              <td scope="row">strict_none</td>
              <td>A constant number</td>
              <td>Any of the checksums generated by <code class="literal">none</code>,
                <code class="literal">innodb</code>, or <code class="literal">crc32</code>.
                <code class="literal">InnoDB</code> prints an error message if a
                valid but non-matching checksum is encountered.</td>
            </tr><tr>
              <td scope="row">strict_innodb</td>
              <td>A checksum calculated in software, using the original algorithm from
                <code class="literal">InnoDB</code>.</td>
              <td>Any of the checksums generated by <code class="literal">none</code>,
                <code class="literal">innodb</code>, or <code class="literal">crc32</code>.
                <code class="literal">InnoDB</code> prints an error message if a
                valid but non-matching checksum is encountered.</td>
            </tr><tr>
              <td scope="row">strict_crc32</td>
              <td>A checksum calculated using the <code class="literal">crc32</code> algorithm,
                possibly done with a hardware assist.</td>
              <td>Any of the checksums generated by <code class="literal">none</code>,
                <code class="literal">innodb</code>, or <code class="literal">crc32</code>.
                <code class="literal">InnoDB</code> prints an error message if a
                valid but non-matching checksum is encountered.</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"></li><li class="listitem"><p><a name="sysvar_innodb_cmp_per_index_enabled"></a>
          <a class="indexterm" name="idm140091641414608"></a>

          <code class="literal">innodb_cmp_per_index_enabled</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_cmp_per_index_enabled"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-cmp-per-index-enabled[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_cmp_per_index_enabled">innodb_cmp_per_index_enabled</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enables per-index compression-related statistics in the
          <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="25.39.7 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP_PER_INDEX</code></a>
          table. Because these statistics can be expensive to gather,
          only enable this option on development, test, or slave
          instances during performance tuning related to
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a> tables.
        </p><p>
          For more information, see
          <a class="xref" href="information-schema.html#innodb-cmp-per-index-table" title="25.39.7 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables">Section 25.39.7, “The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and
      INNODB_CMP_PER_INDEX_RESET Tables”</a>, and
          <a class="xref" href="innodb-storage-engine.html#innodb-compression-tuning-monitoring" title="15.9.1.4 Monitoring InnoDB Table Compression at Runtime">Section 15.9.1.4, “Monitoring InnoDB Table Compression at Runtime”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_commit_concurrency"></a>
          <a class="indexterm" name="idm140091641378720"></a>

          <a class="indexterm" name="idm140091641377616"></a>

          <a class="indexterm" name="idm140091641376160"></a>

          <code class="literal">innodb_commit_concurrency</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_commit_concurrency"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-commit-concurrency=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_commit_concurrency">innodb_commit_concurrency</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">1000</code></td>
</tr></tbody></table>
</div>
<p>
          The number of <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> that
          can <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> at the same
          time. A value of 0 (the default) permits any number of
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> to commit
          simultaneously.
        </p><p>
          The value of <code class="literal">innodb_commit_concurrency</code>
          cannot be changed at runtime from zero to nonzero or vice
          versa. The value can be changed from one nonzero value to
          another.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_compress_debug"></a>
          <a class="indexterm" name="idm140091641334688"></a>

          <a class="indexterm" name="idm140091641333616"></a>

          <code class="literal">innodb_compress_debug</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_compress_debug"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-compress-debug=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compress_debug">innodb_compress_debug</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">none</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">none</code></p><p class="valid-value"><code class="literal">zlib</code></p><p class="valid-value"><code class="literal">lz4</code></p><p class="valid-value"><code class="literal">lz4hc</code></p></td>
</tr></tbody></table>
</div>
<p>
          Compresses all tables using a specified compression algorithm
          without having to define a <code class="literal">COMPRESSION</code>
          attribute for each table. This option is only available if
          debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-page-compression" title="15.9.2 InnoDB Page Compression">Section 15.9.2, “InnoDB Page Compression”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_compression_failure_threshold_pct"></a>
          <a class="indexterm" name="idm140091641292208"></a>

          <code class="literal">innodb_compression_failure_threshold_pct</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_compression_failure_threshold_pct"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-compression-failure-threshold-pct=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct">innodb_compression_failure_threshold_pct</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">5</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">100</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the compression failure rate threshold for a table, as
          a percentage, at which point MySQL begins adding padding
          within <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a>
          pages to avoid expensive
          <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
          failures</a>. When this threshold is passed, MySQL begins
          to leave additional free space within each new compressed
          page, dynamically adjusting the amount of free space up to the
          percentage of page size specified by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max"><code class="literal">innodb_compression_pad_pct_max</code></a>.
          A value of zero disables the mechanism that monitors
          compression efficiency and dynamically adjusts the padding
          amount.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-compression-oltp" title="15.9.1.6 Compression for OLTP Workloads">Section 15.9.1.6, “Compression for OLTP Workloads”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_compression_level"></a>
          <a class="indexterm" name="idm140091641250432"></a>

          <code class="literal">innodb_compression_level</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_compression_level"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-compression-level=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_level">innodb_compression_level</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">6</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">9</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies the level of zlib compression to use for
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a> tables and
          indexes. A higher value lets you fit more data onto a storage
          device, at the expense of more CPU overhead during
          compression. A lower value lets you reduce CPU overhead when
          storage space is not critical, or you expect the data is not
          especially compressible.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-compression-oltp" title="15.9.1.6 Compression for OLTP Workloads">Section 15.9.1.6, “Compression for OLTP Workloads”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_compression_pad_pct_max"></a>
          <a class="indexterm" name="idm140091641210320"></a>

          <code class="literal">innodb_compression_pad_pct_max</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_compression_pad_pct_max"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-compression-pad-pct-max=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_pad_pct_max">innodb_compression_pad_pct_max</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">50</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">75</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies the maximum percentage that can be reserved as free
          space within each compressed
          <a class="link" href="glossary.html#glos_page" title="page">page</a>, allowing room to
          reorganize the data and modification log within the page when
          a <a class="link" href="glossary.html#glos_compression" title="compression">compressed</a> table or
          index is updated and the data might be recompressed. Only
          applies when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_compression_failure_threshold_pct"><code class="literal">innodb_compression_failure_threshold_pct</code></a>
          is set to a nonzero value, and the rate of
          <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
          failures</a> passes the cutoff point.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-compression-oltp" title="15.9.1.6 Compression for OLTP Workloads">Section 15.9.1.6, “Compression for OLTP Workloads”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_concurrency_tickets"></a>
          <a class="indexterm" name="idm140091641167872"></a>

          <a class="indexterm" name="idm140091641166768"></a>

          <a class="indexterm" name="idm140091641165312"></a>

          <code class="literal">innodb_concurrency_tickets</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_concurrency_tickets"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-concurrency-tickets=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets">innodb_concurrency_tickets</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">5000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p>
          Determines the number of
          <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> that can enter
          <code class="literal">InnoDB</code> concurrently. A thread is placed in
          a queue when it tries to enter <code class="literal">InnoDB</code> if
          the number of threads has already reached the concurrency
          limit. When a thread is permitted to enter
          <code class="literal">InnoDB</code>, it is given a number of <span class="quote">“<span class="quote">
          tickets</span>”</span> equal to the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>,
          and the thread can enter and leave <code class="literal">InnoDB</code>
          freely until it has used up its tickets. After that point, the
          thread again becomes subject to the concurrency check (and
          possible queuing) the next time it tries to enter
          <code class="literal">InnoDB</code>. The default value is 5000.
        </p><p>
          With a small <code class="literal">innodb_concurrency_tickets</code>
          value, small transactions that only need to process a few rows
          compete fairly with larger transactions that process many
          rows. The disadvantage of a small
          <code class="literal">innodb_concurrency_tickets</code> value is that
          large transactions must loop through the queue many times
          before they can complete, which extends the amount of time
          required to complete their task.
        </p><p>
          With a large <code class="literal">innodb_concurrency_tickets</code>
          value, large transactions spend less time waiting for a
          position at the end of the queue (controlled by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>)
          and more time retrieving rows. Large transactions also require
          fewer trips through the queue to complete their task. The
          disadvantage of a large
          <code class="literal">innodb_concurrency_tickets</code> value is that
          too many large transactions running at the same time can
          starve smaller transactions by making them wait a longer time
          before executing.
        </p><p>
          With a nonzero
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
          value, you may need to adjust the
          <code class="literal">innodb_concurrency_tickets</code> value up or down
          to find the optimal balance between larger and smaller
          transactions. The <code class="literal">SHOW ENGINE INNODB STATUS</code>
          report shows the number of tickets remaining for an executing
          transaction in its current pass through the queue. This data
          may also be obtained from the
          <code class="literal">TRX_CONCURRENCY_TICKETS</code> column of the
          <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TRX</code></a>
          table.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="15.8.4 Configuring Thread Concurrency for InnoDB">Section 15.8.4, “Configuring Thread Concurrency for InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_data_file_path"></a>
          <a class="indexterm" name="idm140091641108352"></a>

          <a class="indexterm" name="idm140091641107312"></a>

          <code class="literal">innodb_data_file_path</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_data_file_path"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-data-file-path=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path">innodb_data_file_path</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ibdata1:12M:autoextend</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the name, size, and attributes of
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> <a class="link" href="glossary.html#glos_data_files" title="data files">data
          files</a>. If you do not specify a value for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>, the
          default behavior is to create a single auto-extending data
          file, slightly larger than 12MB, named
          <code class="filename">ibdata1</code>.
        </p><p>
          The full syntax for a data file specification includes the
          file name, file size, and <code class="literal">autoextend</code> and
          <code class="literal">max</code> attributes:
        </p><pre data-lang="none" class="programlisting">
<em class="replaceable"><code>file_name</code></em>:<em class="replaceable"><code>file_size</code></em>[:autoextend[:max:<em class="replaceable"><code>max_file_size</code></em>]]
</pre><p>
          File sizes are specified KB, MB or GB (1024MB) by appending
          <code class="literal">K</code>, <code class="literal">M</code> or
          <code class="literal">G</code> to the size value. If specifying the data
          file size in kilobytes (KB), do so in multiples of 1024.
          Otherwise, KB values are rounded to nearest megabyte (MB)
          boundary. The sum of the sizes of the files must be at least
          slightly larger than 12MB.
        </p><p>
          A minimum file size is enforced for the
          <span class="emphasis"><em>first</em></span> system tablespace data file to
          ensure that there is enough space for doublewrite buffer
          pages:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              For an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
              value of 16KB or less, the minimum file size is 3MB.
            </p></li><li class="listitem"><p>
              For an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
              value of 32KB, the minimum file size is 6MB.
            </p></li><li class="listitem"><p>
              For an <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
              value of 64KB, the minimum file size is 12MB.
</p></li></ul>
</div>
<p>
          The size limit of individual files is determined by your
          operating system. You can set the file size to more than 4GB
          on operating systems that support large files. You can also
          <a class="link" href="innodb-storage-engine.html#innodb-raw-devices" title="Using Raw Disk Partitions for the System Tablespace">use raw disk partitions as
          data files</a>.
        </p><p>
          The <code class="literal">autoextend</code> and <code class="literal">max</code>
          attributes can be used only for the data file that is
          specified last in the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
          setting. For example:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_data_file_path=ibdata1:50M;ibdata2:12M:autoextend:max:500MB
</pre><p>
          If you specify the <code class="literal">autoextend</code> option,
          <code class="literal">InnoDB</code> extends the data file if it runs out
          of free space. The <code class="literal">autoextend</code> increment is
          64MB by default. To modify the increment, change the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
          system variable.
        </p><p>
          The full directory path for system tablespace data files is
          formed by concatenating the paths defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> and
          <code class="literal">innodb_data_file_path</code>.
        </p><p>
          For more information about configuring system tablespace data
          files, see
          <a class="xref" href="innodb-storage-engine.html#innodb-init-startup-configuration" title="15.8.1 InnoDB Startup Configuration">Section 15.8.1, “InnoDB Startup Configuration”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_data_home_dir"></a>
          <a class="indexterm" name="idm140091641043360"></a>

          <a class="indexterm" name="idm140091641042320"></a>

          <code class="literal">innodb_data_home_dir</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_data_home_dir"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-data-home-dir=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir">innodb_data_home_dir</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Directory name</td>
</tr></tbody></table>
</div>
<p>
          The common part of the directory path for
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> data files. This setting does not affect the
          location of
          <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
          tablespaces when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          enabled. The default value is the MySQL
          <code class="filename">data</code> directory. If you specify the value
          as an empty string, you can specify an absolute file paths for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>.
        </p><p>
          A trailing slash is required when specifying a value for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>. For
          example:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_data_home_dir = /path/to/myibdata/
</pre><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-init-startup-configuration" title="15.8.1 InnoDB Startup Configuration">Section 15.8.1, “InnoDB Startup Configuration”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ddl_log_crash_reset_debug"></a>
          <a class="indexterm" name="idm140091641004320"></a>

          <a class="indexterm" name="idm140091641003216"></a>

          <code class="literal">innodb_ddl_log_crash_reset_debug</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ddl_log_crash_reset_debug"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ddl-log-crash-reset-debug[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.3</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ddl_log_crash_reset_debug">innodb_ddl_log_crash_reset_debug</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enable this debug option to reset DDL log crash injection
          counters to 1. This option is only available when debugging
          support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_deadlock_detect"></a>
          <a class="indexterm" name="idm140091640967328"></a>

          <a class="indexterm" name="idm140091640966288"></a>

          <code class="literal">innodb_deadlock_detect</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_deadlock_detect"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-deadlock-detect[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_deadlock_detect">innodb_deadlock_detect</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          This option is used to disable deadlock detection. On high
          concurrency systems, deadlock detection can cause a slowdown
          when numerous threads wait for the same lock. At times, it may
          be more efficient to disable deadlock detection and rely on
          the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>
          setting for transaction rollback when a deadlock occurs.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-deadlock-detection" title="15.7.5.2 Deadlock Detection and Rollback">Section 15.7.5.2, “Deadlock Detection and Rollback”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_dedicated_server"></a>
          <a class="indexterm" name="idm140091640932160"></a>

          <a class="indexterm" name="idm140091640931120"></a>

          <code class="literal">innodb_dedicated_server</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_dedicated_server"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-dedicated-server[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.3</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_dedicated_server">innodb_dedicated_server</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_dedicated_server"><code class="literal">innodb_dedicated_server</code></a>
          is enabled, <code class="literal">InnoDB</code> automatically configures
          the following options according to the amount of memory
          detected on the server:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a>
</p></li></ul>
</div>
<p>
          Only consider enabling this option if your MySQL instance runs
          on a dedicated server where the MySQL server is able to
          consume all available system resources. Enabling this option
          is not recommended if your MySQL instance shares system
          resources with other applications.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-dedicated-server" title="15.8.12 Enabling Automatic Configuration for a Dedicated MySQL Server">Section 15.8.12, “Enabling Automatic Configuration for a Dedicated MySQL Server”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_default_row_format"></a>
          <a class="indexterm" name="idm140091640886752"></a>

          <a class="indexterm" name="idm140091640885648"></a>

          <code class="literal">innodb_default_row_format</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_default_row_format"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-default-row-format=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format">innodb_default_row_format</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">DYNAMIC</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">DYNAMIC</code></p><p class="valid-value"><code class="literal">COMPACT</code></p><p class="valid-value"><code class="literal">REDUNDANT</code></p></td>
</tr></tbody></table>
</div>
<p>
          The <code class="literal">innodb_default_row_format</code> option
          defines the default row format for <code class="literal">InnoDB</code>
          tables and user-created temporary tables. The default setting
          is <code class="literal">DYNAMIC</code>. Other permitted values are
          <code class="literal">COMPACT</code> and <code class="literal">REDUNDANT</code>.
          The <code class="literal">COMPRESSED</code> row format, which is not
          supported for use in the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>, cannot be defined as the default.
        </p><p>
          Newly created tables use the row format defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          when a <code class="literal">ROW_FORMAT</code> option is not specified
          explicitly or when <code class="literal">ROW_FORMAT=DEFAULT</code> is
          used.
        </p><p>
          When a <code class="literal">ROW_FORMAT</code> option is not specified
          explicitly or when <code class="literal">ROW_FORMAT=DEFAULT</code> is
          used, any operation that rebuilds a table also silently
          changes the row format of the table to the format defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>.
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-row-format-defining" title="Defining the Row Format of a Table">Defining the Row Format of a Table</a>.
        </p><p>
          Internal <code class="literal">InnoDB</code> temporary tables created by
          the server to process queries use the
          <code class="literal">DYNAMIC</code> row format, regardless of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
          setting.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_directories"></a>
          <a class="indexterm" name="idm140091640832944"></a>

          <a class="indexterm" name="idm140091640831904"></a>

          <code class="literal">innodb_directories</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_directories"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-directories=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories">innodb_directories</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Directory name</td>
</tr></tbody></table>
</div>
<p>
          Defines directories to scan at startup for tablespace files.
          This option is used when moving or restoring tablespace files
          to a new location while the server is offline. It is also used
          to specify directories of tablespace files created using an
          absolute path or that reside outside of the data directory
          (see <a class="xref" href="innodb-storage-engine.html#tablespace-placing" title="15.6.3.6 Creating a Tablespace Outside of the Data Directory">Section 15.6.3.6, “Creating a Tablespace Outside of the Data Directory”</a>).
        </p><p>
          Tablespace discovery during crash recovery relies on the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> setting to
          identify tablespaces referenced in the redo logs. For more
          information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-recovery-tablespace-discovery" title="Tablespace Discovery During Crash Recovery">Tablespace Discovery During Crash Recovery</a>.
        </p><p>
          Directories defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>, and
          <a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a> are automatically
          appended to the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> argument
          value, regardless of whether the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> option is
          specified explicitly.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> may be
          specified as an option in a startup command or in a MySQL
          option file. Quotes are used around the argument value because
          otherwise a semicolon (;) is interpreted as a special
          character by some command interpreters. (Unix shells treat it
          as a command terminator, for example.)
        </p><p>
          Startup command:
        </p><pre data-lang="terminal" class="programlisting">
mysqld --innodb-directories="<em class="replaceable"><code>directory_path_1</code></em>;<em class="replaceable"><code>directory_path_2</code></em>"
</pre><p>
          MySQL option file:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_directories="<em class="replaceable"><code>directory_path_1</code></em>;<em class="replaceable"><code>directory_path_2</code></em>"
</pre><p>
          Wildcard expressions cannot be used to specify directories.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> scan
          also traverses the subdirectories of specified directories.
          Duplicate directories and subdirectories are discarded from
          the list of directories to be scanned.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-moving-data-files-offline" title="15.6.3.8 Moving Tablespace Files While the Server is Offline">Section 15.6.3.8, “Moving Tablespace Files While the Server is Offline”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_disable_sort_file_cache"></a>
          <a class="indexterm" name="idm140091640780240"></a>

          <a class="indexterm" name="idm140091640779136"></a>

          <code class="literal">innodb_disable_sort_file_cache</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_disable_sort_file_cache"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-disable-sort-file-cache[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_disable_sort_file_cache">innodb_disable_sort_file_cache</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Disables the operating system file system cache for merge-sort
          temporary files. The effect is to open such files with the
          equivalent of <code class="literal">O_DIRECT</code>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_doublewrite"></a>
          <a class="indexterm" name="idm140091640746896"></a>

          <a class="indexterm" name="idm140091640745856"></a>

          <a class="indexterm" name="idm140091640744368"></a>

          <code class="literal">innodb_doublewrite</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_doublewrite"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-doublewrite[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite">innodb_doublewrite</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          When enabled (the default), <code class="literal">InnoDB</code> stores
          all data twice, first to the
          <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
          buffer</a>, then to the actual
          <a class="link" href="glossary.html#glos_data_files" title="data files">data files</a>. This
          variable can be turned off with
          <code class="option">--skip-innodb-doublewrite</code> for benchmarks or
          cases when top performance is needed rather than concern for
          data integrity or possible failures.
        </p><p>
          If system tablespace data files (<code class="filename">ibdata*</code>
          files) are located on Fusion-io devices that support atomic
          writes, doublewrite buffering is automatically disabled and
          Fusion-io atomic writes are used for all data files. Because
          the doublewrite buffer setting is global, doublewrite
          buffering is also disabled for data files residing on
          non-Fusion-io hardware. This feature is only supported on
          Fusion-io hardware and only enabled for Fusion-io NVMFS on
          Linux. To take full advantage of this feature, an
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> setting
          of <code class="literal">O_DIRECT</code> is recommended.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-doublewrite-buffer" title="15.6.4 Doublewrite Buffer">Section 15.6.4, “Doublewrite Buffer”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_fast_shutdown"></a>
          <a class="indexterm" name="idm140091640705344"></a>

          <a class="indexterm" name="idm140091640704304"></a>

          <code class="literal">innodb_fast_shutdown</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_fast_shutdown"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-fast-shutdown=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown">innodb_fast_shutdown</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p><p class="valid-value"><code class="literal">2</code></p></td>
</tr></tbody></table>
</div>
<p>
          The <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_shutdown" title="shutdown">shutdown</a> mode. If the
          value is 0, <code class="literal">InnoDB</code> does a
          <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>, a
          full <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> and a change
          buffer merge before shutting down. If the value is 1 (the
          default), <code class="literal">InnoDB</code> skips these operations at
          shutdown, a process known as a
          <a class="link" href="glossary.html#glos_fast_shutdown" title="fast shutdown">fast shutdown</a>. If
          the value is 2, <code class="literal">InnoDB</code> flushes its logs and
          shuts down cold, as if MySQL had crashed; no committed
          transactions are lost, but the
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
          operation makes the next startup take longer.
        </p><p>
          The slow shutdown can take minutes, or even hours in extreme
          cases where substantial amounts of data are still buffered.
          Use the slow shutdown technique before upgrading or
          downgrading between MySQL major releases, so that all data
          files are fully prepared in case the upgrade process updates
          the file format.
        </p><p>
          Use <code class="literal">innodb_fast_shutdown=2</code> in emergency or
          troubleshooting situations, to get the absolute fastest
          shutdown if data is at risk of corruption.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_fil_make_page_dirty_debug"></a>
          <a class="indexterm" name="idm140091640658064"></a>

          <a class="indexterm" name="idm140091640657024"></a>

          <code class="literal">innodb_fil_make_page_dirty_debug</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_fil_make_page_dirty_debug"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-fil-make-page-dirty-debug=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fil_make_page_dirty_debug">innodb_fil_make_page_dirty_debug</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2**32-1</code></td>
</tr></tbody></table>
</div>
<p>
          By default, setting
          <code class="literal">innodb_fil_make_page_dirty_debug</code> to the ID
          of a tablespace immediately dirties the first page of the
          tablespace. If
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_saved_page_number_debug"><code class="literal">innodb_saved_page_number_debug</code></a>
          is set to a non-default value, setting
          <code class="literal">innodb_fil_make_page_dirty_debug</code> dirties
          the specified page. The
          <code class="literal">innodb_fil_make_page_dirty_debug</code> option is
          only available if debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_file_per_table"></a>
          <a class="indexterm" name="idm140091640617104"></a>

          <a class="indexterm" name="idm140091640616064"></a>

          <code class="literal">innodb_file_per_table</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_file_per_table"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-file-per-table[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table">innodb_file_per_table</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          enabled, tables are created in file-per-table tablespaces by
          default. When disabled, tables are created in the system
          tablespace by default. For information about file-per-table
          tablespaces, see
          <a class="xref" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="15.6.3.2 File-Per-Table Tablespaces">Section 15.6.3.2, “File-Per-Table Tablespaces”</a>. For information
          about the <code class="literal">InnoDB</code> system tablespace, see
          <a class="xref" href="innodb-storage-engine.html#innodb-system-tablespace" title="15.6.3.1 The System Tablespace">Section 15.6.3.1, “The System Tablespace”</a>.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
          variable can be configured at runtime using a
          <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
          GLOBAL</code></a> statement, specified on the command line at
          startup, or specified in an option file. Configuration at
          runtime requires privileges sufficient to set global system
          variables (see <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>)
          and immediately affects the operation of all connections.
        </p><p>
          When a table that resides in a file-per-table tablespace is
          truncated or dropped, the freed space is returned to the
          operating system. Truncating or dropping a table that resides
          in the system tablespace only frees space in the system
          tablespace. Freed space in the system tablespace can be used
          again for <code class="literal">InnoDB</code> data but is not returned
          to the operating system, as system tablespace data files never
          shrink.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per-table</code></a>
          setting does not affect the creation of temporary tables. As
          of MySQL 8.0.14, temporary tables are created in session
          temporary tablespaces, and in the global temporary tablespace
          before that. See
          <a class="xref" href="innodb-storage-engine.html#innodb-temporary-tablespace" title="15.6.3.5 Temporary Tablespaces">Section 15.6.3.5, “Temporary Tablespaces”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_fill_factor"></a>
          <a class="indexterm" name="idm140091640572784"></a>

          <a class="indexterm" name="idm140091640571744"></a>

          <code class="literal">innodb_fill_factor</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_fill_factor"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-fill-factor=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor">innodb_fill_factor</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">100</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">10</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">100</code></td>
</tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> performs a bulk load when creating
          or rebuilding indexes. This method of index creation is known
          as a <span class="quote">“<span class="quote">sorted index build</span>”</span>.
        </p><p>
          <code class="literal">innodb_fill_factor</code> defines the percentage
          of space on each B-tree page that is filled during a sorted
          index build, with the remaining space reserved for future
          index growth. For example, setting
          <code class="literal">innodb_fill_factor</code> to 80 reserves 20
          percent of the space on each B-tree page for future index
          growth. Actual percentages may vary. The
          <code class="literal">innodb_fill_factor</code> setting is interpreted
          as a hint rather than a hard limit.
        </p><p>
          An <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fill_factor"><code class="literal">innodb_fill_factor</code></a> setting
          of 100 leaves 1/16 of the space in clustered index pages free
          for future index growth.
        </p><p>
          <code class="literal">innodb_fill_factor</code> applies to both B-tree
          leaf and non-leaf pages. It does not apply to external pages
          used for <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> or
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> entries.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#sorted-index-builds" title="15.6.2.3 Sorted Index Builds">Section 15.6.2.3, “Sorted Index Builds”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_log_at_timeout"></a>
          <a class="indexterm" name="idm140091640522880"></a>

          <a class="indexterm" name="idm140091640521776"></a>

          <code class="literal">innodb_flush_log_at_timeout</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_flush_log_at_timeout"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-flush-log-at-timeout=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_timeout">innodb_flush_log_at_timeout</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2700</code></td>
</tr></tbody></table>
</div>
<p>
          Write and flush the logs every <em class="replaceable"><code>N</code></em>
          seconds.
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_timeout"><code class="literal">innodb_flush_log_at_timeout</code></a>
          allows the timeout period between flushes to be increased in
          order to reduce flushing and avoid impacting performance of
          binary log group commit. The default setting for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_timeout"><code class="literal">innodb_flush_log_at_timeout</code></a>
          is once per second.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_log_at_trx_commit"></a>
          <a class="indexterm" name="idm140091640481040"></a>

          <a class="indexterm" name="idm140091640479936"></a>

          <code class="literal">innodb_flush_log_at_trx_commit</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_flush_log_at_trx_commit"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-flush-log-at-trx-commit=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit">innodb_flush_log_at_trx_commit</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p><p class="valid-value"><code class="literal">2</code></p></td>
</tr></tbody></table>
</div>
<p>
          Controls the balance between strict
          <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> compliance for
          <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> operations and
          higher performance that is possible when commit-related I/O
          operations are rearranged and done in batches. You can achieve
          better performance by changing the default value but then you
          can lose transactions in a crash.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The default setting of 1 is required for full ACID
              compliance. Logs are written and flushed to disk at each
              transaction commit.
            </p></li><li class="listitem"><p>
              With a setting of 0, logs are written and flushed to disk
              once per second. Transactions for which logs have not been
              flushed can be lost in a crash.
            </p></li><li class="listitem"><p>
              With a setting of 2, logs are written after each
              transaction commit and flushed to disk once per second.
              Transactions for which logs have not been flushed can be
              lost in a crash.
            </p></li><li class="listitem"><p>
              For settings 0 and 2, once-per-second flushing is not 100%
              guaranteed. Flushing may occur more frequently due to DDL
              changes and other internal <code class="literal">InnoDB</code>
              activities that cause logs to be flushed independently of
              the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a>
              setting, and sometimes less frequently due to scheduling
              issues. If logs are flushed once per second, up to one
              second of transactions can be lost in a crash. If logs are
              flushed more or less frequently than once per second, the
              amount of transactions that can be lost varies
              accordingly.
            </p></li><li class="listitem"><p>
              Log flushing frequency is controlled by
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_timeout"><code class="literal">innodb_flush_log_at_timeout</code></a>,
              which allows you to set log flushing frequency to
              <em class="replaceable"><code>N</code></em> seconds (where
              <em class="replaceable"><code>N</code></em> is <code class="literal">1 ...
              2700</code>, with a default value of 1). However, any
              <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process crash can erase up to
              <em class="replaceable"><code>N</code></em> seconds of transactions.
            </p></li><li class="listitem"><p>
              DDL changes and other internal <code class="literal">InnoDB</code>
              activities flush the log independently of the
              <code class="literal">innodb_flush_log_at_trx_commit</code> setting.
            </p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code>
              <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
              works regardless of the
              <code class="literal">innodb_flush_log_at_trx_commit</code> setting.
              Transactions are either applied entirely or erased
              entirely.
</p></li></ul>
</div>
<p>
          For durability and consistency in a replication setup that
          uses <code class="literal">InnoDB</code> with transactions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If binary logging is enabled, set
              <code class="literal">sync_binlog=1</code>.
            </p></li><li class="listitem"><p>
              Always set
              <code class="literal">innodb_flush_log_at_trx_commit=1</code>.
</p></li></ul>
</div>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Caution
</div>
<p>
            Many operating systems and some disk hardware fool the
            flush-to-disk operation. They may tell
            <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> that the flush has taken place,
            even though it has not. In this case, the durability of
            transactions is not guaranteed even with the recommended
            settings, and in the worst case, a power outage can corrupt
            <code class="literal">InnoDB</code> data. Using a battery-backed disk
            cache in the SCSI disk controller or in the disk itself
            speeds up file flushes, and makes the operation safer. You
            can also try to disable the caching of disk writes in
            hardware caches.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_flush_method"></a>
          <a class="indexterm" name="idm140091640415328"></a>

          <a class="indexterm" name="idm140091640414288"></a>

          <code class="literal">innodb_flush_method</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_flush_method"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-flush-method=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method">innodb_flush_method</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (Windows)</td>
<td><code class="literal">unbuffered</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (Unix)</td>
<td><code class="literal">fsync</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span> (Windows)</td>
<td><p class="valid-value"><code class="literal">unbuffered</code></p><p class="valid-value"><code class="literal">normal</code></p></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span> (Unix)</td>
<td><p class="valid-value"><code class="literal">fsync</code></p><p class="valid-value"><code class="literal">O_DSYNC</code></p><p class="valid-value"><code class="literal">littlesync</code></p><p class="valid-value"><code class="literal">nosync</code></p><p class="valid-value"><code class="literal">O_DIRECT</code></p><p class="valid-value"><code class="literal">O_DIRECT_NO_FSYNC</code></p></td>
</tr></tbody></table>
</div>
<p>
          Defines the method used to
          <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> data to
          <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_data_files" title="data files">data
          files</a> and <a class="link" href="glossary.html#glos_log_file" title="log file">log
          files</a>, which can affect I/O throughput.
        </p><p>
          On Unix-like systems, the default value is
          <code class="literal">fsync</code>. On Windows, the default value is
          <code class="literal">unbuffered</code>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            In MySQL 8.0,
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> options
            may be specified numerically.
</p>
</div>
<p>
          The <code class="literal">innodb_flush_method</code> options for
          Unix-like systems include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">fsync</code> or <code class="literal">0</code>:
              <code class="literal">InnoDB</code> uses the
              <code class="literal">fsync()</code> system call to flush both the
              data and log files. <code class="literal">fsync</code> is the
              default setting.
            </p></li><li class="listitem"><p>
              <code class="literal">O_DSYNC</code> or <code class="literal">1</code>:
              <code class="literal">InnoDB</code> uses <code class="literal">O_SYNC</code>
              to open and flush the log files, and
              <code class="literal">fsync()</code> to flush the data files.
              <code class="literal">InnoDB</code> does not use
              <code class="literal">O_DSYNC</code> directly because there have
              been problems with it on many varieties of Unix.
            </p></li><li class="listitem"><p>
              <code class="literal">littlesync</code> or <code class="literal">2</code>:
              This option is used for internal performance testing and
              is currently unsupported. Use at your own risk.
            </p></li><li class="listitem"><p>
              <code class="literal">nosync</code> or <code class="literal">3</code>: This
              option is used for internal performance testing and is
              currently unsupported. Use at your own risk.
            </p></li><li class="listitem"><p>
              <code class="literal">O_DIRECT</code> or <code class="literal">4</code>:
              <code class="literal">InnoDB</code> uses <code class="literal">O_DIRECT</code>
              (or <code class="literal">directio()</code> on Solaris) to open the
              data files, and uses <code class="literal">fsync()</code> to flush
              both the data and log files. This option is available on
              some GNU/Linux versions, FreeBSD, and Solaris.
            </p></li><li class="listitem"><p>
              <code class="literal">O_DIRECT_NO_FSYNC</code>:
              <code class="literal">InnoDB</code> uses <code class="literal">O_DIRECT</code>
              during flushing I/O, but skips the
              <code class="literal">fsync()</code> system call after each write
              operation.
            </p><p>
              Prior to MySQL 8.0.14, this setting is not suitable for
              file systems such as XFS and EXT4, which require an
              <code class="literal">fsync()</code> system call to synchronize file
              system metadata changes. If you are not sure whether your
              file system requires an <code class="literal">fsync()</code> system
              call to synchronize file system metadata changes, use
              <code class="literal">O_DIRECT</code> instead.
            </p><p>
              As of MySQL 8.0.14, <code class="literal">fsync()</code> is called
              after creating a new file, after increasing file size, and
              after closing a file, to ensure that file system metadata
              changes are synchronized. The <code class="literal">fsync()</code>
              system call is still skipped after each write operation.
            </p><p>
              On storage devices with cache, data loss is possible if
              data files and redo log files reside on different storage
              devices, and a crash occurs before data file writes are
              flushed from the device cache. If you use or intend to use
              different storage devices for redo logs and data files,
              use <code class="literal">O_DIRECT</code> instead.
</p></li></ul>
</div>
<p>
          The <code class="literal">innodb_flush_method</code> options for Windows
          systems include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">unbuffered</code> or <code class="literal">0</code>:
              <code class="literal">InnoDB</code> uses simulated asynchronous I/O
              and non-buffered I/O.
            </p></li><li class="listitem"><p>
              <code class="literal">normal</code> or <code class="literal">1</code>:
              <code class="literal">InnoDB</code> uses simulated asynchronous I/O
              and buffered I/O.
</p></li></ul>
</div>
<p>
          How each setting affects performance depends on hardware
          configuration and workload. Benchmark your particular
          configuration to decide which setting to use, or whether to
          keep the default setting. Examine the
          <a class="link" href="server-administration.html#statvar_Innodb_data_fsyncs"><code class="literal">Innodb_data_fsyncs</code></a> status
          variable to see the overall number of
          <code class="literal">fsync()</code> calls for each setting. The mix of
          read and write operations in your workload can affect how a
          setting performs. For example, on a system with a hardware
          RAID controller and battery-backed write cache,
          <code class="literal">O_DIRECT</code> can help to avoid double buffering
          between the <code class="literal">InnoDB</code> buffer pool and the
          operating system file system cache. On some systems where
          <code class="literal">InnoDB</code> data and log files are located on a
          SAN, the default value or <code class="literal">O_DSYNC</code> might be
          faster for a read-heavy workload with mostly
          <code class="literal">SELECT</code> statements. Always test this
          parameter with hardware and workload that reflect your
          production environment. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p><p>
          If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_dedicated_server"><code class="literal">innodb_dedicated_server</code></a> is
          enabled, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> value is
          automatically configured if it is not explicitly defined. For
          more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-dedicated-server" title="15.8.12 Enabling Automatic Configuration for a Dedicated MySQL Server">Section 15.8.12, “Enabling Automatic Configuration for a Dedicated MySQL Server”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_neighbors"></a>
          <a class="indexterm" name="idm140091640306256"></a>

          <code class="literal">innodb_flush_neighbors</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_flush_neighbors"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-flush-neighbors=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_neighbors">innodb_flush_neighbors</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&gt;= 8.0.3)</td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&lt;= 8.0.2)</td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p><p class="valid-value"><code class="literal">2</code></p></td>
</tr></tbody></table>
</div>
<p>
          Specifies whether <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> a
          page from the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> also
          flushes other <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty
          pages</a> in the same
          <a class="link" href="glossary.html#glos_extent" title="extent">extent</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              A setting of 0 turns
              <code class="literal">innodb_flush_neighbors</code> off and no other
              dirty pages are flushed from the buffer pool.
            </p></li><li class="listitem"><p>
              A setting of 1 flushes contiguous dirty pages in the same
              extent from the buffer pool.
            </p></li><li class="listitem"><p>
              A setting of 2 flushes dirty pages in the same extent from
              the buffer pool.
</p></li></ul>
</div>
<p>
          When the table data is stored on a traditional
          <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> storage device, flushing
          such <a class="link" href="glossary.html#glos_neighbor_page" title="neighbor page">neighbor pages</a>
          in one operation reduces I/O overhead (primarily for disk seek
          operations) compared to flushing individual pages at different
          times. For table data stored on
          <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a>, seek time is not a
          significant factor and you can set this option to 0 to spread
          out write operations. For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="15.8.3.6 Fine-tuning InnoDB Buffer Pool Flushing">Section 15.8.3.6, “Fine-tuning InnoDB Buffer Pool Flushing”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_sync"></a>
          <a class="indexterm" name="idm140091640254688"></a>

          <a class="indexterm" name="idm140091640253648"></a>

          <code class="literal">innodb_flush_sync</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_flush_sync"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-flush-sync[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync">innodb_flush_sync</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          The <code class="literal">innodb_flush_sync</code> parameter, which is
          enabled by default, causes the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting to
          be ignored for bursts of I/O activity that occur at
          <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpoints</a>. To adhere
          to the limit on <code class="literal">InnoDB</code> background I/O
          activity defined by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting,
          disable <code class="literal">innodb_flush_sync</code>.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_io_rate" title="15.8.7 Configuring the InnoDB Master Thread I/O Rate">Section 15.8.7, “Configuring the InnoDB Master Thread I/O Rate”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flushing_avg_loops"></a>
          <a class="indexterm" name="idm140091640215424"></a>

          <code class="literal">innodb_flushing_avg_loops</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_flushing_avg_loops"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-flushing-avg-loops=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flushing_avg_loops">innodb_flushing_avg_loops</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">30</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">1000</code></td>
</tr></tbody></table>
</div>
<p>
          Number of iterations for which <code class="literal">InnoDB</code> keeps
          the previously calculated snapshot of the flushing state,
          controlling how quickly
          <a class="link" href="glossary.html#glos_adaptive_flushing" title="adaptive flushing">adaptive
          flushing</a> responds to changing
          <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>. Increasing the
          value makes the rate of
          <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> operations change
          smoothly and gradually as the workload changes. Decreasing the
          value makes adaptive flushing adjust quickly to workload
          changes, which can cause spikes in flushing activity if the
          workload increases and decreases suddenly.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="15.8.3.6 Fine-tuning InnoDB Buffer Pool Flushing">Section 15.8.3.6, “Fine-tuning InnoDB Buffer Pool Flushing”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_force_load_corrupted"></a>
          <a class="indexterm" name="idm140091640173472"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_load_corrupted"><code class="literal">innodb_force_load_corrupted</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_force_load_corrupted"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-force-load-corrupted[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_load_corrupted">innodb_force_load_corrupted</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Permits <code class="literal">InnoDB</code> to load tables at startup
          that are marked as corrupted. Use only during troubleshooting,
          to recover data that is otherwise inaccessible. When
          troubleshooting is complete, disable this setting and restart
          the server.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_force_recovery"></a>
          <a class="indexterm" name="idm140091640140976"></a>

          <a class="indexterm" name="idm140091640139936"></a>

          <code class="literal">innodb_force_recovery</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_force_recovery"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-force-recovery=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery">innodb_force_recovery</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">6</code></td>
</tr></tbody></table>
</div>
<p>
          The <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
          mode, typically only changed in serious troubleshooting
          situations. Possible values are from 0 to 6. For the meanings
          of these values and important information about
          <code class="literal">innodb_force_recovery</code>, see
          <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="15.20.2 Forcing InnoDB Recovery">Section 15.20.2, “Forcing InnoDB Recovery”</a>.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
            Only set this variable to a value greater than 0 in an
            emergency situation so that you can start
            <code class="literal">InnoDB</code> and dump your tables. As a safety
            measure, <code class="literal">InnoDB</code> prevents
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
            <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations when
            <code class="literal">innodb_force_recovery</code> is greater than 0.
            An <code class="literal">innodb_force_recovery</code> setting of 4 or
            greater places <code class="literal">InnoDB</code> into read-only
            mode.
          </p><p>
            These restrictions may cause replication administration
            commands to fail with an error, as replication stores the
            slave status logs in <code class="literal">InnoDB</code> tables.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_fsync_threshold"></a>
          <a class="indexterm" name="idm140091640090400"></a>

          <a class="indexterm" name="idm140091640089360"></a>

          <code class="literal">innodb_fsync_threshold</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_fsync_threshold"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-fsync-threshold=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.13</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fsync_threshold">innodb_fsync_threshold</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2**64-1</code></td>
</tr></tbody></table>
</div>
<p>
          By default, when <code class="literal">InnoDB</code> creates a new data
          file, such as a new log file or tablespace file, it flushes
          the contents of the write buffer to disk only after the file
          is fully written, which can cause a large amount of disk write
          activity to occur at once. To force smaller, periodic flushes,
          use <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fsync_threshold"><code class="literal">innodb_fsync_threshold</code></a> to
          define a threshold size for the write buffer, in bytes. The
          contents of the write buffer are flushed to disk when the
          threshold size is reached. The default value of 0 forces the
          default behavior.
        </p><p>
          Specifying a write buffer threshold size to force smaller,
          periodic flushes may be beneficial in cases where multiple
          MySQL instances use the same storage devices. For example,
          creating a new MySQL instance and its associated data files
          could cause large surges of disk write activity, impeding the
          performance of other MySQL instances that use the same storage
          devices. Configuring a write buffer threshold size helps avoid
          such surges in disk write activity.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_aux_table"></a>
          <a class="indexterm" name="idm140091640045696"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_aux_table"><code class="literal">innodb_ft_aux_table</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_aux_table"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_aux_table">innodb_ft_aux_table</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
          Specifies the qualified name of an <code class="literal">InnoDB</code>
          table containing a <code class="literal">FULLTEXT</code> index. This
          variable is intended for diagnostic purposes and can only be
          set at runtime. For example:
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_ft_aux_table = 'test/t1';
</pre><p>
          After you set this variable to a name in the format
          <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>table_name</code></em></code>,
          the <code class="literal">INFORMATION_SCHEMA</code> tables
          <a class="link" href="information-schema.html#innodb-ft-index-table-table" title="25.39.18 The INFORMATION_SCHEMA INNODB_FT_INDEX_TABLE Table"><code class="literal">INNODB_FT_INDEX_TABLE</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="25.39.17 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-config-table" title="25.39.14 The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INNODB_FT_CONFIG</code></a>,
          <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="25.39.16 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a>, and
          <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="25.39.13 The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a> show
          information about the search index for the specified table.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-fulltext_index-tables" title="15.14.4 InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables">Section 15.14.4, “InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_cache_size"></a>
          <a class="indexterm" name="idm140091640007888"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_cache_size"><code class="literal">innodb_ft_cache_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_cache_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ft-cache-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_cache_size">innodb_ft_cache_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">8000000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1600000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">80000000</code></td>
</tr></tbody></table>
</div>
<p>
          The memory allocated, in bytes, for the
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> search
          index cache, which holds a parsed document in memory while
          creating an <code class="literal">InnoDB</code>
          <code class="literal">FULLTEXT</code> index. Index inserts and updates
          are only committed to disk when the
          <code class="literal">innodb_ft_cache_size</code> size limit is reached.
          <code class="literal">innodb_ft_cache_size</code> defines the cache size
          on a per table basis. To set a global limit for all tables,
          see
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size"><code class="literal">innodb_ft_total_cache_size</code></a>.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index-cache" title="InnoDB Full-Text Index Cache">InnoDB Full-Text Index Cache</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_enable_diag_print"></a>
          <a class="indexterm" name="idm140091639963216"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_diag_print"><code class="literal">innodb_ft_enable_diag_print</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_enable_diag_print"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ft-enable-diag-print[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_diag_print">innodb_ft_enable_diag_print</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Whether to enable additional full-text search (FTS) diagnostic
          output. This option is primarily intended for advanced FTS
          debugging and will not be of interest to most users. Output is
          printed to the error log and includes information such as:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              FTS index sync progress (when the FTS cache limit is
              reached). For example:
            </p><pre data-lang="terminal" class="programlisting">
FTS SYNC for table test, deleted count: 100 size: 10000 bytes
SYNC words: 100
</pre></li><li class="listitem"><p>
              FTS optimize progress. For example:
            </p><pre data-lang="terminal" class="programlisting">
FTS start optimize test
FTS_OPTIMIZE: optimize "mysql"
FTS_OPTIMIZE: processed "mysql"
</pre></li><li class="listitem"><p>
              FTS index build progress. For example:
            </p><pre data-lang="terminal" class="programlisting">
Number of doc processed: 1000
</pre></li><li class="listitem"><p>
              For FTS queries, the query parsing tree, word weight,
              query processing time, and memory usage are printed. For
              example:
            </p><pre data-lang="terminal" class="programlisting">
FTS Search Processing time: 1 secs: 100 millisec: row(s) 10000
Full Search Memory: 245666 (bytes),  Row: 10000
</pre></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_ft_enable_stopword"></a>
          <a class="indexterm" name="idm140091639923392"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_stopword"><code class="literal">innodb_ft_enable_stopword</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_enable_stopword"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ft-enable-stopword[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_enable_stopword">innodb_ft_enable_stopword</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global, Session</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies that a set of
          <a class="link" href="glossary.html#glos_stopword" title="stopword">stopwords</a> is associated
          with an <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code>
          index at the time the index is created. If the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_user_stopword_table"><code class="literal">innodb_ft_user_stopword_table</code></a>
          option is set, the stopwords are taken from that table. Else,
          if the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_server_stopword_table"><code class="literal">innodb_ft_server_stopword_table</code></a>
          option is set, the stopwords are taken from that table.
          Otherwise, a built-in set of default stopwords is used.
        </p><p>
          For more information, see
          <a class="xref" href="functions.html#fulltext-stopwords" title="12.9.4 Full-Text Stopwords">Section 12.9.4, “Full-Text Stopwords”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_max_token_size"></a>
          <a class="indexterm" name="idm140091639885488"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_max_token_size"><code class="literal">innodb_ft_max_token_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_max_token_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ft-max-token-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_max_token_size">innodb_ft_max_token_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">84</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">10</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">84</code></td>
</tr></tbody></table>
</div>
<p>
          Maximum character length of words that are stored in an
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index.
          Setting a limit on this value reduces the size of the index,
          thus speeding up queries, by omitting long keywords or
          arbitrary collections of letters that are not real words and
          are not likely to be search terms.
        </p><p>
          For more information, see
          <a class="xref" href="functions.html#fulltext-fine-tuning" title="12.9.6 Fine-Tuning MySQL Full-Text Search">Section 12.9.6, “Fine-Tuning MySQL Full-Text Search”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_min_token_size"></a>
          <a class="indexterm" name="idm140091639844992"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_min_token_size"><code class="literal">innodb_ft_min_token_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_min_token_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ft-min-token-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_min_token_size">innodb_ft_min_token_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">3</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">16</code></td>
</tr></tbody></table>
</div>
<p>
          Minimum length of words that are stored in an
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index.
          Increasing this value reduces the size of the index, thus
          speeding up queries, by omitting common words that are
          unlikely to be significant in a search context, such as the
          English words <span class="quote">“<span class="quote">a</span>”</span> and <span class="quote">“<span class="quote">to</span>”</span>. For
          content using a CJK (Chinese, Japanese, Korean) character set,
          specify a value of 1.
        </p><p>
          For more information, see
          <a class="xref" href="functions.html#fulltext-fine-tuning" title="12.9.6 Fine-Tuning MySQL Full-Text Search">Section 12.9.6, “Fine-Tuning MySQL Full-Text Search”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_num_word_optimize"></a>
          <a class="indexterm" name="idm140091639803664"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_num_word_optimize"><code class="literal">innodb_ft_num_word_optimize</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_num_word_optimize"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ft-num-word-optimize=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_num_word_optimize">innodb_ft_num_word_optimize</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">2000</code></td>
</tr></tbody></table>
</div>
<p>
          Number of words to process during each
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> operation on an
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index.
          Because a bulk insert or update operation to a table
          containing a full-text search index could require substantial
          index maintenance to incorporate all changes, you might do a
          series of <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>
          statements, each picking up where the last left off.
        </p><p>
          For more information, see
          <a class="xref" href="functions.html#fulltext-fine-tuning" title="12.9.6 Fine-Tuning MySQL Full-Text Search">Section 12.9.6, “Fine-Tuning MySQL Full-Text Search”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_result_cache_limit"></a>
          <a class="indexterm" name="idm140091639766784"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_result_cache_limit"><code class="literal">innodb_ft_result_cache_limit</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_result_cache_limit"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ft-result-cache-limit=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_result_cache_limit">innodb_ft_result_cache_limit</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">2000000000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1000000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2**32-1</code></td>
</tr></tbody></table>
</div>
<p>
          The <code class="literal">InnoDB</code> full-text search query result
          cache limit (defined in bytes) per full-text search query or
          per thread. Intermediate and final <code class="literal">InnoDB</code>
          full-text search query results are handled in memory. Use
          <code class="literal">innodb_ft_result_cache_limit</code> to place a
          size limit on the full-text search query result cache to avoid
          excessive memory consumption in case of very large
          <code class="literal">InnoDB</code> full-text search query results
          (millions or hundreds of millions of rows, for example).
          Memory is allocated as required when a full-text search query
          is processed. If the result cache size limit is reached, an
          error is returned indicating that the query exceeds the
          maximum allowed memory.
        </p><p>
          The maximum value of
          <code class="literal">innodb_ft_result_cache_limit</code> for all
          platform types and bit sizes is 2**32-1.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_server_stopword_table"></a>
          <a class="indexterm" name="idm140091639724272"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_server_stopword_table"><code class="literal">innodb_ft_server_stopword_table</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_server_stopword_table"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ft-server-stopword-table=db_name/table_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_server_stopword_table">innodb_ft_server_stopword_table</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
          This option is used to specify your own
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index
          stopword list for all <code class="literal">InnoDB</code> tables. To
          configure your own stopword list for a specific
          <code class="literal">InnoDB</code> table, use
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_user_stopword_table"><code class="literal">innodb_ft_user_stopword_table</code></a>.
        </p><p>
          Set <code class="literal">innodb_ft_server_stopword_table</code> to the
          name of the table containing a list of stopwords, in the
          format
          <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>table_name</code></em></code>.
        </p><p>
          The stopword table must exist before you configure
          <code class="literal">innodb_ft_server_stopword_table</code>.
          <code class="literal">innodb_ft_enable_stopword</code> must be enabled
          and <code class="literal">innodb_ft_server_stopword_table</code> option
          must be configured before you create the
          <code class="literal">FULLTEXT</code> index.
        </p><p>
          The stopword table must be an <code class="literal">InnoDB</code> table,
          containing a single <code class="literal">VARCHAR</code> column named
          <code class="literal">value</code>.
        </p><p>
          For more information, see
          <a class="xref" href="functions.html#fulltext-stopwords" title="12.9.4 Full-Text Stopwords">Section 12.9.4, “Full-Text Stopwords”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_sort_pll_degree"></a>
          <a class="indexterm" name="idm140091639678736"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_sort_pll_degree"><code class="literal">innodb_ft_sort_pll_degree</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_sort_pll_degree"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ft-sort-pll-degree=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_sort_pll_degree">innodb_ft_sort_pll_degree</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">2</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">32</code></td>
</tr></tbody></table>
</div>
<p>
          Number of threads used in parallel to index and tokenize text
          in an <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code>
          index when building a <a class="link" href="glossary.html#glos_search_index" title="search index">search
          index</a>.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index" title="15.6.2.4 InnoDB FULLTEXT Indexes">Section 15.6.2.4, “InnoDB FULLTEXT Indexes”</a>, and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_sort_buffer_size"><code class="literal">innodb_sort_buffer_size</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_total_cache_size"></a>
          <a class="indexterm" name="idm140091639636224"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size"><code class="literal">innodb_ft_total_cache_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_total_cache_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ft-total-cache-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size">innodb_ft_total_cache_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">640000000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">32000000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">1600000000</code></td>
</tr></tbody></table>
</div>
<p>
          The total memory allocated, in bytes, for the
          <code class="literal">InnoDB</code> full-text search index cache for all
          tables. Creating numerous tables, each with a
          <code class="literal">FULLTEXT</code> search index, could consume a
          significant portion of available memory.
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size"><code class="literal">innodb_ft_total_cache_size</code></a>
          defines a global memory limit for all full-text search indexes
          to help avoid excessive memory consumption. If the global
          limit is reached by an index operation, a forced sync is
          triggered.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index-cache" title="InnoDB Full-Text Index Cache">InnoDB Full-Text Index Cache</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_ft_user_stopword_table"></a>
          <a class="indexterm" name="idm140091639594192"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_user_stopword_table"><code class="literal">innodb_ft_user_stopword_table</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_ft_user_stopword_table"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-ft-user-stopword-table=db_name/table_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_user_stopword_table">innodb_ft_user_stopword_table</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global, Session</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
          This option is used to specify your own
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index
          stopword list on a specific table. To configure your own
          stopword list for all <code class="literal">InnoDB</code> tables, use
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_server_stopword_table"><code class="literal">innodb_ft_server_stopword_table</code></a>.
        </p><p>
          Set <code class="literal">innodb_ft_user_stopword_table</code> to the
          name of the table containing a list of stopwords, in the
          format
          <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>table_name</code></em></code>.
        </p><p>
          The stopword table must exist before you configure
          <code class="literal">innodb_ft_user_stopword_table</code>.
          <code class="literal">innodb_ft_enable_stopword</code> must be enabled
          and <code class="literal">innodb_ft_user_stopword_table</code> must be
          configured before you create the <code class="literal">FULLTEXT</code>
          index.
        </p><p>
          The stopword table must be an <code class="literal">InnoDB</code> table,
          containing a single <code class="literal">VARCHAR</code> column named
          <code class="literal">value</code>.
        </p><p>
          For more information, see
          <a class="xref" href="functions.html#fulltext-stopwords" title="12.9.4 Full-Text Stopwords">Section 12.9.4, “Full-Text Stopwords”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_io_capacity"></a>
          <a class="indexterm" name="idm140091639549360"></a>

          <a class="indexterm" name="idm140091639548320"></a>

          <code class="literal">innodb_io_capacity</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_io_capacity"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-io-capacity=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity">innodb_io_capacity</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">200</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">100</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (64-bit platforms)</td>
<td><code class="literal">2**64-1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (32-bit platforms)</td>
<td><code class="literal">2**32-1</code></td>
</tr></tbody></table>
</div>
<p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
          parameter sets an upper limit on the number of I/O operations
          performed per second by <code class="literal">InnoDB</code> background
          tasks, such as <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a>
          pages from the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
          pool</a> and merging data from the
          <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">change buffer</a>.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> limit
          is a total limit for all buffer pool instances. When dirty
          pages are flushed, the limit is divided equally among buffer
          pool instances.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> should be
          set to approximately the number of I/O operations that the
          system can perform per second. Ideally, keep the setting as
          low as practical, but not so low that background activities
          fall behind. If the value is too high, data is removed from
          the buffer pool and insert buffer too quickly for caching to
          provide a significant benefit.
        </p><p>
          The default value is 200. For busy systems capable of higher
          I/O rates, you can set a higher value to help the server
          handle the background maintenance work associated with a high
          rate of row changes.
        </p><p>
          In general, you can increase the value as a function of the
          number of drives used for <a class="link" href="innodb-storage-engine.html" title="Chapter 15 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>
          I/O. For example, you can increase the value on systems that
          use multiple disks or solid-state disks (SSD).
        </p><p>
          The default setting of 200 is generally sufficient for a
          lower-end SSD. For a higher-end, bus-attached SSD, consider a
          higher setting such as 1000, for example. For systems with
          individual 5400 RPM or 7200 RPM drives, you might lower the
          value to <code class="literal">100</code>, which represents an estimated
          proportion of the I/O operations per second (IOPS) available
          to older-generation disk drives that can perform about 100
          IOPS.
        </p><p>
          Although you can specify a very high value such as one
          million, in practice such large values have little if any
          benefit. Generally, a value of 20000 or higher is not
          recommended unless you have proven that lower values are
          insufficient for your workload.
        </p><p>
          Consider write workload when tuning
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>. Systems
          with large write workloads are likely to benefit from a higher
          setting. A lower setting may be sufficient for systems with a
          small write workload.
        </p><p>
          You can set <code class="literal">innodb_io_capacity</code> to any
          number 100 or greater to a maximum defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>.
          <code class="literal">innodb_io_capacity</code> can be set in the MySQL
          option file (<code class="literal">my.cnf</code> or
          <code class="literal">my.ini</code>) or changed dynamically using a
          <code class="literal">SET GLOBAL</code> statement, which requires
          privileges sufficient to set global system variables. See
          <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync"><code class="literal">innodb_flush_sync</code></a>
          configuration option causes the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting to
          be ignored during bursts of I/O activity that occur at
          checkpoints.
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_sync"><code class="literal">innodb_flush_sync</code></a> is enabled
          by default.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_io_rate" title="15.8.7 Configuring the InnoDB Master Thread I/O Rate">Section 15.8.7, “Configuring the InnoDB Master Thread I/O Rate”</a> for
          more information. For general information about
          <code class="literal">InnoDB</code> I/O performance, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_io_capacity_max"></a>
          <a class="indexterm" name="idm140091639478704"></a>

          <code class="literal">innodb_io_capacity_max</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_io_capacity_max"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-io-capacity-max=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max">innodb_io_capacity_max</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">see description</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">100</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (Windows, 64-bit platforms)</td>
<td><code class="literal">2**32-1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (Unix, 64-bit platforms)</td>
<td><code class="literal">2**64-1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (32-bit platforms)</td>
<td><code class="literal">2**32-1</code></td>
</tr></tbody></table>
</div>
<p>
          If flushing activity falls behind, <code class="literal">InnoDB</code>
          can flush more aggressively than the limit imposed by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>.
          <code class="literal">innodb_io_capacity_max</code> defines an upper
          limit the number of I/O operations performed per second by
          <code class="literal">InnoDB</code> background tasks in such situations.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>
          setting is a total limit for all buffer pool instances.
        </p><p>
          If you specify an
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting at
          startup but do not specify a value for
          <code class="literal">innodb_io_capacity_max</code>,
          <code class="literal">innodb_io_capacity_max</code> defaults to twice
          the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>, with a
          minimum value of 2000.
        </p><p>
          When configuring <code class="literal">innodb_io_capacity_max</code>,
          twice the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
          is often a good starting point. The default value of 2000 is
          intended for workloads that use a solid-state disk (SSD) or
          more than one regular disk drive. A setting of 2000 is likely
          too high for workloads that do not use SSD or multiple disk
          drives, and could allow too much flushing. For a single
          regular disk drive, a setting between 200 and 400 is
          recommended. For a high-end, bus-attached SSD, consider a
          higher setting such as 2500. As with the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting,
          keep the setting as low as practical, but not so low that
          <code class="literal">InnoDB</code> cannot sufficiently extend beyond
          the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> limit,
          if necessary.
        </p><p>
          Consider write workload when tuning
          <code class="literal">innodb_io_capacity_max</code>. Systems with large
          write workloads may benefit from a higher setting. A lower
          setting may be sufficient for systems with a small write
          workload.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a> cannot
          be set to a value lower than the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> value.
        </p><p>
          Setting
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a> to
          <code class="literal">DEFAULT</code> using a
          <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET</code></a>
          statement (<code class="literal">SET GLOBAL
          innodb_io_capacity_max=DEFAULT</code>) sets
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a> to the
          maximum value.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="15.8.3.6 Fine-tuning InnoDB Buffer Pool Flushing">Section 15.8.3.6, “Fine-tuning InnoDB Buffer Pool Flushing”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_limit_optimistic_insert_debug"></a>
          <a class="indexterm" name="idm140091639407488"></a>

          <a class="indexterm" name="idm140091639406448"></a>

          <code class="literal">innodb_limit_optimistic_insert_debug</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_limit_optimistic_insert_debug"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-limit-optimistic-insert-debug=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_limit_optimistic_insert_debug">innodb_limit_optimistic_insert_debug</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2**32-1</code></td>
</tr></tbody></table>
</div>
<p>
          Limits the number of records per
          <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> page. A default
          value of 0 means that no limit is imposed. This option is only
          available if debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_lock_wait_timeout"></a>
          <a class="indexterm" name="idm140091639366320"></a>

          <a class="indexterm" name="idm140091639365216"></a>

          <code class="literal">innodb_lock_wait_timeout</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_lock_wait_timeout"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-lock-wait-timeout=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout">innodb_lock_wait_timeout</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global, Session</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">50</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">1073741824</code></td>
</tr></tbody></table>
</div>
<p>
          The length of time in seconds an <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a> waits for
          a <a class="link" href="glossary.html#glos_row_lock" title="row lock">row lock</a> before giving
          up. The default value is 50 seconds. A transaction that tries
          to access a row that is locked by another
          <code class="literal">InnoDB</code> transaction waits at most this many
          seconds for write access to the row before issuing the
          following error:
        </p><pre data-lang="terminal" class="programlisting">
ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction
</pre><p>
          When a lock wait timeout occurs, the current statement is
          <a class="link" href="glossary.html#glos_rollback" title="rollback">rolled back</a> (not the
          entire transaction). To have the entire transaction roll back,
          start the server with the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb-rollback-on-timeout</code></a>
          option. See also <a class="xref" href="innodb-storage-engine.html#innodb-error-handling" title="15.20.4 InnoDB Error Handling">Section 15.20.4, “InnoDB Error Handling”</a>.
        </p><p>
          You might decrease this value for highly interactive
          applications or <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a> systems,
          to display user feedback quickly or put the update into a
          queue for processing later. You might increase this value for
          long-running back-end operations, such as a transform step in
          a data warehouse that waits for other large insert or update
          operations to finish.
        </p><p>
          <code class="literal">innodb_lock_wait_timeout</code> applies to
          <code class="literal">InnoDB</code> row locks. A MySQL
          <a class="link" href="glossary.html#glos_table_lock" title="table lock">table lock</a> does not
          happen inside <code class="literal">InnoDB</code> and this timeout does
          not apply to waits for table locks.
        </p><p>
          The lock wait timeout value does not apply to
          <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_deadlock_detect"><code class="literal">innodb_deadlock_detect</code></a> is
          enabled (the default) because <code class="literal">InnoDB</code>
          detects deadlocks immediately and rolls back one of the
          deadlocked transactions. When
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_deadlock_detect"><code class="literal">innodb_deadlock_detect</code></a> is
          disabled, <code class="literal">InnoDB</code> relies on
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> for
          transaction rollback when a deadlock occurs. See
          <a class="xref" href="innodb-storage-engine.html#innodb-deadlock-detection" title="15.7.5.2 Deadlock Detection and Rollback">Section 15.7.5.2, “Deadlock Detection and Rollback”</a>.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> can
          be set at runtime with the <code class="literal">SET GLOBAL</code> or
          <code class="literal">SET SESSION</code> statement. Changing the
          <code class="literal">GLOBAL</code> setting requires privileges
          sufficient to set global system variables (see
          <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>) and affects the
          operation of all clients that subsequently connect. Any client
          can change the <code class="literal">SESSION</code> setting for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>,
          which affects only that client.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_buffer_size"></a>
          <a class="indexterm" name="idm140091639300848"></a>

          <a class="indexterm" name="idm140091639299808"></a>

          <code class="literal">innodb_log_buffer_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_buffer_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-buffer-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span> (&gt;= 8.0.11)</td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size">innodb_log_buffer_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span> (&lt;= 8.0.4)</td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size">innodb_log_buffer_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span> (&gt;= 8.0.11)</td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span> (&lt;= 8.0.4)</td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span> (&gt;= 8.0.11)</td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span> (&lt;= 8.0.4)</td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span> (&gt;= 8.0.11)</td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span> (&lt;= 8.0.4)</td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">16777216</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1048576</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p>
          The size in bytes of the buffer that <code class="literal">InnoDB</code>
          uses to write to the <a class="link" href="glossary.html#glos_log_file" title="log file">log
          files</a> on disk. The default is 16MB. A large
          <a class="link" href="glossary.html#glos_log_buffer" title="log buffer">log buffer</a> enables
          large <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> to
          run without the need to write the log to disk before the
          transactions <a class="link" href="glossary.html#glos_commit" title="commit">commit</a>. Thus,
          if you have transactions that update, insert, or delete many
          rows, making the log buffer larger saves disk I/O. For related
          information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-startup-memory-configuration" title="Memory Configuration">Memory Configuration</a>, and
          <a class="xref" href="optimization.html#optimizing-innodb-logging" title="8.5.4 Optimizing InnoDB Redo Logging">Section 8.5.4, “Optimizing InnoDB Redo Logging”</a>. For general I/O
          tuning advice, see <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_checkpoint_fuzzy_now"></a>
          <a class="indexterm" name="idm140091639241600"></a>

          <a class="indexterm" name="idm140091639240496"></a>

          <code class="literal">innodb_log_checkpoint_fuzzy_now</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_checkpoint_fuzzy_now"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-checkpoint-fuzzy-now[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.13</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checkpoint_fuzzy_now">innodb_log_checkpoint_fuzzy_now</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enable this debug option to force <code class="literal">InnoDB</code> to
          write a fuzzy checkpoint. This option is only available if
          debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_checkpoint_now"></a>
          <a class="indexterm" name="idm140091639203904"></a>

          <a class="indexterm" name="idm140091639202800"></a>

          <code class="literal">innodb_log_checkpoint_now</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_checkpoint_now"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-checkpoint-now[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checkpoint_now">innodb_log_checkpoint_now</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enable this debug option to force <code class="literal">InnoDB</code> to
          write a checkpoint. This option is only available if debugging
          support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_checksums"></a>
          <a class="indexterm" name="idm140091639168928"></a>

          <a class="indexterm" name="idm140091639167888"></a>

          <code class="literal">innodb_log_checksums</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_checksums"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-checksums[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_checksums">innodb_log_checksums</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          Enables or disables checksums for redo log pages.
        </p><p>
          <code class="literal">innodb_log_checksums=ON</code> enables the
          <code class="literal">CRC-32C</code> checksum algorithm for redo log
          pages. When <code class="literal">innodb_log_checksums</code> is
          disabled, the contents of the redo log page checksum field are
          ignored.
        </p><p>
          Checksums on the redo log header page and redo log checkpoint
          pages are never disabled.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_compressed_pages"></a>
          <a class="indexterm" name="idm140091639133312"></a>

          <code class="literal">innodb_log_compressed_pages</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_compressed_pages"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-compressed-pages[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_compressed_pages">innodb_log_compressed_pages</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies whether images of
          <a class="link" href="glossary.html#glos_compression" title="compression">re-compressed</a>
          <a class="link" href="glossary.html#glos_page" title="page">pages</a> are written to the
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a>. Re-compression
          may occur when changes are made to compressed data.
        </p><p>
          <code class="literal">innodb_log_compressed_pages</code> is enabled by
          default to prevent corruption that could occur if a different
          version of the <code class="literal">zlib</code> compression algorithm
          is used during recovery. If you are certain that the
          <code class="literal">zlib</code> version will not change, you can
          disable <code class="literal">innodb_log_compressed_pages</code> to
          reduce redo log generation for workloads that modify
          compressed data.
        </p><p>
          To measure the effect of enabling or disabling
          <code class="literal">innodb_log_compressed_pages</code>, compare redo
          log generation for both settings under the same workload.
          Options for measuring redo log generation include observing
          the <code class="literal">Log sequence number</code> (LSN) in the
          <code class="literal">LOG</code> section of
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> output, or monitoring
          <a class="link" href="server-administration.html#statvar_Innodb_os_log_written"><code class="literal">Innodb_os_log_written</code></a> status
          for the number of bytes written to the redo log files.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-compression-oltp" title="15.9.1.6 Compression for OLTP Workloads">Section 15.9.1.6, “Compression for OLTP Workloads”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_file_size"></a>
          <a class="indexterm" name="idm140091639089664"></a>

          <a class="indexterm" name="idm140091639088624"></a>

          <code class="literal">innodb_log_file_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_file_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-file-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size">innodb_log_file_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">50331648</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">4194304</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">512GB / innodb_log_files_in_group</code></td>
</tr></tbody></table>
</div>
<p>
          The size in bytes of each <a class="link" href="glossary.html#glos_log_file" title="log file">log
          file</a> in a <a class="link" href="glossary.html#glos_log_group" title="log group">log
          group</a>. The combined size of log files
          (<code class="literal">innodb_log_file_size</code> *
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>)
          cannot exceed a maximum value that is slightly less than
          512GB. A pair of 255 GB log files, for example, approaches the
          limit but does not exceed it. The default value is 48MB.
        </p><p>
          Generally, the combined size of the log files should be large
          enough that the server can smooth out peaks and troughs in
          workload activity, which often means that there is enough redo
          log space to handle more than an hour of write activity. The
          larger the value, the less checkpoint flush activity is
          required in the buffer pool, saving disk I/O. Larger log files
          also make <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash
          recovery</a> slower, although improvements to recovery
          performance make log file size less of a consideration than it
          was in earlier versions of MySQL.
        </p><p>
          The minimum <code class="literal">innodb_log_file_size</code> is 4MB.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-startup-log-file-configuration" title="Redo Log File Configuration">Redo Log File Configuration</a>. For
          general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p><p>
          If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_dedicated_server"><code class="literal">innodb_dedicated_server</code></a> is
          enabled, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> value is
          automatically configured if it is not explicitly defined. For
          more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-dedicated-server" title="15.8.12 Enabling Automatic Configuration for a Dedicated MySQL Server">Section 15.8.12, “Enabling Automatic Configuration for a Dedicated MySQL Server”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_files_in_group"></a>
          <a class="indexterm" name="idm140091639038304"></a>

          <a class="indexterm" name="idm140091639037200"></a>

          <code class="literal">innodb_log_files_in_group</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_files_in_group"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-files-in-group=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group">innodb_log_files_in_group</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">2</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">2</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">100</code></td>
</tr></tbody></table>
</div>
<p>
          The number of <a class="link" href="glossary.html#glos_log_file" title="log file">log files</a>
          in the <a class="link" href="glossary.html#glos_log_group" title="log group">log group</a>.
          <code class="literal">InnoDB</code> writes to the files in a circular
          fashion. The default (and recommended) value is 2. The
          location of the files is specified by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_group_home_dir"><code class="literal">innodb_log_group_home_dir</code></a>.
          The combined size of log files
          (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> *
          <code class="literal">innodb_log_files_in_group</code>) can be up to
          512GB.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-startup-log-file-configuration" title="Redo Log File Configuration">Redo Log File Configuration</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_group_home_dir"></a>
          <a class="indexterm" name="idm140091638992688"></a>

          <a class="indexterm" name="idm140091638991584"></a>

          <code class="literal">innodb_log_group_home_dir</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_group_home_dir"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-group-home-dir=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_group_home_dir">innodb_log_group_home_dir</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Directory name</td>
</tr></tbody></table>
</div>
<p>
          The directory path to the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> files, whose
          number is specified by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>. If
          you do not specify any <code class="literal">InnoDB</code> log
          variables, the default is to create two files named
          <code class="filename">ib_logfile0</code> and
          <code class="filename">ib_logfile1</code> in the MySQL data directory.
          Log file size is given by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> system
          variable.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-startup-log-file-configuration" title="Redo Log File Configuration">Redo Log File Configuration</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_spin_cpu_abs_lwm"></a>
          <a class="indexterm" name="idm140091638955680"></a>

          <a class="indexterm" name="idm140091638954576"></a>

          <code class="literal">innodb_log_spin_cpu_abs_lwm</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_spin_cpu_abs_lwm"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-spin-cpu-abs-lwm=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_spin_cpu_abs_lwm">innodb_log_spin_cpu_abs_lwm</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">80</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the minimum amount of CPU usage below which user
          threads no longer spin while waiting for flushed redo. The
          value is expressed as a sum of CPU core usage. For example,
          The default value of 80 is 80% of a single CPU core. On a
          system with a multi-core processor, a value of 150 represents
          100% usage of one CPU core plus 50% usage of a second CPU
          core.
        </p><p>
          For related information, see
          <a class="xref" href="optimization.html#optimizing-innodb-logging" title="8.5.4 Optimizing InnoDB Redo Logging">Section 8.5.4, “Optimizing InnoDB Redo Logging”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_spin_cpu_pct_hwm"></a>
          <a class="indexterm" name="idm140091638912880"></a>

          <a class="indexterm" name="idm140091638911776"></a>

          <code class="literal">innodb_log_spin_cpu_pct_hwm</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_spin_cpu_pct_hwm"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-spin-cpu-pct-hwm=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_spin_cpu_pct_hwm">innodb_log_spin_cpu_pct_hwm</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">50</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">100</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the maximum amount of CPU usage above which user
          threads no longer spin while waiting for flushed redo. The
          value is expressed as a percentage of the combined total
          processing power of all CPU cores. The default value is 50%.
          For example, 100% usage of two CPU cores is 50% of the
          combined CPU processing power on a server with four CPU cores.
        </p><p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_spin_cpu_pct_hwm"><code class="literal">innodb_log_spin_cpu_pct_hwm</code></a>
          configuration option respects processor affinity. For example,
          if a server has 48 cores but the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
          process is pinned to only four CPU cores, the other 44 CPU
          cores are ignored.
        </p><p>
          For related information, see
          <a class="xref" href="optimization.html#optimizing-innodb-logging" title="8.5.4 Optimizing InnoDB Redo Logging">Section 8.5.4, “Optimizing InnoDB Redo Logging”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_wait_for_flush_spin_hwm"></a>
          <a class="indexterm" name="idm140091638866832"></a>

          <a class="indexterm" name="idm140091638865792"></a>

          <code class="literal">innodb_log_wait_for_flush_spin_hwm</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_wait_for_flush_spin_hwm"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-wait-for-flush-spin-hwm=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_wait_for_flush_spin_hwm">innodb_log_wait_for_flush_spin_hwm</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">400</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (64-bit platforms)</td>
<td><code class="literal">2**64-1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (32-bit platforms)</td>
<td><code class="literal">2**32-1</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the maximum average log flush time beyond which user
          threads no longer spin while waiting for flushed redo. The
          default value is 400 microseconds.
        </p><p>
          For related information, see
          <a class="xref" href="optimization.html#optimizing-innodb-logging" title="8.5.4 Optimizing InnoDB Redo Logging">Section 8.5.4, “Optimizing InnoDB Redo Logging”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_write_ahead_size"></a>
          <a class="indexterm" name="idm140091638820832"></a>

          <a class="indexterm" name="idm140091638819728"></a>

          <code class="literal">innodb_log_write_ahead_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_log_write_ahead_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-log-write-ahead-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size">innodb_log_write_ahead_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">8192</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">512 (log file block size)</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">Equal to innodb_page_size</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the write-ahead block size for the redo log, in bytes.
          To avoid <span class="quote">“<span class="quote">read-on-write</span>”</span>, set
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size"><code class="literal">innodb_log_write_ahead_size</code></a>
          to match the operating system or file system cache block size.
          The default setting is 8192 bytes. Read-on-write occurs when
          redo log blocks are not entirely cached to the operating
          system or file system due to a mismatch between write-ahead
          block size for the redo log and operating system or file
          system cache block size.
        </p><p>
          Valid values for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size"><code class="literal">innodb_log_write_ahead_size</code></a>
          are multiples of the <code class="literal">InnoDB</code> log file block
          size (2<sup>n</sup>). The minimum value is the
          <code class="literal">InnoDB</code> log file block size (512).
          Write-ahead does not occur when the minimum value is
          specified. The maximum value is equal to the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value. If
          you specify a value for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size"><code class="literal">innodb_log_write_ahead_size</code></a>
          that is larger than the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value, the
          <code class="literal">innodb_log_write_ahead_size</code> setting is
          truncated to the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value.
        </p><p>
          Setting the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size"><code class="literal">innodb_log_write_ahead_size</code></a>
          value too low in relation to the operating system or file
          system cache block size results in
          <span class="quote">“<span class="quote">read-on-write</span>”</span>. Setting the value too high may
          have a slight impact on <code class="literal">fsync</code> performance
          for log file writes due to several blocks being written at
          once.
        </p><p>
          For related information, see
          <a class="xref" href="optimization.html#optimizing-innodb-logging" title="8.5.4 Optimizing InnoDB Redo Logging">Section 8.5.4, “Optimizing InnoDB Redo Logging”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_lru_scan_depth"></a>
          <a class="indexterm" name="idm140091638766144"></a>

          <code class="literal">innodb_lru_scan_depth</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_lru_scan_depth"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-lru-scan-depth=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_lru_scan_depth">innodb_lru_scan_depth</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1024</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">100</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (64-bit platforms)</td>
<td><code class="literal">2**64-1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (32-bit platforms)</td>
<td><code class="literal">2**32-1</code></td>
</tr></tbody></table>
</div>
<p>
          A parameter that influences the algorithms and heuristics for
          the <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> operation for the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. Primarily
          of interest to performance experts tuning I/O-intensive
          workloads. It specifies, per buffer pool instance, how far
          down the buffer pool LRU page list the page cleaner thread
          scans looking for <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty
          pages</a> to flush. This is a background operation
          performed once per second.
        </p><p>
          A setting smaller than the default is generally suitable for
          most workloads. A value that is much higher than necessary may
          impact performance. Only consider increasing the value if you
          have spare I/O capacity under a typical workload. Conversely,
          if a write-intensive workload saturates your I/O capacity,
          decrease the value, especially in the case of a large buffer
          pool.
        </p><p>
          When tuning <code class="literal">innodb_lru_scan_depth</code>, start
          with a low value and configure the setting upward with the
          goal of rarely seeing zero free pages. Also, consider
          adjusting <code class="literal">innodb_lru_scan_depth</code> when
          changing the number of buffer pool instances, since
          <code class="literal">innodb_lru_scan_depth</code> *
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
          defines the amount of work performed by the page cleaner
          thread each second.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="15.8.3.6 Fine-tuning InnoDB Buffer Pool Flushing">Section 15.8.3.6, “Fine-tuning InnoDB Buffer Pool Flushing”</a>. For general
          I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_dirty_pages_pct"></a>
          <a class="indexterm" name="idm140091638715200"></a>

          <a class="indexterm" name="idm140091638714096"></a>

          <code class="literal">innodb_max_dirty_pages_pct</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_max_dirty_pages_pct"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-max-dirty-pages-pct=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct">innodb_max_dirty_pages_pct</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Numeric</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&gt;= 8.0.3)</td>
<td><code class="literal">90</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&lt;= 8.0.2)</td>
<td><code class="literal">75</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">99.99</code></td>
</tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> tries to
          <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> data from the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> so that
          the percentage of <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty
          pages</a> does not exceed this value.
        </p><p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
          setting establishes a target for flushing activity. It does
          not affect the rate of flushing. For information about
          managing the rate of flushing, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="15.8.3.5 Configuring InnoDB Buffer Pool Flushing">Section 15.8.3.5, “Configuring InnoDB Buffer Pool Flushing”</a>.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="15.8.3.6 Fine-tuning InnoDB Buffer Pool Flushing">Section 15.8.3.6, “Fine-tuning InnoDB Buffer Pool Flushing”</a>. For general
          I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_dirty_pages_pct_lwm"></a>
          <a class="indexterm" name="idm140091638664656"></a>

          <code class="literal">innodb_max_dirty_pages_pct_lwm</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_max_dirty_pages_pct_lwm"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-max-dirty-pages-pct-lwm=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct_lwm">innodb_max_dirty_pages_pct_lwm</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Numeric</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&gt;= 8.0.3)</td>
<td><code class="literal">10</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&lt;= 8.0.2)</td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">99.99</code></td>
</tr></tbody></table>
</div>
<p>
          Defines a low water mark representing the percentage of
          <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> at which
          preflushing is enabled to control the dirty page ratio. A
          value of 0 disables the pre-flushing behavior entirely. For
          more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="15.8.3.6 Fine-tuning InnoDB Buffer Pool Flushing">Section 15.8.3.6, “Fine-tuning InnoDB Buffer Pool Flushing”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_purge_lag"></a>
          <a class="indexterm" name="idm140091638622368"></a>

          <a class="indexterm" name="idm140091638621328"></a>

          <code class="literal">innodb_max_purge_lag</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_max_purge_lag"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-max-purge-lag=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag">innodb_max_purge_lag</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the maximum length of the purge queue. The default
          value of 0 indicates no limit (no delays).
        </p><p>
          Use this option to impose a delay for
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations when
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operations are lagging
          (see <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="15.3 InnoDB Multi-Versioning">Section 15.3, “InnoDB Multi-Versioning”</a>).
        </p><p>
          The <code class="literal">InnoDB</code> transaction system maintains a
          list of transactions that have index records delete-marked by
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations. The length
          of the list represents the
          <em class="replaceable"><code>purge_lag</code></em> value. When
          <em class="replaceable"><code>purge_lag</code></em> exceeds
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>,
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations are delayed.
          Prior to MySQL 8.0.14, the delay calculation is
          <code class="literal">(purge_lag/innodb_max_purge_lag - 0.5) *
          10000</code>, which results in a minimum delay of 5000
          microseconds. As of MySQL 8.0.14, the delay calculation is
          <code class="literal">(purge_lag/innodb_max_purge_lag - 0.9995) *
          10000</code>, which results in a minimum delay of 5
          microseconds.
        </p><p>
          To prevent excessive delays in extreme situations where
          <em class="replaceable"><code>purge_lag</code></em> becomes huge, you can
          limit the delay by setting the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag_delay"><code class="literal">innodb_max_purge_lag_delay</code></a>
          configuration option. The delay is computed at the beginning
          of a purge batch.
        </p><p>
          A typical setting for a problematic workload might be 1
          million, assuming that transactions are small, only 100 bytes
          in size, and it is permissible to have 100MB of unpurged
          <code class="literal">InnoDB</code> table rows.
        </p><p>
          The lag value is displayed as the history list length in the
          <code class="literal">TRANSACTIONS</code> section of
          <a class="link" href="innodb-storage-engine.html#innodb-standard-monitor" title="15.16.3 InnoDB Standard Monitor and Lock Monitor Output">InnoDB Monitor
          output</a>. The lag value is 20 in this example output:
        </p><pre data-lang="terminal" class="programlisting">
------------
TRANSACTIONS
------------
Trx id counter 0 290328385
Purge done for trx's n:o &lt; 0 290315608 undo n:o &lt; 0 17
History list length 20
</pre><p>
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_purge_lag_delay"></a>
          <a class="indexterm" name="idm140091638558544"></a>

          <a class="indexterm" name="idm140091638557440"></a>

          <code class="literal">innodb_max_purge_lag_delay</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_max_purge_lag_delay"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-max-purge-lag-delay=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag_delay">innodb_max_purge_lag_delay</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies the maximum delay in microseconds for the delay
          imposed by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>
          configuration option. The specified value is the upper limit
          on the delay period computed from the formula based on the
          value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>.
        </p><p>
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_undo_log_size"></a>
          <a class="indexterm" name="idm140091638519072"></a>

          <a class="indexterm" name="idm140091638517968"></a>

          <code class="literal">innodb_max_undo_log_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_max_undo_log_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-max-undo-log-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size">innodb_max_undo_log_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1073741824</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">10485760</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2**64-1</code></td>
</tr></tbody></table>
</div>
<p>
          Defines a threshold size for undo tablespaces. If an undo
          tablespace exceeds the threshold, it can be marked for
          truncation when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate"><code class="literal">innodb_undo_log_truncate</code></a> is
          enabled. The default value is 1073741824 bytes (1024 MiB).
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#truncate-undo-tablespace" title="Truncating Undo Tablespaces">Truncating Undo Tablespaces</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_merge_threshold_set_all_debug"></a>
          <a class="indexterm" name="idm140091638477664"></a>

          <a class="indexterm" name="idm140091638476624"></a>

          <code class="literal">innodb_merge_threshold_set_all_debug</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_merge_threshold_set_all_debug"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-merge-threshold-set-all-debug=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_merge_threshold_set_all_debug">innodb_merge_threshold_set_all_debug</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">50</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">50</code></td>
</tr></tbody></table>
</div>
<p>
          Defines a page-full percentage value for index pages that
          overrides the current <code class="literal">MERGE_THRESHOLD</code>
          setting for all indexes that are currently in the dictionary
          cache. This option is only available if debugging support is
          compiled in using the <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option. For related information, see
          <a class="xref" href="innodb-storage-engine.html#index-page-merge-threshold" title="15.8.11 Configuring the Merge Threshold for Index Pages">Section 15.8.11, “Configuring the Merge Threshold for Index Pages”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_disable"></a>
          <a class="indexterm" name="idm140091638435776"></a>

          <code class="literal">innodb_monitor_disable</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_monitor_disable"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-monitor-disable={counter|module|pattern|all}</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_disable">innodb_monitor_disable</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
          Disables <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_metrics_counter" title="metrics counter">metrics counters</a>.
          Counter data may be queried using the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-metrics-table" title="15.14.6 InnoDB INFORMATION_SCHEMA Metrics Table">Section 15.14.6, “InnoDB INFORMATION_SCHEMA Metrics Table”</a>.
        </p><p>
          <code class="literal">innodb_monitor_disable='latch'</code> disables
          statistics collection for
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB MUTEX</code></a>. For more information, see
          <a class="xref" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax">Section 13.7.6.15, “SHOW ENGINE Syntax”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_enable"></a>
          <a class="indexterm" name="idm140091638401088"></a>

          <code class="literal">innodb_monitor_enable</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_monitor_enable"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-monitor-enable={counter|module|pattern|all}</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable">innodb_monitor_enable</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
          Enables <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_metrics_counter" title="metrics counter">metrics counters</a>.
          Counter data may be queried using the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-metrics-table" title="15.14.6 InnoDB INFORMATION_SCHEMA Metrics Table">Section 15.14.6, “InnoDB INFORMATION_SCHEMA Metrics Table”</a>.
        </p><p>
          <code class="literal">innodb_monitor_enable='latch'</code> enables
          statistics collection for
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB MUTEX</code></a>. For more information, see
          <a class="xref" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax">Section 13.7.6.15, “SHOW ENGINE Syntax”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_reset"></a>
          <a class="indexterm" name="idm140091638366592"></a>

          <code class="literal">innodb_monitor_reset</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_monitor_reset"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-monitor-reset={counter|module|pattern|all}</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset">innodb_monitor_reset</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">empty string</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">counter</code></p><p class="valid-value"><code class="literal">module</code></p><p class="valid-value"><code class="literal">pattern</code></p><p class="valid-value"><code class="literal">all</code></p></td>
</tr></tbody></table>
</div>
<p>
          Resets the count value for <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_metrics_counter" title="metrics counter">metrics counters</a>
          to zero. Counter data may be queried using the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-metrics-table" title="15.14.6 InnoDB INFORMATION_SCHEMA Metrics Table">Section 15.14.6, “InnoDB INFORMATION_SCHEMA Metrics Table”</a>.
        </p><p>
          <code class="literal">innodb_monitor_reset='latch'</code> resets
          statistics reported by
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB MUTEX</code></a>. For more information, see
          <a class="xref" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax">Section 13.7.6.15, “SHOW ENGINE Syntax”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_monitor_reset_all"></a>
          <a class="indexterm" name="idm140091638322640"></a>

          <code class="literal">innodb_monitor_reset_all</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_monitor_reset_all"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-monitor-reset-all={counter|module|pattern|all}</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset_all">innodb_monitor_reset_all</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">empty string</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">counter</code></p><p class="valid-value"><code class="literal">module</code></p><p class="valid-value"><code class="literal">pattern</code></p><p class="valid-value"><code class="literal">all</code></p></td>
</tr></tbody></table>
</div>
<p>
          Resets all values (minimum, maximum, and so on) for
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_metrics_counter" title="metrics counter">metrics counters</a>.
          Counter data may be queried using the
          <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
          table. For usage information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-metrics-table" title="15.14.6 InnoDB INFORMATION_SCHEMA Metrics Table">Section 15.14.6, “InnoDB INFORMATION_SCHEMA Metrics Table”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_numa_interleave"></a>
          <a class="indexterm" name="idm140091638281696"></a>

          <a class="indexterm" name="idm140091638280656"></a>

          <code class="literal">innodb_numa_interleave</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_numa_interleave"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-numa-interleave[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_numa_interleave">innodb_numa_interleave</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enables the NUMA interleave memory policy for allocation of
          the <code class="literal">InnoDB</code> buffer pool. When
          <code class="literal">innodb_numa_interleave</code> is enabled, the NUMA
          memory policy is set to <code class="literal">MPOL_INTERLEAVE</code> for
          the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process. After the
          <code class="literal">InnoDB</code> buffer pool is allocated, the NUMA
          memory policy is set back to <code class="literal">MPOL_DEFAULT</code>.
          For the <code class="literal">innodb_numa_interleave</code> option to be
          available, MySQL must be compiled on a NUMA-enabled Linux
          system.
        </p><p>
          <span class="command"><strong>CMake</strong></span> sets the default
          <a class="link" href="installing.html#option_cmake_with_numa"><code class="option">WITH_NUMA</code></a> value based on whether
          the current platform has <code class="literal">NUMA</code> support. For
          more information, see
          <a class="xref" href="installing.html#source-configuration-options" title="2.9.4 MySQL Source-Configuration Options">Section 2.9.4, “MySQL Source-Configuration Options”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_old_blocks_pct"></a>
          <a class="indexterm" name="idm140091638239856"></a>

          <a class="indexterm" name="idm140091638238816"></a>

          <code class="literal">innodb_old_blocks_pct</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_old_blocks_pct"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-old-blocks-pct=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct">innodb_old_blocks_pct</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">37</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">5</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">95</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies the approximate percentage of the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> used for
          the old block <a class="link" href="glossary.html#glos_sublist" title="sublist">sublist</a>. The
          range of values is 5 to 95. The default value is 37 (that is,
          3/8 of the pool). Often used in combination with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="15.8.3.3 Making the Buffer Pool Scan Resistant">Section 15.8.3.3, “Making the Buffer Pool Scan Resistant”</a>. For
          information about buffer pool management, the
          <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a> algorithm, and
          <a class="link" href="glossary.html#glos_eviction" title="eviction">eviction</a> policies, see
          <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool" title="15.5.1 Buffer Pool">Section 15.5.1, “Buffer Pool”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_old_blocks_time"></a>
          <a class="indexterm" name="idm140091638193824"></a>

          <a class="indexterm" name="idm140091638192784"></a>

          <code class="literal">innodb_old_blocks_time</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_old_blocks_time"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-old-blocks-time=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time">innodb_old_blocks_time</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2**32-1</code></td>
</tr></tbody></table>
</div>
<p>
          Non-zero values protect against the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> being
          filled by data that is referenced only for a brief period,
          such as during a <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full
          table scan</a>. Increasing this value offers more
          protection against full table scans interfering with data
          cached in the buffer pool.
        </p><p>
          Specifies how long in milliseconds a block inserted into the
          old <a class="link" href="glossary.html#glos_sublist" title="sublist">sublist</a> must stay
          there after its first access before it can be moved to the new
          sublist. If the value is 0, a block inserted into the old
          sublist moves immediately to the new sublist the first time it
          is accessed, no matter how soon after insertion the access
          occurs. If the value is greater than 0, blocks remain in the
          old sublist until an access occurs at least that many
          milliseconds after the first access. For example, a value of
          1000 causes blocks to stay in the old sublist for 1 second
          after the first access before they become eligible to move to
          the new sublist.
        </p><p>
          The default value is 1000.
        </p><p>
          This configuration option is often used in combination with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>. For
          more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="15.8.3.3 Making the Buffer Pool Scan Resistant">Section 15.8.3.3, “Making the Buffer Pool Scan Resistant”</a>. For
          information about buffer pool management, the
          <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a> algorithm, and
          <a class="link" href="glossary.html#glos_eviction" title="eviction">eviction</a> policies, see
          <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool" title="15.5.1 Buffer Pool">Section 15.5.1, “Buffer Pool”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_online_alter_log_max_size"></a>
          <a class="indexterm" name="idm140091638146032"></a>

          <code class="literal">innodb_online_alter_log_max_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_online_alter_log_max_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-online-alter-log-max-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_online_alter_log_max_size">innodb_online_alter_log_max_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">134217728</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">65536</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2**64-1</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies an upper limit in bytes on the size of the temporary
          log files used during <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online
          DDL</a> operations for <code class="literal">InnoDB</code> tables.
          There is one such log file for each index being created or
          table being altered. This log file stores data inserted,
          updated, or deleted in the table during the DDL operation. The
          temporary log file is extended when needed by the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_sort_buffer_size"><code class="literal">innodb_sort_buffer_size</code></a>, up
          to the maximum specified by
          <code class="literal">innodb_online_alter_log_max_size</code>. If a
          temporary log file exceeds the upper size limit, the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation fails and
          all uncommitted concurrent DML operations are rolled back.
          Thus, a large value for this option allows more DML to happen
          during an online DDL operation, but also extends the period of
          time at the end of the DDL operation when the table is locked
          to apply the data from the log.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_open_files"></a>
          <a class="indexterm" name="idm140091638103264"></a>

          <a class="indexterm" name="idm140091638102224"></a>

          <code class="literal">innodb_open_files</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_open_files"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-open-files=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_open_files">innodb_open_files</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">-1</code> (signifies autosizing; do not assign this literal value)</td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">10</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p>
          This configuration option is only relevant if you use multiple
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>. It
          specifies the maximum number of
          <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="filename">.ibd</code>
          files</a> that MySQL can keep open at one time. The minimum
          value is 10. The default value is 300 if
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is not
          enabled, and the higher of 300 and
          <a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a> otherwise.
        </p><p>
          The file descriptors used for <code class="filename">.ibd</code> files
          are for <code class="literal">InnoDB</code> tables only. They are
          independent of those specified by the
          <a class="link" href="server-administration.html#sysvar_open_files_limit"><code class="literal">open_files_limit</code></a> system
          variable, and do not affect the operation of the table cache.
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_optimize_fulltext_only"></a>
          <a class="indexterm" name="idm140091638054864"></a>

          <code class="literal">innodb_optimize_fulltext_only</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_optimize_fulltext_only"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-optimize-fulltext-only[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_fulltext_only">innodb_optimize_fulltext_only</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Changes the way <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>
          operates on <code class="literal">InnoDB</code> tables. Intended to be
          enabled temporarily, during maintenance operations for
          <code class="literal">InnoDB</code> tables with
          <code class="literal">FULLTEXT</code> indexes.
        </p><p>
          By default, <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>
          reorganizes data in the
          <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a> of
          the table. When this option is enabled,
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> skips the
          reorganization of table data, and instead processes newly
          added, deleted, and updated token data for
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> indexes.
          For more information, see <a class="xref" href="functions.html#fulltext-optimize" title="Optimizing InnoDB Full-Text Indexes">Optimizing InnoDB Full-Text Indexes</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_page_cleaners"></a>
          <a class="indexterm" name="idm140091638014368"></a>

          <code class="literal">innodb_page_cleaners</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_page_cleaners"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-page-cleaners=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_cleaners">innodb_page_cleaners</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">4</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">64</code></td>
</tr></tbody></table>
</div>
<p>
          The number of page cleaner threads that flush dirty pages from
          buffer pool instances. Page cleaner threads perform flush list
          and LRU flushing. When there are multiple page cleaner
          threads, buffer pool flushing tasks for each buffer pool
          instance are dispatched to idle page cleaner threads. The
          <code class="literal">innodb_page_cleaners</code> default value is 4. If
          the number of page cleaner threads exceeds the number of
          buffer pool instances, <code class="literal">innodb_page_cleaners</code>
          is automatically set to the same value as
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
        </p><p>
          If your workload is write-IO bound when flushing dirty pages
          from buffer pool instances to data files, and if your system
          hardware has available capacity, increasing the number of page
          cleaner threads may help improve write-IO throughput.
        </p><p>
          Multithreaded page cleaner support extends to shutdown and
          recovery phases.
        </p><p>
          The <code class="literal">setpriority()</code> system call is used on
          Linux platforms where it is supported, and where the
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> execution user is authorized to give
          <code class="literal">page_cleaner</code> threads priority over other
          MySQL and <code class="literal">InnoDB</code> threads to help page
          flushing keep pace with the current workload.
          <code class="literal">setpriority()</code> support is indicated by this
          <code class="literal">InnoDB</code> startup message:
        </p><pre data-lang="terminal" class="programlisting">
[Note] InnoDB: If the mysqld execution user is authorized, page cleaner
thread priority can be changed. See the man page of setpriority().        
</pre><p>
          For systems where server startup and shutdown is not managed
          by systemd, <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> execution user
          authorization can be configured in
          <code class="filename">/etc/security/limits.conf</code>. For example,
          if <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is run under the
          <code class="literal">mysql</code> user, you can authorize the
          <code class="literal">mysql</code> user by adding these lines to
          <code class="filename">/etc/security/limits.conf</code>:
        </p><pre data-lang="ini" class="programlisting">
mysql              hard    nice       -20
mysql              soft    nice       -20
</pre><p>
          For systemd managed systems, the same can be achieved by
          specifying <code class="literal">LimitNICE=-20</code> in a localized
          systemd configuration file. For example, create a file named
          <code class="filename">override.conf</code> in
          <code class="filename">/etc/systemd/system/mysqld.service.d/override.conf</code>
          and add this entry:
        </p><pre data-lang="ini" class="programlisting">
[Service]
LimitNICE=-20
</pre><p>
          After creating or changing <code class="filename">override.conf</code>,
          reload the systemd configuration, then tell systemd to restart
          the MySQL service:
        </p><pre data-lang="ini" class="programlisting">
systemctl daemon-reload
systemctl restart mysqld  # RPM platforms
systemctl restart mysql   # Debian platforms
</pre><p>
          For more information about using a localized systemd
          configuration file, see
          <a class="xref" href="installing.html#systemd-mysql-configuration" title="Configuring systemd for MySQL">Configuring systemd for MySQL</a>.
        </p><p>
          After authorizing the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> execution
          user, use the <span class="command"><strong>cat</strong></span> command to verify the
          configured <code class="literal">Nice</code> limits for the
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; cat /proc/<em class="replaceable"><code>mysqld_pid</code></em>/limits | grep nice
Max nice priority         18446744073709551596 18446744073709551596 
</pre></li><li class="listitem"><p><a name="sysvar_innodb_page_size"></a>
          <a class="indexterm" name="idm140091637946288"></a>

          <code class="literal">innodb_page_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_page_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-page-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size">innodb_page_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">16384</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">4096</code></p><p class="valid-value"><code class="literal">8192</code></p><p class="valid-value"><code class="literal">16384</code></p><p class="valid-value"><code class="literal">32768</code></p><p class="valid-value"><code class="literal">65536</code></p></td>
</tr></tbody></table>
</div>
<p>
          Specifies the <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>
          for <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>. Values can
          be specified in bytes or kilobytes. For example, a 16 kilobyte
          page size value can be specified as 16384, 16KB, or 16k.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> can only be
          configured prior to initializing the MySQL instance and cannot
          be changed afterward. If no value is specified, the instance
          is initialized using the default page size. See
          <a class="xref" href="innodb-storage-engine.html#innodb-init-startup-configuration" title="15.8.1 InnoDB Startup Configuration">Section 15.8.1, “InnoDB Startup Configuration”</a>.
        </p><p>
          For both 32KB and 64KB page sizes, the maximum row length is
          approximately 16000 bytes.
          <code class="literal">ROW_FORMAT=COMPRESSED</code> is not supported when
          <code class="literal">innodb_page_size</code> is set to 32KB or 64KB.
          For <code class="literal">innodb_page_size=32KB</code>, extent size is
          2MB. For <code class="literal">innodb_page_size=64KB</code>, extent size
          is 4MB.
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size"><code class="literal">innodb_log_buffer_size</code></a> should
          be set to at least 16M (the default) when using 32KB or 64KB
          page sizes.
        </p><p>
          The default 16KB page size or larger is appropriate for a wide
          range of <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>,
          particularly for queries involving table scans and DML
          operations involving bulk updates. Smaller page sizes might be
          more efficient for <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a>
          workloads involving many small writes, where contention can be
          an issue when single pages contain many rows. Smaller pages
          might also be efficient with
          <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> storage devices, which
          typically use small block sizes. Keeping the
          <code class="literal">InnoDB</code> page size close to the storage
          device block size minimizes the amount of unchanged data that
          is rewritten to disk.
        </p><p>
          The minimum file size for the first system tablespace data
          file (<code class="literal">ibdata1</code>) differs depending on the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value. See
          the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
          option description for more information.
        </p><p>
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_parallel_read_threads"></a>
          <a class="indexterm" name="idm140091637889024"></a>

          <a class="indexterm" name="idm140091637887920"></a>

          <code class="literal">innodb_parallel_read_threads</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_parallel_read_threads"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-parallel-read-threads=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.14</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_parallel_read_threads">innodb_parallel_read_threads</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Session</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">4</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">256</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the number of threads that can be used for parallel
          clustered index reads. Parallel read threads can improve
          <a class="link" href="sql-syntax.html#check-table" title="13.7.3.2 CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> performance.
          <code class="literal">InnoDB</code> reads the clustered index twice
          during a <a class="link" href="sql-syntax.html#check-table" title="13.7.3.2 CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> operation.
          The second read can be performed in parallel. This feature
          does not apply to secondary index scans. The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_parallel_read_threads"><code class="literal">innodb_parallel_read_threads</code></a>
          session variable must be set to a value greater than 1 for
          parallel clustered index reads to occur. The actual number of
          threads used to perform a parallel clustered index read is
          determined by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_parallel_read_threads"><code class="literal">innodb_parallel_read_threads</code></a>
          setting or the number of index subtrees to scan, whichever is
          smaller. The pages read into the buffer pool during the scan
          are kept at the tail of the buffer pool LRU list so that they
          can be discarded quickly when free buffer pool pages are
          required.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_print_all_deadlocks"></a>
          <a class="indexterm" name="idm140091637841184"></a>

          <a class="indexterm" name="idm140091637840080"></a>

          <code class="literal">innodb_print_all_deadlocks</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_print_all_deadlocks"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-print-all-deadlocks[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks">innodb_print_all_deadlocks</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<a class="indexterm" name="idm140091637810256"></a><p>
          When this option is enabled, information about all
          <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> in
          <code class="literal">InnoDB</code> user transactions is recorded in the
          <code class="literal">mysqld</code> <a class="link" href="server-administration.html#error-log" title="5.4.2 The Error Log">error
          log</a>. Otherwise, you see information about only the last
          deadlock, using the <code class="literal">SHOW ENGINE INNODB
          STATUS</code> command. An occasional
          <code class="literal">InnoDB</code> deadlock is not necessarily an
          issue, because <code class="literal">InnoDB</code> detects the condition
          immediately and rolls back one of the transactions
          automatically. You might use this option to troubleshoot why
          deadlocks are occurring if an application does not have
          appropriate error-handling logic to detect the rollback and
          retry its operation. A large number of deadlocks might
          indicate the need to restructure transactions that issue
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> or <code class="literal">SELECT ... FOR
          UPDATE</code> statements for multiple tables, so that each
          transaction accesses the tables in the same order, thus
          avoiding the deadlock condition.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-deadlocks" title="15.7.5 Deadlocks in InnoDB">Section 15.7.5, “Deadlocks in InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_print_ddl_logs"></a>
          <a class="indexterm" name="idm140091637798928"></a>

          <a class="indexterm" name="idm140091637797888"></a>

          <code class="literal">innodb_print_ddl_logs</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_print_ddl_logs"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-print-ddl-logs[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.3</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_ddl_logs">innodb_print_ddl_logs</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enabling this option causes MySQL to write DDL logs to
          <code class="literal">stderr</code>. For more information, see
          <a class="xref" href="sql-syntax.html#atomic-ddl-view-logs" title="Viewing DDL Logs">Viewing DDL Logs</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_purge_batch_size"></a>
          <a class="indexterm" name="idm140091637762384"></a>

          <a class="indexterm" name="idm140091637761344"></a>

          <code class="literal">innodb_purge_batch_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_purge_batch_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-purge-batch-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_batch_size">innodb_purge_batch_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">300</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">5000</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the number of undo log pages that purge parses and
          processes in one batch from the
          <a class="link" href="glossary.html#glos_history_list" title="history list">history list</a>. In a
          multithreaded purge configuration, the coordinator purge
          thread divides <code class="literal">innodb_purge_batch_size</code> by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads"><code class="literal">innodb_purge_threads</code></a> and
          assigns that number of pages to each purge thread. The
          <code class="literal">innodb_purge_batch_size</code> option also defines
          the number of undo log pages that purge frees after every 128
          iterations through the undo logs.
        </p><p>
          The <code class="literal">innodb_purge_batch_size</code> option is
          intended for advanced performance tuning in combination with
          the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads"><code class="literal">innodb_purge_threads</code></a>
          setting. Most MySQL users need not change
          <code class="literal">innodb_purge_batch_size</code> from its default
          value.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-improved-purge-scheduling" title="15.8.9 Configuring InnoDB Purge Scheduling">Section 15.8.9, “Configuring InnoDB Purge Scheduling”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_purge_threads"></a>
          <a class="indexterm" name="idm140091637715328"></a>

          <a class="indexterm" name="idm140091637714288"></a>

          <code class="literal">innodb_purge_threads</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_purge_threads"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-purge-threads=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads">innodb_purge_threads</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">4</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">32</code></td>
</tr></tbody></table>
</div>
<p>
          The number of background threads devoted to the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation. A minimum
          value of 1 signifies that the purge operation is always
          performed by a background thread, never as part of the
          <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a>.
          Running the purge operation in one or more background threads
          helps reduce internal contention within
          <code class="literal">InnoDB</code>, improving scalability. Increasing
          the value to greater than 1 creates that many separate purge
          threads, which can improve efficiency on systems where
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations are performed
          on multiple tables. The maximum is 32.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-improved-purge-scheduling" title="15.8.9 Configuring InnoDB Purge Scheduling">Section 15.8.9, “Configuring InnoDB Purge Scheduling”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_purge_rseg_truncate_frequency"></a>
          <a class="indexterm" name="idm140091637671184"></a>

          <a class="indexterm" name="idm140091637670144"></a>

          <code class="literal">innodb_purge_rseg_truncate_frequency</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_purge_rseg_truncate_frequency"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-purge-rseg-truncate-frequency=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency">innodb_purge_rseg_truncate_frequency</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">128</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">128</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the frequency with which the purge system frees
          rollback segments in terms of the number of times that purge
          is invoked. An undo tablespace cannot be truncated until its
          rollback segments are freed. Normally, the purge system frees
          rollback segments once every 128 times that purge is invoked.
          The default value is 128. Reducing this value increases the
          frequency with which the purge thread frees rollback segments.
        </p><p>
          <code class="literal">innodb_purge_rseg_truncate_frequency</code> is
          intended for use with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate"><code class="literal">innodb_undo_log_truncate</code></a>. For
          more information, see
          <a class="xref" href="innodb-storage-engine.html#truncate-undo-tablespace" title="Truncating Undo Tablespaces">Truncating Undo Tablespaces</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_random_read_ahead"></a>
          <a class="indexterm" name="idm140091637628960"></a>

          <code class="literal">innodb_random_read_ahead</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_random_read_ahead"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-random-read-ahead[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead">innodb_random_read_ahead</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enables the random
          <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> technique
          for optimizing <code class="literal">InnoDB</code> I/O.
        </p><p>
          For details about performance considerations for different
          types of read-ahead requests, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="15.8.3.4 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)">Section 15.8.3.4, “Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)”</a>. For general
          I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_read_ahead_threshold"></a>
          <a class="indexterm" name="idm140091637594432"></a>

          <a class="indexterm" name="idm140091637593328"></a>

          <code class="literal">innodb_read_ahead_threshold</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_read_ahead_threshold"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-read-ahead-threshold=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold">innodb_read_ahead_threshold</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">56</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">64</code></td>
</tr></tbody></table>
</div>
<p>
          Controls the sensitivity of linear
          <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> that
          <code class="literal">InnoDB</code> uses to prefetch pages into the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. If
          <code class="literal">InnoDB</code> reads at least
          <code class="literal">innodb_read_ahead_threshold</code> pages
          sequentially from an <a class="link" href="glossary.html#glos_extent" title="extent">extent</a>
          (64 pages), it initiates an asynchronous read for the entire
          following extent. The permissible range of values is 0 to 64.
          A value of 0 disables read-ahead. For the default of 56,
          <code class="literal">InnoDB</code> must read at least 56 pages
          sequentially from an extent to initiate an asynchronous read
          for the following extent.
        </p><p>
          Knowing how many pages are read through the read-ahead
          mechanism, and how many of these pages are evicted from the
          buffer pool without ever being accessed, can be useful when
          fine-tuning the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>
          setting. <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW
          ENGINE INNODB STATUS</code></a> output displays counter
          information from the
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead"><code class="literal">Innodb_buffer_pool_read_ahead</code></a>
          and
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted"><code class="literal">Innodb_buffer_pool_read_ahead_evicted</code></a>
          global status variables, which report the number of pages
          brought into the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
          pool</a> by read-ahead requests, and the number of such
          pages <a class="link" href="glossary.html#glos_eviction" title="eviction">evicted</a> from the
          buffer pool without ever being accessed, respectively. The
          status variables report global values since the last server
          restart.
        </p><p>
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> also shows the rate at which the
          read-ahead pages are read and the rate at which such pages are
          evicted without being accessed. The per-second averages are
          based on the statistics collected since the last invocation of
          <code class="literal">SHOW ENGINE INNODB STATUS</code> and are displayed
          in the <code class="literal">BUFFER POOL AND MEMORY</code> section of
          the <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> output.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="15.8.3.4 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)">Section 15.8.3.4, “Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)”</a>. For general
          I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_read_io_threads"></a>
          <a class="indexterm" name="idm140091637535680"></a>

          <a class="indexterm" name="idm140091637534640"></a>

          <code class="literal">innodb_read_io_threads</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_read_io_threads"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-read-io-threads=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads">innodb_read_io_threads</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">4</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">64</code></td>
</tr></tbody></table>
</div>
<p>
          The number of I/O threads for read operations in
          <code class="literal">InnoDB</code>. Its counterpart for write threads
          is <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>.
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-multiple_io_threads" title="15.8.5 Configuring the Number of Background InnoDB I/O Threads">Section 15.8.5, “Configuring the Number of Background InnoDB I/O Threads”</a>. For
          general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            On Linux systems, running multiple MySQL servers (typically
            more than 12) with default settings for
            <code class="literal">innodb_read_io_threads</code>,
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>,
            and the Linux <code class="literal">aio-max-nr</code> setting can
            exceed system limits. Ideally, increase the
            <code class="literal">aio-max-nr</code> setting; as a workaround, you
            might reduce the settings for one or both of the MySQL
            configuration options.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_read_only"></a>
          <a class="indexterm" name="idm140091637489120"></a>

          <code class="literal">innodb_read_only</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_read_only"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-read-only[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only">innodb_read_only</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Starts <code class="literal">InnoDB</code> in read-only mode. For
          distributing database applications or data sets on read-only
          media. Can also be used in data warehouses to share the same
          data directory between multiple instances. For more
          information, see <a class="xref" href="innodb-storage-engine.html#innodb-read-only-instance" title="15.8.2 Configuring InnoDB for Read-Only Operation">Section 15.8.2, “Configuring InnoDB for Read-Only Operation”</a>.
        </p><p>
          Previously, enabling the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">innodb_read_only</code></a> system
          variable prevented creating and dropping tables only for the
          <code class="literal">InnoDB</code> storage engine. As of MySQL
          8.0, enabling
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">innodb_read_only</code></a> prevents
          these operations for all storage engines. Table creation and
          drop operations for any storage engine modify data dictionary
          tables in the <code class="literal">mysql</code> system database, but
          those tables use the <code class="literal">InnoDB</code> storage engine
          and cannot be modified when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">innodb_read_only</code></a> is enabled.
          The same principle applies to other table operations that
          require modifying data dictionary tables. Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">innodb_read_only</code></a>
              system variable is enabled, <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
              TABLE</code></a> may fail because it cannot update
              statistics tables in the data dictionary, which use
              <code class="literal">InnoDB</code>. For
              <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> operations
              that update the key distribution, failure may occur even
              if the operation updates the table itself (for example, if
              it is a <code class="literal">MyISAM</code> table). To obtain the
              updated distribution statistics, set
              <a class="link" href="server-administration.html#sysvar_information_schema_stats_expiry"><code class="literal">information_schema_stats_expiry=0</code></a>.
            </p></li><li class="listitem"><p>
              <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE
              <em class="replaceable"><code>tbl_name</code></em>
              ENGINE=<em class="replaceable"><code>engine_name</code></em></code></a>
              fails because it updates the storage engine designation,
              which is stored in the data dictionary.
</p></li></ul>
</div>
<p>
          In addition, other tables in the <code class="literal">mysql</code>
          system database use the <code class="literal">InnoDB</code> storage
          engine in MySQL 8.0. Making those tables read
          only results in restrictions on operations that modify them.
          Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Account-management statements such as
              <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> and
              <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> fail because the
              grant tables use <code class="literal">InnoDB</code>.
            </p></li><li class="listitem"><p>
              The <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> and
              <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a>
              plugin-management statements fail because the
              <code class="literal">plugin</code> table uses
              <code class="literal">InnoDB</code>.
            </p></li><li class="listitem"><p>
              The
              <a class="link" href="sql-syntax.html#create-function-udf" title="13.7.4.1 CREATE FUNCTION Syntax for User-Defined Functions"><code class="literal">CREATE
              FUNCTION</code></a> and
              <a class="link" href="sql-syntax.html#drop-function-udf" title="13.7.4.2 DROP FUNCTION Syntax"><code class="literal">DROP
              FUNCTION</code></a> UDF-management statements fail because
              the <code class="literal">func</code> table uses
              <code class="literal">InnoDB</code>.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_redo_log_encrypt"></a>
          <a class="indexterm" name="idm140091637422688"></a>

          <a class="indexterm" name="idm140091637421648"></a>

          <code class="literal">innodb_redo_log_encrypt</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_redo_log_encrypt"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-redo-log-encrypt[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.1</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_redo_log_encrypt">innodb_redo_log_encrypt</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Controls encryption of redo log data for tables encrypted
          using the <code class="literal">InnoDB</code>
          <a class="link" href="innodb-storage-engine.html#innodb-tablespace-encryption" title="15.6.3.9 InnoDB Data-at-Rest Encryption">tablespace
          encryption feature</a>. Encryption of redo log data is
          disabled by default. For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-redo-log" title="Redo Log Encryption">Redo Log Encryption</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_replication_delay"></a>
          <a class="indexterm" name="idm140091637385184"></a>

          <a class="indexterm" name="idm140091637384080"></a>

          <code class="literal">innodb_replication_delay</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_replication_delay"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-replication-delay=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_replication_delay">innodb_replication_delay</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p>
          The replication thread delay in milliseconds on a slave server
          if <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
          is reached.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_rollback_on_timeout"></a>
          <a class="indexterm" name="idm140091637345232"></a>

          <a class="indexterm" name="idm140091637344128"></a>

          <code class="literal">innodb_rollback_on_timeout</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_rollback_on_timeout"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-rollback-on-timeout[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout">innodb_rollback_on_timeout</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_rollback" title="rollback">rolls
          back</a> only the last statement on a transaction timeout
          by default. If
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb-rollback-on-timeout</code></a> is
          specified, a transaction timeout causes
          <code class="literal">InnoDB</code> to abort and roll back the entire
          transaction.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            If the start-transaction statement was
            <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
            TRANSACTION</code></a> or
            <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">BEGIN</code></a>
            statement, rollback does not cancel that statement. Further
            SQL statements become part of the transaction until the
            occurrence of <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>,
            <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>,
            or some SQL statement that causes an implicit commit.
</p>
</div>
<p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-error-handling" title="15.20.4 InnoDB Error Handling">Section 15.20.4, “InnoDB Error Handling”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_rollback_segments"></a>
          <a class="indexterm" name="idm140091637302272"></a>

          <code class="literal">innodb_rollback_segments</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_rollback_segments"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-rollback-segments=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments">innodb_rollback_segments</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">128</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">128</code></td>
</tr></tbody></table>
</div>
<p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a>
          defines the number of
          <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segments</a>
          allocated to each undo tablespace and the global temporary
          tablespace for transactions that generate undo records. The
          number of transactions that each rollback segment supports
          depends on the <code class="literal">InnoDB</code> page size and the
          number of undo logs assigned to each transaction. For more
          information, see <a class="xref" href="innodb-storage-engine.html#innodb-undo-logs" title="15.6.6 Undo Logs">Section 15.6.6, “Undo Logs”</a>.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="15.3 InnoDB Multi-Versioning">Section 15.3, “InnoDB Multi-Versioning”</a>. For information
          about undo tablespaces, see
          <a class="xref" href="innodb-storage-engine.html#innodb-undo-tablespaces" title="15.6.3.4 Undo Tablespaces">Section 15.6.3.4, “Undo Tablespaces”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_scan_directories"></a>
          <a class="indexterm" name="idm140091637259552"></a>

          <a class="indexterm" name="idm140091637258512"></a>

          <code class="literal">innodb_scan_directories</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_scan_directories"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-scan-directories=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.2</td>
</tr><tr><td scope="row"><span class="bold"><strong>Removed</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_scan_directories">innodb_scan_directories</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Directory name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
          This variable was replaced by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> in MySQL
          8.0.4.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_saved_page_number_debug"></a>
          <a class="indexterm" name="idm140091637220448"></a>

          <a class="indexterm" name="idm140091637219408"></a>

          <code class="literal">innodb_saved_page_number_debug</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_saved_page_number_debug"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-saved-page-number-debug=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_saved_page_number_debug">innodb_saved_page_number_debug</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2**23-1</code></td>
</tr></tbody></table>
</div>
<p>
          Saves a page number. Setting the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fil_make_page_dirty_debug"><code class="literal">innodb_fil_make_page_dirty_debug</code></a>
          option dirties the page defined by
          <code class="literal">innodb_saved_page_number_debug</code>. The
          <code class="literal">innodb_saved_page_number_debug</code> option is
          only available if debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sort_buffer_size"></a>
          <a class="indexterm" name="idm140091637180352"></a>

          <code class="literal">innodb_sort_buffer_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_sort_buffer_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-sort-buffer-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sort_buffer_size">innodb_sort_buffer_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1048576</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">65536</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">67108864</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies the size of sort buffers used to sort data during
          creation of an <code class="literal">InnoDB</code> index. The specified
          size defines the amount of data that is read into memory for
          internal sorting and then written out to disk. This process is
          referred to as a <span class="quote">“<span class="quote">run</span>”</span>. During the merge phase,
          pairs of buffers of the specified size are read and merged.
          The larger the setting, the fewer runs and merges there are.
        </p><p>
          This sort area is only used for merge sorts during index
          creation, not during later index maintenance operations.
          Buffers are deallocated when index creation completes.
        </p><p>
          The value of this option also controls the amount by which the
          temporary log file is extended to record concurrent DML during
          <a class="link" href="glossary.html#glos_online_ddl" title="online DDL">online DDL</a> operations.
        </p><p>
          Before this setting was made configurable, the size was
          hardcoded to 1048576 bytes (1MB), which remains the default.
        </p><p>
          During an <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> or
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement that
          creates an index, 3 buffers are allocated, each with a size
          defined by this option. Additionally, auxiliary pointers are
          allocated to rows in the sort buffer so that the sort can run
          on pointers (as opposed to moving rows during the sort
          operation).
        </p><p>
          For a typical sort operation, a formula such as this one can
          be used to estimate memory consumption:
        </p><pre data-lang="none" class="programlisting">
(6 /*FTS_NUM_AUX_INDEX*/ * (3*@@GLOBAL.innodb_sort_buffer_size)
+ 2 * number_of_partitions * number_of_secondary_indexes_created
* (@@GLOBAL.innodb_sort_buffer_size/dict_index_get_min_size(index)*/)
* 8 /*64-bit sizeof *buf-&gt;tuples*/")
</pre><p>
          <code class="literal">@@GLOBAL.innodb_sort_buffer_size/dict_index_get_min_size(index)</code>
          indicates the maximum tuples held. <code class="literal">2 *
          (@@GLOBAL.innodb_sort_buffer_size/*dict_index_get_min_size(index)*/)
          * 8 /*64-bit size of *buf-&gt;tuples*/</code> indicates
          auxiliary pointers allocated.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            For 32-bit, multiply by 4 instead of 8.
</p>
</div>
<p>
          For parallel sorts on a full-text index, multiply by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_sort_pll_degree"><code class="literal">innodb_ft_sort_pll_degree</code></a>
          setting:
        </p><pre data-lang="none" class="programlisting">
(6 /*FTS_NUM_AUX_INDEX*/ * @@GLOBAL.innodb_ft_sort_pll_degree)
</pre></li><li class="listitem"><p><a name="sysvar_innodb_spin_wait_delay"></a>
          <a class="indexterm" name="idm140091637128240"></a>

          <a class="indexterm" name="idm140091637127200"></a>

          <code class="literal">innodb_spin_wait_delay</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_spin_wait_delay"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-spin-wait-delay=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay">innodb_spin_wait_delay</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">6</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (64-bit platforms, &lt;= 8.0.13)</td>
<td><code class="literal">2**64-1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (32-bit platforms, &lt;= 8.0.13)</td>
<td><code class="literal">2**32-1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (&gt;= 8.0.14)</td>
<td><code class="literal">1000</code></td>
</tr></tbody></table>
</div>
<p>
          The maximum delay between polls for a
          <a class="link" href="glossary.html#glos_spin" title="spin">spin</a> lock. The low-level
          implementation of this mechanism varies depending on the
          combination of hardware and operating system, so the delay
          does not correspond to a fixed time interval.
        </p><p>
          Can be used in combination with the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_pause_multiplier"><code class="literal">innodb_spin_wait_pause_multiplier</code></a>
          variable for greater control over the duration of spin-lock
          polling delays.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-spin_lock_polling" title="15.8.8 Configuring Spin Lock Polling">Section 15.8.8, “Configuring Spin Lock Polling”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_spin_wait_pause_multiplier"></a>
          <a class="indexterm" name="idm140091637078592"></a>

          <a class="indexterm" name="idm140091637077552"></a>

          <code class="literal">innodb_spin_wait_pause_multiplier</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_spin_wait_pause_multiplier"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-spin-wait-pause-multiplier=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.16</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_pause_multiplier">innodb_spin_wait_pause_multiplier</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">50</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">100</code></td>
</tr></tbody></table>
</div>
<p>
          Defines a multiplier value used to determine the number of
          PAUSE instructions in spin-wait loops that occur when a thread
          waits to acquire a mutex or rw-lock.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-spin_lock_polling" title="15.8.8 Configuring Spin Lock Polling">Section 15.8.8, “Configuring Spin Lock Polling”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_auto_recalc"></a>
          <a class="indexterm" name="idm140091637036032"></a>

          <code class="literal">innodb_stats_auto_recalc</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_stats_auto_recalc"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-stats-auto-recalc[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_auto_recalc">innodb_stats_auto_recalc</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          Causes <code class="literal">InnoDB</code> to automatically recalculate
          <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_persistent_statistics" target="_top">persistent
          statistics</a> after the data in a table is changed
          substantially. The threshold value is 10% of the rows in the
          table. This setting applies to tables created when the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
          option is enabled. Automatic statistics recalculation may also
          be configured by specifying
          <code class="literal">STATS_PERSISTENT=1</code> in a
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. The
          amount of data sampled to produce the statistics is controlled
          by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          configuration option.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="15.8.10.1 Configuring Persistent Optimizer Statistics Parameters">Section 15.8.10.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_include_delete_marked"></a>
          <a class="indexterm" name="idm140091636996192"></a>

          <a class="indexterm" name="idm140091636995152"></a>

          <code class="literal">innodb_stats_include_delete_marked</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_stats_include_delete_marked"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-stats-include-delete-marked[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.1</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_include_delete_marked">innodb_stats_include_delete_marked</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          By default, <code class="literal">InnoDB</code> reads uncommitted data
          when calculating statistics. In the case of an uncommitted
          transaction that deletes rows from a table,
          <code class="literal">InnoDB</code> excludes records that are
          delete-marked when calculating row estimates and index
          statistics, which can lead to non-optimal execution plans for
          other transactions that are operating on the table
          concurrently using a transaction isolation level other than
          <a class="link" href="innodb-storage-engine.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>. To avoid
          this scenario,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_include_delete_marked"><code class="literal">innodb_stats_include_delete_marked</code></a>
          can be enabled to ensure that <code class="literal">InnoDB</code>
          includes delete-marked records when calculating persistent
          optimizer statistics.
        </p><p>
          When
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_include_delete_marked"><code class="literal">innodb_stats_include_delete_marked</code></a>
          is enabled, <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
          considers delete-marked records when recalculating statistics.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_include_delete_marked"><code class="literal">innodb_stats_include_delete_marked</code></a>
          is a global setting that affects all <code class="literal">InnoDB</code>
          tables. It is only applicable to persistent optimizer
          statistics.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="15.8.10.1 Configuring Persistent Optimizer Statistics Parameters">Section 15.8.10.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_method"></a>
          <a class="indexterm" name="idm140091636948992"></a>

          <a class="indexterm" name="idm140091636947952"></a>

          <code class="literal">innodb_stats_method</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_stats_method"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-stats-method=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_method">innodb_stats_method</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">nulls_equal</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">nulls_equal</code></p><p class="valid-value"><code class="literal">nulls_unequal</code></p><p class="valid-value"><code class="literal">nulls_ignored</code></p></td>
</tr></tbody></table>
</div>
<p>
          How the server treats <code class="literal">NULL</code> values when
          collecting <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a>
          about the distribution of index values for
          <code class="literal">InnoDB</code> tables. Permitted values are
          <code class="literal">nulls_equal</code>,
          <code class="literal">nulls_unequal</code>, and
          <code class="literal">nulls_ignored</code>. For
          <code class="literal">nulls_equal</code>, all <code class="literal">NULL</code>
          index values are considered equal and form a single value
          group with a size equal to the number of
          <code class="literal">NULL</code> values. For
          <code class="literal">nulls_unequal</code>, <code class="literal">NULL</code>
          values are considered unequal, and each
          <code class="literal">NULL</code> forms a distinct value group of size
          1. For <code class="literal">nulls_ignored</code>,
          <code class="literal">NULL</code> values are ignored.
        </p><p>
          The method used to generate table statistics influences how
          the optimizer chooses indexes for query execution, as
          described in <a class="xref" href="optimization.html#index-statistics" title="8.3.8 InnoDB and MyISAM Index Statistics Collection">Section 8.3.8, “InnoDB and MyISAM Index Statistics Collection”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_on_metadata"></a>
          <a class="indexterm" name="idm140091636899520"></a>

          <a class="indexterm" name="idm140091636898416"></a>

          <code class="literal">innodb_stats_on_metadata</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_stats_on_metadata"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-stats-on-metadata[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata">innodb_stats_on_metadata</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          This option only applies when optimizer
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> are
          configured to be non-persistent. Optimizer statistics are not
          persisted to disk when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a> is
          disabled or when individual tables are created or altered with
          <code class="literal">STATS_PERSISTENT=0</code>. For more information,
          see <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="15.8.10.2 Configuring Non-Persistent Optimizer Statistics Parameters">Section 15.8.10.2, “Configuring Non-Persistent Optimizer Statistics Parameters”</a>.
        </p><p>
          When <code class="literal">innodb_stats_on_metadata</code> is enabled,
          <code class="literal">InnoDB</code> updates non-persistent
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> when
          metadata statements such as <a class="link" href="sql-syntax.html#show-table-status" title="13.7.6.36 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE
          STATUS</code></a> or when accessing the
          <a class="link" href="information-schema.html#tables-table" title="25.30 The INFORMATION_SCHEMA TABLES Table"><code class="literal">INFORMATION_SCHEMA.TABLES</code></a> or
          <a class="link" href="information-schema.html#statistics-table" title="25.26 The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">INFORMATION_SCHEMA.STATISTICS</code></a>
          tables. (These updates are similar to what happens for
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>.) When disabled,
          <code class="literal">InnoDB</code> does not update statistics during
          these operations. Leaving the setting disabled can improve
          access speed for schemas that have a large number of tables or
          indexes. It can also improve the stability of
          <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">execution
          plans</a> for queries that involve
          <code class="literal">InnoDB</code> tables.
        </p><p>
          To change the setting, issue the statement <code class="literal">SET GLOBAL
          innodb_stats_on_metadata=<em class="replaceable"><code>mode</code></em></code>,
          where <code class="literal"><em class="replaceable"><code>mode</code></em></code> is
          either <code class="literal">ON</code> or <code class="literal">OFF</code> (or
          <code class="literal">1</code> or <code class="literal">0</code>). Changing the
          setting requires privileges sufficient to set global system
          variables (see <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>)
          and immediately affects the operation of all connections.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_persistent"></a>
          <a class="indexterm" name="idm140091636846800"></a>

          <a class="indexterm" name="idm140091636845760"></a>

          <code class="literal">innodb_stats_persistent</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_stats_persistent"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-stats-persistent[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent">innodb_stats_persistent</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies whether <code class="literal">InnoDB</code> index statistics
          are persisted to disk. Otherwise, statistics may be
          recalculated frequently which can lead to variations in
          <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">query execution
          plans</a>. This setting is stored with each table when the
          table is created. You can set
          <code class="literal">innodb_stats_persistent</code> at the global level
          before creating a table, or use the
          <code class="literal">STATS_PERSISTENT</code> clause of the
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements to
          override the system-wide setting and configure persistent
          statistics for individual tables.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="15.8.10.1 Configuring Persistent Optimizer Statistics Parameters">Section 15.8.10.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_persistent_sample_pages"></a>
          <a class="indexterm" name="idm140091636807296"></a>

          <code class="literal">innodb_stats_persistent_sample_pages</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_stats_persistent_sample_pages"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-stats-persistent-sample-pages=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages">innodb_stats_persistent_sample_pages</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">20</code></td>
</tr></tbody></table>
</div>
<p>
          The number of index <a class="link" href="glossary.html#glos_page" title="page">pages</a> to
          sample when estimating
          <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> and other
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> for an
          indexed column, such as those calculated by
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>. Increasing the
          value improves the accuracy of index statistics, which can
          improve the <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">query
          execution plan</a>, at the expense of increased I/O during
          the execution of <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>
          for an <code class="literal">InnoDB</code> table. For more information,
          see <a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="15.8.10.1 Configuring Persistent Optimizer Statistics Parameters">Section 15.8.10.1, “Configuring Persistent Optimizer Statistics Parameters”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Setting a high value for
            <code class="literal">innodb_stats_persistent_sample_pages</code>
            could result in lengthy <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
            TABLE</code></a> execution time. To estimate the number of
            database pages accessed by <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
            TABLE</code></a>, see
            <a class="xref" href="innodb-storage-engine.html#innodb-analyze-table-complexity" title="15.8.10.3 Estimating ANALYZE TABLE Complexity for InnoDB Tables">Section 15.8.10.3, “Estimating ANALYZE TABLE Complexity for InnoDB Tables”</a>.
</p>
</div>
<p>
          <code class="literal">innodb_stats_persistent_sample_pages</code> only
          applies when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a> is
          enabled for a table; when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a> is
          disabled,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages"><code class="literal">innodb_stats_transient_sample_pages</code></a>
          applies instead.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_transient_sample_pages"></a>
          <a class="indexterm" name="idm140091636758848"></a>

          <code class="literal">innodb_stats_transient_sample_pages</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_stats_transient_sample_pages"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-stats-transient-sample-pages=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_transient_sample_pages">innodb_stats_transient_sample_pages</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">8</code></td>
</tr></tbody></table>
</div>
<p>
          The number of index <a class="link" href="glossary.html#glos_page" title="page">pages</a> to
          sample when estimating
          <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> and other
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> for an
          indexed column, such as those calculated by
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>. The default
          value is 8. Increasing the value improves the accuracy of
          index statistics, which can improve the
          <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">query execution
          plan</a>, at the expense of increased I/O when opening an
          <code class="literal">InnoDB</code> table or recalculating statistics.
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="15.8.10.2 Configuring Non-Persistent Optimizer Statistics Parameters">Section 15.8.10.2, “Configuring Non-Persistent Optimizer Statistics Parameters”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Setting a high value for
            <code class="literal">innodb_stats_transient_sample_pages</code> could
            result in lengthy <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
            TABLE</code></a> execution time. To estimate the number of
            database pages accessed by <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
            TABLE</code></a>, see
            <a class="xref" href="innodb-storage-engine.html#innodb-analyze-table-complexity" title="15.8.10.3 Estimating ANALYZE TABLE Complexity for InnoDB Tables">Section 15.8.10.3, “Estimating ANALYZE TABLE Complexity for InnoDB Tables”</a>.
</p>
</div>
<p>
          <code class="literal">innodb_stats_transient_sample_pages</code> only
          applies when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a> is
          disabled for a table; when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a> is
          enabled,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent_sample_pages"><code class="literal">innodb_stats_persistent_sample_pages</code></a>
          applies instead. Takes the place of
          <code class="literal">innodb_stats_sample_pages</code>. For more
          information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="15.8.10.2 Configuring Non-Persistent Optimizer Statistics Parameters">Section 15.8.10.2, “Configuring Non-Persistent Optimizer Statistics Parameters”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_status_output"></a>
          <a class="indexterm" name="idm140091636710096"></a>

          <a class="indexterm" name="idm140091636709056"></a>

          <code class="literal">innodb_status_output</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_status_output"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-status-output[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output">innodb_status_output</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enables or disables periodic output for the standard
          <code class="literal">InnoDB</code> Monitor. Also used in combination
          with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a> to
          enable or disable periodic output for the
          <code class="literal">InnoDB</code> Lock Monitor. For more information,
          see <a class="xref" href="innodb-storage-engine.html#innodb-enabling-monitors" title="15.16.2 Enabling InnoDB Monitors">Section 15.16.2, “Enabling InnoDB Monitors”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_status_output_locks"></a>
          <a class="indexterm" name="idm140091636674096"></a>

          <a class="indexterm" name="idm140091636672992"></a>

          <code class="literal">innodb_status_output_locks</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_status_output_locks"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-status-output-locks[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks">innodb_status_output_locks</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enables or disables the <code class="literal">InnoDB</code> Lock
          Monitor. When enabled, the <code class="literal">InnoDB</code> Lock
          Monitor prints additional information about locks in
          <code class="literal">SHOW ENGINE INNODB STATUS</code> output and in
          periodic output printed to the MySQL error log. Periodic
          output for the <code class="literal">InnoDB</code> Lock Monitor is
          printed as part of the standard <code class="literal">InnoDB</code>
          Monitor output. The standard <code class="literal">InnoDB</code> Monitor
          must therefore be enabled for the <code class="literal">InnoDB</code>
          Lock Monitor to print data to the MySQL error log
          periodically. For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-enabling-monitors" title="15.16.2 Enabling InnoDB Monitors">Section 15.16.2, “Enabling InnoDB Monitors”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_strict_mode"></a>
          <a class="indexterm" name="idm140091636635440"></a>

          <a class="indexterm" name="idm140091636634400"></a>

          <code class="literal">innodb_strict_mode</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_strict_mode"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-strict-mode[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode">innodb_strict_mode</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global, Session</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          When <code class="literal">innodb_strict_mode</code> is enabled,
          <code class="literal">InnoDB</code> returns errors rather than warnings
          for certain conditions.
        </p><p>
          <a class="link" href="glossary.html#glos_strict_mode" title="strict mode">Strict mode</a> helps
          guard against ignored typos and syntax errors in SQL, or other
          unintended consequences of various combinations of operational
          modes and SQL statements. When
          <code class="literal">innodb_strict_mode</code> is enabled,
          <code class="literal">InnoDB</code> raises error conditions in certain
          cases, rather than issuing a warning and processing the
          specified statement (perhaps with unintended behavior). This
          is analogous to
          <a class="link" href="server-administration.html#sql-mode" title="5.1.11 Server SQL Modes"><code class="literal">sql_mode</code></a> in
          MySQL, which controls what SQL syntax MySQL accepts, and
          determines whether it silently ignores errors, or validates
          input syntax and data values.
        </p><p>
          The <code class="literal">innodb_strict_mode</code> setting affects the
          handling of syntax errors for <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE
          TABLE</code></a>, <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
          <a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>, and
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> statements.
          <code class="literal">innodb_strict_mode</code> also enables a record
          size check, so that an <code class="literal">INSERT</code> or
          <code class="literal">UPDATE</code> never fails due to the record being
          too large for the selected page size.
        </p><p>
          Oracle recommends enabling
          <code class="literal">innodb_strict_mode</code> when using
          <code class="literal">ROW_FORMAT</code> and
          <code class="literal">KEY_BLOCK_SIZE</code> clauses in
          <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, and
          <a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statements. When
          <code class="literal">innodb_strict_mode</code> is disabled,
          <code class="literal">InnoDB</code> ignores conflicting clauses and
          creates the table or index with only a warning in the message
          log. The resulting table might have different characteristics
          than intended, such as lack of compression support when
          attempting to create a compressed table. When
          <code class="literal">innodb_strict_mode</code> is enabled, such
          problems generate an immediate error and the table or index is
          not created.
        </p><p>
          You can enable or disable
          <code class="literal">innodb_strict_mode</code> on the command line when
          starting <code class="literal">mysqld</code>, or in a MySQL
          <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration
          file</a>. You can also enable or disable
          <code class="literal">innodb_strict_mode</code> at runtime with the
          statement <code class="literal">SET [GLOBAL|SESSION]
          innodb_strict_mode=<em class="replaceable"><code>mode</code></em></code>,
          where <code class="literal"><em class="replaceable"><code>mode</code></em></code> is
          either <code class="literal">ON</code> or <code class="literal">OFF</code>.
          Changing the <code class="literal">GLOBAL</code> setting requires
          privileges sufficient to set global system variables (see
          <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>) and affects the
          operation of all clients that subsequently connect. Any client
          can change the <code class="literal">SESSION</code> setting for
          <code class="literal">innodb_strict_mode</code>, and the setting affects
          only that client.
        </p><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is not
          applicable to <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
          tablespaces</a>. Tablespace management rules for general
          tablespaces are strictly enforced independently of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>. For more
          information, see <a class="xref" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax">Section 13.1.21, “CREATE TABLESPACE Syntax”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sync_array_size"></a>
          <a class="indexterm" name="idm140091636565344"></a>

          <code class="literal">innodb_sync_array_size</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_sync_array_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-sync-array-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_array_size">innodb_sync_array_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">1024</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the size of the mutex/lock wait array. Increasing the
          value splits the internal data structure used to coordinate
          threads, for higher concurrency in workloads with large
          numbers of waiting threads. This setting must be configured
          when the MySQL instance is starting up, and cannot be changed
          afterward. Increasing the value is recommended for workloads
          that frequently produce a large number of waiting threads,
          typically greater than 768.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sync_spin_loops"></a>
          <a class="indexterm" name="idm140091636527776"></a>

          <a class="indexterm" name="idm140091636526736"></a>

          <code class="literal">innodb_sync_spin_loops</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_sync_spin_loops"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-sync-spin-loops=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_spin_loops">innodb_sync_spin_loops</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">30</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p>
          The number of times a thread waits for an
          <code class="literal">InnoDB</code> mutex to be freed before the thread
          is suspended.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sync_debug"></a>
          <a class="indexterm" name="idm140091636488496"></a>

          <a class="indexterm" name="idm140091636487424"></a>

          <code class="literal">innodb_sync_debug</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_sync_debug"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-sync-debug[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_debug">innodb_sync_debug</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Enables sync debug checking for the <code class="literal">InnoDB</code>
          storage engine. This option is only available if debugging
          support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_table_locks"></a>
          <a class="indexterm" name="idm140091636453616"></a>

          <a class="indexterm" name="idm140091636452576"></a>

          <code class="literal">innodb_table_locks</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_table_locks"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-table-locks[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks">innodb_table_locks</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global, Session</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          If <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>,
          <code class="literal">InnoDB</code> honors <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
          TABLES</code></a>; MySQL does not return from <code class="literal">LOCK
          TABLES ... WRITE</code> until all other threads have
          released all their locks to the table. The default value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks</code></a> is 1,
          which means that <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
          causes InnoDB to lock a table internally if
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>.
        </p><p>
          In MySQL 8.0,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks = 0</code></a> has no
          effect for tables locked explicitly with
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a>. It does have an effect for tables locked for
          read or write by
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a> implicitly (for example, through triggers) or
          by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES
          ... READ</code></a>.
        </p><p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-locking-transaction-model" title="15.7 InnoDB Locking and Transaction Model">Section 15.7, “InnoDB Locking and Transaction Model”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_temp_data_file_path"></a>
          <a class="indexterm" name="idm140091636406656"></a>

          <a class="indexterm" name="idm140091636405552"></a>

          <code class="literal">innodb_temp_data_file_path</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_temp_data_file_path"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-temp-data-file-path=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path">innodb_temp_data_file_path</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ibtmp1:12M:autoextend</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the relative path, name, size, and attributes of
          global temporary tablespace data files. The global temporary
          tablespace stores rollback segments for changes made to
          user-created temporary tables.
        </p><p>
          If no value is specified for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>,
          the default behavior is to create a single auto-extending data
          file named <code class="filename">ibtmp1</code> in the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>
          directory. The initial file size is slightly larger than 12MB.
        </p><p>
          The syntax for a global temporary tablespace data file
          specification includes the file name, file size, and
          <code class="literal">autoextend</code> and <code class="literal">max</code>
          attributes:
        </p><pre data-lang="none" class="programlisting">
<em class="replaceable"><code>file_name</code></em>:<em class="replaceable"><code>file_size</code></em>[:autoextend[:max:<em class="replaceable"><code>max_file_size</code></em>]]
</pre><p>
          The global temporary tablespace data file cannot have the same
          name as another <code class="literal">InnoDB</code> data file. Any
          inability or error creating the global temporary tablespace
          data file is treated as fatal and server startup is refused.
        </p><p>
          File sizes are specified in KB, MB, or GB by appending
          <code class="literal">K</code>, <code class="literal">M</code> or
          <code class="literal">G</code> to the size value. The sum of file sizes
          must be slightly larger than 12MB.
        </p><p>
          The size limit of individual files is determined by the
          operating system. File size can be more than 4GB on operating
          systems that support large files. Use of raw disk partitions
          for global temporary tablespace data files is not supported.
        </p><p>
          The <code class="literal">autoextend</code> and <code class="literal">max</code>
          attributes can be used only for the data file specified last
          in the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>
          setting. For example:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_temp_data_file_path=ibtmp1:50M;ibtmp2:12M:autoextend:max:500MB
</pre><p>
          The <code class="literal">autoextend</code> option causes the data file
          to automatically increase in size when it runs out of free
          space. The <code class="literal">autoextend</code> increment is 64MB by
          default. To modify the increment, change the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
          variable setting.
        </p><p>
          The directory path for global temporary tablespace data files
          is formed by concatenating the paths defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a>.
        </p><p>
          Before running <code class="literal">InnoDB</code> in read-only mode,
          set
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_data_file_path"><code class="literal">innodb_temp_data_file_path</code></a> to
          a location outside of the data directory. The path must be
          relative to the data directory. For example:
        </p><pre data-lang="terminal" class="programlisting">
--innodb-temp-data-file-path=../../../tmp/ibtmp1:12M:autoextend         
</pre><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-global-temporary-tablespace" title="Global Temporary Tablespace">Global Temporary Tablespace</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_temp_tablespaces_dir"></a>
          <a class="indexterm" name="idm140091636345744"></a>

          <a class="indexterm" name="idm140091636344640"></a>

          <code class="literal">innodb_temp_tablespaces_dir</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_temp_tablespaces_dir"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-temp-tablespaces-dir=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.13</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_temp_tablespaces_dir">innodb_temp_tablespaces_dir</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Directory name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">#innodb_temp</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the location where <code class="literal">InnoDB</code> creates a
          pool of session temporary tablespaces at startup. The default
          location is the <code class="filename">#innodb_temp</code> directory in
          the data directory. A fully qualified path or path relative to
          the data directory is permitted.
        </p><p>
          As of MySQL 8.0.16, session temporary tablespaces always store
          user-created temporary tables and internal temporary tables
          created by the optimizer using <code class="literal">InnoDB</code>.
          (Previously, the on-disk storage engine for internal temporary
          tables was determined by the
          <a class="link" href="server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine</code></a>
          system variable, which is no longer supported. See
          <a class="xref" href="optimization.html#internal-temporary-tables-engines-disk" title="Storage Engine for On-Disk Internal Temporary Tables">Storage Engine for On-Disk Internal Temporary Tables</a>.)
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-session-temporary-tablespaces" title="Session Temporary Tablespaces">Session Temporary Tablespaces</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_thread_concurrency"></a>
          <a class="indexterm" name="idm140091636304128"></a>

          <a class="indexterm" name="idm140091636303024"></a>

          <a class="indexterm" name="idm140091636301568"></a>

          <code class="literal">innodb_thread_concurrency</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_thread_concurrency"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-thread-concurrency=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency">innodb_thread_concurrency</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">1000</code></td>
</tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> tries to keep the number of
          operating system threads concurrently inside
          <code class="literal">InnoDB</code> less than or equal to the limit
          given by this variable (<code class="literal">InnoDB</code> uses
          operating system threads to process user transactions). Once
          the number of threads reaches this limit, additional threads
          are placed into a wait state within a <span class="quote">“<span class="quote">First In, First
          Out</span>”</span> (FIFO) queue for execution. Threads waiting for
          locks are not counted in the number of concurrently executing
          threads.
        </p><p>
          The range of this variable is 0 to 1000. A value of 0 (the
          default) is interpreted as infinite concurrency (no
          concurrency checking). Disabling thread concurrency checking
          enables <code class="literal">InnoDB</code> to create as many threads as
          it needs. A value of 0 also disables the <code class="literal">queries
          inside InnoDB</code> and <code class="literal">queries in queue
          counters</code> in the <code class="literal">ROW OPERATIONS</code>
          section of <code class="literal">SHOW ENGINE INNODB STATUS</code>
          output.
        </p><p>
          Consider setting this variable if your MySQL instance shares
          CPU resources with other applications, or if your workload or
          number of concurrent users is growing. The correct setting
          depends on workload, computing environment, and the version of
          MySQL that you are running. You will need to test a range of
          values to determine the setting that provides the best
          performance. <code class="literal">innodb_thread_concurrency</code> is a
          dynamic variable, which allows you to experiment with
          different settings on a live test system. If a particular
          setting performs poorly, you can quickly set
          <code class="literal">innodb_thread_concurrency</code> back to 0.
        </p><p>
          Use the following guidelines to help find and maintain an
          appropriate setting:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If the number of concurrent user threads for a workload is
              less than 64, set
              <code class="literal">innodb_thread_concurrency=0</code>.
            </p></li><li class="listitem"><p>
              If your workload is consistently heavy or occasionally
              spikes, start by setting
              <code class="literal">innodb_thread_concurrency=128</code> and then
              lowering the value to 96, 80, 64, and so on, until you
              find the number of threads that provides the best
              performance. For example, suppose your system typically
              has 40 to 50 users, but periodically the number increases
              to 60, 70, or even 200. You find that performance is
              stable at 80 concurrent users but starts to show a
              regression above this number. In this case, you would set
              <code class="literal">innodb_thread_concurrency=80</code> to avoid
              impacting performance.
            </p></li><li class="listitem"><p>
              If you do not want <code class="literal">InnoDB</code> to use more
              than a certain number of virtual CPUs for user threads (20
              virtual CPUs, for example), set
              <code class="literal">innodb_thread_concurrency</code> to this
              number (or possibly lower, depending on performance
              results). If your goal is to isolate MySQL from other
              applications, you may consider binding the
              <code class="literal">mysqld</code> process exclusively to the
              virtual CPUs. Be aware, however, that exclusive binding
              could result in non-optimal hardware usage if the
              <code class="literal">mysqld</code> process is not consistently
              busy. In this case, you might bind the
              <code class="literal">mysqld</code> process to the virtual CPUs but
              also allow other applications to use some or all of the
              virtual CPUs.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                From an operating system perspective, using a resource
                management solution to manage how CPU time is shared
                among applications may be preferable to binding the
                <code class="literal">mysqld</code> process. For example, you
                could assign 90% of virtual CPU time to a given
                application while other critical processes <span class="emphasis"><em>are
                not</em></span> running, and scale that value back to 40%
                when other critical processes <span class="emphasis"><em>are</em></span>
                running.
</p>
</div>
</li><li class="listitem"><p>
              <code class="literal">innodb_thread_concurrency</code> values that
              are too high can cause performance regression due to
              increased contention on system internals and resources.
            </p></li><li class="listitem"><p>
              In some cases, the optimal
              <code class="literal">innodb_thread_concurrency</code> setting can
              be smaller than the number of virtual CPUs.
            </p></li><li class="listitem"><p>
              Monitor and analyze your system regularly. Changes to
              workload, number of users, or computing environment may
              require that you adjust the
              <code class="literal">innodb_thread_concurrency</code> setting.
</p></li></ul>
</div>
<p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="15.8.4 Configuring Thread Concurrency for InnoDB">Section 15.8.4, “Configuring Thread Concurrency for InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_thread_sleep_delay"></a>
          <a class="indexterm" name="idm140091636234528"></a>

          <a class="indexterm" name="idm140091636233424"></a>

          <code class="literal">innodb_thread_sleep_delay</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_thread_sleep_delay"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-thread-sleep-delay=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay">innodb_thread_sleep_delay</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">10000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">1000000</code></td>
</tr></tbody></table>
</div>
<p>
          How long <code class="literal">InnoDB</code> threads sleep before
          joining the <code class="literal">InnoDB</code> queue, in microseconds.
          The default value is 10000. A value of 0 disables sleep. You
          can set the configuration option
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_max_sleep_delay"><code class="literal">innodb_adaptive_max_sleep_delay</code></a>
          to the highest value you would allow for
          <code class="literal">innodb_thread_sleep_delay</code>, and
          <code class="literal">InnoDB</code> automatically adjusts
          <code class="literal">innodb_thread_sleep_delay</code> up or down
          depending on current thread-scheduling activity. This dynamic
          adjustment helps the thread scheduling mechanism to work
          smoothly during times when the system is lightly loaded or
          when it is operating near full capacity.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="15.8.4 Configuring Thread Concurrency for InnoDB">Section 15.8.4, “Configuring Thread Concurrency for InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_tmpdir"></a>
          <a class="indexterm" name="idm140091636189344"></a>

          <a class="indexterm" name="idm140091636188336"></a>

          <code class="literal">innodb_tmpdir</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_tmpdir"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-tmpdir=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_tmpdir">innodb_tmpdir</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global, Session</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Directory name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
          Used to define an alternate directory for temporary sort files
          created during online <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> operations that rebuild the table.
        </p><p>
          Online <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operations
          that rebuild the table also create an
          <span class="emphasis"><em>intermediate</em></span> table file in the same
          directory as the original table. The
          <code class="literal">innodb_tmpdir</code> option is not applicable to
          intermediate table files.
        </p><p>
          A valid value is any directory path other than the MySQL data
          directory path. If the value is NULL (the default), temporary
          files are created MySQL temporary directory
          (<code class="literal">$TMPDIR</code> on Unix, <code class="literal">%TEMP%</code>
          on Windows, or the directory specified by the
          <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">--tmpdir</code></a> configuration
          option). If a directory is specified, existence of the
          directory and permissions are only checked when
          <code class="literal">innodb_tmpdir</code> is configured using a
          <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET</code></a>
          statement. If a symlink is provided in a directory string, the
          symlink is resolved and stored as an absolute path. The path
          should not exceed 512 bytes. An online
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation reports
          an error if <code class="literal">innodb_tmpdir</code> is set to an
          invalid directory. <code class="literal">innodb_tmpdir</code> overrides
          the MySQL <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a> setting but
          only for online <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          operations.
        </p><p>
          The <code class="literal">FILE</code> privilege is required to configure
          <code class="literal">innodb_tmpdir</code>.
        </p><p>
          The <code class="literal">innodb_tmpdir</code> option was introduced to
          help avoid overflowing a temporary file directory located on a
          <code class="literal">tmpfs</code> file system. Such overflows could
          occur as a result of large temporary sort files created during
          online <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operations
          that rebuild the table.
        </p><p>
          In replication environments, only consider replicating the
          <code class="literal">innodb_tmpdir</code> setting if all servers have
          the same operating system environment. Otherwise, replicating
          the <code class="literal">innodb_tmpdir</code> setting could result in a
          replication failure when running online
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operations that
          rebuild the table. If server operating environments differ, it
          is recommended that you configure
          <code class="literal">innodb_tmpdir</code> on each server individually.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl-space-requirements" title="15.12.3 Online DDL Space Requirements">Section 15.12.3, “Online DDL Space Requirements”</a>. For
          information about online <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> operations, see
          <a class="xref" href="innodb-storage-engine.html#innodb-online-ddl" title="15.12 InnoDB and Online DDL">Section 15.12, “InnoDB and Online DDL”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_trx_purge_view_update_only_debug"></a>
          <a class="indexterm" name="idm140091636129264"></a>

          <a class="indexterm" name="idm140091636128176"></a>

          <code class="literal">innodb_trx_purge_view_update_only_debug</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_trx_purge_view_update_only_debug"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-trx-purge-view-update-only-debug[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_trx_purge_view_update_only_debug">innodb_trx_purge_view_update_only_debug</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Pauses purging of delete-marked records while allowing the
          purge view to be updated. This option artificially creates a
          situation in which the purge view is updated but purges have
          not yet been performed. This option is only available if
          debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_trx_rseg_n_slots_debug"></a>
          <a class="indexterm" name="idm140091636094464"></a>

          <a class="indexterm" name="idm140091636093424"></a>

          <code class="literal">innodb_trx_rseg_n_slots_debug</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_trx_rseg_n_slots_debug"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-trx-rseg-n-slots-debug=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_trx_rseg_n_slots_debug">innodb_trx_rseg_n_slots_debug</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">1024</code></td>
</tr></tbody></table>
</div>
<p>
          Sets a debug flag that limits
          <code class="literal">TRX_RSEG_N_SLOTS</code> to a given value for the
          <code class="literal">trx_rsegf_undo_find_free</code> function that
          looks for free slots for undo log segments. This option is
          only available if debugging support is compiled in using the
          <a class="link" href="installing.html#option_cmake_with_debug"><code class="option">WITH_DEBUG</code></a>
          <span class="command"><strong>CMake</strong></span> option.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_directory"></a>
          <a class="indexterm" name="idm140091636055632"></a>

          <code class="literal">innodb_undo_directory</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_undo_directory"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-undo-directory=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory">innodb_undo_directory</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Directory name</td>
</tr></tbody></table>
</div>
<p>
          The path where <code class="literal">InnoDB</code> creates undo
          tablespaces. Typically used to place undo tablespaces on a
          different storage device.
        </p><p>
          There is no default value (it is NULL). If the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
          variable is undefined, undo tablespaces are created in the
          data directory.
        </p><p>
          The default undo tablespaces
          (<code class="literal">innodb_undo_001</code> and
          <code class="literal">innodb_undo_002</code>) created when the MySQL
          instance is initialized always reside in the directory defined
          by the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
          variable.
        </p><p>
          Undo tablespaces created using
          <a class="link" href="sql-syntax.html#create-tablespace" title="13.1.21 CREATE TABLESPACE Syntax"><code class="literal">CREATE UNDO
          TABLESPACE</code></a> syntax are created in the directory
          defined by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>
          variable if a different path is not specified.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-undo-tablespaces" title="15.6.3.4 Undo Tablespaces">Section 15.6.3.4, “Undo Tablespaces”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_log_encrypt"></a>
          <a class="indexterm" name="idm140091636017664"></a>

          <a class="indexterm" name="idm140091636016624"></a>

          <code class="literal">innodb_undo_log_encrypt</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_undo_log_encrypt"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-undo-log-encrypt[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.1</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_encrypt">innodb_undo_log_encrypt</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          Controls encryption of undo log data for tables encrypted
          using the <code class="literal">InnoDB</code>
          <a class="link" href="innodb-storage-engine.html#innodb-tablespace-encryption" title="15.6.3.9 InnoDB Data-at-Rest Encryption">tablespace
          encryption feature</a>. Only applies to undo logs that
          reside in separate <a class="link" href="glossary.html#glos_undo_tablespace" title="undo tablespace">undo
          tablespaces</a>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-undo-tablespaces" title="15.6.3.4 Undo Tablespaces">Section 15.6.3.4, “Undo Tablespaces”</a>. Encryption is not
          supported for undo log data that resides in the system
          tablespace. For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption-undo-log" title="Undo Log Encryption">Undo Log Encryption</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_log_truncate"></a>
          <a class="indexterm" name="idm140091635978608"></a>

          <a class="indexterm" name="idm140091635977504"></a>

          <code class="literal">innodb_undo_log_truncate</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_undo_log_truncate"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-undo-log-truncate[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_log_truncate">innodb_undo_log_truncate</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&gt;= 8.0.2)</td>
<td><code class="literal">ON</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&lt;= 8.0.1)</td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
          When enabled, undo tablespaces that exceed the threshold value
          defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_undo_log_size"><code class="literal">innodb_max_undo_log_size</code></a> are
          marked for truncation. Only undo tablespaces can be truncated.
          Truncating undo logs that reside in the system tablespace is
          not supported. For truncation to occur, there must be at least
          two undo tablespaces.
        </p><p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_rseg_truncate_frequency"><code class="literal">innodb_purge_rseg_truncate_frequency</code></a>
          configuration option can be used to expedite truncation of
          undo tablespaces.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#truncate-undo-tablespace" title="Truncating Undo Tablespaces">Truncating Undo Tablespaces</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_logs"></a>
          <a class="indexterm" name="idm140091635938144"></a>

          <code class="literal">innodb_undo_logs</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_undo_logs"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-undo-logs=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td>
<td>Yes (removed in 8.0.2)</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs">innodb_undo_logs</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">128</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">128</code></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> was
            removed in MySQL 8.0.2.
</p>
</div>
<p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_logs"><code class="literal">innodb_undo_logs</code></a> option
          is an alias for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a>. For
          more information, see the description of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments"><code class="literal">innodb_rollback_segments</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_undo_tablespaces"></a>
          <a class="indexterm" name="idm140091635892624"></a>

          <code class="literal">innodb_undo_tablespaces</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_undo_tablespaces"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-undo-tablespaces=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces">innodb_undo_tablespaces</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span> (&gt;= 8.0.2)</td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span> (&lt;= 8.0.1)</td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&gt;= 8.0.2)</td>
<td><code class="literal">2</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&lt;= 8.0.1)</td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span> (&gt;= 8.0.3)</td>
<td><code class="literal">2</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span> (&lt;= 8.0.2)</td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (&gt;= 8.0.2)</td>
<td><code class="literal">127</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (&lt;= 8.0.1)</td>
<td><code class="literal">95</code></td>
</tr></tbody></table>
</div>
<p>
          Defines the number of
          <a class="link" href="glossary.html#glos_undo_tablespace" title="undo tablespace">undo tablespaces</a>
          used by <code class="literal">InnoDB</code>. The default and minimum
          value is 2.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_tablespaces"><code class="literal">innodb_undo_tablespaces</code></a>
            variable is deprecated and is no longer configurable as of
            MySQL 8.0.14. It will be removed in a future release.
</p>
</div>
<p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-undo-tablespaces" title="15.6.3.4 Undo Tablespaces">Section 15.6.3.4, “Undo Tablespaces”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_use_native_aio"></a>
          <a class="indexterm" name="idm140091635834752"></a>

          <a class="indexterm" name="idm140091635833712"></a>

          <code class="literal">innodb_use_native_aio</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_use_native_aio"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-use-native-aio[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio">innodb_use_native_aio</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
          Specifies whether to use the Linux asynchronous I/O subsystem.
          This variable applies to Linux systems only, and cannot be
          changed while the server is running. Normally, you do not need
          to configure this option, because it is enabled by default.
        </p><p>
          The <a class="link" href="glossary.html#glos_asynchronous_io" title="asynchronous I/O">asynchronous
          I/O</a> capability that <code class="literal">InnoDB</code> has on
          Windows systems is available on Linux systems. (Other
          Unix-like systems continue to use synchronous I/O calls.) This
          feature improves the scalability of heavily I/O-bound systems,
          which typically show many pending reads/writes in
          <code class="literal">SHOW ENGINE INNODB STATUS\G</code> output.
        </p><p>
          Running with a large number of <code class="literal">InnoDB</code> I/O
          threads, and especially running multiple such instances on the
          same server machine, can exceed capacity limits on Linux
          systems. In this case, you may receive the following error:
        </p><pre data-lang="terminal" class="programlisting">
EAGAIN: The specified maxevents exceeds the user's limit of available events.
</pre><p>
          You can typically address this error by writing a higher limit
          to <code class="literal">/proc/sys/fs/aio-max-nr</code>.
        </p><p>
          However, if a problem with the asynchronous I/O subsystem in
          the OS prevents <code class="literal">InnoDB</code> from starting, you
          can start the server with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio=0</code></a>. This
          option may also be disabled automatically during startup if
          <code class="literal">InnoDB</code> detects a potential problem such as
          a combination of <code class="literal">tmpdir</code> location,
          <code class="literal">tmpfs</code> file system, and Linux kernel that
          does not support AIO on <code class="literal">tmpfs</code>.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-linux-native-aio" title="15.8.6 Using Asynchronous I/O on Linux">Section 15.8.6, “Using Asynchronous I/O on Linux”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_version"></a>
          <a class="indexterm" name="idm140091635788688"></a>

          <a class="indexterm" name="idm140091635787632"></a>

          <code class="literal">innodb_version</code>
        </p><p>
          The <code class="literal">InnoDB</code> version number. In MySQL
          8.0, separate version numbering for
          <code class="literal">InnoDB</code> does not apply and this value is the
          same the <a class="link" href="server-administration.html#sysvar_version"><code class="literal">version</code></a> number of
          the server.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_write_io_threads"></a>
          <a class="indexterm" name="idm140091635780944"></a>

          <a class="indexterm" name="idm140091635779904"></a>

          <code class="literal">innodb_write_io_threads</code>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for innodb_write_io_threads"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--innodb-write-io-threads=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads">innodb_write_io_threads</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">4</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">64</code></td>
</tr></tbody></table>
</div>
<p>
          The number of I/O threads for write operations in
          <code class="literal">InnoDB</code>. The default value is 4. Its
          counterpart for read threads is
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>. For
          more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-multiple_io_threads" title="15.8.5 Configuring the Number of Background InnoDB I/O Threads">Section 15.8.5, “Configuring the Number of Background InnoDB I/O Threads”</a>. For
          general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            On Linux systems, running multiple MySQL servers (typically
            more than 12) with default settings for
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>,
            <code class="literal">innodb_write_io_threads</code>, and the Linux
            <code class="literal">aio-max-nr</code> setting can exceed system
            limits. Ideally, increase the <code class="literal">aio-max-nr</code>
            setting; as a workaround, you might reduce the settings for
            one or both of the MySQL configuration options.
</p>
</div>
<p>
          Also take into consideration the value of
          <a class="link" href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a>, which controls
          synchronization of the binary log to disk.
        </p><p>
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-information-schema"></a>15.14 InnoDB INFORMATION_SCHEMA Tables</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-compression-tables">15.14.1 InnoDB INFORMATION_SCHEMA Tables about Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-transactions">15.14.2 InnoDB INFORMATION_SCHEMA Transaction and Locking Information</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-system-tables">15.14.3 InnoDB INFORMATION_SCHEMA Schema Object Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-fulltext_index-tables">15.14.4 InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-buffer-pool-tables">15.14.5 InnoDB INFORMATION_SCHEMA Buffer Pool Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-metrics-table">15.14.6 InnoDB INFORMATION_SCHEMA Metrics Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-temp-table-info">15.14.7 InnoDB INFORMATION_SCHEMA Temporary Table Info Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-files-table">15.14.8 Retrieving InnoDB Tablespace Metadata from INFORMATION_SCHEMA.FILES</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091635731024"></a><p>
    This section provides information and usage examples for
    <code class="literal">InnoDB</code>
    <a class="link" href="information-schema.html" title="Chapter 25 INFORMATION_SCHEMA Tables"><code class="literal">INFORMATION_SCHEMA</code></a> tables.
  </p><p>
    <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
    tables provide metadata, status information, and statistics about
    various aspects of the <code class="literal">InnoDB</code> storage engine. You
    can view a list of <code class="literal">InnoDB</code>
    <code class="literal">INFORMATION_SCHEMA</code> tables by issuing a
    <a class="link" href="sql-syntax.html#show-tables" title="13.7.6.37 SHOW TABLES Syntax"><code class="literal">SHOW TABLES</code></a> statement on the
    <code class="literal">INFORMATION_SCHEMA</code> database:
  </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW TABLES FROM INFORMATION_SCHEMA LIKE 'INNODB%';</code></strong>
</pre><p>
    For table definitions, see <a class="xref" href="information-schema.html#innodb-i_s-tables" title="25.39 INFORMATION_SCHEMA InnoDB Tables">Section 25.39, “INFORMATION_SCHEMA InnoDB Tables”</a>. For
    general information regarding the <code class="literal">MySQL</code>
    <code class="literal">INFORMATION_SCHEMA</code> database, see
    <a class="xref" href="information-schema.html" title="Chapter 25 INFORMATION_SCHEMA Tables">Chapter 25, <i>INFORMATION_SCHEMA Tables</i></a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-compression-tables"></a>15.14.1 InnoDB INFORMATION_SCHEMA Tables about Compression</h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-innodb_cmp">15.14.1.1 INNODB_CMP and INNODB_CMP_RESET</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-innodb_cmpmem">15.14.1.2 INNODB_CMPMEM and INNODB_CMPMEM_RESET</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-examples-compression-sect">15.14.1.3 Using the Compression Information Schema Tables</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091635714864"></a><p>
      There are two pairs of <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> tables about compression
      that can provide insight into how well compression is working
      overall:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
          <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
          provide information about the number of compression operations
          and the amount of time spent performing compression.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> and
          <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
          provide information about the way memory is allocated for
          compression.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-innodb_cmp"></a>15.14.1.1 INNODB_CMP and INNODB_CMP_RESET</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091635703008"></a><a class="indexterm" name="idm140091635701520"></a><p>
        The <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
        <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        tables provide status information about operations related to
        compressed tables, which are described in
        <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="15.9 InnoDB Table and Page Compression">Section 15.9, “InnoDB Table and Page Compression”</a>. The
        <code class="literal">PAGE_SIZE</code> column reports the compressed
        <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>.
      </p><p>
        These two tables have identical contents, but reading from
        <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        resets the statistics on compression and uncompression
        operations. For example, if you archive the output of
        <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        every 60 minutes, you see the statistics for each hourly period.
        If you monitor the output of
        <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> (making sure never to
        read
        <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>),
        you see the cumulative statistics since InnoDB was started.
      </p><p>
        For the table definition, see
        <a class="xref" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables">Section 25.39.5, “The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-innodb_cmpmem"></a>15.14.1.2 INNODB_CMPMEM and INNODB_CMPMEM_RESET</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091635686640"></a><a class="indexterm" name="idm140091635685152"></a><a class="indexterm" name="idm140091635683648"></a><p>
        The <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> and
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        tables provide status information about compressed pages that
        reside in the buffer pool. Please consult
        <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="15.9 InnoDB Table and Page Compression">Section 15.9, “InnoDB Table and Page Compression”</a> for further information on
        compressed tables and the use of the buffer pool. The
        <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
        <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        tables should provide more useful statistics on compression.
</p>
<h5><a name="idm140091635676304"></a>Internal Details</h5>
<p>
        <code class="literal">InnoDB</code> uses a
        <a class="link" href="glossary.html#glos_buddy_allocator" title="buddy allocator">buddy allocator</a>
        system to manage memory allocated to
        <a class="link" href="glossary.html#glos_page_size" title="page size">pages of various sizes</a>,
        from 1KB to 16KB. Each row of the two tables described here
        corresponds to a single page size.
      </p><p>
        The <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> and
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        tables have identical contents, but reading from
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        resets the statistics on relocation operations. For example, if
        every 60 minutes you archived the output of
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>,
        it would show the hourly statistics. If you never read
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        and monitored the output of
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> instead, it would
        show the cumulative statistics since <code class="literal">InnoDB</code>
        was started.
      </p><p>
        For the table definition, see
        <a class="xref" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables">Section 25.39.6, “The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables”</a>.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-examples-compression-sect"></a>15.14.1.3 Using the Compression Information Schema Tables</h4>

</div>

</div>

</div>

<div class="example">
<a name="innodb-information-schema-examples-compression"></a><p class="title"><b>Example 15.1 Using the Compression Information Schema Tables</b></p>
<div class="example-contents">
<p>
          The following is sample output from a database that contains
          compressed tables (see <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="15.9 InnoDB Table and Page Compression">Section 15.9, “InnoDB Table and Page Compression”</a>,
          <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a>,
          <a class="link" href="information-schema.html#innodb-cmp-per-index-table" title="25.39.7 The INFORMATION_SCHEMA INNODB_CMP_PER_INDEX and INNODB_CMP_PER_INDEX_RESET Tables"><code class="literal">INNODB_CMP_PER_INDEX</code></a>, and
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a>).
        </p><p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-cmp-table" title="25.39.5 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP</code></a>
          under a light <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
          The only compressed page size that the buffer pool contains is
          8K. Compressing or uncompressing pages has consumed less than
          a second since the time the statistics were reset, because the
          columns <code class="literal">COMPRESS_TIME</code> and
          <code class="literal">UNCOMPRESS_TIME</code> are zero.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_cmp"></a><table summary="Sample data from the INFORMATION_SCHEMA.INNODB_CMP table, showing the internal workings of InnoDB table compression under a light workload."><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="20%"><col width="20%"><thead><tr>
              <th scope="col">page size</th>
              <th scope="col">compress ops</th>
              <th scope="col">compress ops ok</th>
              <th scope="col">compress time</th>
              <th scope="col">uncompress ops</th>
              <th scope="col">uncompress time</th>
            </tr></thead><tbody><tr>
              <td scope="row">1024</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">2048</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">4096</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">8192</td>
              <td>1048</td>
              <td>921</td>
              <td>0</td>
              <td>61</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">16384</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
</tr></tbody></table>
</div>
<p>
          According to <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a>, there
          are 6169 compressed 8KB pages in the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. The only
          other allocated block size is 64 bytes. The smallest
          <code class="literal">PAGE_SIZE</code> in
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> is used for block
          descriptors of those compressed pages for which no
          uncompressed page exists in the buffer pool. We see that there
          are 5910 such pages. Indirectly, we see that 259 (6169-5910)
          compressed pages also exist in the buffer pool in uncompressed
          form.
        </p><p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="25.39.6 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMPMEM</code></a>
          under a light <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
          Some memory is unusable due to fragmentation of the memory
          allocator for compressed pages:
          <code class="literal">SUM(PAGE_SIZE*PAGES_FREE)=6784</code>. This is
          because small memory allocation requests are fulfilled by
          splitting bigger blocks, starting from the 16K blocks that are
          allocated from the main buffer pool, using the buddy
          allocation system. The fragmentation is this low because some
          allocated blocks have been relocated (copied) to form bigger
          adjacent free blocks. This copying of
          <code class="literal">SUM(PAGE_SIZE*RELOCATION_OPS)</code> bytes has
          consumed less than a second
          <code class="literal">(SUM(RELOCATION_TIME)=0)</code>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_cmpmem"></a><table summary="Sample data from the INFORMATION_SCHEMA.INNODB_CMPMEM table, showing buffer pool memory operations for InnoDB table compression under a light workload."><col width="15%"><col width="15%"><col width="20%"><col width="20%"><col width="20%"><thead><tr>
              <th scope="col">page size</th>
              <th scope="col">pages used</th>
              <th scope="col">pages free</th>
              <th scope="col">relocation ops</th>
              <th scope="col">relocation time</th>
            </tr></thead><tbody><tr>
              <td scope="row">64</td>
              <td>5910</td>
              <td>0</td>
              <td>2436</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">128</td>
              <td>0</td>
              <td>1</td>
              <td>0</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">256</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">512</td>
              <td>0</td>
              <td>1</td>
              <td>0</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">1024</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">2048</td>
              <td>0</td>
              <td>1</td>
              <td>0</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">4096</td>
              <td>0</td>
              <td>1</td>
              <td>0</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">8192</td>
              <td>6169</td>
              <td>0</td>
              <td>5</td>
              <td>0</td>
            </tr><tr>
              <td scope="row">16384</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
              <td>0</td>
</tr></tbody></table>
</div>

</div>

</div>
<br class="example-break">
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-transactions"></a>15.14.2 InnoDB INFORMATION_SCHEMA Transaction and Locking Information</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-examples">15.14.2.1 Using InnoDB Transaction and Locking Information</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-understanding-innodb-locking">15.14.2.2 InnoDB Lock and Lock-Wait Information</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-internal-data">15.14.2.3 Persistence and Consistency of InnoDB Transaction and Locking
Information</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091635539424"></a><a class="indexterm" name="idm140091635537936"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        This section describes locking information as exposed by the
        Performance Schema <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> and
        <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> tables, which
        supersede the <code class="literal">INFORMATION_SCHEMA</code>
        <a class="link" href="information-schema.html#innodb-locks-table" title="25.39.20 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> and
        <a class="link" href="information-schema.html#innodb-lock-waits-table" title="25.39.21 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a> tables in MySQL
        8.0. For similar discussion written in terms of the
        older <code class="literal">INFORMATION_SCHEMA</code> tables, see
        <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-information-schema-transactions.html" target="_top">InnoDB INFORMATION_SCHEMA Transaction and Locking Information</a>
        in <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/" target="_top">MySQL 5.7 Reference Manual</a>.
</p>
</div>
<p>
      One <code class="literal">INFORMATION_SCHEMA</code> table and two
      Performance Schema tables enable you to monitor
      <code class="literal">InnoDB</code> transactions and diagnose potential
      locking problems:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>: This
          <code class="literal">INFORMATION_SCHEMA</code> table provides
          information about every transaction currently executing inside
          <code class="literal">InnoDB</code>, including the transaction state
          (for example, whether it is running or waiting for a lock),
          when the transaction started, and the particular SQL statement
          the transaction is executing.
        </p><a class="indexterm" name="idm140091635520976"></a></li><li class="listitem"><p>
          <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a>: This Performance
          Schema table contains a row for each hold lock and each lock
          request that is blocked waiting for a held lock to be
          released:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              There is one row for each held lock, whatever the state of
              the transaction that holds the lock
              (<code class="literal">INNODB_TRX.TRX_STATE</code> is
              <code class="literal">RUNNING</code>, <code class="literal">LOCK WAIT</code>,
              <code class="literal">ROLLING BACK</code> or
              <code class="literal">COMMITTING</code>).
            </p></li><li class="listitem"><p>
              Each transaction in InnoDB that is waiting for another
              transaction to release a lock
              (<code class="literal">INNODB_TRX.TRX_STATE</code> is <code class="literal">LOCK
              WAIT</code>) is blocked by exactly one blocking lock
              request. That blocking lock request is for a row or table
              lock held by another transaction in an incompatible mode.
              A lock request always has a mode that is incompatible with
              the mode of the held lock that blocks the request (read
              vs. write, shared vs. exclusive).
            </p><p>
              The blocked transaction cannot proceed until the other
              transaction commits or rolls back, thereby releasing the
              requested lock. For every blocked transaction,
              <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> contains one row
              that describes each lock the transaction has requested,
              and for which it is waiting.
</p></li></ul>
</div>
<a class="indexterm" name="idm140091635507744"></a></li><li class="listitem"><p>
          <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a>: This Performance
          Schema table indicates which transactions are waiting for a
          given lock, or for which lock a given transaction is waiting.
          This table contains one or more rows for each blocked
          transaction, indicating the lock it has requested and any
          locks that are blocking that request. The
          <code class="literal">REQUESTING_ENGINE_LOCK_ID</code> value refers to
          the lock requested by a transaction, and the
          <code class="literal">BLOCKING_ENGINE_LOCK_ID</code> value refers to the
          lock (held by another transaction) that prevents the first
          transaction from proceeding. For any given blocked
          transaction, all rows in
          <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> have the same
          value for <code class="literal">REQUESTING_ENGINE_LOCK_ID</code> and
          different values for
          <code class="literal">BLOCKING_ENGINE_LOCK_ID</code>.
</p><a class="indexterm" name="idm140091635499488"></a></li></ul>
</div>
<p>
      For more information about the preceding tables, see
      <a class="xref" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table">Section 25.39.29, “The INFORMATION_SCHEMA INNODB_TRX Table”</a>,
      <a class="xref" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table">Section 26.12.12.1, “The data_locks Table”</a>, and
      <a class="xref" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table">Section 26.12.12.2, “The data_lock_waits Table”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-examples"></a>15.14.2.1 Using InnoDB Transaction and Locking Information</h4>

</div>

</div>

</div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          This section describes locking information as exposed by the
          Performance Schema <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> and
          <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> tables, which
          supersede the <code class="literal">INFORMATION_SCHEMA</code>
          <a class="link" href="information-schema.html#innodb-locks-table" title="25.39.20 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> and
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="25.39.21 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a> tables in MySQL
          8.0. For similar discussion written in terms of
          the older <code class="literal">INFORMATION_SCHEMA</code> tables, see
          <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-information-schema-examples.html" target="_top">Using InnoDB Transaction and Locking Information</a>
          in <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/" target="_top">MySQL 5.7 Reference Manual</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-information-schema-examples-simple-blocking"></a>Identifying Blocking Transactions</h5>

</div>

</div>

</div>
<p>
          It is sometimes helpful to identify which transaction blocks
          another. The tables that contain information about
          <code class="literal">InnoDB</code> transactions and data locks enable
          you to determine which transaction is waiting for another, and
          which resource is being requested. (For descriptions of these
          tables, see
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-transactions" title="15.14.2 InnoDB INFORMATION_SCHEMA Transaction and Locking Information">Section 15.14.2, “InnoDB INFORMATION_SCHEMA Transaction and Locking Information”</a>.)
        </p><p>
          Suppose that three sessions are running concurrently. Each
          session corresponds to a MySQL thread, and executes one
          transaction after another. Consider the state of the system
          when these sessions have issued the following statements, but
          none has yet committed its transaction:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Session A:
            </p><pre data-lang="sql" class="programlisting">
BEGIN;
SELECT a FROM t FOR UPDATE;
SELECT SLEEP(100);
</pre></li><li class="listitem"><p>
              Session B:
            </p><pre data-lang="sql" class="programlisting">
SELECT b FROM t FOR UPDATE;
</pre></li><li class="listitem"><p>
              Session C:
            </p><pre data-lang="sql" class="programlisting">
SELECT c FROM t FOR UPDATE;
</pre></li></ul>
</div>
<p>
          In this scenario, use the following query to see which
          transactions are waiting and which transactions are blocking
          them:
        </p><pre data-lang="sql" class="programlisting">
SELECT
  r.trx_id waiting_trx_id,
  r.trx_mysql_thread_id waiting_thread,
  r.trx_query waiting_query,
  b.trx_id blocking_trx_id,
  b.trx_mysql_thread_id blocking_thread,
  b.trx_query blocking_query
FROM       performance_schema.data_lock_waits w
INNER JOIN information_schema.innodb_trx b
  ON b.trx_id = w.blocking_engine_transaction_id
INNER JOIN information_schema.innodb_trx r
  ON r.trx_id = w.requesting_engine_transaction_id;
</pre><p>
          Or, more simply, use the <code class="literal">sys</code> schema
          <a class="link" href="sys-schema.html#sys-innodb-lock-waits" title="27.4.3.9 The innodb_lock_waits and x$innodb_lock_waits Views"><code class="literal">innodb_lock_waits</code></a> view:
        </p><pre data-lang="sql" class="programlisting">
SELECT
  waiting_trx_id,
  waiting_pid,
  waiting_query,
  blocking_trx_id,
  blocking_pid,
  blocking_query
FROM sys.innodb_lock_waits;
</pre><p>
          If a NULL value is reported for the blocking query, see
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-examples-null-blocking-query" title="Identifying a Blocking Query After the Issuing Session Becomes Idle">Identifying a Blocking Query After the Issuing Session Becomes Idle</a>.
</p>
<div class="informaltable">
<table summary="The result set of a query against the perormance_schema.data_lock_waits and INFORMATION_SCHEMA.INNODB_TRX tables, shown in the preceding text, indicating which InnoDB threads are waiting for which other threads."><col width="9%"><col width="9%"><col width="33%"><col width="10%"><col width="10%"><col width="33%"><thead><tr>
              <th scope="col">waiting trx id</th>
              <th scope="col">waiting thread</th>
              <th scope="col">waiting query</th>
              <th scope="col">blocking trx id</th>
              <th scope="col">blocking thread</th>
              <th scope="col">blocking query</th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">A4</code></td>
              <td><code class="literal">6</code></td>
              <td><code class="literal">SELECT b FROM t FOR UPDATE</code></td>
              <td><code class="literal">A3</code></td>
              <td><code class="literal">5</code></td>
              <td><code class="literal">SELECT SLEEP(100)</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">A5</code></td>
              <td><code class="literal">7</code></td>
              <td><code class="literal">SELECT c FROM t FOR UPDATE</code></td>
              <td><code class="literal">A3</code></td>
              <td><code class="literal">5</code></td>
              <td><code class="literal">SELECT SLEEP(100)</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">A5</code></td>
              <td><code class="literal">7</code></td>
              <td><code class="literal">SELECT c FROM t FOR UPDATE</code></td>
              <td><code class="literal">A4</code></td>
              <td><code class="literal">6</code></td>
              <td><code class="literal">SELECT b FROM t FOR UPDATE</code></td>
</tr></tbody></table>
</div>
<p>
          In the preceding table, you can identify sessions by the
          <span class="quote">“<span class="quote">waiting query</span>”</span> or <span class="quote">“<span class="quote">blocking query</span>”</span>
          columns. As you can see:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Session B (trx id <code class="literal">A4</code>, thread
              <code class="literal">6</code>) and Session C (trx id
              <code class="literal">A5</code>, thread <code class="literal">7</code>) are
              both waiting for Session A (trx id <code class="literal">A3</code>,
              thread <code class="literal">5</code>).
            </p></li><li class="listitem"><p>
              Session C is waiting for Session B as well as Session A.
</p></li></ul>
</div>
<p>
          You can see the underlying data in the
          <code class="literal">INFORMATION_SCHEMA</code>
          <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> table and Performance
          Schema <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> and
          <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> tables.
        </p><p>
          The following table shows some sample contents of the
          <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> table.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-trx"></a><table summary="Sample data from the INFORMATION_SCHEMA.INNODB_TRX table, showing the typical types of entries for each column."><col width="10%"><col width="13%"><col width="36%"><col width="30%"><col width="36%"><col width="19%"><col width="23%"><col width="45%"><thead><tr>
              <th scope="col">trx id</th>
              <th scope="col">trx state</th>
              <th scope="col">trx started</th>
              <th scope="col">trx requested lock id</th>
              <th scope="col">trx wait started</th>
              <th scope="col">trx weight</th>
              <th scope="col">trx mysql thread id</th>
              <th scope="col">trx query</th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">A3</code></td>
              <td><code class="literal">RUN­NING</code></td>
              <td><code class="literal">2008-01-15 16:44:54</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">2</code></td>
              <td><code class="literal">5</code></td>
              <td><code class="literal">SELECT SLEEP(100)</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">A4</code></td>
              <td><code class="literal">LOCK WAIT</code></td>
              <td><code class="literal">2008-01-15 16:45:09</code></td>
              <td><code class="literal">A4:1:3:2</code></td>
              <td><code class="literal">2008-01-15 16:45:09</code></td>
              <td><code class="literal">2</code></td>
              <td><code class="literal">6</code></td>
              <td><code class="literal">SELECT b FROM t FOR UPDATE</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">A5</code></td>
              <td><code class="literal">LOCK WAIT</code></td>
              <td><code class="literal">2008-01-15 16:45:14</code></td>
              <td><code class="literal">A5:1:3:2</code></td>
              <td><code class="literal">2008-01-15 16:45:14</code></td>
              <td><code class="literal">2</code></td>
              <td><code class="literal">7</code></td>
              <td><code class="literal">SELECT c FROM t FOR UPDATE</code></td>
</tr></tbody></table>
</div>
<p>
          The following table shows some sample contents of the
          <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> table.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-locks"></a><table summary="Sample data from the Performance Schema data_locks table, showing the typical types of entries for each column."><col width="26%"><col width="13%"><col width="14%"><col width="21%"><col width="16%"><col width="15%"><col width="29%"><col width="20%"><thead><tr>
              <th scope="col">lock id</th>
              <th scope="col">lock trx id</th>
              <th scope="col">lock mode</th>
              <th scope="col">lock type</th>
              <th scope="col">lock schema</th>
              <th scope="col">lock table</th>
              <th scope="col">lock index</th>
              <th scope="col">lock data</th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">A3:1:3:2</code></td>
              <td><code class="literal">A3</code></td>
              <td><code class="literal">X</code></td>
              <td><code class="literal">RECORD</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t</code></td>
              <td><code class="literal">PRIMARY</code></td>
              <td><code class="literal">0x0200</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">A4:1:3:2</code></td>
              <td><code class="literal">A4</code></td>
              <td><code class="literal">X</code></td>
              <td><code class="literal">RECORD</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t</code></td>
              <td><code class="literal">PRIMARY</code></td>
              <td><code class="literal">0x0200</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">A5:1:3:2</code></td>
              <td><code class="literal">A5</code></td>
              <td><code class="literal">X</code></td>
              <td><code class="literal">RECORD</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t</code></td>
              <td><code class="literal">PRIMARY</code></td>
              <td><code class="literal">0x0200</code></td>
</tr></tbody></table>
</div>
<p>
          The following table shows some sample contents of the
          <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> table.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-waits"></a><table summary="Sample data from the Performance Schema data_lock_waits table, showing the typical types of entries for each column."><col width="10%"><col width="15%"><col width="10%"><col width="15%"><thead><tr>
              <th scope="col">requesting trx id</th>
              <th scope="col">requested lock id</th>
              <th scope="col">blocking trx id</th>
              <th scope="col">blocking lock id</th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">A4</code></td>
              <td><code class="literal">A4:1:3:2</code></td>
              <td><code class="literal">A3</code></td>
              <td><code class="literal">A3:1:3:2</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">A5</code></td>
              <td><code class="literal">A5:1:3:2</code></td>
              <td><code class="literal">A3</code></td>
              <td><code class="literal">A3:1:3:2</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">A5</code></td>
              <td><code class="literal">A5:1:3:2</code></td>
              <td><code class="literal">A4</code></td>
              <td><code class="literal">A4:1:3:2</code></td>
</tr></tbody></table>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-information-schema-examples-null-blocking-query"></a>Identifying a Blocking Query After the Issuing Session Becomes Idle</h5>

</div>

</div>

</div>
<p>
          When identifying blocking transactions, a NULL value is
          reported for the blocking query if the session that issued the
          query has become idle. In this case, use the following steps
          to determine the blocking query:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Identify the processlist ID of the blocking transaction.
              In the <a class="link" href="sys-schema.html#sys-innodb-lock-waits" title="27.4.3.9 The innodb_lock_waits and x$innodb_lock_waits Views"><code class="literal">sys.innodb_lock_waits</code></a>
              table, the processlist ID of the blocking transaction is
              the <code class="literal">blocking_pid</code> value.
            </p></li><li class="listitem"><p>
              Using the <code class="literal">blocking_pid</code>, query the MySQL
              Performance Schema <a class="link" href="performance-schema.html#threads-table" title="26.12.17.5 The threads Table"><code class="literal">threads</code></a>
              table to determine the <code class="literal">THREAD_ID</code> of the
              blocking transaction. For example, if the
              <code class="literal">blocking_pid</code> is 6, issue this query:
            </p><pre data-lang="sql" class="programlisting">
SELECT THREAD_ID FROM performance_schema.threads WHERE PROCESSLIST_ID = 6;
</pre></li><li class="listitem"><p>
              Using the <code class="literal">THREAD_ID</code>, query the
              Performance Schema
              <a class="link" href="performance-schema.html#events-statements-current-table" title="26.12.6.1 The events_statements_current Table"><code class="literal">events_statements_current</code></a>
              table to determine the last query executed by the thread.
              For example, if the <code class="literal">THREAD_ID</code> is 28,
              issue this query:
            </p><pre data-lang="sql" class="programlisting">
SELECT THREAD_ID, SQL_TEXT FROM performance_schema.events_statements_current 
WHERE THREAD_ID = 28\G
</pre></li><li class="listitem"><p>
              If the last query executed by the thread is not enough
              information to determine why a lock is held, you can query
              the Performance Schema
              <a class="link" href="performance-schema.html#events-statements-history-table" title="26.12.6.2 The events_statements_history Table"><code class="literal">events_statements_history</code></a>
              table to view the last 10 statements executed by the
              thread.
            </p><pre data-lang="sql" class="programlisting">
SELECT THREAD_ID, SQL_TEXT FROM performance_schema.events_statements_history 
WHERE THREAD_ID = 28 ORDER BY EVENT_ID;
</pre></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="innodb-information-schema-sample-locks"></a>Correlating InnoDB Transactions with MySQL Sessions</h5>

</div>

</div>

</div>
<p>
          Sometimes it is useful to correlate internal
          <code class="literal">InnoDB</code> locking information with the
          session-level information maintained by MySQL. For example,
          you might like to know, for a given <code class="literal">InnoDB</code>
          transaction ID, the corresponding MySQL session ID and name of
          the session that may be holding a lock, and thus blocking
          other transactions.
        </p><p>
          The following output from the
          <code class="literal">INFORMATION_SCHEMA</code>
          <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> table and Performance
          Schema <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> and
          <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> tables is taken
          from a somewhat loaded system. As can be seen, there are
          several transactions running.
        </p><p>
          The following <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> and
          <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> tables show that:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Transaction <code class="literal">77F</code> (executing an
              <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>) is waiting for
              transactions <code class="literal">77E</code>,
              <code class="literal">77D</code>, and <code class="literal">77B</code> to
              commit.
            </p></li><li class="listitem"><p>
              Transaction <code class="literal">77E</code> (executing an
              <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>) is waiting for
              transactions <code class="literal">77D</code> and
              <code class="literal">77B</code> to commit.
            </p></li><li class="listitem"><p>
              Transaction <code class="literal">77D</code> (executing an
              <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>) is waiting for
              transaction <code class="literal">77B</code> to commit.
            </p></li><li class="listitem"><p>
              Transaction <code class="literal">77B</code> (executing an
              <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>) is waiting for
              transaction <code class="literal">77A</code> to commit.
            </p></li><li class="listitem"><p>
              Transaction <code class="literal">77A</code> is running, currently
              executing <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a>.
            </p></li><li class="listitem"><p>
              Transaction <code class="literal">E56</code> (executing an
              <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>) is waiting for
              transaction <code class="literal">E55</code> to commit.
            </p></li><li class="listitem"><p>
              Transaction <code class="literal">E55</code> (executing an
              <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>) is waiting for
              transaction <code class="literal">19C</code> to commit.
            </p></li><li class="listitem"><p>
              Transaction <code class="literal">19C</code> is running, currently
              executing an <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            There may be inconsistencies between queries shown in the
            <code class="literal">INFORMATION_SCHEMA</code>
            <a class="link" href="information-schema.html#processlist-table" title="25.19 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> and
            <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> tables. For an
            explanation, see
            <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-internal-data" title="15.14.2.3 Persistence and Consistency of InnoDB Transaction and Locking Information">Section 15.14.2.3, “Persistence and Consistency of InnoDB Transaction and Locking
        Information”</a>.
</p>
</div>
<p>
          The following table shows the contents of the
          <a class="link" href="information-schema.html#processlist-table" title="25.19 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> table for a system
          running a heavy <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-processlist"></a><table summary="Sample data from the INFORMATION_SCHEMA.PROCESSLIST table, showing the internal workings of MySQL processes under a heavy workload."><col width="8%"><col width="11%"><col width="21%"><col width="10%"><col width="20%"><col width="10%"><col width="20%"><col width="25%"><thead><tr>
              <th scope="col">ID</th>
              <th scope="col">USER</th>
              <th scope="col">HOST</th>
              <th scope="col">DB</th>
              <th scope="col">COMMAND</th>
              <th scope="col">TIME</th>
              <th scope="col">STATE</th>
              <th scope="col">INFO</th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">384</code></td>
              <td><code class="literal">root</code></td>
              <td><code class="literal">localhost</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">Query</code></td>
              <td><code class="literal">10</code></td>
              <td><code class="literal">update</code></td>
              <td><code class="literal">INSERT INTO t2 VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">257</code></td>
              <td><code class="literal">root</code></td>
              <td><code class="literal">localhost</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">Query</code></td>
              <td><code class="literal">3</code></td>
              <td><code class="literal">update</code></td>
              <td><code class="literal">INSERT INTO t2 VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">130</code></td>
              <td><code class="literal">root</code></td>
              <td><code class="literal">localhost</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">Query</code></td>
              <td><code class="literal">0</code></td>
              <td><code class="literal">update</code></td>
              <td><code class="literal">INSERT INTO t2 VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">61</code></td>
              <td><code class="literal">root</code></td>
              <td><code class="literal">localhost</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">Query</code></td>
              <td><code class="literal">1</code></td>
              <td><code class="literal">update</code></td>
              <td><code class="literal">INSERT INTO t2 VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">8</code></td>
              <td><code class="literal">root</code></td>
              <td><code class="literal">localhost</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">Query</code></td>
              <td><code class="literal">1</code></td>
              <td><code class="literal">update</code></td>
              <td><code class="literal">INSERT INTO t2 VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">4</code></td>
              <td><code class="literal">root</code></td>
              <td><code class="literal">localhost</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">Query</code></td>
              <td><code class="literal">0</code></td>
              <td><code class="literal">preparing</code></td>
              <td><code class="literal">SELECT * FROM PROCESSLIST</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">2</code></td>
              <td><code class="literal">root</code></td>
              <td><code class="literal">localhost</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">Sleep</code></td>
              <td><code class="literal">566</code></td>
              <td><code class="literal"></code></td>
              <td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
          The following table shows the contents of the
          <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> table for a system
          running a heavy <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb-trx"></a><table summary="Sample data from the INFORMATION_SCHEMA.INNODB_TRX table, showing the internal workings of InnoDB transactions under a heavy workload."><col width="8%"><col width="10%"><col width="19%"><col width="21%"><col width="19%"><col width="10%"><col width="10%"><col width="31%"><thead><tr>
              <th scope="col">trx id</th>
              <th scope="col">trx state</th>
              <th scope="col">trx started</th>
              <th scope="col">trx requested lock id</th>
              <th scope="col">trx wait started</th>
              <th scope="col">trx weight</th>
              <th scope="col">trx mysql thread id</th>
              <th scope="col">trx query</th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">77F</code></td>
              <td><code class="literal">LOCK WAIT</code></td>
              <td><code class="literal">2008-01-15 13:10:16</code></td>
              <td><code class="literal">77F</code></td>
              <td><code class="literal">2008-01-15 13:10:16</code></td>
              <td><code class="literal">1</code></td>
              <td><code class="literal">876</code></td>
              <td><code class="literal">INSERT INTO t09 (D, B, C) VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77E</code></td>
              <td><code class="literal">LOCK WAIT</code></td>
              <td><code class="literal">2008-01-15 13:10:16</code></td>
              <td><code class="literal">77E</code></td>
              <td><code class="literal">2008-01-15 13:10:16</code></td>
              <td><code class="literal">1</code></td>
              <td><code class="literal">875</code></td>
              <td><code class="literal">INSERT INTO t09 (D, B, C) VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77D</code></td>
              <td><code class="literal">LOCK WAIT</code></td>
              <td><code class="literal">2008-01-15 13:10:16</code></td>
              <td><code class="literal">77D</code></td>
              <td><code class="literal">2008-01-15 13:10:16</code></td>
              <td><code class="literal">1</code></td>
              <td><code class="literal">874</code></td>
              <td><code class="literal">INSERT INTO t09 (D, B, C) VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77B</code></td>
              <td><code class="literal">LOCK WAIT</code></td>
              <td><code class="literal">2008-01-15 13:10:16</code></td>
              <td><code class="literal">77B:733:12:1</code></td>
              <td><code class="literal">2008-01-15 13:10:16</code></td>
              <td><code class="literal">4</code></td>
              <td><code class="literal">873</code></td>
              <td><code class="literal">INSERT INTO t09 (D, B, C) VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77A</code></td>
              <td><code class="literal">RUN­NING</code></td>
              <td><code class="literal">2008-01-15 13:10:16</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">4</code></td>
              <td><code class="literal">872</code></td>
              <td><code class="literal">SELECT b, c FROM t09 WHERE …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">E56</code></td>
              <td><code class="literal">LOCK WAIT</code></td>
              <td><code class="literal">2008-01-15 13:10:06</code></td>
              <td><code class="literal">E56:743:6:2</code></td>
              <td><code class="literal">2008-01-15 13:10:06</code></td>
              <td><code class="literal">5</code></td>
              <td><code class="literal">384</code></td>
              <td><code class="literal">INSERT INTO t2 VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">E55</code></td>
              <td><code class="literal">LOCK WAIT</code></td>
              <td><code class="literal">2008-01-15 13:10:06</code></td>
              <td><code class="literal">E55:743:38:2</code></td>
              <td><code class="literal">2008-01-15 13:10:13</code></td>
              <td><code class="literal">965</code></td>
              <td><code class="literal">257</code></td>
              <td><code class="literal">INSERT INTO t2 VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">19C</code></td>
              <td><code class="literal">RUN­NING</code></td>
              <td><code class="literal">2008-01-15 13:09:10</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">2900</code></td>
              <td><code class="literal">130</code></td>
              <td><code class="literal">INSERT INTO t2 VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">E15</code></td>
              <td><code class="literal">RUN­NING</code></td>
              <td><code class="literal">2008-01-15 13:08:59</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">5395</code></td>
              <td><code class="literal">61</code></td>
              <td><code class="literal">INSERT INTO t2 VALUES …</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">51D</code></td>
              <td><code class="literal">RUN­NING</code></td>
              <td><code class="literal">2008-01-15 13:08:47</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">9807</code></td>
              <td><code class="literal">8</code></td>
              <td><code class="literal">INSERT INTO t2 VALUES …</code></td>
</tr></tbody></table>
</div>
<p>
          The following table shows the contents of the
          <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> table for a
          system running a heavy
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb-lock-waits"></a><table summary="Sample data from the Performance Schema data_lock_waits table, showing the internal workings of InnoDB locking under a heavy workload."><col width="25%"><col width="25%"><col width="25%"><col width="25%"><thead><tr>
              <th scope="col">requesting trx id</th>
              <th scope="col">requested lock id</th>
              <th scope="col">blocking trx id</th>
              <th scope="col">blocking lock id</th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">77F</code></td>
              <td><code class="literal">77F:806</code></td>
              <td><code class="literal">77E</code></td>
              <td><code class="literal">77E:806</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77F</code></td>
              <td><code class="literal">77F:806</code></td>
              <td><code class="literal">77D</code></td>
              <td><code class="literal">77D:806</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77F</code></td>
              <td><code class="literal">77F:806</code></td>
              <td><code class="literal">77B</code></td>
              <td><code class="literal">77B:806</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77E</code></td>
              <td><code class="literal">77E:806</code></td>
              <td><code class="literal">77D</code></td>
              <td><code class="literal">77D:806</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77E</code></td>
              <td><code class="literal">77E:806</code></td>
              <td><code class="literal">77B</code></td>
              <td><code class="literal">77B:806</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77D</code></td>
              <td><code class="literal">77D:806</code></td>
              <td><code class="literal">77B</code></td>
              <td><code class="literal">77B:806</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77B</code></td>
              <td><code class="literal">77B:733:12:1</code></td>
              <td><code class="literal">77A</code></td>
              <td><code class="literal">77A:733:12:1</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">E56</code></td>
              <td><code class="literal">E56:743:6:2</code></td>
              <td><code class="literal">E55</code></td>
              <td><code class="literal">E55:743:6:2</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">E55</code></td>
              <td><code class="literal">E55:743:38:2</code></td>
              <td><code class="literal">19C</code></td>
              <td><code class="literal">19C:743:38:2</code></td>
</tr></tbody></table>
</div>
<p>
          The following table shows the contents of the
          <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> table for a system
          running a heavy <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb-locks"></a><table summary="Sample data from the Performance Schema data_locks table, showing the internal workings of InnoDB locking under a heavy workload."><col width="18%"><col width="9%"><col width="12%"><col width="12%"><col width="9%"><col width="8%"><col width="15%"><col width="17%"><thead><tr>
              <th scope="col">lock id</th>
              <th scope="col">lock trx id</th>
              <th scope="col">lock mode</th>
              <th scope="col">lock type</th>
              <th scope="col">lock schema</th>
              <th scope="col">lock table</th>
              <th scope="col">lock index</th>
              <th scope="col">lock data</th>
            </tr></thead><tbody><tr>
              <td scope="row"><code class="literal">77F:806</code></td>
              <td><code class="literal">77F</code></td>
              <td><code class="literal">AUTO_INC</code></td>
              <td><code class="literal">TABLE</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t09</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">NULL</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77E:806</code></td>
              <td><code class="literal">77E</code></td>
              <td><code class="literal">AUTO_INC</code></td>
              <td><code class="literal">TABLE</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t09</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">NULL</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77D:806</code></td>
              <td><code class="literal">77D</code></td>
              <td><code class="literal">AUTO_INC</code></td>
              <td><code class="literal">TABLE</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t09</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">NULL</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77B:806</code></td>
              <td><code class="literal">77B</code></td>
              <td><code class="literal">AUTO_INC</code></td>
              <td><code class="literal">TABLE</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t09</code></td>
              <td><code class="literal">NULL</code></td>
              <td><code class="literal">NULL</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77B:733:12:1</code></td>
              <td><code class="literal">77B</code></td>
              <td><code class="literal">X</code></td>
              <td><code class="literal">RECORD</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t09</code></td>
              <td><code class="literal">PRIMARY</code></td>
              <td><code class="literal">supremum pseudo-record</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">77A:733:12:1</code></td>
              <td><code class="literal">77A</code></td>
              <td><code class="literal">X</code></td>
              <td><code class="literal">RECORD</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t09</code></td>
              <td><code class="literal">PRIMARY</code></td>
              <td><code class="literal">supremum pseudo-record</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">E56:743:6:2</code></td>
              <td><code class="literal">E56</code></td>
              <td><code class="literal">S</code></td>
              <td><code class="literal">RECORD</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t2</code></td>
              <td><code class="literal">PRIMARY</code></td>
              <td><code class="literal">0, 0</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">E55:743:6:2</code></td>
              <td><code class="literal">E55</code></td>
              <td><code class="literal">X</code></td>
              <td><code class="literal">RECORD</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t2</code></td>
              <td><code class="literal">PRIMARY</code></td>
              <td><code class="literal">0, 0</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">E55:743:38:2</code></td>
              <td><code class="literal">E55</code></td>
              <td><code class="literal">S</code></td>
              <td><code class="literal">RECORD</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t2</code></td>
              <td><code class="literal">PRIMARY</code></td>
              <td><code class="literal">1922, 1922</code></td>
            </tr><tr>
              <td scope="row"><code class="literal">19C:743:38:2</code></td>
              <td><code class="literal">19C</code></td>
              <td><code class="literal">X</code></td>
              <td><code class="literal">RECORD</code></td>
              <td><code class="literal">test</code></td>
              <td><code class="literal">t2</code></td>
              <td><code class="literal">PRIMARY</code></td>
              <td><code class="literal">1922, 1922</code></td>
</tr></tbody></table>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-understanding-innodb-locking"></a>15.14.2.2 InnoDB Lock and Lock-Wait Information</h4>

</div>

</div>

</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          This section describes locking information as exposed by the
          Performance Schema <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> and
          <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> tables, which
          supersede the <code class="literal">INFORMATION_SCHEMA</code>
          <a class="link" href="information-schema.html#innodb-locks-table" title="25.39.20 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> and
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="25.39.21 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a> tables in MySQL
          8.0. For similar discussion written in terms of
          the older <code class="literal">INFORMATION_SCHEMA</code> tables, see
          <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-information-schema-understanding-innodb-locking.html" target="_top">InnoDB Lock and Lock-Wait Information</a>
          in <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/" target="_top">MySQL 5.7 Reference Manual</a>.
</p>
</div>
<p>
        When a transaction updates a row in a table, or locks it with
        <code class="literal">SELECT FOR UPDATE</code>, <code class="literal">InnoDB</code>
        establishes a list or queue of locks on that row. Similarly,
        <code class="literal">InnoDB</code> maintains a list of locks on a table
        for table-level locks. If a second transaction wants to update a
        row or lock a table already locked by a prior transaction in an
        incompatible mode, <code class="literal">InnoDB</code> adds a lock request
        for the row to the corresponding queue. For a lock to be
        acquired by a transaction, all incompatible lock requests
        previously entered into the lock queue for that row or table
        must be removed (which occurs when the transactions holding or
        requesting those locks either commit or roll back).
      </p><p>
        A transaction may have any number of lock requests for different
        rows or tables. At any given time, a transaction may request a
        lock that is held by another transaction, in which case it is
        blocked by that other transaction. The requesting transaction
        must wait for the transaction that holds the blocking lock to
        commit or roll back. If a transaction is not waiting for a lock,
        it is in a <code class="literal">RUNNING</code> state. If a transaction is
        waiting for a lock, it is in a <code class="literal">LOCK WAIT</code>
        state. (The <code class="literal">INFORMATION_SCHEMA</code>
        <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> table indicates
        transaction state values.)
      </p><p>
        The Performance Schema <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a>
        table holds one or more rows for each <code class="literal">LOCK
        WAIT</code> transaction, indicating any lock requests that
        prevent its progress. This table also contains one row
        describing each lock in a queue of locks pending for a given row
        or table. The Performance Schema
        <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> table shows which
        locks already held by a transaction are blocking locks requested
        by other transactions.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-internal-data"></a>15.14.2.3 Persistence and Consistency of InnoDB Transaction and Locking
Information</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091634774288"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          This section describes locking information as exposed by the
          Performance Schema <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> and
          <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> tables, which
          supersede the <code class="literal">INFORMATION_SCHEMA</code>
          <a class="link" href="information-schema.html#innodb-locks-table" title="25.39.20 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> and
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="25.39.21 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a> tables in MySQL
          8.0. For similar discussion written in terms of
          the older <code class="literal">INFORMATION_SCHEMA</code> tables, see
          <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-information-schema-internal-data.html" target="_top">Persistence and Consistency of InnoDB Transaction and Locking Information</a>
          in <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/" target="_top">MySQL 5.7 Reference Manual</a>.
</p>
</div>
<p>
        The data exposed by the transaction and locking tables
        (<code class="literal">INFORMATION_SCHEMA</code>
        <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> table, Performance
        Schema <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> and
        <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> tables) represents
        a glimpse into fast-changing data. This is not like user tables,
        where the data changes only when application-initiated updates
        occur. The underlying data is internal system-managed data, and
        can change very quickly:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Data might not be consistent between the
            <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>,
            <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a>, and
            <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> tables.
          </p><p>
            The <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> and
            <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> tables expose
            live data from the <code class="literal">InnoDB</code> storage engine,
            to provide lock inormation about the transactions in the
            <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> table. Data
            retrieved from the lock tables exists when the
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> is executed, but might
            be gone or changed by the time the query result is consumed
            by the client.
          </p><p>
            Joining <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> with
            <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> can show rows
            in <a class="link" href="performance-schema.html#data-lock-waits-table" title="26.12.12.2 The data_lock_waits Table"><code class="literal">data_lock_waits</code></a> that
            identify a parent row in
            <a class="link" href="performance-schema.html#data-locks-table" title="26.12.12.1 The data_locks Table"><code class="literal">data_locks</code></a> that no longer
            exists or does not exist yet.
          </p></li><li class="listitem"><p>
            Data in the transaction and locking tables might not be
            consistent with data in the
            <code class="literal">INFORMATION_SCHEMA</code>
            <a class="link" href="information-schema.html#processlist-table" title="25.19 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> table or
            Performance Schema <a class="link" href="performance-schema.html#threads-table" title="26.12.17.5 The threads Table"><code class="literal">threads</code></a>
            table.
          </p><p>
            For example, you should be careful when comparing data in
            the <code class="literal">InnoDB</code> transaction and locking tables
            with data in the <a class="link" href="information-schema.html#processlist-table" title="25.19 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a>
            table. Even if you issue a single <code class="literal">SELECT</code>
            (joining <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> and
            <a class="link" href="information-schema.html#processlist-table" title="25.19 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a>, for example), the
            content of those tables is generally not consistent. It is
            possible for <a class="link" href="information-schema.html#innodb-trx-table" title="25.39.29 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> to
            reference rows that are not present in
            <a class="link" href="information-schema.html#processlist-table" title="25.19 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> or for the
            currently executing SQL query of a transaction shown in
            <code class="literal">INNODB_TRX.TRX_QUERY</code> to differ from the
            one in <code class="literal">PROCESSLIST.INFO</code>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-system-tables"></a>15.14.3 InnoDB INFORMATION_SCHEMA Schema Object Tables</h3>

</div>

</div>

</div>
<p>
      You can extract metadata about schema objects managed by
      <code class="literal">InnoDB</code> using <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> tables. This information
      comes from the data dictionary. Traditionally, you would get this
      type of information using the techniques from
      <a class="xref" href="innodb-storage-engine.html#innodb-monitors" title="15.16 InnoDB Monitors">Section 15.16, “InnoDB Monitors”</a>, setting up
      <code class="literal">InnoDB</code> monitors and parsing the output from the
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> statement. The <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> table interface allows you
      to query this data using SQL.
    </p><p>
      <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
      schema object tables include the tables listed below.
    </p><pre data-lang="none" class="programlisting">
INNODB_DATAFILES
INNODB_TABLESTATS
INNODB_FOREIGN
INNODB_COLUMNS
INNODB_INDEXES
INNODB_FIELDS
INNODB_TABLESPACES
INNODB_TABLESPACES_BRIEF
INNODB_FOREIGN_COLS
INNODB_TABLES
</pre><p>
      The table names are indicative of the type of data provided:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-tables-table" title="25.39.24 The INFORMATION_SCHEMA INNODB_TABLES Table"><code class="literal">INNODB_TABLES</code></a> provides metadata
          about <code class="literal">InnoDB</code> tables.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-columns-table" title="25.39.8 The INFORMATION_SCHEMA INNODB_COLUMNS Table"><code class="literal">INNODB_COLUMNS</code></a> provides metadata
          about <code class="literal">InnoDB</code> table columns.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-indexes-table" title="25.39.19 The INFORMATION_SCHEMA INNODB_INDEXES Table"><code class="literal">INNODB_INDEXES</code></a> provides metadata
          about <code class="literal">InnoDB</code> indexes.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-fields-table" title="25.39.10 The INFORMATION_SCHEMA INNODB_FIELDS Table"><code class="literal">INNODB_FIELDS</code></a> provides metadata
          about the key columns (fields) of <code class="literal">InnoDB</code>
          indexes.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-tablestats-table" title="25.39.27 The INFORMATION_SCHEMA INNODB_TABLESTATS View"><code class="literal">INNODB_TABLESTATS</code></a> provides a view
          of low-level status information about
          <code class="literal">InnoDB</code> tables that is derived from
          in-memory data structures.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-datafiles-table" title="25.39.9 The INFORMATION_SCHEMA INNODB_DATAFILES Table"><code class="literal">INNODB_DATAFILES</code></a> provides data
          file path information for <code class="literal">InnoDB</code>
          file-per-table and general tablespaces.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INNODB_TABLESPACES</code></a> provides
          metadata about <code class="literal">InnoDB</code> file-per-table,
          general, and undo tablespaces.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-tablespaces-brief-table" title="25.39.26 The INFORMATION_SCHEMA INNODB_TABLESPACES_BRIEF Table"><code class="literal">INNODB_TABLESPACES_BRIEF</code></a> provides
          a subset of metadata about <code class="literal">InnoDB</code>
          tablespaces.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-foreign-table" title="25.39.11 The INFORMATION_SCHEMA INNODB_FOREIGN Table"><code class="literal">INNODB_FOREIGN</code></a> provides metadata
          about foreign keys defined on <code class="literal">InnoDB</code>
          tables.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-foreign-cols-table" title="25.39.12 The INFORMATION_SCHEMA INNODB_FOREIGN_COLS Table"><code class="literal">INNODB_FOREIGN_COLS</code></a> provides
          metadata about the columns of foreign keys that are defined on
          <code class="literal">InnoDB</code> tables.
</p></li></ul>
</div>
<p>
      <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
      schema object tables can be joined together through fields such as
      <code class="literal">TABLE_ID</code>, <code class="literal">INDEX_ID</code>, and
      <code class="literal">SPACE</code>, allowing you to easily retrieve all
      available data for an object you want to study or monitor.
    </p><p>
      Refer to the <code class="literal">InnoDB</code>
      <a class="link" href="information-schema.html#innodb-i_s-tables" title="25.39 INFORMATION_SCHEMA InnoDB Tables">INFORMATION_SCHEMA</a>
      documentation for information about the columns of each table.
</p>
<div class="example">
<a name="innodb-information-schema-system-tables-example"></a><p class="title"><b>Example 15.2 InnoDB INFORMATION_SCHEMA Schema Object Tables</b></p>
<div class="example-contents">
<p>
        This example uses a simple table (<code class="literal">t1</code>) with a
        single index (<code class="literal">i1</code>) to demonstrate the type of
        metadata found in the <code class="literal">InnoDB</code>
        <code class="literal">INFORMATION_SCHEMA</code> schema object tables.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create a test database and table <code class="literal">t1</code>:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE DATABASE test;</code></strong>

mysql&gt; <strong class="userinput"><code>USE test;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (</code></strong>
       <strong class="userinput"><code>col1 INT,</code></strong>
       <strong class="userinput"><code>col2 CHAR(10),</code></strong>
       <strong class="userinput"><code>col3 VARCHAR(10))</code></strong>
       <strong class="userinput"><code>ENGINE = InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE INDEX i1 ON t1(col1);</code></strong>
</pre></li><li class="listitem"><p>
            After creating the table <code class="literal">t1</code>, query
            <a class="link" href="information-schema.html#innodb-tables-table" title="25.39.24 The INFORMATION_SCHEMA INNODB_TABLES Table"><code class="literal">INNODB_TABLES</code></a> to locate the
            metadata for <code class="literal">test/t1</code>:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME='test/t1' \G</code></strong>
*************************** 1. row ***************************
     TABLE_ID: 71
         NAME: test/t1
         FLAG: 1
       N_COLS: 6
        SPACE: 57
   ROW_FORMAT: Compact
ZIP_PAGE_SIZE: 0
 INSTANT_COLS: 0
</pre><p>
            Table <code class="literal">t1</code> has a
            <code class="literal">TABLE_ID</code> of 71. The
            <code class="literal">FLAG</code> field provides bit level information
            about table format and storage characteristics. There are
            six columns, three of which are hidden columns created by
            <code class="literal">InnoDB</code> (<code class="literal">DB_ROW_ID</code>,
            <code class="literal">DB_TRX_ID</code>, and
            <code class="literal">DB_ROLL_PTR</code>). The ID of the table's
            <code class="literal">SPACE</code> is 57 (a value of 0 would indicate
            that the table resides in the system tablespace). The
            <code class="literal">ROW_FORMAT</code> is Compact.
            <code class="literal">ZIP_PAGE_SIZE</code> only applies to tables with
            a <code class="literal">Compressed</code> row format.
            <code class="literal">INSTANT_COLS</code> shows number of columns in
            the table prior to adding the first instant column using
            <code class="literal">ALTER TABLE ... ADD
            COLUMN</code> with <code class="literal">ALGORITHM=INSTANT</code>.
          </p></li><li class="listitem"><p>
            Using the <code class="literal">TABLE_ID</code> information from
            <a class="link" href="information-schema.html#innodb-tables-table" title="25.39.24 The INFORMATION_SCHEMA INNODB_TABLES Table"><code class="literal">INNODB_TABLES</code></a>, query the
            <a class="link" href="information-schema.html#innodb-columns-table" title="25.39.8 The INFORMATION_SCHEMA INNODB_COLUMNS Table"><code class="literal">INNODB_COLUMNS</code></a> table for
            information about the table's columns.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_COLUMNS where TABLE_ID = 71\G</code></strong>
*************************** 1. row ***************************
     TABLE_ID: 71
         NAME: col1
          POS: 0
        MTYPE: 6
       PRTYPE: 1027
          LEN: 4
  HAS_DEFAULT: 0
DEFAULT_VALUE: NULL
*************************** 2. row ***************************
     TABLE_ID: 71
         NAME: col2
          POS: 1
        MTYPE: 2
       PRTYPE: 524542
          LEN: 10
  HAS_DEFAULT: 0
DEFAULT_VALUE: NULL
*************************** 3. row ***************************
     TABLE_ID: 71
         NAME: col3
          POS: 2
        MTYPE: 1
       PRTYPE: 524303
          LEN: 10
  HAS_DEFAULT: 0
DEFAULT_VALUE: NULL
</pre><p>
            In addition to the <code class="literal">TABLE_ID</code> and column
            <code class="literal">NAME</code>,
            <a class="link" href="information-schema.html#innodb-columns-table" title="25.39.8 The INFORMATION_SCHEMA INNODB_COLUMNS Table"><code class="literal">INNODB_COLUMNS</code></a> provides the
            ordinal position (<code class="literal">POS</code>) of each column
            (starting from 0 and incrementing sequentially), the column
            <code class="literal">MTYPE</code> or <span class="quote">“<span class="quote">main type</span>”</span> (6 =
            INT, 2 = CHAR, 1 = VARCHAR), the <code class="literal">PRTYPE</code>
            or <span class="quote">“<span class="quote">precise type</span>”</span> (a binary value with bits
            that represent the MySQL data type, character set code, and
            nullability), and the column length
            (<code class="literal">LEN</code>). The <code class="literal">HAS_DEFAULT</code>
            and <code class="literal">DEFAULT_VALUE</code> columns only apply to
            columns added instantly using
            <code class="literal">ALTER TABLE ... ADD
            COLUMN</code> with <code class="literal">ALGORITHM=INSTANT</code>.
          </p></li><li class="listitem"><p>
            Using the <code class="literal">TABLE_ID</code> information from
            <a class="link" href="information-schema.html#innodb-tables-table" title="25.39.24 The INFORMATION_SCHEMA INNODB_TABLES Table"><code class="literal">INNODB_TABLES</code></a> once again, query
            <a class="link" href="information-schema.html#innodb-indexes-table" title="25.39.19 The INFORMATION_SCHEMA INNODB_INDEXES Table"><code class="literal">INNODB_INDEXES</code></a> for information
            about the indexes associated with table
            <code class="literal">t1</code>.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_INDEXES WHERE TABLE_ID = 71 \G</code></strong>
*************************** 1. row ***************************
       INDEX_ID: 111
           NAME: GEN_CLUST_INDEX
       TABLE_ID: 71
           TYPE: 1
       N_FIELDS: 0
        PAGE_NO: 3
          SPACE: 57
MERGE_THRESHOLD: 50
*************************** 2. row ***************************
       INDEX_ID: 112
           NAME: i1
       TABLE_ID: 71
           TYPE: 0
       N_FIELDS: 1
        PAGE_NO: 4
          SPACE: 57
MERGE_THRESHOLD: 50
</pre><p>
            <a class="link" href="information-schema.html#innodb-indexes-table" title="25.39.19 The INFORMATION_SCHEMA INNODB_INDEXES Table"><code class="literal">INNODB_INDEXES</code></a> returns data for
            two indexes. The first index is
            <code class="literal">GEN_CLUST_INDEX</code>, which is a clustered
            index created by <code class="literal">InnoDB</code> if the table does
            not have a user-defined clustered index. The second index
            (<code class="literal">i1</code>) is the user-defined secondary index.
          </p><p>
            The <code class="literal">INDEX_ID</code> is an identifier for the
            index that is unique across all databases in an instance.
            The <code class="literal">TABLE_ID</code> identifies the table that
            the index is associated with. The index
            <code class="literal">TYPE</code> value indicates the type of index (1
            = Clustered Index, 0 = Secondary index). The
            <code class="literal">N_FILEDS</code> value is the number of fields
            that comprise the index. <code class="literal">PAGE_NO</code> is the
            root page number of the index B-tree, and
            <code class="literal">SPACE</code> is the ID of the tablespace where
            the index resides. A nonzero value indicates that the index
            does not reside in the system tablespace.
            <code class="literal">MERGE_THRESHOLD</code> defines a percentage
            threshold value for the amount of data in an index page. If
            the amount of data in an index page falls below the this
            value (the default is 50%) when a row is deleted or when a
            row is shortened by an update operation,
            <code class="literal">InnoDB</code> attempts to merge the index page
            with a neighboring index page.
          </p></li><li class="listitem"><p>
            Using the <code class="literal">INDEX_ID</code> information from
            <a class="link" href="information-schema.html#innodb-indexes-table" title="25.39.19 The INFORMATION_SCHEMA INNODB_INDEXES Table"><code class="literal">INNODB_INDEXES</code></a>, query
            <a class="link" href="information-schema.html#innodb-fields-table" title="25.39.10 The INFORMATION_SCHEMA INNODB_FIELDS Table"><code class="literal">INNODB_FIELDS</code></a> for information
            about the fields of index <code class="literal">i1</code>.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_FIELDS where INDEX_ID = 112 \G</code></strong>
*************************** 1. row ***************************
INDEX_ID: 112
    NAME: col1
     POS: 0
</pre><p>
            <a class="link" href="information-schema.html#innodb-fields-table" title="25.39.10 The INFORMATION_SCHEMA INNODB_FIELDS Table"><code class="literal">INNODB_FIELDS</code></a> provides the
            <code class="literal">NAME</code> of the indexed field and its ordinal
            position within the index. If the index (i1) had been
            defined on multiple fields,
            <a class="link" href="information-schema.html#innodb-fields-table" title="25.39.10 The INFORMATION_SCHEMA INNODB_FIELDS Table"><code class="literal">INNODB_FIELDS</code></a> would provide
            metadata for each of the indexed fields.
          </p></li><li class="listitem"><p>
            Using the <code class="literal">SPACE</code> information from
            <a class="link" href="information-schema.html#innodb-tables-table" title="25.39.24 The INFORMATION_SCHEMA INNODB_TABLES Table"><code class="literal">INNODB_TABLES</code></a>, query
            <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INNODB_TABLESPACES</code></a> table for
            information about the table's tablespace.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_TABLESPACES WHERE SPACE = 57 \G</code></strong>
*************************** 1. row ***************************
          SPACE: 57
          NAME: test/t1
          FLAG: 16417
    ROW_FORMAT: Dynamic
     PAGE_SIZE: 16384
 ZIP_PAGE_SIZE: 0
    SPACE_TYPE: Single
 FS_BLOCK_SIZE: 4096
     FILE_SIZE: 114688
ALLOCATED_SIZE: 98304
SERVER_VERSION: 8.0.4
 SPACE_VERSION: 1
    ENCRYPTION: N
</pre><p>
            In addition to the <code class="literal">SPACE</code> ID of the
            tablespace and the <code class="literal">NAME</code> of the associated
            table, <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INNODB_TABLESPACES</code></a>
            provides tablespace <code class="literal">FLAG</code> data, which is
            bit level information about tablespace format and storage
            characteristics. Also provided are tablespace
            <code class="literal">ROW_FORMAT</code>, <code class="literal">PAGE_SIZE</code>,
            and several other tablespace metadata items.
          </p></li><li class="listitem"><p>
            Using the <code class="literal">SPACE</code> information from
            <a class="link" href="information-schema.html#innodb-tables-table" title="25.39.24 The INFORMATION_SCHEMA INNODB_TABLES Table"><code class="literal">INNODB_TABLES</code></a> once again, query
            <a class="link" href="information-schema.html#innodb-datafiles-table" title="25.39.9 The INFORMATION_SCHEMA INNODB_DATAFILES Table"><code class="literal">INNODB_DATAFILES</code></a> for the
            location of the tablespace data file.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_DATAFILES WHERE SPACE = 57 \G</code></strong>
*************************** 1. row ***************************
SPACE: 57
 PATH: ./test/t1.ibd
</pre><p>
            The datafile is located in the <code class="literal">test</code>
            directory under MySQL's <code class="literal">data</code> directory.
            If a
            <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
            tablespace were created in a location outside the MySQL data
            directory using the <code class="literal">DATA DIRECTORY</code> clause
            of the <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
            statement, the tablespace <code class="literal">PATH</code> would be a
            fully qualified directory path.
          </p></li><li class="listitem"><p>
            As a final step, insert a row into table
            <code class="literal">t1</code> (<code class="literal">TABLE_ID = 71</code>) and
            view the data in the
            <a class="link" href="information-schema.html#innodb-tablestats-table" title="25.39.27 The INFORMATION_SCHEMA INNODB_TABLESTATS View"><code class="literal">INNODB_TABLESTATS</code></a> table. The
            data in this table is used by the MySQL optimizer to
            calculate which index to use when querying an
            <code class="literal">InnoDB</code> table. This information is derived
            from in-memory data structures.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>INSERT INTO t1 VALUES(5, 'abc', 'def');</code></strong>
Query OK, 1 row affected (0.06 sec)

mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_TABLESTATS where TABLE_ID = 71 \G</code></strong>
*************************** 1. row ***************************
         TABLE_ID: 71
             NAME: test/t1
STATS_INITIALIZED: Initialized
         NUM_ROWS: 1
 CLUST_INDEX_SIZE: 1
 OTHER_INDEX_SIZE: 0
 MODIFIED_COUNTER: 1
          AUTOINC: 0
        REF_COUNT: 1
</pre><p>
            The <code class="literal">STATS_INITIALIZED</code> field indicates
            whether or not statistics have been collected for the table.
            <code class="literal">NUM_ROWS</code> is the current estimated number
            of rows in the table. The
            <code class="literal">CLUST_INDEX_SIZE</code> and
            <code class="literal">OTHER_INDEX_SIZE</code> fields report the number
            of pages on disk that store clustered and secondary indexes
            for the table, respectively. The
            <code class="literal">MODIFIED_COUNTER</code> value shows the number
            of rows modified by DML operations and cascade operations
            from foreign keys. The <code class="literal">AUTOINC</code> value is
            the next number to be issued for any autoincrement-based
            operation. There are no autoincrement columns defined on
            table <code class="literal">t1</code>, so the value is 0. The
            <code class="literal">REF_COUNT</code> value is a counter. When the
            counter reaches 0, it signifies that the table metadata can
            be evicted from the table cache.
</p></li></ol>
</div>

</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-fk-system-tables-example"></a><p class="title"><b>Example 15.3 Foreign Key INFORMATION_SCHEMA Schema Object Tables</b></p>
<div class="example-contents">
<p>
        The <a class="link" href="information-schema.html#innodb-foreign-table" title="25.39.11 The INFORMATION_SCHEMA INNODB_FOREIGN Table"><code class="literal">INNODB_FOREIGN</code></a> and
        <a class="link" href="information-schema.html#innodb-foreign-cols-table" title="25.39.12 The INFORMATION_SCHEMA INNODB_FOREIGN_COLS Table"><code class="literal">INNODB_FOREIGN_COLS</code></a> tables provide
        data about foreign key relationships. This example uses a parent
        table and child table with a foreign key relationship to
        demonstrate the data found in the
        <a class="link" href="information-schema.html#innodb-foreign-table" title="25.39.11 The INFORMATION_SCHEMA INNODB_FOREIGN Table"><code class="literal">INNODB_FOREIGN</code></a> and
        <a class="link" href="information-schema.html#innodb-foreign-cols-table" title="25.39.12 The INFORMATION_SCHEMA INNODB_FOREIGN_COLS Table"><code class="literal">INNODB_FOREIGN_COLS</code></a> tables.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create the test database with parent and child tables:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE DATABASE test;</code></strong>

mysql&gt; <strong class="userinput"><code>USE test;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE parent (id INT NOT NULL,</code></strong>
       <strong class="userinput"><code>PRIMARY KEY (id)) ENGINE=INNODB;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE child (id INT, parent_id INT,</code></strong>
       <strong class="userinput"><code>INDEX par_ind (parent_id),</code></strong>
       <strong class="userinput"><code>CONSTRAINT fk1</code></strong>
       <strong class="userinput"><code>FOREIGN KEY (parent_id) REFERENCES parent(id)</code></strong>
       <strong class="userinput"><code>ON DELETE CASCADE) ENGINE=INNODB;</code></strong>
</pre></li><li class="listitem"><p>
            After the parent and child tables are created, query
            <a class="link" href="information-schema.html#innodb-foreign-table" title="25.39.11 The INFORMATION_SCHEMA INNODB_FOREIGN Table"><code class="literal">INNODB_FOREIGN</code></a> and locate the
            foreign key data for the <code class="literal">test/child</code> and
            <code class="literal">test/parent</code> foreign key relationship:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_FOREIGN \G</code></strong>
*************************** 1. row ***************************
      ID: test/fk1
FOR_NAME: test/child
REF_NAME: test/parent
  N_COLS: 1
    TYPE: 1
</pre><p>
            Metadata includes the foreign key <code class="literal">ID</code>
            (<code class="literal">fk1</code>), which is named for the
            <code class="literal">CONSTRAINT</code> that was defined on the child
            table. The <code class="literal">FOR_NAME</code> is the name of the
            child table where the foreign key is defined.
            <code class="literal">REF_NAME</code> is the name of the parent table
            (the <span class="quote">“<span class="quote">referenced</span>”</span> table).
            <code class="literal">N_COLS</code> is the number of columns in the
            foreign key index. <code class="literal">TYPE</code> is a numerical
            value representing bit flags that provide additional
            information about the foreign key column. In this case, the
            <code class="literal">TYPE</code> value is 1, which indicates that the
            <code class="literal">ON DELETE CASCADE</code> option was specified
            for the foreign key. See the
            <a class="link" href="information-schema.html#innodb-foreign-table" title="25.39.11 The INFORMATION_SCHEMA INNODB_FOREIGN Table"><code class="literal">INNODB_FOREIGN</code></a> table definition
            for more information about <code class="literal">TYPE</code> values.
          </p></li><li class="listitem"><p>
            Using the foreign key <code class="literal">ID</code>, query
            <a class="link" href="information-schema.html#innodb-foreign-cols-table" title="25.39.12 The INFORMATION_SCHEMA INNODB_FOREIGN_COLS Table"><code class="literal">INNODB_FOREIGN_COLS</code></a> to view
            data about the columns of the foreign key.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_FOREIGN_COLS WHERE ID = 'test/fk1' \G</code></strong>
*************************** 1. row ***************************
          ID: test/fk1
FOR_COL_NAME: parent_id
REF_COL_NAME: id
         POS: 0
</pre><p>
            <code class="literal">FOR_COL_NAME</code> is the name of the foreign
            key column in the child table, and
            <code class="literal">REF_COL_NAME</code> is the name of the
            referenced column in the parent table. The
            <code class="literal">POS</code> value is the ordinal position of the
            key field within the foreign key index, starting at zero.
</p></li></ol>
</div>

</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-system-tables-join-example"></a><p class="title"><b>Example 15.4 Joining InnoDB INFORMATION_SCHEMA Schema Object Tables</b></p>
<div class="example-contents">
<p>
        This example demonstrates joining three
        <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
        schema object tables
        (<a class="link" href="information-schema.html#innodb-tables-table" title="25.39.24 The INFORMATION_SCHEMA INNODB_TABLES Table"><code class="literal">INNODB_TABLES</code></a>,
        <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INNODB_TABLESPACES</code></a>, and
        <a class="link" href="information-schema.html#innodb-tablestats-table" title="25.39.27 The INFORMATION_SCHEMA INNODB_TABLESTATS View"><code class="literal">INNODB_TABLESTATS</code></a>) to gather file
        format, row format, page size, and index size information about
        tables in the employees sample database.
      </p><p>
        The following table name aliases are used to shorten the query
        string:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-tables-table" title="25.39.24 The INFORMATION_SCHEMA INNODB_TABLES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TABLES</code></a>:
            a
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TABLESPACES</code></a>:
            b
          </p></li><li class="listitem"><p>
            <a class="link" href="information-schema.html#innodb-tablestats-table" title="25.39.27 The INFORMATION_SCHEMA INNODB_TABLESTATS View"><code class="literal">INFORMATION_SCHEMA.INNODB_TABLESTATS</code></a>:
            c
</p></li></ul>
</div>
<p>
        An <a class="link" href="functions.html#function_if"><code class="literal">IF()</code></a> control flow function is
        used to account for compressed tables. If a table is compressed,
        the index size is calculated using
        <code class="literal">ZIP_PAGE_SIZE</code> rather than
        <code class="literal">PAGE_SIZE</code>.
        <code class="literal">CLUST_INDEX_SIZE</code> and
        <code class="literal">OTHER_INDEX_SIZE</code>, which are reported in
        bytes, are divided by <code class="literal">1024*1024</code> to provide
        index sizes in megabytes (MBs). MB values are rounded to zero
        decimal spaces using the <a class="link" href="functions.html#function_round"><code class="literal">ROUND()</code></a>
        function.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT a.NAME, a.ROW_FORMAT,</code></strong>
        <strong class="userinput"><code>@page_size :=</code></strong>
         <strong class="userinput"><code>IF(a.ROW_FORMAT='Compressed',</code></strong>
          <strong class="userinput"><code>b.ZIP_PAGE_SIZE, b.PAGE_SIZE)</code></strong>
          <strong class="userinput"><code>AS page_size,</code></strong>
         <strong class="userinput"><code>ROUND((@page_size * c.CLUST_INDEX_SIZE)</code></strong>
          <strong class="userinput"><code>/(1024*1024)) AS pk_mb,</code></strong>
         <strong class="userinput"><code>ROUND((@page_size * c.OTHER_INDEX_SIZE)</code></strong>
          <strong class="userinput"><code>/(1024*1024)) AS secidx_mb</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.INNODB_TABLES a</code></strong>
       <strong class="userinput"><code>INNER JOIN INFORMATION_SCHEMA.INNODB_TABLESPACES b on a.NAME = b.NAME</code></strong>
       <strong class="userinput"><code>INNER JOIN INFORMATION_SCHEMA.INNODB_TABLESTATS c on b.NAME = c.NAME</code></strong>
       <strong class="userinput"><code>WHERE a.NAME LIKE 'employees/%'</code></strong>
       <strong class="userinput"><code>ORDER BY a.NAME DESC;</code></strong>
+------------------------+------------+-----------+-------+-----------+
| NAME                   | ROW_FORMAT | page_size | pk_mb | secidx_mb |
+------------------------+------------+-----------+-------+-----------+
| employees/titles       | Dynamic    |     16384 |    20 |        11 |
| employees/salaries     | Dynamic    |     16384 |    93 |        34 |
| employees/employees    | Dynamic    |     16384 |    15 |         0 |
| employees/dept_manager | Dynamic    |     16384 |     0 |         0 |
| employees/dept_emp     | Dynamic    |     16384 |    12 |        10 |
| employees/departments  | Dynamic    |     16384 |     0 |         0 |
+------------------------+------------+-----------+-------+-----------+
</pre>
</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-fulltext_index-tables"></a>15.14.4 InnoDB INFORMATION_SCHEMA FULLTEXT Index Tables</h3>

</div>

</div>

</div>
<p>
      The following tables provide metadata for
      <code class="literal">FULLTEXT</code> indexes:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW TABLES FROM INFORMATION_SCHEMA LIKE 'INNODB_FT%';</code></strong>
+-------------------------------------------+
| Tables_in_INFORMATION_SCHEMA (INNODB_FT%) |
+-------------------------------------------+
| INNODB_FT_CONFIG                          |
| INNODB_FT_BEING_DELETED                   |
| INNODB_FT_DELETED                         |
| INNODB_FT_DEFAULT_STOPWORD                |
| INNODB_FT_INDEX_TABLE                     |
| INNODB_FT_INDEX_CACHE                     |
+-------------------------------------------+
</pre>
<div class="itemizedlist">
<h4><a name="idm140091634491824"></a>Table Overview</h4>
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-config-table" title="25.39.14 The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INNODB_FT_CONFIG</code></a>: Provides
          metadata about the <code class="literal">FULLTEXT</code> index and
          associated processing for an <code class="literal">InnoDB</code> table.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="25.39.13 The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a>: Provides
          a snapshot of the
          <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="25.39.16 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a> table; it is
          used only during an <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a> maintenance operation. When
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> is run, the
          <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="25.39.13 The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a> table is
          emptied, and <code class="literal">DOC_ID</code> values are removed from
          the <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="25.39.16 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a> table.
          Because the contents of
          <a class="link" href="information-schema.html#innodb-ft-being-deleted-table" title="25.39.13 The INFORMATION_SCHEMA INNODB_FT_BEING_DELETED Table"><code class="literal">INNODB_FT_BEING_DELETED</code></a> typically
          have a short lifetime, this table has limited utility for
          monitoring or debugging. For information about running
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> on tables with
          <code class="literal">FULLTEXT</code> indexes, see
          <a class="xref" href="functions.html#fulltext-fine-tuning" title="12.9.6 Fine-Tuning MySQL Full-Text Search">Section 12.9.6, “Fine-Tuning MySQL Full-Text Search”</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="25.39.16 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a>: Stores rows
          that are deleted from the <code class="literal">FULLTEXT</code> index
          for an <code class="literal">InnoDB</code> table. To avoid expensive
          index reorganization during DML operations for an
          <code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code> index,
          the information about newly deleted words is stored
          separately, filtered out of search results when you do a text
          search, and removed from the main search index only when you
          issue an <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>
          statement for the <code class="literal">InnoDB</code> table.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="25.39.15 The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a>: Holds
          a list of <a class="link" href="glossary.html#glos_stopword" title="stopword">stopwords</a> that
          are used by default when creating a
          <code class="literal">FULLTEXT</code> index on <code class="literal">InnoDB</code>
          tables.
        </p><p>
          For information about the
          <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="25.39.15 The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a> table,
          see <a class="xref" href="functions.html#fulltext-stopwords" title="12.9.4 Full-Text Stopwords">Section 12.9.4, “Full-Text Stopwords”</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-index-table-table" title="25.39.18 The INFORMATION_SCHEMA INNODB_FT_INDEX_TABLE Table"><code class="literal">INNODB_FT_INDEX_TABLE</code></a>: Provides
          information about the inverted index used to process text
          searches against the <code class="literal">FULLTEXT</code> index of an
          <code class="literal">InnoDB</code> table.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="25.39.17 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a>: Provides
          token information about newly inserted rows in a
          <code class="literal">FULLTEXT</code> index. To avoid expensive index
          reorganization during DML operations, the information about
          newly indexed words is stored separately, and combined with
          the main search index only when <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a> is run, when the server is shut down, or when
          the cache size exceeds a limit defined by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_cache_size"><code class="literal">innodb_ft_cache_size</code></a> or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_total_cache_size"><code class="literal">innodb_ft_total_cache_size</code></a>
          system variable.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        With the exception of the
        <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="25.39.15 The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a> table,
        these tables are empty initially. Before querying any of them,
        set the value of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_aux_table"><code class="literal">innodb_ft_aux_table</code></a> system
        variable to the name (including the database name) of the table
        that contains the <code class="literal">FULLTEXT</code> index (for
        example, <code class="literal">test/articles</code>).
</p>
</div>

<div class="example">
<a name="innodb-information-schema-fulltext-tables-example"></a><p class="title"><b>Example 15.5 InnoDB FULLTEXT Index INFORMATION_SCHEMA Tables</b></p>
<div class="example-contents">
<p>
        This example uses a table with a <code class="literal">FULLTEXT</code>
        index to demonstrate the data contained in the
        <code class="literal">FULLTEXT</code> index
        <code class="literal">INFORMATION_SCHEMA</code> tables.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create a table with a <code class="literal">FULLTEXT</code> index and
            insert some data:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE articles (</code></strong>
         <strong class="userinput"><code>id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,</code></strong>
         <strong class="userinput"><code>title VARCHAR(200),</code></strong>
         <strong class="userinput"><code>body TEXT,</code></strong>
         <strong class="userinput"><code>FULLTEXT (title,body)</code></strong>
       <strong class="userinput"><code>) ENGINE=InnoDB;</code></strong>

mysql&gt; <strong class="userinput"><code>INSERT INTO articles (title,body) VALUES</code></strong>
       <strong class="userinput"><code>('MySQL Tutorial','DBMS stands for DataBase ...'),</code></strong>
       <strong class="userinput"><code>('How To Use MySQL Well','After you went through a ...'),</code></strong>
       <strong class="userinput"><code>('Optimizing MySQL','In this tutorial we will show ...'),</code></strong>
       <strong class="userinput"><code>('1001 MySQL Tricks','1. Never run mysqld as root. 2. ...'),</code></strong>
       <strong class="userinput"><code>('MySQL vs. YourSQL','In the following database comparison ...'),</code></strong>
       <strong class="userinput"><code>('MySQL Security','When configured properly, MySQL ...');</code></strong>
</pre></li><li class="listitem"><p>
            Set the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_ft_aux_table"><code class="literal">innodb_ft_aux_table</code></a>
            variable to the name of the table with the
            <code class="literal">FULLTEXT</code> index. If this variable is not
            set, the <code class="literal">InnoDB</code>
            <code class="literal">FULLTEXT</code>
            <code class="literal">INFORMATION_SCHEMA</code> tables are empty, with
            the exception of
            <a class="link" href="information-schema.html#innodb-ft-default-stopword-table" title="25.39.15 The INFORMATION_SCHEMA INNODB_FT_DEFAULT_STOPWORD Table"><code class="literal">INNODB_FT_DEFAULT_STOPWORD</code></a>.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_ft_aux_table = 'test/articles';</code></strong>
</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="25.39.17 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a>
            table, which shows information about newly inserted rows in
            a <code class="literal">FULLTEXT</code> index. To avoid expensive
            index reorganization during DML operations, data for newly
            inserted rows remains in the <code class="literal">FULLTEXT</code>
            index cache until <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
            TABLE</code></a> is run (or until the server is shut down or
            cache limits are exceeded).
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_INDEX_CACHE LIMIT 5;</code></strong>
+------------+--------------+-------------+-----------+--------+----------+
| WORD       | FIRST_DOC_ID | LAST_DOC_ID | DOC_COUNT | DOC_ID | POSITION |
+------------+--------------+-------------+-----------+--------+----------+
| 1001       |            5 |           5 |         1 |      5 |        0 |
| after      |            3 |           3 |         1 |      3 |       22 |
| comparison |            6 |           6 |         1 |      6 |       44 |
| configured |            7 |           7 |         1 |      7 |       20 |
| database   |            2 |           6 |         2 |      2 |       31 |
+------------+--------------+-------------+-----------+--------+----------+
</pre></li><li class="listitem"><p>
            Enable the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_fulltext_only"><code class="literal">innodb_optimize_fulltext_only</code></a>
            system variable and run <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
            TABLE</code></a> on the table that contains the
            <code class="literal">FULLTEXT</code> index. This operation flushes
            the contents of the <code class="literal">FULLTEXT</code> index cache
            to the main <code class="literal">FULLTEXT</code> index.
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_fulltext_only"><code class="literal">innodb_optimize_fulltext_only</code></a>
            changes the way the <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
            TABLE</code></a> statement operates on
            <code class="literal">InnoDB</code> tables, and is intended to be
            enabled temporarily, during maintenance operations on
            <code class="literal">InnoDB</code> tables with
            <code class="literal">FULLTEXT</code> indexes.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_optimize_fulltext_only=ON;</code></strong>

mysql&gt; <strong class="userinput"><code>OPTIMIZE TABLE articles;</code></strong>
+---------------+----------+----------+----------+
| Table         | Op       | Msg_type | Msg_text |
+---------------+----------+----------+----------+
| test.articles | optimize | status   | OK       |
+---------------+----------+----------+----------+
</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-ft-index-table-table" title="25.39.18 The INFORMATION_SCHEMA INNODB_FT_INDEX_TABLE Table"><code class="literal">INNODB_FT_INDEX_TABLE</code></a>
            table to view information about data in the main
            <code class="literal">FULLTEXT</code> index, including information
            about the data that was just flushed from the
            <code class="literal">FULLTEXT</code> index cache.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_INDEX_TABLE LIMIT 5;</code></strong>
+------------+--------------+-------------+-----------+--------+----------+
| WORD       | FIRST_DOC_ID | LAST_DOC_ID | DOC_COUNT | DOC_ID | POSITION |
+------------+--------------+-------------+-----------+--------+----------+
| 1001       |            5 |           5 |         1 |      5 |        0 |
| after      |            3 |           3 |         1 |      3 |       22 |
| comparison |            6 |           6 |         1 |      6 |       44 |
| configured |            7 |           7 |         1 |      7 |       20 |
| database   |            2 |           6 |         2 |      2 |       31 |
+------------+--------------+-------------+-----------+--------+----------+
</pre><p>
            The <a class="link" href="information-schema.html#innodb-ft-index-cache-table" title="25.39.17 The INFORMATION_SCHEMA INNODB_FT_INDEX_CACHE Table"><code class="literal">INNODB_FT_INDEX_CACHE</code></a> table
            is now empty since the <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
            TABLE</code></a> operation flushed the
            <code class="literal">FULLTEXT</code> index cache.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_INDEX_CACHE LIMIT 5;</code></strong>
Empty set (0.00 sec)
</pre></li><li class="listitem"><p>
            Delete some records from the
            <code class="literal">test/articles</code> table.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>DELETE FROM test.articles WHERE id &lt; 4;</code></strong>
</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="25.39.16 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a>
            table. This table records rows that are deleted from the
            <code class="literal">FULLTEXT</code> index. To avoid expensive index
            reorganization during DML operations, information about
            newly deleted records is stored separately, filtered out of
            search results when you do a text search, and removed from
            the main search index when you run
            <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_DELETED;</code></strong>
+--------+
| DOC_ID |
+--------+
|      2 |
|      3 |
|      4 |
+--------+
</pre></li><li class="listitem"><p>
            Run <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> to remove
            the deleted records.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>OPTIMIZE TABLE articles;</code></strong>
+---------------+----------+----------+----------+
| Table         | Op       | Msg_type | Msg_text |
+---------------+----------+----------+----------+
| test.articles | optimize | status   | OK       |
+---------------+----------+----------+----------+
</pre><p>
            The <a class="link" href="information-schema.html#innodb-ft-deleted-table" title="25.39.16 The INFORMATION_SCHEMA INNODB_FT_DELETED Table"><code class="literal">INNODB_FT_DELETED</code></a> table
            should now be empty.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_DELETED;</code></strong>
Empty set (0.00 sec)
</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-ft-config-table" title="25.39.14 The INFORMATION_SCHEMA INNODB_FT_CONFIG Table"><code class="literal">INNODB_FT_CONFIG</code></a>
            table. This table contains metadata about the
            <code class="literal">FULLTEXT</code> index and related processing:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">optimize_checkpoint_limit</code>: The number
                of seconds after which an <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
                TABLE</code></a> run stops.
              </p></li><li class="listitem"><p>
                <code class="literal">synced_doc_id</code>: The next
                <code class="literal">DOC_ID</code> to be issued.
              </p></li><li class="listitem"><p>
                <code class="literal">stopword_table_name</code>: The
                <em class="replaceable"><code>database/table</code></em> name for a
                user-defined stopword table. The
                <code class="literal">VALUE</code> column is empty if there is no
                user-defined stopword table.
              </p></li><li class="listitem"><p>
                <code class="literal">use_stopword</code>: Indicates whether a
                stopword table is used, which is defined when the
                <code class="literal">FULLTEXT</code> index is created.
</p></li></ul>
</div>
<pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_FT_CONFIG;</code></strong>
+---------------------------+-------+
| KEY                       | VALUE |
+---------------------------+-------+
| optimize_checkpoint_limit | 180   |
| synced_doc_id             | 8     |
| stopword_table_name       |       |
| use_stopword              | 1     |
+---------------------------+-------+
</pre></li><li class="listitem"><p>
            Disable
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_optimize_fulltext_only"><code class="literal">innodb_optimize_fulltext_only</code></a>,
            since it is intended to be enabled only temporarily:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_optimize_fulltext_only=OFF;</code></strong>
</pre></li></ol>
</div>

</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-buffer-pool-tables"></a>15.14.5 InnoDB INFORMATION_SCHEMA Buffer Pool Tables</h3>

</div>

</div>

</div>
<p>
      The <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> buffer pool tables provide
      buffer pool status information and metadata about the pages within
      the <code class="literal">InnoDB</code> buffer pool.
    </p><p>
      The <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> buffer pool tables include
      those listed below:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW TABLES FROM INFORMATION_SCHEMA LIKE 'INNODB_BUFFER%';</code></strong>
+-----------------------------------------------+
| Tables_in_INFORMATION_SCHEMA (INNODB_BUFFER%) |
+-----------------------------------------------+
| INNODB_BUFFER_PAGE_LRU                        |
| INNODB_BUFFER_PAGE                            |
| INNODB_BUFFER_POOL_STATS                      |
+-----------------------------------------------+
</pre>
<h4><a name="idm140091634344528"></a>Table Overview</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-buffer-page-table" title="25.39.1 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a>: Holds
          information about each page in the <code class="literal">InnoDB</code>
          buffer pool.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="25.39.2 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a>: Holds
          information about the pages in the <code class="literal">InnoDB</code>
          buffer pool, in particular how they are ordered in the LRU
          list that determines which pages to evict from the buffer pool
          when it becomes full. The
          <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="25.39.2 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a> table has
          the same columns as the
          <a class="link" href="information-schema.html#innodb-buffer-page-table" title="25.39.1 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a> table, except
          that the <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="25.39.2 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a>
          table has an <code class="literal">LRU_POSITION</code> column instead of
          a <code class="literal">BLOCK_ID</code> column.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-buffer-pool-stats-table" title="25.39.3 The INFORMATION_SCHEMA INNODB_BUFFER_POOL_STATS Table"><code class="literal">INNODB_BUFFER_POOL_STATS</code></a>:
          Provides buffer pool status information. Much of the same
          information is provided by
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> output, or may be obtained using
          <code class="literal">InnoDB</code> buffer pool server status variables.
</p></li></ul>
</div>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p>
        Querying the <a class="link" href="information-schema.html#innodb-buffer-page-table" title="25.39.1 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a> or
        <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="25.39.2 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a> table can
        affect performance. Do not query these tables on a production
        system unless you are aware of the performance impact and have
        determined it to be acceptable. To avoid impacting performance
        on a production system, reproduce the issue you want to
        investigate and query buffer pool statistics on a test instance.
</p>
</div>

<div class="example">
<a name="innodb-information-schema-buffer-pool-system-data-example"></a><p class="title"><b>Example 15.6 Querying System Data in the INNODB_BUFFER_PAGE Table</b></p>
<div class="example-contents">
<p>
        This query provides an approximate count of pages that contain
        system data by excluding pages where the
        <code class="literal">TABLE_NAME</code> value is either
        <code class="literal">NULL</code> or includes a slash <code class="literal">/</code>
        or period <code class="literal">.</code> in the table name, which
        indicates a user-defined table.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></strong>
       <strong class="userinput"><code>WHERE TABLE_NAME IS NULL OR (INSTR(TABLE_NAME, '/') = 0 AND INSTR(TABLE_NAME, '.') = 0);</code></strong>
+----------+
| COUNT(*) |
+----------+
|     1516 |
+----------+
</pre><p>
        This query returns the approximate number of pages that contain
        system data, the total number of buffer pool pages, and an
        approximate percentage of pages that contain system data.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT</code></strong>
       <strong class="userinput"><code>(SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></strong>
       <strong class="userinput"><code>WHERE TABLE_NAME IS NULL OR (INSTR(TABLE_NAME, '/') = 0 AND INSTR(TABLE_NAME, '.') = 0)</code></strong>
       <strong class="userinput"><code>) AS system_pages,</code></strong>
       <strong class="userinput"><code>(</code></strong>
       <strong class="userinput"><code>SELECT COUNT(*)</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></strong>
       <strong class="userinput"><code>) AS total_pages,</code></strong>
       <strong class="userinput"><code>(</code></strong>
       <strong class="userinput"><code>SELECT ROUND((system_pages/total_pages) * 100)</code></strong>
       <strong class="userinput"><code>) AS system_page_percentage;</code></strong>
+--------------+-------------+------------------------+
| system_pages | total_pages | system_page_percentage |
+--------------+-------------+------------------------+
|          295 |        8192 |                      4 |
+--------------+-------------+------------------------+
</pre><p>
        The type of system data in the buffer pool can be determined by
        querying the <code class="literal">PAGE_TYPE</code> value. For example,
        the following query returns eight distinct
        <code class="literal">PAGE_TYPE</code> values among the pages that contain
        system data:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT DISTINCT PAGE_TYPE FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></strong>
       <strong class="userinput"><code>WHERE TABLE_NAME IS NULL OR (INSTR(TABLE_NAME, '/') = 0 AND INSTR(TABLE_NAME, '.') = 0);</code></strong>
+-------------------+
| PAGE_TYPE         |
+-------------------+
| SYSTEM            |
| IBUF_BITMAP       |
| UNKNOWN           |
| FILE_SPACE_HEADER |
| INODE             |
| UNDO_LOG          |
| ALLOCATED         |
+-------------------+
</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-user-data-example"></a><p class="title"><b>Example 15.7 Querying User Data in the INNODB_BUFFER_PAGE Table</b></p>
<div class="example-contents">
<p>
        This query provides an approximate count of pages containing
        user data by counting pages where the
        <code class="literal">TABLE_NAME</code> value is <code class="literal">NOT
        NULL</code> and <code class="literal">NOT LIKE
        '%INNODB_TABLES%'</code>.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></strong>
       <strong class="userinput"><code>WHERE TABLE_NAME IS NOT NULL AND TABLE_NAME NOT LIKE '%INNODB_TABLES%';</code></strong>
+----------+
| COUNT(*) |
+----------+
|     7897 |
+----------+
</pre><p>
        This query returns the approximate number of pages that contain
        user data, the total number of buffer pool pages, and an
        approximate percentage of pages that contain user data.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT</code></strong>
       <strong class="userinput"><code>(SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></strong>
       WHERE TABLE_NAME IS NOT NULL AND (INSTR(TABLE_NAME, '/') &gt; 0 OR INSTR(TABLE_NAME, '.') &gt; 0)
       <strong class="userinput"><code>) AS user_pages,</code></strong>
       <strong class="userinput"><code>(</code></strong>
       <strong class="userinput"><code>SELECT COUNT(*)</code></strong>
       <strong class="userinput"><code>FROM information_schema.INNODB_BUFFER_PAGE</code></strong>
       <strong class="userinput"><code>) AS total_pages,</code></strong>
       <strong class="userinput"><code>(</code></strong>
       <strong class="userinput"><code>SELECT ROUND((user_pages/total_pages) * 100)</code></strong>
       <strong class="userinput"><code>) AS user_page_percentage;</code></strong>
+------------+-------------+----------------------+
| user_pages | total_pages | user_page_percentage |
+------------+-------------+----------------------+
|       7897 |        8192 |                   96 |
+------------+-------------+----------------------+
</pre><p>
        This query identifies user-defined tables with pages in the
        buffer pool:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT DISTINCT TABLE_NAME FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></strong>
       <strong class="userinput"><code>WHERE TABLE_NAME IS NOT NULL AND (INSTR(TABLE_NAME, '/') &gt; 0 OR INSTR(TABLE_NAME, '.') &gt; 0)</code></strong>
       <strong class="userinput"><code>AND TABLE_NAME NOT LIKE '`mysql`.`innodb_%';</code></strong>
+-------------------------+
| TABLE_NAME              |
+-------------------------+
| `employees`.`salaries`  |
| `employees`.`employees` |
+-------------------------+
</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-index-data-example"></a><p class="title"><b>Example 15.8 Querying Index Data in the INNODB_BUFFER_PAGE Table</b></p>
<div class="example-contents">
<p>
        For information about index pages, query the
        <code class="literal">INDEX_NAME</code> column using the name of the
        index. For example, the following query returns the number of
        pages and total data size of pages for the
        <code class="literal">emp_no</code> index that is defined on the
        <code class="literal">employees.salaries</code> table:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT INDEX_NAME, COUNT(*) AS Pages,</code></strong>
<strong class="userinput"><code>ROUND(SUM(IF(COMPRESSED_SIZE = 0, @@GLOBAL.innodb_page_size, COMPRESSED_SIZE))/1024/1024)</code></strong>
<strong class="userinput"><code>AS 'Total Data (MB)'</code></strong>
<strong class="userinput"><code>FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></strong>
<strong class="userinput"><code>WHERE INDEX_NAME='emp_no' AND TABLE_NAME = '`employees`.`salaries`';</code></strong>
+------------+-------+-----------------+
| INDEX_NAME | Pages | Total Data (MB) |
+------------+-------+-----------------+
| emp_no     |  1609 |              25 |
+------------+-------+-----------------+
</pre><p>
        This query returns the number of pages and total data size of
        pages for all indexes defined on the
        <code class="literal">employees.salaries</code> table:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT INDEX_NAME, COUNT(*) AS Pages,</code></strong>
       <strong class="userinput"><code>ROUND(SUM(IF(COMPRESSED_SIZE = 0, @@GLOBAL.innodb_page_size, COMPRESSED_SIZE))/1024/1024)</code></strong>
       <strong class="userinput"><code>AS 'Total Data (MB)'</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE</code></strong>
       <strong class="userinput"><code>WHERE TABLE_NAME = '`employees`.`salaries`'</code></strong>
       <strong class="userinput"><code>GROUP BY INDEX_NAME;</code></strong>
+------------+-------+-----------------+
| INDEX_NAME | Pages | Total Data (MB) |
+------------+-------+-----------------+
| emp_no     |  1608 |              25 |
| PRIMARY    |  6086 |              95 |
+------------+-------+-----------------+
</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-lru-position-example"></a><p class="title"><b>Example 15.9 Querying LRU_POSITION Data in the INNODB_BUFFER_PAGE_LRU Table</b></p>
<div class="example-contents">
<p>
        The <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="25.39.2 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a> table
        holds information about the pages in the
        <code class="literal">InnoDB</code> buffer pool, in particular how they
        are ordered that determines which pages to evict from the buffer
        pool when it becomes full. The definition for this page is the
        same as for <a class="link" href="information-schema.html#innodb-buffer-page-table" title="25.39.1 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a>,
        except this table has an <code class="literal">LRU_POSITION</code> column
        instead of a <code class="literal">BLOCK_ID</code> column.
      </p><p>
        This query counts the number of positions at a specific location
        in the LRU list occupied by pages of the
        <code class="literal">employees.employees</code> table.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT COUNT(LRU_POSITION) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE_LRU</code></strong>
       <strong class="userinput"><code>WHERE TABLE_NAME='`employees`.`employees`' AND LRU_POSITION &lt; 3072;</code></strong>
+---------------------+
| COUNT(LRU_POSITION) |
+---------------------+
|                 548 |
+---------------------+
</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-stats-example"></a><p class="title"><b>Example 15.10 Querying the INNODB_BUFFER_POOL_STATS Table</b></p>
<div class="example-contents">
<p>
        The <a class="link" href="information-schema.html#innodb-buffer-pool-stats-table" title="25.39.3 The INFORMATION_SCHEMA INNODB_BUFFER_POOL_STATS Table"><code class="literal">INNODB_BUFFER_POOL_STATS</code></a> table
        provides information similar to
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> and <code class="literal">InnoDB</code> buffer pool
        status variables.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM information_schema.INNODB_BUFFER_POOL_STATS \G</code></strong>
*************************** 1. row ***************************
                         POOL_ID: 0
                       POOL_SIZE: 8192
                    FREE_BUFFERS: 1
                  DATABASE_PAGES: 8173
              OLD_DATABASE_PAGES: 3014
         MODIFIED_DATABASE_PAGES: 0
              PENDING_DECOMPRESS: 0
                   PENDING_READS: 0
               PENDING_FLUSH_LRU: 0
              PENDING_FLUSH_LIST: 0
                PAGES_MADE_YOUNG: 15907
            PAGES_NOT_MADE_YOUNG: 3803101
           PAGES_MADE_YOUNG_RATE: 0
       PAGES_MADE_NOT_YOUNG_RATE: 0
               NUMBER_PAGES_READ: 3270
            NUMBER_PAGES_CREATED: 13176
            NUMBER_PAGES_WRITTEN: 15109
                 PAGES_READ_RATE: 0
               PAGES_CREATE_RATE: 0
              PAGES_WRITTEN_RATE: 0
                NUMBER_PAGES_GET: 33069332
                        HIT_RATE: 0
    YOUNG_MAKE_PER_THOUSAND_GETS: 0
NOT_YOUNG_MAKE_PER_THOUSAND_GETS: 0
         NUMBER_PAGES_READ_AHEAD: 2713
       NUMBER_READ_AHEAD_EVICTED: 0
                 READ_AHEAD_RATE: 0
         READ_AHEAD_EVICTED_RATE: 0
                    LRU_IO_TOTAL: 0
                  LRU_IO_CURRENT: 0
                UNCOMPRESS_TOTAL: 0
              UNCOMPRESS_CURRENT: 0
</pre><p>
        For comparison,
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> output and <code class="literal">InnoDB</code> buffer
        pool status variable output is shown below, based on the same
        data set.
      </p><p>
        For more information about
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> output, see
        <a class="xref" href="innodb-storage-engine.html#innodb-standard-monitor" title="15.16.3 InnoDB Standard Monitor and Lock Monitor Output">Section 15.16.3, “InnoDB Standard Monitor and Lock Monitor Output”</a>.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS \G</code></strong>
...
----------------------
BUFFER POOL AND MEMORY
----------------------
Total large memory allocated 137428992
Dictionary memory allocated 579084
Buffer pool size   8192
Free buffers       1
Database pages     8173
Old database pages 3014
Modified db pages  0
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 15907, not young 3803101
0.00 youngs/s, 0.00 non-youngs/s
Pages read 3270, created 13176, written 15109
0.00 reads/s, 0.00 creates/s, 0.00 writes/s
No buffer pool page gets since the last printout
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
LRU len: 8173, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
...
</pre><p>
        For status variable descriptions, see
        <a class="xref" href="server-administration.html#server-status-variables" title="5.1.10 Server Status Variables">Section 5.1.10, “Server Status Variables”</a>.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Innodb_buffer%';</code></strong>
+---------------------------------------+-------------+
| Variable_name                         | Value       |
+---------------------------------------+-------------+
| Innodb_buffer_pool_dump_status        | not started |
| Innodb_buffer_pool_load_status        | not started |
| Innodb_buffer_pool_resize_status      | not started |
| Innodb_buffer_pool_pages_data         | 8173        |
| Innodb_buffer_pool_bytes_data         | 133906432   |
| Innodb_buffer_pool_pages_dirty        | 0           |
| Innodb_buffer_pool_bytes_dirty        | 0           |
| Innodb_buffer_pool_pages_flushed      | 15109       |
| Innodb_buffer_pool_pages_free         | 1           |
| Innodb_buffer_pool_pages_misc         | 18          |
| Innodb_buffer_pool_pages_total        | 8192        |
| Innodb_buffer_pool_read_ahead_rnd     | 0           |
| Innodb_buffer_pool_read_ahead         | 2713        |
| Innodb_buffer_pool_read_ahead_evicted | 0           |
| Innodb_buffer_pool_read_requests      | 33069332    |
| Innodb_buffer_pool_reads              | 558         |
| Innodb_buffer_pool_wait_free          | 0           |
| Innodb_buffer_pool_write_requests     | 11985961    |
+---------------------------------------+-------------+
</pre>
</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-metrics-table"></a>15.14.6 InnoDB INFORMATION_SCHEMA Metrics Table</h3>

</div>

</div>

</div>
<p>
      The <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table provides
      information about <code class="literal">InnoDB</code> performance and
      resource-related counters.
    </p><p>
      <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table columns are
      shown below. For column descriptions, see
      <a class="xref" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table">Section 25.39.22, “The INFORMATION_SCHEMA INNODB_METRICS Table”</a>.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts" \G</code></strong>
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 46273
      MAX_COUNT: 46273
      MIN_COUNT: NULL
      AVG_COUNT: 492.2659574468085
    COUNT_RESET: 46273
MAX_COUNT_RESET: 46273
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: NULL
   TIME_ENABLED: 2014-11-28 16:07:53
  TIME_DISABLED: NULL
   TIME_ELAPSED: 94
     TIME_RESET: NULL
         STATUS: enabled
           TYPE: status_counter
        COMMENT: Number of rows inserted
</pre>
<h4><a name="idm140091634229776"></a>Enabling, Disabling, and Resetting Counters</h4>
<p>
      You can enable, disable, and reset counters using the following
      variables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable"><code class="literal">innodb_monitor_enable</code></a>:
          Enables counters.
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_monitor_enable = [counter-name|module_name|pattern|all];
</pre></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_disable"><code class="literal">innodb_monitor_disable</code></a>:
          Disables counters.
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_monitor_disable = [counter-name|module_name|pattern|all];
</pre></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset"><code class="literal">innodb_monitor_reset</code></a>: Resets
          counter values to zero.
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_monitor_reset = [counter-name|module_name|pattern|all];
</pre></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset_all"><code class="literal">innodb_monitor_reset_all</code></a>:
          Resets all counter values. A counter must be disabled before
          using
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset_all"><code class="literal">innodb_monitor_reset_all</code></a>.
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_monitor_reset_all = [counter-name|module_name|pattern|all];
</pre></li></ul>
</div>
<p>
      Counters and counter modules can also be enabled at startup using
      the MySQL server configuration file. For example, to enable the
      <code class="literal">log</code> module,
      <code class="literal">metadata_table_handles_opened</code> and
      <code class="literal">metadata_table_handles_closed</code> counters, enter
      the following line in the <code class="literal">[mysqld]</code> section of
      the MySQL server configuration file.
    </p><pre data-lang="ini" class="programlisting">[mysqld]
innodb_monitor_enable = module_recovery,metadata_table_handles_opened,metadata_table_handles_closed
</pre><p>
      When enabling multiple counters or modules in a configuration
      file, specify the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable"><code class="literal">innodb_monitor_enable</code></a> variable
      followed by counter and module names separated by a comma, as
      shown above. Only the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable"><code class="literal">innodb_monitor_enable</code></a> variable
      can be used in a configuration file. The
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_disable"><code class="literal">innodb_monitor_disable</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset"><code class="literal">innodb_monitor_reset</code></a> variables
      are supported on the command line only.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        Because each counter adds a degree of runtime overhead, use
        counters conservatively on production servers to diagnose
        specific issues or monitor specific functionality. A test or
        development server is recommended for more extensive use of
        counters.
</p>
</div>
<h4><a name="idm140091634203200"></a>Counters</h4>
<p>
      The list of available counters is subject to change. Query the
      <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_METRICS</code></a>
      table for counters available in your MySQL server version.
    </p><p>
      The counters enabled by default correspond to those shown in
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> output. Counters shown in
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> output are always enabled at a system level but
      can be disable for the <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a>
      table. Counter status is not persistent. Unless configured
      otherwise, counters revert to their default enabled or disabled
      status when the server is restarted.
    </p><p>
      If you run programs that would be affected by the addition or
      removal of counters, it is recommended that you review the
      releases notes and query the
      <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table to identify
      those changes as part of your upgrade process.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT name, subsystem, status FROM INFORMATION_SCHEMA.INNODB_METRICS ORDER BY NAME;</code></strong>
+------------------------------------------+---------------------+----------+
| name                                     | subsystem           | status   |
+------------------------------------------+---------------------+----------+
| adaptive_hash_pages_added                | adaptive_hash_index | disabled |
| adaptive_hash_pages_removed              | adaptive_hash_index | disabled |
| adaptive_hash_rows_added                 | adaptive_hash_index | disabled |
| adaptive_hash_rows_deleted_no_hash_entry | adaptive_hash_index | disabled |
| adaptive_hash_rows_removed               | adaptive_hash_index | disabled |
| adaptive_hash_rows_updated               | adaptive_hash_index | disabled |
| adaptive_hash_searches                   | adaptive_hash_index | enabled  |
| adaptive_hash_searches_btree             | adaptive_hash_index | enabled  |
| buffer_data_reads                        | buffer              | enabled  |
| buffer_data_written                      | buffer              | enabled  |
| buffer_flush_adaptive                    | buffer              | disabled |
| buffer_flush_adaptive_avg_pass           | buffer              | disabled |
| buffer_flush_adaptive_avg_time_est       | buffer              | disabled |
| buffer_flush_adaptive_avg_time_slot      | buffer              | disabled |
| buffer_flush_adaptive_avg_time_thread    | buffer              | disabled |
| buffer_flush_adaptive_pages              | buffer              | disabled |
| buffer_flush_adaptive_total_pages        | buffer              | disabled |
| buffer_flush_avg_page_rate               | buffer              | disabled |
| buffer_flush_avg_pass                    | buffer              | disabled |
| buffer_flush_avg_time                    | buffer              | disabled |
| buffer_flush_background                  | buffer              | disabled |
| buffer_flush_background_pages            | buffer              | disabled |
| buffer_flush_background_total_pages      | buffer              | disabled |
| buffer_flush_batches                     | buffer              | disabled |
| buffer_flush_batch_num_scan              | buffer              | disabled |
| buffer_flush_batch_pages                 | buffer              | disabled |
| buffer_flush_batch_scanned               | buffer              | disabled |
| buffer_flush_batch_scanned_per_call      | buffer              | disabled |
| buffer_flush_batch_total_pages           | buffer              | disabled |
| buffer_flush_lsn_avg_rate                | buffer              | disabled |
| buffer_flush_neighbor                    | buffer              | disabled |
| buffer_flush_neighbor_pages              | buffer              | disabled |
| buffer_flush_neighbor_total_pages        | buffer              | disabled |
| buffer_flush_n_to_flush_by_age           | buffer              | disabled |
| buffer_flush_n_to_flush_requested        | buffer              | disabled |
| buffer_flush_pct_for_dirty               | buffer              | disabled |
| buffer_flush_pct_for_lsn                 | buffer              | disabled |
| buffer_flush_sync                        | buffer              | disabled |
| buffer_flush_sync_pages                  | buffer              | disabled |
| buffer_flush_sync_total_pages            | buffer              | disabled |
| buffer_flush_sync_waits                  | buffer              | disabled |
| buffer_LRU_batches_evict                 | buffer              | disabled |
| buffer_LRU_batches_flush                 | buffer              | disabled |
| buffer_LRU_batch_evict_pages             | buffer              | disabled |
| buffer_LRU_batch_evict_total_pages       | buffer              | disabled |
| buffer_LRU_batch_flush_avg_pass          | buffer              | disabled |
| buffer_LRU_batch_flush_avg_time_est      | buffer              | disabled |
| buffer_LRU_batch_flush_avg_time_slot     | buffer              | disabled |
| buffer_LRU_batch_flush_avg_time_thread   | buffer              | disabled |
| buffer_LRU_batch_flush_pages             | buffer              | disabled |
| buffer_LRU_batch_flush_total_pages       | buffer              | disabled |
| buffer_LRU_batch_num_scan                | buffer              | disabled |
| buffer_LRU_batch_scanned                 | buffer              | disabled |
| buffer_LRU_batch_scanned_per_call        | buffer              | disabled |
| buffer_LRU_get_free_loops                | buffer              | disabled |
| buffer_LRU_get_free_search               | Buffer              | disabled |
| buffer_LRU_get_free_waits                | buffer              | disabled |
| buffer_LRU_search_num_scan               | buffer              | disabled |
| buffer_LRU_search_scanned                | buffer              | disabled |
| buffer_LRU_search_scanned_per_call       | buffer              | disabled |
| buffer_LRU_single_flush_failure_count    | Buffer              | disabled |
| buffer_LRU_single_flush_num_scan         | buffer              | disabled |
| buffer_LRU_single_flush_scanned          | buffer              | disabled |
| buffer_LRU_single_flush_scanned_per_call | buffer              | disabled |
| buffer_LRU_unzip_search_num_scan         | buffer              | disabled |
| buffer_LRU_unzip_search_scanned          | buffer              | disabled |
| buffer_LRU_unzip_search_scanned_per_call | buffer              | disabled |
| buffer_pages_created                     | buffer              | enabled  |
| buffer_pages_read                        | buffer              | enabled  |
| buffer_pages_written                     | buffer              | enabled  |
| buffer_page_read_blob                    | buffer_page_io      | disabled |
| buffer_page_read_fsp_hdr                 | buffer_page_io      | disabled |
| buffer_page_read_ibuf_bitmap             | buffer_page_io      | disabled |
| buffer_page_read_ibuf_free_list          | buffer_page_io      | disabled |
| buffer_page_read_index_ibuf_leaf         | buffer_page_io      | disabled |
| buffer_page_read_index_ibuf_non_leaf     | buffer_page_io      | disabled |
| buffer_page_read_index_inode             | buffer_page_io      | disabled |
| buffer_page_read_index_leaf              | buffer_page_io      | disabled |
| buffer_page_read_index_non_leaf          | buffer_page_io      | disabled |
| buffer_page_read_other                   | buffer_page_io      | disabled |
| buffer_page_read_system_page             | buffer_page_io      | disabled |
| buffer_page_read_trx_system              | buffer_page_io      | disabled |
| buffer_page_read_undo_log                | buffer_page_io      | disabled |
| buffer_page_read_xdes                    | buffer_page_io      | disabled |
| buffer_page_read_zblob                   | buffer_page_io      | disabled |
| buffer_page_read_zblob2                  | buffer_page_io      | disabled |
| buffer_page_written_blob                 | buffer_page_io      | disabled |
| buffer_page_written_fsp_hdr              | buffer_page_io      | disabled |
| buffer_page_written_ibuf_bitmap          | buffer_page_io      | disabled |
| buffer_page_written_ibuf_free_list       | buffer_page_io      | disabled |
| buffer_page_written_index_ibuf_leaf      | buffer_page_io      | disabled |
| buffer_page_written_index_ibuf_non_leaf  | buffer_page_io      | disabled |
| buffer_page_written_index_inode          | buffer_page_io      | disabled |
| buffer_page_written_index_leaf           | buffer_page_io      | disabled |
| buffer_page_written_index_non_leaf       | buffer_page_io      | disabled |
| buffer_page_written_other                | buffer_page_io      | disabled |
| buffer_page_written_system_page          | buffer_page_io      | disabled |
| buffer_page_written_trx_system           | buffer_page_io      | disabled |
| buffer_page_written_undo_log             | buffer_page_io      | disabled |
| buffer_page_written_xdes                 | buffer_page_io      | disabled |
| buffer_page_written_zblob                | buffer_page_io      | disabled |
| buffer_page_written_zblob2               | buffer_page_io      | disabled |
| buffer_pool_bytes_data                   | buffer              | enabled  |
| buffer_pool_bytes_dirty                  | buffer              | enabled  |
| buffer_pool_pages_data                   | buffer              | enabled  |
| buffer_pool_pages_dirty                  | buffer              | enabled  |
| buffer_pool_pages_free                   | buffer              | enabled  |
| buffer_pool_pages_misc                   | buffer              | enabled  |
| buffer_pool_pages_total                  | buffer              | enabled  |
| buffer_pool_reads                        | buffer              | enabled  |
| buffer_pool_read_ahead                   | buffer              | enabled  |
| buffer_pool_read_ahead_evicted           | buffer              | enabled  |
| buffer_pool_read_requests                | buffer              | enabled  |
| buffer_pool_size                         | server              | enabled  |
| buffer_pool_wait_free                    | buffer              | enabled  |
| buffer_pool_write_requests               | buffer              | enabled  |
| compression_pad_decrements               | compression         | disabled |
| compression_pad_increments               | compression         | disabled |
| compress_pages_compressed                | compression         | disabled |
| compress_pages_decompressed              | compression         | disabled |
| ddl_background_drop_indexes              | ddl                 | disabled |
| ddl_background_drop_tables               | ddl                 | disabled |
| ddl_log_file_alter_table                 | ddl                 | disabled |
| ddl_online_create_index                  | ddl                 | disabled |
| ddl_pending_alter_table                  | ddl                 | disabled |
| ddl_sort_file_alter_table                | ddl                 | disabled |
| dml_deletes                              | dml                 | enabled  |
| dml_inserts                              | dml                 | enabled  |
| dml_reads                                | dml                 | disabled |
| dml_updates                              | dml                 | enabled  |
| file_num_open_files                      | file_system         | enabled  |
| ibuf_merges                              | change_buffer       | enabled  |
| ibuf_merges_delete                       | change_buffer       | enabled  |
| ibuf_merges_delete_mark                  | change_buffer       | enabled  |
| ibuf_merges_discard_delete               | change_buffer       | enabled  |
| ibuf_merges_discard_delete_mark          | change_buffer       | enabled  |
| ibuf_merges_discard_insert               | change_buffer       | enabled  |
| ibuf_merges_insert                       | change_buffer       | enabled  |
| ibuf_size                                | change_buffer       | enabled  |
| icp_attempts                             | icp                 | disabled |
| icp_match                                | icp                 | disabled |
| icp_no_match                             | icp                 | disabled |
| icp_out_of_range                         | icp                 | disabled |
| index_page_discards                      | index               | disabled |
| index_page_merge_attempts                | index               | disabled |
| index_page_merge_successful              | index               | disabled |
| index_page_reorg_attempts                | index               | disabled |
| index_page_reorg_successful              | index               | disabled |
| index_page_splits                        | index               | disabled |
| innodb_activity_count                    | server              | enabled  |
| innodb_background_drop_table_usec        | server              | disabled |
| innodb_checkpoint_usec                   | server              | disabled |
| innodb_dblwr_pages_written               | server              | enabled  |
| innodb_dblwr_writes                      | server              | enabled  |
| innodb_dict_lru_count                    | server              | disabled |
| innodb_dict_lru_usec                     | server              | disabled |
| innodb_ibuf_merge_usec                   | server              | disabled |
| innodb_log_flush_usec                    | server              | disabled |
| innodb_master_active_loops               | server              | disabled |
| innodb_master_idle_loops                 | server              | disabled |
| innodb_master_purge_usec                 | server              | disabled |
| innodb_master_thread_sleeps              | server              | disabled |
| innodb_mem_validate_usec                 | server              | disabled |
| innodb_page_size                         | server              | enabled  |
| innodb_rwlock_sx_os_waits                | server              | enabled  |
| innodb_rwlock_sx_spin_rounds             | server              | enabled  |
| innodb_rwlock_sx_spin_waits              | server              | enabled  |
| innodb_rwlock_s_os_waits                 | server              | enabled  |
| innodb_rwlock_s_spin_rounds              | server              | enabled  |
| innodb_rwlock_s_spin_waits               | server              | enabled  |
| innodb_rwlock_x_os_waits                 | server              | enabled  |
| innodb_rwlock_x_spin_rounds              | server              | enabled  |
| innodb_rwlock_x_spin_waits               | server              | enabled  |
| lock_deadlocks                           | lock                | enabled  |
| lock_rec_locks                           | lock                | disabled |
| lock_rec_lock_created                    | lock                | disabled |
| lock_rec_lock_removed                    | lock                | disabled |
| lock_rec_lock_requests                   | lock                | disabled |
| lock_rec_lock_waits                      | lock                | disabled |
| lock_row_lock_current_waits              | lock                | enabled  |
| lock_row_lock_time                       | lock                | enabled  |
| lock_row_lock_time_avg                   | lock                | enabled  |
| lock_row_lock_time_max                   | lock                | enabled  |
| lock_row_lock_waits                      | lock                | enabled  |
| lock_table_locks                         | lock                | disabled |
| lock_table_lock_created                  | lock                | disabled |
| lock_table_lock_removed                  | lock                | disabled |
| lock_table_lock_waits                    | lock                | disabled |
| lock_timeouts                            | lock                | enabled  |
| log_checkpoints                          | recovery            | disabled |
| log_lsn_buf_pool_oldest                  | recovery            | disabled |
| log_lsn_checkpoint_age                   | recovery            | disabled |
| log_lsn_current                          | recovery            | disabled |
| log_lsn_last_checkpoint                  | recovery            | disabled |
| log_lsn_last_flush                       | recovery            | disabled |
| log_max_modified_age_async               | recovery            | disabled |
| log_max_modified_age_sync                | recovery            | disabled |
| log_num_log_io                           | recovery            | disabled |
| log_padded                               | recovery            | enabled  |
| log_pending_checkpoint_writes            | recovery            | disabled |
| log_pending_log_flushes                  | recovery            | disabled |
| log_waits                                | recovery            | enabled  |
| log_writes                               | recovery            | enabled  |
| log_write_requests                       | recovery            | enabled  |
| metadata_table_handles_closed            | metadata            | disabled |
| metadata_table_handles_opened            | metadata            | disabled |
| metadata_table_reference_count           | metadata            | disabled |
| os_data_fsyncs                           | os                  | enabled  |
| os_data_reads                            | os                  | enabled  |
| os_data_writes                           | os                  | enabled  |
| os_log_bytes_written                     | os                  | enabled  |
| os_log_fsyncs                            | os                  | enabled  |
| os_log_pending_fsyncs                    | os                  | enabled  |
| os_log_pending_writes                    | os                  | enabled  |
| os_pending_reads                         | os                  | disabled |
| os_pending_writes                        | os                  | disabled |
| purge_del_mark_records                   | purge               | disabled |
| purge_dml_delay_usec                     | purge               | disabled |
| purge_invoked                            | purge               | disabled |
| purge_resume_count                       | purge               | disabled |
| purge_stop_count                         | purge               | disabled |
| purge_undo_log_pages                     | purge               | disabled |
| purge_upd_exist_or_extern_records        | purge               | disabled |
| trx_active_transactions                  | transaction         | disabled |
| trx_commits_insert_update                | transaction         | disabled |
| trx_nl_ro_commits                        | transaction         | disabled |
| trx_rollbacks                            | transaction         | disabled |
| trx_rollbacks_savepoint                  | transaction         | disabled |
| trx_rollback_active                      | transaction         | disabled |
| trx_ro_commits                           | transaction         | disabled |
| trx_rseg_current_size                    | transaction         | disabled |
| trx_rseg_history_len                     | transaction         | enabled  |
| trx_rw_commits                           | transaction         | disabled |
| trx_undo_slots_cached                    | transaction         | disabled |
| trx_undo_slots_used                      | transaction         | disabled |
+------------------------------------------+---------------------+----------+
235 rows in set (0.01 sec)
</pre>
<h4><a name="idm140091634162544"></a>Counter Modules</h4>
<p>
      Each counter is associated with a particular module. Module names
      can be used to enable, disable, or reset all counters for a
      particular subsystem. For example, use
      <code class="literal">module_dml</code> to enable all counters associated
      with the <code class="literal">dml</code> subsystem.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_monitor_enable = module_dml;</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT name, subsystem, status FROM INFORMATION_SCHEMA.INNODB_METRICS</code></strong>
       <strong class="userinput"><code>WHERE subsystem ='dml';</code></strong>
+-------------+-----------+---------+
| name        | subsystem | status  |
+-------------+-----------+---------+
| dml_reads   | dml       | enabled |
| dml_inserts | dml       | enabled |
| dml_deletes | dml       | enabled |
| dml_updates | dml       | enabled |
+-------------+-----------+---------+
</pre><p>
      Module names can be used with
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_enable"><code class="literal">innodb_monitor_enable</code></a> and related
      variables.
    </p><p>
      Module names and corresponding <code class="literal">SUBSYSTEM</code> names
      are listed below.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">module_adaptive_hash</code> (subsystem =
          <code class="literal">adaptive_hash_index</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_buffer</code> (subsystem =
          <code class="literal">buffer</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_buffer_page</code> (subsystem =
          <code class="literal">buffer_page_io</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_compress</code> (subsystem =
          <code class="literal">compression</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_ddl</code> (subsystem =
          <code class="literal">ddl</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_dml</code> (subsystem =
          <code class="literal">dml</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_file</code> (subsystem =
          <code class="literal">file_system</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_ibuf_system</code> (subsystem =
          <code class="literal">change_buffer</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_icp</code> (subsystem =
          <code class="literal">icp</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_index</code> (subsystem =
          <code class="literal">index</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_innodb</code> (subsystem =
          <code class="literal">innodb</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_lock</code> (subsystem =
          <code class="literal">lock</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_log</code> (subsystem =
          <code class="literal">recovery</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_metadata</code> (subsystem =
          <code class="literal">metadata</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_os</code> (subsystem =
          <code class="literal">os</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_purge</code> (subsystem =
          <code class="literal">purge</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_trx</code> (subsystem =
          <code class="literal">transaction</code>)
        </p></li><li class="listitem"><p>
          <code class="literal">module_undo</code> (subsystem =
          <code class="literal">undo</code>)
</p></li></ul>
</div>

<div class="example">
<a name="innodb-information-schema-metrics-table-example"></a><p class="title"><b>Example 15.11 Working with INNODB_METRICS Table Counters</b></p>
<div class="example-contents">
<p>
        This example demonstrates enabling, disabling, and resetting a
        counter, and querying counter data in the
        <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create a simple <code class="literal">InnoDB</code> table:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
Database changed

mysql&gt; <strong class="userinput"><code>CREATE TABLE t1 (c1 INT) ENGINE=INNODB;</code></strong>
Query OK, 0 rows affected (0.02 sec)
</pre></li><li class="listitem"><p>
            Enable the <code class="literal">dml_inserts</code> counter.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_monitor_enable = dml_inserts;</code></strong>
Query OK, 0 rows affected (0.01 sec)
</pre><p>
            A description of the <code class="literal">dml_inserts</code> counter
            can be found in the <code class="literal">COMMENT</code> column of the
            <code class="literal">INNODB_METRICS</code> table:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT NAME, COMMENT FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts";</code></strong>
+-------------+-------------------------+
| NAME        | COMMENT                 |
+-------------+-------------------------+
| dml_inserts | Number of rows inserted |
+-------------+-------------------------+
</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table
            for the <code class="literal">dml_inserts</code> counter data. Because
            no DML operations have been performed, the counter values
            are zero or NULL. The <code class="literal">TIME_ENABLED</code> and
            <code class="literal">TIME_ELAPSED</code> values indicate when the
            counter was last enabled and how many seconds have elapsed
            since that time.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt;  <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts" \G</code></strong>
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 0
      MAX_COUNT: 0
      MIN_COUNT: NULL
      AVG_COUNT: 0
    COUNT_RESET: 0
MAX_COUNT_RESET: 0
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: NULL
   TIME_ENABLED: 2014-12-04 14:18:28
  TIME_DISABLED: NULL
   TIME_ELAPSED: 28
     TIME_RESET: NULL
         STATUS: enabled
           TYPE: status_counter
        COMMENT: Number of rows inserted
</pre></li><li class="listitem"><p>
            Insert three rows of data into the table.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>INSERT INTO t1 values(1);</code></strong>
Query OK, 1 row affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t1 values(2);</code></strong>
Query OK, 1 row affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t1 values(3);</code></strong>
Query OK, 1 row affected (0.00 sec)
</pre></li><li class="listitem"><p>
            Query the <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table
            again for the <code class="literal">dml_inserts</code> counter data. A
            number of counter values have now incremented including
            <code class="literal">COUNT</code>, <code class="literal">MAX_COUNT</code>,
            <code class="literal">AVG_COUNT</code>, and
            <code class="literal">COUNT_RESET</code>. Refer to the
            <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table definition
            for descriptions of these values.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt;  <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts"\G</code></strong>
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 3
      MAX_COUNT: 3
      MIN_COUNT: NULL
      AVG_COUNT: 0.046153846153846156
    COUNT_RESET: 3
MAX_COUNT_RESET: 3
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: NULL
   TIME_ENABLED: 2014-12-04 14:18:28
  TIME_DISABLED: NULL
   TIME_ELAPSED: 65
     TIME_RESET: NULL
         STATUS: enabled
           TYPE: status_counter
        COMMENT: Number of rows inserted
</pre></li><li class="listitem"><p>
            Reset the <code class="literal">dml_inserts</code> counter and query
            the <a class="link" href="information-schema.html#innodb-metrics-table" title="25.39.22 The INFORMATION_SCHEMA INNODB_METRICS Table"><code class="literal">INNODB_METRICS</code></a> table again
            for the <code class="literal">dml_inserts</code> counter data. The
            <code class="literal">%_RESET</code> values that were reported
            previously, such as <code class="literal">COUNT_RESET</code> and
            <code class="literal">MAX_RESET</code>, are set back to zero. Values
            such as <code class="literal">COUNT</code>,
            <code class="literal">MAX_COUNT</code>, and
            <code class="literal">AVG_COUNT</code>, which cumulatively collect
            data from the time the counter is enabled, are unaffected by
            the reset.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_monitor_reset = dml_inserts;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts"\G</code></strong>
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 3
      MAX_COUNT: 3
      MIN_COUNT: NULL
      AVG_COUNT: 0.03529411764705882
    COUNT_RESET: 0
MAX_COUNT_RESET: 0
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: 0
   TIME_ENABLED: 2014-12-04 14:18:28
  TIME_DISABLED: NULL
   TIME_ELAPSED: 85
     TIME_RESET: 2014-12-04 14:19:44
         STATUS: enabled
           TYPE: status_counter
        COMMENT: Number of rows inserted
</pre></li><li class="listitem"><p>
            To reset all counter values, you must first disable the
            counter. Disabling the counter sets the
            <code class="literal">STATUS</code> value to
            <code class="literal">disabled</code>.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_monitor_disable = dml_inserts;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts"\G</code></strong>
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 3
      MAX_COUNT: 3
      MIN_COUNT: NULL
      AVG_COUNT: 0.030612244897959183
    COUNT_RESET: 0
MAX_COUNT_RESET: 0
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: 0
   TIME_ENABLED: 2014-12-04 14:18:28
  TIME_DISABLED: 2014-12-04 14:20:06
   TIME_ELAPSED: 98
     TIME_RESET: NULL
         STATUS: disabled
           TYPE: status_counter
        COMMENT: Number of rows inserted
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              Wildcard match is supported for counter and module names.
              For example, instead of specifying the full
              <code class="literal">dml_inserts</code> counter name, you can
              specify <code class="literal">dml_i%</code>. You can also enable,
              disable, or reset multiple counters or modules at once
              using a wildcard match. For example, specify
              <code class="literal">dml_%</code> to enable, disable, or reset all
              counters that begin with <code class="literal">dml_</code>.
</p>
</div>
</li><li class="listitem"><p>
            After the counter is disabled, you can reset all counter
            values using the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_monitor_reset_all"><code class="literal">innodb_monitor_reset_all</code></a>
            option. All values are set to zero or NULL.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_monitor_reset_all = dml_inserts;</code></strong>
Query OK, 0 rows affected (0.00 sec)
 
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME="dml_inserts"\G</code></strong>
*************************** 1. row ***************************
           NAME: dml_inserts
      SUBSYSTEM: dml
          COUNT: 0
      MAX_COUNT: NULL
      MIN_COUNT: NULL
      AVG_COUNT: NULL
    COUNT_RESET: 0
MAX_COUNT_RESET: NULL
MIN_COUNT_RESET: NULL
AVG_COUNT_RESET: NULL
   TIME_ENABLED: NULL
  TIME_DISABLED: NULL
   TIME_ELAPSED: NULL
     TIME_RESET: NULL
         STATUS: disabled
           TYPE: status_counter
        COMMENT: Number of rows inserted
</pre></li></ol>
</div>

</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-temp-table-info"></a>15.14.7 InnoDB INFORMATION_SCHEMA Temporary Table Info Table</h3>

</div>

</div>

</div>
<p>
      <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="25.39.28 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> provides
      information about user-created <code class="literal">InnoDB</code> temporary
      tables that are active in the <code class="literal">InnoDB</code> instance.
      It does not provide information about internal
      <code class="literal">InnoDB</code> temporary tables used by the optimizer.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW TABLES FROM INFORMATION_SCHEMA LIKE 'INNODB_TEMP%';</code></strong>
+---------------------------------------------+
| Tables_in_INFORMATION_SCHEMA (INNODB_TEMP%) |
+---------------------------------------------+
| INNODB_TEMP_TABLE_INFO                      |
+---------------------------------------------+
</pre><p>
      For the table definition, see
      <a class="xref" href="information-schema.html#innodb-temp-table-info-table" title="25.39.28 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table">Section 25.39.28, “The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table”</a>.
</p>
<div class="example">
<a name="innodb-information-schema-temp-table-info-example"></a><p class="title"><b>Example 15.12 INNODB_TEMP_TABLE_INFO</b></p>
<div class="example-contents">
<p>
        This example demonstrates characteristics of the
        <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="25.39.28 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> table.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create a simple <code class="literal">InnoDB</code> temporary table:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TEMPORARY TABLE t1 (c1 INT PRIMARY KEY) ENGINE=INNODB;</code></strong>
</pre></li><li class="listitem"><p>
            Query <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="25.39.28 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> to
            view the temporary table metadata.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_TEMP_TABLE_INFO\G</code></strong>
*************************** 1. row ***************************
            TABLE_ID: 194
                NAME: #sql7a79_1_0
              N_COLS: 4
               SPACE: 182
</pre><p>
            The <code class="literal">TABLE_ID </code> is a unique identifier for
            the temporary table. The <code class="literal">NAME</code> column
            displays the system-generated name for the temporary table,
            which is prefixed with <span class="quote">“<span class="quote">#sql</span>”</span>. The number of
            columns (<code class="literal">N_COLS</code>) is 4 rather than 1
            because <code class="literal">InnoDB</code> always creates three
            hidden table columns (<code class="literal">DB_ROW_ID</code>,
            <code class="literal">DB_TRX_ID</code>, and
            <code class="literal">DB_ROLL_PTR</code>).
          </p></li><li class="listitem"><p>
            Restart MySQL and query
            <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="25.39.28 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a>.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_TEMP_TABLE_INFO\G</code></strong>
</pre><p>
            An empty set is returned because
            <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="25.39.28 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> and its
            data are not persisted to disk when the server is shut down.
          </p></li><li class="listitem"><p>
            Create a new temporary table.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TEMPORARY TABLE t1 (c1 INT PRIMARY KEY) ENGINE=INNODB;</code></strong>
</pre></li><li class="listitem"><p>
            Query <a class="link" href="information-schema.html#innodb-temp-table-info-table" title="25.39.28 The INFORMATION_SCHEMA INNODB_TEMP_TABLE_INFO Table"><code class="literal">INNODB_TEMP_TABLE_INFO</code></a> to
            view the temporary table metadata.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.INNODB_TEMP_TABLE_INFO\G</code></strong>
*************************** 1. row ***************************
            TABLE_ID: 196
                NAME: #sql7b0e_1_0
              N_COLS: 4
               SPACE: 184
</pre><p>
            The <code class="literal">SPACE</code> ID may be different because it
            is dynamically generated when the server is started.
</p></li></ol>
</div>

</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-files-table"></a>15.14.8 Retrieving InnoDB Tablespace Metadata from INFORMATION_SCHEMA.FILES</h3>

</div>

</div>

</div>
<p>
      The <a class="link" href="information-schema.html#files-table" title="25.11 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a> table
      provides metadata about all <code class="literal">InnoDB</code> tablespace
      types including <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table
      tablespaces</a>,
      <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
      tablespaces</a>, the
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>,
      <a class="link" href="glossary.html#glos_temporary_tablespace" title="temporary tablespace">temporary table
      tablespaces</a>, and <a class="link" href="glossary.html#glos_undo_tablespace" title="undo tablespace">undo
      tablespaces</a> (if present).
    </p><p>
      This section provides <code class="literal">InnoDB</code>-specific usage
      examples. For more information about data provided by the
      <a class="link" href="information-schema.html#files-table" title="25.11 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a> table, see
      <a class="xref" href="information-schema.html#files-table" title="25.11 The INFORMATION_SCHEMA FILES Table">Section 25.11, “The INFORMATION_SCHEMA FILES Table”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        The <a class="link" href="information-schema.html#innodb-tablespaces-table" title="25.39.25 The INFORMATION_SCHEMA INNODB_TABLESPACES Table"><code class="literal">INNODB_TABLESPACES</code></a> and
        <a class="link" href="information-schema.html#innodb-datafiles-table" title="25.39.9 The INFORMATION_SCHEMA INNODB_DATAFILES Table"><code class="literal">INNODB_DATAFILES</code></a> tables also
        provide metadata about <code class="literal">InnoDB</code> tablespaces,
        but data is limited to file-per-table, general, and undo
        tablespaces.
</p>
</div>
<p>
      This query retrieves metadata about the <code class="literal">InnoDB</code>
      system tablespace from fields of the
      <a class="link" href="information-schema.html#files-table" title="25.11 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a> table that
      are pertinent to <code class="literal">InnoDB</code> tablespaces.
      <a class="link" href="information-schema.html#files-table" title="25.11 The INFORMATION_SCHEMA FILES Table"><code class="literal">INFORMATION_SCHEMA.FILES</code></a> fields that
      are not relevant to <code class="literal">InnoDB</code> always return NULL,
      and are excluded from the query.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT FILE_ID, FILE_NAME, FILE_TYPE, TABLESPACE_NAME, FREE_EXTENTS,</code></strong>
       <strong class="userinput"><code>TOTAL_EXTENTS,  EXTENT_SIZE, INITIAL_SIZE, MAXIMUM_SIZE, AUTOEXTEND_SIZE, DATA_FREE, STATUS ENGINE</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.FILES WHERE TABLESPACE_NAME LIKE 'innodb_system' \G</code></strong>
*************************** 1. row ***************************
        FILE_ID: 0
      FILE_NAME: ./ibdata1
      FILE_TYPE: TABLESPACE
TABLESPACE_NAME: innodb_system
   FREE_EXTENTS: 0
  TOTAL_EXTENTS: 12
    EXTENT_SIZE: 1048576
   INITIAL_SIZE: 12582912
   MAXIMUM_SIZE: NULL
AUTOEXTEND_SIZE: 67108864
      DATA_FREE: 4194304
         ENGINE: NORMAL
</pre><p>
      This query retrieves the <code class="literal">FILE_ID</code> (equivalent to
      the space ID) and the <code class="literal">FILE_NAME</code> (which includes
      path information) for <code class="literal">InnoDB</code> file-per-table and
      general tablespaces. File-per-table and general tablespaces have a
      <code class="filename">.ibd</code> file extension.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT FILE_ID, FILE_NAME FROM INFORMATION_SCHEMA.FILES</code></strong>
       <strong class="userinput"><code>WHERE FILE_NAME LIKE '%.ibd%' ORDER BY FILE_ID;</code></strong>
    +---------+---------------------------------------+
    | FILE_ID | FILE_NAME                             |
    +---------+---------------------------------------+
    |       2 | ./mysql/plugin.ibd                    |
    |       3 | ./mysql/servers.ibd                   |
    |       4 | ./mysql/help_topic.ibd                |
    |       5 | ./mysql/help_category.ibd             |
    |       6 | ./mysql/help_relation.ibd             |
    |       7 | ./mysql/help_keyword.ibd              |
    |       8 | ./mysql/time_zone_name.ibd            |
    |       9 | ./mysql/time_zone.ibd                 |
    |      10 | ./mysql/time_zone_transition.ibd      |
    |      11 | ./mysql/time_zone_transition_type.ibd |
    |      12 | ./mysql/time_zone_leap_second.ibd     |
    |      13 | ./mysql/innodb_table_stats.ibd        |
    |      14 | ./mysql/innodb_index_stats.ibd        |
    |      15 | ./mysql/slave_relay_log_info.ibd      |
    |      16 | ./mysql/slave_master_info.ibd         |
    |      17 | ./mysql/slave_worker_info.ibd         |
    |      18 | ./mysql/gtid_executed.ibd             |
    |      19 | ./mysql/server_cost.ibd               |
    |      20 | ./mysql/engine_cost.ibd               |
    |      21 | ./sys/sys_config.ibd                  |
    |      23 | ./test/t1.ibd                         |
    |      26 | /home/user/test/test/t2.ibd           |
    +---------+---------------------------------------+
</pre><p>
      This query retrieves the <code class="literal">FILE_ID</code> and
      <code class="literal">FILE_NAME</code> for the <code class="literal">InnoDB</code>
      global temporary tablespace. Global temporary tablespace file
      names are prefixed by <code class="literal">ibtmp</code>.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT FILE_ID, FILE_NAME FROM INFORMATION_SCHEMA.FILES</code></strong>
       <strong class="userinput"><code>WHERE FILE_NAME LIKE '%ibtmp%';</code></strong>
+---------+-----------+
| FILE_ID | FILE_NAME |
+---------+-----------+
|      22 | ./ibtmp1  |
+---------+-----------+
</pre><p>
      Similarly, <code class="literal">InnoDB</code> undo tablespace file names
      are prefixed by <code class="literal">undo</code>. The following query
      returns the <code class="literal">FILE_ID</code> and
      <code class="literal">FILE_NAME</code> for <code class="literal">InnoDB</code> undo
      tablespaces.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT FILE_ID, FILE_NAME FROM INFORMATION_SCHEMA.FILES</code></strong>
       <strong class="userinput"><code>WHERE FILE_NAME LIKE '%undo%';</code></strong>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-performance-schema"></a>15.15 InnoDB Integration with MySQL Performance Schema</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#monitor-alter-table-performance-schema">15.15.1 Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance
Schema</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#monitor-innodb-mutex-waits-performance-schema">15.15.2 Monitoring InnoDB Mutex Waits Using Performance Schema</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091633967376"></a><p>
    This section provides a brief introduction to
    <code class="literal">InnoDB</code> integration with Performance Schema. For
    comprehensive Performance Schema documentation, see
    <a class="xref" href="performance-schema.html" title="Chapter 26 MySQL Performance Schema">Chapter 26, <i>MySQL Performance Schema</i></a>.
  </p><p>
    You can profile certain internal <code class="literal">InnoDB</code>
    operations using the MySQL
    <a class="link" href="performance-schema.html" title="Chapter 26 MySQL Performance Schema">Performance Schema
    feature</a>. This type of tuning is primarily for expert users
    who evaluate optimization strategies to overcome performance
    bottlenecks. DBAs can also use this feature for capacity planning,
    to see whether their typical workload encounters any performance
    bottlenecks with a particular combination of CPU, RAM, and disk
    storage; and if so, to judge whether performance can be improved by
    increasing the capacity of some part of the system.
  </p><p>
    To use this feature to examine <code class="literal">InnoDB</code>
    performance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        You must be generally familiar with how to use the
        <a class="link" href="performance-schema.html" title="Chapter 26 MySQL Performance Schema">Performance Schema
        feature</a>. For example, you should know how enable
        instruments and consumers, and how to query
        <code class="literal">performance_schema</code> tables to retrieve data.
        For an introductory overview, see
        <a class="xref" href="performance-schema.html#performance-schema-quick-start" title="26.1 Performance Schema Quick Start">Section 26.1, “Performance Schema Quick Start”</a>.
      </p></li><li class="listitem"><p>
        You should be familiar with Performance Schema instruments that
        are available for <code class="literal">InnoDB</code>. To view
        <code class="literal">InnoDB</code>-related instruments, you can query the
        <a class="link" href="performance-schema.html#setup-instruments-table" title="26.12.2.3 The setup_instruments Table"><code class="literal">setup_instruments</code></a> table for
        instrument names that contain '<code class="literal">innodb</code>'.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%innodb%';</code></strong>
+-------------------------------------------------------+---------+-------+
| NAME                                                  | ENABLED | TIMED |
+-------------------------------------------------------+---------+-------+
| wait/synch/mutex/innodb/commit_cond_mutex             | NO      | NO    |
| wait/synch/mutex/innodb/innobase_share_mutex          | NO      | NO    |
| wait/synch/mutex/innodb/autoinc_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_zip_mutex            | NO      | NO    |
| wait/synch/mutex/innodb/cache_last_read_mutex         | NO      | NO    |
| wait/synch/mutex/innodb/dict_foreign_err_mutex        | NO      | NO    |
| wait/synch/mutex/innodb/dict_sys_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/recalc_pool_mutex             | NO      | NO    |
...
| wait/io/file/innodb/innodb_data_file                  | YES     | YES   |
| wait/io/file/innodb/innodb_log_file                   | YES     | YES   |
| wait/io/file/innodb/innodb_temp_file                  | YES     | YES   |
| stage/innodb/alter table (end)                        | YES     | YES   |
| stage/innodb/alter table (flush)                      | YES     | YES   |
| stage/innodb/alter table (insert)                     | YES     | YES   |
| stage/innodb/alter table (log apply index)            | YES     | YES   |
| stage/innodb/alter table (log apply table)            | YES     | YES   |
| stage/innodb/alter table (merge sort)                 | YES     | YES   |
| stage/innodb/alter table (read PK and internal sort)  | YES     | YES   |
| stage/innodb/buffer pool load                         | YES     | YES   |
| memory/innodb/buf_buf_pool                            | NO      | NO    |
| memory/innodb/dict_stats_bg_recalc_pool_t             | NO      | NO    |
| memory/innodb/dict_stats_index_map_t                  | NO      | NO    |
| memory/innodb/dict_stats_n_diff_on_level              | NO      | NO    |
| memory/innodb/other                                   | NO      | NO    |
| memory/innodb/row_log_buf                             | NO      | NO    |
| memory/innodb/row_merge_sort                          | NO      | NO    |
| memory/innodb/std                                     | NO      | NO    |
| memory/innodb/sync_debug_latches                      | NO      | NO    |
| memory/innodb/trx_sys_t::rw_trx_ids                   | NO      | NO    |
...
+-------------------------------------------------------+---------+-------+
155 rows in set (0.00 sec)
</pre><p>
        For additional information about the instrumented
        <code class="literal">InnoDB</code> objects, you can query Performance
        Schema
        <a class="link" href="performance-schema.html#performance-schema-instance-tables" title="26.12.3 Performance Schema Instance Tables">instances
        tables</a>, which provide additional information about
        instrumented objects. Instance tables relevant to
        <code class="literal">InnoDB</code> include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
            The <a class="link" href="performance-schema.html#mutex-instances-table" title="26.12.3.3 The mutex_instances Table"><code class="literal">mutex_instances</code></a> table
          </p></li><li class="listitem"><p>
            The <a class="link" href="performance-schema.html#rwlock-instances-table" title="26.12.3.4 The rwlock_instances Table"><code class="literal">rwlock_instances</code></a> table
          </p></li><li class="listitem"><p>
            The <a class="link" href="performance-schema.html#cond-instances-table" title="26.12.3.1 The cond_instances Table"><code class="literal">cond_instances</code></a> table
          </p></li><li class="listitem"><p>
            The <a class="link" href="performance-schema.html#file-instances-table" title="26.12.3.2 The file_instances Table"><code class="literal">file_instances</code></a> table
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          Mutexes and RW-locks related to the <code class="literal">InnoDB</code>
          buffer pool are not included in this coverage; the same
          applies to the output of the <code class="literal">SHOW ENGINE INNODB
          MUTEX</code> command.
</p>
</div>
<p>
        For example, to view information about instrumented
        <code class="literal">InnoDB</code> file objects seen by the Performance
        Schema when executing file I/O instrumentation, you might issue
        the following query:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM performance_schema.file_instances</code></strong>
       <strong class="userinput"><code>WHERE EVENT_NAME LIKE '%innodb%'\G</code></strong>
*************************** 1. row ***************************
 FILE_NAME: /path/to/mysql-8.0/data/ibdata1
EVENT_NAME: wait/io/file/innodb/innodb_data_file
OPEN_COUNT: 3
*************************** 2. row ***************************
 FILE_NAME: /path/to/mysql-8.0/data/ib_logfile0
EVENT_NAME: wait/io/file/innodb/innodb_log_file
OPEN_COUNT: 2
*************************** 3. row ***************************
 FILE_NAME: /path/to/mysql-8.0/data/ib_logfile1
EVENT_NAME: wait/io/file/innodb/innodb_log_file
OPEN_COUNT: 2
*************************** 4. row ***************************
 FILE_NAME: /path/to/mysql-8.0/data/mysql/engine_cost.ibd
EVENT_NAME: wait/io/file/innodb/innodb_data_file
OPEN_COUNT: 3
...
</pre></li><li class="listitem"><p>
        You should be familiar with
        <code class="literal">performance_schema</code> tables that store
        <code class="literal">InnoDB</code> event data. Tables relevant to
        <code class="literal">InnoDB</code>-related events include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
            The <a class="link" href="performance-schema.html#performance-schema-wait-tables" title="26.12.4 Performance Schema Wait Event Tables">Wait
            Event</a> tables, which store wait events.
          </p></li><li class="listitem"><p>
            The
            <a class="link" href="performance-schema.html#performance-schema-summary-tables" title="26.12.16 Performance Schema Summary Tables">Summary</a>
            tables, which provide aggregated information for terminated
            events over time. Summary tables include
            <a class="link" href="performance-schema.html#file-summary-tables" title="26.12.16.7 File I/O Summary Tables">file I/O summary
            tables</a>, which aggregate information about I/O
            operations.
          </p></li><li class="listitem"><p>
            <a class="link" href="performance-schema.html#performance-schema-stage-tables" title="26.12.5 Performance Schema Stage Event Tables">Stage
            Event</a> tables, which store event data for
            <code class="literal">InnoDB</code> <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
            TABLE</code></a> and buffer pool load operations. For more
            information, see
            <a class="xref" href="innodb-storage-engine.html#monitor-alter-table-performance-schema" title="15.15.1 Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance Schema">Section 15.15.1, “Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance
      Schema”</a>,
            and
            <a class="xref" href="innodb-storage-engine.html#monitor-buffer-pool-load-performance-schema" title="Monitoring Buffer Pool Load Progress Using Performance Schema">Monitoring Buffer Pool Load Progress Using Performance Schema</a>.
</p></li></ul>
</div>
<p>
        If you are only interested in <code class="literal">InnoDB</code>-related
        objects, use the clause <code class="literal">WHERE EVENT_NAME LIKE
        '%innodb%'</code> or <code class="literal">WHERE NAME LIKE
        '%innodb%'</code> (as required) when querying these tables.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="monitor-alter-table-performance-schema"></a>15.15.1 Monitoring ALTER TABLE Progress for InnoDB Tables Using Performance
Schema</h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140091633907392"></a><a class="indexterm" name="idm140091633905904"></a><p>
      You can monitor <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      progress for <code class="literal">InnoDB</code> tables using
      <a class="link" href="performance-schema.html" title="Chapter 26 MySQL Performance Schema">Performance Schema</a>.
    </p><p>
      There are seven stage events that represent different phases of
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>. Each stage event
      reports a running total of <code class="literal">WORK_COMPLETED</code> and
      <code class="literal">WORK_ESTIMATED</code> for the overall
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation as it
      progresses through its different phases.
      <code class="literal">WORK_ESTIMATED</code> is calculated using a formula
      that takes into account all of the work that
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> performs, and may be
      revised during <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      processing. <code class="literal">WORK_COMPLETED</code> and
      <code class="literal">WORK_ESTIMATED</code> values are an abstract
      representation of all of the work performed by
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>.
    </p><p>
      In order of occurrence, <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      stage events include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (read PK and internal
          sort)</code>: This stage is active when
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> is in the
          reading-primary-key phase. It starts with
          <code class="literal">WORK_COMPLETED=0</code> and
          <code class="literal">WORK_ESTIMATED</code> set to the estimated number
          of pages in the primary key. When the stage is completed,
          <code class="literal">WORK_ESTIMATED</code> is updated to the actual
          number of pages in the primary key.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (merge sort)</code>: This
          stage is repeated for each index added by the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (insert)</code>: This
          stage is repeated for each index added by the
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (log apply index)</code>:
          This stage includes the application of DML log generated while
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> was running.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (flush)</code>: Before
          this stage begins, <code class="literal">WORK_ESTIMATED</code> is
          updated with a more accurate estimate, based on the length of
          the flush list.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (log apply table)</code>:
          This stage includes the application of concurrent DML log
          generated while <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> was
          running. The duration of this phase depends on the extent of
          table changes. This phase is instant if no concurrent DML was
          run on the table.
        </p></li><li class="listitem"><p>
          <code class="literal">stage/innodb/alter table (end)</code>: Includes
          any remaining work that appeared after the flush phase, such
          as reapplying DML that was executed on the table while
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> was running.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        <code class="literal">InnoDB</code> <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
        TABLE</code></a> stage events do not currently account for the
        addition of spatial indexes.
</p>
</div>
<h4><a name="idm140091633864544"></a>ALTER TABLE Monitoring Example Using Performance Schema</h4>
<p>
      The following example demonstrates how to enable the
      <code class="literal">stage/innodb/alter table%</code> stage event
      instruments and related consumer tables to monitor
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> progress. For
      information about Performance Schema stage event instruments and
      related consumers, see
      <a class="xref" href="performance-schema.html#performance-schema-stage-tables" title="26.12.5 Performance Schema Stage Event Tables">Section 26.12.5, “Performance Schema Stage Event Tables”</a>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Enable the <code class="literal">stage/innodb/alter%</code> instruments:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>UPDATE performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>SET ENABLED = 'YES'</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE 'stage/innodb/alter%';</code></strong>
Query OK, 7 rows affected (0.00 sec)
Rows matched: 7  Changed: 7  Warnings: 0
</pre></li><li class="listitem"><p>
          Enable the stage event consumer tables, which include
          <a class="link" href="performance-schema.html#events-stages-current-table" title="26.12.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a>,
          <a class="link" href="performance-schema.html#events-stages-history-table" title="26.12.5.2 The events_stages_history Table"><code class="literal">events_stages_history</code></a>, and
          <a class="link" href="performance-schema.html#events-stages-history-long-table" title="26.12.5.3 The events_stages_history_long Table"><code class="literal">events_stages_history_long</code></a>.
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>UPDATE performance_schema.setup_consumers</code></strong>
       <strong class="userinput"><code>SET ENABLED = 'YES'</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%stages%';</code></strong>
Query OK, 3 rows affected (0.00 sec)
Rows matched: 3  Changed: 3  Warnings: 0
</pre></li><li class="listitem"><p>
          Run an <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation.
          In this example, a <code class="literal">middle_name</code> column is
          added to the employees table of the employees sample database.
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER TABLE employees.employees ADD COLUMN middle_name varchar(14) AFTER first_name;</code></strong>
Query OK, 0 rows affected (9.27 sec)
Records: 0  Duplicates: 0  Warnings: 0
</pre></li><li class="listitem"><p>
          Check the progress of the <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> operation by querying the Performance Schema
          <a class="link" href="performance-schema.html#events-stages-current-table" title="26.12.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a> table. The
          stage event shown differs depending on which
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> phase is currently
          in progress. The <code class="literal">WORK_COMPLETED</code> column
          shows the work completed. The
          <code class="literal">WORK_ESTIMATED</code> column provides an estimate
          of the remaining work.
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT EVENT_NAME, WORK_COMPLETED, WORK_ESTIMATED</code></strong>
       <strong class="userinput"><code>FROM performance_schema.events_stages_current;</code></strong>
+------------------------------------------------------+----------------+----------------+
| EVENT_NAME                                           | WORK_COMPLETED | WORK_ESTIMATED |
+------------------------------------------------------+----------------+----------------+
| stage/innodb/alter table (read PK and internal sort) |            280 |           1245 |
+------------------------------------------------------+----------------+----------------+
1 row in set (0.01 sec)
</pre><p>
          The <a class="link" href="performance-schema.html#events-stages-current-table" title="26.12.5.1 The events_stages_current Table"><code class="literal">events_stages_current</code></a> table
          returns an empty set if the <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a> operation has completed. In this case, you can
          check the <a class="link" href="performance-schema.html#events-stages-history-table" title="26.12.5.2 The events_stages_history Table"><code class="literal">events_stages_history</code></a>
          table to view event data for the completed operation. For
          example:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT EVENT_NAME, WORK_COMPLETED, WORK_ESTIMATED</code></strong>
       <strong class="userinput"><code>FROM performance_schema.events_stages_history;</code></strong>
+------------------------------------------------------+----------------+----------------+
| EVENT_NAME                                           | WORK_COMPLETED | WORK_ESTIMATED |
+------------------------------------------------------+----------------+----------------+
| stage/innodb/alter table (read PK and internal sort) |            886 |           1213 |
| stage/innodb/alter table (flush)                     |           1213 |           1213 |
| stage/innodb/alter table (log apply table)           |           1597 |           1597 |
| stage/innodb/alter table (end)                       |           1597 |           1597 |
| stage/innodb/alter table (log apply table)           |           1981 |           1981 |
+------------------------------------------------------+----------------+----------------+
5 rows in set (0.00 sec)
</pre><p>
          As shown above, the <code class="literal">WORK_ESTIMATED</code> value
          was revised during <code class="literal">ALTER TABLE</code> processing.
          The estimated work after completion of the initial stage is
          1213. When <code class="literal">ALTER TABLE</code> processing
          completed, <code class="literal">WORK_ESTIMATED</code> was set to the
          actual value, which is 1981.
</p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="monitor-innodb-mutex-waits-performance-schema"></a>15.15.2 Monitoring InnoDB Mutex Waits Using Performance Schema</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633821040"></a><a class="indexterm" name="idm140091633819552"></a><p>
      A mutex is a synchronization mechanism used in the code to enforce
      that only one thread at a given time can have access to a common
      resource. When two or more threads executing in the server need to
      access the same resource, the threads compete against each other.
      The first thread to obtain a lock on the mutex causes the other
      threads to wait until the lock is released.
    </p><p>
      For <code class="literal">InnoDB</code> mutexes that are instrumented, mutex
      waits can be monitored using
      <a class="link" href="performance-schema.html" title="Chapter 26 MySQL Performance Schema">Performance Schema</a>. Wait
      event data collected in Performance Schema tables can help
      identify mutexes with the most waits or the greatest total wait
      time, for example.
    </p><p>
      The following example demonstrates how to enable
      <code class="literal">InnoDB</code> mutex wait instruments, how to enable
      associated consumers, and how to query wait event data.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          To view available <code class="literal">InnoDB</code> mutex wait
          instruments, query the Performance Schema
          <a class="link" href="performance-schema.html#setup-instruments-table" title="26.12.2.3 The setup_instruments Table"><code class="literal">setup_instruments</code></a> table. All
          <code class="literal">InnoDB</code> mutex wait instruments are disabled
          by default.
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%wait/synch/mutex/innodb%';</code></strong>
+---------------------------------------------------------+---------+-------+
| NAME                                                    | ENABLED | TIMED |
+---------------------------------------------------------+---------+-------+
| wait/synch/mutex/innodb/commit_cond_mutex               | NO      | NO    |
| wait/synch/mutex/innodb/innobase_share_mutex            | NO      | NO    |
| wait/synch/mutex/innodb/autoinc_mutex                   | NO      | NO    |
| wait/synch/mutex/innodb/autoinc_persisted_mutex         | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_flush_state_mutex      | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_LRU_list_mutex         | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_free_list_mutex        | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_zip_free_mutex         | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_zip_hash_mutex         | NO      | NO    |
| wait/synch/mutex/innodb/buf_pool_zip_mutex              | NO      | NO    |
| wait/synch/mutex/innodb/cache_last_read_mutex           | NO      | NO    |
| wait/synch/mutex/innodb/dict_foreign_err_mutex          | NO      | NO    |
| wait/synch/mutex/innodb/dict_persist_dirty_tables_mutex | NO      | NO    |
| wait/synch/mutex/innodb/dict_sys_mutex                  | NO      | NO    |
| wait/synch/mutex/innodb/recalc_pool_mutex               | NO      | NO    |
| wait/synch/mutex/innodb/fil_system_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/flush_list_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/fts_bg_threads_mutex            | NO      | NO    |
| wait/synch/mutex/innodb/fts_delete_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/fts_optimize_mutex              | NO      | NO    |
| wait/synch/mutex/innodb/fts_doc_id_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/log_flush_order_mutex           | NO      | NO    |
| wait/synch/mutex/innodb/hash_table_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/ibuf_bitmap_mutex               | NO      | NO    |
| wait/synch/mutex/innodb/ibuf_mutex                      | NO      | NO    |
| wait/synch/mutex/innodb/ibuf_pessimistic_insert_mutex   | NO      | NO    |
| wait/synch/mutex/innodb/log_sys_mutex                   | NO      | NO    |
| wait/synch/mutex/innodb/log_sys_write_mutex             | NO      | NO    |
| wait/synch/mutex/innodb/mutex_list_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/page_zip_stat_per_index_mutex   | NO      | NO    |
| wait/synch/mutex/innodb/purge_sys_pq_mutex              | NO      | NO    |
| wait/synch/mutex/innodb/recv_sys_mutex                  | NO      | NO    |
| wait/synch/mutex/innodb/recv_writer_mutex               | NO      | NO    |
| wait/synch/mutex/innodb/redo_rseg_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/noredo_rseg_mutex               | NO      | NO    |
| wait/synch/mutex/innodb/rw_lock_list_mutex              | NO      | NO    |
| wait/synch/mutex/innodb/rw_lock_mutex                   | NO      | NO    |
| wait/synch/mutex/innodb/srv_dict_tmpfile_mutex          | NO      | NO    |
| wait/synch/mutex/innodb/srv_innodb_monitor_mutex        | NO      | NO    |
| wait/synch/mutex/innodb/srv_misc_tmpfile_mutex          | NO      | NO    |
| wait/synch/mutex/innodb/srv_monitor_file_mutex          | NO      | NO    |
| wait/synch/mutex/innodb/buf_dblwr_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/trx_undo_mutex                  | NO      | NO    |
| wait/synch/mutex/innodb/trx_pool_mutex                  | NO      | NO    |
| wait/synch/mutex/innodb/trx_pool_manager_mutex          | NO      | NO    |
| wait/synch/mutex/innodb/srv_sys_mutex                   | NO      | NO    |
| wait/synch/mutex/innodb/lock_mutex                      | NO      | NO    |
| wait/synch/mutex/innodb/lock_wait_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/trx_mutex                       | NO      | NO    |
| wait/synch/mutex/innodb/srv_threads_mutex               | NO      | NO    |
| wait/synch/mutex/innodb/rtr_active_mutex                | NO      | NO    |
| wait/synch/mutex/innodb/rtr_match_mutex                 | NO      | NO    |
| wait/synch/mutex/innodb/rtr_path_mutex                  | NO      | NO    |
| wait/synch/mutex/innodb/rtr_ssn_mutex                   | NO      | NO    |
| wait/synch/mutex/innodb/trx_sys_mutex                   | NO      | NO    |
| wait/synch/mutex/innodb/zip_pad_mutex                   | NO      | NO    |
| wait/synch/mutex/innodb/master_key_id_mutex             | NO      | NO    |
+---------------------------------------------------------+---------+-------+
</pre></li><li class="listitem"><p>
          Some <code class="literal">InnoDB</code> mutex instances are created at
          server startup and are only instrumented if the associated
          instrument is also enabled at server startup. To ensure that
          all <code class="literal">InnoDB</code> mutex instances are instrumented
          and enabled, add the following
          <code class="literal">performance-schema-instrument</code> rule to your
          MySQL configuration file:
        </p><pre data-lang="ini" class="programlisting">
performance-schema-instrument='wait/synch/mutex/innodb/%=ON'
</pre><p>
          If you do not require wait event data for all
          <code class="literal">InnoDB</code> mutexes, you can disable specific
          instruments by adding additional
          <code class="literal">performance-schema-instrument</code> rules to your
          MySQL configuration file. For example, to disable
          <code class="literal">InnoDB</code> mutex wait event instruments related
          to full-text search, add the following rule:
        </p><pre data-lang="ini" class="programlisting">
performance-schema-instrument='wait/synch/mutex/innodb/fts%=OFF'
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Rules with a longer prefix such as
            <code class="literal">wait/synch/mutex/innodb/fts%</code> take
            precedence over rules with shorter prefixes such as
            <code class="literal">wait/synch/mutex/innodb/%</code>.
</p>
</div>
<p>
          After adding the
          <code class="literal">performance-schema-instrument</code> rules to your
          configuration file, restart the server. All the
          <code class="literal">InnoDB</code> mutexes except for those related to
          full text search are enabled. To verify, query the
          <a class="link" href="performance-schema.html#setup-instruments-table" title="26.12.2.3 The setup_instruments Table"><code class="literal">setup_instruments</code></a> table. The
          <code class="literal">ENABLED</code> and <code class="literal">TIMED</code>
          columns should be set to <code class="literal">YES</code> for the
          instruments that you enabled.
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%wait/synch/mutex/innodb%';</code></strong>
+-------------------------------------------------------+---------+-------+
| NAME                                                  | ENABLED | TIMED |
+-------------------------------------------------------+---------+-------+
| wait/synch/mutex/innodb/commit_cond_mutex             | YES     | YES   |
| wait/synch/mutex/innodb/innobase_share_mutex          | YES     | YES   |
| wait/synch/mutex/innodb/autoinc_mutex                 | YES     | YES   |
...
| wait/synch/mutex/innodb/master_key_id_mutex           | YES     | YES   |
+-------------------------------------------------------+---------+-------+
49 rows in set (0.00 sec)
</pre></li><li class="listitem"><p>
          Enable wait event consumers by updating the
          <a class="link" href="performance-schema.html#setup-consumers-table" title="26.12.2.2 The setup_consumers Table"><code class="literal">setup_consumers</code></a> table. Wait event
          consumers are disabled by default.
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>UPDATE performance_schema.setup_consumers</code></strong>
       <strong class="userinput"><code>SET enabled = 'YES'</code></strong>
       <strong class="userinput"><code>WHERE name like 'events_waits%';</code></strong>
Query OK, 3 rows affected (0.00 sec)
Rows matched: 3  Changed: 3  Warnings: 0
</pre><p>
          You can verify that wait event consumers are enabled by
          querying the <a class="link" href="performance-schema.html#setup-consumers-table" title="26.12.2.2 The setup_consumers Table"><code class="literal">setup_consumers</code></a>
          table. The <a class="link" href="performance-schema.html#events-waits-current-table" title="26.12.4.1 The events_waits_current Table"><code class="literal">events_waits_current</code></a>,
          <a class="link" href="performance-schema.html#events-waits-history-table" title="26.12.4.2 The events_waits_history Table"><code class="literal">events_waits_history</code></a>, and
          <a class="link" href="performance-schema.html#events-waits-history-long-table" title="26.12.4.3 The events_waits_history_long Table"><code class="literal">events_waits_history_long</code></a>
          consumers should be enabled.
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM performance_schema.setup_consumers;</code></strong>
+----------------------------------+---------+
| NAME                             | ENABLED |
+----------------------------------+---------+
| events_stages_current            | NO      |
| events_stages_history            | NO      |
| events_stages_history_long       | NO      |
| events_statements_current        | YES     |
| events_statements_history        | YES     |
| events_statements_history_long   | NO      |
| events_transactions_current      | YES     |
| events_transactions_history      | YES     |
| events_transactions_history_long | NO      |
| events_waits_current             | YES     |
| events_waits_history             | YES     |
| events_waits_history_long        | YES     |
| global_instrumentation           | YES     |
| thread_instrumentation           | YES     |
| statements_digest                | YES     |
+----------------------------------+---------+
15 rows in set (0.00 sec)
</pre></li><li class="listitem"><p>
          Once instruments and consumers are enabled, run the workload
          that you want to monitor. In this example, the
          <a class="link" href="programs.html#mysqlslap" title="4.5.8 mysqlslap — Load Emulation Client"><span class="command"><strong>mysqlslap</strong></span></a> load emulation client is used to
          simulate a workload.
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>./mysqlslap --auto-generate-sql --concurrency=100 --iterations=10 </code></strong>
       <strong class="userinput"><code>--number-of-queries=1000 --number-char-cols=6 --number-int-cols=6;</code></strong>
</pre></li><li class="listitem"><p>
          Query the wait event data. In this example, wait event data is
          queried from the
          <a class="link" href="performance-schema.html#wait-summary-tables" title="26.12.16.1 Wait Event Summary Tables"><code class="literal">events_waits_summary_global_by_event_name</code></a>
          table which aggregates data found in the
          <a class="link" href="performance-schema.html#events-waits-current-table" title="26.12.4.1 The events_waits_current Table"><code class="literal">events_waits_current</code></a>,
          <a class="link" href="performance-schema.html#events-waits-history-table" title="26.12.4.2 The events_waits_history Table"><code class="literal">events_waits_history</code></a>, and
          <a class="link" href="performance-schema.html#events-waits-history-long-table" title="26.12.4.3 The events_waits_history_long Table"><code class="literal">events_waits_history_long</code></a> tables.
          Data is summarized by event name
          (<code class="literal">EVENT_NAME</code>), which is the name of the
          instrument that produced the event. Summarized data includes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">COUNT_STAR</code>
            </p><p>
              The number of summarized wait events.
            </p></li><li class="listitem"><p>
              <code class="literal">SUM_TIMER_WAIT</code>
            </p><p>
              The total wait time of the summarized timed wait events.
            </p></li><li class="listitem"><p>
              <code class="literal">MIN_TIMER_WAIT</code>
            </p><p>
              The minimum wait time of the summarized timed wait events.
            </p></li><li class="listitem"><p>
              <code class="literal">AVG_TIMER_WAIT</code>
            </p><p>
              The average wait time of the summarized timed wait events.
            </p></li><li class="listitem"><p>
              <code class="literal">MAX_TIMER_WAIT</code>
            </p><p>
              The maximum wait time of the summarized timed wait events.
</p></li></ul>
</div>
<p>
          The following query returns the instrument name
          (<code class="literal">EVENT_NAME</code>), the number of wait events
          (<code class="literal">COUNT_STAR</code>), and the total wait time for
          the events for that instrument
          (<code class="literal">SUM_TIMER_WAIT</code>). Because waits are timed
          in picoseconds (trillionths of a second) by default, wait
          times are divided by 1000000000 to show wait times in
          milliseconds. Data is presented in descending order, by the
          number of summarized wait events
          (<code class="literal">COUNT_STAR</code>). You can adjust the
          <code class="literal">ORDER BY</code> clause to order the data by total
          wait time.
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT EVENT_NAME, COUNT_STAR, SUM_TIMER_WAIT/1000000000 SUM_TIMER_WAIT_MS</code></strong>
       <strong class="userinput"><code>FROM performance_schema.events_waits_summary_global_by_event_name</code></strong>
       <strong class="userinput"><code>WHERE SUM_TIMER_WAIT &gt; 0 AND EVENT_NAME LIKE 'wait/synch/mutex/innodb/%'</code></strong>
       <strong class="userinput"><code>ORDER BY COUNT_STAR DESC;</code></strong>
+---------------------------------------------------------+------------+-------------------+
| EVENT_NAME                                              | COUNT_STAR | SUM_TIMER_WAIT_MS |
+---------------------------------------------------------+------------+-------------------+
| wait/synch/mutex/innodb/trx_mutex                       |     201111 |           23.4719 |
| wait/synch/mutex/innodb/fil_system_mutex                |      62244 |            9.6426 |
| wait/synch/mutex/innodb/redo_rseg_mutex                 |      48238 |            3.1135 |
| wait/synch/mutex/innodb/log_sys_mutex                   |      46113 |            2.0434 |
| wait/synch/mutex/innodb/trx_sys_mutex                   |      35134 |         1068.1588 |
| wait/synch/mutex/innodb/lock_mutex                      |      34872 |         1039.2589 |
| wait/synch/mutex/innodb/log_sys_write_mutex             |      17805 |         1526.0490 |
| wait/synch/mutex/innodb/dict_sys_mutex                  |      14912 |         1606.7348 |
| wait/synch/mutex/innodb/trx_undo_mutex                  |      10634 |            1.1424 |
| wait/synch/mutex/innodb/rw_lock_list_mutex              |       8538 |            0.1960 |
| wait/synch/mutex/innodb/buf_pool_free_list_mutex        |       5961 |            0.6473 |
| wait/synch/mutex/innodb/trx_pool_mutex                  |       4885 |         8821.7496 |
| wait/synch/mutex/innodb/buf_pool_LRU_list_mutex         |       4364 |            0.2077 |
| wait/synch/mutex/innodb/innobase_share_mutex            |       3212 |            0.2650 |
| wait/synch/mutex/innodb/flush_list_mutex                |       3178 |            0.2349 |
| wait/synch/mutex/innodb/trx_pool_manager_mutex          |       2495 |            0.1310 |
| wait/synch/mutex/innodb/buf_pool_flush_state_mutex      |       1318 |            0.2161 |
| wait/synch/mutex/innodb/log_flush_order_mutex           |       1250 |            0.0893 |
| wait/synch/mutex/innodb/buf_dblwr_mutex                 |        951 |            0.0918 |
| wait/synch/mutex/innodb/recalc_pool_mutex               |        670 |            0.0942 |
| wait/synch/mutex/innodb/dict_persist_dirty_tables_mutex |        345 |            0.0414 |
| wait/synch/mutex/innodb/lock_wait_mutex                 |        303 |            0.1565 |
| wait/synch/mutex/innodb/autoinc_mutex                   |        196 |            0.0213 |
| wait/synch/mutex/innodb/autoinc_persisted_mutex         |        196 |            0.0175 |
| wait/synch/mutex/innodb/purge_sys_pq_mutex              |        117 |            0.0308 |
| wait/synch/mutex/innodb/srv_sys_mutex                   |         94 |            0.0077 |
| wait/synch/mutex/innodb/ibuf_mutex                      |         22 |            0.0086 |
| wait/synch/mutex/innodb/recv_sys_mutex                  |         12 |            0.0008 |
| wait/synch/mutex/innodb/srv_innodb_monitor_mutex        |          4 |            0.0009 |
| wait/synch/mutex/innodb/recv_writer_mutex               |          1 |            0.0005 |
+---------------------------------------------------------+------------+-------------------+
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            The preceding result set includes wait event data produced
            during the startup process. To exclude this data, you can
            truncate the
            <a class="link" href="performance-schema.html#wait-summary-tables" title="26.12.16.1 Wait Event Summary Tables"><code class="literal">events_waits_summary_global_by_event_name</code></a>
            table immediately after startup and before running your
            workload. However, the truncate operation itself may produce
            a negligible amount wait event data.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>TRUNCATE performance_schema.events_waits_summary_global_by_event_name;</code></strong>
</pre>
</div>
</li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-monitors"></a>15.16 InnoDB Monitors</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-monitor-types">15.16.1 InnoDB Monitor Types</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-enabling-monitors">15.16.2 Enabling InnoDB Monitors</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-standard-monitor">15.16.3 InnoDB Standard Monitor and Lock Monitor Output</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091633721392"></a><a class="indexterm" name="idm140091633720320"></a><p>
    <code class="literal">InnoDB</code> monitors provide information about the
    <code class="literal">InnoDB</code> internal state. This information is useful
    for performance tuning.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-monitor-types"></a>15.16.1 InnoDB Monitor Types</h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140091633716176"></a><a class="indexterm" name="idm140091633715104"></a><p>
      There are two types of <code class="literal">InnoDB</code> monitor:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The standard <code class="literal">InnoDB</code> Monitor displays the
          following types of information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Work done by the main background thread
            </p></li><li class="listitem"><p>
              Semaphore waits
            </p></li><li class="listitem"><p>
              Data about the most recent foreign key and deadlock errors
            </p></li><li class="listitem"><p>
              Lock waits for transactions
            </p></li><li class="listitem"><p>
              Table and record locks held by active transactions
            </p></li><li class="listitem"><p>
              Pending I/O operations and related statistics
            </p></li><li class="listitem"><p>
              Insert buffer and adaptive hash index statistics
            </p></li><li class="listitem"><p>
              Redo log data
            </p></li><li class="listitem"><p>
              Buffer pool statistics
            </p></li><li class="listitem"><p>
              Row operation data
</p></li></ul>
</div>
</li><li class="listitem"><p>
          The <code class="literal">InnoDB</code> Lock Monitor prints additional
          lock information as part of the standard
          <code class="literal">InnoDB</code> Monitor output.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-enabling-monitors"></a>15.16.2 Enabling InnoDB Monitors</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633698432"></a><a class="indexterm" name="idm140091633696944"></a><p>
      When <code class="literal">InnoDB</code> monitors are enabled for periodic
      output, <code class="literal">InnoDB</code> writes the output to
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server standard error output
      (<code class="literal">stderr</code>) every 15 seconds, approximately.
    </p><p>
      <code class="literal">InnoDB</code> sends the monitor output to
      <code class="literal">stderr</code> rather than to <code class="literal">stdout</code>
      or fixed-size memory buffers to avoid potential buffer overflows.
    </p><p>
      On Windows, <code class="literal">stderr</code> is directed to the default
      log file unless configured otherwise. If you want to direct the
      output to the console window rather than to the error log, start
      the server from a command prompt in a console window with the
      <a class="link" href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option. For more
      information, see <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/error-log-windows.html" target="_top">Error Logging on Windows</a>.
    </p><p>
      On Unix and Unix-like systems, <code class="literal">stderr</code> is
      typically directed to the terminal unless configured otherwise.
      For more information, see <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/error-log-unix.html" target="_top">Error Logging on Unix and Unix-Like Systems</a>.
    </p><p>
      <code class="literal">InnoDB</code> monitors should only be enabled when you
      actually want to see monitor information because output generation
      causes some performance decrement. Also, if monitor output is
      directed to the error log, the log may become quite large if you
      forget to disable the monitor later.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        To assist with troubleshooting, <code class="literal">InnoDB</code>
        temporarily enables standard <code class="literal">InnoDB</code> Monitor
        output under certain conditions. For more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-troubleshooting" title="15.20 InnoDB Troubleshooting">Section 15.20, “InnoDB Troubleshooting”</a>.
</p>
</div>
<p>
      <code class="literal">InnoDB</code> monitor output begins with a header
      containing a timestamp and the monitor name. For example:
    </p><pre data-lang="sql" class="programlisting">
=====================================
2014-10-16 18:37:29 0x7fc2a95c1700 INNODB MONITOR OUTPUT
=====================================
</pre><p>
      The header for the standard <code class="literal">InnoDB</code> Monitor
      (<code class="literal">INNODB MONITOR OUTPUT</code>) is also used for the
      Lock Monitor because the latter produces the same output with the
      addition of extra lock information.
    </p><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a> system
      variables are used to enable the standard
      <code class="literal">InnoDB</code> Monitor and <code class="literal">InnoDB</code>
      Lock Monitor.
    </p><p>
      The <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> privilege is required
      to enable or disable <code class="literal">InnoDB</code> Monitors.
</p>
<h4><a name="idm140091633668064"></a>Enabling the Standard InnoDB Monitor</h4>
<p>
      Enable the standard <code class="literal">InnoDB</code> Monitor by setting
      the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> system
      variable to <code class="literal">ON</code>.
    </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_status_output=ON;
</pre><p>
      To disable the standard <code class="literal">InnoDB</code> Monitor, set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> to
      <code class="literal">OFF</code>.
    </p><p>
      When you shut down the server, the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> variable is
      set to the default <code class="literal">OFF</code> value.
</p>
<h4><a name="idm140091633657744"></a>Enabling the InnoDB Lock Monitor</h4>
<p>
      <code class="literal">InnoDB</code> Lock Monitor data is printed with the
      <code class="literal">InnoDB</code> Standard Monitor output. Both the
      <code class="literal">InnoDB</code> Standard Monitor and
      <code class="literal">InnoDB</code> Lock Monitor must be enabled to have
      <code class="literal">InnoDB</code> Lock Monitor data printed periodically.
    </p><p>
      To enable the <code class="literal">InnoDB</code> Lock Monitor, set the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a> system
      variable to <code class="literal">ON</code>. Both the
      <code class="literal">InnoDB</code> standard Monitor and
      <code class="literal">InnoDB</code> Lock Monitor must be enabled to have
      <code class="literal">InnoDB</code> Lock Monitor data printed periodically:
    </p><pre data-lang="sql" class="programlisting">
SET GLOBAL innodb_status_output=ON;
SET GLOBAL innodb_status_output_locks=ON;
</pre><p>
      To disable the <code class="literal">InnoDB</code> Lock Monitor, set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a> to
      <code class="literal">OFF</code>. Set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> to
      <code class="literal">OFF</code> to also disable the
      <code class="literal">InnoDB</code> Standard Monitor.
    </p><p>
      When you shut down the server, the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output"><code class="literal">innodb_status_output</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a>
      variables are set to the default <code class="literal">OFF</code> value.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        To enable the <code class="literal">InnoDB</code> Lock Monitor for
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> output, you are only required to enable
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_status_output_locks"><code class="literal">innodb_status_output_locks</code></a>.
</p>
</div>
<h4><a name="idm140091633632912"></a>Obtaining Standard InnoDB Monitor Output On Demand</h4>
<p>
      As an alternative to enabling the standard
      <code class="literal">InnoDB</code> Monitor for periodic output, you can
      obtain standard <code class="literal">InnoDB</code> Monitor output on demand
      using the <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
      INNODB STATUS</code></a> SQL statement, which fetches the output to
      your client program. If you are using the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a>
      interactive client, the output is more readable if you replace the
      usual semicolon statement terminator with <code class="literal">\G</code>:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>
</pre><p>
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> output also includes <code class="literal">InnoDB</code>
      Lock Monitor data if the <code class="literal">InnoDB</code> Lock Monitor is
      enabled.
</p>
<h4><a name="idm140091633622080"></a>Directing Standard InnoDB Monitor Output to a Status File</h4>
<p>
      Standard <code class="literal">InnoDB</code> Monitor output can be enabled
      and directed to a status file by specifying the
      <code class="option">--innodb-status-file</code> option at startup. When this
      option is used, <code class="literal">InnoDB</code> creates a file named
      <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
      in the data directory and writes output to it every 15 seconds,
      approximately.
    </p><p>
      <code class="literal">InnoDB</code> removes the status file when the server
      is shut down normally. If an abnormal shutdown occurs, the status
      file may have to be removed manually.
    </p><p>
      The <code class="option">--innodb-status-file</code> option is intended for
      temporary use, as output generation can affect performance, and
      the
      <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
      file can become quite large over time.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-standard-monitor"></a>15.16.3 InnoDB Standard Monitor and Lock Monitor Output</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633613296"></a><a class="indexterm" name="idm140091633611840"></a><a class="indexterm" name="idm140091633610352"></a><a class="indexterm" name="idm140091633609280"></a><p>
      The Lock Monitor is the same as the Standard Monitor except that
      it includes additional lock information. Enabling either monitor
      for periodic output turns on the same output stream, but the
      stream includes extra information if the Lock Monitor is enabled.
      For example, if you enable the Standard Monitor and Lock Monitor,
      that turns on a single output stream. The stream includes extra
      lock information until you disable the Lock Monitor.
    </p><p>
      Standard Monitor output is limited to 1MB when produced using the
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> statement. This limit does not apply to output
      written to server standard error output
      (<code class="literal">stderr</code>).
    </p><p>
      Example Standard Monitor output:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>
*************************** 1. row ***************************
  Type: InnoDB
  Name: 
Status: 
=====================================
2018-04-12 15:14:08 0x7f971c063700 INNODB MONITOR OUTPUT
=====================================
Per second averages calculated from the last 4 seconds
-----------------
BACKGROUND THREAD
-----------------
srv_master_thread loops: 15 srv_active, 0 srv_shutdown, 1122 srv_idle
srv_master_thread log flush and writes: 0
----------
SEMAPHORES
----------
OS WAIT ARRAY INFO: reservation count 24
OS WAIT ARRAY INFO: signal count 24
RW-shared spins 4, rounds 8, OS waits 4
RW-excl spins 2, rounds 60, OS waits 2
RW-sx spins 0, rounds 0, OS waits 0
Spin rounds per wait: 2.00 RW-shared, 30.00 RW-excl, 0.00 RW-sx
------------------------
LATEST FOREIGN KEY ERROR
------------------------
2018-04-12 14:57:24 0x7f97a9c91700 Transaction:
TRANSACTION 7717, ACTIVE 0 sec inserting
mysql tables in use 1, locked 1
4 lock struct(s), heap size 1136, 3 row lock(s), undo log entries 3
MySQL thread id 8, OS thread handle 140289365317376, query id 14 localhost root update
INSERT INTO child VALUES (NULL, 1), (NULL, 2), (NULL, 3), (NULL, 4), (NULL, 5), (NULL, 6)
Foreign key constraint fails for table `test`.`child`:
,
  CONSTRAINT `child_ibfk_1` FOREIGN KEY (`parent_id`) REFERENCES `parent` (`id`) ON DELETE 
  CASCADE ON UPDATE CASCADE
Trying to add in child table, in index par_ind tuple:
DATA TUPLE: 2 fields;
 0: len 4; hex 80000003; asc     ;;
 1: len 4; hex 80000003; asc     ;;

But in parent table `test`.`parent`, in index PRIMARY,
the closest match we can find is record:
PHYSICAL RECORD: n_fields 3; compact format; info bits 0
 0: len 4; hex 80000004; asc     ;;
 1: len 6; hex 000000001e19; asc       ;;
 2: len 7; hex 81000001110137; asc       7;;

------------
TRANSACTIONS
------------
Trx id counter 7748
Purge done for trx's n:o &lt; 7747 undo n:o &lt; 0 state: running but idle
History list length 19
LIST OF TRANSACTIONS FOR EACH SESSION:
---TRANSACTION 421764459790000, not started
0 lock struct(s), heap size 1136, 0 row lock(s)
---TRANSACTION 7747, ACTIVE 23 sec starting index read
mysql tables in use 1, locked 1
LOCK WAIT 2 lock struct(s), heap size 1136, 1 row lock(s)
MySQL thread id 9, OS thread handle 140286987249408, query id 51 localhost root updating
DELETE FROM t WHERE i = 1
------- TRX HAS BEEN WAITING 23 SEC FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 4 page no 4 n bits 72 index GEN_CLUST_INDEX of table `test`.`t` 
trx id 7747 lock_mode X waiting
Record lock, heap no 3 PHYSICAL RECORD: n_fields 4; compact format; info bits 0
 0: len 6; hex 000000000202; asc       ;;
 1: len 6; hex 000000001e41; asc      A;;
 2: len 7; hex 820000008b0110; asc        ;;
 3: len 4; hex 80000001; asc     ;;

------------------
TABLE LOCK table `test`.`t` trx id 7747 lock mode IX
RECORD LOCKS space id 4 page no 4 n bits 72 index GEN_CLUST_INDEX of table `test`.`t` 
trx id 7747 lock_mode X waiting
Record lock, heap no 3 PHYSICAL RECORD: n_fields 4; compact format; info bits 0
 0: len 6; hex 000000000202; asc       ;;
 1: len 6; hex 000000001e41; asc      A;;
 2: len 7; hex 820000008b0110; asc        ;;
 3: len 4; hex 80000001; asc     ;;

--------
FILE I/O
--------
I/O thread 0 state: waiting for i/o request (insert buffer thread)
I/O thread 1 state: waiting for i/o request (log thread)
I/O thread 2 state: waiting for i/o request (read thread)
I/O thread 3 state: waiting for i/o request (read thread)
I/O thread 4 state: waiting for i/o request (read thread)
I/O thread 5 state: waiting for i/o request (read thread)
I/O thread 6 state: waiting for i/o request (write thread)
I/O thread 7 state: waiting for i/o request (write thread)
I/O thread 8 state: waiting for i/o request (write thread)
I/O thread 9 state: waiting for i/o request (write thread)
Pending normal aio reads: [0, 0, 0, 0] , aio writes: [0, 0, 0, 0] ,
 ibuf aio reads:, log i/o's:, sync i/o's:
Pending flushes (fsync) log: 0; buffer pool: 0
833 OS file reads, 605 OS file writes, 208 OS fsyncs
0.00 reads/s, 0 avg bytes/read, 0.00 writes/s, 0.00 fsyncs/s
-------------------------------------
INSERT BUFFER AND ADAPTIVE HASH INDEX
-------------------------------------
Ibuf: size 1, free list len 0, seg size 2, 0 merges
merged operations:
 insert 0, delete mark 0, delete 0
discarded operations:
 insert 0, delete mark 0, delete 0
Hash table size 553253, node heap has 0 buffer(s)
Hash table size 553253, node heap has 1 buffer(s)
Hash table size 553253, node heap has 3 buffer(s)
Hash table size 553253, node heap has 0 buffer(s)
Hash table size 553253, node heap has 0 buffer(s)
Hash table size 553253, node heap has 0 buffer(s)
Hash table size 553253, node heap has 0 buffer(s)
Hash table size 553253, node heap has 0 buffer(s)
0.00 hash searches/s, 0.00 non-hash searches/s
---
LOG
---
Log sequence number          19643450
Log buffer assigned up to    19643450
Log buffer completed up to   19643450
Log written up to            19643450
Log flushed up to            19643450
Added dirty pages up to      19643450
Pages flushed up to          19643450
Last checkpoint at           19643450
129 log i/o's done, 0.00 log i/o's/second
----------------------
BUFFER POOL AND MEMORY
----------------------
Total large memory allocated 2198863872
Dictionary memory allocated 409606
Buffer pool size   131072
Free buffers       130095
Database pages     973
Old database pages 0
Modified db pages  0
Pending reads      0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 0, not young 0
0.00 youngs/s, 0.00 non-youngs/s
Pages read 810, created 163, written 404
0.00 reads/s, 0.00 creates/s, 0.00 writes/s
Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
LRU len: 973, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
----------------------
INDIVIDUAL BUFFER POOL INFO
----------------------
---BUFFER POOL 0
Buffer pool size   65536
Free buffers       65043
Database pages     491
Old database pages 0
Modified db pages  0
Pending reads      0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 0, not young 0
0.00 youngs/s, 0.00 non-youngs/s
Pages read 411, created 80, written 210
0.00 reads/s, 0.00 creates/s, 0.00 writes/s
Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
LRU len: 491, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
---BUFFER POOL 1
Buffer pool size   65536
Free buffers       65052
Database pages     482
Old database pages 0
Modified db pages  0
Pending reads      0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 0, not young 0
0.00 youngs/s, 0.00 non-youngs/s
Pages read 399, created 83, written 194
0.00 reads/s, 0.00 creates/s, 0.00 writes/s
No buffer pool page gets since the last printout
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
LRU len: 482, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--------------
ROW OPERATIONS
--------------
0 queries inside InnoDB, 0 queries in queue
0 read views open inside InnoDB
Process ID=5772, Main thread ID=140286437054208 , state=sleeping
Number of rows inserted 57, updated 354, deleted 4, read 4421
0.00 inserts/s, 0.00 updates/s, 0.00 deletes/s, 0.00 reads/s
----------------------------
END OF INNODB MONITOR OUTPUT
============================
</pre>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-standard-monitor-output-sections"></a>Standard Monitor Output Sections</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091633588208"></a><p>
        For a description of each metric reported by the Standard
        Monitor, refer to the
        <a class="ulink" href="http://dev.mysql.com/doc/mysql-em-plugin/en/myoem-metrics.html" target="_top">Metrics</a>
        chapter in the
        <a class="ulink" href="http://dev.mysql.com/doc/mysql-em-plugin/en/" target="_top">Oracle
        Enterprise Manager for MySQL Database User's Guide</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Status</code>
          </p><p>
            This section shows the timestamp, the monitor name, and the
            number of seconds that per-second averages are based on. The
            number of seconds is the elapsed time between the current
            time and the last time <code class="literal">InnoDB</code> Monitor
            output was printed.
          </p></li><li class="listitem"><p>
            <code class="literal">BACKGROUND THREAD</code>
          </p><p>
            The <code class="literal">srv_master_thread</code> lines shows work
            done by the main background thread.
          </p></li><li class="listitem"><p>
            <code class="literal">SEMAPHORES</code>
          </p><p>
            This section reports threads waiting for a semaphore and
            statistics on how many times threads have needed a spin or a
            wait on a mutex or a rw-lock semaphore. A large number of
            threads waiting for semaphores may be a result of disk I/O,
            or contention problems inside <code class="literal">InnoDB</code>.
            Contention can be due to heavy parallelism of queries or
            problems in operating system thread scheduling. Setting the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
            system variable smaller than the default value might help in
            such situations. The <code class="literal">Spin rounds per wait</code>
            line shows the number of spinlock rounds per OS wait for a
            mutex.
          </p><p>
            Mutex metrics are reported by
            <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
            INNODB MUTEX</code></a>.
          </p></li><li class="listitem"><p>
            <code class="literal">LATEST FOREIGN KEY ERROR</code>
          </p><p>
            This section provides information about the most recent
            foreign key constraint error. It is not present if no such
            error has occurred. The contents include the statement that
            failed as well as information about the constraint that
            failed and the referenced and referencing tables.
          </p></li><li class="listitem"><p>
            <code class="literal">LATEST DETECTED DEADLOCK</code>
          </p><p>
            This section provides information about the most recent
            deadlock. It is not present if no deadlock has occurred. The
            contents show which transactions are involved, the statement
            each was attempting to execute, the locks they have and
            need, and which transaction <code class="literal">InnoDB</code>
            decided to roll back to break the deadlock. The lock modes
            reported in this section are explained in
            <a class="xref" href="innodb-storage-engine.html#innodb-locking" title="15.7.1 InnoDB Locking">Section 15.7.1, “InnoDB Locking”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">TRANSACTIONS</code>
          </p><p>
            If this section reports lock waits, your applications might
            have lock contention. The output can also help to trace the
            reasons for transaction deadlocks.
          </p></li><li class="listitem"><p>
            <code class="literal">FILE I/O</code>
          </p><p>
            This section provides information about threads that
            <code class="literal">InnoDB</code> uses to perform various types of
            I/O. The first few of these are dedicated to general
            <code class="literal">InnoDB</code> processing. The contents also
            display information for pending I/O operations and
            statistics for I/O performance.
          </p><p>
            The number of these threads are controlled by the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>
            parameters. See <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="15.13 InnoDB Startup Options and System Variables">Section 15.13, “InnoDB Startup Options and System Variables”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">INSERT BUFFER AND ADAPTIVE HASH INDEX</code>
          </p><p>
            This section shows the status of the
            <code class="literal">InnoDB</code> insert buffer (also referred to as
            the <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">change buffer</a>)
            and the adaptive hash index.
          </p><p>
            For related information, see
            <a class="xref" href="innodb-storage-engine.html#innodb-change-buffer" title="15.5.2 Change Buffer">Section 15.5.2, “Change Buffer”</a>, and
            <a class="xref" href="innodb-storage-engine.html#innodb-adaptive-hash" title="15.5.3 Adaptive Hash Index">Section 15.5.3, “Adaptive Hash Index”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">LOG</code>
          </p><p>
            This section displays information about the
            <code class="literal">InnoDB</code> log. The contents include the
            current log sequence number, how far the log has been
            flushed to disk, and the position at which
            <code class="literal">InnoDB</code> last took a checkpoint. (See
            <a class="xref" href="innodb-storage-engine.html#innodb-checkpoints" title="15.11.3 InnoDB Checkpoints">Section 15.11.3, “InnoDB Checkpoints”</a>.) The section also
            displays information about pending writes and write
            performance statistics.
          </p></li><li class="listitem"><p>
            <code class="literal">BUFFER POOL AND MEMORY</code>
          </p><p>
            This section gives you statistics on pages read and written.
            You can calculate from these numbers how many data file I/O
            operations your queries currently are doing.
          </p><p>
            For buffer pool statistics descriptions, see
            <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-monitoring" title="Monitoring the Buffer Pool Using the InnoDB Standard Monitor">Monitoring the Buffer Pool Using the InnoDB Standard Monitor</a>. For
            additional information about the operation of the buffer
            pool, see <a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool" title="15.5.1 Buffer Pool">Section 15.5.1, “Buffer Pool”</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">ROW OPERATIONS</code>
          </p><p>
            This section shows what the main thread is doing, including
            the number and performance rate for each type of row
            operation.
</p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-backup-recovery"></a>15.17 InnoDB Backup and Recovery</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-backup">15.17.1 InnoDB Backup</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-recovery">15.17.2 InnoDB Recovery</a></span></dt></dl>
</div>
<p>
    This section covers topics related to <code class="literal">InnoDB</code>
    backup and recovery.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        For information about backup techniques applicable to
        <code class="literal">InnoDB</code>, see <a class="xref" href="innodb-storage-engine.html#innodb-backup" title="15.17.1 InnoDB Backup">Section 15.17.1, “InnoDB Backup”</a>.
      </p></li><li class="listitem"><p>
        For information about point-in-time recovery, recovery from disk
        failure or corruption, and how <code class="literal">InnoDB</code>
        performs crash recovery, see <a class="xref" href="innodb-storage-engine.html#innodb-recovery" title="15.17.2 InnoDB Recovery">Section 15.17.2, “InnoDB Recovery”</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-backup"></a>15.17.1 InnoDB Backup</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633532384"></a><a class="indexterm" name="idm140091633530896"></a><p>
      The key to safe database management is making regular backups.
      Depending on your data volume, number of MySQL servers, and
      database workload, you can use these backup techniques, alone or
      in combination: <a class="link" href="glossary.html#glos_hot_backup" title="hot backup">hot backup</a>
      with <span class="emphasis"><em>MySQL Enterprise Backup</em></span>;
      <a class="link" href="glossary.html#glos_cold_backup" title="cold backup">cold backup</a> by copying
      files while the MySQL server is shut down;
      <a class="link" href="glossary.html#glos_logical_backup" title="logical backup">logical backup</a> with
      <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> for smaller data volumes or to record
      the structure of schema objects. Hot and cold backups are
      <a class="link" href="glossary.html#glos_physical_backup" title="physical backup">physical backups</a> that
      copy actual data files, which can be used directly by the
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server for faster restore.
    </p><p>
      Using <span class="emphasis"><em>MySQL Enterprise Backup</em></span> is the
      recommended method for backing up <code class="literal">InnoDB</code> data.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        <code class="literal">InnoDB</code> does not support databases that are
        restored using third-party backup tools.
</p>
</div>
<h4><a name="idm140091633518960"></a>Hot Backups</h4>
<p>
      The <span class="command"><strong>mysqlbackup</strong></span> command, part of the MySQL
      Enterprise Backup component, lets you back up a running MySQL
      instance, including <code class="literal">InnoDB</code> tables, with minimal
      disruption to operations while producing a consistent snapshot of
      the database. When <span class="command"><strong>mysqlbackup</strong></span> is copying
      <code class="literal">InnoDB</code> tables, reads and writes to
      <code class="literal">InnoDB</code> tables can continue. MySQL Enterprise
      Backup can also create compressed backup files, and back up
      subsets of tables and databases. In conjunction with the MySQL
      binary log, users can perform point-in-time recovery. MySQL
      Enterprise Backup is part of the MySQL Enterprise subscription.
      For more details, see <a class="xref" href="mysql-enterprise.html#mysql-enterprise-backup" title="30.2 MySQL Enterprise Backup Overview">Section 30.2, “MySQL Enterprise Backup Overview”</a>.
</p>
<h4><a name="idm140091633513040"></a>Cold Backups</h4>
<p>
      If you can shut down the MySQL server, you can make a physical
      backup that consists of all files used by
      <code class="literal">InnoDB</code> to manage its tables. Use the following
      procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Perform a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow
          shutdown</a> of the MySQL server and make sure that it
          stops without errors.
        </p></li><li class="listitem"><p>
          Copy all <code class="literal">InnoDB</code> data files
          (<code class="filename">ibdata</code> files and
          <code class="filename">.ibd</code> files) into a safe place.
        </p></li><li class="listitem"><p>
          Copy all <code class="literal">InnoDB</code> log files
          (<code class="filename">ib_logfile</code> files) to a safe place.
        </p></li><li class="listitem"><p>
          Copy your <code class="filename">my.cnf</code> configuration file or
          files to a safe place.
</p></li></ol>
</div>
<h4><a name="idm140091633501632"></a>Logical Backups Using mysqldump</h4>
<p>
      In addition to physical backups, it is recommended that you
      regularly create logical backups by dumping your tables using
      <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>. A binary file might be corrupted
      without you noticing it. Dumped tables are stored into text files
      that are human-readable, so spotting table corruption becomes
      easier. Also, because the format is simpler, the chance for
      serious data corruption is smaller. <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>
      also has a <a class="link" href="programs.html#option_mysqldump_single-transaction"><code class="option">--single-transaction</code></a>
      option for making a consistent snapshot without locking out other
      clients. See <a class="xref" href="backup-and-recovery.html#backup-policy" title="7.3.1 Establishing a Backup Policy">Section 7.3.1, “Establishing a Backup Policy”</a>.
    </p><p>
      Replication works with <a class="link" href="innodb-storage-engine.html" title="Chapter 15 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables,
      so you can use MySQL replication capabilities to keep a copy of
      your database at database sites requiring high availability. See
      <a class="xref" href="innodb-storage-engine.html#innodb-and-mysql-replication" title="15.18 InnoDB and MySQL Replication">Section 15.18, “InnoDB and MySQL Replication”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-recovery"></a>15.17.2 InnoDB Recovery</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633491984"></a><a class="indexterm" name="idm140091633490496"></a><p>
      This section describes <code class="literal">InnoDB</code> recovery. Topics
      include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-recovery-point-in-time" title="Point-in-Time Recovery">Point-in-Time Recovery</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-corruption-disk-failure-recovery" title="Recovery from Data Corruption or Disk Failure">Recovery from Data Corruption or Disk Failure</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-crash-recovery" title="InnoDB Crash Recovery">InnoDB Crash Recovery</a></p></li><li class="listitem"><p><a class="xref" href="innodb-storage-engine.html#innodb-recovery-tablespace-discovery" title="Tablespace Discovery During Crash Recovery">Tablespace Discovery During Crash Recovery</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-recovery-point-in-time"></a>Point-in-Time Recovery</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633482240"></a><a class="indexterm" name="idm140091633480752"></a><p>
        To recover an <code class="literal">InnoDB</code> database to the present
        from the time at which the physical backup was made, you must
        run MySQL server with binary logging enabled, even before taking
        the backup. To achieve point-in-time recovery after restoring a
        backup, you can apply changes from the binary log that occurred
        after the backup was made. See
        <a class="xref" href="backup-and-recovery.html#point-in-time-recovery" title="7.5 Point-in-Time (Incremental) Recovery Using the Binary Log">Section 7.5, “Point-in-Time (Incremental) Recovery Using the Binary Log”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-corruption-disk-failure-recovery"></a>Recovery from Data Corruption or Disk Failure</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633475824"></a><a class="indexterm" name="idm140091633474336"></a><a class="indexterm" name="idm140091633472848"></a><a class="indexterm" name="idm140091633471360"></a><p>
        If your database becomes corrupted or disk failure occurs, you
        must perform the recovery using a backup. In the case of
        corruption, first find a backup that is not corrupted. After
        restoring the base backup, do a point-in-time recovery from the
        binary log files using <a class="link" href="programs.html#mysqlbinlog" title="4.6.8 mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> and
        <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> to restore the changes that occurred
        after the backup was made.
      </p><p>
        In some cases of database corruption, it is enough to dump,
        drop, and re-create one or a few corrupt tables. You can use the
        <a class="link" href="sql-syntax.html#check-table" title="13.7.3.2 CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> statement to check
        whether a table is corrupt, although <a class="link" href="sql-syntax.html#check-table" title="13.7.3.2 CHECK TABLE Syntax"><code class="literal">CHECK
        TABLE</code></a> naturally cannot detect every possible kind of
        corruption.
      </p><p>
        In some cases, apparent database page corruption is actually due
        to the operating system corrupting its own file cache, and the
        data on disk may be okay. It is best to try restarting the
        computer first. Doing so may eliminate errors that appeared to
        be database page corruption. If MySQL still has trouble starting
        because of <code class="literal">InnoDB</code> consistency problems, see
        <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="15.20.2 Forcing InnoDB Recovery">Section 15.20.2, “Forcing InnoDB Recovery”</a> for steps to start the
        instance in recovery mode, which permits you to dump the data.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-crash-recovery"></a>InnoDB Crash Recovery</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633459696"></a><a class="indexterm" name="idm140091633458208"></a><p>
        To recover from a MySQL server crash, the only requirement is to
        restart the MySQL server. <code class="literal">InnoDB</code>
        automatically checks the logs and performs a roll-forward of the
        database to the present. <code class="literal">InnoDB</code> automatically
        rolls back uncommitted transactions that were present at the
        time of the crash. During recovery, <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
        displays output similar to this:
      </p><pre data-lang="none" class="programlisting">
InnoDB: The log sequence number 664050266 in the system tablespace does not match 
the log sequence number 685111586 in the ib_logfiles!
InnoDB: Database was not shutdown normally!
InnoDB: Starting crash recovery.
InnoDB: Using 'tablespaces.open.2' max LSN: 664075228
InnoDB: Doing recovery: scanned up to log sequence number 690354176
InnoDB: Doing recovery: scanned up to log sequence number 695597056
InnoDB: Doing recovery: scanned up to log sequence number 700839936
InnoDB: Doing recovery: scanned up to log sequence number 706082816
InnoDB: Doing recovery: scanned up to log sequence number 711325696
InnoDB: Doing recovery: scanned up to log sequence number 713458156
InnoDB: Applying a batch of 1467 redo log records ...
InnoDB: 10%
InnoDB: 20%
InnoDB: 30%
InnoDB: 40%
InnoDB: 50%
InnoDB: 60%
InnoDB: 70%
InnoDB: 80%
InnoDB: 90%
InnoDB: 100%
InnoDB: Apply batch completed!
InnoDB: 1 transaction(s) which must be rolled back or cleaned up in total 561887 row 
operations to undo
InnoDB: Trx id counter is 4096
...
InnoDB: 8.0.1 started; log sequence number 713458156
InnoDB: Waiting for purge to start
InnoDB: Starting in background the rollback of uncommitted transactions
InnoDB: Rolling back trx with id 3596, 561887 rows to undo
...
./mysqld: ready for connections....
</pre><a class="indexterm" name="idm140091633451072"></a><p>
        <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
        consists of several steps:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Tablespace discovery
          </p><p>
            Tablespace discovery is the process that
            <code class="literal">InnoDB</code> uses to identify tablespaces that
            require redo log application. See
            <a class="xref" href="innodb-storage-engine.html#innodb-recovery-tablespace-discovery" title="Tablespace Discovery During Crash Recovery">Tablespace Discovery During Crash Recovery</a>.
          </p></li><li class="listitem"><p>
            <a class="link" href="glossary.html#glos_redo_log" title="redo log">Redo log</a> application
          </p><p>
            Redo log application is performed during initialization,
            before accepting any connections. If all changes are flushed
            from the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>
            to the <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>
            (<code class="filename">ibdata*</code> and <code class="filename">*.ibd</code>
            files) at the time of the shutdown or crash, redo log
            application is skipped. <code class="literal">InnoDB</code> also skips
            redo log application if redo log files are missing at
            startup.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                The current maximum auto-increment counter value is
                written to the redo log each time the value changes,
                which makes it crash-safe. During recovery,
                <code class="literal">InnoDB</code> scans the redo log to collect
                counter value changes and applies the changes to the
                in-memory table object.
              </p><p>
                For more information about how <code class="literal">InnoDB</code>
                handles auto-increment values, see
                <a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-handling" title="15.6.1.4 AUTO_INCREMENT Handling in InnoDB">Section 15.6.1.4, “AUTO_INCREMENT Handling in InnoDB”</a>, and
                <a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-initialization" title="InnoDB AUTO_INCREMENT Counter Initialization">InnoDB AUTO_INCREMENT Counter Initialization</a>.
              </p></li><li class="listitem"><p>
                When encountering index tree corruption,
                <code class="literal">InnoDB</code> writes a corruption flag to
                the redo log, which makes the corruption flag
                crash-safe. <code class="literal">InnoDB</code> also writes
                in-memory corruption flag data to an engine-private
                system table on each checkpoint. During recovery,
                <code class="literal">InnoDB</code> reads corruption flags from
                both locations and merges results before marking
                in-memory table and index objects as corrupt.
              </p></li><li class="listitem"><p>
                Removing redo logs to speed up recovery is not
                recommended, even if some data loss is acceptable.
                Removing redo logs should only be considered after a
                clean shutdown, with
                <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a>
                set to <code class="literal">0</code> or <code class="literal">1</code>.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            <a class="link" href="glossary.html#glos_rollback" title="rollback">Roll back</a> of incomplete
            <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>
          </p><p>
            Incomplete transactions are any transactions that were
            active at the time of crash or
            <a class="link" href="glossary.html#glos_fast_shutdown" title="fast shutdown">fast shutdown</a>. The
            time it takes to roll back an incomplete transaction can be
            three or four times the amount of time a transaction is
            active before it is interrupted, depending on server load.
          </p><p>
            You cannot cancel transactions that are being rolled back.
            In extreme cases, when rolling back transactions is expected
            to take an exceptionally long time, it may be faster to
            start <code class="literal">InnoDB</code> with an
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a>
            setting of <code class="literal">3</code> or greater. See
            <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="15.20.2 Forcing InnoDB Recovery">Section 15.20.2, “Forcing InnoDB Recovery”</a>.
          </p></li><li class="listitem"><p>
            <a class="link" href="glossary.html#glos_change_buffer" title="change buffer">Change buffer</a>
            merge
          </p><p>
            Applying changes from the change buffer (part of the
            <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
            tablespace</a>) to leaf pages of secondary indexes, as
            the index pages are read to the buffer pool.
          </p></li><li class="listitem"><p>
            <a class="link" href="glossary.html#glos_purge" title="purge">Purge</a>
          </p><p>
            Deleting delete-marked records that are no longer visible to
            active transactions.
</p></li></ul>
</div>
<p>
        The steps that follow redo log application do not depend on the
        redo log (other than for logging the writes) and are performed
        in parallel with normal processing. Of these, only rollback of
        incomplete transactions is special to crash recovery. The insert
        buffer merge and the purge are performed during normal
        processing.
      </p><p>
        After redo log application, <code class="literal">InnoDB</code> attempts
        to accept connections as early as possible, to reduce downtime.
        As part of crash recovery, <code class="literal">InnoDB</code> rolls back
        transactions that were not committed or in <code class="literal">XA
        PREPARE</code> state when the server crashed. The rollback is
        performed by a background thread, executed in parallel with
        transactions from new connections. Until the rollback operation
        is completed, new connections may encounter locking conflicts
        with recovered transactions.
      </p><p>
        In most situations, even if the MySQL server was killed
        unexpectedly in the middle of heavy activity, the recovery
        process happens automatically and no action is required of the
        DBA. If a hardware failure or severe system error corrupted
        <code class="literal">InnoDB</code> data, MySQL might refuse to start. In
        this case, see <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="15.20.2 Forcing InnoDB Recovery">Section 15.20.2, “Forcing InnoDB Recovery”</a>.
      </p><p>
        For information about the binary log and
        <code class="literal">InnoDB</code> crash recovery, see
        <a class="xref" href="server-administration.html#binary-log" title="5.4.4 The Binary Log">Section 5.4.4, “The Binary Log”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-recovery-tablespace-discovery"></a>Tablespace Discovery During Crash Recovery</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633404144"></a><a class="indexterm" name="idm140091633402656"></a><p>
        If, during recovery, <code class="literal">InnoDB</code> encounters redo
        logs written since the last checkpoint, the redo logs must be
        applied to affected tablespaces. The process that identifies
        affected tablespaces during recovery is referred to as
        <span class="emphasis"><em>tablespace discovery</em></span>.
      </p><p>
        Tablespace discovery relies on the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> setting,
        which defines the directories to scan at startup for tablespace
        files. Directories defined by
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>,
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_undo_directory"><code class="literal">innodb_undo_directory</code></a>, and
        <a class="link" href="server-administration.html#sysvar_datadir"><code class="literal">datadir</code></a> are automatically
        appended to the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> argument
        value, regardless of whether the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> option is
        configured explicitly. Tablespace files defined with an absolute
        path or that reside outside of the directories automatically
        appended to the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> setting
        should be added to the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_directories"><code class="literal">innodb_directories</code></a> setting.
        Recovery is terminated if any tablespace file referenced in a
        redo log has not been discovered previously.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-and-mysql-replication"></a>15.18 InnoDB and MySQL Replication</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633386816"></a><p>
    MySQL replication works for <code class="literal">InnoDB</code> tables as it
    does for <code class="literal">MyISAM</code> tables. It is also possible to
    use replication in a way where the storage engine on the slave is
    not the same as the original storage engine on the master. For
    example, you can replicate modifications to an
    <code class="literal">InnoDB</code> table on the master to a
    <code class="literal">MyISAM</code> table on the slave. For more information
    see, <a class="xref" href="replication.html#replication-solutions-diffengines" title="17.3.4 Using Replication with Different Master and Slave Storage Engines">Section 17.3.4, “Using Replication with Different Master and Slave Storage Engines”</a>.
  </p><p>
    For information about setting up a new slave for a master, see
    <a class="xref" href="replication.html#replication-setup-slaves" title="17.1.2.6 Setting Up Replication Slaves">Section 17.1.2.6, “Setting Up Replication Slaves”</a>, and
    <a class="xref" href="replication.html#replication-snapshot-method" title="17.1.2.5 Choosing a Method for Data Snapshots">Section 17.1.2.5, “Choosing a Method for Data Snapshots”</a>. To make a new slave
    without taking down the master or an existing slave, use the
    <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="30.2 MySQL Enterprise Backup Overview">MySQL Enterprise
    Backup</a> product.
  </p><p>
    Transactions that fail on the master do not affect replication at
    all. MySQL replication is based on the binary log where MySQL writes
    SQL statements that modify data. A transaction that fails (for
    example, because of a foreign key violation, or because it is rolled
    back) is not written to the binary log, so it is not sent to slaves.
    See <a class="xref" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax">Section 13.3.1, “START TRANSACTION, COMMIT, and ROLLBACK Syntax”</a>.
  </p><p><b>Replication and CASCADE. </b>
      Cascading actions for <code class="literal">InnoDB</code> tables on the
      master are replicated on the slave <span class="emphasis"><em>only</em></span> if
      the tables sharing the foreign key relation use
      <code class="literal">InnoDB</code> on both the master and slave. This is
      true whether you are using statement-based or row-based
      replication. Suppose that you have started replication, and then
      create two tables on the master using the following
      <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements:
    </p><pre data-lang="sql" class="programlisting">
CREATE TABLE fc1 (
    i INT PRIMARY KEY,
    j INT
) ENGINE = InnoDB;

CREATE TABLE fc2 (
    m INT PRIMARY KEY,
    n INT,
    FOREIGN KEY ni (n) REFERENCES fc1 (i)
        ON DELETE CASCADE
) ENGINE = InnoDB;
</pre><p>
    Suppose that the slave does not have <code class="literal">InnoDB</code>
    support enabled. If this is the case, then the tables on the slave
    are created, but they use the <code class="literal">MyISAM</code> storage
    engine, and the <code class="literal">FOREIGN KEY</code> option is ignored.
    Now we insert some rows into the tables on the master:
  </p><pre data-lang="sql" class="programlisting">
master&gt; <strong class="userinput"><code>INSERT INTO fc1 VALUES (1, 1), (2, 2);</code></strong>
Query OK, 2 rows affected (0.09 sec)
Records: 2  Duplicates: 0  Warnings: 0

master&gt; <strong class="userinput"><code>INSERT INTO fc2 VALUES (1, 1), (2, 2), (3, 1);</code></strong>
Query OK, 3 rows affected (0.19 sec)
Records: 3  Duplicates: 0  Warnings: 0
</pre><p>
    At this point, on both the master and the slave, table
    <code class="literal">fc1</code> contains 2 rows, and table
    <code class="literal">fc2</code> contains 3 rows, as shown here:
  </p><pre data-lang="sql" class="programlisting">
master&gt; <strong class="userinput"><code>SELECT * FROM fc1;</code></strong>
+---+------+
| i | j    |
+---+------+
| 1 |    1 |
| 2 |    2 |
+---+------+
2 rows in set (0.00 sec)

master&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+------+
| m | n    |
+---+------+
| 1 |    1 |
| 2 |    2 |
| 3 |    1 |
+---+------+
3 rows in set (0.00 sec)

slave&gt; <strong class="userinput"><code>SELECT * FROM fc1;</code></strong>
+---+------+
| i | j    |
+---+------+
| 1 |    1 |
| 2 |    2 |
+---+------+
2 rows in set (0.00 sec)

slave&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+------+
| m | n    |
+---+------+
| 1 |    1 |
| 2 |    2 |
| 3 |    1 |
+---+------+
3 rows in set (0.00 sec)
</pre><p>
    Now suppose that you perform the following
    <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statement on the master:
  </p><pre data-lang="sql" class="programlisting">
master&gt; <strong class="userinput"><code>DELETE FROM fc1 WHERE i=1;</code></strong>
Query OK, 1 row affected (0.09 sec)
</pre><p>
    Due to the cascade, table <code class="literal">fc2</code> on the master now
    contains only 1 row:
  </p><pre data-lang="sql" class="programlisting">
master&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+---+
| m | n |
+---+---+
| 2 | 2 |
+---+---+
1 row in set (0.00 sec)
</pre><p>
    However, the cascade does not propagate on the slave because on the
    slave the <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> for
    <code class="literal">fc1</code> deletes no rows from <code class="literal">fc2</code>.
    The slave's copy of <code class="literal">fc2</code> still contains all of the
    rows that were originally inserted:
  </p><pre data-lang="sql" class="programlisting">
slave&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+---+
| m | n |
+---+---+
| 1 | 1 |
| 3 | 1 |
| 2 | 2 |
+---+---+
3 rows in set (0.00 sec)
</pre><p>
    This difference is due to the fact that the cascading deletes are
    handled internally by the <code class="literal">InnoDB</code> storage engine,
    which means that none of the changes are logged.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-memcached"></a>15.19 InnoDB memcached Plugin</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-benefits">15.19.1 Benefits of the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-intro">15.19.2 InnoDB memcached Architecture</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-setup">15.19.3 Setting Up the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-multiple-get-range-query">15.19.4 InnoDB memcached Multiple get and Range Query Support</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-security">15.19.5 Security Considerations for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-developing">15.19.6 Writing Applications for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-replication">15.19.7 The InnoDB memcached Plugin and Replication</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-internals">15.19.8 InnoDB memcached Plugin Internals</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-troubleshoot">15.19.9 Troubleshooting the InnoDB memcached Plugin</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091633344256"></a><p>
    The <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
    (<code class="literal">daemon_memcached</code>) provides an integrated
    <span class="command"><strong>memcached</strong></span> daemon that automatically stores and
    retrieves data from <code class="literal">InnoDB</code> tables, turning the
    MySQL server into a fast <span class="quote">“<span class="quote">key-value store</span>”</span>. Instead of
    formulating queries in SQL, you can use simple
    <code class="literal">get</code>, <code class="literal">set</code>, and
    <code class="literal">incr</code> operations that avoid the performance
    overhead associated with SQL parsing and constructing a query
    optimization plan. You can also access the same
    <code class="literal">InnoDB</code> tables through SQL for convenience,
    complex queries, bulk operations, and other strengths of traditional
    database software.
  </p><p>
    This <span class="quote">“<span class="quote">NoSQL-style</span>”</span> interface uses the
    <span class="command"><strong>memcached</strong></span> API to speed up database operations,
    letting <code class="literal">InnoDB</code> handle memory caching using its
    <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> mechanism. Data
    modified through <span class="command"><strong>memcached</strong></span> operations such as
    <code class="literal">add</code>, <code class="literal">set</code>, and
    <code class="literal">incr</code> are stored to disk, in
    <code class="literal">InnoDB</code> tables. The combination of
    <span class="command"><strong>memcached</strong></span> simplicity and
    <code class="literal">InnoDB</code> reliability and consistency provides users
    with the best of both worlds, as explained in
    <a class="xref" href="innodb-storage-engine.html#innodb-memcached-benefits" title="15.19.1 Benefits of the InnoDB memcached Plugin">Section 15.19.1, “Benefits of the InnoDB memcached Plugin”</a>. For an architectural
    overview, see <a class="xref" href="innodb-storage-engine.html#innodb-memcached-intro" title="15.19.2 InnoDB memcached Architecture">Section 15.19.2, “InnoDB memcached Architecture”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-benefits"></a>15.19.1 Benefits of the InnoDB memcached Plugin</h3>
</div>
</div>
</div>
<p>
      This section outlines advantages the
      <code class="literal">daemon_memcached</code> plugin. The combination of
      <code class="literal">InnoDB</code> tables and <span class="command"><strong>memcached</strong></span>
      offers advantages over using either by themselves.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Direct access to the <code class="literal">InnoDB</code> storage engine
          avoids the parsing and planning overhead of SQL.
        </p></li><li class="listitem"><p>
          Running <span class="command"><strong>memcached</strong></span> in the same process space
          as the MySQL server avoids the network overhead of passing
          requests back and forth.
        </p></li><li class="listitem"><p>
          Data written using the <span class="command"><strong>memcached</strong></span> protocol
          is transparently written to an <code class="literal">InnoDB</code>
          table, without going through the MySQL SQL layer. You can
          control frequency of writes to achieve higher raw performance
          when updating non-critical data.
        </p></li><li class="listitem"><p>
          Data requested through the <span class="command"><strong>memcached</strong></span>
          protocol is transparently queried from an
          <code class="literal">InnoDB</code> table, without going through the
          MySQL SQL layer.
        </p></li><li class="listitem"><p>
          Subsequent requests for the same data is served from the
          <code class="literal">InnoDB</code> buffer pool. The buffer pool handles
          the in-memory caching. You can tune performance of
          data-intensive operations using <code class="literal">InnoDB</code>
          configuration options.
        </p></li><li class="listitem"><p>
          Data can be unstructured or structured, depending on the type
          of application. You can create a new table for data, or use
          existing tables.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> can handle composing and decomposing
          multiple column values into a single
          <span class="command"><strong>memcached</strong></span> item value, reducing the amount
          of string parsing and concatenation required in your
          application. For example, you can store the string value
          <code class="literal">2|4|6|8</code> in the <span class="command"><strong>memcached</strong></span>
          cache, and have <code class="literal">InnoDB</code> split the value
          based on a separator character, then store the result in four
          numeric columns.
        </p></li><li class="listitem"><p>
          The transfer between memory and disk is handled automatically,
          simplifying application logic.
        </p></li><li class="listitem"><p>
          Data is stored in a MySQL database to protect against crashes,
          outages, and corruption.
        </p></li><li class="listitem"><p>
          You can access the underlying <code class="literal">InnoDB</code> table
          through SQL for reporting, analysis, ad hoc queries, bulk
          loading, multi-step transactional computations, set operations
          such as union and intersection, and other operations suited to
          the expressiveness and flexibility of SQL.
        </p></li><li class="listitem"><p>
          You can ensure high availability by using the
          <code class="literal">daemon_memcached</code> plugin on a
          <a class="link" href="glossary.html#glos_master_server" title="master server">master server</a> in
          combination with MySQL replication.
</p></li></ul>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The integration of <span class="command"><strong>memcached</strong></span> with MySQL
          provides a way to make in-memory data persistent, so you can
          use it for more significant kinds of data. You can use more
          <code class="literal">add</code>, <code class="literal">incr</code>, and similar
          write operations in your application without concern that data
          could be lost. You can stop and start the
          <span class="command"><strong>memcached</strong></span> server without losing updates
          made to cached data. To guard against unexpected outages, you
          can take advantage of <code class="literal">InnoDB</code> crash
          recovery, replication, and backup capabilities.
        </p></li><li class="listitem"><p>
          The way <code class="literal">InnoDB</code> does fast
          <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> lookups is
          a natural fit for <span class="command"><strong>memcached</strong></span> single-item
          queries. The direct, low-level database access path used by
          the <code class="literal">daemon_memcached</code> plugin is much more
          efficient for key-value lookups than equivalent SQL queries.
        </p></li><li class="listitem"><p>
          The serialization features of <span class="command"><strong>memcached</strong></span>,
          which can turn complex data structures, binary files, or even
          code blocks into storeable strings, offer a simple way to get
          such objects into a database.
        </p></li><li class="listitem"><p>
          Because you can access the underlying data through SQL, you
          can produce reports, search or update across multiple keys,
          and call functions such as <code class="literal">AVG()</code> and
          <code class="literal">MAX()</code> on <span class="command"><strong>memcached</strong></span> data.
          All of these operations are expensive or complicated using
          <span class="command"><strong>memcached</strong></span> by itself.
        </p></li><li class="listitem"><p>
          You do not need to manually load data into
          <span class="command"><strong>memcached</strong></span> at startup. As particular keys
          are requested by an application, values are retrieved from the
          database automatically, and cached in memory using the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>.
        </p></li><li class="listitem"><p>
          Because <span class="command"><strong>memcached</strong></span> consumes relatively
          little CPU, and its memory footprint is easy to control, it
          can run comfortably alongside a MySQL instance on the same
          system.
        </p></li><li class="listitem"><p>
          Because data consistency is enforced by mechanisms used for
          regular <code class="literal">InnoDB</code> tables, you do not have to
          worry about stale <span class="command"><strong>memcached</strong></span> data or
          fallback logic to query the database in the case of a missing
          key.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-intro"></a>15.19.2 InnoDB memcached Architecture</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633275520"></a><p>
      The <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
      implements <span class="command"><strong>memcached</strong></span> as a MySQL plugin daemon
      that accesses the <code class="literal">InnoDB</code> storage engine
      directly, bypassing the MySQL SQL layer.
    </p><p>
      The following diagram illustrates how an application accesses data
      through the <code class="literal">daemon_memcached</code> plugin, compared
      with SQL.
</p>
<div class="figure">
<a name="innodb-memcached-architecture-diagram"></a><p class="title"><b>Figure 15.4 MySQL Server with Integrated <span class="command">memcached</span> Server</b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="images/innodb_memcached2.jpg" width="739" height="552" alt="Shows an application accessing data in the InnoDB storage engine using both SQL and the memcached protocol. Using SQL, the application accesses data through the MySQL Server and Handler API. Using the memcached protocol, the application bypasses the MySQL Server, accessing data through the memcached plugin and InnoDB API. The memcached plugin is comprised of the innodb_memcache interface and optional local cache.">
</div>

</div>

</div>
<br class="figure-break"><p>
      Features of the <code class="literal">daemon_memcached</code> plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="command"><strong>memcached</strong></span> as a daemon plugin of
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>. Both <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> and
          <span class="command"><strong>memcached</strong></span> run in the same process space,
          with very low latency access to data.
        </p></li><li class="listitem"><p>
          Direct access to <code class="literal">InnoDB</code> tables, bypassing
          the SQL parser, the optimizer, and even the Handler API layer.
        </p></li><li class="listitem"><p>
          Standard <span class="command"><strong>memcached</strong></span> protocols, including the
          text-based protocol and the binary protocol. The
          <code class="literal">daemon_memcached</code> plugin passes all 55
          compatibility tests of the <span class="command"><strong>memcapable</strong></span>
          command.
        </p></li><li class="listitem"><p>
          Multi-column support. You can map multiple columns into the
          <span class="quote">“<span class="quote">value</span>”</span> part of the key-value store, with column
          values delimited by a user-specified separator character.
        </p></li><li class="listitem"><p>
          By default, the <span class="command"><strong>memcached</strong></span> protocol is used
          to read and write data directly to <code class="literal">InnoDB</code>,
          letting MySQL manage in-memory caching using the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. The
          default settings represent a combination of high reliability
          and the fewest surprises for database applications. For
          example, default settings avoid uncommitted data on the
          database side, or stale data returned for
          <span class="command"><strong>memcached</strong></span> <code class="literal">get</code> requests.
        </p></li><li class="listitem"><p>
          Advanced users can configure the system as a traditional
          <span class="command"><strong>memcached</strong></span> server, with all data cached only
          in the <span class="command"><strong>memcached</strong></span> engine (memory caching),
          or use a combination of the
          <span class="quote">“<span class="quote"><span class="command"><strong>memcached</strong></span> engine</span>”</span> (memory
          caching) and the <code class="literal">InnoDB</code>
          <span class="command"><strong>memcached</strong></span> engine (<code class="literal">InnoDB</code>
          as back-end persistent storage).
</p></li></ul>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Control over how often data is passed back and forth between
          <code class="literal">InnoDB</code> and <span class="command"><strong>memcached</strong></span>
          operations through the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_bk_commit_interval"><code class="literal">innodb_api_bk_commit_interval</code></a>,
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>,
          and
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
          configuration options. Batch size options default to a value
          of 1 for maximum reliability.
        </p></li><li class="listitem"><p>
          The ability to specify <span class="command"><strong>memcached</strong></span> options
          through the
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
          configuration parameter. For example, you can change the port
          that <span class="command"><strong>memcached</strong></span> listens on, reduce the
          maximum number of simultaneous connections, change the maximum
          memory size for a key-value pair, or enable debugging messages
          for the error log.
        </p></li><li class="listitem"><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level"><code class="literal">innodb_api_trx_level</code></a>
          configuration option controls the transaction
          <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a> on
          queries processed by <span class="command"><strong>memcached</strong></span>. Although
          <span class="command"><strong>memcached</strong></span> has no concept of
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, you can
          use this option to control how soon
          <span class="command"><strong>memcached</strong></span> sees changes caused by SQL
          statements issued on the table used by the
          <span class="command"><strong>daemon_memcached</strong></span> plugin. By default,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level"><code class="literal">innodb_api_trx_level</code></a> is set
          to <a class="link" href="innodb-storage-engine.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>.
        </p></li><li class="listitem"><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_mdl"><code class="literal">innodb_api_enable_mdl</code></a>
          option can be used to lock the table at the MySQL level, so
          that the mapped table cannot be dropped or altered by
          <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> through the SQL interface.
          Without the lock, the table can be dropped from the MySQL
          layer, but kept in <code class="literal">InnoDB</code> storage until
          <span class="command"><strong>memcached</strong></span> or some other user stops using
          it. <span class="quote">“<span class="quote">MDL</span>”</span> stands for <span class="quote">“<span class="quote">metadata
          locking</span>”</span>.
</p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-compare-contrast"></a>Differences Between InnoDB memcached and Traditional memcached</h4>

</div>

</div>

</div>
<p>
        You may already be familiar with using
        <span class="command"><strong>memcached</strong></span> with MySQL, as described in
        <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached.html" target="_top">Using MySQL with <span class="command"><strong>memcached</strong></span></a>. This section describes how
        features of the integrated <code class="literal">InnoDB</code>
        <span class="command"><strong>memcached</strong></span> plugin differ from traditional
        <code class="literal">memcached</code>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Installation: The <span class="command"><strong>memcached</strong></span> library comes
            with the MySQL server, making installation and setup
            relatively easy. Installation involves running the
            <code class="filename">innodb_memcached_config.sql</code> script to
            create a <code class="literal">demo_test</code> table for
            <span class="command"><strong>memcached</strong></span> to use, issuing an
            <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statement to
            enable the <code class="literal">daemon_memcached</code> plugin, and
            adding desired <span class="command"><strong>memcached</strong></span> options to a
            MySQL configuration file or startup script. You might still
            install the traditional <span class="command"><strong>memcached</strong></span>
            distribution for additional utilities such as
            <span class="command"><strong>memcp</strong></span>, <span class="command"><strong>memcat</strong></span>, and
            <span class="command"><strong>memcapable</strong></span>.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-install.html" target="_top">Installing <span class="command"><strong>memcached</strong></span></a>.
          </p></li><li class="listitem"><p>
            Deployment: With traditional <span class="command"><strong>memcached</strong></span>,
            it is typical to run large numbers of low-capacity
            <span class="command"><strong>memcached</strong></span> servers. A typical deployment
            of the <code class="literal">daemon_memcached</code> plugin, however,
            involves a smaller number of moderate or high-powered
            servers that are already running MySQL. The benefit of this
            configuration is in improving efficiency of individual
            database servers rather than exploiting unused memory or
            distributing lookups across large numbers of servers. In the
            default configuration, very little memory is used for
            <span class="command"><strong>memcached</strong></span>, and in-memory lookups are
            served from the <code class="literal">InnoDB</code>
            <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, which
            automatically caches the most recently and frequently used
            data. As with a traditional MySQL server instance, keep the
            value of the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
            configuration option as high as practical (without causing
            paging at the OS level), so that as much work as possible is
            performed in memory.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-using-deployment.html" target="_top"><span class="command"><strong>memcached</strong></span> Deployment</a>.
          </p></li><li class="listitem"><p>
            Expiry: By default (that is, using the
            <code class="literal">innodb_only</code> caching policy), the latest
            data from the <code class="literal">InnoDB</code> table is always
            returned, so the expiry options have no practical effect. If
            you change the caching policy to <code class="literal">caching</code>
            or <code class="literal">cache_only</code>, the expiry options work as
            usual, but requested data might be stale if it is updated in
            the underlying table before it expires from the memory
            cache.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-using-expiry.html" target="_top">Data Expiry</a>.
          </p></li><li class="listitem"><p>
            Namespaces: <span class="command"><strong>memcached</strong></span> is like a large
            directory where you give files elaborate names with prefixes
            and suffixes to keep the files from conflicting. The
            <code class="literal">daemon_memcached</code> plugin lets you use
            similar naming conventions for keys, with one addition. Key
            names in the format
            <code class="literal">@@<em class="replaceable"><code>table_id</code></em>.<em class="replaceable"><code>key</code></em></code>.<em class="replaceable"><code>table_id</code></em>
            are decoded to reference a specific a table, using mapping
            data from the <code class="literal">innodb_memcache.containers</code>
            table. The <em class="replaceable"><code>key</code></em> is looked up in or
            written to the specified table.
          </p><p>
            The <code class="literal">@@</code> notation only works for individual
            calls to <code class="literal">get</code>, <code class="literal">add</code>, and
            <code class="literal">set</code> functions, but not others such as
            <code class="literal">incr</code> or <code class="literal">delete</code>. To
            designate a default table for subsequent
            <span class="command"><strong>memcached</strong></span> operations within a session,
            perform a <code class="literal">get</code> request using the
            <code class="literal">@@</code> notation with a
            <code class="literal"><em class="replaceable"><code>table_id</code></em></code>, but
            without the key portion. For example:
          </p><pre data-lang="terminal" class="programlisting">
get @@<em class="replaceable"><code>table_id</code></em>
</pre><p>
            Subsequent <code class="literal">get</code>, <code class="literal">set</code>,
            <code class="literal">incr</code>, <code class="literal">delete</code>, and
            other operations use the table designated by
            <code class="literal"><em class="replaceable"><code>table_id</code></em></code> in
            the <code class="literal">innodb_memcache.containers.name</code>
            column.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-using-namespaces.html" target="_top">Using Namespaces</a>.
          </p></li><li class="listitem"><p>
            Hashing and distribution: The default configuration, which
            uses the <code class="literal">innodb_only</code> caching policy, is
            suitable for a traditional deployment configuration where
            all data is available on all servers, such as a set of
            replication slave servers.
          </p><p>
            If you physically divide data, as in a sharded
            configuration, you can split data across several machines
            running the <code class="literal">daemon_memcached</code> plugin, and
            use the traditional <span class="command"><strong>memcached</strong></span> hashing
            mechanism to route requests to a particular machine. On the
            MySQL side, you would typically let all data be inserted by
            <code class="literal">add</code> requests to
            <span class="command"><strong>memcached</strong></span> so that appropriate values are
            stored in the database on the appropriate server.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-using-hashtypes.html" target="_top"><span class="command"><strong>memcached</strong></span> Hashing/Distribution Types</a>.
          </p></li><li class="listitem"><p>
            Memory usage: By default (with the
            <code class="literal">innodb_only</code> caching policy), the
            <span class="command"><strong>memcached</strong></span> protocol passes information
            back and forth with <code class="literal">InnoDB</code> tables, and
            the <code class="literal">InnoDB</code> buffer pool handles in-memory
            lookups instead of <span class="command"><strong>memcached</strong></span> memory usage
            growing and shrinking. Relatively little memory is used on
            the <span class="command"><strong>memcached</strong></span> side.
          </p><p>
            If you switch the caching policy to
            <code class="literal">caching</code> or <code class="literal">cache_only</code>,
            the normal rules of <span class="command"><strong>memcached</strong></span> memory
            usage apply. Memory for <span class="command"><strong>memcached</strong></span> data
            values is allocated in terms of <span class="quote">“<span class="quote">slabs</span>”</span>. You
            can control slab size and maximum memory used for
            <span class="command"><strong>memcached</strong></span>.
          </p><p>
            Either way, you can monitor and troubleshoot the
            <code class="literal">daemon_memcached</code> plugin using the
            familiar
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-stats.html" target="_top">statistics</a> system,
            accessed through the standard protocol, over a
            <span class="command"><strong>telnet</strong></span> session, for example. Extra
            utilities are not included with the
            <code class="literal">daemon_memcached</code> plugin. You can use the
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-stats-memcached-tool.html" target="_top"><code class="literal">memcached-tool</code>
            script</a> to install a full <span class="command"><strong>memcached</strong></span>
            distribution.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-using-memory.html" target="_top">Memory Allocation within <span class="command"><strong>memcached</strong></span></a>.
          </p></li><li class="listitem"><p>
            Thread usage: MySQL threads and <span class="command"><strong>memcached</strong></span>
            threads co-exist on the same server. Limits imposed on
            threads by the operating system apply to the total number of
            threads.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-using-threads.html" target="_top"><span class="command"><strong>memcached</strong></span> Thread Support</a>.
          </p></li><li class="listitem"><p>
            Log usage: Because the <span class="command"><strong>memcached</strong></span> daemon
            is run alongside the MySQL server and writes to
            <code class="literal">stderr</code>, the <code class="literal">-v</code>,
            <code class="literal">-vv</code>, and <code class="literal">-vvv</code> options
            for logging write output to the MySQL
            <a class="link" href="glossary.html#glos_error_log" title="error log">error log</a>.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-using-logs.html" target="_top"><span class="command"><strong>memcached</strong></span> Logs</a>.
          </p></li><li class="listitem"><p>
            <span class="command"><strong>memcached</strong></span> operations: Familiar
            <span class="command"><strong>memcached</strong></span> operations such as
            <code class="literal">get</code>, <code class="literal">set</code>,
            <code class="literal">add</code>, and <code class="literal">delete</code> are
            available. Serialization (that is, the exact string format
            representing complex data structures) depends on the
            language interface.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-operations.html" target="_top">Basic <span class="command"><strong>memcached</strong></span> Operations</a>.
          </p></li><li class="listitem"><p>
            Using <span class="command"><strong>memcached</strong></span> as a MySQL front end:
            This is the primary purpose of the <code class="literal">InnoDB</code>
            <span class="command"><strong>memcached</strong></span> plugin. An integrated
            <span class="command"><strong>memcached</strong></span> daemon improves application
            performance, and having <code class="literal">InnoDB</code> handle
            data transfers between memory and disk simplifies
            application logic.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-mysql-frontend.html" target="_top">Using <span class="command"><strong>memcached</strong></span> as a MySQL Caching Layer</a>.
          </p></li><li class="listitem"><p>
            Utilities: The MySQL server includes the
            <code class="literal">libmemcached</code> library but not additional
            command-line utilities. To use commands such as
            <span class="command"><strong>memcp</strong></span>, <span class="command"><strong>memcat</strong></span>, and
            <span class="command"><strong>memcapable</strong></span> commands, install a full
            <span class="command"><strong>memcached</strong></span> distribution. When
            <span class="command"><strong>memrm</strong></span> and <span class="command"><strong>memflush</strong></span>
            remove items from the cache, the items are also removed from
            the underlying <code class="literal">InnoDB</code> table.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-interfaces-libmemcached.html#ha-memcached-interfaces-libmemcached-utilities" target="_top"><span class="command"><strong>libmemcached</strong></span> Command-Line Utilities</a>.
          </p></li><li class="listitem"><p>
            Programming interfaces: You can access the MySQL server
            through the <code class="literal">daemon_memcached</code> plugin using
            all supported languages:
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-interfaces-libmemcached.html" target="_top">C and
            C++</a>,
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-interfaces-java.html" target="_top">Java</a>,
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-interfaces-perl.html" target="_top">Perl</a>,
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-interfaces-python.html" target="_top">Python</a>,
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-interfaces-php.html" target="_top">PHP</a>, and
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-interfaces-ruby.html" target="_top">Ruby</a>.
            Specify the server hostname and port as with a traditional
            <span class="command"><strong>memcached</strong></span> server. By default, the
            <code class="literal">daemon_memcached</code> plugin listens on port
            <code class="literal">11211</code>. You can use both the
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-interfaces-protocol.html" target="_top">text and
            binary protocols</a>. You can customize the
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-interfaces-libmemcached.html#ha-memcached-interfaces-libmemcached-behaviors" target="_top">behavior</a>
            of <span class="command"><strong>memcached</strong></span> functions at runtime.
            Serialization (that is, the exact string format representing
            complex data structures) depends on the language interface.
          </p><p>
            For comparison with traditional
            <span class="command"><strong>memcached</strong></span>, see
            <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-interfaces.html" target="_top">Developing a <span class="command"><strong>memcached</strong></span> Application</a>.
          </p></li><li class="listitem"><p>
            Frequently asked questions: MySQL has an extensive FAQ for
            traditional <span class="command"><strong>memcached</strong></span>. The FAQ is mostly
            applicable, except that using <code class="literal">InnoDB</code>
            tables as a storage medium for <span class="command"><strong>memcached</strong></span>
            data means that you can use <span class="command"><strong>memcached</strong></span> for
            more write-intensive applications than before, rather than
            as a read-only cache.
          </p><p>
            See <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-faq.html" target="_top"><span class="command"><strong>memcached</strong></span> FAQ</a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-setup"></a>15.19.3 Setting Up the InnoDB memcached Plugin</h3>

</div>

</div>

</div>
<p>
      This section describes how to set up the
      <code class="literal">daemon_memcached</code> plugin on a MySQL server.
      Because the <span class="command"><strong>memcached</strong></span> daemon is tightly
      integrated with the MySQL server to avoid network traffic and
      minimize latency, you perform this process on each MySQL instance
      that uses this feature.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        Before setting up the <code class="literal">daemon_memcached</code>
        plugin, consult <a class="xref" href="innodb-storage-engine.html#innodb-memcached-security" title="15.19.5 Security Considerations for the InnoDB memcached Plugin">Section 15.19.5, “Security Considerations for the InnoDB memcached Plugin”</a> to
        understand the security procedures required to prevent
        unauthorized access.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-prereqs"></a>Prerequisites</h4>

</div>

</div>

</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">daemon_memcached</code> plugin is only
            supported on Linux, Solaris, and OS X platforms. Other
            operating systems are not supported.
          </p></li><li class="listitem"><p>
            When building MySQL from source, you must build with
            <a class="link" href="installing.html#option_cmake_with_innodb_memcached"><code class="option">-DWITH_INNODB_MEMCACHED=ON</code></a>.
            This build option generates two shared libraries in the
            MySQL plugin directory
            (<a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a>) that are
            required to run the <code class="literal">daemon_memcached</code>
            plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="filename">libmemcached.so</code>: the
                <span class="command"><strong>memcached</strong></span> daemon plugin to MySQL.
              </p></li><li class="listitem"><p>
                <code class="filename">innodb_engine.so</code>: an
                <code class="literal">InnoDB</code> API plugin to
                <span class="command"><strong>memcached</strong></span>.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            <code class="literal">libevent</code> must be installed.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                If you did not build MySQL from source, the
                <code class="literal">libevent</code> library is not included in
                your installation. Use the installation method for your
                operating system to install <code class="literal">libevent</code>
                1.4.12 or later. For example, depending on the operating
                system, you might use <code class="literal">apt-get</code>,
                <code class="literal">yum</code>, or <code class="literal">port
                install</code>. For example, on Ubuntu Linux, use:
              </p><pre data-lang="terminal" class="programlisting">
sudo apt-get install libevent-dev
</pre></li><li class="listitem"><p>
                If you installed MySQL from a source code release,
                <code class="literal">libevent</code> 1.4.12 is bundled with the
                package and is located at the top level of the MySQL
                source code directory. If you use the bundled version of
                <code class="literal">libevent</code>, no action is required. If
                you want to use a local system version of
                <code class="literal">libevent</code>, you must build MySQL with
                the <a class="link" href="installing.html#option_cmake_with_libevent"><code class="option">-DWITH_LIBEVENT</code></a> build
                option set to <code class="literal">system</code> or
                <code class="literal">yes</code>.
</p></li></ul>
</div>
</li></ul>
</div>

</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-memcached-installing"></a>Installing and Configuring the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091633041344"></a><a class="indexterm" name="idm140091633040304"></a><a class="indexterm" name="idm140091633039232"></a>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Configure the <code class="literal">daemon_memcached</code> plugin so
            it can interact with <code class="literal">InnoDB</code> tables by
            running the <code class="filename">innodb_memcached_config.sql</code>
            configuration script, which is located in
            <code class="filename"><em class="replaceable"><code>MYSQL_HOME</code></em>/share</code>.
            This script installs the <code class="literal">innodb_memcache</code>
            database with three required tables
            (<code class="literal">cache_policies</code>,
            <code class="literal">config_options</code>, and
            <code class="literal">containers</code>). It also installs the
            <code class="literal">demo_test</code> sample table in the
            <code class="literal">test</code> database.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>source <em class="replaceable"><code>MYSQL_HOME</code></em>/share/innodb_memcached_config.sql</code></strong>
</pre><p>
            Running the <code class="filename">innodb_memcached_config.sql</code>
            script is a one-time operation. The tables remain in place
            if you later uninstall and re-install the
            <code class="literal">daemon_memcached</code> plugin.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE innodb_memcache;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
+---------------------------+
| Tables_in_innodb_memcache |
+---------------------------+
| cache_policies            |
| config_options            |
| containers                |
+---------------------------+

mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
+----------------+
| Tables_in_test |
+----------------+
| demo_test      |
+----------------+
</pre><p>
            Of these tables, the
            <code class="literal">innodb_memcache.containers</code> table is the
            most important. Entries in the <code class="literal">containers</code>
            table provide a mapping to <code class="literal">InnoDB</code> table
            columns. Each <code class="literal">InnoDB</code> table used with the
            <code class="literal">daemon_memcached</code> plugin requires an entry
            in the <code class="literal">containers</code> table.
          </p><p>
            The <code class="filename">innodb_memcached_config.sql</code> script
            inserts a single entry in the <code class="literal">containers</code>
            table that provides a mapping for the
            <code class="literal">demo_test</code> table. It also inserts a single
            row of data into the <code class="literal">demo_test</code> table.
            This data allows you to immediately verify the installation
            after the setup is completed.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM innodb_memcache.containers\G</code></strong>
*************************** 1. row ***************************
                  name: aaa
             db_schema: test
              db_table: demo_test
           key_columns: c1
         value_columns: c2
                 flags: c3
            cas_column: c4
    expire_time_column: c5
unique_idx_name_on_key: PRIMARY

mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+----+------------------+------+------+------+
| c1 | c2               | c3   | c4   | c5   |
+----+------------------+------+------+------+
| AA | HELLO, HELLO     |    8 |    0 |    0 |
+----+------------------+------+------+------+
</pre><p>
            For more information about
            <code class="literal">innodb_memcache</code> tables and the
            <code class="literal">demo_test</code> sample table, see
            <a class="xref" href="innodb-storage-engine.html#innodb-memcached-internals" title="15.19.8 InnoDB memcached Plugin Internals">Section 15.19.8, “InnoDB memcached Plugin Internals”</a>.
          </p></li><li class="listitem"><p>
            Activate the <code class="literal">daemon_memcached</code> plugin by
            running the <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>
            statement:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN daemon_memcached soname "libmemcached.so";</code></strong>
</pre><p>
            Once the plugin is installed, it is automatically activated
            each time the MySQL server is restarted.
</p></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-snifftest"></a>Verifying the InnoDB and memcached Setup</h4>

</div>

</div>

</div>
<p>
        To verify the <code class="literal">daemon_memcached</code> plugin setup,
        use a <span class="command"><strong>telnet</strong></span> session to issue
        <span class="command"><strong>memcached</strong></span> commands. By default, the
        <span class="command"><strong>memcached</strong></span> daemon listens on port 11211.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Retrieve data from the <code class="literal">test.demo_test</code>
            table. The single row of data in the
            <code class="literal">demo_test</code> table has a key value of
            <code class="literal">AA</code>.
          </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>telnet localhost 11211</code></strong>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
<strong class="userinput"><code>get AA</code></strong>
VALUE AA 8 12
HELLO, HELLO
END
</pre></li><li class="listitem"><p>
            Insert data using a <code class="literal">set</code> command.
          </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>set BB 10 0 16</code></strong>
<strong class="userinput"><code>GOODBYE, GOODBYE</code></strong>
STORED
</pre><p>
            where:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">set</code> is the command to store a value
              </p></li><li class="listitem"><p>
                <code class="literal">BB</code> is the key
              </p></li><li class="listitem"><p>
                <code class="literal">10</code> is a flag for the operation;
                ignored by <span class="command"><strong>memcached</strong></span> but may be used
                by the client to indicate any type of information;
                specify <code class="literal">0</code> if unused
              </p></li><li class="listitem"><p>
                <code class="literal">0</code> is the expiration time (TTL);
                specify <code class="literal">0</code> if unused
              </p></li><li class="listitem"><p>
                <code class="literal">16</code> is the length of the supplied
                value block in bytes
              </p></li><li class="listitem"><p>
                <code class="literal">GOODBYE, GOODBYE</code> is the value that is
                stored
</p></li></ul>
</div>
</li><li class="listitem"><p>
            Verify that the data inserted is stored in MySQL by
            connecting to the MySQL server and querying the
            <code class="literal">test.demo_test</code> table.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+----+------------------+------+------+------+
| c1 | c2               | c3   | c4   | c5   |
+----+------------------+------+------+------+
| AA | HELLO, HELLO     |    8 |    0 |    0 |
| BB | GOODBYE, GOODBYE |   10 |    1 |    0 |
+----+------------------+------+------+------+
</pre></li><li class="listitem"><p>
            Return to the telnet session and retrieve the data that you
            inserted earlier using key <code class="literal">BB</code>.
          </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>get BB</code></strong>
VALUE BB 10 16
GOODBYE, GOODBYE
END
<strong class="userinput"><code>quit</code></strong>
</pre></li></ol>
</div>
<p>
        If you shut down the MySQL server, which also shuts off the
        integrated <span class="command"><strong>memcached</strong></span> server, further attempts
        to access the <span class="command"><strong>memcached</strong></span> data fail with a
        connection error. Normally, the <span class="command"><strong>memcached</strong></span>
        data also disappears at this point, and you would require
        application logic to load the data back into memory when
        <span class="command"><strong>memcached</strong></span> is restarted. However, the
        <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
        automates this process for you.
      </p><p>
        When you restart MySQL, <code class="literal">get</code> operations once
        again return the key-value pairs you stored in the earlier
        <span class="command"><strong>memcached</strong></span> session. When a key is requested
        and the associated value is not already in the memory cache, the
        value is automatically queried from the MySQL
        <code class="literal">test.demo_test</code> table.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-new-table-setup"></a>Creating a New Table and Column Mapping</h4>

</div>

</div>

</div>
<p>
        This example shows how to setup your own
        <code class="literal">InnoDB</code> table with the
        <code class="literal">daemon_memcached</code> plugin.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Create an <code class="literal">InnoDB</code> table. The table must
            have a key column with a unique index. The key column of the
            city table is <code class="literal">city_id</code>, which is defined
            as the primary key. The table must also include columns for
            <code class="literal">flags</code>, <code class="literal">cas</code>, and
            <code class="literal">expiry</code> values. There may be one or more
            value columns. The <code class="literal">city</code> table has three
            value columns (<code class="literal">name</code>,
            <code class="literal">state</code>, <code class="literal">country</code>).
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              There is no special requirement with respect to column
              names as along as a valid mapping is added to the
              <code class="literal">innodb_memcache.containers</code> table.
</p>
</div>
<pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE city (</code></strong>
       <strong class="userinput"><code>city_id VARCHAR(32),</code></strong>
       <strong class="userinput"><code>name VARCHAR(1024),</code></strong>
       <strong class="userinput"><code>state VARCHAR(1024),</code></strong>
       <strong class="userinput"><code>country VARCHAR(1024),</code></strong>
       <strong class="userinput"><code>flags INT,</code></strong>
       <strong class="userinput"><code>cas BIGINT UNSIGNED, </code></strong>
       <strong class="userinput"><code>expiry INT,</code></strong>
       <strong class="userinput"><code>primary key(city_id)</code></strong>
       ) <strong class="userinput"><code>ENGINE=InnoDB;</code></strong>
</pre></li><li class="listitem"><p>
            Add an entry to the
            <code class="literal">innodb_memcache.containers</code> table so that
            the <code class="literal">daemon_memcached</code> plugin knows how to
            access the <code class="literal">InnoDB</code> table. The entry must
            satisfy the <code class="literal">innodb_memcache.containers</code>
            table definition. For a description of each field, see
            <a class="xref" href="innodb-storage-engine.html#innodb-memcached-internals" title="15.19.8 InnoDB memcached Plugin Internals">Section 15.19.8, “InnoDB memcached Plugin Internals”</a>.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>DESCRIBE innodb_memcache.containers;</code></strong>
+------------------------+--------------+------+-----+---------+-------+
| Field                  | Type         | Null | Key | Default | Extra |
+------------------------+--------------+------+-----+---------+-------+
| name                   | varchar(50)  | NO   | PRI | NULL    |       |
| db_schema              | varchar(250) | NO   |     | NULL    |       |
| db_table               | varchar(250) | NO   |     | NULL    |       |
| key_columns            | varchar(250) | NO   |     | NULL    |       |
| value_columns          | varchar(250) | YES  |     | NULL    |       |
| flags                  | varchar(250) | NO   |     | 0       |       |
| cas_column             | varchar(250) | YES  |     | NULL    |       |
| expire_time_column     | varchar(250) | YES  |     | NULL    |       |
| unique_idx_name_on_key | varchar(250) | NO   |     | NULL    |       |
+------------------------+--------------+------+-----+---------+-------+
</pre><p>
            The <code class="literal">innodb_memcache.containers</code> table
            entry for the city table is defined as:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>INSERT INTO `innodb_memcache`.`containers` (</code></strong>
       <strong class="userinput"><code>`name`, `db_schema`, `db_table`, `key_columns`, `value_columns`,</code></strong>
       <strong class="userinput"><code>`flags`, `cas_column`, `expire_time_column`, `unique_idx_name_on_key`)</code></strong>
       <strong class="userinput"><code>VALUES ('default', 'test', 'city', 'city_id', 'name|state|country', </code></strong>
       <strong class="userinput"><code>'flags','cas','expiry','PRIMARY');</code></strong>
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">default</code> is specified for the
                <code class="literal">containers.name</code> column to configure
                the <code class="literal">city</code> table as the default
                <code class="literal">InnoDB</code> table to be used with the
                <code class="literal">daemon_memcached</code> plugin.
              </p></li><li class="listitem"><p>
                Multiple <code class="literal">InnoDB</code> table columns
                (<code class="literal">name</code>, <code class="literal">state</code>,
                <code class="literal">country</code>) are mapped to
                <code class="literal">containers.value_columns</code> using a
                <span class="quote">“<span class="quote">|</span>”</span> delimiter.
              </p></li><li class="listitem"><p>
                The <code class="literal">flags</code>,
                <code class="literal">cas_column</code>, and
                <code class="literal">expire_time_column</code> fields of the
                <code class="literal">innodb_memcache.containers</code> table are
                typically not significant in applications using the
                <code class="literal">daemon_memcached</code> plugin. However, a
                designated <code class="literal">InnoDB</code> table column is
                required for each. When inserting data, specify
                <code class="literal">0</code> for these columns if they are
                unused.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            After updating the
            <code class="literal">innodb_memcache.containers</code> table, restart
            the <code class="literal">daemon_memcache</code> plugin to apply the
            changes.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>UNINSTALL PLUGIN daemon_memcached;</code></strong>

mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN daemon_memcached soname "libmemcached.so";</code></strong>
</pre></li><li class="listitem"><p>
            Using telnet, insert data into the <code class="literal">city</code>
            table using a <span class="command"><strong>memcached</strong></span>
            <code class="literal">set</code> command.
          </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>telnet localhost 11211</code></strong>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
<strong class="userinput"><code>set B 0 0 22</code></strong>
<strong class="userinput"><code>BANGALORE|BANGALORE|IN</code></strong>
STORED
</pre></li><li class="listitem"><p>
            Using MySQL, query the <code class="literal">test.city</code> table to
            verify that the data you inserted was stored.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.city;</code></strong>
+---------+-----------+-----------+---------+-------+------+--------+
| city_id | name      | state     | country | flags | cas  | expiry |
+---------+-----------+-----------+---------+-------+------+--------+
| B       | BANGALORE | BANGALORE | IN      |     0 |    3 |      0 |
+---------+-----------+-----------+---------+-------+------+--------+
</pre></li><li class="listitem"><p>
            Using MySQL, insert additional data into the
            <code class="literal">test.city</code> table.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>INSERT INTO city VALUES ('C','CHENNAI','TAMIL NADU','IN', 0, 0 ,0);</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO city VALUES ('D','DELHI','DELHI','IN', 0, 0, 0);</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO city VALUES ('H','HYDERABAD','TELANGANA','IN', 0, 0, 0);</code></strong>
mysql&gt; <strong class="userinput"><code>INSERT INTO city VALUES ('M','MUMBAI','MAHARASHTRA','IN', 0, 0, 0);</code></strong>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              It is recommended that you specify a value of
              <code class="literal">0</code> for the <code class="literal">flags</code>,
              <code class="literal">cas_column</code>, and
              <code class="literal">expire_time_column</code> fields if they are
              unused.
</p>
</div>
</li><li class="listitem"><p>
            Using telnet, issue a <span class="command"><strong>memcached</strong></span>
            <code class="literal">get</code> command to retrieve data you inserted
            using MySQL.
          </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>get H</code></strong>
VALUE H 0 22
HYDERABAD|TELANGANA|IN
END
</pre></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-configuration"></a>Configuring the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<p>
        Traditional <code class="literal">memcached</code> configuration options
        may be specified in a MySQL configuration file or a
        <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> startup string, encoded in the
        argument of the
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
        configuration parameter. <code class="literal">memcached</code>
        configuration options take effect when the plugin is loaded,
        which occurs each time the MySQL server is started.
      </p><p>
        For example, to make <span class="command"><strong>memcached</strong></span> listen on port
        11222 instead of the default port 11211, specify
        <code class="literal">-p11222</code> as an argument of the
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
        configuration option:
      </p><pre data-lang="terminal" class="programlisting">
mysqld .... --daemon_memcached_option="-p11222"
</pre><p>
        Other <span class="command"><strong>memcached</strong></span> options can be encoded in the
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a> string.
        For example, you can specify options to reduce the maximum
        number of simultaneous connections, change the maximum memory
        size for a key-value pair, or enable debugging messages for the
        error log, and so on.
      </p><p>
        There are also configuration options specific to the
        <code class="literal">daemon_memcached</code> plugin. These include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_name"><code class="literal">daemon_memcached_engine_lib_name</code></a>:
            Specifies the shared library that implements the
            <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
            plugin. The default setting is
            <code class="filename">innodb_engine.so</code>.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_path"><code class="literal">daemon_memcached_engine_lib_path</code></a>:
            The path of the directory containing the shared library that
            implements the <code class="literal">InnoDB</code>
            <span class="command"><strong>memcached</strong></span> plugin. The default is NULL,
            representing the plugin directory.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>:
            Defines the batch commit size for read operations
            (<code class="literal">get</code>). It specifies the number of
            <span class="command"><strong>memcached</strong></span> read operations after which a
            <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> occurs.
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
            is set to 1 by default so that every <code class="literal">get</code>
            request accesses the most recently committed data in the
            <code class="literal">InnoDB</code> table, whether the data was
            updated through <span class="command"><strong>memcached</strong></span> or by SQL. When
            the value is greater than 1, the counter for read operations
            is incremented with each <code class="literal">get</code> call. A
            <code class="literal">flush_all</code> call resets both read and write
            counters.
          </p></li><li class="listitem"><p>
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>:
            Defines the batch commit size for write operations
            (<code class="literal">set</code>, <code class="literal">replace</code>,
            <code class="literal">append</code>, <code class="literal">prepend</code>,
            <code class="literal">incr</code>, <code class="literal">decr</code>, and so
            on).
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            is set to 1 by default so that no uncommitted data is lost
            in case of an outage, and so that SQL queries on the
            underlying table access the most recent data. When the value
            is greater than 1, the counter for write operations is
            incremented for each <code class="literal">add</code>,
            <code class="literal">set</code>, <code class="literal">incr</code>,
            <code class="literal">decr</code>, and <code class="literal">delete</code> call.
            A <code class="literal">flush_all</code> call resets both read and
            write counters.
</p></li></ul>
</div>
<p>
        By default, you do not need to modify
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_name"><code class="literal">daemon_memcached_engine_lib_name</code></a>
        or
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_engine_lib_path"><code class="literal">daemon_memcached_engine_lib_path</code></a>.
        You might configure these options if, for example, you want to
        use a different storage engine for <span class="command"><strong>memcached</strong></span>
        (such as the NDB <span class="command"><strong>memcached</strong></span> engine).
      </p><p>
        <code class="literal">daemon_memcached</code> plugin configuration
        parameters may be specified in the MySQL configuration file or
        in a <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> startup string. They take effect
        when you load the <code class="literal">daemon_memcached</code> plugin.
      </p><p>
        When making changes to <code class="literal">daemon_memcached</code>
        plugin configuration, reload the plugin to apply the changes. To
        do so, issue the following statements:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>UNINSTALL PLUGIN daemon_memcached;</code></strong>

mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN daemon_memcached soname "libmemcached.so";</code></strong>
</pre><p>
        Configuration settings, required tables, and data are preserved
        when the plugin is restarted.
      </p><p>
        For additional information about enabling and disabling plugins,
        see <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-multiple-get-range-query"></a>15.19.4 InnoDB memcached Multiple get and Range Query Support</h3>

</div>

</div>

</div>
<p>
      The <code class="literal">daemon_memcached</code> plugin supports multiple
      get operations (fetching multiple key-value pairs in a single
      <span class="command"><strong>memcached</strong></span> query) and range queries.
</p>
<h4><a name="idm140091632820384"></a>Multiple get Operations</h4>
<p>
      The ability to fetch multiple key-value pairs in a single
      <span class="command"><strong>memcached</strong></span> query improves read performance by
      reducing communication traffic between the client and server. For
      <code class="literal">InnoDB</code>, it means fewer transactions and
      open-table operations.
    </p><p>
      The following example demonstrates multiple-get support. The
      example uses the <code class="literal">test.city</code> table described in
      <a class="xref" href="innodb-storage-engine.html#innodb-memcached-new-table-setup" title="Creating a New Table and Column Mapping">Creating a New Table and Column Mapping</a>.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.city;</code></strong>
+---------+-----------+-------------+---------+-------+------+--------+
| city_id | name      | state       | country | flags | cas  | expiry |
+---------+-----------+-------------+---------+-------+------+--------+
| B       | BANGALORE | BANGALORE   | IN      |     0 |    1 |      0 |
| C       | CHENNAI   | TAMIL NADU  | IN      |     0 |    0 |      0 |
| D       | DELHI     | DELHI       | IN      |     0 |    0 |      0 |
| H       | HYDERABAD | TELANGANA   | IN      |     0 |    0 |      0 |
| M       | MUMBAI    | MAHARASHTRA | IN      |     0 |    0 |      0 |
+---------+-----------+-------------+---------+-------+------+--------+
</pre><p>
      Run a <code class="literal">get</code> command to retrieve all values from
      the <code class="literal">city</code> table. The results are returned in a
      key-value pair sequence.
    </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
<strong class="userinput"><code>get B C D H M</code></strong>
VALUE B 0 22
BANGALORE|BANGALORE|IN
VALUE C 0 21
CHENNAI|TAMIL NADU|IN
VALUE D 0 14
DELHI|DELHI|IN
VALUE H 0 22
HYDERABAD|TELANGANA|IN
VALUE M 0 21
MUMBAI|MAHARASHTRA|IN
END
</pre><p>
      When retrieving multiple values in a single <code class="literal">get</code>
      command, you can switch tables (using
      <code class="literal">@@<em class="replaceable"><code>containers.name</code></em></code>
      notation) to retrieve the value for the first key, but you cannot
      switch tables for subsequent keys. For example, the table switch
      in this example is valid:
    </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>get @@aaa.AA BB</code></strong>
VALUE @@aaa.AA 8 12
HELLO, HELLO
VALUE BB 10 16
GOODBYE, GOODBYE
END
</pre><p>
      Attempting to switch tables again in the same
      <code class="literal">get</code> command to retrieve a key value from a
      different table is not supported.
</p>
<h4><a name="idm140091632802848"></a>Range Queries</h4>
<p>
      For range queries, the <code class="literal">daemon_memcached</code> plugin
      supports the following comparison operators:
      <code class="literal">&lt;</code>, <code class="literal">&gt;</code>,
      <code class="literal">&lt;=</code>, <code class="literal">&gt;=</code>. An operator
      must be preceded by an <code class="literal">@</code> symbol. When a range
      query finds multiple matching key-value pairs, results are
      returned in a key-value pair sequence.
    </p><p>
      The following examples demonstrate range query support. The
      examples use the <code class="literal">test.city</code> table described in
      <a class="xref" href="innodb-storage-engine.html#innodb-memcached-new-table-setup" title="Creating a New Table and Column Mapping">Creating a New Table and Column Mapping</a>.
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.city;</code></strong>
+---------+-----------+-------------+---------+-------+------+--------+
| city_id | name      | state       | country | flags | cas  | expiry |
+---------+-----------+-------------+---------+-------+------+--------+
| B       | BANGALORE | BANGALORE   | IN      |     0 |    1 |      0 |
| C       | CHENNAI   | TAMIL NADU  | IN      |     0 |    0 |      0 |
| D       | DELHI     | DELHI       | IN      |     0 |    0 |      0 |
| H       | HYDERABAD | TELANGANA   | IN      |     0 |    0 |      0 |
| M       | MUMBAI    | MAHARASHTRA | IN      |     0 |    0 |      0 |
+---------+-----------+-------------+---------+-------+------+--------+
</pre><p>
      Open a telnet session:
    </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
</pre><p>
      To get all values greater than <code class="literal">B</code>, enter
      <code class="literal">get @&gt;B</code>:
    </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>get @&gt;B</code></strong>
VALUE C 0 21
CHENNAI|TAMIL NADU|IN
VALUE D 0 14
DELHI|DELHI|IN
VALUE H 0 22
HYDERABAD|TELANGANA|IN
VALUE M 0 21
MUMBAI|MAHARASHTRA|IN
END
</pre><p>
      To get all values less than <code class="literal">M</code>, enter
      <code class="literal">get @&lt;M</code>:
    </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>get @&lt;M</code></strong>
VALUE B 0 22
BANGALORE|BANGALORE|IN
VALUE C 0 21
CHENNAI|TAMIL NADU|IN
VALUE D 0 14
DELHI|DELHI|IN
VALUE H 0 22
HYDERABAD|TELANGANA|IN
END
</pre><p>
      To get all values less than and including <code class="literal">M</code>,
      enter <code class="literal">get @&lt;=M</code>:
    </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>get @&lt;=M</code></strong>
VALUE B 0 22
BANGALORE|BANGALORE|IN
VALUE C 0 21
CHENNAI|TAMIL NADU|IN
VALUE D 0 14
DELHI|DELHI|IN
VALUE H 0 22
HYDERABAD|TELANGANA|IN
VALUE M 0 21
MUMBAI|MAHARASHTRA|IN
</pre><p>
      To get values greater than <code class="literal">B</code> but less than
      <code class="literal">M</code>, enter <code class="literal">get @&gt;B@&lt;M</code>:
    </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>get @&gt;B@&lt;M</code></strong>
VALUE C 0 21
CHENNAI|TAMIL NADU|IN
VALUE D 0 14
DELHI|DELHI|IN
VALUE H 0 22
HYDERABAD|TELANGANA|IN
END
</pre><p>
      A maximum of two comparison operators can be parsed, one being
      either a 'less than' (<code class="literal">@&lt;</code>) or 'less than or
      equal to' (<code class="literal">@&lt;=</code>) operator, and the other
      being either a 'greater than' (<code class="literal">@&gt;</code>) or
      'greater than or equal to' (<code class="literal">@&gt;=</code>) operator.
      Any additional operators are assumed to be part of the key. For
      example, if you issue a <code class="literal">get</code> command with three
      operators, the third operator (<code class="literal">@&gt;C</code>) is
      treated as part of the key, and the <code class="literal">get</code> command
      searches for values smaller than <code class="literal">M</code> and greater
      than <code class="literal">B@&gt;C</code>.
    </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>get @&lt;M@&gt;B@&gt;C</code></strong>
VALUE C 0 21
CHENNAI|TAMIL NADU|IN
VALUE D 0 14
DELHI|DELHI|IN
VALUE H 0 22
HYDERABAD|TELANGANA|IN
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-security"></a>15.19.5 Security Considerations for the InnoDB memcached Plugin</h3>

</div>

</div>

</div>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Caution
</div>
<p>
        Consult this section before deploying the
        <code class="literal">daemon_memcached</code> plugin on a production
        server, or even on a test server if the MySQL instance contains
        sensitive data.
</p>
</div>
<p>
      Because <span class="command"><strong>memcached</strong></span> does not use an
      authentication mechanism by default, and the optional SASL
      authentication is not as strong as traditional DBMS security
      measures, only keep non-sensitive data in the MySQL instance that
      uses the <code class="literal">daemon_memcached</code> plugin, and wall off
      any servers that use this configuration from potential intruders.
      Do not allow <span class="command"><strong>memcached</strong></span> access to these servers
      from the Internet; only allow access from within a firewalled
      intranet, ideally from a subnet whose membership you can restrict.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-memcached-sasl"></a>Password-Protecting memcached Using SASL</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091632759664"></a><a class="indexterm" name="idm140091632758624"></a><a class="indexterm" name="idm140091632757520"></a><a class="indexterm" name="idm140091632756016"></a><a class="indexterm" name="idm140091632754512"></a><p>
        SASL support provides the capability to protect your MySQL
        database from unauthenticated access through
        <span class="command"><strong>memcached</strong></span> clients. This section explains how
        to enable SASL with the <code class="literal">daemon_memcached</code>
        plugin. The steps are almost identical to those performed to
        enabled SASL for a traditional <span class="command"><strong>memcached</strong></span>
        server.
      </p><p>
        SASL stands for <span class="quote">“<span class="quote">Simple Authentication and Security
        Layer</span>”</span>, a standard for adding authentication support to
        connection-based protocols. <span class="command"><strong>memcached</strong></span> added
        SASL support in version 1.4.3.
      </p><p>
        SASL authentication is only supported with the binary protocol.
      </p><p>
        <span class="command"><strong>memcached</strong></span> clients are only able to access
        <code class="literal">InnoDB</code> tables that are registered in the
        <code class="literal">innodb_memcache.containers</code> table. Even
        though a DBA can place access restrictions on such tables,
        access through <span class="command"><strong>memcached</strong></span> applications cannot
        be controlled. For this reason, SASL support is provided to
        control access to <code class="literal">InnoDB</code> tables associated
        with the <code class="literal">daemon_memcached</code> plugin.
      </p><p>
        The following section shows how to build, enable, and test an
        SASL-enabled <code class="literal">daemon_memcached</code> plugin.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-sasl-enabling"></a>Building and Enabling SASL with the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<p>
        By default, an SASL-enabled <code class="literal">daemon_memcached</code>
        plugin is not included in MySQL release packages, since an
        SASL-enabled <code class="literal">daemon_memcached</code> plugin requires
        building <span class="command"><strong>memcached</strong></span> with SASL libraries. To
        enable SASL support, download the MySQL source and rebuild the
        <code class="literal">daemon_memcached</code> plugin after downloading the
        SASL libraries:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Install the SASL development and utility libraries. For
            example, on Ubuntu, use <span class="command"><strong>apt-get</strong></span> to obtain
            the libraries:
          </p><pre data-lang="terminal" class="programlisting">
sudo apt-get -f install libsasl2-2 sasl2-bin libsasl2-2 libsasl2-dev libsasl2-modules
</pre></li><li class="listitem"><p>
            Build the <code class="literal">daemon_memcached</code> plugin shared
            libraries with SASL capability by adding
            <code class="literal">ENABLE_MEMCACHED_SASL=1</code> to your
            <span class="command"><strong>cmake</strong></span> options.
            <span class="command"><strong>memcached</strong></span> also provides <span class="emphasis"><em>simple
            cleartext password support</em></span>, which facilitates
            testing. To enable simple cleartext password support,
            specify the <code class="literal">ENABLE_MEMCACHED_SASL_PWDB=1</code>
            <span class="command"><strong>cmake</strong></span> option.
          </p><p>
            In summary, add following three <span class="command"><strong>cmake</strong></span>
            options:
          </p><pre data-lang="terminal" class="programlisting">
cmake ... -DWITH_INNODB_MEMCACHED=1 -DENABLE_MEMCACHED_SASL=1 -DENABLE_MEMCACHED_SASL_PWDB=1
</pre></li><li class="listitem"><p>
            Install the <code class="literal">daemon_memcached</code> plugin, as
            described in <a class="xref" href="innodb-storage-engine.html#innodb-memcached-setup" title="15.19.3 Setting Up the InnoDB memcached Plugin">Section 15.19.3, “Setting Up the InnoDB memcached Plugin”</a>.
          </p></li><li class="listitem"><p>
            Configure a user name and password file. (This example uses
            <span class="command"><strong>memcached</strong></span> simple cleartext password
            support.)
</p>
<div class="orderedlist">
<ol class="orderedlist" type="a"><li class="listitem"><p>
                In a file, create a user named
                <code class="literal">testname</code> and define the password as
                <code class="literal">testpasswd</code>:
              </p><pre data-lang="terminal" class="programlisting">

echo "testname:testpasswd:::::::" &gt;/home/jy/memcached-sasl-db

</pre></li><li class="listitem"><p>
                Configure the <code class="literal">MEMCACHED_SASL_PWDB</code>
                environment variable to inform
                <code class="literal">memcached</code> of the user name and
                password file:
              </p><pre data-lang="terminal" class="programlisting">
export MEMCACHED_SASL_PWDB=/home/jy/memcached-sasl-db
</pre></li><li class="listitem"><p>
                Inform <code class="literal">memcached</code> that a cleartext
                password is used:
              </p><pre data-lang="terminal" class="programlisting">

echo "mech_list: plain" &gt; /home/jy/work2/msasl/clients/memcached.conf
export SASL_CONF_PATH=/home/jy/work2/msasl/clients

</pre></li></ol>
</div>
</li><li class="listitem"><p>
            Enable SASL by restarting the MySQL server with the
            <span class="command"><strong>memcached</strong></span> <code class="literal">-S</code> option
            encoded in the
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
            configuration parameter:
          </p><pre data-lang="terminal" class="programlisting">
mysqld ... --daemon_memcached_option="-S"
</pre></li><li class="listitem"><p>
            To test the setup, use an SASL-enabled client such as
            <a class="ulink" href="https://code.launchpad.net/~trond-norbye/libmemcached/sasl" target="_top">SASL-enabled
            libmemcached</a>.
          </p><pre data-lang="terminal" class="programlisting">
memcp --servers=localhost:11211 --binary  --username=testname
  --password=<em class="replaceable"><code>password</code></em> myfile.txt

memcat --servers=localhost:11211 --binary --username=testname
  --password=<em class="replaceable"><code>password</code></em> myfile.txt
</pre><p>
            If you specify an incorrect user name or password, the
            operation is rejected with a <code class="literal">memcache error
            AUTHENTICATION FAILURE</code> message. In this case,
            examine the cleartext password set in the
            <code class="filename">memcached-sasl-db</code> file to verify that
            the credentials you supplied are correct.
</p></li></ol>
</div>
<p>
        There are other methods to test SASL authentication with
        <span class="command"><strong>memcached</strong></span>, but the method described above is
        the most straightforward.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-developing"></a>15.19.6 Writing Applications for the InnoDB memcached Plugin</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-porting-mysql">15.19.6.1 Adapting an Existing MySQL Schema for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-porting-memcached">15.19.6.2 Adapting a memcached Application for the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-tuning">15.19.6.3 Tuning InnoDB memcached Plugin Performance</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-txn">15.19.6.4 Controlling Transactional Behavior of the InnoDB memcached Plugin</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-dml">15.19.6.5 Adapting DML Statements to memcached Operations</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-memcached-ddl">15.19.6.6 Performing DML and DDL Statements on the Underlying InnoDB Table</a></span></dt></dl>
</div>
<p>
      Typically, writing an application for the
      <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin
      involves some degree of rewriting or adapting existing code that
      uses MySQL or the <span class="command"><strong>memcached</strong></span> API.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          With the <code class="literal">daemon_memcached</code> plugin, instead
          of many traditional <span class="command"><strong>memcached</strong></span> servers
          running on low-powered machines, you have the same number of
          <span class="command"><strong>memcached</strong></span> servers as MySQL servers, running
          on relatively high-powered machines with substantial disk
          storage and memory. You might reuse some existing code that
          works with the <span class="command"><strong>memcached</strong></span> API, but
          adaptation is likely required due to the different server
          configuration.
        </p></li><li class="listitem"><p>
          The data stored through the
          <code class="literal">daemon_memcached</code> plugin goes into
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a>, or
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns, and must be
          converted to do numeric operations. You can perform the
          conversion on the application side, or by using the
          <code class="literal">CAST()</code> function in queries.
        </p></li><li class="listitem"><p>
          Coming from a database background, you might be used to
          general-purpose SQL tables with many columns. The tables
          accessed by <span class="command"><strong>memcached</strong></span> code likely have only
          a few or even a single column holding data values.
        </p></li><li class="listitem"><p>
          You might adapt parts of your application that perform
          single-row queries, inserts, updates, or deletes, to improve
          performance in critical sections of code. Both
          <a class="link" href="glossary.html#glos_query" title="query">queries</a> (read) and
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> (write) operations can be
          substantially faster when performed through the
          <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
          interface. The performance improvement for writes is typically
          greater than the performance improvement for reads, so you
          might focus on adapting code that performs logging or records
          interactive choices on a website.
</p></li></ul>
</div>
<p>
      The following sections explore these points in more detail.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-porting-mysql"></a>15.19.6.1 Adapting an Existing MySQL Schema for the InnoDB memcached Plugin</h4>
</div>
</div>
</div>
<p>
        Consider these aspects of <span class="command"><strong>memcached</strong></span>
        applications when adapting an existing MySQL schema or
        application to use the <code class="literal">daemon_memcached</code>
        plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="command"><strong>memcached</strong></span> keys cannot contain spaces or
            newlines, because these characters are used as separators in
            the ASCII protocol. If you are using lookup values that
            contain spaces, transform or hash them into values without
            spaces before using them as keys in calls to
            <code class="literal">add()</code>, <code class="literal">set()</code>,
            <code class="literal">get()</code>, and so on. Although theoretically
            these characters are allowed in keys in programs that use
            the binary protocol, you should restrict the characters used
            in keys to ensure compatibility with a broad range of
            clients.
          </p></li><li class="listitem"><p>
            If there is a short numeric
            <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> column
            in an <code class="literal">InnoDB</code> table, use it as the unique
            lookup key for <span class="command"><strong>memcached</strong></span> by converting
            the integer to a string value. If the
            <span class="command"><strong>memcached</strong></span> server is used for multiple
            applications, or with more than one
            <code class="literal">InnoDB</code> table, consider modifying the name
            to ensure that it is unique. For example, prepend the table
            name, or the database name and the table name, before the
            numeric value.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <code class="literal">daemon_memcached</code> plugin supports
              inserts and reads on mapped <code class="literal">InnoDB</code>
              tables that have an <code class="literal">INTEGER</code> defined as
              the primary key.
</p>
</div>
</li><li class="listitem"><p>
            You cannot use a partitioned table for data queried or
            stored using <span class="command"><strong>memcached</strong></span>.
          </p></li><li class="listitem"><p>
            The <span class="command"><strong>memcached</strong></span> protocol passes numeric
            values around as strings. To store numeric values in the
            underlying <code class="literal">InnoDB</code> table, to implement
            counters that can be used in SQL functions such as
            <code class="literal">SUM()</code> or <code class="literal">AVG()</code>, for
            example:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Use <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns with
                enough characters to hold all the digits of the largest
                expected number (and additional characters if
                appropriate for the negative sign, decimal point, or
                both).
              </p></li><li class="listitem"><p>
                In any query that performs arithmetic using column
                values, use the <code class="literal">CAST()</code> function to
                convert the values from string to integer, or to some
                other numeric type. For example:
              </p><pre data-lang="sql" class="programlisting">
# Alphabetic entries are returned as zero.

SELECT CAST(c2 as unsigned integer) FROM demo_test;

# Since there could be numeric values of 0, can't disqualify them.
# Test the string values to find the ones that are integers, and average only those.

SELECT AVG(cast(c2 as unsigned integer)) FROM demo_test
  WHERE c2 BETWEEN '0' and '9999999999';

# Views let you hide the complexity of queries. The results are already converted;
# no need to repeat conversion functions and WHERE clauses each time.

CREATE VIEW numbers AS SELECT c1 KEY, CAST(c2 AS UNSIGNED INTEGER) val
  FROM demo_test WHERE c2 BETWEEN '0' and '9999999999';
SELECT SUM(val) FROM numbers;
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                  Any alphabetic values in the result set are converted
                  into 0 by the call to <code class="literal">CAST()</code>. When
                  using functions such as <code class="literal">AVG()</code>,
                  which depend on the number of rows in the result set,
                  include <code class="literal">WHERE</code> clauses to filter out
                  non-numeric values.
</p>
</div>
</li></ul>
</div>
</li><li class="listitem"><p>
            If the <code class="literal">InnoDB</code> column used as a key could
            have values longer than 250 bytes, hash the value to less
            than 250 bytes.
          </p></li><li class="listitem"><p>
            To use an existing table with the
            <code class="literal">daemon_memcached</code> plugin, define an entry
            for it in the <code class="literal">innodb_memcache.containers</code>
            table. To make that table the default for all
            <span class="command"><strong>memcached</strong></span> requests, specify a value of
            <code class="literal">default</code> in the <code class="literal">name</code>
            column, then restart the MySQL server to make the change
            take effect. If you use multiple tables for different
            classes of <span class="command"><strong>memcached</strong></span> data, set up
            multiple entries in the
            <code class="literal">innodb_memcache.containers</code> table with
            <code class="literal">name</code> values of your choice, then issue a
            <span class="command"><strong>memcached</strong></span> request in the form of
            <code class="literal">get @@<em class="replaceable"><code>name</code></em></code> or
            <code class="literal">set @@<em class="replaceable"><code>name</code></em></code>
            within the application to specify the table to be used for
            subsequent <span class="command"><strong>memcached</strong></span> requests.
          </p><p>
            For an example of using a table other than the predefined
            <code class="literal">test.demo_test</code> table, see
            <a class="xref" href="innodb-storage-engine.html#innodb-memcached-tutorial-python" title="Example 15.13 Using Your Own Table with an InnoDB memcached Application">Example 15.13, “Using Your Own Table with an InnoDB memcached Application”</a>. For the
            required table layout, see
            <a class="xref" href="innodb-storage-engine.html#innodb-memcached-internals" title="15.19.8 InnoDB memcached Plugin Internals">Section 15.19.8, “InnoDB memcached Plugin Internals”</a>.
          </p></li><li class="listitem"><p>
            To use multiple <code class="literal">InnoDB</code> table column
            values with <span class="command"><strong>memcached</strong></span> key-value pairs,
            specify column names separated by comma, semicolon, space,
            or pipe characters in the <code class="literal">value_columns</code>
            field of the <code class="literal">innodb_memcache.containers</code>
            entry for the <code class="literal">InnoDB</code> table. For example,
            specify <code class="literal">col1,col2,col3</code> or
            <code class="literal">col1|col2|col3</code> in the
            <code class="literal">value_columns</code> field.
          </p><p>
            Concatenate the column values into a single string using the
            pipe character as a separator before passing the string to
            <span class="command"><strong>memcached</strong></span> <code class="literal">add</code> or
            <code class="literal">set</code> calls. The string is unpacked
            automatically into the correct column. Each
            <code class="literal">get</code> call returns a single string
            containing the column values that is also delimited by the
            pipe character. You can unpack the values using the
            appropriate application language syntax.
</p></li></ul>
</div>

<div class="example">
<a name="innodb-memcached-tutorial-python"></a><p class="title"><b>Example 15.13 Using Your Own Table with an InnoDB memcached Application</b></p>
<div class="example-contents">
<p>
          This example shows how to use your own table with a sample
          Python application that uses <code class="literal">memcached</code> for
          data manipulation.
        </p><p>
          The example assumes that the
          <code class="literal">daemon_memcached</code> plugin is installed as
          described in <a class="xref" href="innodb-storage-engine.html#innodb-memcached-setup" title="15.19.3 Setting Up the InnoDB memcached Plugin">Section 15.19.3, “Setting Up the InnoDB memcached Plugin”</a>. It also
          assumes that your system is configured to run a Python script
          that uses the <code class="literal">python-memcache</code> module.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Create the <code class="literal">multicol</code> table which stores
              country information including population, area, and driver
              side data (<code class="literal">'R'</code> for right and
              <code class="literal">'L'</code> for left).
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE test;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE `multicol` (</code></strong>
        <strong class="userinput"><code>`country` varchar(128) NOT NULL DEFAULT '',</code></strong>
        <strong class="userinput"><code>`population` varchar(10) DEFAULT NULL,</code></strong>
        <strong class="userinput"><code>`area_sq_km` varchar(9) DEFAULT NULL,</code></strong>
        <strong class="userinput"><code>`drive_side` varchar(1) DEFAULT NULL,</code></strong>
        <strong class="userinput"><code>`c3` int(11) DEFAULT NULL,</code></strong>
        <strong class="userinput"><code>`c4` bigint(20) unsigned DEFAULT NULL,</code></strong>
        <strong class="userinput"><code>`c5` int(11) DEFAULT NULL,</code></strong>
        <strong class="userinput"><code>PRIMARY KEY (`country`)</code></strong>
        <strong class="userinput"><code>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</code></strong>
</pre></li><li class="listitem"><p>
              Insert a record into the
              <code class="literal">innodb_memcache.containers</code> table so
              that the <code class="literal">daemon_memcached</code> plugin can
              access the <code class="literal">multicol</code> table.
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>INSERT INTO innodb_memcache.containers</code></strong>
       <strong class="userinput"><code>(name,db_schema,db_table,key_columns,value_columns,flags,cas_column,</code></strong>
       <strong class="userinput"><code>expire_time_column,unique_idx_name_on_key)</code></strong>
       <strong class="userinput"><code>VALUES</code></strong>
       <strong class="userinput"><code>('bbb','test','multicol','country','population,area_sq_km,drive_side',</code></strong>
       <strong class="userinput"><code>'c3','c4','c5','PRIMARY');</code></strong>

mysql&gt; <strong class="userinput"><code>COMMIT;</code></strong>
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  The <code class="literal">innodb_memcache.containers</code>
                  record for the <code class="literal">multicol</code> table
                  specifies a <code class="literal">name</code> value of
                  <code class="literal">'bbb'</code>, which is the table
                  identifier.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                    If a single <code class="literal">InnoDB</code> table is used
                    for all <span class="command"><strong>memcached</strong></span> applications,
                    the <code class="literal">name</code> value can be set to
                    <code class="literal">default</code> to avoid using
                    <code class="literal">@@</code> notation to switch tables.
</p>
</div>
</li><li class="listitem"><p>
                  The <code class="literal">db_schema</code> column is set to
                  <code class="literal">test</code>, which is the name of the
                  database where the <code class="literal">multicol</code> table
                  resides.
                </p></li><li class="listitem"><p>
                  The <code class="literal">db_table</code> column is set to
                  <code class="literal">multicol</code>, which is the name of the
                  <code class="literal">InnoDB</code> table.
                </p></li><li class="listitem"><p>
                  <code class="literal">key_columns</code> is set to the unique
                  <code class="literal">country</code> column. The
                  <code class="literal">country</code> column is defined as the
                  primary key in the <code class="literal">multicol</code> table
                  definition.
                </p></li><li class="listitem"><p>
                  Rather than a single <code class="literal">InnoDB</code> table
                  column to hold a composite data value, data is divided
                  among three table columns
                  (<code class="literal">population</code>,
                  <code class="literal">area_sq_km</code>, and
                  <code class="literal">drive_side</code>). To accommodate
                  multiple value columns, a comma-separated list of
                  columns is specified in the
                  <code class="literal">value_columns</code> field. The columns
                  defined in the <code class="literal">value_columns</code> field
                  are the columns used when storing or retrieving
                  values.
                </p></li><li class="listitem"><p>
                  Values for the <code class="literal">flags</code>,
                  <code class="literal">expire_time</code>, and
                  <code class="literal">cas_column</code> fields are based on
                  values used in the <code class="literal">demo.test</code> sample
                  table. These fields are typically not significant in
                  applications that use the
                  <code class="literal">daemon_memcached</code> plugin because
                  MySQL keeps data synchronized, and there is no need to
                  worry about data expiring or becoming stale.
                </p></li><li class="listitem"><p>
                  The <code class="literal">unique_idx_name_on_key</code> field is
                  set to <code class="literal">PRIMARY</code>, which refers to the
                  primary index defined on the unique
                  <code class="literal">country</code> column in the
                  <code class="literal">multicol</code> table.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              Copy the sample Python application into a file. In this
              example, the sample script is copied to a file named
              <code class="filename">multicol.py</code>.
            </p><p>
              The sample Python application inserts data into the
              <code class="literal">multicol</code> table and retrieves data for
              all keys, demonstrating how to access an
              <code class="literal">InnoDB</code> table through the
              <code class="literal">daemon_memcached</code> plugin.
            </p><pre data-lang="python" class="programlisting">
import sys, os
import memcache

def connect_to_memcached():
  memc = memcache.Client(['127.0.0.1:11211'], debug=0);
  print "Connected to memcached."
  return memc

def banner(message):
  print
  print "=" * len(message)
  print message
  print "=" * len(message)

country_data = [
("Canada","34820000","9984670","R"),
("USA","314242000","9826675","R"),
("Ireland","6399152","84421","L"),
("UK","62262000","243610","L"),
("Mexico","113910608","1972550","R"),
("Denmark","5543453","43094","R"),
("Norway","5002942","385252","R"),
("UAE","8264070","83600","R"),
("India","1210193422","3287263","L"),
("China","1347350000","9640821","R"),
]

def switch_table(memc,table):
  key = "@@" + table
  print "Switching default table to '" + table + "' by issuing GET for '" + key + "'."
  result = memc.get(key)

def insert_country_data(memc):
  banner("Inserting initial data via memcached interface")
  for item in country_data:
    country = item[0]
    population = item[1]
    area = item[2]
    drive_side = item[3]

    key = country
    value = "|".join([population,area,drive_side])
    print "Key = " + key
    print "Value = " + value

    if memc.add(key,value):
      print "Added new key, value pair."
    else:
      print "Updating value for existing key."
      memc.set(key,value)

def query_country_data(memc):
  banner("Retrieving data for all keys (country names)")
  for item in country_data:
    key = item[0]
    result = memc.get(key)
    print "Here is the result retrieved from the database for key " + key + ":"
    print result
    (m_population, m_area, m_drive_side) = result.split("|")
    print "Unpacked population value: " + m_population
    print "Unpacked area value      : " + m_area
    print "Unpacked drive side value: " + m_drive_side

if __name__ == '__main__':

  memc = connect_to_memcached()
  switch_table(memc,"bbb")
  insert_country_data(memc)
  query_country_data(memc)

  sys.exit(0)
</pre><p>
              Sample Python application notes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  No database authorization is required to run the
                  application, since data manipulation is performed
                  through the <span class="command"><strong>memcached</strong></span> interface.
                  The only required information is the port number on
                  the local system where the
                  <span class="command"><strong>memcached</strong></span> daemon listens.
                </p></li><li class="listitem"><p>
                  To make sure the application uses the
                  <code class="literal">multicol</code> table, the
                  <code class="literal">switch_table()</code> function is called,
                  which performs a dummy <code class="literal">get</code> or
                  <code class="literal">set</code> request using
                  <code class="literal">@@</code> notation. The
                  <code class="literal">name</code> value in the request is
                  <code class="literal">bbb</code>, which is the
                  <code class="literal">multicol</code> table identifier defined
                  in the
                  <code class="literal">innodb_memcache.containers.name</code>
                  field.
                </p><p>
                  A more descriptive <code class="literal">name</code> value might
                  be used in a real-world application. This example
                  simply illustrates that a table identifier is
                  specified rather than the table name in <code class="literal">get
                  @@...</code> requests.
                </p></li><li class="listitem"><p>
                  The utility functions used to insert and query data
                  demonstrate how to turn a Python data structure into
                  pipe-separated values for sending data to MySQL with
                  <code class="literal">add</code> or <code class="literal">set</code>
                  requests, and how to unpack the pipe-separated values
                  returned by <code class="literal">get</code> requests. This
                  extra processing is only required when mapping a
                  single <span class="command"><strong>memcached</strong></span> value to multiple
                  MySQL table columns.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              Run the sample Python application.
            </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>python multicol.py</code></strong>
</pre><p>
              If successful, the sample application returns this output:
            </p><pre data-lang="terminal" class="programlisting">
Connected to memcached.
Switching default table to 'bbb' by issuing GET for '@@bbb'.

==============================================
Inserting initial data via memcached interface
==============================================
Key = Canada
Value = 34820000|9984670|R
Added new key, value pair.
Key = USA
Value = 314242000|9826675|R
Added new key, value pair.
Key = Ireland
Value = 6399152|84421|L
Added new key, value pair.
Key = UK
Value = 62262000|243610|L
Added new key, value pair.
Key = Mexico
Value = 113910608|1972550|R
Added new key, value pair.
Key = Denmark
Value = 5543453|43094|R
Added new key, value pair.
Key = Norway
Value = 5002942|385252|R
Added new key, value pair.
Key = UAE
Value = 8264070|83600|R
Added new key, value pair.
Key = India
Value = 1210193422|3287263|L
Added new key, value pair.
Key = China
Value = 1347350000|9640821|R
Added new key, value pair.

============================================
Retrieving data for all keys (country names)
============================================
Here is the result retrieved from the database for key Canada:
34820000|9984670|R
Unpacked population value: 34820000
Unpacked area value      : 9984670
Unpacked drive side value: R
Here is the result retrieved from the database for key USA:
314242000|9826675|R
Unpacked population value: 314242000
Unpacked area value      : 9826675
Unpacked drive side value: R
Here is the result retrieved from the database for key Ireland:
6399152|84421|L
Unpacked population value: 6399152
Unpacked area value      : 84421
Unpacked drive side value: L
Here is the result retrieved from the database for key UK:
62262000|243610|L
Unpacked population value: 62262000
Unpacked area value      : 243610
Unpacked drive side value: L
Here is the result retrieved from the database for key Mexico:
113910608|1972550|R
Unpacked population value: 113910608
Unpacked area value      : 1972550
Unpacked drive side value: R
Here is the result retrieved from the database for key Denmark:
5543453|43094|R
Unpacked population value: 5543453
Unpacked area value      : 43094
Unpacked drive side value: R
Here is the result retrieved from the database for key Norway:
5002942|385252|R
Unpacked population value: 5002942
Unpacked area value      : 385252
Unpacked drive side value: R
Here is the result retrieved from the database for key UAE:
8264070|83600|R
Unpacked population value: 8264070
Unpacked area value      : 83600
Unpacked drive side value: R
Here is the result retrieved from the database for key India:
1210193422|3287263|L
Unpacked population value: 1210193422
Unpacked area value      : 3287263
Unpacked drive side value: L
Here is the result retrieved from the database for key China:
1347350000|9640821|R
Unpacked population value: 1347350000
Unpacked area value      : 9640821
Unpacked drive side value: R
</pre></li><li class="listitem"><p>
              Query the <code class="literal">innodb_memcache.containers</code>
              table to view the record you inserted earlier for the
              <code class="literal">multicol</code> table. The first record is the
              sample entry for the <code class="literal">demo_test</code> table
              that is created during the initial
              <code class="literal">daemon_memcached</code> plugin setup. The
              second record is the entry you inserted for the
              <code class="literal">multicol</code> table.
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM innodb_memcache.containers\G</code></strong>
*************************** 1. row ***************************
                  name: aaa
             db_schema: test
              db_table: demo_test
           key_columns: c1
         value_columns: c2
                 flags: c3
            cas_column: c4
    expire_time_column: c5
unique_idx_name_on_key: PRIMARY
*************************** 2. row ***************************
                  name: bbb
             db_schema: test
              db_table: multicol
           key_columns: country
         value_columns: population,area_sq_km,drive_side
                 flags: c3
            cas_column: c4
    expire_time_column: c5
unique_idx_name_on_key: PRIMARY
</pre></li><li class="listitem"><p>
              Query the <code class="literal">multicol</code> table to view data
              inserted by the sample Python application. The data is
              available for MySQL
              <a class="link" href="glossary.html#glos_query" title="query">queries</a>, which
              demonstrates how the same data can be accessed using SQL
              or through applications (using the appropriate
              <a class="link" href="connectors-apis.html" title="Chapter 28 Connectors and APIs">MySQL Connector or
              API</a>).
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.multicol;</code></strong>
+---------+------------+------------+------------+------+------+------+
| country | population | area_sq_km | drive_side | c3   | c4   | c5   |
+---------+------------+------------+------------+------+------+------+
| Canada  | 34820000   | 9984670    | R          |    0 |   11 |    0 |
| China   | 1347350000 | 9640821    | R          |    0 |   20 |    0 |
| Denmark | 5543453    | 43094      | R          |    0 |   16 |    0 |
| India   | 1210193422 | 3287263    | L          |    0 |   19 |    0 |
| Ireland | 6399152    | 84421      | L          |    0 |   13 |    0 |
| Mexico  | 113910608  | 1972550    | R          |    0 |   15 |    0 |
| Norway  | 5002942    | 385252     | R          |    0 |   17 |    0 |
| UAE     | 8264070    | 83600      | R          |    0 |   18 |    0 |
| UK      | 62262000   | 243610     | L          |    0 |   14 |    0 |
| USA     | 314242000  | 9826675    | R          |    0 |   12 |    0 |
+---------+------------+------------+------------+------+------+------+
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                Always allow sufficient size to hold necessary digits,
                decimal points, sign characters, leading zeros, and so
                on when defining the length for columns that are treated
                as numbers. Too-long values in a string column such as a
                <code class="literal">VARCHAR</code> are truncated by removing
                some characters, which could produce nonsensical numeric
                values.
</p>
</div>
</li><li class="listitem"><p>
              Optionally, run report-type queries on the
              <code class="literal">InnoDB</code> table that stores the
              <span class="command"><strong>memcached</strong></span> data.
            </p><p>
              You can produce reports through SQL queries, performing
              calculations and tests across any columns, not just the
              <code class="literal">country</code> key column. (Because the
              following examples use data from only a few countries, the
              numbers are for illustration purposes only.) The following
              queries return the average population of countries where
              people drive on the right, and the average size of
              countries whose names start with <span class="quote">“<span class="quote">U</span>”</span>:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT AVG(population) FROM multicol WHERE drive_side = 'R';</code></strong>
+-------------------+
| avg(population)   |
+-------------------+
| 261304724.7142857 |
+-------------------+

mysql&gt; <strong class="userinput"><code>SELECT SUM(area_sq_km) FROM multicol WHERE country LIKE 'U%';</code></strong>
+-----------------+
| sum(area_sq_km) |
+-----------------+
|        10153885 |
+-----------------+
</pre><p>
              Because the <code class="literal">population</code> and
              <code class="literal">area_sq_km</code> columns store character data
              rather than strongly typed numeric data, functions such as
              <code class="literal">AVG()</code> and <code class="literal">SUM()</code> work
              by converting each value to a number first. This approach
              <span class="emphasis"><em>does not work</em></span> for operators such as
              <code class="literal">&lt;</code> or <code class="literal">&gt;</code>, for
              example, when comparing character-based values, <code class="literal">9
              &gt; 1000</code>, which is not expected from a clause
              such as <code class="literal">ORDER BY population DESC</code>. For
              the most accurate type treatment, perform queries against
              views that cast numeric columns to the appropriate types.
              This technique lets you issue simple <code class="literal">SELECT
              *</code> queries from database applications, while
              ensuring that casting, filtering, and ordering is correct.
              The following example shows a view that can be queried to
              find the top three countries in descending order of
              population, with the results reflecting the latest data in
              the <code class="literal">multicol</code> table, and with population
              and area figures treated as numbers:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE VIEW populous_countries AS</code></strong>
       <strong class="userinput"><code>SELECT</code></strong>
       <strong class="userinput"><code>country,</code></strong>
       <strong class="userinput"><code>cast(population as unsigned integer) population,</code></strong>
       <strong class="userinput"><code>cast(area_sq_km as unsigned integer) area_sq_km,</code></strong>
       <strong class="userinput"><code>drive_side FROM multicol</code></strong>
       <strong class="userinput"><code>ORDER BY CAST(population as unsigned integer) DESC</code></strong>
       <strong class="userinput"><code>LIMIT 3;</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT * FROM populous_countries;</code></strong>
+---------+------------+------------+------------+
| country | population | area_sq_km | drive_side |
+---------+------------+------------+------------+
| China   | 1347350000 |    9640821 | R          |
| India   | 1210193422 |    3287263 | L          |
| USA     |  314242000 |    9826675 | R          |
+---------+------------+------------+------------+

mysql&gt; <strong class="userinput"><code>DESC populous_countries;</code></strong>
+------------+---------------------+------+-----+---------+-------+
| Field      | Type                | Null | Key | Default | Extra |
+------------+---------------------+------+-----+---------+-------+
| country    | varchar(128)        | NO   |     |         |       |
| population | bigint(10) unsigned | YES  |     | NULL    |       |
| area_sq_km | int(9) unsigned     | YES  |     | NULL    |       |
| drive_side | varchar(1)          | YES  |     | NULL    |       |
+------------+---------------------+------+-----+---------+-------+
</pre></li></ol>
</div>

</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-porting-memcached"></a>15.19.6.2 Adapting a memcached Application for the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<p>
        Consider these aspects of MySQL and <code class="literal">InnoDB</code>
        tables when adapting existing <span class="command"><strong>memcached</strong></span>
        applications to use the <code class="literal">daemon_memcached</code>
        plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If there are key values longer than a few bytes, it may be
            more efficient to use a numeric auto-increment column as the
            <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> of the
            <code class="literal">InnoDB</code> table, and to create a unique
            <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary index</a>
            on the column that contains the <span class="command"><strong>memcached</strong></span>
            key values. This is because <code class="literal">InnoDB</code>
            performs best for large-scale insertions if primary key
            values are added in sorted order (as they are with
            auto-increment values). Primary key values are included in
            secondary indexes, which takes up unnecessary space if the
            primary key is a long string value.
          </p></li><li class="listitem"><p>
            If you store several different classes of information using
            <span class="command"><strong>memcached</strong></span>, consider setting up a separate
            <code class="literal">InnoDB</code> table for each type of data.
            Define additional table identifiers in the
            <code class="literal">innodb_memcache.containers</code> table, and use
            the
            <code class="literal">@@<em class="replaceable"><code>table_id</code></em>.<em class="replaceable"><code>key</code></em></code>
            notation to store and retrieve items from different tables.
            Physically dividing different types of information allows
            you tune the characteristics of each table for optimum space
            utilization, performance, and reliability. For example, you
            might enable
            <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> for a
            table that holds blog posts, but not for a table that holds
            thumbnail images. You might back up one table more
            frequently than another because it holds critical data. You
            might create additional
            <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
            indexes</a> on tables that are frequently used to
            generate reports using SQL.
          </p></li><li class="listitem"><p>
            Preferably, configure a stable set of table definitions for
            use with the <span class="command"><strong>daemon_memcached</strong></span> plugin, and
            leave the tables in place permanently. Changes to the
            <code class="literal">innodb_memcache.containers</code> table take
            effect the next time the
            <code class="literal">innodb_memcache.containers</code> table is
            queried. Entries in the containers table are processed at
            startup, and are consulted whenever an unrecognized table
            identifier (as defined by
            <code class="literal">containers.name</code>) is requested using
            <code class="literal">@@</code> notation. Thus, new entries are
            visible as soon as you use the associated table identifier,
            but changes to existing entries require a server restart
            before they take effect.
          </p></li><li class="listitem"><p>
            When you use the default <code class="literal">innodb_only</code>
            caching policy, calls to <code class="literal">add()</code>,
            <code class="literal">set()</code>, <code class="literal">incr()</code>, and so
            on can succeed but still trigger debugging messages such as
            <code class="literal">while expecting 'STORED', got unexpected response
            'NOT_STORED</code>. Debug messages occur because new and
            updated values are sent directly to the
            <code class="literal">InnoDB</code> table without being saved in the
            memory cache, due to the <code class="literal">innodb_only</code>
            caching policy.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-tuning"></a>15.19.6.3 Tuning InnoDB memcached Plugin Performance</h4>

</div>

</div>

</div>
<p>
        Because using <code class="literal">InnoDB</code> in combination with
        <span class="command"><strong>memcached</strong></span> involves writing all data to disk,
        whether immediately or sometime later, raw performance is
        expected to be somewhat slower than using
        <span class="command"><strong>memcached</strong></span> by itself. When using the
        <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin,
        focus tuning goals for <span class="command"><strong>memcached</strong></span> operations
        on achieving better performance than equivalent SQL operations.
      </p><p>
        Benchmarks suggest that queries and
        <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations (inserts,
        updates, and deletes) that use the <span class="command"><strong>memcached</strong></span>
        interface are faster than traditional SQL. DML operations
        typically see a larger improvements. Therefore, consider
        adapting write-intensive applications to use the
        <span class="command"><strong>memcached</strong></span> interface first. Also consider
        prioritizing adaptation of write-intensive applications that use
        fast, lightweight mechanisms that lack reliability.
</p>
<h5><a name="idm140091632449408"></a>Adapting SQL Queries</h5>
<p>
        The types of queries that are most suited to simple
        <code class="literal">GET</code> requests are those with a single clause
        or a set of <code class="literal">AND</code> conditions in the
        <code class="literal">WHERE</code> clause:
      </p><pre data-lang="sql" class="programlisting">
SQL:
SELECT col FROM tbl WHERE key = 'key_value';

memcached:
get key_value

SQL:
SELECT col FROM tbl WHERE col1 = val1 and col2 = val2 and col3 = val3;

memcached:
# Since you must always know these 3 values to look up the key,
# combine them into a unique string and use that as the key
# for all ADD, SET, and GET operations.
key_value = val1 + ":" + val2 + ":" + val3
get key_value

SQL:
SELECT 'key exists!' FROM tbl
  WHERE EXISTS (SELECT col1 FROM tbl WHERE KEY = 'key_value') LIMIT 1;

memcached:
# Test for existence of key by asking for its value and checking if the call succeeds,
# ignoring the value itself. For existence checking, you typically only store a very
# short value such as "1".
get key_value
</pre>
<h5><a name="idm140091632443744"></a>Using System Memory</h5>
<p>
        For best performance, deploy the
        <code class="literal">daemon_memcached</code> plugin on machines that are
        configured as typical database servers, where the majority of
        system RAM is devoted to the <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, through the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
        configuration option. For systems with multi-gigabyte buffer
        pools, consider raising the value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
        for maximum throughput when most operations involve data that is
        already cached in memory.
</p>
<h5><a name="idm140091632437488"></a>Reducing Redundant I/O</h5>
<p>
        <code class="literal">InnoDB</code> has a number of settings that let you
        choose the balance between high reliability, in case of a crash,
        and the amount of I/O overhead during high write workloads. For
        example, consider setting the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a> to
        <code class="literal">0</code> and
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a>
        to <code class="literal">2</code>. Measure performance with different
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> settings.
      </p><p>
        For other ways to reduce or tune I/O for table operations, see
        <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8 Optimizing InnoDB Disk I/O">Section 8.5.8, “Optimizing InnoDB Disk I/O”</a>.
</p>
<h5><a name="idm140091632429040"></a>Reducing Transactional Overhead</h5>
<p>
        A default value of 1 for
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
        and
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        is intended for maximum reliability of results and safety of
        stored or updated data.
      </p><p>
        Depending on the type of application, you might increase one or
        both of these settings to reduce the overhead of frequent
        <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> operations. On a busy
        system, you might increase
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>,
        knowing that changes to data made through SQL may not become
        visible to <span class="command"><strong>memcached</strong></span> immediately (that is,
        until <em class="replaceable"><code>N</code></em> more <code class="literal">get</code>
        operations are processed). When processing data where every
        write operation must be reliably stored, leave
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        set to <code class="literal">1</code>. Increase the setting when
        processing large numbers of updates intended only for
        statistical analysis, where losing the last
        <em class="replaceable"><code>N</code></em> updates in a crash is an acceptable
        risk.
      </p><p>
        For example, imagine a system that monitors traffic crossing a
        busy bridge, recording data for approximately 100,000 vehicles
        each day. If the application counts different types of vehicles
        to analyze traffic patterns, changing
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        from <code class="literal">1</code> to <code class="literal">100</code> reduces I/O
        overhead for commit operations by 99%. In case of an outage, a
        maximum of 100 records are lost, which may be an acceptable
        margin of error. If instead the application performed automated
        toll collection for each car, you would set
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        to <code class="literal">1</code> to ensure that each toll record is
        immediately saved to disk.
      </p><p>
        Because of the way <code class="literal">InnoDB</code> organizes
        <span class="command"><strong>memcached</strong></span> key values on disk, if you have a
        large number of keys to create, it may be faster to sort the
        data items by key value in the application and
        <code class="literal">add</code> them in sorted order, rather than create
        keys in arbitrary order.
      </p><p>
        The <span class="command"><strong>memslap</strong></span> command, which is part of the
        regular <span class="command"><strong>memcached</strong></span> distribution but not
        included with the <code class="literal">daemon_memcached</code> plugin,
        can be useful for benchmarking different configurations. It can
        also be used to generate sample key-value pairs to use in your
        own benchmarks. See
        <a class="ulink" href="https://dev.mysql.com/doc/refman/5.6/en/ha-memcached-interfaces-libmemcached.html#ha-memcached-interfaces-libmemcached-utilities" target="_top"><span class="command"><strong>libmemcached</strong></span> Command-Line Utilities</a>
        for details.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-txn"></a>15.19.6.4 Controlling Transactional Behavior of the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<p>
        Unlike traditional <span class="command"><strong>memcached</strong></span>, the
        <code class="literal">daemon_memcached</code> plugin allows you to control
        durability of data values produced through calls to
        <code class="literal">add</code>, <code class="literal">set</code>,
        <code class="literal">incr</code>, and so on. By default, data written
        through the <span class="command"><strong>memcached</strong></span> interface is stored to
        disk, and calls to <code class="literal">get</code> return the most recent
        value from disk. Although the default behavior does not offer
        the best possible raw performance, it is still fast compared to
        the SQL interface for <code class="literal">InnoDB</code> tables.
      </p><p>
        As you gain experience using the
        <code class="literal">daemon_memcached</code> plugin, you can consider
        relaxing durability settings for non-critical classes of data,
        at the risk of losing some updated values in the event of an
        outage, or returning data that is slightly out-of-date.
</p>
<h5><a name="idm140091632396272"></a>Frequency of Commits</h5>
<p>
        One tradeoff between durability and raw performance is how
        frequently new and changed data is
        <a class="link" href="glossary.html#glos_commit" title="commit">committed</a>. If data is
        critical, is should be committed immediately so that it is safe
        in case of a crash or outage. If data is less critical, such as
        counters that are reset after a crash or logging data that you
        can afford to lose, you might prefer higher raw throughput that
        is available with less frequent commits.
      </p><p>
        When a <span class="command"><strong>memcached</strong></span> operation inserts, updates,
        or deletes data in the underlying <code class="literal">InnoDB</code>
        table, the change might be committed to the
        <code class="literal">InnoDB</code> table instantly (if
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size=1</code></a>)
        or some time later (if the
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        value is greater than 1). In either case, the change cannot be
        rolled back. If you increase the value of
        <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
        to avoid high I/O overhead during busy times, commits could
        become infrequent when the workload decreases. As a safety
        measure, a background thread automatically commits changes made
        through the <span class="command"><strong>memcached</strong></span> API at regular
        intervals. The interval is controlled by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_bk_commit_interval"><code class="literal">innodb_api_bk_commit_interval</code></a>
        configuration option, which has a default setting of
        <code class="literal">5</code> seconds.
      </p><p>
        When a <span class="command"><strong>memcached</strong></span> operation inserts or updates
        data in the underlying <code class="literal">InnoDB</code> table, the
        changed data is immediately visible to other
        <span class="command"><strong>memcached</strong></span> requests because the new value
        remains in the memory cache, even if it is not yet committed on
        the MySQL side.
</p>
<h5><a name="idm140091632381072"></a>Transaction Isolation</h5>
<p>
        When a <span class="command"><strong>memcached</strong></span> operation such as
        <code class="literal">get</code> or <code class="literal">incr</code> causes a query
        or DML operation on the underlying <code class="literal">InnoDB</code>
        table, you can control whether the operation sees the very
        latest data written to the table, only data that has been
        committed, or other variations of transaction
        <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation level</a>. Use
        the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level"><code class="literal">innodb_api_trx_level</code></a>
        configuration option to control this feature. The numeric values
        specified for this option correspond to isolation levels such as
        <a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>. See the
        description of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_trx_level"><code class="literal">innodb_api_trx_level</code></a> option for
        information about other settings.
      </p><p>
        A strict isolation level ensures that data you retrieve is not
        rolled back or changed suddenly causing subsequent queries to
        return different values. However, strict isolation levels
        require greater <a class="link" href="glossary.html#glos_locking" title="locking">locking</a>
        overhead, which can cause waits. For a NoSQL-style application
        that does not use long-running transactions, you can typically
        use the default isolation level or switch to a less strict
        isolation level.
</p>
<h5><a name="idm140091632370336"></a>Disabling Row Locks for memcached DML Operations</h5>
<p>
        The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_disable_rowlock"><code class="literal">innodb_api_disable_rowlock</code></a>
        option can be used to disable row locks when
        <span class="command"><strong>memcached</strong></span> requests through the
        <code class="literal">daemon_memcached</code> plugin cause DML operations.
        By default, <code class="literal">innodb_api_disable_rowlock</code> is set
        to <code class="literal">OFF</code> which means that
        <span class="command"><strong>memcached</strong></span> requests row locks for
        <code class="literal">get</code> and <code class="literal">set</code> operations.
        When <code class="literal">innodb_api_disable_rowlock</code> is set to
        <code class="literal">ON</code>, <span class="command"><strong>memcached</strong></span> requests a
        table lock instead of row locks.
      </p><p>
        The <code class="literal">innodb_api_disable_rowlock</code> option is not
        dynamic. It must be specified at startup on the
        <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> command line or entered in a MySQL
        configuration file.
</p>
<h5><a name="idm140091632358128"></a>Allowing or Disallowing DDL</h5>
<p>
        By default, you can perform <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a>
        operations such as <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> on
        tables used by the <code class="literal">daemon_memcached</code> plugin.
        To avoid potential slowdowns when these tables are used for
        high-throughput applications, disable DDL operations on these
        tables by enabling
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_mdl"><code class="literal">innodb_api_enable_mdl</code></a> at
        startup. This option is less appropriate when accessing the same
        tables through both <span class="command"><strong>memcached</strong></span> and SQL,
        because it blocks <a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>
        statements on the tables, which could be important for running
        reporting queries.
</p>
<h5><a name="idm140091632350608"></a>Storing Data on Disk, in Memory, or Both</h5>
<p>
        The <code class="literal">innodb_memcache.cache_policies</code> table
        specifies whether to store data written through the
        <span class="command"><strong>memcached</strong></span> interface to disk
        (<code class="literal">innodb_only</code>, the default); in memory only,
        as with traditional <span class="command"><strong>memcached</strong></span>
        (<code class="literal">cache_only</code>); or both
        (<code class="literal">caching</code>).
      </p><p>
        With the <code class="literal">caching</code> setting, if
        <span class="command"><strong>memcached</strong></span> cannot find a key in memory, it
        searches for the value in an <code class="literal">InnoDB</code> table.
        Values returned from <code class="literal">get</code> calls under the
        <code class="literal">caching</code> setting could be out-of-date if the
        values were updated on disk in the <code class="literal">InnoDB</code>
        table but are not yet expired from the memory cache.
      </p><p>
        The caching policy can be set independently for
        <code class="literal">get</code>, <code class="literal">set</code> (including
        <code class="literal">incr</code> and <code class="literal">decr</code>),
        <code class="literal">delete</code>, and <code class="literal">flush</code>
        operations.
      </p><p>
        For example, you might allow <code class="literal">get</code> and
        <code class="literal">set</code> operations to query or update a table and
        the <span class="command"><strong>memcached</strong></span> memory cache at the same time
        (using the <code class="literal">caching</code> setting), while making
        <code class="literal">delete</code>, <code class="literal">flush</code>, or both
        operate only on the in-memory copy (using the
        <code class="literal">cache_only</code> setting). That way, deleting or
        flushing an item only expires the item from the cache, and the
        latest value is returned from the <code class="literal">InnoDB</code>
        table the next time the item is requested.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM innodb_memcache.cache_policies;</code></strong>
+--------------+-------------+-------------+---------------+--------------+
| policy_name  | get_policy  | set_policy  | delete_policy | flush_policy |
+--------------+-------------+-------------+---------------+--------------+
| cache_policy | innodb_only | innodb_only | innodb_only   | innodb_only  |
+--------------+-------------+-------------+---------------+--------------+

mysql&gt; <strong class="userinput"><code>UPDATE innodb_memcache.cache_policies SET set_policy = 'caching'</code></strong>
       <strong class="userinput"><code>WHERE policy_name = 'cache_policy';</code></strong>
</pre><p>
        <code class="literal">innodb_memcache.cache_policies</code> values are
        only read at startup. After changing values in this table,
        uninstall and reinstall the <code class="literal">daemon_memcached</code>
        plugin to ensure that changes take effect.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>UNINSTALL PLUGIN daemon_memcached;</code></strong>

mysql&gt; <strong class="userinput"><code>INSTALL PLUGIN daemon_memcached soname "libmemcached.so";</code></strong>
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-dml"></a>15.19.6.5 Adapting DML Statements to memcached Operations</h4>

</div>

</div>

</div>
<p>
        Benchmarks suggest that the <code class="literal">daemon_memcached</code>
        plugin speeds up <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations
        (inserts, updates, and deletes) more than it speeds up queries.
        Therefore, consider focussing initial development efforts on
        write-intensive applications that are I/O-bound, and look for
        opportunities to use MySQL with the
        <code class="literal">daemon_memcached</code> plugin for new
        write-intensive applications.
      </p><p>
        Single-row DML statements are the easiest types of statements to
        turn into <code class="literal">memcached</code> operations.
        <code class="literal">INSERT</code> becomes <code class="literal">add</code>,
        <code class="literal">UPDATE</code> becomes <code class="literal">set</code>,
        <code class="literal">incr</code> or <code class="literal">decr</code>, and
        <code class="literal">DELETE</code> becomes <code class="literal">delete</code>.
        These operations are guaranteed to only affect one row when
        issued through the <span class="command"><strong>memcached</strong></span> interface,
        because the <em class="replaceable"><code>key</code></em> is unique within the
        table.
      </p><p>
        In the following SQL examples, <code class="literal">t1</code> refers to
        the table used for <span class="command"><strong>memcached</strong></span> operations,
        based on the configuration in the
        <code class="literal">innodb_memcache.containers</code> table.
        <code class="literal">key</code> refers to the column listed under
        <code class="literal">key_columns</code>, and <code class="literal">val</code>
        refers to the column listed under
        <code class="literal">value_columns</code>.

</p><pre data-lang="sql" class="programlisting">
INSERT INTO t1 (key,val) VALUES (<em class="replaceable"><code>some_key</code></em>,<em class="replaceable"><code>some_value</code></em>);
SELECT val FROM t1 WHERE key = <em class="replaceable"><code>some_key</code></em>;
UPDATE t1 SET val = <em class="replaceable"><code>new_value</code></em> WHERE key = <em class="replaceable"><code>some_key</code></em>;
UPDATE t1 SET val = val + x WHERE key = <em class="replaceable"><code>some_key</code></em>;
DELETE FROM t1 WHERE key = <em class="replaceable"><code>some_key</code></em>;
</pre><p>
      </p><p>
        The following <a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> and
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements, which remove
        all rows from the table, correspond to the
        <code class="literal">flush_all</code> operation, where
        <code class="literal">t1</code> is configured as the table for
        <span class="command"><strong>memcached</strong></span> operations, as in the previous
        example.
      </p><pre data-lang="sql" class="programlisting">
TRUNCATE TABLE t1;
DELETE FROM t1;
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-memcached-ddl"></a>15.19.6.6 Performing DML and DDL Statements on the Underlying InnoDB Table</h4>

</div>

</div>

</div>
<p>
        You can access the underlying <code class="literal">InnoDB</code> table
        (which is <code class="literal">test.demo_test</code> by default) through
        standard SQL interfaces. However, there are some restrictions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When querying a table that is also accessed through the
            <span class="command"><strong>memcached</strong></span> interface, remember that
            <span class="command"><strong>memcached</strong></span> operations can be configured to
            be committed periodically rather than after every write
            operation. This behavior is controlled by the
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            option. If this option is set to a value greater than
            <code class="literal">1</code>, use <a class="link" href="innodb-storage-engine.html#isolevel_read-uncommitted"><code class="literal">READ
            UNCOMMITTED</code></a> queries to find rows that were just
            inserted.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET SESSSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</code></strong>

mysql&gt; <strong class="userinput"><code>SELECT * FROM demo_test;</code></strong>
+------+------+------+------+-----------+------+------+------+------+------+------+
| cx   | cy   | c1   | cz   | c2        | ca   | CB   | c3   | cu   | c4   | C5   |
+------+------+------+------+-----------+------+------+------+------+------+------+
| NULL | NULL | a11  | NULL | 123456789 | NULL | NULL |   10 | NULL |    3 | NULL |
+------+------+------+------+-----------+------+------+------+------+------+------+
</pre></li><li class="listitem"><p>
            When modifying a table using SQL that is also accessed
            through the <span class="command"><strong>memcached</strong></span> interface, you can
            configure <span class="command"><strong>memcached</strong></span> operations to start a
            new transaction periodically rather than for every read
            operation. This behavior is controlled by the
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
            option. If this option is set to a value greater than
            <code class="literal">1</code>, changes made to the table using SQL
            are not immediately visible to <span class="command"><strong>memcached</strong></span>
            operations.
          </p></li><li class="listitem"><p>
            The <code class="literal">InnoDB</code> table is either IS (intention
            shared) or IX (intention exclusive) locked for all
            operations in a transaction. If you increase
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
            and
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            substantially from their default value of
            <code class="literal">1</code>, the table is most likely locked
            between each operation, preventing
            <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> statements on the table.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-replication"></a>15.19.7 The InnoDB memcached Plugin and Replication</h3>

</div>

</div>

</div>
<p>
      Because the <code class="literal">daemon_memcached</code> plugin supports
      the MySQL <a class="link" href="glossary.html#glos_binary_log" title="binary log">binary log</a>,
      updates made on a <a class="link" href="glossary.html#glos_master_server" title="master server">master
      server</a> through the <span class="command"><strong>memcached</strong></span> interface
      can be replicated for backup, balancing intensive read workloads,
      and high availability. All <span class="command"><strong>memcached</strong></span> commands
      are supported with binary logging.
    </p><p>
      You do not need to set up the <code class="literal">daemon_memcached</code>
      plugin on <a class="link" href="glossary.html#glos_slave_server" title="slave server">slave servers</a>.
      The primary advantage of this configuration is increased write
      throughput on the master. The speed of the replication mechanism
      is not affected.
    </p><p>
      The following sections show how to use the binary log capability
      when using the <code class="literal">daemon_memcached</code> plugin with
      MySQL replication. It is assumed that you have completed the setup
      described in <a class="xref" href="innodb-storage-engine.html#innodb-memcached-setup" title="15.19.3 Setting Up the InnoDB memcached Plugin">Section 15.19.3, “Setting Up the InnoDB memcached Plugin”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-memcached-replication-enable-binlog"></a>Enabling the InnoDB memcached Binary Log</h4>
</div>
</div>
</div>

<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            To use the <code class="literal">daemon_memcached</code> plugin with
            the MySQL <a class="link" href="glossary.html#glos_binary_log" title="binary log">binary log</a>,
            enable the
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_api_enable_binlog"><code class="literal">innodb_api_enable_binlog</code></a>
            configuration option on the
            <a class="link" href="glossary.html#glos_master_server" title="master server">master server</a>.
            This option can only be set at server startup. You must also
            enable the MySQL binary log on the master server using the
            <a class="link" href="replication.html#sysvar_log_bin"><code class="literal">--log-bin</code></a> option. You can
            add these options to the MySQL configuration file, or on the
            <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> command line.
          </p><pre data-lang="terminal" class="programlisting">
mysqld ... --log-bin -–innodb_api_enable_binlog=1
</pre></li><li class="listitem"><p>
            Configure the master and slave server, as described in
            <a class="xref" href="replication.html#replication-howto" title="17.1.2 Setting Up Binary Log File Position Based Replication">Section 17.1.2, “Setting Up Binary Log File Position Based Replication”</a>.
          </p></li><li class="listitem"><p>
            Use <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to create a master data
            snapshot, and sync the snapshot to the slave server.
          </p><pre data-lang="terminal" class="programlisting">
master shell&gt; <strong class="userinput"><code>mysqldump --all-databases --lock-all-tables &gt; dbdump.db</code></strong>
slave shell&gt; <strong class="userinput"><code>mysql &lt; dbdump.db</code></strong>
</pre></li><li class="listitem"><p>
            On the master server, issue <a class="link" href="sql-syntax.html#show-master-status" title="13.7.6.23 SHOW MASTER STATUS Syntax"><code class="literal">SHOW MASTER
            STATUS</code></a> to obtain the master binary log
            coordinates.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW MASTER STATUS;</code></strong>
</pre></li><li class="listitem"><p>
            On the slave server, use a <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1 CHANGE MASTER TO Syntax"><code class="literal">CHANGE
            MASTER TO</code></a> statement to set up a slave server using
            the master binary log coordinates.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CHANGE MASTER TO</code></strong>
       <strong class="userinput"><code>MASTER_HOST='localhost',</code></strong>
       <strong class="userinput"><code>MASTER_USER='root',</code></strong>
       <strong class="userinput"><code>MASTER_PASSWORD='',</code></strong>
       <strong class="userinput"><code>MASTER_PORT = 13000,</code></strong>
       <strong class="userinput"><code>MASTER_LOG_FILE='0.000001,</code></strong>
       <strong class="userinput"><code>MASTER_LOG_POS=114;</code></strong>
</pre></li><li class="listitem"><p>
            Start the slave.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>START SLAVE;</code></strong>
</pre><p>
            If the error log prints output similar to the following, the
            slave is ready for replication.
          </p><pre data-lang="terminal" class="programlisting">
2013-09-24T13:04:38.639684Z 49 [Note] Slave I/O thread: connected to
master 'root@localhost:13000', replication started in log '0.000001'
at position 114
</pre></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-replication-testing"></a>Testing the InnoDB memcached Replication Configuration</h4>

</div>

</div>

</div>
<p>
        This example demonstrates how to test the
        <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
        replication configuration using the <span class="command"><strong>memcached</strong></span>
        and telnet to insert, update, and delete data. A MySQL client is
        used to verify results on the master and slave servers.
      </p><p>
        The example uses the <code class="literal">demo_test</code> table, which
        was created by the
        <code class="filename">innodb_memcached_config.sql</code> configuration
        script during the initial setup of the
        <code class="literal">daemon_memcached</code> plugin. The
        <code class="literal">demo_test</code> table contains a single example
        record.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Use the <code class="literal">set</code> command to insert a record
            with a key of <code class="literal">test1</code>, a flag value of
            <code class="literal">10</code>, an expiration value of
            <code class="literal">0</code>, a cas value of 1, and a value of
            <code class="literal">t1</code>.
          </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
<strong class="userinput"><code>set test1 10 0 1</code></strong>
<strong class="userinput"><code>t1</code></strong>
STORED
</pre></li><li class="listitem"><p>
            On the master server, check that the record was inserted
            into the <code class="literal">demo_test</code> table. Assuming the
            <code class="literal">demo_test</code> table was not previously
            modified, there should be two records. The example record
            with a key of <code class="literal">AA</code>, and the record you just
            inserted, with a key of <code class="literal">test1</code>. The
            <code class="literal">c1</code> column maps to the key, the
            <code class="literal">c2</code> column to the value, the
            <code class="literal">c3</code> column to the flag value, the
            <code class="literal">c4</code> column to the cas value, and the
            <code class="literal">c5</code> column to the expiration time. The
            expiration time was set to 0, since it is unused.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+-------+--------------+------+------+------+
| c1    | c2           | c3   | c4   | c5   |
+-------+--------------+------+------+------+
| AA    | HELLO, HELLO |    8 |    0 |    0 |
| test1 | t1           |   10 |    1 |    0 |
+-------+--------------+------+------+------+
</pre></li><li class="listitem"><p>
            Check to verify that the same record was replicated to the
            slave server.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+-------+--------------+------+------+------+
| c1    | c2           | c3   | c4   | c5   |
+-------+--------------+------+------+------+
| AA    | HELLO, HELLO |    8 |    0 |    0 |
| test1 | t1           |   10 |    1 |    0 |
+-------+--------------+------+------+------+
</pre></li><li class="listitem"><p>
            Use the <code class="literal">set</code> command to update the key to
            a value of <code class="literal">new</code>.
          </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
<strong class="userinput"><code>set test1 10 0 2</code></strong>
<strong class="userinput"><code>new</code></strong>
STORED
</pre><p>
            The update is replicated to the slave server (notice that
            the <code class="literal">cas</code> value is also updated).
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+-------+--------------+------+------+------+
| c1    | c2           | c3   | c4   | c5   |
+-------+--------------+------+------+------+
| AA    | HELLO, HELLO |    8 |    0 |    0 |
| test1 | new          |   10 |    2 |    0 |
+-------+--------------+------+------+------+
</pre></li><li class="listitem"><p>
            Delete the <code class="literal">test1</code> record using a
            <code class="literal">delete</code> command.
          </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
<strong class="userinput"><code>delete test1</code></strong>
DELETED
</pre><p>
            When the <code class="literal">delete</code> operation is replicated
            to the slave, the <code class="literal">test1</code> record on the
            slave is also deleted.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+----+--------------+------+------+------+
| c1 | c2           | c3   | c4   | c5   |
+----+--------------+------+------+------+
| AA | HELLO, HELLO |    8 |    0 |    0 |
+----+--------------+------+------+------+
</pre></li><li class="listitem"><p>
            Remove all rows from the table using the
            <code class="literal">flush_all</code> command.
          </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
<strong class="userinput"><code>flush_all</code></strong>
OK
</pre><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
Empty set (0.00 sec)
</pre></li><li class="listitem"><p>
            Telnet to the master server and enter two new records.
          </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'
<strong class="userinput"><code>set test2 10 0 4</code></strong>
<strong class="userinput"><code>again</code></strong>
STORED
<strong class="userinput"><code>set test3 10 0 5</code></strong>
<strong class="userinput"><code>again1</code></strong>
STORED
</pre></li><li class="listitem"><p>
            Confirm that the two records were replicated to the slave
            server.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+-------+--------------+------+------+------+
| c1    | c2           | c3   | c4   | c5   |
+-------+--------------+------+------+------+
| test2 | again        |   10 |    4 |    0 |
| test3 | again1       |   10 |    5 |    0 |
+-------+--------------+------+------+------+
</pre></li><li class="listitem"><p>
            Remove all rows from the table using the
            <code class="literal">flush_all</code> command.
          </p><pre data-lang="terminal" class="programlisting">
<strong class="userinput"><code>telnet 127.0.0.1 11211</code></strong>
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
<strong class="userinput"><code>flush_all</code></strong>
OK
</pre></li><li class="listitem"><p>
            Check to ensure that the <code class="literal">flush_all</code>
            operation was replicated on the slave server.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
Empty set (0.00 sec)
</pre></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-binlog-notes"></a>InnoDB memcached Binary Log Notes</h4>

</div>

</div>

</div>
<p>
        Binary Log Format:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Most <span class="command"><strong>memcached</strong></span> operations are mapped to
            <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements (analogous to
            insert, delete, update). Since there is no actual SQL
            statement being processed by the MySQL server, all
            <span class="command"><strong>memcached</strong></span> commands (except for
            <code class="literal">flush_all</code>) use Row-Based Replication
            (RBR) logging, which is independent of any server
            <a class="link" href="replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a> setting.
          </p></li><li class="listitem"><p>
            The <span class="command"><strong>memcached</strong></span>
            <code class="literal">flush_all</code> command is mapped to the
            <a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> command in
            MySQL 5.7 and earlier. Since
            <a class="link" href="glossary.html#glos_ddl" title="DDL">DDL</a> commands can only use
            statement-based logging, the <code class="literal">flush_all</code>
            command is replicated by sending a
            <a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> statement. In
            MySQL 8.0 and later, <code class="literal">flush_all</code> is mapped
            to <code class="literal">DELETE</code> but is still replicated by
            sending a <a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>
            statement.
</p></li></ul>
</div>
<p>
        Transactions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The concept of
            <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> has not
            typically been part of <span class="command"><strong>memcached</strong></span>
            applications. For performance considerations,
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_r_batch_size"><code class="literal">daemon_memcached_r_batch_size</code></a>
            and
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            are used to control the batch size for read and write
            transactions. These settings do not affect replication. Each
            SQL operation on the underlying <code class="literal">InnoDB</code>
            table is replicated after successful completion.
          </p></li><li class="listitem"><p>
            The default value of
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            is <code class="literal">1</code>, which means that each
            <span class="command"><strong>memcached</strong></span> write operation is committed
            immediately. This default setting incurs a certain amount of
            performance overhead to avoid inconsistencies in the data
            that is visible on the master and slave servers. The
            replicated records are always available immediately on the
            slave server. If you set
            <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_w_batch_size"><code class="literal">daemon_memcached_w_batch_size</code></a>
            to a value greater than <code class="literal">1</code>, records
            inserted or updated through <span class="command"><strong>memcached</strong></span> are
            not immediately visible on the master server; to view the
            records on the master server before they are committed,
            issue <a class="link" href="sql-syntax.html#set-transaction" title="13.3.7 SET TRANSACTION Syntax"><code class="literal">SET
            TRANSACTION ISOLATION LEVEL READ UNCOMMITTED</code></a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-internals"></a>15.19.8 InnoDB memcached Plugin Internals</h3>

</div>

</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-api"></a>InnoDB API for the InnoDB memcached Plugin</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
        engine accesses <code class="literal">InnoDB</code> through
        <code class="literal">InnoDB</code> APIs, most of which are directly
        adopted from embedded <code class="literal">InnoDB</code>.
        <code class="literal">InnoDB</code> API functions are passed to the
        <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> engine as
        callback functions. <code class="literal">InnoDB</code> API functions
        access the <code class="literal">InnoDB</code> tables directly, and are
        mostly DML operations with the exception of
        <a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>.
      </p><p>
        <span class="command"><strong>memcached</strong></span> commands are implemented through
        the <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> API.
        The following table outlines how <span class="command"><strong>memcached</strong></span>
        commands are mapped to DML or DDL operations.
</p>
<div class="table">
<a name="idm140091632112816"></a><p class="title"><b>Table 15.28 memcached Commands and Associated DML or DDL Operations</b></p>
<div class="table-contents">
<table frame="all" summary="memcached commands and associated DML or DDL operations."><col width="25%"><col width="75%"><thead><tr>
            <th scope="col">memcached Command</th>
            <th scope="col">DML or DDL Operations</th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">get</code></td>
            <td>a read/fetch command</td>
          </tr><tr>
            <td scope="row"><code class="literal">set</code></td>
            <td>a search followed by an <code class="literal">INSERT</code> or
              <code class="literal">UPDATE</code> (depending on whether or not a
              key exists)</td>
          </tr><tr>
            <td scope="row"><code class="literal">add</code></td>
            <td>a search followed by an <code class="literal">INSERT</code> or
              <code class="literal">UPDATE</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">replace</code></td>
            <td>a search followed by an <code class="literal">UPDATE</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">append</code></td>
            <td>a search followed by an <code class="literal">UPDATE</code> (appends data to the
              result before <code class="literal">UPDATE</code>)</td>
          </tr><tr>
            <td scope="row"><code class="literal">prepend</code></td>
            <td>a search followed by an <code class="literal">UPDATE</code> (prepends data to the
              result before <code class="literal">UPDATE</code>)</td>
          </tr><tr>
            <td scope="row"><code class="literal">incr</code></td>
            <td>a search followed by an <code class="literal">UPDATE</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">decr</code></td>
            <td>a search followed by an <code class="literal">UPDATE</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">delete</code></td>
            <td>a search followed by a <code class="literal">DELETE</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">flush_all</code></td>
            <td><code class="literal">TRUNCATE TABLE</code> (DDL)</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-config-tables"></a>InnoDB memcached Plugin Configuration Tables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091632068512"></a><a class="indexterm" name="idm140091632067472"></a><a class="indexterm" name="idm140091632066400"></a><a class="indexterm" name="idm140091632065328"></a><p>
        This section describes configuration tables used by the
        <code class="literal">daemon_memcached</code> plugin. The
        <code class="literal">cache_policies</code> table,
        <code class="literal">config_options</code> table, and
        <code class="literal">containers</code> table are created by the
        <code class="filename">innodb_memcached_config.sql</code> configuration
        script in the <code class="literal">innodb_memcache</code> database.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE innodb_memcache;</code></strong>
Database changed
mysql&gt; <strong class="userinput"><code>SHOW TABLES;</code></strong>
+---------------------------+
| Tables_in_innodb_memcache |
+---------------------------+
| cache_policies            |
| config_options            |
| containers                |
+---------------------------+
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-cache-policies-table"></a>cache_policies Table</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">cache_policies</code> table defines a cache
        policy for the <code class="literal">InnoDB</code>
        <code class="literal">memcached</code> installation. You can specify
        individual policies for <code class="literal">get</code>,
        <code class="literal">set</code>, <code class="literal">delete</code>, and
        <code class="literal">flush</code> operations, within a single cache
        policy. The default setting for all operations is
        <code class="literal">innodb_only</code>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">innodb_only</code>: Use
            <code class="literal">InnoDB</code> as the data store.
          </p></li><li class="listitem"><p>
            <code class="literal">cache_only</code>: Use the
            <span class="command"><strong>memcached</strong></span> engine as the data store.
          </p></li><li class="listitem"><p>
            <code class="literal">caching</code>: Use both
            <code class="literal">InnoDB</code> and the
            <span class="command"><strong>memcached</strong></span> engine as data stores. In this
            case, if <span class="command"><strong>memcached</strong></span> cannot find a key in
            memory, it searches for the value in an
            <code class="literal">InnoDB</code> table.
          </p></li><li class="listitem"><p>
            <code class="literal">disable</code>: Disable caching.
</p></li></ul>
</div>

<div class="table">
<a name="idm140091632038496"></a><p class="title"><b>Table 15.29 cache_policies Columns</b></p>
<div class="table-contents">
<table frame="all" summary="Columns of the cache_policies table."><col width="50%"><col width="50%"><thead><tr>
            <th scope="col">Column</th>
            <th scope="col">Description</th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">policy_name</code></td>
            <td>Name of the cache policy. The default cache policy name is
              <code class="literal">cache_policy</code>.</td>
          </tr><tr>
            <td scope="row"><code class="literal">get_policy</code></td>
            <td>The cache policy for get operations. Valid values are
              <code class="literal">innodb_only</code>,
              <code class="literal">cache_only</code>, <code class="literal">caching</code>,
              or <code class="literal">disabled</code>. The default setting is
              <code class="literal">innodb_only</code>.</td>
          </tr><tr>
            <td scope="row"><code class="literal">set_policy</code></td>
            <td>The cache policy for set operations. Valid values are
              <code class="literal">innodb_only</code>,
              <code class="literal">cache_only</code>, <code class="literal">caching</code>,
              or <code class="literal">disabled</code>. The default setting is
              <code class="literal">innodb_only</code>.</td>
          </tr><tr>
            <td scope="row"><code class="literal">delete_policy</code></td>
            <td>The cache policy for delete operations. Valid values are
              <code class="literal">innodb_only</code>,
              <code class="literal">cache_only</code>, <code class="literal">caching</code>,
              or <code class="literal">disabled</code>. The default setting is
              <code class="literal">innodb_only</code>.</td>
          </tr><tr>
            <td scope="row"><code class="literal">flush_policy</code></td>
            <td>The cache policy for flush operations. Valid values are
              <code class="literal">innodb_only</code>,
              <code class="literal">cache_only</code>, <code class="literal">caching</code>,
              or <code class="literal">disabled</code>. The default setting is
              <code class="literal">innodb_only</code>.</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-config-options-table"></a>config_options Table</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">config_options</code> table stores
        <span class="command"><strong>memcached</strong></span>-related settings that can be
        changed at runtime using SQL. Supported configuration options
        are <code class="literal">separator</code> and
        <code class="literal">table_map_delimiter</code>.
</p>
<div class="table">
<a name="idm140091631998320"></a><p class="title"><b>Table 15.30 config_options Columns</b></p>
<div class="table-contents">
<table frame="all" summary="Columns of the config_options table."><col width="20%"><col width="80%"><thead><tr>
            <th scope="col">Column</th>
            <th scope="col">Description</th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">Name</code></td>
            <td>Name of the <span class="command"><strong>memcached</strong></span>-related configuration option.
              The following configuration options are supported by the
<code class="literal">config_options</code> table:
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                    <code class="literal">separator</code>: Used to separate
                    values of a long string into separate values when
                    there are multiple <code class="literal">value_columns</code>
                    defined. By default, the
                    <code class="literal">separator</code> is a
                    <code class="literal">|</code> character. For example, if you
                    define <code class="literal">col1, col2</code> as value
                    columns, and you define <code class="literal">|</code> as the
                    separator, you can issue the following
                    <span class="command"><strong>memcached</strong></span> command to insert
                    values into <code class="literal">col1</code> and
                    <code class="literal">col2</code>, respectively:
                  </p><pre data-lang="terminal" class="programlisting">
set keyx 10 0 19
valuecolx|valuecoly
</pre><p>
                    <code class="literal">valuecol1x</code> is stored in
                    <code class="literal">col1</code> and
                    <code class="literal">valuecoly</code> is stored in
                    <code class="literal">col2</code>.
                  </p></li><li class="listitem"><p>
                    <code class="literal">table_map_delimiter</code>: The
                    character separating the schema name and the table
                    name when you use the <code class="literal">@@</code> notation
                    in a key name to access a key in a specific table.
                    For example, <code class="literal">@@t1.some_key</code> and
                    <code class="literal">@@t2.some_key</code> have the same key
                    value, but are stored in different tables.
</p></li></ul>
</div>
</td>
          </tr><tr>
            <td scope="row"><code class="literal">Value</code></td>
            <td>The value assigned to the <span class="command"><strong>memcached</strong></span>-related
              configuration option.</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-containers-table"></a>containers Table</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">containers</code> table is the most important of
        the three configuration tables. Each <code class="literal">InnoDB</code>
        table that is used to store <span class="command"><strong>memcached</strong></span> values
        must have an entry in the <code class="literal">containers</code> table.
        The entry provides a mapping between <code class="literal">InnoDB</code>
        table columns and container table columns, which is required for
        <code class="literal">memcached</code> to work with
        <code class="literal">InnoDB</code> tables.
      </p><p>
        The <code class="literal">containers</code> table contains a default entry
        for the <code class="literal">test.demo_test</code> table, which is
        created by the <code class="filename">innodb_memcached_config.sql</code>
        configuration script. To use the
        <code class="literal">daemon_memcached</code> plugin with your own
        <code class="literal">InnoDB</code> table, you must create an entry in the
        <code class="literal">containers</code> table.
</p>
<div class="table">
<a name="idm140091631956320"></a><p class="title"><b>Table 15.31 containers Columns</b></p>
<div class="table-contents">
<table frame="all" summary="Columns of the containers table."><col width="30%"><col width="70%"><thead><tr>
            <th scope="col">Column</th>
            <th scope="col">Description</th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">name</code></td>
            <td>The name given to the container. If an <code class="literal">InnoDB</code> table
              is not requested by name using <code class="literal">@@</code>
              notation, the <code class="literal">daemon_memcached</code> plugin
              uses the <code class="literal">InnoDB</code> table with a
              <code class="literal">containers.name</code> value of
              <code class="literal">default</code>. If there is no such entry, the
              first entry in the <code class="literal">containers</code> table,
              ordered alphabetically by <code class="literal">name</code>
              (ascending), determines the default
              <code class="literal">InnoDB</code> table.</td>
          </tr><tr>
            <td scope="row"><code class="literal">db_schema</code></td>
            <td>The name of the database where the <code class="literal">InnoDB</code> table
              resides. This is a required value.</td>
          </tr><tr>
            <td scope="row"><code class="literal">db_table</code></td>
            <td>The name of the <code class="literal">InnoDB</code> table that stores
              <span class="command"><strong>memcached</strong></span> values. This is a required
              value.</td>
          </tr><tr>
            <td scope="row"><code class="literal">key_columns</code></td>
            <td>The column in the <code class="literal">InnoDB</code> table that contains lookup
              key values for <span class="command"><strong>memcached</strong></span> operations.
              This is a required value.</td>
          </tr><tr>
            <td scope="row"><code class="literal">value_columns</code></td>
            <td>The <code class="literal">InnoDB</code> table columns (one or more) that store
              <code class="literal">memcached</code> data. Multiple columns can be
              specified using the separator character specified in the
              <code class="literal">innodb_memcached.config_options</code> table.
              By default, the separator is a pipe character
              (<span class="quote">“<span class="quote">|</span>”</span>). To specify multiple columns, separate
              them with the defined separator character. For example:
              <code class="literal">col1|col2|col3</code>. This is a required
              value.</td>
          </tr><tr>
            <td scope="row"><code class="literal">flags</code></td>
            <td>The <code class="literal">InnoDB</code> table columns that are used as flags (a
              user-defined numeric value that is stored and retrieved
              along with the main value) for
              <span class="command"><strong>memcached</strong></span>. A flag value can be used as
              a column specifier for some operations (such as
              <code class="literal">incr</code>, <code class="literal">prepend</code>) if a
              <span class="command"><strong>memcached</strong></span> value is mapped to multiple
              columns, so that an operation is performed on a specified
              column. For example, if you have mapped a
              <code class="literal">value_columns</code> to three
              <code class="literal">InnoDB</code> table columns, and only want the
              increment operation performed on one columns, use the
              <code class="literal">flags</code> column to specify the column. If
              you do not use the <code class="literal">flags</code> column, set a
              value of <code class="literal">0</code> to indicate that it is
              unused.</td>
          </tr><tr>
            <td scope="row"><code class="literal">cas_column</code></td>
            <td>The <code class="literal">InnoDB</code> table column that stores compare-and-swap
              (cas) values. The <code class="literal">cas_column</code> value is
              related to the way <span class="command"><strong>memcached</strong></span> hashes
              requests to different servers and caches data in memory.
              Because the <code class="literal">InnoDB</code>
              <span class="command"><strong>memcached</strong></span> plugin is tightly integrated
              with a single <span class="command"><strong>memcached</strong></span> daemon, and the
              in-memory caching mechanism is handled by MySQL and the
              <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">InnoDB buffer
              pool</a>, this column is rarely needed. If you do not
              use this column, set a value of <code class="literal">0</code> to
              indicate that it is unused.</td>
          </tr><tr>
            <td scope="row"><code class="literal">expire_time_column</code></td>
            <td>The <code class="literal">InnoDB</code> table column that stores expiration
              values. The <code class="literal">expire_time_column</code> value is
              related to the way <span class="command"><strong>memcached</strong></span> hashes
              requests to different servers and caches data in memory.
              Because the <code class="literal">InnoDB</code>
              <span class="command"><strong>memcached</strong></span> plugin is tightly integrated
              with a single <span class="command"><strong>memcached</strong></span> daemon, and the
              in-memory caching mechanism is handled by MySQL and the
              <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">InnoDB buffer
              pool</a>, this column is rarely needed. If you do not
              use this column, set a value of <code class="literal">0</code> to
              indicate that the column is unused. The maximum expire
              time is defined as <code class="literal">INT_MAX32</code> or
              2147483647 seconds (approximately 68 years).</td>
          </tr><tr>
            <td scope="row"><code class="literal">unique_idx_name_on_key</code></td>
            <td>The name of the index on the key column. It must be a unique index. It
              can be the <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
              key</a> or a
              <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
              index</a>. Preferably, use the primary key of the
              <code class="literal">InnoDB</code> table. Using the primary key
              avoids a lookup that is performed when using a secondary
              index. You cannot make a
              <a class="link" href="glossary.html#glos_covering_index" title="covering index">covering index</a>
              for <span class="command"><strong>memcached</strong></span> lookups;
              <code class="literal">InnoDB</code> returns an error if you try to
              define a composite secondary index over both the key and
              value columns.</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<h5><a name="idm140091631884480"></a>containers Table Column Constraints</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            You must supply a value for <code class="literal">db_schema</code>,
            <code class="literal">db_name</code>, <code class="literal">key_columns</code>,
            <code class="literal">value_columns</code> and
            <code class="literal">unique_idx_name_on_key</code>. Specify
            <code class="literal">0</code> for <code class="literal">flags</code>,
            <code class="literal">cas_column</code>, and
            <code class="literal">expire_time_column</code> if they are unused.
            Failing to do so could cause your setup to fail.
          </p></li><li class="listitem"><p>
            <code class="literal">key_columns</code>: The maximum limit for a
            <span class="command"><strong>memcached</strong></span> key is 250 characters, which is
            enforced by <span class="command"><strong>memcached</strong></span>. The mapped key
            must be a non-Null <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a> or
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> type.
          </p></li><li class="listitem"><p>
            <code class="literal">value_columns</code>: Must be mapped to a
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR</code></a>,
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, or
            <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> column. There is no
            length restriction and the value can be NULL.
          </p></li><li class="listitem"><p>
            <code class="literal">cas_column</code>: The <code class="literal">cas</code>
            value is a 64 bit integer. It must be mapped to a
            <a class="link" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">BIGINT</code></a> of at least 8 bytes.
            If you do not use this column, set a value of
            <code class="literal">0</code> to indicate that it is unused.
          </p></li><li class="listitem"><p>
            <code class="literal">expiration_time_column</code>: Must mapped to an
            <a class="link" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">INTEGER</code></a> of at least 4 bytes.
            Expiration time is defined as a 32-bit integer for Unix time
            (the number of seconds since January 1, 1970, as a 32-bit
            value), or the number of seconds starting from the current
            time. For the latter, the number of seconds may not exceed
            60*60*24*30 (the number of seconds in 30 days). If the
            number sent by a client is larger, the server considers it
            to be a real Unix time value rather than an offset from the
            current time. If you do not use this column, set a value of
            <code class="literal">0</code> to indicate that it is unused.
          </p></li><li class="listitem"><p>
            <code class="literal">flags</code>: Must be mapped to an
            <a class="link" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">INTEGER</code></a> of at least 32-bits
            and can be NULL. If you do not use this column, set a value
            of <code class="literal">0</code> to indicate that it is unused.
</p></li></ul>
</div>
<p>
        A pre-check is performed at plugin load time to enforce column
        constraints. If mismatches are found, the plugin is not loaded.
</p>
<h5><a name="idm140091631852864"></a>Multiple Value Column Mapping</h5>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            During plugin initialization, when <code class="literal">InnoDB</code>
            <span class="command"><strong>memcached</strong></span> is configured with information
            defined in the <code class="literal">containers</code> table, each
            mapped column defined in
            <code class="literal">containers.value_columns</code> is verified
            against the mapped <code class="literal">InnoDB</code> table. If
            multiple <code class="literal">InnoDB</code> table columns are mapped,
            there is a check to ensure that each column exists and is
            the right type.
          </p></li><li class="listitem"><p>
            At run-time, for <code class="literal">memcached</code> insert
            operations, if there are more delimited values than the
            number of mapped columns, only the number of mapped values
            are taken. For example, if there are six mapped columns, and
            seven delimited values are provided, only the first six
            delimited values are taken. The seventh delimited value is
            ignored.
          </p></li><li class="listitem"><p>
            If there are fewer delimited values than mapped columns,
            unfilled columns are set to NULL. If an unfilled column
            cannot be set to NULL, insert operations fail.
          </p></li><li class="listitem"><p>
            If a table has more columns than mapped values, the extra
            columns do not affect results.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="innodb-memcached-demo-test-table"></a>The demo_test Example Table</h4>

</div>

</div>

</div>
<p>
        The <code class="filename">innodb_memcached_config.sql</code>
        configuration script creates a <code class="literal">demo_test</code>
        table in the <code class="literal">test</code> database, which can be used
        to verify <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span>
        plugin installation immediately after setup.
      </p><p>
        The <code class="filename">innodb_memcached_config.sql</code>
        configuration script also creates an entry for the
        <code class="literal">demo_test</code> table in the
        <code class="literal">innodb_memcache.containers</code> table.
      </p><pre data-lang="terminal" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT * FROM innodb_memcache.containers\G</code></strong>
*************************** 1. row ***************************
                  name: aaa
             db_schema: test
              db_table: demo_test
           key_columns: c1
         value_columns: c2
                 flags: c3
            cas_column: c4
    expire_time_column: c5
unique_idx_name_on_key: PRIMARY

mysql&gt; <strong class="userinput"><code>SELECT * FROM test.demo_test;</code></strong>
+----+------------------+------+------+------+
| c1 | c2               | c3   | c4   | c5   |
+----+------------------+------+------+------+
| AA | HELLO, HELLO     |    8 |    0 |    0 |
+----+------------------+------+------+------+
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-memcached-troubleshoot"></a>15.19.9 Troubleshooting the InnoDB memcached Plugin</h3>

</div>

</div>

</div>
<p>
      This section describes issues that you may encounter when using
      the <code class="literal">InnoDB</code> <span class="command"><strong>memcached</strong></span> plugin.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If you encounter the following error in the MySQL error log,
          the server might fail to start:
        </p><p>
          <span class="errortext">failed to set rlimit for open files. Try running as
          root or requesting smaller maxconns value.</span>
        </p><p>
          The error message is from the <span class="command"><strong>memcached</strong></span>
          daemon. One solution is to raise the OS limit for the number
          of open files. The commands for checking and increasing the
          open file limit varies by operating system. This example shows
          commands for Linux and OS X:
        </p><pre data-lang="terminal" class="programlisting">
# Linux
shell&gt; <strong class="userinput"><code>ulimit -n</code></strong>
1024
shell&gt; <strong class="userinput"><code>ulimit -n 4096</code></strong>
shell&gt; <strong class="userinput"><code>ulimit -n</code></strong>
4096

# OS X
shell&gt; <strong class="userinput"><code>ulimit -n</code></strong>
256
shell&gt; <strong class="userinput"><code>ulimit -n 4096</code></strong>
shell&gt; <strong class="userinput"><code>ulimit -n</code></strong>
4096
</pre><p>
          The other solution is to reduce the number of concurrent
          connections permitted for the <span class="command"><strong>memcached</strong></span>
          daemon. To do so, encode the <code class="literal">-c</code>
          <span class="command"><strong>memcached</strong></span> option in the
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
          configuration parameter in the MySQL configuration file. The
          <code class="literal">-c</code> option has a default value of 1024.
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
...
loose-daemon_memcached_option='-c 64'
</pre></li><li class="listitem"><p>
          To troubleshoot problems where the
          <span class="command"><strong>memcached</strong></span> daemon is unable to store or
          retrieve <code class="literal">InnoDB</code> table data, encode the
          <code class="literal">-vvv</code> <span class="command"><strong>memcached</strong></span> option in
          the <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
          configuration parameter in the MySQL configuration file.
          Examine the MySQL error log for debug output related to
          <span class="command"><strong>memcached</strong></span> operations.
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
...
loose-daemon_memcached_option='-vvv'
</pre></li><li class="listitem"><p>
          If columns specified to hold <span class="command"><strong>memcached</strong></span>
          values are the wrong data type, such as a numeric type instead
          of a string type, attempts to store key-value pairs fail with
          no specific error code or message.
        </p></li><li class="listitem"><p>
          If the <code class="literal">daemon_memcached</code> plugin causes MySQL
          server startup issues, you can temporarily disable the
          <code class="literal">daemon_memcached</code> plugin while
          troubleshooting by adding this line under the
          <code class="literal">[mysqld]</code> group in the MySQL configuration
          file:
        </p><pre data-lang="ini" class="programlisting">
daemon_memcached=OFF
</pre><p>
          For example, if you run the <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL
          PLUGIN</code></a> statement before running the
          <code class="filename">innodb_memcached_config.sql</code> configuration
          script to set up the necessary database and tables, the server
          might crash and fail to start. The server could also fail to
          start if you incorrectly configure an entry in the
          <code class="literal">innodb_memcache.containers</code> table.
        </p><p>
          To uninstall the <span class="command"><strong>memcached</strong></span> plugin for a
          MySQL instance, issue the following statement:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>UNINSTALL PLUGIN daemon_memcached;</code></strong>
</pre></li><li class="listitem"><p>
          If you run more than one instance of MySQL on the same machine
          with the <code class="literal">daemon_memcached</code> plugin enabled in
          each instance, use the
          <a class="link" href="innodb-storage-engine.html#sysvar_daemon_memcached_option"><code class="literal">daemon_memcached_option</code></a>
          configuration parameter to specify a unique
          <span class="command"><strong>memcached</strong></span> port for each
          <code class="literal">daemon_memcached</code> plugin.
        </p></li><li class="listitem"><p>
          If an SQL statement cannot find the <code class="literal">InnoDB</code>
          table or finds no data in the table, but
          <span class="command"><strong>memcached</strong></span> API calls retrieve the expected
          data, you may be missing an entry for the
          <code class="literal">InnoDB</code> table in the
          <code class="literal">innodb_memcache.containers</code> table, or you
          may have not switched to the correct <code class="literal">InnoDB</code>
          table by issuing a <code class="literal">get</code> or
          <code class="literal">set</code> request using
          <code class="literal">@@<em class="replaceable"><code>table_id</code></em></code>
          notation. This problem could also occur if you change an
          existing entry in the
          <code class="literal">innodb_memcache.containers</code> table without
          restarting the MySQL server afterward. The free-form storage
          mechanism is flexible enough that your requests to store or
          retrieve a multi-column value such as
          <code class="literal">col1|col2|col3</code> may still work, even if the
          daemon is using the <code class="literal">test.demo_test</code> table
          which stores values in a single column.
        </p></li><li class="listitem"><p>
          When defining your own <code class="literal">InnoDB</code> table for use
          with the <code class="literal">daemon_memcached</code> plugin, and
          columns in the table are defined as <code class="literal">NOT
          NULL</code>, ensure that values are supplied for the
          <code class="literal">NOT NULL</code> columns when inserting a record
          for the table into the
          <code class="literal">innodb_memcache.containers</code> table. If the
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> statement for the
          <code class="literal">innodb_memcache.containers</code> record contains
          fewer delimited values than there are mapped columns, unfilled
          columns are set to <code class="literal">NULL</code>. Attempting to
          insert a <code class="literal">NULL</code> value into a <code class="literal">NOT
          NULL</code> column causes the
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> to fail, which may only
          become evident after you reinitialize the
          <code class="literal">daemon_memcached</code> plugin to apply changes to
          the <code class="literal">innodb_memcache.containers</code> table.
        </p></li><li class="listitem"><p>
          If <code class="literal">cas_column</code> and
          <code class="literal">expire_time_column</code> fields of the
          <code class="literal">innodb_memcached.containers</code> table are set
          to <code class="literal">NULL</code>, the following error is returned
          when attempting to load the <span class="command"><strong>memcached</strong></span>
          plugin:
        </p><pre data-lang="terminal" class="programlisting">
InnoDB_Memcached: column 6 in the entry for config table 'containers' in
database 'innodb_memcache' has an invalid NULL value.
</pre><p>
          The <span class="command"><strong>memcached</strong></span> plugin rejects usage of
          <code class="literal">NULL</code> in the <code class="literal">cas_column</code>
          and <code class="literal">expire_time_column</code> columns. Set the
          value of these columns to <code class="literal">0</code> when the
          columns are unused.
        </p></li><li class="listitem"><p>
          As the length of the <span class="command"><strong>memcached</strong></span> key and
          values increase, you might encounter size and length limits.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              When the key exceeds 250 bytes,
              <span class="command"><strong>memcached</strong></span> operations return an error.
              This is currently a fixed limit within
              <span class="command"><strong>memcached</strong></span>.
            </p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code> table limits may be encountered
              if values exceed 768 bytes in size, 3072 bytes in size, or
              half of the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a> value.
              These limits primarily apply if you intend to create an
              index on a value column to run report-generating queries
              on that column using SQL. See
              <a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="15.6.1.6 Limits on InnoDB Tables">Section 15.6.1.6, “Limits on InnoDB Tables”</a> for details.
            </p></li><li class="listitem"><p>
              The maximum size for the key-value combination is 1 MB.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          If you share configuration files across MySQL servers of
          different versions, using the latest configuration options for
          the <code class="literal">daemon_memcached</code> plugin could cause
          startup errors on older MySQL versions. To avoid compatibility
          problems, use the <code class="literal">loose</code> prefix with option
          names. For example, use
          <code class="literal">loose-daemon_memcached_option='-c 64'</code>
          instead of <code class="literal">daemon_memcached_option='-c 64'</code>.
        </p></li><li class="listitem"><p>
          There is no restriction or check in place to validate
          character set settings. <span class="command"><strong>memcached</strong></span> stores
          and retrieves keys and values in bytes and is therefore not
          character set sensitive. However, you must ensure that the
          <span class="command"><strong>memcached</strong></span> client and the MySQL table use
          the same character set.
        </p></li><li class="listitem"><p>
          <span class="command"><strong>memcached</strong></span> connections are blocked from
          accessing tables that contain an indexed virtual column.
          Accessing an indexed virtual column requires a callback to the
          server, but a <span class="command"><strong>memcached</strong></span> connection does not
          have access to the server code.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-troubleshooting"></a>15.20 InnoDB Troubleshooting</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#error-creating-innodb">15.20.1 Troubleshooting InnoDB I/O Problems</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#forcing-innodb-recovery">15.20.2 Forcing InnoDB Recovery</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-troubleshooting-datadict">15.20.3 Troubleshooting InnoDB Data Dictionary Operations</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-error-handling">15.20.4 InnoDB Error Handling</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091631739328"></a><p>
    The following general guidelines apply to troubleshooting
    <code class="literal">InnoDB</code> problems:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        When an operation fails or you suspect a bug, look at the MySQL
        server error log (see <a class="xref" href="server-administration.html#error-log" title="5.4.2 The Error Log">Section 5.4.2, “The Error Log”</a>).
        <a class="xref" href="error-handling.html#server-error-reference" title="B.3.1 Server Error Message Reference">Section B.3.1, “Server Error Message Reference”</a> provides
        troubleshooting information for some of the common
        <code class="literal">InnoDB</code>-specific errors that you may
        encounter.
      </p></li><li class="listitem"><p>
        If the failure is related to a
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>, run with the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a>
        option enabled so that details about each deadlock are printed
        to the MySQL server error log. For information about deadlocks,
        see <a class="xref" href="innodb-storage-engine.html#innodb-deadlocks" title="15.7.5 Deadlocks in InnoDB">Section 15.7.5, “Deadlocks in InnoDB”</a>.
      </p></li><li class="listitem"><p>
        If the issue is related to the <code class="literal">InnoDB</code> data
        dictionary, see
        <a class="xref" href="innodb-storage-engine.html#innodb-troubleshooting-datadict" title="15.20.3 Troubleshooting InnoDB Data Dictionary Operations">Section 15.20.3, “Troubleshooting InnoDB Data Dictionary Operations”</a>.
      </p></li><li class="listitem"><p>
        When troubleshooting, it is usually best to run the MySQL server
        from the command prompt, rather than through
        <a class="link" href="programs.html#mysqld-safe" title="4.3.2 mysqld_safe — MySQL Server Startup Script"><span class="command"><strong>mysqld_safe</strong></span></a> or as a Windows service. You can
        then see what <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> prints to the console,
        and so have a better grasp of what is going on. On Windows,
        start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
        <a class="link" href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option to direct the
        output to the console window.
      </p></li><li class="listitem"><p>
        <a class="indexterm" name="idm140091631720880"></a>

        <a class="indexterm" name="idm140091631719392"></a>

        Enable the <code class="literal">InnoDB</code> Monitors to obtain
        information about a problem (see
        <a class="xref" href="innodb-storage-engine.html#innodb-monitors" title="15.16 InnoDB Monitors">Section 15.16, “InnoDB Monitors”</a>). If the problem is
        performance-related, or your server appears to be hung, you
        should enable the standard Monitor to print information about
        the internal state of <code class="literal">InnoDB</code>. If the problem
        is with locks, enable the Lock Monitor. If the problem is with
        table creation, tablespaces, or data dictionary operations,
        refer to the
        <a class="link" href="innodb-storage-engine.html#innodb-information-schema-system-tables" title="15.14.3 InnoDB INFORMATION_SCHEMA Schema Object Tables">InnoDB
        Information Schema system tables</a> to examine contents of
        the <code class="literal">InnoDB</code> internal data dictionary.
      </p><p>
        <code class="literal">InnoDB</code> temporarily enables standard
        <code class="literal">InnoDB</code> Monitor output under the following
        conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
            A long semaphore wait
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> cannot find free blocks in the
            buffer pool
          </p></li><li class="listitem"><p>
            Over 67% of the buffer pool is occupied by lock heaps or the
            adaptive hash index
</p></li></ul>
</div>
</li><li class="listitem"><p>
        If you suspect that a table is corrupt, run
        <a class="link" href="sql-syntax.html#check-table" title="13.7.3.2 CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> on that table.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="error-creating-innodb"></a>15.20.1 Troubleshooting InnoDB I/O Problems</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091631704560"></a><p>
      The troubleshooting steps for <code class="literal">InnoDB</code> I/O
      problems depend on when the problem occurs: during startup of the
      MySQL server, or during normal operations when a DML or DDL
      statement fails due to problems at the file system level.
</p>
<h4><a name="idm140091631701344"></a>Initialization Problems</h4>
<p>
      If something goes wrong when <code class="literal">InnoDB</code> attempts to
      initialize its tablespace or its log files, delete all files
      created by <code class="literal">InnoDB</code>: all
      <code class="filename">ibdata</code> files and all
      <code class="filename">ib_logfile</code> files. If you already created some
      <code class="literal">InnoDB</code> tables, also delete any
      <code class="filename">.ibd</code> files from the MySQL database
      directories. Then try the <code class="literal">InnoDB</code> database
      creation again. For easiest troubleshooting, start the MySQL
      server from a command prompt so that you see what is happening.
</p>
<h4><a name="idm140091631694880"></a>Runtime Problems</h4>
<p>
      If <code class="literal">InnoDB</code> prints an operating system error
      during a file operation, usually the problem has one of the
      following solutions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Make sure the <code class="literal">InnoDB</code> data file directory
          and the <code class="literal">InnoDB</code> log directory exist.
        </p></li><li class="listitem"><p>
          Make sure <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> has access rights to
          create files in those directories.
        </p></li><li class="listitem"><p>
          Make sure <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> can read the proper
          <code class="filename">my.cnf</code> or <code class="filename">my.ini</code>
          option file, so that it starts with the options that you
          specified.
        </p></li><li class="listitem"><p>
          Make sure the disk is not full and you are not exceeding any
          disk quota.
        </p></li><li class="listitem"><p>
          Make sure that the names you specify for subdirectories and
          data files do not clash.
        </p></li><li class="listitem"><p>
          Doublecheck the syntax of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> values.
          In particular, any <code class="literal">MAX</code> value in the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> option
          is a hard limit, and exceeding that limit causes a fatal
          error.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="forcing-innodb-recovery"></a>15.20.2 Forcing InnoDB Recovery</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091631676128"></a><a class="indexterm" name="idm140091631674224"></a><a class="indexterm" name="idm140091631672768"></a><p>
      To investigate database page corruption, you might dump your
      tables from the database with
      <a class="link" href="sql-syntax.html#select-into" title="13.2.10.1 SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
      OUTFILE</code></a>. Usually, most of the data obtained in this way
      is intact. Serious corruption might cause <code class="literal">SELECT * FROM
      <em class="replaceable"><code>tbl_name</code></em></code> statements or
      <code class="literal">InnoDB</code> background operations to crash or
      assert, or even cause <code class="literal">InnoDB</code> roll-forward
      recovery to crash. In such cases, you can use the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> option to
      force the <code class="literal">InnoDB</code> storage engine to start up
      while preventing background operations from running, so that you
      can dump your tables. For example, you can add the following line
      to the <code class="literal">[mysqld]</code> section of your option file
      before restarting the server:
    </p><pre data-lang="ini" class="programlisting">
[mysqld]
innodb_force_recovery = 1
</pre><p>
      For information about using option files, see
      <a class="xref" href="programs.html#option-files" title="4.2.2.2 Using Option Files">Section 4.2.2.2, “Using Option Files”</a>.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
        Only set <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a>
        to a value greater than 0 in an emergency situation, so that you
        can start <code class="literal">InnoDB</code> and dump your tables. Before
        doing so, ensure that you have a backup copy of your database in
        case you need to recreate it. Values of 4 or greater can
        permanently corrupt data files. Only use an
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> setting
        of 4 or greater on a production server instance after you have
        successfully tested the setting on a separate physical copy of
        your database. When forcing <code class="literal">InnoDB</code> recovery,
        you should always start with
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery=1</code></a> and
        only increase the value incrementally, as necessary.
</p>
</div>
<p>
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> is 0 by
      default (normal startup without forced recovery). The permissible
      nonzero values for
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> are 1 to 6.
      A larger value includes the functionality of lesser values. For
      example, a value of 3 includes all of the functionality of values
      1 and 2.
    </p><p>
      If you are able to dump your tables with an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> value of 3
      or less, then you are relatively safe that only some data on
      corrupt individual pages is lost. A value of 4 or greater is
      considered dangerous because data files can be permanently
      corrupted. A value of 6 is considered drastic because database
      pages are left in an obsolete state, which in turn may introduce
      more corruption into <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-trees</a>
      and other database structures.
    </p><p>
      As a safety measure, <code class="literal">InnoDB</code> prevents
      <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations when
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> is greater
      than 0. An <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a>
      setting of 4 or greater places <code class="literal">InnoDB</code> in
      read-only mode.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">1</code>
          (<code class="literal">SRV_FORCE_IGNORE_CORRUPT</code>)
        </p><p>
          Lets the server run even if it detects a corrupt
          <a class="link" href="glossary.html#glos_page" title="page">page</a>. Tries to make
          <code class="literal">SELECT * FROM
          <em class="replaceable"><code>tbl_name</code></em></code> jump over
          corrupt index records and pages, which helps in dumping
          tables.
        </p></li><li class="listitem"><p>
          <code class="literal">2</code>
          (<code class="literal">SRV_FORCE_NO_BACKGROUND</code>)
        </p><p>
          Prevents the <a class="link" href="glossary.html#glos_master_thread" title="master thread">master
          thread</a> and any <a class="link" href="glossary.html#glos_purge_thread" title="purge thread">purge
          threads</a> from running. If a crash would occur during the
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation, this
          recovery value prevents it.
        </p></li><li class="listitem"><p>
          <code class="literal">3</code>
          (<code class="literal">SRV_FORCE_NO_TRX_UNDO</code>)
        </p><p>
          Does not run transaction
          <a class="link" href="glossary.html#glos_rollback" title="rollback">rollbacks</a> after
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">4</code>
          (<code class="literal">SRV_FORCE_NO_IBUF_MERGE</code>)
        </p><p>
          Prevents <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">insert
          buffer</a> merge operations. If they would cause a crash,
          does not do them. Does not calculate table
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a>. This value
          can permanently corrupt data files. After using this value, be
          prepared to drop and recreate all secondary indexes. Sets
          <code class="literal">InnoDB</code> to read-only.
        </p></li><li class="listitem"><p>
          <code class="literal">5</code>
          (<code class="literal">SRV_FORCE_NO_UNDO_LOG_SCAN</code>)
        </p><p>
          Does not look at <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo
          logs</a> when starting the database:
          <code class="literal">InnoDB</code> treats even incomplete transactions
          as committed. This value can permanently corrupt data files.
          Sets <code class="literal">InnoDB</code> to read-only.
        </p></li><li class="listitem"><p>
          <code class="literal">6</code>
          (<code class="literal">SRV_FORCE_NO_LOG_REDO</code>)
        </p><p>
          Does not do the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a>
          roll-forward in connection with recovery. This value can
          permanently corrupt data files. Leaves database pages in an
          obsolete state, which in turn may introduce more corruption
          into B-trees and other database structures. Sets
          <code class="literal">InnoDB</code> to read-only.
</p></li></ul>
</div>
<p>
      You can <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> from tables to dump
      them. With an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> value of 3
      or less you can <code class="literal">DROP</code> or
      <code class="literal">CREATE</code> tables. <a class="link" href="sql-syntax.html#drop-table" title="13.1.32 DROP TABLE Syntax"><code class="literal">DROP
      TABLE</code></a> is also supported with an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> value
      greater than 3. <a class="link" href="sql-syntax.html#drop-table" title="13.1.32 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> is not
      permitted with an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> value
      greater than 4.
    </p><p>
      If you know that a given table is causing a crash on rollback, you
      can drop it. If you encounter a runaway rollback caused by a
      failing mass import or <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>,
      you can kill the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process and set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> to
      <code class="literal">3</code> to bring the database up without the
      rollback, and then <code class="literal">DROP</code> the table that is
      causing the runaway rollback.
    </p><p>
      If corruption within the table data prevents you from dumping the
      entire table contents, a query with an <code class="literal">ORDER BY
      <em class="replaceable"><code>primary_key</code></em> DESC</code> clause might
      be able to dump the portion of the table after the corrupted part.
    </p><p>
      If a high <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a>
      value is required to start <code class="literal">InnoDB</code>, there may be
      corrupted data structures that could cause complex queries
      (queries containing <code class="literal">WHERE</code>, <code class="literal">ORDER
      BY</code>, or other clauses) to fail. In this case, you may
      only be able to run basic <code class="literal">SELECT * FROM t</code>
      queries.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-troubleshooting-datadict"></a>15.20.3 Troubleshooting InnoDB Data Dictionary Operations</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091631588096"></a><p>
      Information about table definitions is stored in the InnoDB
      <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data dictionary</a>. If
      you move data files around, dictionary data can become
      inconsistent.
    </p><p>
      If a data dictionary corruption or consistency issue prevents you
      from starting <code class="literal">InnoDB</code>, see
      <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="15.20.2 Forcing InnoDB Recovery">Section 15.20.2, “Forcing InnoDB Recovery”</a> for information about
      manual recovery.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="innodb-cannot-open-data-file-error"></a>Cannot Open Datafile</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091631581680"></a><p>
        With <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
        enabled (the default), the following messages may appear at
        startup if a
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        tablespace file (<code class="literal">.ibd</code> file) is missing:
      </p><pre data-lang="terminal" class="programlisting">
[ERROR] InnoDB: Operating system error number 2 in a file operation.
[ERROR] InnoDB: The error means the system cannot find the path specified.
[ERROR] InnoDB: Cannot open datafile for read-only: './test/t1.ibd' OS error: 71
[Warning] InnoDB: Ignoring tablespace `test/t1` because it could not be opened.
</pre><p>
        To address the these messages, issue <a class="link" href="sql-syntax.html#drop-table" title="13.1.32 DROP TABLE Syntax"><code class="literal">DROP
        TABLE</code></a> statement to remove data about the missing table
        from the data dictionary.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="restoring-orphaned-idb-files"></a>Restoring Orphan File-Per-Table ibd Files</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091631572080"></a><p>
        This procedure describes how to restore orphan
        <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
        <code class="filename">.ibd</code> files to another MySQL instance. You
        might use this procedure if the system tablespace is lost or
        unrecoverable and you want to restore <code class="filename">.ibd</code>
        file backups on a new MySQL instance.
      </p><p>
        The procedure is not supported for
        <a class="link" href="glossary.html#glos_general_tablespace" title="general tablespace">general
        tablespace</a> <code class="filename">.ibd</code> files.
      </p><p>
        The procedure assumes that you only have
        <code class="filename">.ibd</code> file backups, you are recovering to
        the same version of MySQL that initially created the orphan
        <code class="filename">.ibd</code> files, and that
        <code class="filename">.ibd</code> file backups are clean. See
        <a class="xref" href="innodb-storage-engine.html#innodb-migration" title="15.6.1.2 Moving or Copying InnoDB Tables">Section 15.6.1.2, “Moving or Copying InnoDB Tables”</a> for information about
        creating clean backups.
      </p><p>
        Tablespace copying limitations outlined in
        <a class="xref" href="innodb-storage-engine.html#tablespace-copying" title="15.6.3.7 Copying Tablespaces to Another Instance">Section 15.6.3.7, “Copying Tablespaces to Another Instance”</a> are applicable to this
        procedure.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            On the new MySQL instance, recreate the table in a database
            of the same name.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE DATABASE sakila;</code></strong>

mysql&gt; <strong class="userinput"><code>USE sakila;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE actor (</code></strong>
         <strong class="userinput"><code>actor_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,</code></strong>
         <strong class="userinput"><code>first_name VARCHAR(45) NOT NULL,</code></strong>
         <strong class="userinput"><code>last_name VARCHAR(45) NOT NULL,</code></strong>
         <strong class="userinput"><code>last_update TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</code></strong>
         <strong class="userinput"><code>PRIMARY KEY  (actor_id),</code></strong>
         <strong class="userinput"><code>KEY idx_actor_last_name (last_name)</code></strong>
       <strong class="userinput"><code>)ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></strong>
</pre></li><li class="listitem"><p>
            Discard the tablespace of the newly created table.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER TABLE sakila.actor DISCARD TABLESPACE;</code></strong>
</pre></li><li class="listitem"><p>
            Copy the orphan <code class="literal">.ibd</code> file from your
            backup directory to the new database directory.
          </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>cp /<code class="literal">backup_directory</code>/actor.ibd <em class="replaceable"><code>path/to/mysql-5.7/data</code></em>/sakila/</code></strong>
</pre></li><li class="listitem"><p>
            Ensure that the <code class="filename">.ibd</code> file has the
            necessary file permissions.
          </p></li><li class="listitem"><p>
            Import the orphan <code class="literal">.ibd</code> file. A warning is
            issued indicating that <code class="literal">InnoDB</code> will
            attempt to import the file without schema verification.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER TABLE sakila.actor IMPORT TABLESPACE; SHOW WARNINGS;</code></strong>    
Query OK, 0 rows affected, 1 warning (0.15 sec)

Warning | 1810 | InnoDB: IO Read error: (2, No such file or directory)
Error opening './sakila/actor.cfg', will attempt to import
without schema verification</pre></li><li class="listitem"><p>
            Query the table to verify that the <code class="literal">.ibd</code>
            file was successfully restored.
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT COUNT(*) FROM sakila.actor;</code></strong>
+----------+
| count(*) |
+----------+
|      200 |
+----------+
</pre></li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-error-handling"></a>15.20.4 InnoDB Error Handling</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091631533424"></a><a class="indexterm" name="idm140091631531520"></a><p>
      The following items describe how <code class="literal">InnoDB</code>
      performs error handling. <code class="literal">InnoDB</code> sometimes rolls
      back only the statement that failed, other times it rolls back the
      entire transaction.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If you run out of file space in a
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a>, a MySQL
          <code class="literal">Table is full</code> error occurs and
          <code class="literal">InnoDB</code> rolls back the SQL statement.
        </p></li><li class="listitem"><p>
          A transaction <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>
          causes <code class="literal">InnoDB</code> to
          <a class="link" href="glossary.html#glos_rollback" title="rollback">roll back</a> the entire
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a>. Retry the
          whole transaction when this happens.
        </p><p>
          A lock wait timeout causes <code class="literal">InnoDB</code> to roll
          back only the single statement that was waiting for the lock
          and encountered the timeout. (To have the entire transaction
          roll back, start the server with the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb-rollback-on-timeout</code></a>
          option.) Retry the statement if using the current behavior, or
          the entire transaction if using
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb-rollback-on-timeout</code></a>.
        </p><p>
          Both deadlocks and lock wait timeouts are normal on busy
          servers and it is necessary for applications to be aware that
          they may happen and handle them by retrying. You can make them
          less likely by doing as little work as possible between the
          first change to data during a transaction and the commit, so
          the locks are held for the shortest possible time and for the
          smallest possible number of rows. Sometimes splitting work
          between different transactions may be practical and helpful.
        </p><p>
          When a transaction rollback occurs due to a deadlock or lock
          wait timeout, it cancels the effect of the statements within
          the transaction. But if the start-transaction statement was
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
          TRANSACTION</code></a> or
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">BEGIN</code></a>
          statement, rollback does not cancel that statement. Further
          SQL statements become part of the transaction until the
          occurrence of <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>,
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>, or
          some SQL statement that causes an implicit commit.
        </p></li><li class="listitem"><p>
          A duplicate-key error rolls back the SQL statement, if you
          have not specified the <code class="literal">IGNORE</code> option in
          your statement.
        </p></li><li class="listitem"><p>
          A <code class="literal">row too long error</code> rolls back the SQL
          statement.
        </p></li><li class="listitem"><p>
          Other errors are mostly detected by the MySQL layer of code
          (above the <code class="literal">InnoDB</code> storage engine level),
          and they roll back the corresponding SQL statement. Locks are
          not released in a rollback of a single SQL statement.
</p></li></ul>
</div>
<p>
      During implicit rollbacks, as well as during the execution of an
      explicit
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> SQL
      statement, <a class="link" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST Syntax"><code class="literal">SHOW PROCESSLIST</code></a>
      displays <code class="literal">Rolling back</code> in the
      <code class="literal">State</code> column for the relevant connection.
</p>
</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="data-dictionary.html">Prev</a></td>
<td width="20%" align="center"><a accesskey="u" href="">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="storage-engines.html">Next</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 14 MySQL Data Dictionary</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top">Chapter 16 Alternative Storage Engines</td>
</tr>
</table>
</div>
</body>
</html>
