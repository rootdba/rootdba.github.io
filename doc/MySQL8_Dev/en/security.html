<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 6 Security</title>
<link rel="stylesheet" href="mvl.css" type="text/css" />
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2" />
<link rel="start" href="index.html" title="{book-title}" />
<link rel="up" href="" title="" />
<link rel="prev" href="server-administration.html" title="Chapter 5 MySQL Server Administration" />
<link rel="next" href="backup-and-recovery.html" title="Chapter 7 Backup and Recovery" />
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">Chapter 6 Security</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="server-administration.html">Prev</a> </td>
<th width="60%" align="center"></th>
<td width="20%" align="right"> <a accesskey="n" href="backup-and-recovery.html">Next</a></td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="security"></a>Chapter 6 Security</h1>

</div>

</div>

</div>
<div class="toc">
<p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="security.html#general-security-issues">6.1 General Security Issues</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#security-guidelines">6.1.1 Security Guidelines</a></span></dt><dt><span class="section"><a href="security.html#password-security">6.1.2 Keeping Passwords Secure</a></span></dt><dt><span class="section"><a href="security.html#security-against-attack">6.1.3 Making MySQL Secure Against Attackers</a></span></dt><dt><span class="section"><a href="security.html#security-options">6.1.4 Security-Related mysqld Options and Variables</a></span></dt><dt><span class="section"><a href="security.html#changing-mysql-user">6.1.5 How to Run MySQL as a Normal User</a></span></dt><dt><span class="section"><a href="security.html#load-data-local">6.1.6 Security Issues with LOAD DATA LOCAL</a></span></dt><dt><span class="section"><a href="security.html#secure-client-programming">6.1.7 Client Programming Security Guidelines</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#access-control">6.2 Access Control and Account Management</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#user-names">6.2.1 Account User Names and Passwords</a></span></dt><dt><span class="section"><a href="security.html#privileges-provided">6.2.2 Privileges Provided by MySQL</a></span></dt><dt><span class="section"><a href="security.html#grant-tables">6.2.3 Grant Tables</a></span></dt><dt><span class="section"><a href="security.html#account-names">6.2.4 Specifying Account Names</a></span></dt><dt><span class="section"><a href="security.html#role-names">6.2.5 Specifying Role Names</a></span></dt><dt><span class="section"><a href="security.html#connection-access">6.2.6 Access Control, Stage 1: Connection Verification</a></span></dt><dt><span class="section"><a href="security.html#request-access">6.2.7 Access Control, Stage 2: Request Verification</a></span></dt><dt><span class="section"><a href="security.html#creating-accounts">6.2.8 Adding Accounts, Assigning Privileges, and Dropping Accounts</a></span></dt><dt><span class="section"><a href="security.html#reserved-users">6.2.9 Reserved Accounts</a></span></dt><dt><span class="section"><a href="security.html#roles">6.2.10 Using Roles</a></span></dt><dt><span class="section"><a href="security.html#account-categories">6.2.11 Account Categories</a></span></dt><dt><span class="section"><a href="security.html#partial-revokes">6.2.12 Privilege Restriction Using Partial Revokes</a></span></dt><dt><span class="section"><a href="security.html#privilege-changes">6.2.13 When Privilege Changes Take Effect</a></span></dt><dt><span class="section"><a href="security.html#assigning-passwords">6.2.14 Assigning Account Passwords</a></span></dt><dt><span class="section"><a href="security.html#password-management">6.2.15 Password Management</a></span></dt><dt><span class="section"><a href="security.html#expired-password-handling">6.2.16 Server Handling of Expired Passwords</a></span></dt><dt><span class="section"><a href="security.html#pluggable-authentication">6.2.17 Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#proxy-users">6.2.18 Proxy Users</a></span></dt><dt><span class="section"><a href="security.html#account-locking">6.2.19 Account Locking</a></span></dt><dt><span class="section"><a href="security.html#user-resources">6.2.20 Setting Account Resource Limits</a></span></dt><dt><span class="section"><a href="security.html#problems-connecting">6.2.21 Troubleshooting Problems Connecting to MySQL</a></span></dt><dt><span class="section"><a href="security.html#account-activity-auditing">6.2.22 SQL-Based Account Activity Auditing</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#encrypted-connections">6.3 Using Encrypted Connections</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#using-encrypted-connections">6.3.1 Configuring MySQL to Use Encrypted Connections</a></span></dt><dt><span class="section"><a href="security.html#encrypted-connection-options">6.3.2 Command Options for Encrypted Connections</a></span></dt><dt><span class="section"><a href="security.html#creating-ssl-rsa-files">6.3.3 Creating SSL and RSA Certificates and Keys</a></span></dt><dt><span class="section"><a href="security.html#ssl-libraries">6.3.4 SSL Library-Dependent Capabilities</a></span></dt><dt><span class="section"><a href="security.html#building-with-encrypted-connection-support">6.3.5 Building MySQL with Support for Encrypted Connections</a></span></dt><dt><span class="section"><a href="security.html#encrypted-connection-protocols-ciphers">6.3.6 Encrypted Connection Protocols and Ciphers</a></span></dt><dt><span class="section"><a href="security.html#windows-and-ssh">6.3.7 Connecting to MySQL Remotely from Windows with SSH</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#security-plugins">6.4 Security Components and Plugins</a></span></dt><dd><dl><dt><span class="section"><a href="security.html#authentication-plugins">6.4.1 Authentication Plugins</a></span></dt><dt><span class="section"><a href="security.html#connection-control">6.4.2 The Connection-Control Plugins</a></span></dt><dt><span class="section"><a href="security.html#validate-password">6.4.3 The Password Validation Component</a></span></dt><dt><span class="section"><a href="security.html#keyring">6.4.4 The MySQL Keyring</a></span></dt><dt><span class="section"><a href="security.html#audit-log">6.4.5 MySQL Enterprise Audit</a></span></dt><dt><span class="section"><a href="security.html#audit-api-message-emit">6.4.6 The Audit Message Component</a></span></dt><dt><span class="section"><a href="security.html#firewall">6.4.7 MySQL Enterprise Firewall</a></span></dt><dt><span class="section"><a href="security.html#data-masking">6.4.8 MySQL Enterprise Data Masking and De-Identification</a></span></dt></dl></dd><dt><span class="section"><a href="security.html#fips-mode">6.5 FIPS Support</a></span></dt></dl>
</div>
<p>
    When thinking about security within a MySQL installation, you should
    consider a wide range of possible topics and how they affect the
    security of your MySQL server and related applications:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        General factors that affect security. These include choosing
        good passwords, not granting unnecessary privileges to users,
        ensuring application security by preventing SQL injections and
        data corruption, and others. See
        <a class="xref" href="security.html#general-security-issues" title="6.1 General Security Issues">Section 6.1, “General Security Issues”</a>.
      </p></li><li class="listitem"><p>
        Security of the installation itself. The data files, log files,
        and the all the application files of your installation should be
        protected to ensure that they are not readable or writable by
        unauthorized parties. For more information, see
        <a class="xref" href="installing.html#postinstallation" title="2.10 Postinstallation Setup and Testing">Section 2.10, “Postinstallation Setup and Testing”</a>.
      </p></li><li class="listitem"><p>
        Access control and security within the database system itself,
        including the users and databases granted with access to the
        databases, views and stored programs in use within the database.
        For more information, see <a class="xref" href="security.html#access-control" title="6.2 Access Control and Account Management">Section 6.2, “Access Control and Account Management”</a>.
      </p></li><li class="listitem"><p>
        The features offered by security-related plugins. See
        <a class="xref" href="security.html#security-plugins" title="6.4 Security Components and Plugins">Section 6.4, “Security Components and Plugins”</a>.
      </p></li><li class="listitem"><p>
        Network security of MySQL and your system. The security is
        related to the grants for individual users, but you may also
        wish to restrict MySQL so that it is available only locally on
        the MySQL server host, or to a limited set of other hosts.
      </p></li><li class="listitem"><p>
        Ensure that you have adequate and appropriate backups of your
        database files, configuration and log files. Also be sure that
        you have a recovery solution in place and test that you are able
        to successfully recover the information from your backups. See
        <a class="xref" href="backup-and-recovery.html" title="Chapter 7 Backup and Recovery">Chapter 7, <i>Backup and Recovery</i></a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="general-security-issues"></a>6.1 General Security Issues</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#security-guidelines">6.1.1 Security Guidelines</a></span></dt><dt><span class="section"><a href="security.html#password-security">6.1.2 Keeping Passwords Secure</a></span></dt><dt><span class="section"><a href="security.html#security-against-attack">6.1.3 Making MySQL Secure Against Attackers</a></span></dt><dt><span class="section"><a href="security.html#security-options">6.1.4 Security-Related mysqld Options and Variables</a></span></dt><dt><span class="section"><a href="security.html#changing-mysql-user">6.1.5 How to Run MySQL as a Normal User</a></span></dt><dt><span class="section"><a href="security.html#load-data-local">6.1.6 Security Issues with LOAD DATA LOCAL</a></span></dt><dt><span class="section"><a href="security.html#secure-client-programming">6.1.7 Client Programming Security Guidelines</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091726087264"></a><p>
    This section describes general security issues to be aware of and
    what you can do to make your MySQL installation more secure against
    attack or misuse. For information specifically about the access
    control system that MySQL uses for setting up user accounts and
    checking database access, see <a class="xref" href="installing.html#postinstallation" title="2.10 Postinstallation Setup and Testing">Section 2.10, “Postinstallation Setup and Testing”</a>.
  </p><p>
    For answers to some questions that are often asked about MySQL
    Server security issues, see <a class="xref" href="faqs.html#faqs-security" title="A.9 MySQL 8.0 FAQ: Security">Section A.9, “MySQL 8.0 FAQ: Security”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="security-guidelines"></a>6.1.1 Security Guidelines</h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140091726081936"></a><a class="indexterm" name="idm140091726080864"></a><p>
      Anyone using MySQL on a computer connected to the Internet should
      read this section to avoid the most common security mistakes.
    </p><p>
      In discussing security, it is necessary to consider fully
      protecting the entire server host (not just the MySQL server)
      against all types of applicable attacks: eavesdropping, altering,
      playback, and denial of service. We do not cover all aspects of
      availability and fault tolerance here.
    </p><p>
      MySQL uses security based on Access Control Lists (ACLs) for all
      connections, queries, and other operations that users can attempt
      to perform. There is also support for SSL-encrypted connections
      between MySQL clients and servers. Many of the concepts discussed
      here are not specific to MySQL at all; the same general ideas
      apply to almost all applications.
    </p><p>
      When running MySQL, follow these guidelines:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong>Do not ever give anyone (except MySQL
          <code class="literal">root</code> accounts) access to the
          <code class="literal">user</code> table in the <code class="literal">mysql</code>
          system database!</strong></span> This is critical.
        </p></li><li class="listitem"><p>
          Learn how the MySQL access privilege system works (see
          <a class="xref" href="security.html#access-control" title="6.2 Access Control and Account Management">Section 6.2, “Access Control and Account Management”</a>). Use the
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
          <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> statements to control
          access to MySQL. Do not grant more privileges than necessary.
          Never grant privileges to all hosts.
        </p><p>
          Checklist:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Try <code class="literal">mysql -u root</code>. If you are able to
              connect successfully to the server without being asked for
              a password, anyone can connect to your MySQL server as the
              MySQL <code class="literal">root</code> user with full privileges!
              Review the MySQL installation instructions, paying
              particular attention to the information about setting a
              <code class="literal">root</code> password. See
              <a class="xref" href="installing.html#default-privileges" title="2.10.4 Securing the Initial MySQL Account">Section 2.10.4, “Securing the Initial MySQL Account”</a>.
            </p></li><li class="listitem"><p>
              Use the <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a>
              statement to check which accounts have access to what.
              Then use the <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a>
              statement to remove those privileges that are not
              necessary.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          Do not store cleartext passwords in your database. If your
          computer becomes compromised, the intruder can take the full
          list of passwords and use them. Instead, use
          <a class="link" href="functions.html#function_sha2"><code class="literal">SHA2()</code></a> or some other one-way
          hashing function and store the hash value.
        </p><p>
          To prevent password recovery using rainbow tables, do not use
          these functions on a plain password; instead, choose some
          string to be used as a salt, and use hash(hash(password)+salt)
          values.
        </p></li><li class="listitem"><p>
          Do not choose passwords from dictionaries. Special programs
          exist to break passwords. Even passwords like
          <span class="quote">“<span class="quote">xfish98</span>”</span> are very bad. Much better is
          <span class="quote">“<span class="quote">duag98</span>”</span> which contains the same word
          <span class="quote">“<span class="quote">fish</span>”</span> but typed one key to the left on a
          standard QWERTY keyboard. Another method is to use a password
          that is taken from the first characters of each word in a
          sentence (for example, <span class="quote">“<span class="quote">Four score and seven years
          ago</span>”</span> results in a password of <span class="quote">“<span class="quote">Fsasya</span>”</span>).
          The password is easy to remember and type, but difficult to
          guess for someone who does not know the sentence. In this
          case, you can additionally substitute digits for the number
          words to obtain the phrase <span class="quote">“<span class="quote">4 score and 7 years
          ago</span>”</span>, yielding the password <span class="quote">“<span class="quote">4sa7ya</span>”</span> which
          is even more difficult to guess.
        </p></li><li class="listitem"><p>
          Invest in a firewall. This protects you from at least 50% of
          all types of exploits in any software. Put MySQL behind the
          firewall or in a demilitarized zone (DMZ).
        </p><p>
          Checklist:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Try to scan your ports from the Internet using a tool such
              as <code class="literal">nmap</code>. MySQL uses port 3306 by
              default. This port should not be accessible from untrusted
              hosts. As a simple way to check whether your MySQL port is
              open, try the following command from some remote machine,
              where <em class="replaceable"><code>server_host</code></em> is the host
              name or IP address of the host on which your MySQL server
              runs:
            </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>telnet <em class="replaceable"><code>server_host</code></em> 3306</code></strong>
</pre><p>
              If <span class="command"><strong>telnet</strong></span> hangs or the connection is
              refused, the port is blocked, which is how you want it to
              be. If you get a connection and some garbage characters,
              the port is open, and should be closed on your firewall or
              router, unless you really have a good reason to keep it
              open.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          Applications that access MySQL should not trust any data
          entered by users, and should be written using proper defensive
          programming techniques. See
          <a class="xref" href="security.html#secure-client-programming" title="6.1.7 Client Programming Security Guidelines">Section 6.1.7, “Client Programming Security Guidelines”</a>.
        </p></li><li class="listitem"><p>
          Do not transmit plain (unencrypted) data over the Internet.
          This information is accessible to everyone who has the time
          and ability to intercept it and use it for their own purposes.
          Instead, use an encrypted protocol such as SSL or SSH. MySQL
          supports internal SSL connections. Another technique is to use
          SSH port-forwarding to create an encrypted (and compressed)
          tunnel for the communication.
        </p></li><li class="listitem"><p>
          Learn to use the <span class="command"><strong>tcpdump</strong></span> and
          <span class="command"><strong>strings</strong></span> utilities. In most cases, you can
          check whether MySQL data streams are unencrypted by issuing a
          command like the following:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>tcpdump -l -i eth0 -w - src or dst port 3306 | strings</code></strong>
</pre><p>
          This works under Linux and should work with small
          modifications under other systems.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
            If you do not see cleartext data, this does not always mean
            that the information actually is encrypted. If you need high
            security, consult with a security expert.
</p>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="password-security"></a>6.1.2 Keeping Passwords Secure</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#password-security-user">6.1.2.1 End-User Guidelines for Password Security</a></span></dt><dt><span class="section"><a href="security.html#password-security-admin">6.1.2.2 Administrator Guidelines for Password Security</a></span></dt><dt><span class="section"><a href="security.html#password-logging">6.1.2.3 Passwords and Logging</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091726035376"></a><p>
      Passwords occur in several contexts within MySQL. The following
      sections provide guidelines that enable end users and
      administrators to keep these passwords secure and avoid exposing
      them. In addition, the <code class="literal">validate_password</code> plugin
      can be used to enforce a policy on acceptable password. See
      <a class="xref" href="security.html#validate-password" title="6.4.3 The Password Validation Component">Section 6.4.3, “The Password Validation Component”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="password-security-user"></a>6.1.2.1 End-User Guidelines for Password Security</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091726030672"></a><p>
        MySQL users should use the following guidelines to keep
        passwords secure.
      </p><p>
        When you run a client program to connect to the MySQL server, it
        is inadvisable to specify your password in a way that exposes it
        to discovery by other users. The methods you can use to specify
        your password when you run client programs are listed here,
        along with an assessment of the risks of each method. In short,
        the safest methods are to have the client program prompt for the
        password or to specify the password in a properly protected
        option file.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Use the <a class="link" href="programs.html#mysql-config-editor" title="4.6.7 mysql_config_editor — MySQL Configuration Utility"><span class="command"><strong>mysql_config_editor</strong></span></a> utility,
            which enables you to store authentication credentials in an
            encrypted login path file named
            <code class="filename">.mylogin.cnf</code>. The file can be read
            later by MySQL client programs to obtain authentication
            credentials for connecting to MySQL Server. See
            <a class="xref" href="programs.html#mysql-config-editor" title="4.6.7 mysql_config_editor — MySQL Configuration Utility">Section 4.6.7, “<span class="command"><strong>mysql_config_editor</strong></span> — MySQL Configuration Utility”</a>.
          </p></li><li class="listitem"><p>
            <a class="indexterm" name="idm140091726023328"></a>

            <a class="indexterm" name="idm140091726022256"></a>

            Use a
            <code class="option">-p<em class="replaceable"><code>your_pass</code></em></code> or
            <code class="option">--password=<em class="replaceable"><code>your_pass</code></em></code>
            option on the command line. For example:
          </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u francis -pfrank <em class="replaceable"><code>db_name</code></em></code></strong>
</pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
              This is convenient <span class="emphasis"><em>but insecure</em></span>. On
              some systems, your password becomes visible to system
              status programs such as <span class="command"><strong>ps</strong></span> that may be
              invoked by other users to display command lines. MySQL
              clients typically overwrite the command-line password
              argument with zeros during their initialization sequence.
              However, there is still a brief interval during which the
              value is visible. Also, on some systems this overwriting
              strategy is ineffective and the password remains visible
              to <span class="command"><strong>ps</strong></span>. (SystemV Unix systems and
              perhaps others are subject to this problem.)
</p>
</div>
<p>
            If your operating environment is set up to display your
            current command in the title bar of your terminal window,
            the password remains visible as long as the command is
            running, even if the command has scrolled out of view in the
            window content area.
          </p></li><li class="listitem"><p>
            Use the <code class="option">-p</code> or <code class="option">--password</code>
            option on the command line with no password value specified.
            In this case, the client program solicits the password
            interactively:
          </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u francis -p <em class="replaceable"><code>db_name</code></em></code></strong>
Enter password: ********
</pre><p>
            The <code class="literal">*</code> characters indicate where you enter
            your password. The password is not displayed as you enter
            it.
          </p><p>
            It is more secure to enter your password this way than to
            specify it on the command line because it is not visible to
            other users. However, this method of entering a password is
            suitable only for programs that you run interactively. If
            you want to invoke a client from a script that runs
            noninteractively, there is no opportunity to enter the
            password from the keyboard. On some systems, you may even
            find that the first line of your script is read and
            interpreted (incorrectly) as your password.
          </p></li><li class="listitem"><p>
            Store your password in an option file. For example, on Unix,
            you can list your password in the
            <code class="literal">[client]</code> section of the
            <code class="filename">.my.cnf</code> file in your home directory:
          </p><a class="indexterm" name="idm140091726005152"></a><a class="indexterm" name="idm140091726004080"></a><pre data-lang="ini" class="programlisting">
[client]
password=your_pass
</pre><p>
            To keep the password safe, the file should not be accessible
            to anyone but yourself. To ensure this, set the file access
            mode to <code class="literal">400</code> or <code class="literal">600</code>.
            For example:
          </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>chmod 600 .my.cnf</code></strong>
</pre><p>
            To name from the command line a specific option file
            containing the password, use the
            <a class="link" href="programs.html#option_general_defaults-file"><code class="option">--defaults-file=<em class="replaceable"><code>file_name</code></em></code></a>
            option, where <code class="filename">file_name</code> is the full
            path name to the file. For example:
          </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --defaults-file=/home/francis/mysql-opts</code></strong>
</pre><p>
            <a class="xref" href="programs.html#option-files" title="4.2.2.2 Using Option Files">Section 4.2.2.2, “Using Option Files”</a>, discusses option files in
            more detail.
          </p></li><li class="listitem"><p>
            Store your password in the <code class="literal">MYSQL_PWD</code>
            environment variable. See
            <a class="xref" href="programs.html#environment-variables" title="4.9 MySQL Program Environment Variables">Section 4.9, “MySQL Program Environment Variables”</a>.
          </p><p>
            This method of specifying your MySQL password must be
            considered <span class="emphasis"><em>extremely insecure</em></span> and
            should not be used. Some versions of <span class="command"><strong>ps</strong></span>
            include an option to display the environment of running
            processes. On some systems, if you set
            <code class="literal">MYSQL_PWD</code>, your password is exposed to
            any other user who runs <span class="command"><strong>ps</strong></span>. Even on
            systems without such a version of <span class="command"><strong>ps</strong></span>, it
            is unwise to assume that there are no other methods by which
            users can examine process environments.
</p></li></ul>
</div>
<a class="indexterm" name="idm140091725986064"></a><p>
        On Unix, the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client writes a record of
        executed statements to a history file (see
        <a class="xref" href="programs.html#mysql-logging" title="4.5.1.3 mysql Client Logging">Section 4.5.1.3, “mysql Client Logging”</a>). By default, this file is named
        <code class="filename">.mysql_history</code> and is created in your home
        directory. Passwords can be written as plain text in SQL
        statements such as <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>
        and <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>, so if you use
        these statements, they are logged in the history file. To keep
        this file safe, use a restrictive access mode, the same way as
        described earlier for the <code class="filename">.my.cnf</code> file.
      </p><p>
        If your command interpreter is configured to maintain a history,
        any file in which the commands are saved will contain MySQL
        passwords entered on the command line. For example,
        <span class="command"><strong>bash</strong></span> uses
        <code class="filename">~/.bash_history</code>. Any such file should have
        a restrictive access mode.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="password-security-admin"></a>6.1.2.2 Administrator Guidelines for Password Security</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091725974944"></a><p>
        Database administrators should use the following guidelines to
        keep passwords secure.
      </p><p>
        MySQL stores passwords for user accounts in the
        <code class="literal">mysql.user</code> system table. Access to this table
        should never be granted to any nonadministrative accounts.
      </p><p>
        Account passwords can be expired so that users must reset them.
        See <a class="xref" href="security.html#password-management" title="6.2.15 Password Management">Section 6.2.15, “Password Management”</a>, and
        <a class="xref" href="security.html#expired-password-handling" title="6.2.16 Server Handling of Expired Passwords">Section 6.2.16, “Server Handling of Expired Passwords”</a>.
      </p><p>
        The <code class="literal">validate_password</code> plugin can be used to
        enforce a policy on acceptable password. See
        <a class="xref" href="security.html#validate-password" title="6.4.3 The Password Validation Component">Section 6.4.3, “The Password Validation Component”</a>.
      </p><p>
        A user who has access to modify the plugin directory (the value
        of the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
        variable) or the <code class="filename">my.cnf</code> file that specifies
        the plugin directory location can replace plugins and modify the
        capabilities provided by plugins, including authentication
        plugins.
      </p><p>
        Files such as log files to which passwords might be written
        should be protected. See <a class="xref" href="security.html#password-logging" title="6.1.2.3 Passwords and Logging">Section 6.1.2.3, “Passwords and Logging”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="password-logging"></a>6.1.2.3 Passwords and Logging</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091725962912"></a><a class="indexterm" name="idm140091725961424"></a><p>
        Passwords can be written as plain text in SQL statements such as
        <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
        <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a>. If such statements
        are logged by the MySQL server as written, passwords in them
        become visible to anyone with access to the logs.
      </p><p>
        Statement logging avoids writing passwords as cleartext for the
        following statements:
      </p><pre data-lang="sql" class="programlisting">
CREATE USER ... IDENTIFIED BY ...
ALTER USER ... IDENTIFIED BY ...
SET PASSWORD ...
SLAVE START ... PASSWORD = ...
CREATE SERVER ... OPTIONS(... PASSWORD ...)
ALTER SERVER ... OPTIONS(... PASSWORD ...)
</pre><p>
        Passwords in those statements are rewritten to not appear
        literally in statement text written to the general query log,
        slow query log, and binary log. Rewriting does not apply to
        other statements. In particular,
        <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> or
        <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> statements for the
        <code class="literal">mysql.user</code> system table that refer to literal
        passwords are logged as is, so you should avoid such statements.
        (Direct modification of grant tables is discouraged, anyway.)
      </p><p>
        For the general query log, password rewriting can be suppressed
        by starting the server with the
        <a class="link" href="server-administration.html#option_mysqld_log-raw"><code class="option">--log-raw</code></a> option. For security
        reasons, this option is not recommended for production use. For
        diagnostic purposes, it may be useful to see the exact text of
        statements as received by the server.
      </p><p>
        By default, contents of audit log files produced by the audit
        log plugin are not encrypted and may contain sensitive
        information, such as the text of SQL statements. For security
        reasons, audit log files should be written to a directory
        accessible only to the MySQL server and to users with a
        legitimate reason to view the log. See
        <a class="xref" href="security.html#audit-log-security" title="6.4.5.3 MySQL Enterprise Audit Security Considerations">Section 6.4.5.3, “MySQL Enterprise Audit Security Considerations”</a>.
      </p><p>
        Statements received by the server may be rewritten if a query
        rewrite plugin is installed (see
        <a class="xref" href="extending-mysql.html#query-rewrite-plugin-type" title="Query Rewrite Plugins">Query Rewrite Plugins</a>). In this case, the
        <a class="link" href="server-administration.html#option_mysqld_log-raw"><code class="option">--log-raw</code></a> option affects
        statement logging as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Without <a class="link" href="server-administration.html#option_mysqld_log-raw"><code class="option">--log-raw</code></a>, the server
            logs the statement returned by the query rewrite plugin.
            This may differ from the statement as received.
          </p></li><li class="listitem"><p>
            With <a class="link" href="server-administration.html#option_mysqld_log-raw"><code class="option">--log-raw</code></a>, the server
            logs the original statement as received.
</p></li></ul>
</div>
<p>
        An implication of password rewriting is that statements that
        cannot be parsed (due, for example, to syntax errors) are not
        written to the general query log because they cannot be known to
        be password free. Use cases that require logging of all
        statements including those with errors should use the
        <a class="link" href="server-administration.html#option_mysqld_log-raw"><code class="option">--log-raw</code></a> option, bearing in mind
        that this also bypasses password rewriting.
      </p><p>
        Password rewriting occurs only when plain text passwords are
        expected. For statements with syntax that expect a password hash
        value, no rewriting occurs. If a plain text password is supplied
        erroneously for such syntax, the password is logged as given,
        without rewriting.
      </p><p>
        To guard log files against unwarranted exposure, locate them in
        a directory that restricts access to the server and the database
        administrator. If the server logs to tables in the
        <code class="literal">mysql</code> database, grant access to those tables
        only to the database administrator.
      </p><p>
        Replication slaves store the password for the replication master
        in the master info repository, which by default is a table in
        the <code class="literal">mysql</code> database named
        <code class="literal">slave_master_info</code>. The use of a file in the
        data directory for the master info repository is now deprecated,
        but still possible (see
        <a class="xref" href="replication.html#slave-logs" title="17.2.4 Replication Relay and Status Logs">Section 17.2.4, “Replication Relay and Status Logs”</a>). Ensure that the master
        info repository can be accessed only by the database
        administrator. An alternative to storing the password in the
        master info repository is to use the <a class="link" href="sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE Syntax"><code class="literal">START
        SLAVE</code></a> statement to specify credentials for connecting
        to the master.
      </p><p>
        Use a restricted access mode to protect database backups that
        include log tables or log files containing passwords.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="security-against-attack"></a>6.1.3 Making MySQL Secure Against Attackers</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091725930048"></a><a class="indexterm" name="idm140091725928592"></a><a class="indexterm" name="idm140091725927104"></a><a class="indexterm" name="idm140091725926032"></a><a class="indexterm" name="idm140091725924992"></a><p>
      When you connect to a MySQL server, you should use a password. The
      password is not transmitted as cleartext over the connection.
    </p><p>
      All other information is transferred as text, and can be read by
      anyone who is able to watch the connection. If the connection
      between the client and the server goes through an untrusted
      network, and you are concerned about this, you can use the
      compressed protocol to make traffic much more difficult to
      decipher. You can also use MySQL's internal SSL support to make
      the connection even more secure. See
      <a class="xref" href="security.html#encrypted-connections" title="6.3 Using Encrypted Connections">Section 6.3, “Using Encrypted Connections”</a>. Alternatively, use SSH to
      get an encrypted TCP/IP connection between a MySQL server and a
      MySQL client. You can find an Open Source SSH client at
      <a class="ulink" href="http://www.openssh.org/" target="_top">http://www.openssh.org/</a>, and a comparison of both
      Open Source and Commercial SSH clients at
      <a class="ulink" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients" target="_top">http://en.wikipedia.org/wiki/Comparison_of_SSH_clients</a>.
    </p><p>
      To make a MySQL system secure, you should strongly consider the
      following suggestions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Require all MySQL accounts to have a password. A client
          program does not necessarily know the identity of the person
          running it. It is common for client/server applications that
          the user can specify any user name to the client program. For
          example, anyone can use the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> program
          to connect as any other person simply by invoking it as
          <code class="literal">mysql -u <em class="replaceable"><code>other_user</code></em>
          <em class="replaceable"><code>db_name</code></em></code> if
          <em class="replaceable"><code>other_user</code></em> has no password. If all
          accounts have a password, connecting using another user's
          account becomes much more difficult.
        </p><p>
          For a discussion of methods for setting passwords, see
          <a class="xref" href="security.html#assigning-passwords" title="6.2.14 Assigning Account Passwords">Section 6.2.14, “Assigning Account Passwords”</a>.
        </p></li><li class="listitem"><p>
          Make sure that the only Unix user account with read or write
          privileges in the database directories is the account that is
          used for running <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>.
        </p></li><li class="listitem"><p>
          Never run the MySQL server as the Unix <code class="literal">root</code>
          user. This is extremely dangerous, because any user with the
          <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege is able to cause
          the server to create files as <code class="literal">root</code> (for
          example, <code class="literal">~root/.bashrc</code>). To prevent this,
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> refuses to run as
          <code class="literal">root</code> unless that is specified explicitly
          using the <a class="link" href="server-administration.html#option_mysqld_user"><code class="option">--user=root</code></a> option.
        </p><p>
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> can (and should) be run as an
          ordinary, unprivileged user instead. You can create a separate
          Unix account named <code class="literal">mysql</code> to make everything
          even more secure. Use this account only for administering
          MySQL. To start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> as a different Unix
          user, add a <code class="literal">user</code> option that specifies the
          user name in the <code class="literal">[mysqld]</code> group of the
          <code class="filename">my.cnf</code> option file where you specify
          server options. For example:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
user=mysql
</pre><p>
          This causes the server to start as the designated user whether
          you start it manually or by using
          <a class="link" href="programs.html#mysqld-safe" title="4.3.2 mysqld_safe — MySQL Server Startup Script"><span class="command"><strong>mysqld_safe</strong></span></a> or
          <a class="link" href="programs.html#mysql-server" title="4.3.3 mysql.server — MySQL Server Startup Script"><span class="command"><strong>mysql.server</strong></span></a>. For more details, see
          <a class="xref" href="security.html#changing-mysql-user" title="6.1.5 How to Run MySQL as a Normal User">Section 6.1.5, “How to Run MySQL as a Normal User”</a>.
        </p><p>
          Running <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> as a Unix user other than
          <code class="literal">root</code> does not mean that you need to change
          the <code class="literal">root</code> user name in the
          <code class="literal">user</code> table. <span class="emphasis"><em>User names for MySQL
          accounts have nothing to do with user names for Unix
          accounts</em></span>.
        </p></li><li class="listitem"><p>
          Do not grant the <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege
          to nonadministrative users. Any user that has this privilege
          can write a file anywhere in the file system with the
          privileges of the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> daemon. This
          includes the server's data directory containing the files that
          implement the privilege tables. To make
          <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a>-privilege operations a bit
          safer, files generated with
          <a class="link" href="sql-syntax.html#select-into" title="13.2.10.1 SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
          OUTFILE</code></a> do not overwrite existing files and are
          writable by everyone.
        </p><a class="indexterm" name="idm140091725883504"></a><p>
          The <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege may also be
          used to read any file that is world-readable or accessible to
          the Unix user that the server runs as. With this privilege,
          you can read any file into a database table. This could be
          abused, for example, by using <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD
          DATA</code></a> to load <code class="filename">/etc/passwd</code> into a
          table, which then can be displayed with
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a>.
        </p><p>
          To limit the location in which files can be read and written,
          set the <a class="link" href="server-administration.html#sysvar_secure_file_priv"><code class="literal">secure_file_priv</code></a>
          system to a specific directory. See
          <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 Server System Variables">Section 5.1.8, “Server System Variables”</a>.
        </p></li><li class="listitem"><p>
          Encrypt binary log files and relay log files. Encryption helps
          to protect these files and the potentially sensitive data
          contained in them from being misused by outside attackers, and
          also from unauthorized viewing by users of the operating
          system where they are stored. You enable encryption on a MySQL
          server by setting the
          <a class="link" href="replication.html#sysvar_binlog_encryption"><code class="literal">binlog_encryption</code></a> system
          variable to <code class="literal">ON</code>. For more information, see
          <a class="xref" href="replication.html#replication-binlog-encryption" title="17.3.10 Encrypting Binary Log Files and Relay Log Files">Section 17.3.10, “Encrypting Binary Log Files and Relay Log Files”</a>.
        </p></li><li class="listitem"><p>
          Do not grant the <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> or
          <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege to
          nonadministrative users. The output of <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          processlist</strong></span></a> and <a class="link" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST Syntax"><code class="literal">SHOW
          PROCESSLIST</code></a> shows the text of any statements
          currently being executed, so any user who is permitted to see
          the server process list might be able to see statements issued
          by other users.
        </p><p>
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> reserves an extra connection for
          users who have the
          <a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a> or
          <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege, so that a
          MySQL <code class="literal">root</code> user can log in and check server
          activity even if all normal connections are in use.
        </p><p>
          The <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege can be used
          to terminate client connections, change server operation by
          changing the value of system variables, and control
          replication servers.
        </p></li><li class="listitem"><p>
          Do not permit the use of symlinks to tables. (This capability
          can be disabled with the
          <a class="link" href="server-administration.html#option_mysqld_symbolic-links"><code class="option">--skip-symbolic-links</code></a>
          option.) This is especially important if you run
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> as <code class="literal">root</code>, because
          anyone that has write access to the server's data directory
          then could delete any file in the system! See
          <a class="xref" href="optimization.html#symbolic-links-to-tables" title="8.12.2.2 Using Symbolic Links for MyISAM Tables on Unix">Section 8.12.2.2, “Using Symbolic Links for MyISAM Tables on Unix”</a>.
        </p></li><li class="listitem"><p>
          Stored programs and views should be written using the security
          guidelines discussed in
          <a class="xref" href="stored-objects.html#stored-objects-security" title="24.6 Stored Object Access Control">Section 24.6, “Stored Object Access Control”</a>.
        </p></li><li class="listitem"><p>
          If you do not trust your DNS, you should use IP addresses
          rather than host names in the grant tables. In any case, you
          should be very careful about creating grant table entries
          using host name values that contain wildcards.
        </p></li><li class="listitem"><p>
          If you want to restrict the number of connections permitted to
          a single account, you can do so by setting the
          <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> variable
          in <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>. The <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE
          USER</code></a> and <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>
          statements also support resource control options for limiting
          the extent of server use permitted to an account. See
          <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>, and
          <a class="xref" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax">Section 13.7.1.1, “ALTER USER Syntax”</a>.
        </p></li><li class="listitem"><p>
          If the plugin directory is writable by the server, it may be
          possible for a user to write executable code to a file in the
          directory using <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT
          ... INTO DUMPFILE</code></a>. This can be prevented by making
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> read only to the
          server or by setting
          <a class="link" href="server-administration.html#option_mysqld_secure-file-priv"><code class="option">--secure-file-priv</code></a> to a
          directory where <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> writes
          can be made safely.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="security-options"></a>6.1.4 Security-Related mysqld Options and Variables</h3>

</div>

</div>

</div>
<p>
      The following table shows <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> options and
      system variables that affect security. For descriptions of each of
      these, see <a class="xref" href="server-administration.html#server-options" title="5.1.7 Server Command Options">Section 5.1.7, “Server Command Options”</a>, and
      <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 Server System Variables">Section 5.1.8, “Server System Variables”</a>.
</p>
<div class="table">
<a name="idm140091725831968"></a><p class="title"><b>Table 6.1 Security Option and Variable Summary</b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Security-related command-line options and system variables."><col width="20%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><thead><tr><th scope="col">Name</th>
<th scope="col">Cmd-Line</th>
<th scope="col">Option File</th>
<th scope="col">System Var</th>
<th scope="col">Status Var</th>
<th scope="col">Var Scope</th>
<th scope="col">Dynamic</th>
</tr></thead><tbody><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_allow-suspicious-udfs">allow-suspicious-udfs</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_automatic_sp_privileges">automatic_sp_privileges</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_chroot">chroot</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_des-key-file">des-key-file</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_local_infile">local_infile</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_old_passwords">old_passwords</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Both</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_safe-user-create">safe-user-create</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_secure-auth">secure-auth</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_secure_auth">secure_auth</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_secure-file-priv">secure-file-priv</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_secure_file_priv">secure_file_priv</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-grant-tables">skip-grant-tables</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-name-resolve">skip-name-resolve</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_skip_name_resolve">skip_name_resolve</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-networking">skip-networking</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_skip_networking">skip_networking</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#option_mysqld_skip-show-database">skip-show-database</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="server-administration.html#sysvar_skip_show_database">skip_show_database</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="changing-mysql-user"></a>6.1.5 How to Run MySQL as a Normal User</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091725689984"></a><a class="indexterm" name="idm140091725688528"></a><p>
      On Windows, you can run the server as a Windows service using a
      normal user account.
    </p><p>
      On Linux, for installations performed using a MySQL repository or
      RPM packages, the MySQL server <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> should be
      started by the local <code class="literal">mysql</code> operating system
      user. Starting by another operating system user is not supported
      by the init scripts that are included as part of the MySQL
      repositories.
    </p><p>
      On Unix (or Linux for installations performed using
      <code class="filename">tar.gz</code> packages) , the MySQL server
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> can be started and run by any user.
      However, you should avoid running the server as the Unix
      <code class="literal">root</code> user for security reasons. To change
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> to run as a normal unprivileged Unix
      user <em class="replaceable"><code>user_name</code></em>, you must do the
      following:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Stop the server if it is running (use <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          shutdown</strong></span></a>).
        </p></li><li class="listitem"><p>
          Change the database directories and files so that
          <em class="replaceable"><code>user_name</code></em> has privileges to read
          and write files in them (you might need to do this as the Unix
          <code class="literal">root</code> user):
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>chown -R <em class="replaceable"><code>user_name</code></em> <em class="replaceable"><code>/path/to/mysql/datadir</code></em></code></strong>
</pre><p>
          If you do not do this, the server will not be able to access
          databases or tables when it runs as
          <em class="replaceable"><code>user_name</code></em>.
        </p><p>
          If directories or files within the MySQL data directory are
          symbolic links, <code class="literal">chown -R</code> might not follow
          symbolic links for you. If it does not, you will also need to
          follow those links and change the directories and files they
          point to.
        </p></li><li class="listitem"><p>
          Start the server as user <em class="replaceable"><code>user_name</code></em>.
          Another alternative is to start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> as
          the Unix <code class="literal">root</code> user and use the
          <a class="link" href="server-administration.html#option_mysqld_user"><code class="option">--user=<em class="replaceable"><code>user_name</code></em></code></a>
          option. <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> starts, then switches to run
          as the Unix user <em class="replaceable"><code>user_name</code></em> before
          accepting any connections.
        </p></li><li class="listitem"><p>
          To start the server as the given user automatically at system
          startup time, specify the user name by adding a
          <code class="literal">user</code> option to the
          <code class="literal">[mysqld]</code> group of the
          <code class="filename">/etc/my.cnf</code> option file or the
          <code class="filename">my.cnf</code> option file in the server's data
          directory. For example:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
user=<em class="replaceable"><code>user_name</code></em>
</pre></li></ol>
</div>
<p>
      If your Unix machine itself is not secured, you should assign
      passwords to the MySQL <code class="literal">root</code> account in the
      grant tables. Otherwise, any user with a login account on that
      machine can run the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client with a
      <a class="link" href="programs.html#option_mysql_user"><code class="option">--user=root</code></a> option and perform any
      operation. (It is a good idea to assign passwords to MySQL
      accounts in any case, but especially so when other login accounts
      exist on the server host.) See
      <a class="xref" href="installing.html#default-privileges" title="2.10.4 Securing the Initial MySQL Account">Section 2.10.4, “Securing the Initial MySQL Account”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="load-data-local"></a>6.1.6 Security Issues with LOAD DATA LOCAL</h3>

</div>

</div>

</div>
<p>
      The <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD DATA</code></a> statement can load a
      file located on the server host, or, if the
      <code class="literal">LOCAL</code> keyword is specified, on the client host.
    </p><p>
      There are two potential security issues with the
      <code class="literal">LOCAL</code> version of <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD
      DATA</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The transfer of the file from the client host to the server
          host is initiated by the MySQL server. In theory, a patched
          server could be built that would tell the client program to
          transfer a file of the server's choosing rather than the file
          named by the client in the <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD
          DATA</code></a> statement. Such a server could access any file
          on the client host to which the client user has read access.
          (A patched server could in fact reply with a file-transfer
          request to any statement, not just
          <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD DATA
          LOCAL</code></a>, so a more fundamental issue is that clients
          should not connect to untrusted servers.)
        </p></li><li class="listitem"><p>
          In a Web environment where the clients are connecting from a
          Web server, a user could use
          <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD DATA
          LOCAL</code></a> to read any files that the Web server process
          has read access to (assuming that a user could run any
          statement against the SQL server). In this environment, the
          client with respect to the MySQL server actually is the Web
          server, not a remote program being run by users who connect to
          the Web server.
</p></li></ul>
</div>
<p>
      To avoid <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD DATA</code></a> issues, clients
      should avoid using <code class="literal">LOCAL</code>. To avoid connecting
      to untrusted servers, clients can establish a secure connection
      and verify the server identity by connecting using the
      <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_IDENTITY</code></a> option
      and the appropriate CA certificate.
    </p><p>
      To enable adminstrators and applications to manage the local data
      loading capability, <code class="literal">LOCAL</code> configuration works
      like this:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          On the server side:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The <a class="link" href="server-administration.html#sysvar_local_infile"><code class="literal">local_infile</code></a> system
              variable controls server-side <code class="literal">LOCAL</code>
              capability. Depending on the
              <a class="link" href="server-administration.html#sysvar_local_infile"><code class="literal">local_infile</code></a> setting, the
              server refuses or permits local data loading by clients
              that have <code class="literal">LOCAL</code> enabled on the client
              side. By default,
              <a class="link" href="server-administration.html#sysvar_local_infile"><code class="literal">local_infile</code></a> is disabled.
            </p></li><li class="listitem"><p>
              To explicitly cause the server to refuse or permit
              <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD DATA
              LOCAL</code></a> statements (regardless of how client
              programs and libraries are configured at build time or
              runtime), start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with
              <a class="link" href="server-administration.html#sysvar_local_infile"><code class="literal">local_infile</code></a> disabled or
              enabled, respectively.
              <a class="link" href="server-administration.html#sysvar_local_infile"><code class="literal">local_infile</code></a> can also be
              set at runtime.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          On the client side:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The <a class="link" href="installing.html#option_cmake_enabled_local_infile"><code class="option">ENABLED_LOCAL_INFILE</code></a>
              <span class="command"><strong>CMake</strong></span> option controls the compiled-in
              default <code class="literal">LOCAL</code> capability for the MySQL
              client library. Clients that make no explicit arrangements
              therefore have <code class="literal">LOCAL</code> capability
              disabled or enabled according to the
              <a class="link" href="installing.html#option_cmake_enabled_local_infile"><code class="option">ENABLED_LOCAL_INFILE</code></a> setting
              specified at MySQL build time.
            </p><p>
              By default, the client library in MySQL binary
              distributions is compiled with
              <a class="link" href="installing.html#option_cmake_enabled_local_infile"><code class="option">ENABLED_LOCAL_INFILE</code></a>
              disabled. If you compile MySQL from source, configure it
              with <a class="link" href="installing.html#option_cmake_enabled_local_infile"><code class="option">ENABLED_LOCAL_INFILE</code></a>
              disabled or enabled based on whether clients that make no
              explicit arrangements should have <code class="literal">LOCAL</code>
              capability disabled or enabled, respectively.
            </p></li><li class="listitem"><p>
              Client programs that use the C API can control load data
              loading explicitly by invoking
              <a class="link" href="connectors-apis.html#mysql-options" title="28.7.7.50 mysql_options()"><code class="literal">mysql_options()</code></a> to disable
              or enable the <code class="literal">MYSQL_OPT_LOCAL_INFILE</code>
              option. See <a class="xref" href="connectors-apis.html#mysql-options" title="28.7.7.50 mysql_options()">Section 28.7.7.50, “mysql_options()”</a>.
            </p></li><li class="listitem"><p>
              For the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client, local data
              loading is disabled by default. To disable or enable it
              explicitly, use the
              <a class="link" href="programs.html#option_mysql_local-infile"><code class="option">--local-infile=0</code></a> or
              <a class="link" href="programs.html#option_mysql_local-infile"><code class="option">--local-infile[=1]</code></a> option.
            </p></li><li class="listitem"><p>
              For the <a class="link" href="programs.html#mysqlimport" title="4.5.5 mysqlimport — A Data Import Program"><span class="command"><strong>mysqlimport</strong></span></a> client, local data
              loading is disabled by default. To disable or enable it
              explicitly, use the
              <a class="link" href="programs.html#option_mysqlimport_local"><code class="option">--local=0</code></a> or
              <a class="link" href="programs.html#option_mysqlimport_local"><code class="option">--local[=1]</code></a> option.
            </p></li><li class="listitem"><p>
              If you use <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD
              DATA LOCAL</code></a> in Perl scripts or other programs
              that read the <code class="literal">[client]</code> group from
              option files, you can add an
              <code class="literal">local-infile</code> option setting to that
              group. To prevent problems for programs that do not
              understand this option, specify it using the
              <a class="link" href="programs.html#option-modifiers" title="4.2.2.4 Program Option Modifiers"><code class="literal">loose-</code></a>
              prefix:
            </p><pre data-lang="ini" class="programlisting">
[client]
loose-local-infile=0
</pre><p>
              or:
            </p><pre data-lang="ini" class="programlisting">
[client]
loose-local-infile=1
</pre></li><li class="listitem"><p>
              In all cases, successful use of a <code class="literal">LOCAL</code>
              load operation by a client also requires that the server
              permits it.
</p></li></ul>
</div>
</li></ul>
</div>
<p>
      If <code class="literal">LOCAL</code> capability is disabled, on either the
      server or client side, a client that attempts to issue a
      <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD DATA
      LOCAL</code></a> statement receives the following error message:
    </p><pre data-lang="none" class="programlisting">
ERROR 1148: The used command is not allowed with this MySQL version
</pre><a class="indexterm" name="idm140091725587472"></a><a class="indexterm" name="idm140091725585952"></a>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="secure-client-programming"></a>6.1.7 Client Programming Security Guidelines</h3>

</div>

</div>

</div>
<p>
      Applications that access MySQL should not trust any data entered
      by users, who can try to trick your code by entering special or
      escaped character sequences in Web forms, URLs, or whatever
      application you have built. Be sure that your application remains
      secure if a user enters something like <code class="literal">; DROP DATABASE
      mysql;</code>. This is an extreme example, but large security
      leaks and data loss might occur as a result of hackers using
      similar techniques, if you do not prepare for them.
    </p><p>
      A common mistake is to protect only string data values. Remember
      to check numeric data as well. If an application generates a query
      such as <code class="literal">SELECT * FROM table WHERE ID=234</code> when a
      user enters the value <code class="literal">234</code>, the user can enter
      the value <code class="literal">234 OR 1=1</code> to cause the application
      to generate the query <code class="literal">SELECT * FROM table WHERE ID=234 OR
      1=1</code>. As a result, the server retrieves every row in the
      table. This exposes every row and causes excessive server load.
      The simplest way to protect from this type of attack is to use
      single quotation marks around the numeric constants:
      <code class="literal">SELECT * FROM table WHERE ID='234'</code>. If the user
      enters extra information, it all becomes part of the string. In a
      numeric context, MySQL automatically converts this string to a
      number and strips any trailing nonnumeric characters from it.
    </p><p>
      Sometimes people think that if a database contains only publicly
      available data, it need not be protected. This is incorrect. Even
      if it is permissible to display any row in the database, you
      should still protect against denial of service attacks (for
      example, those that are based on the technique in the preceding
      paragraph that causes the server to waste resources). Otherwise,
      your server becomes unresponsive to legitimate users.
    </p><p>
      Checklist:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Enable strict SQL mode to tell the server to be more
          restrictive of what data values it accepts. See
          <a class="xref" href="server-administration.html#sql-mode" title="5.1.11 Server SQL Modes">Section 5.1.11, “Server SQL Modes”</a>.
        </p></li><li class="listitem"><p>
          Try to enter single and double quotation marks
          (<code class="literal">'</code> and <code class="literal">"</code>) in all of your
          Web forms. If you get any kind of MySQL error, investigate the
          problem right away.
        </p></li><li class="listitem"><p>
          Try to modify dynamic URLs by adding <code class="literal">%22</code>
          (<code class="literal">"</code>), <code class="literal">%23</code>
          (<code class="literal">#</code>), and <code class="literal">%27</code>
          (<code class="literal">'</code>) to them.
        </p></li><li class="listitem"><p>
          Try to modify data types in dynamic URLs from numeric to
          character types using the characters shown in the previous
          examples. Your application should be safe against these and
          similar attacks.
        </p></li><li class="listitem"><p>
          Try to enter characters, spaces, and special symbols rather
          than numbers in numeric fields. Your application should remove
          them before passing them to MySQL or else generate an error.
          Passing unchecked values to MySQL is very dangerous!
        </p></li><li class="listitem"><p>
          Check the size of data before passing it to MySQL.
        </p></li><li class="listitem"><p>
          Have your application connect to the database using a user
          name different from the one you use for administrative
          purposes. Do not give your applications any access privileges
          they do not need.
</p></li></ul>
</div>
<p>
      Many application programming interfaces provide a means of
      escaping special characters in data values. Properly used, this
      prevents application users from entering values that cause the
      application to generate statements that have a different effect
      than you intend:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MySQL C API: Use the
          <a class="link" href="connectors-apis.html#mysql-real-escape-string-quote" title="28.7.7.56 mysql_real_escape_string_quote()"><code class="literal">mysql_real_escape_string_quote()</code></a>
          API call.
        </p></li><li class="listitem"><p>
          MySQL++: Use the <code class="literal">escape</code> and
          <code class="literal">quote</code> modifiers for query streams.
        </p></li><li class="listitem"><p>
          PHP: Use either the <code class="literal">mysqli</code> or
          <code class="literal">pdo_mysql</code> extensions, and not the older
          <code class="literal">ext/mysql</code> extension. The preferred API's
          support the improved MySQL authentication protocol and
          passwords, as well as prepared statements with placeholders.
          See also <a class="ulink" href="https://dev.mysql.com/doc/apis-php/en/apis-php-mysqlinfo.api.choosing.html" target="_top">Choosing an API</a>.
        </p><p>
          If the older <code class="literal">ext/mysql</code> extension must be
          used, then for escaping use the
          <a class="link" href="connectors-apis.html#mysql-real-escape-string-quote" title="28.7.7.56 mysql_real_escape_string_quote()"><code class="literal">mysql_real_escape_string_quote()</code></a>
          function and not
          <a class="link" href="connectors-apis.html#mysql-escape-string" title="28.7.7.16 mysql_escape_string()"><code class="literal">mysql_escape_string()</code></a> or
          <code class="function">addslashes()</code> because only
          <a class="link" href="connectors-apis.html#mysql-real-escape-string-quote" title="28.7.7.56 mysql_real_escape_string_quote()"><code class="literal">mysql_real_escape_string_quote()</code></a>
          is character set-aware; the other functions can be
          <span class="quote">“<span class="quote">bypassed</span>”</span> when using (invalid) multibyte
          character sets.
        </p></li><li class="listitem"><p>
          Perl DBI: Use placeholders or the <code class="literal">quote()</code>
          method.
        </p></li><li class="listitem"><p>
          Ruby DBI: Use placeholders or the <code class="literal">quote()</code>
          method.
        </p></li><li class="listitem"><p>
          Java JDBC: Use a <code class="literal">PreparedStatement</code> object
          and placeholders.
</p></li></ul>
</div>
<p>
      Other programming interfaces might have similar capabilities.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="access-control"></a>6.2 Access Control and Account Management</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#user-names">6.2.1 Account User Names and Passwords</a></span></dt><dt><span class="section"><a href="security.html#privileges-provided">6.2.2 Privileges Provided by MySQL</a></span></dt><dt><span class="section"><a href="security.html#grant-tables">6.2.3 Grant Tables</a></span></dt><dt><span class="section"><a href="security.html#account-names">6.2.4 Specifying Account Names</a></span></dt><dt><span class="section"><a href="security.html#role-names">6.2.5 Specifying Role Names</a></span></dt><dt><span class="section"><a href="security.html#connection-access">6.2.6 Access Control, Stage 1: Connection Verification</a></span></dt><dt><span class="section"><a href="security.html#request-access">6.2.7 Access Control, Stage 2: Request Verification</a></span></dt><dt><span class="section"><a href="security.html#creating-accounts">6.2.8 Adding Accounts, Assigning Privileges, and Dropping Accounts</a></span></dt><dt><span class="section"><a href="security.html#reserved-users">6.2.9 Reserved Accounts</a></span></dt><dt><span class="section"><a href="security.html#roles">6.2.10 Using Roles</a></span></dt><dt><span class="section"><a href="security.html#account-categories">6.2.11 Account Categories</a></span></dt><dt><span class="section"><a href="security.html#partial-revokes">6.2.12 Privilege Restriction Using Partial Revokes</a></span></dt><dt><span class="section"><a href="security.html#privilege-changes">6.2.13 When Privilege Changes Take Effect</a></span></dt><dt><span class="section"><a href="security.html#assigning-passwords">6.2.14 Assigning Account Passwords</a></span></dt><dt><span class="section"><a href="security.html#password-management">6.2.15 Password Management</a></span></dt><dt><span class="section"><a href="security.html#expired-password-handling">6.2.16 Server Handling of Expired Passwords</a></span></dt><dt><span class="section"><a href="security.html#pluggable-authentication">6.2.17 Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#proxy-users">6.2.18 Proxy Users</a></span></dt><dt><span class="section"><a href="security.html#account-locking">6.2.19 Account Locking</a></span></dt><dt><span class="section"><a href="security.html#user-resources">6.2.20 Setting Account Resource Limits</a></span></dt><dt><span class="section"><a href="security.html#problems-connecting">6.2.21 Troubleshooting Problems Connecting to MySQL</a></span></dt><dt><span class="section"><a href="security.html#account-activity-auditing">6.2.22 SQL-Based Account Activity Auditing</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091725539600"></a><a class="indexterm" name="idm140091725538560"></a><a class="indexterm" name="idm140091725537488"></a><a class="indexterm" name="idm140091725536416"></a><a class="indexterm" name="idm140091725535344"></a><a class="indexterm" name="idm140091725534272"></a><a class="indexterm" name="idm140091725532784"></a><a class="indexterm" name="idm140091725531712"></a><a class="indexterm" name="idm140091725530640"></a><a class="indexterm" name="idm140091725529152"></a><p>
    MySQL enables the creation of accounts that permit client users to
    connect to the server and access data managed by the server. The
    primary function of the MySQL privilege system is to authenticate a
    user who connects from a given host and to associate that user with
    privileges on a database such as
    <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a>,
    <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
    <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
    <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a>. Additional functionality
    includes the ability to grant privileges for administrative
    operations.
  </p><p>
    To control which users can connect, each account can be assigned
    authentication credentials such as a password. The user interface to
    MySQL accounts consists of SQL statements such as
    <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
    <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>, and
    <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a>. See
    <a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>.
  </p><p>
    The MySQL privilege system ensures that all users may perform only
    the operations permitted to them. As a user, when you connect to a
    MySQL server, your identity is determined by <span class="emphasis"><em>the host from
    which you connect</em></span> and <span class="emphasis"><em>the user name you
    specify</em></span>. When you issue requests after connecting, the
    system grants privileges according to your identity and
    <span class="emphasis"><em>what you want to do</em></span>.
  </p><p>
    MySQL considers both your host name and user name in identifying you
    because there is no reason to assume that a given user name belongs
    to the same person on all hosts. For example, the user
    <code class="literal">joe</code> who connects from
    <code class="literal">office.example.com</code> need not be the same person as
    the user <code class="literal">joe</code> who connects from
    <code class="literal">home.example.com</code>. MySQL handles this by enabling
    you to distinguish users on different hosts that happen to have the
    same name: You can grant one set of privileges for connections by
    <code class="literal">joe</code> from <code class="literal">office.example.com</code>,
    and a different set of privileges for connections by
    <code class="literal">joe</code> from <code class="literal">home.example.com</code>. To
    see what privileges a given account has, use the
    <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> statement. For example:
  </p><pre data-lang="sql" class="programlisting">
SHOW GRANTS FOR 'joe'@'office.example.com';
SHOW GRANTS FOR 'joe'@'home.example.com';
</pre><p>
    Internally, the server stores privilege information in the grant
    tables of the <code class="literal">mysql</code> system database. The MySQL
    server reads the contents of these tables into memory when it starts
    and bases access-control decisions on the in-memory copies of the
    grant tables.
  </p><p>
    MySQL access control involves two stages when you run a client
    program that connects to the server:
  </p><p>
    <span class="bold"><strong>Stage 1:</strong></span> The server accepts or
    rejects the connection based on your identity and whether you can
    verify your identity by supplying the correct password.
  </p><p>
    <span class="bold"><strong>Stage 2:</strong></span> Assuming that you can
    connect, the server checks each statement you issue to determine
    whether you have sufficient privileges to perform it. For example,
    if you try to select rows from a table in a database or drop a table
    from the database, the server verifies that you have the
    <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege for the table or the
    <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a> privilege for the database.
  </p><p>
    For a more detailed description of what happens during each stage,
    see <a class="xref" href="security.html#connection-access" title="6.2.6 Access Control, Stage 1: Connection Verification">Section 6.2.6, “Access Control, Stage 1: Connection Verification”</a>, and
    <a class="xref" href="security.html#request-access" title="6.2.7 Access Control, Stage 2: Request Verification">Section 6.2.7, “Access Control, Stage 2: Request Verification”</a>. For help in diagnosing
    privilege-related problems, see
    <a class="xref" href="security.html#problems-connecting" title="6.2.21 Troubleshooting Problems Connecting to MySQL">Section 6.2.21, “Troubleshooting Problems Connecting to MySQL”</a>.
  </p><p>
    If your privileges are changed (either by yourself or someone else)
    while you are connected, those changes do not necessarily take
    effect immediately for the next statement that you issue. For
    details about the conditions under which the server reloads the
    grant tables, see <a class="xref" href="security.html#privilege-changes" title="6.2.13 When Privilege Changes Take Effect">Section 6.2.13, “When Privilege Changes Take Effect”</a>.
  </p><p>
    There are some things that you cannot do with the MySQL privilege
    system:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        You cannot explicitly specify that a given user should be denied
        access. That is, you cannot explicitly match a user and then
        refuse the connection.
      </p></li><li class="listitem"><p>
        You cannot specify that a user has privileges to create or drop
        tables in a database but not to create or drop the database
        itself.
      </p></li><li class="listitem"><p>
        A password applies globally to an account. You cannot associate
        a password with a specific object such as a database, table, or
        routine.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="user-names"></a>6.2.1 Account User Names and Passwords</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091725489136"></a><a class="indexterm" name="idm140091725487680"></a><p>
      MySQL stores accounts in the <code class="literal">user</code> table of the
      <code class="literal">mysql</code> system database. An account is defined in
      terms of a user name and the client host or hosts from which the
      user can connect to the server. For information about account
      representation in the <code class="literal">user</code> table, see
      <a class="xref" href="security.html#grant-tables" title="6.2.3 Grant Tables">Section 6.2.3, “Grant Tables”</a>.
    </p><p>
      An account may also have authentication credentials such as a
      password. The credentials are handled by the account
      authentication plugin. MySQL supports multiple authentication
      plugins. Some of them use built-in authentication methods, whereas
      others enable authentication using external authentication
      methods. See <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>.
    </p><p>
      There are several distinctions between the way user names and
      passwords are used by MySQL and your operating system:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          User names, as used by MySQL for authentication purposes, have
          nothing to do with user names (login names) as used by Windows
          or Unix. On Unix, most MySQL clients by default try to log in
          using the current Unix user name as the MySQL user name, but
          that is for convenience only. The default can be overridden
          easily, because client programs permit any user name to be
          specified with a <code class="option">-u</code> or
          <code class="option">--user</code> option. This means that anyone can
          attempt to connect to the server using any user name, so you
          cannot make a database secure in any way unless all MySQL
          accounts have passwords. Anyone who specifies a user name for
          an account that has no password can connect successfully to
          the server.
        </p></li><li class="listitem"><p>
          MySQL user names are up to 32 characters long. Operating
          system user names may have a different maximum length.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
            The MySQL user name length limit is hardcoded in MySQL
            servers and clients, and trying to circumvent it by
            modifying the definitions of the tables in the
            <code class="literal">mysql</code> database <span class="emphasis"><em>does not
            work</em></span>.
          </p><p>
            You should never alter the structure of tables in the
            <code class="literal">mysql</code> database in any manner whatsoever
            except by means of the procedure that is described in
            <a class="xref" href="installing.html#upgrading" title="2.11 Upgrading MySQL">Section 2.11, “Upgrading MySQL”</a>. Attempting to redefine MySQL's
            system tables in any other fashion results in undefined and
            unsupported behavior. The server is free to ignore rows that
            become malformed as a result of such modifications.
</p>
</div>
</li><li class="listitem"><p>
          To authenticate client connections for accounts that use
          built-in authentication methods, the server uses passwords
          stored in the <code class="literal">user</code> table. These passwords
          are distinct from passwords for logging in to your operating
          system. There is no necessary connection between the
          <span class="quote">“<span class="quote">external</span>”</span> password you use to log in to a
          Windows or Unix machine and the password you use to access the
          MySQL server on that machine.
        </p><p>
          If the server authenticates a client using some other plugin,
          the authentication method that the plugin implements may or
          may not use a password stored in the <code class="literal">user</code>
          table. In this case, it is possible that an external password
          is also used to authenticate to the MySQL server.
        </p></li><li class="listitem"><p>
          Passwords stored in the <code class="literal">user</code> table are
          encrypted using plugin-specific algorithms.
        </p></li><li class="listitem"><p>
          If the user name and password contain only ASCII characters,
          it is possible to connect to the server regardless of
          character set settings. To enable connections when the user
          name or password contain non-ASCII characters, client
          applications should call the
          <a class="link" href="connectors-apis.html#mysql-options" title="28.7.7.50 mysql_options()"><code class="literal">mysql_options()</code></a> C API function
          with the <code class="literal">MYSQL_SET_CHARSET_NAME</code> option and
          appropriate character set name as arguments. This causes
          authentication to take place using the specified character
          set. Otherwise, authentication fails unless the server default
          character set is the same as the encoding in the
          authentication defaults.
        </p><p>
          Standard MySQL client programs support a
          <code class="option">--default-character-set</code> option that causes
          <a class="link" href="connectors-apis.html#mysql-options" title="28.7.7.50 mysql_options()"><code class="literal">mysql_options()</code></a> to be called
          as just described. In addition, character set autodetection is
          supported as described in
          <a class="xref" href="charset.html#charset-connection" title="10.4 Connection Character Sets and Collations">Section 10.4, “Connection Character Sets and Collations”</a>. For programs that use a
          connector that is not based on the C API, the connector may
          provide an equivalent to
          <a class="link" href="connectors-apis.html#mysql-options" title="28.7.7.50 mysql_options()"><code class="literal">mysql_options()</code></a> that can be
          used instead. Check the connector documentation.
        </p><p>
          The preceding notes do not apply for <code class="literal">ucs2</code>,
          <code class="literal">utf16</code>, and <code class="literal">utf32</code>, which
          are not permitted as client character sets.
</p></li></ul>
</div>
<p>
      The MySQL installation process populates the grant tables with an
      initial <code class="literal">root</code> account, as described in
      <a class="xref" href="installing.html#default-privileges" title="2.10.4 Securing the Initial MySQL Account">Section 2.10.4, “Securing the Initial MySQL Account”</a>, which also discusses how to
      assign a password to it. Thereafter, you normally set up, modify,
      and remove MySQL accounts using statements such as
      <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
      <a class="link" href="sql-syntax.html#drop-user" title="13.7.1.5 DROP USER Syntax"><code class="literal">DROP USER</code></a>,
      <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>, and
      <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a>. See
      <a class="xref" href="security.html#creating-accounts" title="6.2.8 Adding Accounts, Assigning Privileges, and Dropping Accounts">Section 6.2.8, “Adding Accounts, Assigning Privileges, and Dropping Accounts”</a>, and
      <a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>.
    </p><p>
      To connect to a MySQL server with a command-line client, specify
      user name and password options as necessary for the account that
      you want to use:
    </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=finley --password <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
      If you prefer short options, the command looks like this:
    </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u finley -p <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
      If you omit the password value following the
      <a class="link" href="programs.html#option_general_password"><code class="option">--password</code></a> or <code class="option">-p</code>
      option on the command line (as just shown), the client prompts for
      one. Alternatively, the password can be specified on the command
      line:
    </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=finley --password=<em class="replaceable"><code>password</code></em> <em class="replaceable"><code>db_name</code></em></code></strong>
shell&gt; <strong class="userinput"><code>mysql -u finley -p<em class="replaceable"><code>password</code></em> <em class="replaceable"><code>db_name</code></em></code></strong>
</pre><p>
      If you use the <code class="option">-p</code> option, there must be
      <span class="emphasis"><em>no space</em></span> between <code class="option">-p</code> and the
      following password value.
    </p><p>
      Specifying a password on the command line should be considered
      insecure. See <a class="xref" href="security.html#password-security-user" title="6.1.2.1 End-User Guidelines for Password Security">Section 6.1.2.1, “End-User Guidelines for Password Security”</a>. To avoid
      giving the password on the command line, use an option file or a
      login path file. See <a class="xref" href="programs.html#option-files" title="4.2.2.2 Using Option Files">Section 4.2.2.2, “Using Option Files”</a>, and
      <a class="xref" href="programs.html#mysql-config-editor" title="4.6.7 mysql_config_editor — MySQL Configuration Utility">Section 4.6.7, “<span class="command"><strong>mysql_config_editor</strong></span> — MySQL Configuration Utility”</a>.
    </p><p>
      For additional information about specifying user names, passwords,
      and other connection parameters, see <a class="xref" href="programs.html#connecting" title="4.2.3 Connecting to the MySQL Server">Section 4.2.3, “Connecting to the MySQL Server”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="privileges-provided"></a>6.2.2 Privileges Provided by MySQL</h3>

</div>

</div>

</div>
<p>
      The privileges granted to a MySQL account determine which
      operations the account can perform. MySQL privileges differ in the
      contexts in which they apply and at different levels of operation:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Administrative privileges enable users to manage operation of
          the MySQL server. These privileges are global because they are
          not specific to a particular database.
        </p></li><li class="listitem"><p>
          Database privileges apply to a database and to all objects
          within it. These privileges can be granted for specific
          databases, or globally so that they apply to all databases.
        </p></li><li class="listitem"><p>
          Privileges for database objects such as tables, indexes,
          views, and stored routines can be granted for specific objects
          within a database, for all objects of a given type within a
          database (for example, all tables in a database), or globally
          for all objects of a given type in all databases.
</p></li></ul>
</div>
<p>
      Privileges also differ in terms of whether they are static (built
      in to the server) or dynamic (defined at runtime). Whether a
      privilege is static or dynamic affects its availability to be
      granted to user accounts and roles. For information about the
      differences between static and dynamic privileges, see
      <a class="xref" href="security.html#static-dynamic-privileges" title="Static Versus Dynamic Privileges">Static Versus Dynamic Privileges</a>.)
    </p><p>
      Information about account privileges is stored in the grant tables
      in the <code class="literal">mysql</code> system database. For a description
      of the structure and contents of these tables, see
      <a class="xref" href="security.html#grant-tables" title="6.2.3 Grant Tables">Section 6.2.3, “Grant Tables”</a>. The MySQL server reads the
      contents of the grant tables into memory when it starts, and
      reloads them under the circumstances indicated in
      <a class="xref" href="security.html#privilege-changes" title="6.2.13 When Privilege Changes Take Effect">Section 6.2.13, “When Privilege Changes Take Effect”</a>. The server bases
      access-control decisions on the in-memory copies of the grant
      tables.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
        Some MySQL releases introduce changes to the grant tables to add
        new privileges or features. To make sure that you can take
        advantage of any new capabilities, update your grant tables to
        the current structure whenever you upgrade MySQL. See
        <a class="xref" href="installing.html#upgrading" title="2.11 Upgrading MySQL">Section 2.11, “Upgrading MySQL”</a>.
</p>
</div>
<p>
      The following sections summarize the available privileges, provide
      more detailed descriptions of each privilege, and offer usage
      guidelines.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#privileges-provided-summary" title="Summary of Available Privileges">Summary of Available Privileges</a></p></li><li class="listitem"><p><a class="xref" href="security.html#privileges-provided-static" title="Static Privilege Descriptions">Static Privilege Descriptions</a></p></li><li class="listitem"><p><a class="xref" href="security.html#privileges-provided-dynamic" title="Dynamic Privilege Descriptions">Dynamic Privilege Descriptions</a></p></li><li class="listitem"><p><a class="xref" href="security.html#privileges-provided-guidelines" title="Privilege-Granting Guidelines">Privilege-Granting Guidelines</a></p></li><li class="listitem"><p><a class="xref" href="security.html#static-dynamic-privileges" title="Static Versus Dynamic Privileges">Static Versus Dynamic Privileges</a></p></li><li class="listitem"><p><a class="xref" href="security.html#dynamic-privileges-migration-from-super" title="Migrating Accounts from SUPER to Dynamic Privileges">Migrating Accounts from SUPER to Dynamic Privileges</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="privileges-provided-summary"></a>Summary of Available Privileges</h4>

</div>

</div>

</div>
<p>
        The following table shows the static privilege names used in
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
        <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> statements, along with the
        column name associated with each privilege in the grant tables
        and the context in which the privilege applies.
</p>
<div class="table">
<a name="idm140091725408704"></a><p class="title"><b>Table 6.2 Permissible Static Privileges for GRANT and REVOKE</b></p>
<div class="table-contents">
<table><col width="30%"><col width="33%"><col width="37%"><thead><tr>
            <th scope="col">Privilege</th>
            <th scope="col">Grant Table Column</th>
            <th scope="col">Context</th>
          </tr></thead><tbody><tr>
            <td scope="row"><a class="link" href="security.html#priv_all"><code class="literal">ALL [PRIVILEGES]</code></a></td>
            <td>Synonym for <span class="quote">“<span class="quote">all privileges</span>”</span></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_alter"><code class="literal">ALTER</code></a></td>
            <td><code class="literal">Alter_priv</code></td>
            <td>Tables</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_alter-routine"><code class="literal">ALTER ROUTINE</code></a></td>
            <td><code class="literal">Alter_routine_priv</code></td>
            <td>Stored routines</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_create"><code class="literal">CREATE</code></a></td>
            <td><code class="literal">Create_priv</code></td>
            <td>Databases, tables, or indexes</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_create-role"><code class="literal">CREATE ROLE</code></a></td>
            <td><code class="literal">Create_role_priv</code></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_create-routine"><code class="literal">CREATE ROUTINE</code></a></td>
            <td><code class="literal">Create_routine_priv</code></td>
            <td>Stored routines</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_create-tablespace"><code class="literal">CREATE TABLESPACE</code></a></td>
            <td><code class="literal">Create_tablespace_priv</code></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_create-temporary-tables"><code class="literal">CREATE TEMPORARY TABLES</code></a></td>
            <td><code class="literal">Create_tmp_table_priv</code></td>
            <td>Tables</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a></td>
            <td><code class="literal">Create_user_priv</code></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_create-view"><code class="literal">CREATE VIEW</code></a></td>
            <td><code class="literal">Create_view_priv</code></td>
            <td>Views</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a></td>
            <td><code class="literal">Delete_priv</code></td>
            <td>Tables</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a></td>
            <td><code class="literal">Drop_priv</code></td>
            <td>Databases, tables, or views</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_drop-role"><code class="literal">DROP ROLE</code></a></td>
            <td><code class="literal">Drop_role_priv</code></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_event"><code class="literal">EVENT</code></a></td>
            <td><code class="literal">Event_priv</code></td>
            <td>Databases</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a></td>
            <td><code class="literal">Execute_priv</code></td>
            <td>Stored routines</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a></td>
            <td><code class="literal">File_priv</code></td>
            <td>File access on server host</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a></td>
            <td><code class="literal">Grant_priv</code></td>
            <td>Databases, tables, or stored routines</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_index"><code class="literal">INDEX</code></a></td>
            <td><code class="literal">Index_priv</code></td>
            <td>Tables</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a></td>
            <td><code class="literal">Insert_priv</code></td>
            <td>Tables or columns</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_lock-tables"><code class="literal">LOCK TABLES</code></a></td>
            <td><code class="literal">Lock_tables_priv</code></td>
            <td>Databases</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a></td>
            <td><code class="literal">Process_priv</code></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a></td>
            <td>See <code class="literal">proxies_priv</code> table</td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_references"><code class="literal">REFERENCES</code></a></td>
            <td><code class="literal">References_priv</code></td>
            <td>Databases or tables</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a></td>
            <td><code class="literal">Reload_priv</code></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_replication-client"><code class="literal">REPLICATION CLIENT</code></a></td>
            <td><code class="literal">Repl_client_priv</code></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_replication-slave"><code class="literal">REPLICATION SLAVE</code></a></td>
            <td><code class="literal">Repl_slave_priv</code></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a></td>
            <td><code class="literal">Select_priv</code></td>
            <td>Tables or columns</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_show-databases"><code class="literal">SHOW DATABASES</code></a></td>
            <td><code class="literal">Show_db_priv</code></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_show-view"><code class="literal">SHOW VIEW</code></a></td>
            <td><code class="literal">Show_view_priv</code></td>
            <td>Views</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a></td>
            <td><code class="literal">Shutdown_priv</code></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a></td>
            <td><code class="literal">Super_priv</code></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_trigger"><code class="literal">TRIGGER</code></a></td>
            <td><code class="literal">Trigger_priv</code></td>
            <td>Tables</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a></td>
            <td><code class="literal">Update_priv</code></td>
            <td>Tables or columns</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_usage"><code class="literal">USAGE</code></a></td>
            <td>Synonym for <span class="quote">“<span class="quote">no privileges</span>”</span></td>
            <td>Server administration</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The following table shows the dynamic privilege names used in
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
        <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> statements, along with the
        context in which the privilege applies.
</p>
<div class="table">
<a name="idm140091725237328"></a><p class="title"><b>Table 6.3 Permissible Dynamic Privileges for GRANT and REVOKE</b></p>
<div class="table-contents">
<table><col width="35%"><col width="45%"><thead><tr>
            <th scope="col">Privilege</th>
            <th scope="col">Context</th>
          </tr></thead><tbody><tr>
            <td scope="row"><a class="link" href="security.html#priv_application-password-admin"><code class="literal">APPLICATION_PASSWORD_ADMIN</code></a></td>
            <td>Dual password administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_audit-admin"><code class="literal">AUDIT_ADMIN</code></a></td>
            <td>Audit log administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_backup-admin"><code class="literal">BACKUP_ADMIN</code></a></td>
            <td>Backup administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_binlog-admin"><code class="literal">BINLOG_ADMIN</code></a></td>
            <td>Backup and Replication administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_binlog-encryption-admin"><code class="literal">BINLOG_ENCRYPTION_ADMIN</code></a></td>
            <td>Backup and Replication administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_encryption-key-admin"><code class="literal">ENCRYPTION_KEY_ADMIN</code></a></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_firewall-admin"><code class="literal">FIREWALL_ADMIN</code></a></td>
            <td>Firewall administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_firewall-user"><code class="literal">FIREWALL_USER</code></a></td>
            <td>Firewall administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_group-replication-admin"><code class="literal">GROUP_REPLICATION_ADMIN</code></a></td>
            <td>Replication administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_persist-ro-variables-admin"><code class="literal">PERSIST_RO_VARIABLES_ADMIN</code></a></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_replication-slave-admin"><code class="literal">REPLICATION_SLAVE_ADMIN</code></a></td>
            <td>Replication administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_resource-group-admin"><code class="literal">RESOURCE_GROUP_ADMIN</code></a></td>
            <td>Resource group administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_resource-group-user"><code class="literal">RESOURCE_GROUP_USER</code></a></td>
            <td>Resource group administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_role-admin"><code class="literal">ROLE_ADMIN</code></a></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_session-variables-admin"><code class="literal">SESSION_VARIABLES_ADMIN</code></a></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_set-user-id"><code class="literal">SET_USER_ID</code></a></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_table-encryption-admin"><code class="literal">TABLE_ENCRYPTION_ADMIN</code></a></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_version-token-admin"><code class="literal">VERSION_TOKEN_ADMIN</code></a></td>
            <td>Server administration</td>
          </tr><tr>
            <td scope="row"><a class="link" href="security.html#priv_xa-recover-admin"><code class="literal">XA_RECOVER_ADMIN</code></a></td>
            <td>Server administration</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="privileges-provided-static"></a>Static Privilege Descriptions</h4>

</div>

</div>

</div>
<p>
        Static privileges are built in to the server, in contrast to
        dynamic privileges, which are defined at runtime. The following
        list describes each static privilege available in MySQL.
      </p><p>
        Particular SQL statements might have more specific privilege
        requirements than indicated here. If so, the description for the
        statement in question provides the details.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="priv_all"></a>
            <a class="link" href="security.html#priv_all"><code class="literal">ALL</code></a>,
            <a class="link" href="security.html#priv_all"><code class="literal">ALL
            PRIVILEGES</code></a>
          </p><a class="indexterm" name="idm140091725149360"></a><a class="indexterm" name="idm140091725147904"></a><a class="indexterm" name="idm140091725146832"></a><a class="indexterm" name="idm140091725145344"></a><p>
            These privilege specifiers are shorthand for <span class="quote">“<span class="quote">all
            privileges available at a given privilege level</span>”</span>
            (except <a class="link" href="security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a>). For
            example, granting <a class="link" href="security.html#priv_all"><code class="literal">ALL</code></a> at the
            global or table level grants all global privileges or all
            table-level privileges, respectively.
          </p></li><li class="listitem"><p><a name="priv_alter"></a>
            <a class="link" href="security.html#priv_alter"><code class="literal">ALTER</code></a>
          </p><a class="indexterm" name="idm140091725138320"></a><a class="indexterm" name="idm140091725136832"></a><p>
            Enables use of the <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER
            TABLE</code></a> statement to change the structure of tables.
            <a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> also requires the
            <a class="link" href="security.html#priv_create"><code class="literal">CREATE</code></a> and
            <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> privileges. Renaming a
            table requires <a class="link" href="security.html#priv_alter"><code class="literal">ALTER</code></a> and
            <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a> on the old table,
            <a class="link" href="security.html#priv_create"><code class="literal">CREATE</code></a>, and
            <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> on the new table.
          </p></li><li class="listitem"><p><a name="priv_alter-routine"></a>
            <a class="link" href="security.html#priv_alter-routine"><code class="literal">ALTER ROUTINE</code></a>
          </p><a class="indexterm" name="idm140091725122944"></a><a class="indexterm" name="idm140091725121456"></a><p>
            Enables use of statements that alter or drop stored routines
            (stored procedures and functions).
          </p></li><li class="listitem"><p><a name="priv_create"></a>
            <a class="link" href="security.html#priv_create"><code class="literal">CREATE</code></a>
          </p><a class="indexterm" name="idm140091725117456"></a><a class="indexterm" name="idm140091725115968"></a><p>
            Enables use of statements that create new databases and
            tables.
          </p></li><li class="listitem"><p><a name="priv_create-role"></a>
            <a class="link" href="security.html#priv_create-role"><code class="literal">CREATE ROLE</code></a>
          </p><a class="indexterm" name="idm140091725112064"></a><a class="indexterm" name="idm140091725110576"></a><p>
            Enables use of the <a class="link" href="sql-syntax.html#create-role" title="13.7.1.2 CREATE ROLE Syntax"><code class="literal">CREATE
            ROLE</code></a> statement. (The <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE
            USER</code></a> privilege also enables use of the
            <a class="link" href="sql-syntax.html#create-role" title="13.7.1.2 CREATE ROLE Syntax"><code class="literal">CREATE ROLE</code></a> statement.) See
            <a class="xref" href="security.html#roles" title="6.2.10 Using Roles">Section 6.2.10, “Using Roles”</a>.
          </p><p>
            The <a class="link" href="security.html#priv_create-role"><code class="literal">CREATE ROLE</code></a> and
            <a class="link" href="security.html#priv_drop-role"><code class="literal">DROP ROLE</code></a> privileges are not
            as powerful as <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a>
            because they can be used only to create and drop accounts.
            They cannot be used as <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE
            USER</code></a> can be modify account attributes or rename
            accounts. See
            <a class="xref" href="security.html#role-user-interchangeability" title="User and Role Interchangeability">User and Role Interchangeability</a>.
          </p></li><li class="listitem"><p><a name="priv_create-routine"></a>
            <a class="link" href="security.html#priv_create-routine"><code class="literal">CREATE ROUTINE</code></a>
          </p><a class="indexterm" name="idm140091725095728"></a><a class="indexterm" name="idm140091725094240"></a><p>
            Enables use of statements that create stored routines
            (stored procedures and functions).
          </p></li><li class="listitem"><p><a name="priv_create-tablespace"></a>
            <a class="link" href="security.html#priv_create-tablespace"><code class="literal">CREATE TABLESPACE</code></a>
          </p><a class="indexterm" name="idm140091725090224"></a><a class="indexterm" name="idm140091725088736"></a><p>
            Enables use of statements that create, alter, or drop
            tablespaces and log file groups.
          </p></li><li class="listitem"><p><a name="priv_create-temporary-tables"></a>
            <a class="link" href="security.html#priv_create-temporary-tables"><code class="literal">CREATE TEMPORARY TABLES</code></a>
          </p><a class="indexterm" name="idm140091725084608"></a><a class="indexterm" name="idm140091725083120"></a><p>
            Enables the creation of temporary tables using the
            <a class="link" href="sql-syntax.html#create-temporary-table" title="13.1.20.3 CREATE TEMPORARY TABLE Syntax"><code class="literal">CREATE TEMPORARY TABLE</code></a>
            statement.
          </p><a class="indexterm" name="idm140091725080176"></a><a class="indexterm" name="idm140091725078688"></a><p>
            After a session has created a temporary table, the server
            performs no further privilege checks on the table. The
            creating session can perform any operation on the table,
            such as <a class="link" href="sql-syntax.html#drop-table" title="13.1.32 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a>,
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a>. For more information,
            see <a class="xref" href="sql-syntax.html#create-temporary-table" title="13.1.20.3 CREATE TEMPORARY TABLE Syntax">Section 13.1.20.3, “CREATE TEMPORARY TABLE Syntax”</a>.
          </p></li><li class="listitem"><p><a name="priv_create-user"></a>
            <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a>
          </p><a class="indexterm" name="idm140091725068944"></a><a class="indexterm" name="idm140091725067456"></a><p>
            Enables use of the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER
            USER</code></a>, <a class="link" href="sql-syntax.html#create-role" title="13.7.1.2 CREATE ROLE Syntax"><code class="literal">CREATE ROLE</code></a>,
            <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
            <a class="link" href="sql-syntax.html#drop-role" title="13.7.1.4 DROP ROLE Syntax"><code class="literal">DROP ROLE</code></a>,
            <a class="link" href="sql-syntax.html#drop-user" title="13.7.1.5 DROP USER Syntax"><code class="literal">DROP USER</code></a>,
            <a class="link" href="sql-syntax.html#rename-user" title="13.7.1.7 RENAME USER Syntax"><code class="literal">RENAME USER</code></a>, and
            <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE ALL
            PRIVILEGES</code></a> statements.
          </p></li><li class="listitem"><p><a name="priv_create-view"></a>
            <a class="link" href="security.html#priv_create-view"><code class="literal">CREATE VIEW</code></a>
          </p><a class="indexterm" name="idm140091725054944"></a><a class="indexterm" name="idm140091725053456"></a><p>
            Enables use of the <a class="link" href="sql-syntax.html#create-view" title="13.1.23 CREATE VIEW Syntax"><code class="literal">CREATE
            VIEW</code></a> statement.
          </p></li><li class="listitem"><p><a name="priv_delete"></a>
            <a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a>
          </p><a class="indexterm" name="idm140091725048208"></a><a class="indexterm" name="idm140091725046720"></a><p>
            Enables rows to be deleted from tables in a database.
          </p></li><li class="listitem"><p><a name="priv_drop"></a>
            <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a>
          </p><a class="indexterm" name="idm140091725042768"></a><a class="indexterm" name="idm140091725041280"></a><p>
            Enables use of statements that drop (remove) existing
            databases, tables, and views. The
            <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a> privilege is required to
            use the <code class="literal">ALTER TABLE ... DROP PARTITION</code>
            statement on a partitioned table. The
            <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a> privilege is also
            required for <a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>.
          </p></li><li class="listitem"><p><a name="priv_drop-role"></a>
            <a class="link" href="security.html#priv_drop-role"><code class="literal">DROP ROLE</code></a>
          </p><a class="indexterm" name="idm140091725032736"></a><a class="indexterm" name="idm140091725031248"></a><p>
            Enables use of the <a class="link" href="sql-syntax.html#drop-role" title="13.7.1.4 DROP ROLE Syntax"><code class="literal">DROP ROLE</code></a>
            statement. (The <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a>
            privilege also enables use of the <a class="link" href="sql-syntax.html#drop-role" title="13.7.1.4 DROP ROLE Syntax"><code class="literal">DROP
            ROLE</code></a> statement.) See <a class="xref" href="security.html#roles" title="6.2.10 Using Roles">Section 6.2.10, “Using Roles”</a>.
          </p><p>
            The <a class="link" href="security.html#priv_create-role"><code class="literal">CREATE ROLE</code></a> and
            <a class="link" href="security.html#priv_drop-role"><code class="literal">DROP ROLE</code></a> privileges are not
            as powerful as <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a>
            because they can be used only to create and drop accounts.
            They cannot be used as <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE
            USER</code></a> can be modify account attributes or rename
            accounts. See
            <a class="xref" href="security.html#role-user-interchangeability" title="User and Role Interchangeability">User and Role Interchangeability</a>.
          </p></li><li class="listitem"><p><a name="priv_event"></a>
            <a class="link" href="security.html#priv_event"><code class="literal">EVENT</code></a>
          </p><a class="indexterm" name="idm140091725016688"></a><a class="indexterm" name="idm140091725015200"></a><p>
            Enables use of statements that create, alter, drop, or
            display events for the Event Scheduler.
          </p></li><li class="listitem"><p><a name="priv_execute"></a>
            <a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a>
          </p><a class="indexterm" name="idm140091725011200"></a><a class="indexterm" name="idm140091725009712"></a><p>
            Enables use of statements that execute stored routines
            (stored procedures and functions).
          </p></li><li class="listitem"><p><a name="priv_file"></a>
            <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a>
          </p><a class="indexterm" name="idm140091725005712"></a><a class="indexterm" name="idm140091725004224"></a><p>
            Affects the following operations and server behaviors:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Enables reading and writing files on the server host
                using the <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD DATA</code></a> and
                <a class="link" href="sql-syntax.html#select-into" title="13.2.10.1 SELECT ... INTO Syntax"><code class="literal">SELECT ...
                INTO OUTFILE</code></a> statements and the
                <a class="link" href="functions.html#function_load-file"><code class="literal">LOAD_FILE()</code></a> function. A
                user who has the <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a>
                privilege can read any file on the server host that is
                either world-readable or readable by the MySQL server.
                (This implies the user can read any file in any database
                directory, because the server can access any of those
                files.)
              </p></li><li class="listitem"><p>
                Enables creating new files in any directory where the
                MySQL server has write access. This includes the
                server's data directory containing the files that
                implement the privilege tables.
              </p></li><li class="listitem"><p>
                Enables use of the <code class="literal">DATA DIRECTORY</code> or
                <code class="literal">INDEX DIRECTORY</code> table option for the
                <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement.
</p></li></ul>
</div>
<p>
            As a security measure, the server does not overwrite
            existing files.
          </p><p>
            To limit the location in which files can be read and
            written, set the
            <a class="link" href="server-administration.html#sysvar_secure_file_priv"><code class="literal">secure_file_priv</code></a> system
            variable to a specific directory. See
            <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 Server System Variables">Section 5.1.8, “Server System Variables”</a>.
          </p></li><li class="listitem"><p><a name="priv_grant-option"></a>
            <a class="link" href="security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a>
          </p><a class="indexterm" name="idm140091724986224"></a><a class="indexterm" name="idm140091724984736"></a><p>
            Enables you to grant to or revoke from other users those
            privileges that you yourself possess.
          </p></li><li class="listitem"><p><a name="priv_index"></a>
            <a class="link" href="security.html#priv_index"><code class="literal">INDEX</code></a>
          </p><a class="indexterm" name="idm140091724980736"></a><a class="indexterm" name="idm140091724979248"></a><p>
            Enables use of statements that create or drop (remove)
            indexes. <a class="link" href="security.html#priv_index"><code class="literal">INDEX</code></a> applies to
            existing tables. If you have the
            <a class="link" href="security.html#priv_create"><code class="literal">CREATE</code></a> privilege for a table,
            you can include index definitions in the
            <a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement.
          </p></li><li class="listitem"><p><a name="priv_insert"></a>
            <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a>
          </p><a class="indexterm" name="idm140091724971456"></a><a class="indexterm" name="idm140091724969968"></a><p>
            Enables rows to be inserted into tables in a database.
            <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> is also required for
            the <a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>,
            <a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>, and
            <a class="link" href="sql-syntax.html#repair-table" title="13.7.3.5 REPAIR TABLE Syntax"><code class="literal">REPAIR TABLE</code></a>
            table-maintenance statements.
          </p></li><li class="listitem"><p><a name="priv_lock-tables"></a>
            <a class="link" href="security.html#priv_lock-tables"><code class="literal">LOCK TABLES</code></a>
          </p><a class="indexterm" name="idm140091724961040"></a><a class="indexterm" name="idm140091724959552"></a><p>
            Enables use of explicit <a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
            TABLES</code></a> statements to lock tables for which you
            have the <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege.
            This includes use of write locks, which prevents other
            sessions from reading the locked table.
          </p></li><li class="listitem"><p><a name="priv_process"></a>
            <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a>
          </p><a class="indexterm" name="idm140091724953072"></a><a class="indexterm" name="idm140091724951584"></a><p>
            Enables display of information about the threads executing
            within the server (that is, information about the statements
            being executed by sessions). The privilege enables use of
            <a class="link" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST Syntax"><code class="literal">SHOW PROCESSLIST</code></a> or
            <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin processlist</strong></span></a> to see threads
            belonging to other accounts; you can always see your own
            threads. The <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a>
            privilege also enables use of <a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE Syntax"><code class="literal">SHOW
            ENGINE</code></a>.
          </p></li><li class="listitem"><p><a name="priv_proxy"></a>
            <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a>
          </p><a class="indexterm" name="idm140091724942320"></a><a class="indexterm" name="idm140091724940832"></a><p>
            Enables one user to impersonate or become known as another
            user. See <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>.
          </p></li><li class="listitem"><p><a name="priv_references"></a>
            <a class="link" href="security.html#priv_references"><code class="literal">REFERENCES</code></a>
          </p><a class="indexterm" name="idm140091724936192"></a><a class="indexterm" name="idm140091724934704"></a><p>
            Creation of a foreign key constraint requires the
            <a class="link" href="security.html#priv_references"><code class="literal">REFERENCES</code></a> privilege for the
            parent table.
          </p></li><li class="listitem"><p><a name="priv_reload"></a>
            <a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a>
          </p><a class="indexterm" name="idm140091724929488"></a><a class="indexterm" name="idm140091724928000"></a><p>
            Enables use of the <a class="link" href="sql-syntax.html#flush" title="13.7.7.3 FLUSH Syntax"><code class="literal">FLUSH</code></a>
            statement. It also enables <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a>
            commands that are equivalent to
            <a class="link" href="sql-syntax.html#flush" title="13.7.7.3 FLUSH Syntax"><code class="literal">FLUSH</code></a> operations:
            <code class="literal">flush-hosts</code>,
            <code class="literal">flush-logs</code>,
            <code class="literal">flush-privileges</code>,
            <code class="literal">flush-status</code>,
            <code class="literal">flush-tables</code>,
            <code class="literal">flush-threads</code>,
            <code class="literal">refresh</code>, and <code class="literal">reload</code>.
          </p><p>
            The <code class="literal">reload</code> command tells the server to
            reload the grant tables into memory.
            <code class="literal">flush-privileges</code> is a synonym for
            <code class="literal">reload</code>. The <code class="literal">refresh</code>
            command closes and reopens the log files and flushes all
            tables. The other
            <code class="literal">flush-<em class="replaceable"><code>xxx</code></em></code>
            commands perform functions similar to
            <code class="literal">refresh</code>, but are more specific and may be
            preferable in some instances. For example, if you want to
            flush just the log files, <code class="literal">flush-logs</code> is a
            better choice than <code class="literal">refresh</code>.
          </p><p>
            The <a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a> privilege also
            enables use of the <a class="link" href="sql-syntax.html#reset-master" title="13.4.1.2 RESET MASTER Syntax"><code class="literal">RESET
            MASTER</code></a> and <a class="link" href="sql-syntax.html#reset-slave" title="13.4.2.4 RESET SLAVE Syntax"><code class="literal">RESET
            SLAVE</code></a> statements.
          </p></li><li class="listitem"><p><a name="priv_replication-client"></a>
            <a class="link" href="security.html#priv_replication-client"><code class="literal">REPLICATION CLIENT</code></a>
          </p><a class="indexterm" name="idm140091724903456"></a><a class="indexterm" name="idm140091724901968"></a><p>
            Enables use of the <a class="link" href="sql-syntax.html#show-master-status" title="13.7.6.23 SHOW MASTER STATUS Syntax"><code class="literal">SHOW MASTER
            STATUS</code></a>, <a class="link" href="sql-syntax.html#show-slave-status" title="13.7.6.34 SHOW SLAVE STATUS Syntax"><code class="literal">SHOW SLAVE
            STATUS</code></a>, and <a class="link" href="sql-syntax.html#show-binary-logs" title="13.7.6.1 SHOW BINARY LOGS Syntax"><code class="literal">SHOW BINARY
            LOGS</code></a> statements. Grant this privilege to accounts
            that are used by slave servers to connect to the current
            server as their master.
          </p></li><li class="listitem"><p><a name="priv_replication-slave"></a>
            <a class="link" href="security.html#priv_replication-slave"><code class="literal">REPLICATION SLAVE</code></a>
          </p><a class="indexterm" name="idm140091724894016"></a><a class="indexterm" name="idm140091724892528"></a><p>
            Enables the account to request updates that have been made
            to databases on the master server, using the
            <a class="link" href="sql-syntax.html#show-slave-hosts" title="13.7.6.33 SHOW SLAVE HOSTS Syntax"><code class="literal">SHOW SLAVE HOSTS</code></a>,
            <a class="link" href="sql-syntax.html#show-relaylog-events" title="13.7.6.32 SHOW RELAYLOG EVENTS Syntax"><code class="literal">SHOW RELAYLOG EVENTS</code></a>, and
            <a class="link" href="sql-syntax.html#show-binlog-events" title="13.7.6.2 SHOW BINLOG EVENTS Syntax"><code class="literal">SHOW BINLOG EVENTS</code></a>
            statements. This privilege is also required to use the
            <a class="link" href="programs.html#mysqlbinlog" title="4.6.8 mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> options
            <a class="link" href="programs.html#option_mysqlbinlog_read-from-remote-server"><code class="option">--read-from-remote-server</code></a>
            (<code class="option">-R</code>) and
            <a class="link" href="programs.html#option_mysqlbinlog_read-from-remote-master"><code class="option">--read-from-remote-master</code></a>.
            Grant this privilege to accounts that are used by slave
            servers to connect to the current server as their master.
          </p></li><li class="listitem"><p><a name="priv_select"></a>
            <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a>
          </p><a class="indexterm" name="idm140091724880400"></a><a class="indexterm" name="idm140091724878912"></a><p>
            Enables rows to be selected from tables in a database.
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> statements require the
            <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege only if they
            actually access tables. Some
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> statements do not
            access tables and can be executed without permission for any
            database. For example, you can use
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> as a simple calculator
            to evaluate expressions that make no reference to tables:
          </p><pre data-lang="sql" class="programlisting">
SELECT 1+1;
SELECT PI()*2;
</pre><p>
            The <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege is also
            needed for other statements that read column values. For
            example, <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> is needed for
            columns referenced on the right hand side of
            <em class="replaceable"><code>col_name</code></em>=<em class="replaceable"><code>expr</code></em>
            assignment in <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>
            statements or for columns named in the
            <code class="literal">WHERE</code> clause of
            <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> or
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> statements.
          </p><p>
            The <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege is
            needed for tables or views used with
            <a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>, including any
            underlying tables in view definitions.
          </p></li><li class="listitem"><p><a name="priv_show-databases"></a>
            <a class="link" href="security.html#priv_show-databases"><code class="literal">SHOW DATABASES</code></a>
          </p><a class="indexterm" name="idm140091724857392"></a><a class="indexterm" name="idm140091724855904"></a><p>
            Enables the account to see database names by issuing the
            <code class="literal">SHOW DATABASE</code> statement. Accounts that do
            not have this privilege see only databases for which they
            have some privileges, and cannot use the statement at all if
            the server was started with the
            <a class="link" href="server-administration.html#option_mysqld_skip-show-database"><code class="option">--skip-show-database</code></a> option.
</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p>
              Because any static global privilege is considered a
              privilege for all databases, any static global privilege
              enables a user to see all database names with
              <a class="link" href="sql-syntax.html#show-databases" title="13.7.6.14 SHOW DATABASES Syntax"><code class="literal">SHOW DATABASES</code></a> or by
              examining the <a class="link" href="information-schema.html#schemata-table" title="25.24 The INFORMATION_SCHEMA SCHEMATA Table"><code class="literal">SCHEMATA</code></a> table
              of <code class="literal">INFORMATION_SCHEMA</code>, except databases
              that have been restricted at the database level by partial
              revokes.
</p>
</div>
</li><li class="listitem"><p><a name="priv_show-view"></a>
            <a class="link" href="security.html#priv_show-view"><code class="literal">SHOW VIEW</code></a>
          </p><a class="indexterm" name="idm140091724845760"></a><a class="indexterm" name="idm140091724844272"></a><p>
            Enables use of the <a class="link" href="sql-syntax.html#show-create-view" title="13.7.6.13 SHOW CREATE VIEW Syntax"><code class="literal">SHOW CREATE
            VIEW</code></a> statement. This privilege is also needed for
            views used with <a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN Syntax"><code class="literal">EXPLAIN</code></a>.
          </p></li><li class="listitem"><p><a name="priv_shutdown"></a>
            <a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a>
          </p><a class="indexterm" name="idm140091724837696"></a><a class="indexterm" name="idm140091724836208"></a><p>
            Enables use of the <a class="link" href="sql-syntax.html#shutdown" title="13.7.7.9 SHUTDOWN Syntax"><code class="literal">SHUTDOWN</code></a>
            and <a class="link" href="sql-syntax.html#restart" title="13.7.7.8 RESTART Syntax"><code class="literal">RESTART</code></a> statements, the
            <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin shutdown</strong></span></a> command, and the
            <a class="link" href="connectors-apis.html#mysql-shutdown" title="28.7.7.75 mysql_shutdown()"><code class="literal">mysql_shutdown()</code></a> C API
            function.
          </p></li><li class="listitem"><p><a name="priv_super"></a>
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>
          </p><a class="indexterm" name="idm140091724826976"></a><a class="indexterm" name="idm140091724825488"></a><p>
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> is a powerful and
            far-reaching privilege and should not be granted lightly. If
            an account needs to perform only a subset of
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> operations, it may be
            possible to achieve the desired privilege set by instead
            granting one or more dynamic privileges, each of which
            confers more limited capabilities. See
            <a class="xref" href="security.html#privileges-provided-dynamic" title="Dynamic Privilege Descriptions">Dynamic Privilege Descriptions</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> is deprecated and
              will be removed in a future version of MySQL. See
              <a class="xref" href="security.html#dynamic-privileges-migration-from-super" title="Migrating Accounts from SUPER to Dynamic Privileges">Migrating Accounts from SUPER to Dynamic Privileges</a>.
</p>
</div>
<p>
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> affects the following
            operations and server behaviors:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Enables system variable changes at runtime:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                    Enables server configuration changes to global
                    system variables with
                    <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
                    GLOBAL</code></a> and
                    <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
                    PERSIST</code></a>.
                  </p><p>
                    The corresponding dynamic privilege is
                    <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a>.
                  </p></li><li class="listitem"><p>
                    Enables setting restricted session system variables
                    that require a special privilege.
                  </p><p>
                    The corresponding dynamic privilege is
                    <a class="link" href="security.html#priv_session-variables-admin"><code class="literal">SESSION_VARIABLES_ADMIN</code></a>.
</p></li></ul>
</div>
<p>
                See also <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>.
              </p></li><li class="listitem"><p>
                Enables changes to global transaction characteristics
                (see <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.7 SET TRANSACTION Syntax">Section 13.3.7, “SET TRANSACTION Syntax”</a>).
              </p><p>
                The corresponding dynamic privilege is
                <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a>.
              </p></li><li class="listitem"><p>
                Enables the account to start and stop replication,
                including Group Replication.
              </p><p>
                The corresponding dynamic privilege is
                <a class="link" href="security.html#priv_replication-slave-admin"><code class="literal">REPLICATION_SLAVE_ADMIN</code></a>
                for regular replication,
                <a class="link" href="security.html#priv_group-replication-admin"><code class="literal">GROUP_REPLICATION_ADMIN</code></a>
                for Group Replication.
              </p></li><li class="listitem"><p>
                Enables use of the <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1 CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER
                TO</code></a> and <a class="link" href="sql-syntax.html#change-replication-filter" title="13.4.2.2 CHANGE REPLICATION FILTER Syntax"><code class="literal">CHANGE REPLICATION
                FILTER</code></a> statements.
              </p><p>
                The corresponding dynamic privilege is
                <a class="link" href="security.html#priv_replication-slave-admin"><code class="literal">REPLICATION_SLAVE_ADMIN</code></a>.
              </p></li><li class="listitem"><p>
                Enables binary log control by means of the
                <a class="link" href="sql-syntax.html#purge-binary-logs" title="13.4.1.1 PURGE BINARY LOGS Syntax"><code class="literal">PURGE BINARY LOGS</code></a> and
                <a class="link" href="sql-syntax.html#binlog" title="13.7.7.1 BINLOG Syntax"><code class="literal">BINLOG</code></a> statements.
              </p><p>
                The corresponding dynamic privilege is
                <a class="link" href="security.html#priv_binlog-admin"><code class="literal">BINLOG_ADMIN</code></a>.
              </p></li><li class="listitem"><p>
                Enables setting the effective authorization ID when
                executing a view or stored program. A user with this
                privilege can specify any account in the
                <code class="literal">DEFINER</code> attribute of a view or stored
                program.
              </p><p>
                The corresponding dynamic privilege is
                <a class="link" href="security.html#priv_set-user-id"><code class="literal">SET_USER_ID</code></a>.
              </p></li><li class="listitem"><p>
                Enables use of the <a class="link" href="sql-syntax.html#create-server" title="13.1.18 CREATE SERVER Syntax"><code class="literal">CREATE
                SERVER</code></a>, <a class="link" href="sql-syntax.html#alter-server" title="13.1.8 ALTER SERVER Syntax"><code class="literal">ALTER
                SERVER</code></a>, and <a class="link" href="sql-syntax.html#drop-server" title="13.1.30 DROP SERVER Syntax"><code class="literal">DROP
                SERVER</code></a> statements.
              </p></li><li class="listitem"><p>
                Enables use of the <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin debug</strong></span></a>
                command.
              </p></li><li class="listitem"><p>
                Enables <code class="literal">InnoDB</code> encryption key
                rotation.
              </p><p>
                The corresponding dynamic privilege is
                <a class="link" href="security.html#priv_encryption-key-admin"><code class="literal">ENCRYPTION_KEY_ADMIN</code></a>.
              </p></li><li class="listitem"><p>
                Enables execution of Version Tokens user-defined
                functions.
              </p><p>
                The corresponding dynamic privilege is
                <a class="link" href="security.html#priv_version-token-admin"><code class="literal">VERSION_TOKEN_ADMIN</code></a>.
              </p></li><li class="listitem"><p>
                Enables granting and revoking roles, use of the
                <code class="literal">WITH ADMIN OPTION</code> clause of the
                <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statement, and
                nonempty <code class="literal">&lt;graphml&gt;</code> element
                content in the result from the
                <a class="link" href="functions.html#function_roles-graphml"><code class="literal">ROLES_GRAPHML()</code></a> function.
              </p><p>
                The corresponding dynamic privilege is
                <a class="link" href="security.html#priv_role-admin"><code class="literal">ROLE_ADMIN</code></a>.
              </p></li><li class="listitem"><p>
                Enables control over client connections not permitted to
                non-<a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> accounts:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                    Enables use of the
                    <a class="link" href="sql-syntax.html#kill" title="13.7.7.4 KILL Syntax"><code class="literal">KILL</code></a> statement or
                    <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin kill</strong></span></a> command to kill
                    threads belonging to other accounts. (An account can
                    always kill its own threads.)
                  </p></li><li class="listitem"><p>
                    The server does not execute
                    <a class="link" href="server-administration.html#sysvar_init_connect"><code class="literal">init_connect</code></a> system
                    variable content when
                    <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> clients
                    connect.
                  </p></li><li class="listitem"><p>
                    The server accepts one connection from a
                    <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> client even if
                    the connection limit configured by the
                    <a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
                    system variable is reached.
                  </p></li><li class="listitem"><p>
                    A server in offline mode
                    (<a class="link" href="server-administration.html#sysvar_offline_mode"><code class="literal">offline_mode</code></a>
                    enabled) does not terminate
                    <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> client
                    connections at the next client request, and accepts
                    new connections from
                    <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> clients.
                  </p></li><li class="listitem"><p>
                    Updates can be performed even when the
                    <a class="link" href="server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a> system
                    variable is enabled. This applies to explicit table
                    updates, and to use of account-management statements
                    such as <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
                    <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> that update
                    tables implicitly.
</p></li></ul>
</div>
<p>
                The corresponding dynamic privilege for the preceding
                connection-control operations is
                <a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a>.
</p></li></ul>
</div>
<p>
            You may also need the <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>
            privilege to create or alter stored functions if binary
            logging is enabled, as described in
            <a class="xref" href="stored-objects.html#stored-programs-logging" title="24.7 Stored Program Binary Logging">Section 24.7, “Stored Program Binary Logging”</a>.
          </p></li><li class="listitem"><p><a name="priv_trigger"></a>
            <a class="link" href="security.html#priv_trigger"><code class="literal">TRIGGER</code></a>
          </p><a class="indexterm" name="idm140091724733344"></a><a class="indexterm" name="idm140091724731856"></a><p>
            Enables trigger operations. You must have this privilege for
            a table to create, drop, execute, or display triggers for
            that table.
          </p><p>
            When a trigger is activated (by a user who has privileges to
            execute <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
            <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements for the
            table associated with the trigger), trigger execution
            requires that the user who defined the trigger still have
            the <a class="link" href="security.html#priv_trigger"><code class="literal">TRIGGER</code></a> privilege for the
            table.
          </p></li><li class="listitem"><p><a name="priv_update"></a>
            <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a>
          </p><a class="indexterm" name="idm140091724722256"></a><a class="indexterm" name="idm140091724720768"></a><p>
            Enables rows to be updated in tables in a database.
          </p></li><li class="listitem"><p><a name="priv_usage"></a>
            <a class="link" href="security.html#priv_usage"><code class="literal">USAGE</code></a>
          </p><a class="indexterm" name="idm140091724716816"></a><a class="indexterm" name="idm140091724715328"></a><p>
            This privilege specifier stands for <span class="quote">“<span class="quote">no
            privileges.</span>”</span> It is used at the global level with
            <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> to specify clauses such
            as <code class="literal">WITH GRANT OPTION</code> without naming
            specific account privileges in the privilege list.
            <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> displays
            <a class="link" href="security.html#priv_usage"><code class="literal">USAGE</code></a> to indicate that an
            account has no privileges at a privilege level.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="privileges-provided-dynamic"></a>Dynamic Privilege Descriptions</h4>

</div>

</div>

</div>
<p>
        Dynamic privileges are defined at runtime, in contrast to static
        privileges, which are built in to the server. The following list
        describes each dynamic privilege available in MySQL.
      </p><p>
        Most dynamic privileges are defined at server startup. Others
        are defined by a particular server component or plugin, as
        indicated in the privilege descriptions. In such cases, the
        privilege is unavailable unless the component or plugin that
        defines it is enabled.
      </p><p>
        Particular SQL statements might have more specific privilege
        requirements than indicated here. If so, the description for the
        statement in question provides the details.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="priv_application-password-admin"></a>
            <a class="link" href="security.html#priv_application-password-admin"><code class="literal">APPLICATION_PASSWORD_ADMIN</code></a>
            (added in MySQL 8.0.14)
          </p><a class="indexterm" name="idm140091724702560"></a><a class="indexterm" name="idm140091724701056"></a><p>
            For dual-password capability, this privilege enables use of
            the <code class="literal">RETAIN CURRENT PASSWORD</code> and
            <code class="literal">DISCARD OLD PASSWORD</code> clauses for
            <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> and
            <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> statements that
            apply to your own account. This privilege is required to
            manipulate your own secondary password because most users
            require only one password.
          </p><p>
            If an account is to be permitted to manipulate secondary
            passwords for all accounts, it should be granted the
            <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege rather
            than
            <a class="link" href="security.html#priv_application-password-admin"><code class="literal">APPLICATION_PASSWORD_ADMIN</code></a>.
          </p><p>
            For more information about use of dual passwords, see
            <a class="xref" href="security.html#password-management" title="6.2.15 Password Management">Section 6.2.15, “Password Management”</a>.
          </p></li><li class="listitem"><p><a name="priv_audit-admin"></a>
            <a class="link" href="security.html#priv_audit-admin"><code class="literal">AUDIT_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724688784"></a><a class="indexterm" name="idm140091724687296"></a><p>
            Enables audit log configuration. This privilege is defined
            by the <code class="literal">audit_log</code> plugin; see
            <a class="xref" href="security.html#audit-log" title="6.4.5 MySQL Enterprise Audit">Section 6.4.5, “MySQL Enterprise Audit”</a>.
          </p></li><li class="listitem"><p><a name="priv_backup-admin"></a>
            <a class="link" href="security.html#priv_backup-admin"><code class="literal">BACKUP_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724681920"></a><a class="indexterm" name="idm140091724680432"></a><p>
            Enables execution of the <a class="link" href="sql-syntax.html#lock-instance-for-backup" title="13.3.5 LOCK INSTANCE FOR BACKUP and UNLOCK INSTANCE Syntax"><code class="literal">LOCK INSTANCE
            FOR BACKUP</code></a> statement and access to the Performance
            Schema <a class="link" href="performance-schema.html#log-status-table" title="26.12.17.3 The log_status Table"><code class="literal">log_status</code></a> table.
          </p><p>
            The <a class="link" href="security.html#priv_backup-admin"><code class="literal">BACKUP_ADMIN</code></a> privilege is
            automatically granted to users with the
            <a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a> privilege when
            performing an in-place upgrade to MySQL 8.0
            from an earlier version.
          </p></li><li class="listitem"><p><a name="priv_binlog-admin"></a>
            <a class="link" href="security.html#priv_binlog-admin"><code class="literal">BINLOG_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724670752"></a><a class="indexterm" name="idm140091724669264"></a><p>
            Enables binary log control by means of the
            <a class="link" href="sql-syntax.html#purge-binary-logs" title="13.4.1.1 PURGE BINARY LOGS Syntax"><code class="literal">PURGE BINARY LOGS</code></a> and
            <a class="link" href="sql-syntax.html#binlog" title="13.7.7.1 BINLOG Syntax"><code class="literal">BINLOG</code></a> statements.
          </p></li><li class="listitem"><p><a name="priv_binlog-encryption-admin"></a>
            <a class="link" href="security.html#priv_binlog-encryption-admin"><code class="literal">BINLOG_ENCRYPTION_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724662816"></a><a class="indexterm" name="idm140091724661328"></a><p>
            Enables setting the system variable
            <a class="link" href="replication.html#sysvar_binlog_encryption"><code class="literal">binlog_encryption</code></a>, which
            activates or deactivates encryption for binary log files and
            relay log files. This ability is not provided by the
            <a class="link" href="security.html#priv_binlog-admin"><code class="literal">BINLOG_ADMIN</code></a>,
            <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a>, or
            <a class="link" href="security.html#priv_session-variables-admin"><code class="literal">SESSION_VARIABLES_ADMIN</code></a>
            privileges. The related system variable
            <a class="link" href="replication.html#sysvar_binlog_rotate_encryption_master_key_at_startup"><code class="literal">binlog_rotate_encryption_master_key_at_startup</code></a>,
            which rotates the binary log master key automatically when
            the server is restarted, does not require this privilege.
          </p></li><li class="listitem"><p><a name="priv_connection-admin"></a>
            <a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724650736"></a><a class="indexterm" name="idm140091724649248"></a><p>
            Enables use of the <a class="link" href="sql-syntax.html#kill" title="13.7.7.4 KILL Syntax"><code class="literal">KILL</code></a>
            statement or <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin kill</strong></span></a> command to
            kill threads belonging to other accounts. (An account can
            always kill its own threads.)
          </p><p>
            Enables setting system variables related to client
            connections, or circumventing restrictions related to client
            connections. <a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a>
            applies to the effects of these system variables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="server-administration.html#sysvar_init_connect"><code class="literal">init_connect</code></a>: The
                server does not execute
                <a class="link" href="server-administration.html#sysvar_init_connect"><code class="literal">init_connect</code></a> system
                variable content when
                <a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a> clients
                connect.
              </p></li><li class="listitem"><p>
                <a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>: The
                server accepts one connection from a
                <a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a> client
                even if the connection limit configured by the
                <a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a> system
                variable is reached.
              </p></li><li class="listitem"><p>
                <a class="link" href="server-administration.html#sysvar_offline_mode"><code class="literal">offline_mode</code></a>: A server
                in offline mode
                (<a class="link" href="server-administration.html#sysvar_offline_mode"><code class="literal">offline_mode</code></a> enabled)
                does not terminate
                <a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a> client
                connections at the next client request, and accepts new
                connections from
                <a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a> clients.
              </p></li><li class="listitem"><p>
                <a class="link" href="server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a>: Updates can
                be performed even when the
                <a class="link" href="server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a> system
                variable is enabled. This applies to explicit table
                updates, and to use of account-management statements
                such as <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
                <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> that update tables
                implicitly.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="priv_encryption-key-admin"></a>
            <a class="link" href="security.html#priv_encryption-key-admin"><code class="literal">ENCRYPTION_KEY_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724616640"></a><a class="indexterm" name="idm140091724615152"></a><p>
            Enables <code class="literal">InnoDB</code> encryption key rotation.
          </p></li><li class="listitem"><p><a name="priv_firewall-admin"></a>
            <a class="link" href="security.html#priv_firewall-admin"><code class="literal">FIREWALL_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724610560"></a><a class="indexterm" name="idm140091724609072"></a><p>
            Enables a user to administer firewall rules for any user.
            This privilege is defined by the
            <code class="literal">MYSQL_FIREWALL</code> plugin; see
            <a class="xref" href="security.html#firewall" title="6.4.7 MySQL Enterprise Firewall">Section 6.4.7, “MySQL Enterprise Firewall”</a>.
          </p></li><li class="listitem"><p><a name="priv_firewall-user"></a>
            <a class="link" href="security.html#priv_firewall-user"><code class="literal">FIREWALL_USER</code></a>
          </p><a class="indexterm" name="idm140091724603712"></a><a class="indexterm" name="idm140091724602224"></a><p>
            Enables users to update their own firewall rules. This
            privilege is defined by the
            <code class="literal">MYSQL_FIREWALL</code> plugin; see
            <a class="xref" href="security.html#firewall" title="6.4.7 MySQL Enterprise Firewall">Section 6.4.7, “MySQL Enterprise Firewall”</a>.
          </p></li><li class="listitem"><p><a name="priv_group-replication-admin"></a>
            <a class="link" href="security.html#priv_group-replication-admin"><code class="literal">GROUP_REPLICATION_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724596704"></a><a class="indexterm" name="idm140091724595216"></a><p>
            Enables the account to start and stop Group Replication
            using the <a class="link" href="sql-syntax.html#start-group-replication" title="13.4.3.1 START GROUP_REPLICATION Syntax"><code class="literal">START GROUP
            REPLICATION</code></a> and <a class="link" href="sql-syntax.html#stop-group-replication" title="13.4.3.2 STOP GROUP_REPLICATION Syntax"><code class="literal">STOP GROUP
            REPLICATION</code></a> statements, to change the global
            setting for the
            <a class="link" href="group-replication.html#sysvar_group_replication_consistency"><code class="literal">group_replication_consistency</code></a>
            system variable, and to use the
            <a class="link" href="sql-syntax.html#udf_group-replication-set-write-concurrency"><code class="literal">group_replication_set_write_concurrency()</code></a>
            and
            <a class="link" href="sql-syntax.html#udf_group-replication-set-communication-protocol"><code class="literal">group_replication_set_communication_protocol()</code></a>
            UDFs. Grant this privilege to accounts that are used to
            administer servers that are members of a replication group.
          </p></li><li class="listitem"><p><a name="priv_persist-ro-variables-admin"></a>
            <a class="link" href="security.html#priv_persist-ro-variables-admin"><code class="literal">PERSIST_RO_VARIABLES_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724583872"></a><a class="indexterm" name="idm140091724582368"></a><p>
            For users who also have
            <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a>,
            <a class="link" href="security.html#priv_persist-ro-variables-admin"><code class="literal">PERSIST_RO_VARIABLES_ADMIN</code></a>
            enables use of
            <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
            PERSIST_ONLY</code></a> to persist global system variables to
            the <code class="filename">mysqld-auto.cnf</code> option file in the
            data directory. This statement is similar to
            <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
            PERSIST</code></a> but does not modify the runtime global
            system variable value. This makes
            <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
            PERSIST_ONLY</code></a> suitable for configuring read-only
            system variables that can be set only at server startup.
          </p><p>
            See also <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>.
          </p></li><li class="listitem"><p><a name="priv_replication-slave-admin"></a>
            <a class="link" href="security.html#priv_replication-slave-admin"><code class="literal">REPLICATION_SLAVE_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724569888"></a><a class="indexterm" name="idm140091724568400"></a><p>
            Enables the account to connect to the master server, start
            and stop replication using the <a class="link" href="sql-syntax.html#start-slave" title="13.4.2.6 START SLAVE Syntax"><code class="literal">START
            SLAVE</code></a> and <a class="link" href="sql-syntax.html#stop-slave" title="13.4.2.7 STOP SLAVE Syntax"><code class="literal">STOP
            SLAVE</code></a> statements, and use the
            <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1 CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER TO</code></a> and
            <a class="link" href="sql-syntax.html#change-replication-filter" title="13.4.2.2 CHANGE REPLICATION FILTER Syntax"><code class="literal">CHANGE REPLICATION FILTER</code></a>
            statements. Grant this privilege to accounts that are used
            by slave servers to connect to the current server as their
            master. This privilege does not apply to Group Replication;
            use <code class="literal">GROUP_REPLICATION_ADMIN</code> for that.
          </p></li><li class="listitem"><p><a name="priv_resource-group-admin"></a>
            <a class="link" href="security.html#priv_resource-group-admin"><code class="literal">RESOURCE_GROUP_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724558416"></a><a class="indexterm" name="idm140091724556928"></a><p>
            Enables resource group management, consisting of creating,
            altering, and dropping resource groups, and assignment of
            threads and statements to resource groups. A user with this
            privilege can perform any operation relating to resource
            groups.
          </p></li><li class="listitem"><p><a name="priv_resource-group-user"></a>
            <a class="link" href="security.html#priv_resource-group-user"><code class="literal">RESOURCE_GROUP_USER</code></a>
          </p><a class="indexterm" name="idm140091724552656"></a><a class="indexterm" name="idm140091724551168"></a><p>
            Enables assigning threads and statements to resource groups.
            A user with this privilege can use the
            <a class="link" href="sql-syntax.html#set-resource-group" title="13.7.2.4 SET RESOURCE GROUP Syntax"><code class="literal">SET RESOURCE GROUP</code></a> statement
            and the <a class="link" href="optimization.html#optimizer-hints-resource-group" title="Resource Group Hint Syntax"><code class="literal">RESOURCE_GROUP</code></a>
            optimizer hint.
          </p></li><li class="listitem"><p><a name="priv_role-admin"></a>
            <a class="link" href="security.html#priv_role-admin"><code class="literal">ROLE_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724544304"></a><a class="indexterm" name="idm140091724542816"></a><p>
            Enables granting and revoking roles, use of the
            <code class="literal">WITH ADMIN OPTION</code> clause of the
            <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statement, and nonempty
            <code class="literal">&lt;graphml&gt;</code> element content in the
            result from the
            <a class="link" href="functions.html#function_roles-graphml"><code class="literal">ROLES_GRAPHML()</code></a> function.
            Required to set the value of the
            <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system
            variable.
          </p></li><li class="listitem"><p><a name="priv_service-connection-admin"></a>
            <a class="link" href="security.html#priv_service-connection-admin"><code class="literal">SERVICE_CONNECTION_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724533312"></a><a class="indexterm" name="idm140091724531808"></a><p>
            Enables connections to the network interface that permits
            only administrative connections (see
            <a class="xref" href="optimization.html#client-connections" title="8.12.4.1 How MySQL Handles Client Connections">Section 8.12.4.1, “How MySQL Handles Client Connections”</a>).
          </p></li><li class="listitem"><p><a name="priv_session-variables-admin"></a>
            <a class="link" href="security.html#priv_session-variables-admin"><code class="literal">SESSION_VARIABLES_ADMIN</code></a>
            (added in MySQL 8.0.14)
          </p><a class="indexterm" name="idm140091724526944"></a><a class="indexterm" name="idm140091724525456"></a><p>
            For most system variables, setting the session value
            requires no special privileges and can be done by any user
            to affect the current session. For some system variables,
            setting the session value can have effects outside the
            current session and thus is a restricted operation. For
            these, the
            <a class="link" href="security.html#priv_session-variables-admin"><code class="literal">SESSION_VARIABLES_ADMIN</code></a>
            privilege enables the user to set the session value.
          </p><p>
            If a system variable is restricted and requires a special
            privilege to set the session value, the variable description
            indicates that restriction. Examples include
            <a class="link" href="replication.html#sysvar_binlog_format"><code class="literal">binlog_format</code></a>,
            <a class="link" href="replication.html#sysvar_sql_log_bin"><code class="literal">sql_log_bin</code></a>, and
            <a class="link" href="server-administration.html#sysvar_sql_log_off"><code class="literal">sql_log_off</code></a>.
          </p><p>
            Prior to MySQL 8.0.14 when
            <a class="link" href="security.html#priv_session-variables-admin"><code class="literal">SESSION_VARIABLES_ADMIN</code></a> was
            added, restricted session system variables can be set only
            by users who have the
            <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a> or
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege.
          </p><p>
            The <a class="link" href="security.html#priv_session-variables-admin"><code class="literal">SESSION_VARIABLES_ADMIN</code></a>
            privilege is a subset of the
            <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a> and
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privileges. A user who
            has either of those privileges is also permitted to set
            restricted session variables and effectively has
            <a class="link" href="security.html#priv_session-variables-admin"><code class="literal">SESSION_VARIABLES_ADMIN</code></a> by
            implication and need not be granted
            <a class="link" href="security.html#priv_session-variables-admin"><code class="literal">SESSION_VARIABLES_ADMIN</code></a>
            explicitly.
          </p><p>
            See also <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>.
          </p></li><li class="listitem"><p><a name="priv_set-user-id"></a>
            <a class="link" href="security.html#priv_set-user-id"><code class="literal">SET_USER_ID</code></a>
          </p><a class="indexterm" name="idm140091724503216"></a><a class="indexterm" name="idm140091724501728"></a><p>
            Enables setting the effective authorization ID when
            executing a view or stored program. A user with this
            privilege can specify any account in the
            <code class="literal">DEFINER</code> attribute of a view or stored
            program.
          </p></li><li class="listitem"><p><a name="priv_system-user"></a>
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> (added in MySQL
            8.0.16)
          </p><a class="indexterm" name="idm140091724496832"></a><a class="indexterm" name="idm140091724495344"></a><p>
            The <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege
            distinguishes system users from regular users:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                A user with the
                <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege is
                a system user.
              </p></li><li class="listitem"><p>
                A user without the
                <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege is
                a regular user.
</p></li></ul>
</div>
<p>
            The <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege has
            an effect on the accounts to which a given user can apply
            its other privileges, as well as whether the user is
            protected from other accounts:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                A system user can modify both system and regular
                accounts. That is, a user who has the appropriate
                privileges to perform a given operation on regular
                accounts is enabled by possession of
                <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> to also
                perform the operation on system accounts. A system
                account can be modified only by system users with
                appropriate privileges, not by regular users.
              </p></li><li class="listitem"><p>
                A regular user with appropriate privileges can modify
                regular accounts, but not system accounts. A regular
                account can be modified by both system and regular users
                with appropriate privileges.
</p></li></ul>
</div>
<p>
            For more information, see
            <a class="xref" href="security.html#account-categories" title="6.2.11 Account Categories">Section 6.2.11, “Account Categories”</a>.
          </p><p>
            The protection against modification by regular accounts that
            is afforded to system accounts by the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege does
            not apply to regular accounts that have privileges on the
            <code class="literal">mysql</code> system schema and thus can directly
            modify the grant tables in that schema. For full protection,
            do not grant <code class="literal">mysql</code> schema privileges to
            regular accounts. See
            <a class="xref" href="security.html#protecting-system-accounts" title="Protecting System Accounts Against Manipulation by Regular Accounts">Protecting System Accounts Against Manipulation by Regular Accounts</a>.
          </p></li><li class="listitem"><p><a name="priv_system-variables-admin"></a>
            <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724474208"></a><a class="indexterm" name="idm140091724472720"></a><p>
            Affects the following operations and server behaviors:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Enables system variable changes at runtime:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                    Enables server configuration changes to global
                    system variables with
                    <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
                    GLOBAL</code></a> and
                    <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
                    PERSIST</code></a>.
                  </p></li><li class="listitem"><p>
                    Enables server configuration changes to global
                    system variables with
                    <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
                    PERSIST_ONLY</code></a>, if the user also has
                    <a class="link" href="security.html#priv_persist-ro-variables-admin"><code class="literal">PERSIST_RO_VARIABLES_ADMIN</code></a>.
                  </p></li><li class="listitem"><p>
                    Enables setting restricted session system variables
                    that require a special privilege. In effect,
                    <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a>
                    implies
                    <a class="link" href="security.html#priv_session-variables-admin"><code class="literal">SESSION_VARIABLES_ADMIN</code></a>
                    without explicitly granting
                    <a class="link" href="security.html#priv_session-variables-admin"><code class="literal">SESSION_VARIABLES_ADMIN</code></a>.
</p></li></ul>
</div>
<p>
                See also <a class="xref" href="server-administration.html#system-variable-privileges" title="5.1.9.1 System Variable Privileges">Section 5.1.9.1, “System Variable Privileges”</a>.
              </p></li><li class="listitem"><p>
                Enables changes to global transaction characteristics
                (see <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.7 SET TRANSACTION Syntax">Section 13.3.7, “SET TRANSACTION Syntax”</a>).
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="priv_table-encryption-admin"></a>
            <a class="link" href="security.html#priv_table-encryption-admin"><code class="literal">TABLE_ENCRYPTION_ADMIN</code></a> (added
            in MySQL 8.0.16)
          </p><a class="indexterm" name="idm140091724452592"></a><a class="indexterm" name="idm140091724451104"></a><p>
            Enables a user to override default encryption settings when
            <a class="link" href="server-administration.html#sysvar_table_encryption_privilege_check"><code class="literal">table_encryption_privilege_check</code></a>
            is enabled; see
            <a class="xref" href="innodb-storage-engine.html#innodb-schema-tablespace-encryption-default" title="Defining an Encryption Default for Schemas and General Tablespaces">Defining an Encryption Default for Schemas and General Tablespaces</a>.
          </p></li><li class="listitem"><p><a name="priv_version-token-admin"></a>
            <a class="link" href="security.html#priv_version-token-admin"><code class="literal">VERSION_TOKEN_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724445088"></a><a class="indexterm" name="idm140091724443600"></a><p>
            Enables execution of Version Tokens user-defined functions.
            This privilege is defined by the
            <code class="literal">version_tokens</code> plugin; see
            <a class="xref" href="server-administration.html#version-tokens" title="5.6.6 Version Tokens">Section 5.6.6, “Version Tokens”</a>.
          </p></li><li class="listitem"><p><a name="priv_xa-recover-admin"></a>
            <a class="link" href="security.html#priv_xa-recover-admin"><code class="literal">XA_RECOVER_ADMIN</code></a>
          </p><a class="indexterm" name="idm140091724438288"></a><a class="indexterm" name="idm140091724436800"></a><p>
            Enables execution of the
            <a class="link" href="sql-syntax.html#xa-statements" title="13.3.8.1 XA Transaction SQL Syntax"><code class="literal">XA
            RECOVER</code></a> statement; see
            <a class="xref" href="sql-syntax.html#xa-statements" title="13.3.8.1 XA Transaction SQL Syntax">Section 13.3.8.1, “XA Transaction SQL Syntax”</a>.
          </p><p>
            Prior to MySQL 8.0, any user could execute the
            <a class="link" href="sql-syntax.html#xa-statements" title="13.3.8.1 XA Transaction SQL Syntax"><code class="literal">XA
            RECOVER</code></a> statement to discover the XID values for
            outstanding prepared XA transactions, possibly leading to
            commit or rollback of an XA transaction by a user other than
            the one who started it. In MySQL 8.0,
            <a class="link" href="sql-syntax.html#xa-statements" title="13.3.8.1 XA Transaction SQL Syntax"><code class="literal">XA
            RECOVER</code></a> is permitted only to users who have the
            <a class="link" href="security.html#priv_xa-recover-admin"><code class="literal">XA_RECOVER_ADMIN</code></a> privilege,
            which is expected to be granted only to administrative users
            who have need for it. This might be the case, for example,
            for administrators of an XA application if it has crashed
            and it is necessary to find outstanding transactions started
            by the application so they can be rolled back. This
            privilege requirement prevents users from discovering the
            XID values for outstanding prepared XA transactions other
            than their own. It does not affect normal commit or rollback
            of an XA transaction because the user who started it knows
            its XID.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="privileges-provided-guidelines"></a>Privilege-Granting Guidelines</h4>

</div>

</div>

</div>
<p>
        It is a good idea to grant to an account only those privileges
        that it needs. You should exercise particular caution in
        granting the <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> and
        administrative privileges:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> can be abused to read
            into a database table any files that the MySQL server can
            read on the server host. This includes all world-readable
            files and files in the server's data directory. The table
            can then be accessed using
            <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> to transfer its
            contents to the client host.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#priv_grant-option"><code class="literal">GRANT OPTION</code></a> enables users to
            give their privileges to other users. Two users that have
            different privileges and with the <a class="link" href="security.html#priv_grant-option"><code class="literal">GRANT
            OPTION</code></a> privilege are able to combine privileges.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#priv_alter"><code class="literal">ALTER</code></a> may be used to subvert
            the privilege system by renaming tables.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a> can be abused to
            deny service to other users entirely by terminating the
            server.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> can be used to view
            the plain text of currently executing statements, including
            statements that set or change passwords.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> can be used to
            terminate other sessions or change how the server operates.
          </p></li><li class="listitem"><p>
            Privileges granted for the <code class="literal">mysql</code> system
            database itself can be used to change passwords and other
            access privilege information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Passwords are stored encrypted, so a malicious user
                cannot simply read them to know the plain text password.
                However, a user with write access to the
                <code class="literal">mysql.user</code> system table
                <code class="literal">authentication_string</code> column can
                change an account's password, and then connect to the
                MySQL server using that account.
              </p></li><li class="listitem"><p>
                <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> or
                <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a> granted for the
                <code class="literal">mysql</code> system database enable a user
                to add privileges or modify existing privileges,
                respectively.
              </p></li><li class="listitem"><p>
                <a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a> for the
                <code class="literal">mysql</code> system database enables a user
                to remote privilege tables, or even the database itself.
</p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="static-dynamic-privileges"></a>Static Versus Dynamic Privileges</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091724396416"></a><a class="indexterm" name="idm140091724394928"></a><a class="indexterm" name="idm140091724393856"></a><p>
        MySQL supports static and dynamic privileges:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Static privileges are built in to the server. They are
            always available to be granted to user accounts and cannot
            be unregistered.
          </p></li><li class="listitem"><p>
            Dynamic privileges can be registered and unregistered at
            runtime. This affects their availability: A dynamic
            privilege that has not been registered cannot be granted.
</p></li></ul>
</div>
<p>
        For example, the <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> and
        <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> privileges are static and
        always available, whereas a dynamic privilege becomes available
        only if the server component that implements it has been
        enabled.
      </p><p>
        The remainder of this section describes how dynamic privileges
        work in MySQL. The discussion uses the term
        <span class="quote">“<span class="quote">components</span>”</span> but applies equally to plugins.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Server administrators should be aware of which server
          components define dynamic privileges. For MySQL distributions,
          documentation of components that define dynamic privileges
          describes those privileges.
        </p><p>
          Third-party components may also define dynamic privileges; an
          administrator should understand those privileges and not
          install components that might conflict or compromise server
          operation. For example, one component conflicts with another
          if both define a privilege with the same name. Component
          developers can reduce the likelihood of this occurrence by
          choosing privilege names having a prefix based on the
          component name.
</p>
</div>
<p>
        The server maintains the set of registered dynamic privileges
        internally in memory. Unregistration occurs at server shutdown.
      </p><p>
        Normally, a server component that defines dynamic privileges
        registers them when it is installed, during its initialization
        sequence. When uninstalled, a server component does not
        unregister its registered dynamic privileges. (This is current
        practice, not a requirement. That is, components could, but do
        not, unregister at any time privileges they register.)
      </p><p>
        No warning or error occurs for attempts to register an already
        registered dynamic privilege. Consider the following sequence of
        statements:
      </p><pre data-lang="sql" class="programlisting">
INSTALL COMPONENT 'my_component';
UNINSTALL COMPONENT 'my_component';
INSTALL COMPONENT 'my_component';
</pre><p>
        The first <a class="link" href="sql-syntax.html#install-component" title="13.7.4.3 INSTALL COMPONENT Syntax"><code class="literal">INSTALL COMPONENT</code></a>
        statement registers any privileges defined by server component
        <code class="literal">my_component</code>, but
        <a class="link" href="sql-syntax.html#uninstall-component" title="13.7.4.5 UNINSTALL COMPONENT Syntax"><code class="literal">UNINSTALL COMPONENT</code></a> does not
        unregister them. For the second <a class="link" href="sql-syntax.html#install-component" title="13.7.4.3 INSTALL COMPONENT Syntax"><code class="literal">INSTALL
        COMPONENT</code></a> statement, the component privileges it
        registers are found to be already registered, but no warnings or
        errors occur.
      </p><a class="indexterm" name="idm140091724375936"></a><a class="indexterm" name="idm140091724374448"></a><a class="indexterm" name="idm140091724372960"></a><p>
        Dynamic privileges apply only at the global level. The server
        stores information about current assignments of dynamic
        privileges to user accounts in the
        <code class="literal">mysql.global_grants</code> system table:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The server automatically registers privileges named in
            <code class="literal">global_grants</code> during server startup
            (unless the
            <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a> option is
            given).
          </p></li><li class="listitem"><p>
            The <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
            <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> statements modify the
            contents of <code class="literal">global_grants</code>.
          </p></li><li class="listitem"><p>
            Dynamic privilege assignments listed in
            <code class="literal">global_grants</code> are persistent. They are
            not removed at server shutdown.
</p></li></ul>
</div>
<p>
        Example: The following statement grants to user
        <code class="literal">u1</code> the privileges required to control
        replication (including Group Replication) on a slave server, and
        to modify system variables:
      </p><pre data-lang="sql" class="programlisting">
GRANT REPLICATION_SLAVE_ADMIN, GROUP_REPLICATION_ADMIN, BINLOG_ADMIN
ON *.* TO 'u1'@'localhost';
</pre><p>
        Granted dynamic privileges appear in the output from the
        <code class="literal">SHOW GRANTS</code> statement and the
        <code class="literal">INFORMATION_SCHEMA</code>
        <a class="link" href="information-schema.html#user-privileges-table" title="25.35 The INFORMATION_SCHEMA USER_PRIVILEGES Table"><code class="literal">USER_PRIVILEGES</code></a> table.
      </p><p>
        For <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
        <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> at the global level, any
        named privileges not recognized as static are checked against
        the current set of registered dynamic privileges and granted if
        found. Otherwise, an error occurs to indicate an unknown
        privilege identifier.
      </p><p>
        For <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
        <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> the meaning of
        <code class="literal">ALL [PRIVILEGES]</code> at the global level includes
        all static global privileges, as well as all currently
        registered dynamic privileges:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">GRANT ALL</code> at the global level grants all
            static global privileges and all currently registered
            dynamic privileges. A dynamic privilege registered
            subsequent to execution of the <code class="literal">GRANT</code>
            statement is not granted retroactively to any account.
          </p></li><li class="listitem"><p>
            <code class="literal">REVOKE ALL</code> at the global level revokes
            all granted static global privileges and all granted dynamic
            privileges.
</p></li></ul>
</div>
<p>
        The <a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a> statement
        reads the <code class="literal">global_grants</code> table for dynamic
        privilege assignments and registers any unregistered privileges
        found there.
      </p><p>
        For descriptions of the dynamic privileges provided by MySQL
        Server and server components included in MySQL distributions,
        see <a class="xref" href="security.html#privileges-provided" title="6.2.2 Privileges Provided by MySQL">Section 6.2.2, “Privileges Provided by MySQL”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="dynamic-privileges-migration-from-super"></a>Migrating Accounts from SUPER to Dynamic Privileges</h4>

</div>

</div>

</div>
<p>
        In MySQL 8.0, many operations that previously
        required the <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege are
        also associated with a dynamic privilege of more limited scope.
        (For descriptions of these privileges, see
        <a class="xref" href="security.html#privileges-provided" title="6.2.2 Privileges Provided by MySQL">Section 6.2.2, “Privileges Provided by MySQL”</a>.) Each such operation can
        be permitted to an account by granting the associated dynamic
        privilege rather than <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>. This
        change improves security by enabling DBAs to avoid granting
        <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> and tailor user privileges
        more closely to the operations permitted.
        <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> is now deprecated and will
        be removed in a future version of MySQL.
      </p><p>
        When removal of <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> occurs,
        operations that formerly required
        <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> will fail unless accounts
        granted <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> are migrated to the
        appropriate dynamic privileges. Use the following instructions
        to accomplish that goal so that accounts are ready prior to
        <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> removal:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Execute this query to identify accounts that are granted
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>:
          </p><pre data-lang="sql" class="programlisting">
SELECT GRANTEE FROM INFORMATION_SCHEMA.USER_PRIVILEGES
WHERE PRIVILEGE_TYPE = 'SUPER';
</pre></li><li class="listitem"><p>
            For each account identified by the preceding query,
            determine the operations for which it needs
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>. Then grant the dynamic
            privileges corresponding to those operations, and revoke
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>.
          </p><p>
            For example, if <code class="literal">'u1'@'localhost'</code> requires
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> for binary log purging
            and system variable modification, these statements make the
            required changes to the account:
          </p><pre data-lang="sql" class="programlisting">
GRANT BINLOG_ADMIN, SYSTEM_VARIABLES_ADMIN ON *.* TO 'u1'@'localhost';
REVOKE SUPER ON *.* FROM 'u1'@'localhost';
</pre><p>
            After you have modified all applicable accounts, the
            <code class="literal">INFORMATION_SCHEMA</code> query in the first
            step should produce an empty result set.
</p></li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="grant-tables"></a>6.2.3 Grant Tables</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091724313616"></a><a class="indexterm" name="idm140091724312128"></a><p>
      The <code class="literal">mysql</code> system database includes several
      grant tables that contain information about user accounts and the
      privileges held by them. This section describes those tables. For
      information about other tables in the system database, see
      <a class="xref" href="server-administration.html#system-schema" title="5.3 The mysql System Schema">Section 5.3, “The mysql System Schema”</a>.
    </p><p>
      The discussion here describes the underlying structure of the
      grant tables and how the server uses their contents when
      interacting with clients. However, normally you do not modify the
      grant tables directly. Modifications occur indirectly when you use
      account-management statements such as <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE
      USER</code></a>, <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>, and
      <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> to set up accounts and
      control the privileges available to each one. See
      <a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>. When you use such
      statements to perform account manipulations, the server modifies
      the grant tables on your behalf.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        Direct modification of grant tables using statements such as
        <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> is discouraged and done at
        your own risk. The server is free to ignore rows that become
        malformed as a result of such modifications.
      </p><p>
        For any operation that modifies a grant table, the server checks
        whether the table has the expected structure and produces an
        error if not. To update the tables to the expected structure,
        perform the MySQL upgrade procedure. See
        <a class="xref" href="installing.html#upgrading" title="2.11 Upgrading MySQL">Section 2.11, “Upgrading MySQL”</a>.
</p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#grant-tables-overview" title="Grant Table Overview">Grant Table Overview</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-user-db" title="The user and db Tables">The user and db Tables</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-tables-priv-columns-priv" title="The tables_priv and columns_priv Tables">The tables_priv and columns_priv Tables</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-procs-priv" title="The procs_priv Table">The procs_priv Table</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-proxies-priv" title="The proxies_priv Table">The proxies_priv Table</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-global-grants" title="The global_grants Table">The global_grants Table</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-default-roles" title="The default_roles Table">The default_roles Table</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-role-edges" title="The role_edges Table">The role_edges Table</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-password-history" title="The password_history Table">The password_history Table</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-scope-column-properties" title="Scope Column Properties">Scope Column Properties</a></p></li><li class="listitem"><p><a class="xref" href="security.html#grant-tables-privilege-column-properties" title="Privilege Column Properties">Privilege Column Properties</a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="grant-tables-overview"></a>Grant Table Overview</h4>

</div>

</div>

</div>
<p>
        These <code class="literal">mysql</code> database tables contain grant
        information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-user-db" title="The user and db Tables"><code class="literal">user</code></a>:
            User accounts, static global privileges, and other
            nonprivilege columns.
          </p><a class="indexterm" name="idm140091724280560"></a><a class="indexterm" name="idm140091724279072"></a><a class="indexterm" name="idm140091724277584"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-global-grants" title="The global_grants Table"><code class="literal">global_grants</code></a>:
            Dynamic global privileges.
          </p><a class="indexterm" name="idm140091724273984"></a><a class="indexterm" name="idm140091724272496"></a><a class="indexterm" name="idm140091724271008"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-user-db" title="The user and db Tables"><code class="literal">db</code></a>:
            Database-level privileges.
          </p><a class="indexterm" name="idm140091724267568"></a><a class="indexterm" name="idm140091724266080"></a><a class="indexterm" name="idm140091724264592"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-tables-priv-columns-priv" title="The tables_priv and columns_priv Tables"><code class="literal">tables_priv</code></a>:
            Table-level privileges.
          </p><a class="indexterm" name="idm140091724260992"></a><a class="indexterm" name="idm140091724259504"></a><a class="indexterm" name="idm140091724258016"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-tables-priv-columns-priv" title="The tables_priv and columns_priv Tables"><code class="literal">columns_priv</code></a>:
            Column-level privileges.
          </p><a class="indexterm" name="idm140091724254464"></a><a class="indexterm" name="idm140091724252976"></a><a class="indexterm" name="idm140091724251488"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-procs-priv" title="The procs_priv Table"><code class="literal">procs_priv</code></a>:
            Stored procedure and function privileges.
          </p><a class="indexterm" name="idm140091724248000"></a><a class="indexterm" name="idm140091724246512"></a><a class="indexterm" name="idm140091724245024"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-proxies-priv" title="The proxies_priv Table"><code class="literal">proxies_priv</code></a>:
            Proxy-user privileges.
          </p><a class="indexterm" name="idm140091724241424"></a><a class="indexterm" name="idm140091724239936"></a><a class="indexterm" name="idm140091724238448"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-default-roles" title="The default_roles Table"><code class="literal">default_roles</code></a>:
            Default user roles.
          </p><a class="indexterm" name="idm140091724234896"></a><a class="indexterm" name="idm140091724233408"></a><a class="indexterm" name="idm140091724231920"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-role-edges" title="The role_edges Table"><code class="literal">role_edges</code></a>:
            Edges for role subgraphs.
          </p><a class="indexterm" name="idm140091724228448"></a><a class="indexterm" name="idm140091724226960"></a><a class="indexterm" name="idm140091724225472"></a></li><li class="listitem"><p>
            <a class="link" href="security.html#grant-tables-password-history" title="The password_history Table"><code class="literal">password_history</code></a>:
            Password change history.
</p><a class="indexterm" name="idm140091724221872"></a><a class="indexterm" name="idm140091724220384"></a><a class="indexterm" name="idm140091724218896"></a></li></ul>
</div>
<p>
        For information about the differences between static and dynamic
        global privileges, see
        <a class="xref" href="security.html#static-dynamic-privileges" title="Static Versus Dynamic Privileges">Static Versus Dynamic Privileges</a>.)
      </p><p>
        In MySQL 8.0, grant tables use the
        <code class="literal">InnoDB</code> storage engine and are transactional.
        Before MySQL 8.0, grant tables used the
        <code class="literal">MyISAM</code> storage engine and were
        nontransactional. This change of grant table storage engine
        enables an accompanying change to the behavior of
        account-management statements such as
        <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>. Previously, an
        account-management statement that named multiple users could
        succeed for some users and fail for others. Now, each statement
        is transactional and either succeeds for all named users or
        rolls back and has no effect if any error occurs.
      </p><p>
        Each grant table contains scope columns and privilege columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Scope columns determine the scope of each row in the tables;
            that is, the context in which the row applies. For example,
            a <code class="literal">user</code> table row with
            <code class="literal">Host</code> and <code class="literal">User</code> values
            of <code class="literal">'h1.example.net'</code> and
            <code class="literal">'bob'</code> applies to authenticating
            connections made to the server from the host
            <code class="literal">h1.example.net</code> by a client that specifies
            a user name of <code class="literal">bob</code>. Similarly, a
            <code class="literal">db</code> table row with
            <code class="literal">Host</code>, <code class="literal">User</code>, and
            <code class="literal">Db</code> column values of
            <code class="literal">'h1.example.net'</code>,
            <code class="literal">'bob'</code> and <code class="literal">'reports'</code>
            applies when <code class="literal">bob</code> connects from the host
            <code class="literal">h1.example.net</code> to access the
            <code class="literal">reports</code> database. The
            <code class="literal">tables_priv</code> and
            <code class="literal">columns_priv</code> tables contain scope columns
            indicating tables or table/column combinations to which each
            row applies. The <code class="literal">procs_priv</code> scope columns
            indicate the stored routine to which each row applies.
          </p></li><li class="listitem"><p>
            Privilege columns indicate which privileges a table row
            grants; that is, which operations it permits to be
            performed. The server combines the information in the
            various grant tables to form a complete description of a
            user's privileges. <a class="xref" href="security.html#request-access" title="6.2.7 Access Control, Stage 2: Request Verification">Section 6.2.7, “Access Control, Stage 2: Request Verification”</a>,
            describes the rules for this.
</p></li></ul>
</div>
<p>
        In addition, a grant table may contain columns used for purposes
        other than scope or privilege assessment.
      </p><p>
        The server uses the grant tables in the following manner:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">user</code> table scope columns determine
            whether to reject or permit incoming connections. For
            permitted connections, any privileges granted in the
            <code class="literal">user</code> table indicate the user's static
            global privileges. Any privileges granted in this table
            apply to <span class="emphasis"><em>all</em></span> databases on the server.
</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p>
              Because any static global privilege is considered a
              privilege for all databases, any static global privilege
              enables a user to see all database names with
              <a class="link" href="sql-syntax.html#show-databases" title="13.7.6.14 SHOW DATABASES Syntax"><code class="literal">SHOW DATABASES</code></a> or by
              examining the <a class="link" href="information-schema.html#schemata-table" title="25.24 The INFORMATION_SCHEMA SCHEMATA Table"><code class="literal">SCHEMATA</code></a> table
              of <code class="literal">INFORMATION_SCHEMA</code>, except databases
              that have been restricted at the database level by partial
              revokes.
</p>
</div>
</li><li class="listitem"><p>
            The <code class="literal">global_grants</code> table lists current
            assignments of dynamic global privileges to user accounts.
            For each row, the scope columns determine which user has the
            privilege named in the privilege column.
          </p></li><li class="listitem"><p>
            The <code class="literal">db</code> table scope columns determine
            which users can access which databases from which hosts. The
            privilege columns determine the permitted operations. A
            privilege granted at the database level applies to the
            database and to all objects in the database, such as tables
            and stored programs.
          </p></li><li class="listitem"><p>
            The <code class="literal">tables_priv</code> and
            <code class="literal">columns_priv</code> tables are similar to the
            <code class="literal">db</code> table, but are more fine-grained: They
            apply at the table and column levels rather than at the
            database level. A privilege granted at the table level
            applies to the table and to all its columns. A privilege
            granted at the column level applies only to a specific
            column.
          </p></li><li class="listitem"><p>
            The <code class="literal">procs_priv</code> table applies to stored
            routines (stored procedures and functions). A privilege
            granted at the routine level applies only to a single
            procedure or function.
          </p></li><li class="listitem"><p>
            The <code class="literal">proxies_priv</code> table indicates which
            users can act as proxies for other users and whether a user
            can grant the <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege
            to other users.
          </p></li><li class="listitem"><p>
            The <code class="literal">default_roles</code> and
            <code class="literal">role_edges</code> tables contain information
            about role relationships.
          </p></li><li class="listitem"><p>
            The <code class="literal">password_history</code> table retains
            previously chosen passwords to enable restrictions on
            password reuse. See <a class="xref" href="security.html#password-management" title="6.2.15 Password Management">Section 6.2.15, “Password Management”</a>.
</p></li></ul>
</div>
<p>
        The server reads the contents of the grant tables into memory
        when it starts. You can tell it to reload the tables by issuing
        a <a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a> statement or
        executing a <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-privileges</strong></span></a> or
        <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin reload</strong></span></a> command. Changes to the
        grant tables take effect as indicated in
        <a class="xref" href="security.html#privilege-changes" title="6.2.13 When Privilege Changes Take Effect">Section 6.2.13, “When Privilege Changes Take Effect”</a>.
      </p><p>
        When you modify an account, it is a good idea to verify that
        your changes have the intended effect. To check the privileges
        for a given account, use the <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW
        GRANTS</code></a> statement. For example, to determine the
        privileges that are granted to an account with user name and
        host name values of <code class="literal">bob</code> and
        <code class="literal">pc84.example.com</code>, use this statement:
      </p><pre data-lang="sql" class="programlisting">
SHOW GRANTS FOR 'bob'@'pc84.example.com';
</pre><p>
        To display nonprivilege properties of an account, use
        <a class="link" href="sql-syntax.html#show-create-user" title="13.7.6.12 SHOW CREATE USER Syntax"><code class="literal">SHOW CREATE USER</code></a>:
      </p><pre data-lang="sql" class="programlisting">
SHOW CREATE USER 'bob'@'pc84.example.com';
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="grant-tables-user-db"></a>The user and db Tables</h4>

</div>

</div>

</div>
<p>
        The server uses the <code class="literal">user</code> and
        <code class="literal">db</code> tables in the <code class="literal">mysql</code>
        database at both the first and second stages of access control
        (see <a class="xref" href="security.html#access-control" title="6.2 Access Control and Account Management">Section 6.2, “Access Control and Account Management”</a>). The columns in the
        <code class="literal">user</code> and <code class="literal">db</code> tables are
        shown here.
</p>
<div class="table">
<a name="idm140091724149792"></a><p class="title"><b>Table 6.4 user and db Table Columns</b></p>
<div class="table-contents">
<table><col width="40%"><col width="30%"><col width="30%"><thead><tr>
            <th scope="col">Table Name</th>
            <th scope="col"><code class="literal">user</code></th>
            <th scope="col"><code class="literal">db</code></th>
          </tr></thead><tbody><tr>
            <td scope="row"><span class="bold"><strong>Scope columns</strong></span></td>
            <td><code class="literal">Host</code></td>
            <td><code class="literal">Host</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">User</code></td>
            <td><code class="literal">Db</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td></td>
            <td><code class="literal">User</code></td>
          </tr><tr>
            <td scope="row"><span class="bold"><strong>Privilege columns</strong></span></td>
            <td><code class="literal">Select_priv</code></td>
            <td><code class="literal">Select_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Insert_priv</code></td>
            <td><code class="literal">Insert_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Update_priv</code></td>
            <td><code class="literal">Update_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Delete_priv</code></td>
            <td><code class="literal">Delete_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Index_priv</code></td>
            <td><code class="literal">Index_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Alter_priv</code></td>
            <td><code class="literal">Alter_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Create_priv</code></td>
            <td><code class="literal">Create_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Drop_priv</code></td>
            <td><code class="literal">Drop_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Grant_priv</code></td>
            <td><code class="literal">Grant_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Create_view_priv</code></td>
            <td><code class="literal">Create_view_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Show_view_priv</code></td>
            <td><code class="literal">Show_view_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Create_routine_priv</code></td>
            <td><code class="literal">Create_routine_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Alter_routine_priv</code></td>
            <td><code class="literal">Alter_routine_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Execute_priv</code></td>
            <td><code class="literal">Execute_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Trigger_priv</code></td>
            <td><code class="literal">Trigger_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Event_priv</code></td>
            <td><code class="literal">Event_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Create_tmp_table_priv</code></td>
            <td><code class="literal">Create_tmp_table_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Lock_tables_priv</code></td>
            <td><code class="literal">Lock_tables_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">References_priv</code></td>
            <td><code class="literal">References_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Reload_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Shutdown_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Process_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">File_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Show_db_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Super_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Repl_slave_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Repl_client_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Create_user_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Create_tablespace_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Create_role_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Drop_role_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"><span class="bold"><strong>Security columns</strong></span></td>
            <td><code class="literal">ssl_type</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">ssl_cipher</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">x509_issuer</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">x509_subject</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">plugin</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">authentication_string</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">password_expired</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">password_last_changed</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">password_lifetime</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">account_locked</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Password_reuse_history</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Password_reuse_time</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Password_require_current</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">User_attributes</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"><span class="bold"><strong>Resource control columns</strong></span></td>
            <td><code class="literal">max_questions</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">max_updates</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">max_connections</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">max_user_connections</code></td>
            <td></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The <code class="literal">user</code> table <code class="literal">plugin</code> and
        <code class="literal">authentication_string</code> columns store
        authentication plugin and credential information.
      </p><p>
        The server uses the plugin named in the
        <code class="literal">plugin</code> column of an account row to
        authenticate connection attempts for the account.
      </p><p>
        The <code class="literal">plugin</code> column must be nonempty. At
        startup, and at runtime when <a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH
        PRIVILEGES</code></a> is executed, the server checks
        <code class="literal">user</code> table rows. For any row with an empty
        <code class="literal">plugin</code> column, the server writes a warning to
        the error log of this form:
      </p><pre data-lang="none" class="programlisting">
[Warning] User entry '<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>' has an empty plugin
value. The user will be ignored and no one can login with this user
anymore.
</pre><p>
        To assign a plugin to an account that is missing one, use the
        <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> statement.
      </p><p>
        The <code class="literal">password_expired</code> column permits DBAs to
        expire account passwords and require users to reset their
        password. The default <code class="literal">password_expired</code> value
        is <code class="literal">'N'</code>, but can be set to
        <code class="literal">'Y'</code> with the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER
        USER</code></a> statement. After an account's password has been
        expired, all operations performed by the account in subsequent
        connections to the server result in an error until the user
        issues an <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> statement to
        establish a new account password.
      </p><p>
        It is possible after password expiration to <span class="quote">“<span class="quote">reset</span>”</span>
        a password by setting it to its current value. As a matter of
        good policy, it is preferable to choose a different password.
        DBAs can enforce non-reuse by establishing an appropriate
        password-reuse policy. See
        <a class="xref" href="security.html#password-reuse-policy" title="Password Reuse Policy">Password Reuse Policy</a>.
      </p><p>
        <code class="literal">password_last_changed</code> is a
        <code class="literal">TIMESTAMP</code> column indicating when the password
        was last changed. The value is non-<code class="literal">NULL</code> only
        for accounts that use a MySQL built-in authentication plugin
        (<code class="literal">mysql_native_password</code>,
        <code class="literal">sha256_password</code>, or
        <code class="literal">caching_sha2_password</code>). The value is
        <code class="literal">NULL</code> for other accounts, such as those
        authenticated using an external authentication system.
      </p><p>
        <code class="literal">password_last_changed</code> is updated by the
        <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
        <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>, and
        <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> statements, and by
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statements that create an
        account or change an account password.
      </p><p>
        <code class="literal">password_lifetime</code> indicates the account
        password lifetime, in days. If the password is past its lifetime
        (assessed using the <code class="literal">password_last_changed</code>
        column), the server considers the password expired when clients
        connect using the account. A value of
        <em class="replaceable"><code>N</code></em> greater than zero means that the
        password must be changed every <em class="replaceable"><code>N</code></em>
        days. A value of 0 disables automatic password expiration. If
        the value is <code class="literal">NULL</code> (the default), the global
        expiration policy applies, as defined by the
        <a class="link" href="server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a>
        system variable.
      </p><a class="indexterm" name="idm140091723914480"></a><a class="indexterm" name="idm140091723913408"></a><a class="indexterm" name="idm140091723911920"></a><p>
        <code class="literal">account_locked</code> indicates whether the account
        is locked (see <a class="xref" href="security.html#account-locking" title="6.2.19 Account Locking">Section 6.2.19, “Account Locking”</a>).
      </p><p>
        <code class="literal">Password_reuse_history</code> is the value of the
        <code class="literal">PASSWORD HISTORY</code> option for the account, or
        <code class="literal">NULL</code> for the default history.
      </p><p>
        <code class="literal">Password_reuse_time</code> is the value of the
        <code class="literal">PASSWORD REUSE INTERVAL</code> option for the
        account, or <code class="literal">NULL</code> for the default interval.
      </p><p>
        <code class="literal">Password_require_current</code> (added in MySQL
        8.0.13) corresponds to the value of the <code class="literal">PASSWORD
        REQUIRE</code> option for the account, as shown by the
        following table.
</p>
<div class="table">
<a name="password-require-current-values-table"></a><p class="title"><b>Table 6.5 Permitted Password_require_current Values</b></p>
<div class="table-contents">
<table summary="Permitted values of the user.Password_require_current column and how they correspond to PASSWORD REQUIRE options."><col width="50*"><col width="50*"><thead><tr>
            <th scope="col">Password_require_current Value</th>
            <th scope="col">Corresponding PASSWORD REQUIRE Option</th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">'Y'</code></td>
            <td scope="row"><code class="literal">PASSWORD REQUIRE CURRENT</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">'N'</code></td>
            <td scope="row"><code class="literal">PASSWORD REQUIRE CURRENT OPTIONAL</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">NULL</code></td>
            <td scope="row"><code class="literal">PASSWORD REQUIRE CURRENT DEFAULT</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        <code class="literal">User_attributes</code> (added in MySQL 8.0.14)
        stores account attributes not stored in other columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">additional_password</code>: The secondary
            password, if any. See <a class="xref" href="security.html#dual-passwords" title="Dual Password Support">Dual Password Support</a>.
          </p></li><li class="listitem"><p>
            <code class="literal">Restrictions</code>: Restriction lists, if any.
            Restrictions are added by partial-revoke operations. The
            attribute value is an array of elements that each have
            <code class="literal">Database</code> and
            <code class="literal">Restrictions</code> keys indicating the name of
            a restricted database and the applicable restrictions on it
            (see <a class="xref" href="security.html#partial-revokes" title="6.2.12 Privilege Restriction Using Partial Revokes">Section 6.2.12, “Privilege Restriction Using Partial Revokes”</a>).
</p></li></ul>
</div>
<p>
        If no attributes apply, <code class="literal">User_attributes</code> is
        <code class="literal">NULL</code>.
      </p><p>
        Example: An account that has a secondary password and partially
        revoked database privileges has
        <code class="literal">additional_password</code> and
        <code class="literal">Restrictions</code> attributes in the column value:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT User_attributes FROM mysql.User WHERE User = 'u'\G</code></strong>
*************************** 1. row ***************************
User_attributes: {"Restrictions":
                   [{"Database": "mysql", "Privileges": ["SELECT"]}],
                  "additional_password": "<em class="replaceable"><code>hashed_credentials</code></em>"}
</pre><p>
        To determine which attributes are present, use the
        <a class="link" href="functions.html#function_json-keys"><code class="literal">JSON_KEYS()</code></a> function:
      </p><pre data-lang="sql" class="programlisting">
SELECT User, Host, JSON_KEYS(User_attributes)
FROM mysql.user WHERE User_attributes IS NOT NULL;
</pre><p>
        To extract a particular attribute, such as
        <code class="literal">Restrictions</code>, do this:
      </p><pre data-lang="sql" class="programlisting">
SELECT User, Host, User_attributes-&gt;&gt;'$.Restrictions'
FROM mysql.user WHERE User_attributes-&gt;&gt;'$.Restrictions' &lt;&gt; '';

</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="grant-tables-tables-priv-columns-priv"></a>The tables_priv and columns_priv Tables</h4>

</div>

</div>

</div>
<p>
        During the second stage of access control, the server performs
        request verification to ensure that each client has sufficient
        privileges for each request that it issues. In addition to the
        <code class="literal">user</code> and <code class="literal">db</code> grant tables,
        the server may also consult the <code class="literal">tables_priv</code>
        and <code class="literal">columns_priv</code> tables for requests that
        involve tables. The latter tables provide finer privilege
        control at the table and column levels. They have the columns
        shown in the following table.
</p>
<div class="table">
<a name="idm140091723860224"></a><p class="title"><b>Table 6.6 tables_priv and columns_priv Table Columns</b></p>
<div class="table-contents">
<table><col width="20%"><col width="20%"><col width="20%"><thead><tr>
            <th scope="col">Table Name</th>
            <th scope="col"><code class="literal">tables_priv</code></th>
            <th scope="col"><code class="literal">columns_priv</code></th>
          </tr></thead><tbody><tr>
            <td scope="row"><span class="bold"><strong>Scope columns</strong></span></td>
            <td><code class="literal">Host</code></td>
            <td><code class="literal">Host</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Db</code></td>
            <td><code class="literal">Db</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">User</code></td>
            <td><code class="literal">User</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Table_name</code></td>
            <td><code class="literal">Table_name</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td></td>
            <td><code class="literal">Column_name</code></td>
          </tr><tr>
            <td scope="row"><span class="bold"><strong>Privilege columns</strong></span></td>
            <td><code class="literal">Table_priv</code></td>
            <td><code class="literal">Column_priv</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Column_priv</code></td>
            <td></td>
          </tr><tr>
            <td scope="row"><span class="bold"><strong>Other columns</strong></span></td>
            <td><code class="literal">Timestamp</code></td>
            <td><code class="literal">Timestamp</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Grantor</code></td>
            <td></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The <code class="literal">Timestamp</code> and <code class="literal">Grantor</code>
        columns are set to the current timestamp and the
        <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER</code></a> value, respectively,
        but are otherwise unused.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="grant-tables-procs-priv"></a>The procs_priv Table</h4>

</div>

</div>

</div>
<p>
        For verification of requests that involve stored routines, the
        server may consult the <code class="literal">procs_priv</code> table,
        which has the columns shown in the following table.
</p>
<div class="table">
<a name="idm140091723810624"></a><p class="title"><b>Table 6.7 procs_priv Table Columns</b></p>
<div class="table-contents">
<table><col width="20%"><col width="20%"><thead><tr>
            <th scope="col">Table Name</th>
            <th scope="col"><code class="literal">procs_priv</code></th>
          </tr></thead><tbody><tr>
            <td scope="row"><span class="bold"><strong>Scope columns</strong></span></td>
            <td><code class="literal">Host</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Db</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">User</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Routine_name</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Routine_type</code></td>
          </tr><tr>
            <td scope="row"><span class="bold"><strong>Privilege columns</strong></span></td>
            <td><code class="literal">Proc_priv</code></td>
          </tr><tr>
            <td scope="row"><span class="bold"><strong>Other columns</strong></span></td>
            <td><code class="literal">Timestamp</code></td>
          </tr><tr>
            <td scope="row"></td>
            <td><code class="literal">Grantor</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The <code class="literal">Routine_type</code> column is an
        <a class="link" href="data-types.html#enum" title="11.4.4 The ENUM Type"><code class="literal">ENUM</code></a> column with values of
        <code class="literal">'FUNCTION'</code> or <code class="literal">'PROCEDURE'</code>
        to indicate the type of routine the row refers to. This column
        enables privileges to be granted separately for a function and a
        procedure with the same name.
      </p><p>
        The <code class="literal">Timestamp</code> and <code class="literal">Grantor</code>
        columns are unused.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="grant-tables-proxies-priv"></a>The proxies_priv Table</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">proxies_priv</code> table records information
        about proxy accounts. It has these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Host</code>, <code class="literal">User</code>: The proxy
            account; that is, the account that has the
            <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for the
            proxied account.
          </p></li><li class="listitem"><p>
            <code class="literal">Proxied_host</code>,
            <code class="literal">Proxied_user</code>: The proxied account.
          </p></li><li class="listitem"><p>
            <code class="literal">Grantor</code>, <code class="literal">Timestamp</code>:
            Unused.
          </p></li><li class="listitem"><p>
            <code class="literal">With_grant</code>: Whether the proxy account can
            grant the <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege to
            other accounts.
</p></li></ul>
</div>
<p>
        For an account to be able to grant the
        <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege to other
        accounts, it must have a row in the
        <code class="literal">proxies_priv</code> table with
        <code class="literal">With_grant</code> set to 1 and
        <code class="literal">Proxied_host</code> and
        <code class="literal">Proxied_user</code> set to indicate the account or
        accounts for which the privilege can be granted. For example,
        the <code class="literal">'root'@'localhost'</code> account created during
        MySQL installation has a row in the
        <code class="literal">proxies_priv</code> table that enables granting the
        <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for
        <code class="literal">''@''</code>, that is, for all users and all hosts.
        This enables <code class="literal">root</code> to set up proxy users, as
        well as to delegate to other accounts the authority to set up
        proxy users. See <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="grant-tables-global-grants"></a>The global_grants Table</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">global_grants</code> table lists current
        assignments of dynamic global privileges to user accounts. The
        table has these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">USER</code>, <code class="literal">HOST</code>: The user
            name and host name of the account to which the privilege is
            granted.
          </p></li><li class="listitem"><p>
            <code class="literal">PRIV</code>: The privilege name.
          </p></li><li class="listitem"><p>
            <code class="literal">WITH_GRANT_OPTION</code>: Whether the account
            can grant the privilege to other accounts.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="grant-tables-default-roles"></a>The default_roles Table</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">default_roles</code> table lists default user
        roles. It has these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">HOST</code>, <code class="literal">USER</code>: The
            account or role to which the default role applies.
          </p></li><li class="listitem"><p>
            <code class="literal">DEFAULT_ROLE_HOST</code>,
            <code class="literal">DEFAULT_ROLE_USER</code>: The default role.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="grant-tables-role-edges"></a>The role_edges Table</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">role_edges</code> table lists edges for role
        subgraphs. It has these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">FROM_HOST</code>, <code class="literal">FROM_USER</code>:
            The account that is granted a role.
          </p></li><li class="listitem"><p>
            <code class="literal">TO_HOST</code>, <code class="literal">TO_USER</code>: The
            role that is granted to the account.
          </p></li><li class="listitem"><p>
            <code class="literal">WITH_ADMIN_OPTION</code>: Whether the account
            can grant the role to and revoke it from other accounts by
            using <code class="literal">WITH ADMIN OPTION</code>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="grant-tables-password-history"></a>The password_history Table</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">password_history</code> table contains
        information about password changes. It has these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Host</code>, <code class="literal">User</code>: The
            account for which the password change occurred.
          </p></li><li class="listitem"><p>
            <code class="literal">Password_timestamp</code>: The time when the
            password change occurred.
          </p></li><li class="listitem"><p>
            <code class="literal">Password</code>: The new password hash value.
</p></li></ul>
</div>
<p>
        The <code class="literal">password_history</code> table accumulates a
        sufficient number of nonempty passwords per account to enable
        MySQL to perform checks against both the account password
        history length and reuse interval. Automatic pruning of entries
        that are outside both limits occurs when password-change
        attempts occur.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The empty password does not count in the password history and
          is subject to reuse at any time.
</p>
</div>
<p>
        If an account is renamed, its entries are renamed to match. If
        an account is dropped or its authentication plugin is changed,
        its entries are removed.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="grant-tables-scope-column-properties"></a>Scope Column Properties</h4>

</div>

</div>

</div>
<p>
        Scope columns in the grant tables contain strings. The default
        value for each is the empty string. The following table shows
        the number of characters permitted in each column.
</p>
<div class="table">
<a name="idm140091723714480"></a><p class="title"><b>Table 6.8 Grant Table Scope Column Lengths</b></p>
<div class="table-contents">
<table><col width="50%"><col width="50%"><thead><tr>
            <th scope="col">Column Name</th>
            <th scope="col">Maximum Permitted Characters</th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">Host</code>, <code class="literal">Proxied_host</code></td>
            <td>255 (60 prior to MySQL 8.0.17)</td>
          </tr><tr>
            <td scope="row"><code class="literal">User</code>, <code class="literal">Proxied_user</code></td>
            <td>32</td>
          </tr><tr>
            <td scope="row"><code class="literal">Db</code></td>
            <td>64</td>
          </tr><tr>
            <td scope="row"><code class="literal">Table_name</code></td>
            <td>64</td>
          </tr><tr>
            <td scope="row"><code class="literal">Column_name</code></td>
            <td>64</td>
          </tr><tr>
            <td scope="row"><code class="literal">Routine_name</code></td>
            <td>64</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><a class="indexterm" name="idm140091723690704"></a><a class="indexterm" name="idm140091723689216"></a><p>
        For access-checking purposes, comparisons of
        <code class="literal">User</code>, <code class="literal">Proxied_user</code>,
        <code class="literal">authentication_string</code>, <code class="literal">Db</code>,
        and <code class="literal">Table_name</code> values are case-sensitive.
        Comparisons of <code class="literal">Host</code>,
        <code class="literal">Proxied_host</code>, <code class="literal">Column_name</code>,
        and <code class="literal">Routine_name</code> values are not
        case-sensitive.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="grant-tables-privilege-column-properties"></a>Privilege Column Properties</h4>

</div>

</div>

</div>
<p>
        The <code class="literal">user</code> and <code class="literal">db</code> tables
        list each privilege in a separate column that is declared as
        <code class="literal">ENUM('N','Y') DEFAULT 'N'</code>. In other words,
        each privilege can be disabled or enabled, with the default
        being disabled.
      </p><p>
        The <code class="literal">tables_priv</code>,
        <code class="literal">columns_priv</code>, and
        <code class="literal">procs_priv</code> tables declare the privilege
        columns as <a class="link" href="data-types.html#set" title="11.4.5 The SET Type"><code class="literal">SET</code></a> columns. Values in
        these columns can contain any combination of the privileges
        controlled by the table. Only those privileges listed in the
        column value are enabled.
</p>
<div class="table">
<a name="idm140091723672928"></a><p class="title"><b>Table 6.9 Set-Type Privilege Column Values</b></p>
<div class="table-contents">
<table><col width="20%"><col width="25%"><col width="45%"><thead><tr>
            <th scope="col">Table Name</th>
            <th scope="col">Column Name</th>
            <th scope="col">Possible Set Elements</th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">tables_priv</code></td>
            <td><code class="literal">Table_priv</code></td>
            <td><code class="literal">'Select', 'Insert', 'Update', 'Delete', 'Create', 'Drop',
              'Grant', 'References', 'Index', 'Alter', 'Create View',
              'Show view', 'Trigger'</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">tables_priv</code></td>
            <td><code class="literal">Column_priv</code></td>
            <td><code class="literal">'Select', 'Insert', 'Update', 'References'</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">columns_priv</code></td>
            <td><code class="literal">Column_priv</code></td>
            <td><code class="literal">'Select', 'Insert', 'Update', 'References'</code></td>
          </tr><tr>
            <td scope="row"><code class="literal">procs_priv</code></td>
            <td><code class="literal">Proc_priv</code></td>
            <td><code class="literal">'Execute', 'Alter Routine', 'Grant'</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        Only the <code class="literal">user</code> and
        <code class="literal">global_grants</code> tables specify administrative
        privileges, such as <a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a>,
        <a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a>, and
        <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a>.
        Administrative operations are operations on the server itself
        and are not database-specific, so there is no reason to list
        these privileges in the other grant tables. Consequently, the
        server need consult only the <code class="literal">user</code> and
        <code class="literal">global_grants</code> tables to determine whether a
        user can perform an administrative operation.
      </p><p>
        The <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege also is
        specified only in the <code class="literal">user</code> table. It is not
        an administrative privilege as such, but a user's ability to
        read or write files on the server host is independent of the
        database being accessed.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="account-names"></a>6.2.4 Specifying Account Names</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091723635696"></a><a class="indexterm" name="idm140091723634656"></a><a class="indexterm" name="idm140091723633168"></a><a class="indexterm" name="idm140091723631680"></a><a class="indexterm" name="idm140091723630192"></a><p>
      MySQL account names consist of a user name and a host name. This
      enables creation of accounts for users with the same name who can
      connect from different hosts. This section describes how to write
      account names, including special values and wildcard rules.
    </p><p>
      MySQL role names are similar to account names, with some
      differences described at <a class="xref" href="security.html#role-names" title="6.2.5 Specifying Role Names">Section 6.2.5, “Specifying Role Names”</a>.
    </p><p>
      In SQL statements such as <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE
      USER</code></a>, <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>, and
      <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a>, account names follow
      these rules:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Account name syntax is
          <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>.
        </p></li><li class="listitem"><p>
          An account name consisting only of a user name is equivalent
          to
          <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'%'</code>.
          For example, <code class="literal">'me'</code> is equivalent to
          <code class="literal">'me'@'%'</code>.
        </p></li><li class="listitem"><p>
          The user name and host name need not be quoted if they are
          legal as unquoted identifiers. Quotes are necessary to specify
          a <em class="replaceable"><code>user_name</code></em> string containing
          special characters (such as space or <code class="literal">-</code>), or
          a <em class="replaceable"><code>host_name</code></em> string containing
          special characters or wildcard characters (such as
          <code class="literal">.</code> or <code class="literal">%</code>) (for example,
          <code class="literal">'test-user'@'%.com'</code>).
        </p></li><li class="listitem"><p>
          Quote user names and host names as identifiers or as strings,
          using either backticks (<code class="literal">`</code>), single
          quotation marks (<code class="literal">'</code>), or double quotation
          marks (<code class="literal">"</code>). For string-quoting and
          identifier-quoting guidelines, see
          <a class="xref" href="language-structure.html#string-literals" title="9.1.1 String Literals">Section 9.1.1, “String Literals”</a>, and
          <a class="xref" href="language-structure.html#identifiers" title="9.2 Schema Object Names">Section 9.2, “Schema Object Names”</a>.
        </p></li><li class="listitem"><p>
          The user name and host name parts, if quoted, must be quoted
          separately. That is, write
          <code class="literal">'me'@'localhost'</code>, not
          <code class="literal">'me@localhost'</code>; the latter is actually
          equivalent to <code class="literal">'me@localhost'@'%'</code>.
        </p></li><li class="listitem"><p>
          A reference to the <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER</code></a>
          or <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> function is
          equivalent to specifying the current client's user name and
          host name literally.
</p></li></ul>
</div>
<p>
      MySQL stores account names in grant tables in the
      <code class="literal">mysql</code> system database using separate columns
      for the user name and host name parts:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">user</code> table contains one row for each
          account. The <code class="literal">User</code> and
          <code class="literal">Host</code> columns store the user name and host
          name. This table also indicates which global privileges the
          account has.
        </p></li><li class="listitem"><p>
          Other grant tables indicate privileges an account has for
          databases and objects within databases. These tables have
          <code class="literal">User</code> and <code class="literal">Host</code> columns to
          store the account name. Each row in these tables associates
          with the account in the <code class="literal">user</code> table that has
          the same <code class="literal">User</code> and <code class="literal">Host</code>
          values.
        </p></li><li class="listitem"><p>
          For access-checking purposes, comparisons of User values are
          case-sensitive. Comparisons of Host values are not case
          sensitive.
</p><a class="indexterm" name="idm140091723590704"></a><a class="indexterm" name="idm140091723589216"></a></li></ul>
</div>
<p>
      For additional detail about grant table structure, see
      <a class="xref" href="security.html#grant-tables" title="6.2.3 Grant Tables">Section 6.2.3, “Grant Tables”</a>.
    </p><p>
      User names and host names have certain special values or wildcard
      conventions, as described following.
    </p><p>
      The user name part of an account name is either a nonblank value
      that literally matches the user name for incoming connection
      attempts, or a blank value (empty string) that matches any user
      name. An account with a blank user name is an anonymous user. To
      specify an anonymous user in SQL statements, use a quoted empty
      user name part, such as <code class="literal">''@'localhost'</code>.
    </p><p>
      The host name part of an account name can take many forms, and
      wildcards are permitted:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A host value can be a host name or an IP address (IPv4 or
          IPv6). The name <code class="literal">'localhost'</code> indicates the
          local host. The IP address <code class="literal">'127.0.0.1'</code>
          indicates the IPv4 loopback interface. The IP address
          <code class="literal">'::1'</code> indicates the IPv6 loopback
          interface.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140091723579840"></a>

          The <code class="literal">%</code> and <code class="literal">_</code> wildcard
          characters are permitted in host name or IP address values.
          These have the same meaning as for pattern-matching operations
          performed with the <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> operator.
          For example, a host value of <code class="literal">'%'</code> matches
          any host name, whereas a value of
          <code class="literal">'%.mysql.com'</code> matches any host in the
          <code class="literal">mysql.com</code> domain.
          <code class="literal">'198.51.100.%'</code> matches any host in the
          198.51.100 class C network.
        </p><p>
          Because IP wildcard values are permitted in host values (for
          example, <code class="literal">'198.51.100.%'</code> to match every host
          on a subnet), someone could try to exploit this capability by
          naming a host <code class="literal">198.51.100.somewhere.com</code>. To
          foil such attempts, MySQL does not perform matching on host
          names that start with digits and a dot. For example, if a host
          is named <code class="literal">1.2.example.com</code>, its name never
          matches the host part of account names. An IP wildcard value
          can match only IP addresses, not host names.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140091723568704"></a>

          For a host value specified as an IPv4 address, a netmask can
          be given to indicate how many address bits to use for the
          network number. Netmask notation cannot be used for IPv6
          addresses.
        </p><p>
          The syntax is
          <code class="literal"><em class="replaceable"><code>host_ip</code></em>/<em class="replaceable"><code>netmask</code></em></code>.
          For example:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'david'@'198.51.100.0/255.255.255.0';
</pre><p>
          This enables <code class="literal">david</code> to connect from any
          client host having an IP address
          <em class="replaceable"><code>client_ip</code></em> for which the following
          condition is true:
        </p><pre data-lang="clike" class="programlisting">
<em class="replaceable"><code>client_ip</code></em> &amp; <em class="replaceable"><code>netmask</code></em> = <em class="replaceable"><code>host_ip</code></em>
</pre><p>
          That is, for the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>
          statement just shown:
        </p><pre data-lang="clike" class="programlisting">
<em class="replaceable"><code>client_ip</code></em> &amp; 255.255.255.0 = 198.51.100.0
</pre><p>
          IP addresses that satisfy this condition range from
          <code class="literal">198.51.100.0</code> to
          <code class="literal">198.51.100.255</code>.
        </p><p>
          A netmask typically begins with bits set to 1, followed by
          bits set to 0. Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">198.0.0.0/255.0.0.0</code>: Any host on the
              198 class A network
            </p></li><li class="listitem"><p>
              <code class="literal">198.51.100.0/255.255.0.0</code>: Any host on
              the 198.51 class B network
            </p></li><li class="listitem"><p>
              <code class="literal">198.51.100.0/255.255.255.0</code>: Any host on
              the 198.51.100 class C network
            </p></li><li class="listitem"><p>
              <code class="literal">198.51.100.1</code>: Only the host with this
              specific IP address
</p></li></ul>
</div>
</li></ul>
</div>
<p>
      The server performs matching of host values in account names
      against the client host using the value returned by the system DNS
      resolver for the client host name or IP address. Except in the
      case that the account host value is specified using netmask
      notation, the server performs this comparison as a string match,
      even for an account host value given as an IP address. This means
      that you should specify account host values in the same format
      used by DNS. Here are examples of problems to watch out for:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Suppose that a host on the local network has a fully qualified
          name of <code class="literal">host1.example.com</code>. If DNS returns
          name lookups for this host as
          <code class="literal">host1.example.com</code>, use that name in account
          host values. If DNS returns just <code class="literal">host1</code>, use
          <code class="literal">host1</code> instead.
        </p></li><li class="listitem"><p>
          If DNS returns the IP address for a given host as
          <code class="literal">198.51.100.2</code>, that will match an account
          host value of <code class="literal">198.51.100.2</code> but not
          <code class="literal">198.051.100.2</code>. Similarly, it will match an
          account host pattern like <code class="literal">198.51.100.%</code> but
          not <code class="literal">198.051.100.%</code>.
</p></li></ul>
</div>
<p>
      To avoid problems like these, it is advisable to check the format
      in which your DNS returns host names and addresses. Use values in
      the same format in MySQL account names.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="role-names"></a>6.2.5 Specifying Role Names</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091723536304"></a><a class="indexterm" name="idm140091723535232"></a><a class="indexterm" name="idm140091723533744"></a><p>
      MySQL role names refer to roles, which are named collections of
      privileges. For role usage examples, see <a class="xref" href="security.html#roles" title="6.2.10 Using Roles">Section 6.2.10, “Using Roles”</a>.
    </p><p>
      Role names have syntax and semantics similar to account names
      (<a class="xref" href="security.html#account-names" title="6.2.4 Specifying Account Names">Section 6.2.4, “Specifying Account Names”</a>). Role names differ from account
      names in these respects:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The user part of role names cannot be blank. Thus, there is no
          <span class="quote">“<span class="quote">anonymous role</span>”</span> analogous to the concept of
          <span class="quote">“<span class="quote">anonymous user.</span>”</span>
        </p></li><li class="listitem"><p>
          As for an account name, omitting the host part of a role name
          results in a host part of <code class="literal">'%'</code>. But unlike
          <code class="literal">'%'</code> in an account name, a host part of
          <code class="literal">'%'</code> in a role name has no wildcard
          properties. For example, for a name
          <code class="literal">'me'@'%'</code> used as a role name, the host part
          (<code class="literal">'%'</code>) is just a literal value; it has no
          <span class="quote">“<span class="quote">any host</span>”</span> matching property.
        </p></li><li class="listitem"><p>
          Netmask notation in the host part of a role name has no
          significance.
        </p></li><li class="listitem"><p>
          An account name is permitted to be
          <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> in several
          contexts. A role name is not.
</p></li></ul>
</div>
<p>
      It is possible for a row in the <code class="literal">mysql.user</code>
      system table to serve as both an account and a role. In this case,
      any special user or host name matching properties do not apply in
      contexts for which the name is used as a role name. For example,
      you cannot execute the following statement with the expectation
      that it will set the current session roles using all roles that
      have a user part of <code class="literal">myrole</code> and any host name:
    </p><pre data-lang="sql" class="programlisting">
SET ROLE 'myrole'@'%';
</pre><p>
      Instead, the statement sets the active role for the session to the
      role with exactly the name <code class="literal">'myrole'@'%'</code>.
    </p><p>
      For this reason, role names are often specified using only the
      user name part and letting the host name part implicitly be
      <code class="literal">'%'</code>. Specifying a role with a
      non-<code class="literal">'%'</code> host part can be useful if you intend
      to create a name that works both as a role an as a user account
      that is permitted to connect from the given host.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="connection-access"></a>6.2.6 Access Control, Stage 1: Connection Verification</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091723511904"></a><a class="indexterm" name="idm140091723510864"></a><a class="indexterm" name="idm140091723509376"></a><p>
      When you attempt to connect to a MySQL server, the server accepts
      or rejects the connection based on these conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Your identity and whether you can verify your identity by
          supplying the correct password
        </p></li><li class="listitem"><p>
          Whether your account is locked or unlocked
</p></li></ul>
</div>
<p>
      The server checks credentials first, then account locking state. A
      failure for either step causes the server to deny access to you
      completely. Otherwise, the server accepts the connection, and then
      enters Stage 2 and waits for requests.
    </p><p>
      Credential checking is performed using the three
      <code class="literal">user</code> table scope columns
      (<code class="literal">Host</code>, <code class="literal">User</code>, and
      <code class="literal">authentication_string</code>). Locking state is
      recorded in the <code class="literal">user</code> table
      <code class="literal">account_locked</code> column. The server accepts the
      connection only if the <code class="literal">Host</code> and
      <code class="literal">User</code> columns in some <code class="literal">user</code>
      table row match the client host name and user name, the client
      supplies the password specified in that row, and the
      <code class="literal">account_locked</code> value is <code class="literal">'N'</code>.
      The rules for permissible <code class="literal">Host</code> and
      <code class="literal">User</code> values are given in
      <a class="xref" href="security.html#account-names" title="6.2.4 Specifying Account Names">Section 6.2.4, “Specifying Account Names”</a>. Account locking can be changed
      with the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> statement.
    </p><p>
      Your identity is based on two pieces of information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The client host from which you connect
        </p></li><li class="listitem"><p>
          Your MySQL user name
</p></li></ul>
</div>
<a class="indexterm" name="idm140091723490064"></a><p>
      If the <code class="literal">User</code> column value is nonblank, the user
      name in an incoming connection must match exactly. If the
      <code class="literal">User</code> value is blank, it matches any user name.
      If the <code class="literal">user</code> table row that matches an incoming
      connection has a blank user name, the user is considered to be an
      anonymous user with no name, not a user with the name that the
      client actually specified. This means that a blank user name is
      used for all further access checking for the duration of the
      connection (that is, during Stage 2).
    </p><p>
      The <code class="literal">authentication_string</code> column can be blank.
      This is not a wildcard and does not mean that any password
      matches. It means that the user must connect without specifying a
      password. If the server authenticates a client using a plugin, the
      authentication method that the plugin implements may or may not
      use the password in the <code class="literal">authentication_string</code>
      column. In this case, it is possible that an external password is
      also used to authenticate to the MySQL server.
    </p><p>
      Nonblank <code class="literal">authentication_string</code> values in the
      <code class="literal">user</code> table represent encrypted passwords. MySQL
      does not store passwords as cleartext for anyone to see. Rather,
      the password supplied by a user who is attempting to connect is
      encrypted (using the password hashing method implemented by the
      account authentication plugin). The encrypted password then is
      used during the connection process when checking whether the
      password is correct. This is done without the encrypted password
      ever traveling over the connection. See
      <a class="xref" href="security.html#user-names" title="6.2.1 Account User Names and Passwords">Section 6.2.1, “Account User Names and Passwords”</a>.
    </p><p>
      From MySQL's point of view, the encrypted password is the
      <span class="emphasis"><em>real</em></span> password, so you should never give
      anyone access to it. In particular, <span class="emphasis"><em>do not give
      nonadministrative users read access to tables in the
      <code class="literal">mysql</code> system database</em></span>.
    </p><p>
      The following table shows how various combinations of
      <code class="literal">User</code> and <code class="literal">Host</code> values in the
      <code class="literal">user</code> table apply to incoming connections.
</p>
<div class="informaltable">
<table summary="How various combinations of User and Host values in the user table apply to incoming connections to a MySQL server."><col width="15%"><col width="35%"><col width="50%"><thead><tr>
          <th scope="col"><code class="literal">User</code> Value</th>
          <th scope="col"><code class="literal">Host</code> Value</th>
          <th scope="col">Permissible Connections</th>
        </tr></thead><tbody><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'h1.example.net'</code></td>
          <td><code class="literal">fred</code>, connecting from
            <code class="literal">h1.example.net</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">''</code></td>
          <td><code class="literal">'h1.example.net'</code></td>
          <td>Any user, connecting from <code class="literal">h1.example.net</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'%'</code></td>
          <td><code class="literal">fred</code>, connecting from any host</td>
        </tr><tr>
          <td scope="row"><code class="literal">''</code></td>
          <td><code class="literal">'%'</code></td>
          <td>Any user, connecting from any host</td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'%.example.net'</code></td>
          <td><code class="literal">fred</code>, connecting from any host in the
            <code class="literal">example.net</code> domain</td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'x.example.%'</code></td>
          <td><code class="literal">fred</code>, connecting from
            <code class="literal">x.example.net</code>,
            <code class="literal">x.example.com</code>,
            <code class="literal">x.example.edu</code>, and so on; this is
            probably not useful</td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'198.51.100.177'</code></td>
          <td><code class="literal">fred</code>, connecting from the host with IP address
            <code class="literal">198.51.100.177</code></td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'198.51.100.%'</code></td>
          <td><code class="literal">fred</code>, connecting from any host in the
            <code class="literal">198.51.100</code> class C subnet</td>
        </tr><tr>
          <td scope="row"><code class="literal">'fred'</code></td>
          <td><code class="literal">'198.51.100.0/255.255.255.0'</code></td>
          <td>Same as previous example</td>
</tr></tbody></table>
</div>
<p>
      It is possible for the client host name and user name of an
      incoming connection to match more than one row in the
      <code class="literal">user</code> table. The preceding set of examples
      demonstrates this: Several of the entries shown match a connection
      from <code class="literal">h1.example.net</code> by <code class="literal">fred</code>.
    </p><p>
      When multiple matches are possible, the server must determine
      which of them to use. It resolves this issue as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Whenever the server reads the <code class="literal">user</code> table
          into memory, it sorts the rows.
        </p></li><li class="listitem"><p>
          When a client attempts to connect, the server looks through
          the rows in sorted order.
        </p></li><li class="listitem"><p>
          The server uses the first row that matches the client host
          name and user name.
</p></li></ul>
</div>
<p>
      The server uses sorting rules that order rows with the
      most-specific <code class="literal">Host</code> values first. Literal host
      names and IP addresses are the most specific. (The specificity of
      a literal IP address is not affected by whether it has a netmask,
      so <code class="literal">198.51.100.13</code> and
      <code class="literal">198.51.100.0/255.255.255.0</code> are considered
      equally specific.) The pattern <code class="literal">'%'</code> means
      <span class="quote">“<span class="quote">any host</span>”</span> and is least specific. The empty string
      <code class="literal">''</code> also means <span class="quote">“<span class="quote">any host</span>”</span> but sorts
      after <code class="literal">'%'</code>. Rows with the same
      <code class="literal">Host</code> value are ordered with the most-specific
      <code class="literal">User</code> values first (a blank
      <code class="literal">User</code> value means <span class="quote">“<span class="quote">any user</span>”</span> and is
      least specific). For rows with equally-specific
      <code class="literal">Host</code> and <code class="literal">User</code> values, the
      order is nondeterministic.
    </p><p>
      To see how this works, suppose that the <code class="literal">user</code>
      table looks like this:
    </p><pre data-lang="none" class="programlisting">
+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| %         | root     | ...
| %         | jeffrey  | ...
| localhost | root     | ...
| localhost |          | ...
+-----------+----------+-
</pre><p>
      When the server reads the table into memory, it sorts the rows
      using the rules just described. The result after sorting looks
      like this:
    </p><pre data-lang="none" class="programlisting">
+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| localhost | root     | ...
| localhost |          | ...
| %         | jeffrey  | ...
| %         | root     | ...
+-----------+----------+-
</pre><a class="indexterm" name="idm140091723399984"></a><a class="indexterm" name="idm140091723398496"></a><a class="indexterm" name="idm140091723397008"></a><p>
      When a client attempts to connect, the server looks through the
      sorted rows and uses the first match found. For a connection from
      <code class="literal">localhost</code> by <code class="literal">jeffrey</code>, two of
      the rows from the table match: the one with
      <code class="literal">Host</code> and <code class="literal">User</code> values of
      <code class="literal">'localhost'</code> and <code class="literal">''</code>, and the
      one with values of <code class="literal">'%'</code> and
      <code class="literal">'jeffrey'</code>. The <code class="literal">'localhost'</code>
      row appears first in sorted order, so that is the one the server
      uses.
    </p><p>
      Here is another example. Suppose that the <code class="literal">user</code>
      table looks like this:
    </p><pre data-lang="none" class="programlisting">
+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| %              | jeffrey  | ...
| h1.example.net |          | ...
+----------------+----------+-
</pre><p>
      The sorted table looks like this:
    </p><pre data-lang="none" class="programlisting">
+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| h1.example.net |          | ...
| %              | jeffrey  | ...
+----------------+----------+-
</pre><p>
      A connection by <code class="literal">jeffrey</code> from
      <code class="literal">h1.example.net</code> is matched by the first row,
      whereas a connection by <code class="literal">jeffrey</code> from any host
      is matched by the second.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        It is a common misconception to think that, for a given user
        name, all rows that explicitly name that user are used first
        when the server attempts to find a match for the connection.
        This is not true. The preceding example illustrates this, where
        a connection from <code class="literal">h1.example.net</code> by
        <code class="literal">jeffrey</code> is first matched not by the row
        containing <code class="literal">'jeffrey'</code> as the
        <code class="literal">User</code> column value, but by the row with no
        user name. As a result, <code class="literal">jeffrey</code> is
        authenticated as an anonymous user, even though he specified a
        user name when connecting.
</p>
</div>
<p>
      If you are able to connect to the server, but your privileges are
      not what you expect, you probably are being authenticated as some
      other account. To find out what account the server used to
      authenticate you, use the
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> function. (See
      <a class="xref" href="functions.html#information-functions" title="12.15 Information Functions">Section 12.15, “Information Functions”</a>.) It returns a value in
      <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
      format that indicates the <code class="literal">User</code> and
      <code class="literal">Host</code> values from the matching
      <code class="literal">user</code> table row. Suppose that
      <code class="literal">jeffrey</code> connects and issues the following
      query:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT CURRENT_USER();</code></strong>
+----------------+
| CURRENT_USER() |
+----------------+
| @localhost     |
+----------------+
</pre><p>
      The result shown here indicates that the matching
      <code class="literal">user</code> table row had a blank
      <code class="literal">User</code> column value. In other words, the server
      is treating <code class="literal">jeffrey</code> as an anonymous user.
    </p><p>
      Another way to diagnose authentication problems is to print out
      the <code class="literal">user</code> table and sort it by hand to see where
      the first match is being made.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="request-access"></a>6.2.7 Access Control, Stage 2: Request Verification</h3>

</div>

</div>

</div>
<p>
      After you establish a connection, the server enters Stage 2 of
      access control. For each request that you issue through that
      connection, the server determines what operation you want to
      perform, then checks whether you have sufficient privileges to do
      so. This is where the privilege columns in the grant tables come
      into play. These privileges can come from any of the
      <code class="literal">user</code>, <code class="literal">global_grants</code>,
      <code class="literal">db</code>, <code class="literal">tables_priv</code>,
      <code class="literal">columns_priv</code>, or <code class="literal">procs_priv</code>
      tables. (You may find it helpful to refer to
      <a class="xref" href="security.html#grant-tables" title="6.2.3 Grant Tables">Section 6.2.3, “Grant Tables”</a>, which lists the columns present in
      each grant table.)
    </p><a class="indexterm" name="idm140091723357392"></a><p>
      The <code class="literal">user</code> and <code class="literal">global_grants</code>
      tables grant global privileges. The rows in these tables for a
      given account indicate the account privileges that apply on a
      global basis no matter what the default database is. For example,
      if the <code class="literal">user</code> table grants you the
      <a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a> privilege, you can delete
      rows from any table in any database on the server host. It is wise
      to grant privileges in the <code class="literal">user</code> table only to
      people who need them, such as database administrators. For other
      users, leave all privileges in the <code class="literal">user</code> table
      set to <code class="literal">'N'</code> and grant privileges at more
      specific levels only (for particular databases, tables, columns,
      or routines). It is also possible to grant database privileges
      globally but use partial revokes to restrict them from being
      exercised on specific databases (see
      <a class="xref" href="security.html#partial-revokes" title="6.2.12 Privilege Restriction Using Partial Revokes">Section 6.2.12, “Privilege Restriction Using Partial Revokes”</a>).
    </p><a class="indexterm" name="idm140091723349024"></a><a class="indexterm" name="idm140091723347952"></a><p>
      The <code class="literal">db</code> table grants database-specific
      privileges. Values in the scope columns of this table can take the
      following forms:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A blank <code class="literal">User</code> value matches the anonymous
          user. A nonblank value matches literally; there are no
          wildcards in user names.
        </p></li><li class="listitem"><p>
          The wildcard characters <code class="literal">%</code> and
          <code class="literal">_</code> can be used in the
          <code class="literal">Host</code> and <code class="literal">Db</code> columns.
          These have the same meaning as for pattern-matching operations
          performed with the <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> operator.
          If you want to use either character literally when granting
          privileges, you must escape it with a backslash. For example,
          to include the underscore character (<code class="literal">_</code>) as
          part of a database name, specify it as <code class="literal">\_</code>
          in the <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statement.
        </p></li><li class="listitem"><p>
          A <code class="literal">'%'</code> or blank <code class="literal">Host</code>
          value means <span class="quote">“<span class="quote">any host.</span>”</span>
        </p></li><li class="listitem"><p>
          A <code class="literal">'%'</code> or blank <code class="literal">Db</code> value
          means <span class="quote">“<span class="quote">any database.</span>”</span>
</p></li></ul>
</div>
<a class="indexterm" name="idm140091723330224"></a><a class="indexterm" name="idm140091723328736"></a><a class="indexterm" name="idm140091723327248"></a><p>
      The server reads the <code class="literal">db</code> table into memory and
      sorts it at the same time that it reads the
      <code class="literal">user</code> table. The server sorts the
      <code class="literal">db</code> table based on the <code class="literal">Host</code>,
      <code class="literal">Db</code>, and <code class="literal">User</code> scope columns.
      As with the <code class="literal">user</code> table, sorting puts the
      most-specific values first and least-specific values last, and
      when the server looks for matching rows, it uses the first match
      that it finds.
    </p><a class="indexterm" name="idm140091723320112"></a><a class="indexterm" name="idm140091723318608"></a><a class="indexterm" name="idm140091723317104"></a><p>
      The <code class="literal">tables_priv</code>,
      <code class="literal">columns_priv</code>, and <code class="literal">procs_priv</code>
      tables grant table-specific, column-specific, and routine-specific
      privileges. Values in the scope columns of these tables can take
      the following forms:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The wildcard characters <code class="literal">%</code> and
          <code class="literal">_</code> can be used in the
          <code class="literal">Host</code> column. These have the same meaning as
          for pattern-matching operations performed with the
          <a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a> operator.
        </p></li><li class="listitem"><p>
          A <code class="literal">'%'</code> or blank <code class="literal">Host</code>
          value means <span class="quote">“<span class="quote">any host.</span>”</span>
        </p></li><li class="listitem"><p>
          The <code class="literal">Db</code>, <code class="literal">Table_name</code>,
          <code class="literal">Column_name</code>, and
          <code class="literal">Routine_name</code> columns cannot contain
          wildcards or be blank.
</p></li></ul>
</div>
<p>
      The server sorts the <code class="literal">tables_priv</code>,
      <code class="literal">columns_priv</code>, and <code class="literal">procs_priv</code>
      tables based on the <code class="literal">Host</code>,
      <code class="literal">Db</code>, and <code class="literal">User</code> columns. This
      is similar to <code class="literal">db</code> table sorting, but simpler
      because only the <code class="literal">Host</code> column can contain
      wildcards.
    </p><p>
      The server uses the sorted tables to verify each request that it
      receives. For requests that require administrative privileges such
      as <a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a> or
      <a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a>, the server checks only the
      <code class="literal">user</code> and <code class="literal">global_privilege</code>
      tables because those are the only tables that specify
      administrative privileges. The server grants access if a row for
      the account in those tables permits the requested operation and
      denies access otherwise. For example, if you want to execute
      <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin shutdown</strong></span></a> but your
      <code class="literal">user</code> table row does not grant the
      <a class="link" href="security.html#priv_shutdown"><code class="literal">SHUTDOWN</code></a> privilege to you, the
      server denies access without even checking the
      <code class="literal">db</code> table. (The latter table contains no
      <code class="literal">Shutdown_priv</code> column, so there is no need to
      check it.)
    </p><p>
      For database-related requests
      (<a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and so on), the server
      first checks the user's global privileges in the
      <code class="literal">user</code> table row (less any privilege restrictions
      imposed by partial revokes). If the row permits the requested
      operation, access is granted. If the global privileges in the
      <code class="literal">user</code> table are insufficient, the server
      determines the user's database-specific privileges from the
      <code class="literal">db</code> table:
    </p><p>
      The server looks in the <code class="literal">db</code> table for a match on
      the <code class="literal">Host</code>, <code class="literal">Db</code>, and
      <code class="literal">User</code> columns. The <code class="literal">Host</code> and
      <code class="literal">User</code> columns are matched to the connecting
      user's host name and MySQL user name. The <code class="literal">Db</code>
      column is matched to the database that the user wants to access.
      If there is no row for the <code class="literal">Host</code> and
      <code class="literal">User</code>, access is denied.
    </p><p>
      After determining the database-specific privileges granted by the
      <code class="literal">db</code> table rows, the server adds them to the
      global privileges granted by the <code class="literal">user</code> table. If
      the result permits the requested operation, access is granted.
      Otherwise, the server successively checks the user's table and
      column privileges in the <code class="literal">tables_priv</code> and
      <code class="literal">columns_priv</code> tables, adds those to the user's
      privileges, and permits or denies access based on the result. For
      stored-routine operations, the server uses the
      <code class="literal">procs_priv</code> table rather than
      <code class="literal">tables_priv</code> and
      <code class="literal">columns_priv</code>.
    </p><p>
      Expressed in boolean terms, the preceding description of how a
      user's privileges are calculated may be summarized like this:
    </p><pre data-lang="sql" class="programlisting">
global privileges
OR (database privileges AND host privileges)
OR table privileges
OR column privileges
OR routine privileges
</pre><p>
      It may not be apparent why, if the global privileges are initially
      found to be insufficient for the requested operation, the server
      adds those privileges to the database, table, and column
      privileges later. The reason is that a request might require more
      than one type of privilege. For example, if you execute an
      <a class="link" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT Syntax"><code class="literal">INSERT INTO ...
      SELECT</code></a> statement, you need both the
      <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> and the
      <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privileges. Your privileges
      might be such that the <code class="literal">user</code> table row grants
      one privilege global and the <code class="literal">db</code> table row
      grants the other specifically for the relevant database. In this
      case, you have the necessary privileges to perform the request,
      but the server cannot tell that from either your global or
      database privileges alone. It must make an access-control decision
      based on the combined privileges.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="creating-accounts"></a>6.2.8 Adding Accounts, Assigning Privileges, and Dropping Accounts</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091723258896"></a><a class="indexterm" name="idm140091723257856"></a><a class="indexterm" name="idm140091723256368"></a><a class="indexterm" name="idm140091723255296"></a><a class="indexterm" name="idm140091723253808"></a><a class="indexterm" name="idm140091723252736"></a><a class="indexterm" name="idm140091723251248"></a><a class="indexterm" name="idm140091723250176"></a><a class="indexterm" name="idm140091723248688"></a><a class="indexterm" name="idm140091723247200"></a><a class="indexterm" name="idm140091723245712"></a><a class="indexterm" name="idm140091723244224"></a><a class="indexterm" name="idm140091723242736"></a><a class="indexterm" name="idm140091723241248"></a><a class="indexterm" name="idm140091723239760"></a><p>
      To manage MySQL accounts, use the SQL statements intended for that
      purpose:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> and
          <a class="link" href="sql-syntax.html#drop-user" title="13.7.1.5 DROP USER Syntax"><code class="literal">DROP USER</code></a> create and remove
          accounts.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
          <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> assign privileges to and
          revoke privileges from accounts.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> displays account
          privilege assignments.
</p></li></ul>
</div>
<p>
      Account-management statements cause the server to make appropriate
      modifications to the underlying grant tables, which are discussed
      in <a class="xref" href="security.html#grant-tables" title="6.2.3 Grant Tables">Section 6.2.3, “Grant Tables”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        Direct modification of grant tables using statements such as
        <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> is discouraged and done at
        your own risk. The server is free to ignore rows that become
        malformed as a result of such modifications.
      </p><p>
        For any operation that modifies a grant table, the server checks
        whether the table has the expected structure and produces an
        error if not. To update the tables to the expected structure,
        perform the MySQL upgrade procedure. See
        <a class="xref" href="installing.html#upgrading" title="2.11 Upgrading MySQL">Section 2.11, “Upgrading MySQL”</a>.
</p>
</div>
<p>
      Another option for creating accounts is to use the GUI tool
      MySQL Workbench. Also, several third-party programs offer capabilities
      for MySQL account administration. <code class="literal">phpMyAdmin</code> is
      one such program.
    </p><p>
      This section discusses the following topics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#creating-accounts-granting-privileges" title="Creating Accounts and Granting Privileges">Creating Accounts and Granting Privileges</a></p></li><li class="listitem"><p><a class="xref" href="security.html#checking-account-privileges" title="Checking Account Privileges and Properties">Checking Account Privileges and Properties</a></p></li><li class="listitem"><p><a class="xref" href="security.html#revoking-account-privileges" title="Revoking Account Privileges">Revoking Account Privileges</a></p></li><li class="listitem"><p><a class="xref" href="security.html#dropping-accounts" title="Dropping Accounts">Dropping Accounts</a></p></li></ul>
</div>
<p>
      For additional information about the statements discussed here,
      see <a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="creating-accounts-granting-privileges"></a>Creating Accounts and Granting Privileges</h4>
</div>
</div>
</div>
<p>
        The following examples show how to use the
        <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client program to set up new accounts.
        These examples assume that the MySQL <code class="literal">root</code>
        account has the <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a>
        privilege and all privileges that it grants to other accounts.
      </p><p>
        At the command line, connect to the server as the MySQL
        <code class="literal">root</code> user, supplying the appropriate password
        at the password prompt:
      </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u root -p</code></strong>
Enter password: <em class="replaceable"><code>(enter root password here)</code></em>
</pre><p>
        After connecting to the server, you can add new accounts. The
        following example uses <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER
        </code></a> and <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statements
        to set up four accounts (where you see
        <code class="literal">'<em class="replaceable"><code>password</code></em>'</code>,
        substitute an appropriate password):
      </p><pre data-lang="sql" class="programlisting">
CREATE USER 'finley'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL
  ON *.*
  TO 'finley'@'localhost'
  WITH GRANT OPTION;

CREATE USER 'finley'@'%.example.com'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL
  ON *.*
  TO 'finley'@'%.example.com'
  WITH GRANT OPTION;

CREATE USER 'admin'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT RELOAD,PROCESS
  ON *.*
  TO 'admin'@'localhost';

CREATE USER 'dummy'@'localhost';
</pre><p>
        The accounts created by those statements have the following
        properties:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Two accounts have a user name of <code class="literal">finley</code>.
            Both are superuser accounts with full global privileges to
            do anything. The <code class="literal">'finley'@'localhost'</code>
            account can be used only when connecting from the local
            host. The <code class="literal">'finley'@'%.example.com'</code>
            account uses the <code class="literal">'%'</code> wildcard in the host
            part, so it can be used to connect from any host in the
            <code class="literal">example.com</code> domain.
          </p><p>
            The <code class="literal">'finley'@'localhost'</code> account is
            necessary if there is an anonymous-user account for
            <code class="literal">localhost</code>. Without the
            <code class="literal">'finley'@'localhost'</code> account, that
            anonymous-user account takes precedence when
            <code class="literal">finley</code> connects from the local host and
            <code class="literal">finley</code> is treated as an anonymous user.
            The reason for this is that the anonymous-user account has a
            more specific <code class="literal">Host</code> column value than the
            <code class="literal">'finley'@'%'</code> account and thus comes
            earlier in the <code class="literal">user</code> table sort order.
            (For information about <code class="literal">user</code> table
            sorting, see <a class="xref" href="security.html#connection-access" title="6.2.6 Access Control, Stage 1: Connection Verification">Section 6.2.6, “Access Control, Stage 1: Connection Verification”</a>.)
          </p></li><li class="listitem"><p>
            The <code class="literal">'admin'@'localhost'</code> account can be
            used only by <code class="literal">admin</code> to connect from the
            local host. It is granted the global
            <a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a> and
            <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> administrative
            privileges. These privileges enable the
            <code class="literal">admin</code> user to execute the
            <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin reload</strong></span></a>, <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
            refresh</strong></span></a>, and <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
            flush-<em class="replaceable"><code>xxx</code></em></strong></span></a> commands, as
            well as <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin processlist</strong></span></a> . No
            privileges are granted for accessing any databases. You
            could add such privileges using
            <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statements.
          </p></li><li class="listitem"><p>
            The <code class="literal">'dummy'@'localhost'</code> account has no
            password (which is insecure and not recommended). This
            account can be used only to connect from the local host. No
            privileges are granted. It is assumed that you will grant
            specific privileges to the account using
            <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statements.
</p></li></ul>
</div>
<p>
        The previous example grants privileges at the global level. The
        next example creates three accounts and grants them access at
        lower levels; that is, to specific databases or objects within
        databases. Each account has a user name of
        <code class="literal">custom</code>, but the host name parts differ:
      </p><pre data-lang="sql" class="programlisting">
CREATE USER 'custom'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL
  ON bankaccount.*
  TO 'custom'@'localhost';

CREATE USER 'custom'@'host47.example.com'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
  ON expenses.*
  TO 'custom'@'host47.example.com';

CREATE USER 'custom'@'%.example.com'
  IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
  ON customer.addresses
  TO 'custom'@'%.example.com';
</pre><p>
        The three accounts can be used as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">'custom'@'localhost'</code> account has all
            database-level privileges to access the
            <code class="literal">bankaccount</code> database. The account can be
            used to connect to the server only from the local host.
          </p></li><li class="listitem"><p>
            The <code class="literal">'custom'@'host47.example.com'</code> account
            has specific database-level privileges to access the
            <code class="literal">expenses</code> database. The account can be
            used to connect to the server only from the host
            <code class="literal">host47.example.com</code>.
          </p></li><li class="listitem"><p>
            The <code class="literal">'custom'@'%.example.com'</code> account has
            specific table-level privileges to access the
            <code class="literal">addresses</code> table in the
            <code class="literal">customer</code> database, from any host in the
            <code class="literal">example.com</code> domain. The account can be
            used to connect to the server from all machines in the
            domain due to use of the <code class="literal">%</code> wildcard
            character in the host part of the account name.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="checking-account-privileges"></a>Checking Account Privileges and Properties</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091723153696"></a><a class="indexterm" name="idm140091723152208"></a><p>
        To see the privileges for an account, use
        <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a>:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'admin'@'localhost';</code></strong>
+-----------------------------------------------------+
| Grants for admin@localhost                          |
+-----------------------------------------------------+
| GRANT RELOAD, PROCESS ON *.* TO 'admin'@'localhost' |
+-----------------------------------------------------+
</pre><p>
        To see nonprivilege properties for an account, use
        <a class="link" href="sql-syntax.html#show-create-user" title="13.7.6.12 SHOW CREATE USER Syntax"><code class="literal">SHOW CREATE USER</code></a>:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET print_identified_with_as_hex = ON;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW CREATE USER 'admin'@'localhost'\G</code></strong>
*************************** 1. row ***************************
CREATE USER for admin@localhost: CREATE USER 'admin'@'localhost'
IDENTIFIED WITH 'caching_sha2_password'
AS 0x24412430303524301D0E17054E2241362B1419313C3E44326F294133734B30792F436E77764270373039612E32445250786D43594F45354532324B6169794F47457852796E32
REQUIRE NONE PASSWORD EXPIRE DEFAULT ACCOUNT UNLOCK
PASSWORD HISTORY DEFAULT
PASSWORD REUSE INTERVAL DEFAULT
PASSWORD REQUIRE CURRENT DEFAULT
</pre><p>
        Enabling the
        <a class="link" href="server-administration.html#sysvar_print_identified_with_as_hex"><code class="literal">print_identified_with_as_hex</code></a>
        system variable (available as of MySQL 8.0.17) causes
        <a class="link" href="sql-syntax.html#show-create-user" title="13.7.6.12 SHOW CREATE USER Syntax"><code class="literal">SHOW CREATE USER</code></a> to display hash
        values that contain unprintable characters as hexadecimal
        strings rather than as regular string literals.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="revoking-account-privileges"></a>Revoking Account Privileges</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091723138256"></a><a class="indexterm" name="idm140091723136768"></a><p>
        To revoke account privileges, use the
        <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> statement. Privileges can
        be revoked at different levels, just as they can be granted at
        different levels.
      </p><p>
        Revoke global privileges:
      </p><pre data-lang="sql" class="programlisting">
REVOKE ALL
  ON *.*
  FROM 'finley'@'%.example.com';

REVOKE RELOAD
  ON *.*
  FROM 'admin'@'localhost';
</pre><p>
        Revoke database-level privileges:
      </p><pre data-lang="sql" class="programlisting">
REVOKE CREATE,DROP
  ON expenses.*
  FROM 'custom'@'host47.example.com';
</pre><p>
        Revoke table-level privileges:
      </p><pre data-lang="sql" class="programlisting">
REVOKE INSERT,UPDATE,DELETE
  ON customer.addresses
  FROM 'custom'@'%.example.com';
</pre><p>
        To check the effect of privilege revocation, use
        <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a>:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'admin'@'localhost';</code></strong>
+---------------------------------------------+
| Grants for admin@localhost                  |
+---------------------------------------------+
| GRANT PROCESS ON *.* TO 'admin'@'localhost' |
+---------------------------------------------+
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="dropping-accounts"></a>Dropping Accounts</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091723124384"></a><a class="indexterm" name="idm140091723122896"></a><a class="indexterm" name="idm140091723121408"></a><a class="indexterm" name="idm140091723119920"></a><p>
        To remove an account, use the <a class="link" href="sql-syntax.html#drop-user" title="13.7.1.5 DROP USER Syntax"><code class="literal">DROP
        USER</code></a> statement. For example, to drop some of the
        accounts created previously:
      </p><pre data-lang="sql" class="programlisting">
DROP USER 'finley'@'localhost';
DROP USER 'finley'@'%.example.com';
DROP USER 'admin'@'localhost';
DROP USER 'dummy'@'localhost';
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="reserved-users"></a>6.2.9 Reserved Accounts</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091723114352"></a><a class="indexterm" name="idm140091723113280"></a><a class="indexterm" name="idm140091723111792"></a><p>
      One part of the MySQL installation process is data directory
      initialization (see
      <a class="xref" href="installing.html#data-directory-initialization" title="2.10.1 Initializing the Data Directory">Section 2.10.1, “Initializing the Data Directory”</a>). During data
      directory initialization, MySQL creates user accounts that should
      be considered reserved:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">'root'@'localhost</code>: Used for administrative
          purposes. This account has all privileges, is a system
          account, and can perform any operation.
        </p><p>
          Strictly speaking, this account name is not reserved, in the
          sense that some installations rename the
          <code class="literal">root</code> account to something else to avoid
          exposing a highly privileged account with a well-known name.
        </p></li><li class="listitem"><p>
          <code class="literal">'mysql.sys'@'localhost'</code>: Used as the
          <code class="literal">DEFINER</code> for
          <a class="link" href="sys-schema.html" title="Chapter 27 MySQL sys Schema"><code class="literal">sys</code></a> schema objects. Use of the
          <code class="literal">mysql.sys</code> account avoids problems that
          occur if a DBA renames or removes the <code class="literal">root</code>
          account. This account is locked so that it cannot be used for
          client connections.
        </p></li><li class="listitem"><p>
          <code class="literal">'mysql.session'@'localhost'</code>: Used
          internally by plugins to access the server. This account is
          locked so that it cannot be used for client connections. The
          account is a system account.
        </p></li><li class="listitem"><p>
          <code class="literal">'mysql.infoschema'@'localhost'</code>: Used as the
          <code class="literal">DEFINER</code> for
          <a class="link" href="information-schema.html" title="Chapter 25 INFORMATION_SCHEMA Tables"><code class="literal">INFORMATION_SCHEMA</code></a> views. Use of
          the <code class="literal">mysql.infoschema</code> account avoids
          problems that occur if a DBA renames or removes the root
          account. This account is locked so that it cannot be used for
          client connections.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="roles"></a>6.2.10 Using Roles</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091723093376"></a><p>
      A MySQL role is a named collection of privileges. Like user
      accounts, roles can have privileges granted to and revoked from
      them.
    </p><p>
      A user account can be granted roles, which grants to the account
      the privileges associated with each role. This enables assignment
      of sets of privileges to accounts and provides a convenient
      alternative to granting individual privileges, both for
      conceptualizing desired privilege assignments and implementing
      them.
    </p><p>
      The following list summarizes role-management capabilities
      provided by MySQL:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#create-role" title="13.7.1.2 CREATE ROLE Syntax"><code class="literal">CREATE ROLE</code></a> and
          <a class="link" href="sql-syntax.html#drop-role" title="13.7.1.4 DROP ROLE Syntax"><code class="literal">DROP ROLE</code></a> create and remove
          roles.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
          <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> assign privileges to
          revoke privileges from user accounts and roles.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> displays privilege
          and role assignments for user accounts and roles.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#set-default-role" title="13.7.1.9 SET DEFAULT ROLE Syntax"><code class="literal">SET DEFAULT ROLE</code></a> specifies
          which account roles are active by default.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#set-role" title="13.7.1.11 SET ROLE Syntax"><code class="literal">SET ROLE</code></a> changes the active
          roles within the current session.
        </p></li><li class="listitem"><p>
          The <a class="link" href="functions.html#function_current-role"><code class="literal">CURRENT_ROLE()</code></a> function
          displays the active roles within the current session.
        </p></li><li class="listitem"><p>
          The <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> and
          <a class="link" href="server-administration.html#sysvar_activate_all_roles_on_login"><code class="literal">activate_all_roles_on_login</code></a>
          system variables enable defining mandatory roles and automatic
          activation of granted roles when users log in to the server.
</p></li></ul>
</div>
<p>
      For descriptions of individual role-manipulation statements
      (including the privileges required to use them), see
      <a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>. The following discussion
      provides examples of role usage. Unless otherwise specified, SQL
      statements shown here should be executed using a MySQL account
      with sufficient administrative privileges, such as the
      <code class="literal">root</code> account.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#roles-creating-granting" title="Creating Roles and Granting Privileges to Them">Creating Roles and Granting Privileges to Them</a></p></li><li class="listitem"><p><a class="xref" href="security.html#mandatory-roles" title="Defining Mandatory Roles">Defining Mandatory Roles</a></p></li><li class="listitem"><p><a class="xref" href="security.html#roles-checking" title="Checking Role Privileges">Checking Role Privileges</a></p></li><li class="listitem"><p><a class="xref" href="security.html#roles-activating" title="Activating Roles">Activating Roles</a></p></li><li class="listitem"><p><a class="xref" href="security.html#roles-revoking" title="Revoking Roles or Role Privileges">Revoking Roles or Role Privileges</a></p></li><li class="listitem"><p><a class="xref" href="security.html#roles-dropping" title="Dropping Roles">Dropping Roles</a></p></li><li class="listitem"><p><a class="xref" href="security.html#role-user-interchangeability" title="User and Role Interchangeability">User and Role Interchangeability</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="roles-creating-granting"></a>Creating Roles and Granting Privileges to Them</h4>

</div>

</div>

</div>
<p>
        Consider this scenario:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            An application uses a database named
            <code class="literal">app_db</code>.
          </p></li><li class="listitem"><p>
            Associated with the application, there can be accounts for
            developers who create and maintain the application, and for
            users who interact with it.
          </p></li><li class="listitem"><p>
            Developers need full access to the database. Some users need
            only read access, others need read/write access.
</p></li></ul>
</div>
<p>
        To avoid granting privileges individually to possibly many user
        accounts, create roles as names for the required privilege sets.
        This makes it easy to grant the required privileges to user
        accounts, by granting the appropriate roles.
      </p><p>
        To create the roles, use the <a class="link" href="sql-syntax.html#create-role" title="13.7.1.2 CREATE ROLE Syntax"><code class="literal">CREATE
        ROLE</code></a> statement:
      </p><pre data-lang="sql" class="programlisting">
CREATE ROLE 'app_developer', 'app_read', 'app_write';
</pre><p>
        Role names are much like user account names and consist of a
        user part and host part in
        <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>
        format. The host part, if omitted, defaults to
        <code class="literal">'%'</code>. The user and host parts can be unquoted
        unless they contain special characters such as
        <code class="literal">-</code> or <code class="literal">%</code>. Unlike account
        names, the user part of role names cannot be blank. For
        additional information, see <a class="xref" href="security.html#role-names" title="6.2.5 Specifying Role Names">Section 6.2.5, “Specifying Role Names”</a>.
      </p><p>
        To assign privileges to the roles, execute
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statements using the same
        syntax as for assigning privileges to user accounts:
      </p><pre data-lang="sql" class="programlisting">
GRANT ALL ON app_db.* TO 'app_developer';
GRANT SELECT ON app_db.* TO 'app_read';
GRANT INSERT, UPDATE, DELETE ON app_db.* TO 'app_write';
</pre><p>
        Now suppose that initially you require one developer account,
        two user accounts that need read-only access, and one user
        account that needs read/write access. Use
        <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> to create the
        accounts:
      </p><pre data-lang="sql" class="programlisting">
CREATE USER 'dev1'@'localhost' IDENTIFIED BY 'dev1pass';
CREATE USER 'read_user1'@'localhost' IDENTIFIED BY 'read_user1pass';
CREATE USER 'read_user2'@'localhost' IDENTIFIED BY 'read_user2pass';
CREATE USER 'rw_user1'@'localhost' IDENTIFIED BY 'rw_user1pass';
</pre><p>
        To assign each user account its required privileges, you could
        use <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statements of the same
        form as just shown, but that requires enumerating individual
        privileges for each user. Instead, use an alternative
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> syntax that permits
        granting roles rather than privileges:
      </p><pre data-lang="sql" class="programlisting">
GRANT 'app_developer' TO 'dev1'@'localhost';
GRANT 'app_read' TO 'read_user1'@'localhost', 'read_user2'@'localhost';
GRANT 'app_read', 'app_write' TO 'rw_user1'@'localhost';
</pre><p>
        The <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statement for the
        <code class="literal">rw_user1</code> account grants the read and write
        roles, which combine to provide the required read and write
        privileges.
      </p><p>
        The <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> syntax for granting
        roles to an account differs from the syntax for granting
        privileges: There is an <code class="literal">ON</code> clause to assign
        privileges, whereas there is no <code class="literal">ON</code> clause to
        assign roles. Because the syntaxes are distinct, you cannot mix
        assigning privileges and roles in the same statement. (It is
        permitted to assign both privileges and roles to an account, but
        you must use separate <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>
        statements, each with syntax appropriate to what is to be
        granted.) As of MySQL 8.0.16, roles cannot be granted to
        anonymous users.
      </p><p>
        A role when created is locked, has no password, and is assigned
        the default authentication plugin. (These role attributes can be
        changed later with the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>
        statement, by users who have the global
        <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege.)
      </p><p>
        While locked, a role cannot be used to authenticate to the
        server. If unlocked, a role can be used to authenticate. This is
        because roles and users are both authorization identifiers with
        much in common and little to distinguish them. See also
        <a class="xref" href="security.html#role-user-interchangeability" title="User and Role Interchangeability">User and Role Interchangeability</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="mandatory-roles"></a>Defining Mandatory Roles</h4>

</div>

</div>

</div>
<p>
        It is possible to specify roles as mandatory by naming them in
        the value of the
        <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system
        variable. The server treats a mandatory role as granted to all
        users, so that it need not be granted explicitly to any account.
      </p><p>
        To specify mandatory roles at server startup, define
        <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> in your server
        <code class="filename">my.cnf</code> file:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
mandatory_roles='role1,role2@localhost,r3@%.example.com'
</pre><p>
        To set and persist
        <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> at runtime, use
        a statement like this:
      </p><pre data-lang="sql" class="programlisting">
SET PERSIST mandatory_roles = 'role1,role2@localhost,r3@%.example.com';
</pre><p>
        <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
        PERSIST</code></a> sets the value for the running MySQL instance.
        It also saves the value, causing it to be used for subsequent
        server restarts. To change a value for the running MySQL
        instance without saving it for subsequent restarts, use the
        <code class="literal">GLOBAL</code> keyword rather than
        <code class="literal">PERSIST</code>. See <a class="xref" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment">Section 13.7.5.1, “SET Syntax for Variable Assignment”</a>.
      </p><p>
        Setting <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a>
        requires the <a class="link" href="security.html#priv_role-admin"><code class="literal">ROLE_ADMIN</code></a>
        privilege, in addition to the
        <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a> or
        <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege normally required
        to set a global system variable.
      </p><p>
        Mandatory roles, like explicitly granted roles, do not take
        effect until activated (see <a class="xref" href="security.html#roles-activating" title="Activating Roles">Activating Roles</a>).
        At login time, role activation occurs for all granted roles if
        the <a class="link" href="server-administration.html#sysvar_activate_all_roles_on_login"><code class="literal">activate_all_roles_on_login</code></a>
        system variable is enabled, or for roles that are set as default
        roles otherwise. At runtime, <a class="link" href="sql-syntax.html#set-role" title="13.7.1.11 SET ROLE Syntax"><code class="literal">SET
        ROLE</code></a> activates roles.
      </p><p>
        Roles named in the value of
        <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> cannot be
        revoked with <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> or dropped
        with <a class="link" href="sql-syntax.html#drop-role" title="13.7.1.4 DROP ROLE Syntax"><code class="literal">DROP ROLE</code></a> or
        <a class="link" href="sql-syntax.html#drop-user" title="13.7.1.5 DROP USER Syntax"><code class="literal">DROP USER</code></a>.
      </p><p>
        To prevent sessions from being made system sessions by default,
        a role that has the <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a>
        privilege cannot be listed in the value of the
        <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system
        variable:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> is
            assigned a role at startup that has the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege, the
            server writes a message to the error log and exits.
          </p></li><li class="listitem"><p>
            If <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> is
            assigned a role at runtime that has the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege, an
            error occurs and the
            <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> value
            remains unchanged.
</p></li></ul>
</div>
<p>
        If a role named in
        <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> is not present
        in the <code class="literal">mysql.user</code> system table, the role is
        not granted to users. When the server attempts role activation
        for a user, it does not treat the nonexistent role as mandatory
        and writes a warning to the error log. If the role is created
        later and thus becomes valid, <a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH
        PRIVILEGES</code></a> may be necessary to cause the server to
        treat it as mandatory.
      </p><p>
        <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> displays mandatory
        roles according to the rules described in
        <a class="xref" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax">Section 13.7.6.21, “SHOW GRANTS Syntax”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="roles-checking"></a>Checking Role Privileges</h4>

</div>

</div>

</div>
<p>
        To verify the privileges assigned to an account, use
        <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a>. For example:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'dev1'@'localhost';</code></strong>
+-------------------------------------------------+
| Grants for dev1@localhost                       |
+-------------------------------------------------+
| GRANT USAGE ON *.* TO `dev1`@`localhost`        |
| GRANT `app_developer`@`%` TO `dev1`@`localhost` |
+-------------------------------------------------+
</pre><p>
        However, that shows each granted role without
        <span class="quote">“<span class="quote">expanding</span>”</span> it to the privileges the role
        represents. To show role privileges as well, add a
        <code class="literal">USING</code> clause naming the granted roles for
        which to display privileges:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'dev1'@'localhost' USING 'app_developer';</code></strong>
+----------------------------------------------------------+
| Grants for dev1@localhost                                |
+----------------------------------------------------------+
| GRANT USAGE ON *.* TO `dev1`@`localhost`                 |
| GRANT ALL PRIVILEGES ON `app_db`.* TO `dev1`@`localhost` |
| GRANT `app_developer`@`%` TO `dev1`@`localhost`          |
+----------------------------------------------------------+
</pre><p>
        Verify each other type of user similarly:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'read_user1'@'localhost' USING 'app_read';</code></strong>
+--------------------------------------------------------+
| Grants for read_user1@localhost                        |
+--------------------------------------------------------+
| GRANT USAGE ON *.* TO `read_user1`@`localhost`         |
| GRANT SELECT ON `app_db`.* TO `read_user1`@`localhost` |
| GRANT `app_read`@`%` TO `read_user1`@`localhost`       |
+--------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'rw_user1'@'localhost' USING 'app_read', 'app_write';</code></strong>
+------------------------------------------------------------------------------+
| Grants for rw_user1@localhost                                                |
+------------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO `rw_user1`@`localhost`                                 |
| GRANT SELECT, INSERT, UPDATE, DELETE ON `app_db`.* TO `rw_user1`@`localhost` |
| GRANT `app_read`@`%`,`app_write`@`%` TO `rw_user1`@`localhost`               |
+------------------------------------------------------------------------------+
</pre><p>
        <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> displays mandatory
        roles according to the rules described in
        <a class="xref" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax">Section 13.7.6.21, “SHOW GRANTS Syntax”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="roles-activating"></a>Activating Roles</h4>

</div>

</div>

</div>
<p>
        Roles granted to a user account can be active or inactive within
        account sessions. If a granted role is active within a session,
        its privileges apply; otherwise, they do not. To determine which
        roles are active within the current session, use the
        <a class="link" href="functions.html#function_current-role"><code class="literal">CURRENT_ROLE()</code></a> function.
      </p><p>
        By default, granting a role to an account or naming it in the
        <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system variable
        value does not automatically cause the role to become active
        within account sessions. For example, because thus far in the
        preceding discussion no <code class="literal">rw_user1</code> roles have
        been activated, if you connect to the server as
        <code class="literal">rw_user1</code> and invoke the
        <a class="link" href="functions.html#function_current-role"><code class="literal">CURRENT_ROLE()</code></a> function, the
        result is <code class="literal">NONE</code> (no active roles):
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT CURRENT_ROLE();</code></strong>
+----------------+
| CURRENT_ROLE() |
+----------------+
| NONE           |
+----------------+
</pre><p>
        To specify which roles should become active each time a user
        connects to the server and authenticates, use
        <a class="link" href="sql-syntax.html#set-default-role" title="13.7.1.9 SET DEFAULT ROLE Syntax"><code class="literal">SET DEFAULT ROLE</code></a>. To set the
        default to all assigned roles for each account created earlier,
        use this statement:
      </p><pre data-lang="sql" class="programlisting">
SET DEFAULT ROLE ALL TO
  'dev1'@'localhost',
  'read_user1'@'localhost',
  'read_user2'@'localhost',
  'rw_user1'@'localhost';
</pre><p>
        Now if you connect as <code class="literal">rw_user1</code>, the initial
        value of <a class="link" href="functions.html#function_current-role"><code class="literal">CURRENT_ROLE()</code></a> reflects
        the new default role assignments:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT CURRENT_ROLE();</code></strong>
+--------------------------------+
| CURRENT_ROLE()                 |
+--------------------------------+
| `app_read`@`%`,`app_write`@`%` |
+--------------------------------+
</pre><p>
        To cause all explicitly granted and mandatory roles to be
        automatically activated when users connect to the server, enable
        the <a class="link" href="server-administration.html#sysvar_activate_all_roles_on_login"><code class="literal">activate_all_roles_on_login</code></a>
        system variable. By default, automatic role activation is
        disabled.
      </p><p>
        Within a session, a user can execute <a class="link" href="sql-syntax.html#set-role" title="13.7.1.11 SET ROLE Syntax"><code class="literal">SET
        ROLE</code></a> to change the set of active roles. For example,
        for <code class="literal">rw_user1</code>:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET ROLE NONE; SELECT CURRENT_ROLE();</code></strong>
+----------------+
| CURRENT_ROLE() |
+----------------+
| NONE           |
+----------------+
mysql&gt; <strong class="userinput"><code>SET ROLE ALL EXCEPT 'app_write'; SELECT CURRENT_ROLE();</code></strong>
+----------------+
| CURRENT_ROLE() |
+----------------+
| `app_read`@`%` |
+----------------+
mysql&gt; <strong class="userinput"><code>SET ROLE DEFAULT; SELECT CURRENT_ROLE();</code></strong>
+--------------------------------+
| CURRENT_ROLE()                 |
+--------------------------------+
| `app_read`@`%`,`app_write`@`%` |
+--------------------------------+
</pre><p>
        The first <a class="link" href="sql-syntax.html#set-role" title="13.7.1.11 SET ROLE Syntax"><code class="literal">SET ROLE</code></a> statement
        deactivates all roles. The second makes
        <code class="literal">rw_user1</code> effectively read only. The third
        restores the default roles.
      </p><a class="indexterm" name="idm140091722937216"></a><a class="indexterm" name="idm140091722935728"></a><a class="indexterm" name="idm140091722934240"></a><a class="indexterm" name="idm140091722932752"></a><p>
        The effective user for stored program and view objects is
        subject to the <code class="literal">DEFINER</code> and <code class="literal">SQL
        SECURITY</code> attributes, which determine whether execution
        occurs in invoker or definer context (see
        <a class="xref" href="stored-objects.html#stored-objects-security" title="24.6 Stored Object Access Control">Section 24.6, “Stored Object Access Control”</a>):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Stored program and view objects that execute in invoker
            context execute with the roles that are active within the
            current session.
          </p></li><li class="listitem"><p>
            Stored program and view objects that execute in definer
            context execute with the default roles of the user named in
            their <code class="literal">DEFINER</code> attribute. If
            <a class="link" href="server-administration.html#sysvar_activate_all_roles_on_login"><code class="literal">activate_all_roles_on_login</code></a>
            is enabled, such objects execute with all roles granted to
            the <code class="literal">DEFINER</code> user, including mandatory
            roles. For stored programs, if execution should occur with
            roles different from the default, the program body should
            execute <a class="link" href="sql-syntax.html#set-role" title="13.7.1.11 SET ROLE Syntax"><code class="literal">SET ROLE</code></a> to activate
            the required roles.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="roles-revoking"></a>Revoking Roles or Role Privileges</h4>

</div>

</div>

</div>
<p>
        Just as roles can be granted to an account, they can be revoked
        from an account:
      </p><pre data-lang="sql" class="programlisting">
REVOKE <em class="replaceable"><code>role</code></em> FROM <em class="replaceable"><code>user</code></em>;
</pre><p>
        Roles named in the
        <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system variable
        value cannot be revoked.
      </p><p>
        <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> can also be applied to a
        role to modify the privileges granted to it. This affects not
        only the role itself, but any account granted that role. Suppose
        that you want to temporarily make all application users read
        only. To do this, use <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> to
        revoke the modification privileges from the
        <code class="literal">app_write</code> role:
      </p><pre data-lang="sql" class="programlisting">
REVOKE INSERT, UPDATE, DELETE ON app_db.* FROM 'app_write';
</pre><p>
        As it happens, that leaves the role with no privileges at all,
        as can be seen using <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a>
        (which demonstrates that this statement can be used with roles,
        not just users):
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'app_write';</code></strong>
+---------------------------------------+
| Grants for app_write@%                |
+---------------------------------------+
| GRANT USAGE ON *.* TO `app_write`@`%` |
+---------------------------------------+
</pre><p>
        Because revoking privileges from a role affects the privileges
        for any user who is assigned the modified role,
        <code class="literal">rw_user1</code> now has no table modification
        privileges (<a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a>,
        <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a>, and
        <a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a> are no longer present):
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'rw_user1'@'localhost'</code></strong>
       <strong class="userinput"><code>USING 'app_read', 'app_write';</code></strong>
+----------------------------------------------------------------+
| Grants for rw_user1@localhost                                  |
+----------------------------------------------------------------+
| GRANT USAGE ON *.* TO `rw_user1`@`localhost`                   |
| GRANT SELECT ON `app_db`.* TO `rw_user1`@`localhost`           |
| GRANT `app_read`@`%`,`app_write`@`%` TO `rw_user1`@`localhost` |
+----------------------------------------------------------------+
</pre><p>
        In effect, the <code class="literal">rw_user1</code> read/write user has
        become a read-only user. This also occurs for any other accounts
        that are granted the <code class="literal">app_write</code> role,
        illustrating how use of roles makes it unnecessary to modify
        privileges for individual accounts.
      </p><p>
        To restore modification privileges to the role, simply re-grant
        them:
      </p><pre data-lang="sql" class="programlisting">
GRANT INSERT, UPDATE, DELETE ON app_db.* TO 'app_write';
</pre><p>
        Now <code class="literal">rw_user1</code> again has modification
        privileges, as do any other accounts granted the
        <code class="literal">app_write</code> role.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="roles-dropping"></a>Dropping Roles</h4>

</div>

</div>

</div>
<p>
        To drop roles, use <a class="link" href="sql-syntax.html#drop-role" title="13.7.1.4 DROP ROLE Syntax"><code class="literal">DROP ROLE</code></a>:
      </p><pre data-lang="sql" class="programlisting">
DROP ROLE 'app_read', 'app_write';
</pre><p>
        Dropping a role revokes it from every account to which it was
        granted.
      </p><p>
        Roles named in the
        <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system variable
        value cannot be dropped.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="role-user-interchangeability"></a>User and Role Interchangeability</h4>

</div>

</div>

</div>
<p>
        As has been hinted at earlier for <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW
        GRANTS</code></a>, which displays grants for user accounts or
        roles, accounts and roles can be used interchangeably.
      </p><p>
        One difference between roles and users is that
        <a class="link" href="sql-syntax.html#create-role" title="13.7.1.2 CREATE ROLE Syntax"><code class="literal">CREATE ROLE</code></a> creates an
        authorization identifier that is locked by default, whereas
        <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> creates an
        authorization identifier that is unlocked by default. However,
        distinction is not immutable because a user with appropriate
        privileges can lock or unlock roles or users after they have
        been created.
      </p><p>
        If a database administrator has a preference that a specific
        authorization identifier must be a role, a name scheme can be
        used to communicate this intention. For example, you could use a
        <code class="literal">r_</code> prefix for all authorization identifiers
        that you intend to be roles and nothing else.
      </p><p>
        Another difference between roles and users lies in the
        privileges available for administering them:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <a class="link" href="security.html#priv_create-role"><code class="literal">CREATE ROLE</code></a> and
            <a class="link" href="security.html#priv_drop-role"><code class="literal">DROP ROLE</code></a> privileges enable
            only use of the <a class="link" href="sql-syntax.html#create-role" title="13.7.1.2 CREATE ROLE Syntax"><code class="literal">CREATE ROLE</code></a>
            and <a class="link" href="sql-syntax.html#drop-role" title="13.7.1.4 DROP ROLE Syntax"><code class="literal">DROP ROLE</code></a> statements,
            respectively.
          </p></li><li class="listitem"><p>
            The <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege
            enables use of the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER
            USER</code></a>, <a class="link" href="sql-syntax.html#create-role" title="13.7.1.2 CREATE ROLE Syntax"><code class="literal">CREATE ROLE</code></a>,
            <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
            <a class="link" href="sql-syntax.html#drop-role" title="13.7.1.4 DROP ROLE Syntax"><code class="literal">DROP ROLE</code></a>,
            <a class="link" href="sql-syntax.html#drop-user" title="13.7.1.5 DROP USER Syntax"><code class="literal">DROP USER</code></a>,
            <a class="link" href="sql-syntax.html#rename-user" title="13.7.1.7 RENAME USER Syntax"><code class="literal">RENAME USER</code></a>, and
            <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE ALL
            PRIVILEGES</code></a> statements.
</p></li></ul>
</div>
<p>
        Thus, the <a class="link" href="security.html#priv_create-role"><code class="literal">CREATE ROLE</code></a> and
        <a class="link" href="security.html#priv_drop-role"><code class="literal">DROP ROLE</code></a> privileges are not as
        powerful as <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a> and may
        be granted to users who should only be permitted to create and
        drop roles, and not perform more general account manipulation.
      </p><p>
        With regard to privileges and interchangeability of users and
        roles, you can treat a user account like a role and grant that
        account to another user or a role. The effect is to grant the
        account's privileges and roles to the other user or role.
      </p><p>
        This set of statements demonstrates that you can grant a user to
        a user, a role to a user, a user to a role, or a role to a role:
      </p><pre data-lang="sql" class="programlisting">
CREATE USER 'u1';
CREATE ROLE 'r1';
GRANT SELECT ON db1.* TO 'u1';
GRANT SELECT ON db2.* TO 'r1';
CREATE USER 'u2';
CREATE ROLE 'r2';
GRANT 'u1', 'r1' TO 'u2';
GRANT 'u1', 'r1' TO 'r2';
</pre><p>
        The result in each case is to grant to the grantee object the
        privileges associated with the granted object. After executing
        those statements, each of <code class="literal">u2</code> and
        <code class="literal">r2</code> have been granted privileges from a user
        (<code class="literal">u1</code>) and a role (<code class="literal">r1</code>):
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'u2' USING 'u1', 'r1';</code></strong>
+-------------------------------------+
| Grants for u2@%                     |
+-------------------------------------+
| GRANT USAGE ON *.* TO `u2`@`%`      |
| GRANT SELECT ON `db1`.* TO `u2`@`%` |
| GRANT SELECT ON `db2`.* TO `u2`@`%` |
| GRANT `u1`@`%`,`r1`@`%` TO `u2`@`%` |
+-------------------------------------+
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR 'r2' USING 'u1', 'r1';</code></strong>
+-------------------------------------+
| Grants for r2@%                     |
+-------------------------------------+
| GRANT USAGE ON *.* TO `r2`@`%`      |
| GRANT SELECT ON `db1`.* TO `r2`@`%` |
| GRANT SELECT ON `db2`.* TO `r2`@`%` |
| GRANT `u1`@`%`,`r1`@`%` TO `r2`@`%` |
+-------------------------------------+
</pre><p>
        The preceding example is illustrative only, but
        interchangeability of user accounts and roles has practical
        application, such as in the following situation: Suppose that a
        legacy application development project began before the advent
        of roles in MySQL, so all user accounts associated with the
        project are granted privileges directly (rather than granted
        privileges by virtue of being granted roles). One of these
        accounts is a developer account that was originally granted
        privileges as follows:
      </p><pre data-lang="sql" class="programlisting">
CREATE USER 'old_app_dev'@'localhost' IDENTIFIED BY 'old_app_devpass';
GRANT ALL ON old_app.* TO 'old_app_dev'@'localhost';
</pre><p>
        If this developer leaves the project, it becomes necessary to
        assign the privileges to another user, or perhaps multiple users
        if development activies have expanded. Here are some ways to
        deal with the issue:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Without using roles: Change the account password so the
            original developer cannot use it, and have a new developer
            use the account instead:
          </p><pre data-lang="sql" class="programlisting">
ALTER USER 'old_app_dev'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>new_password</code></em>';
</pre></li><li class="listitem"><p>
            Using roles: Lock the account to prevent anyone from using
            it to connect to the server:
          </p><pre data-lang="sql" class="programlisting">
ALTER USER 'old_app_dev'@'localhost' ACCOUNT LOCK;
</pre><p>
            Then treat the account as a role. For each developer new to
            the project, create a new account and grant to it the
            original developer account:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER 'new_app_dev1'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>new_password</code></em>';
GRANT 'old_app_dev'@'localhost' TO 'new_app_dev1'@'localhost';
</pre><p>
            The effect is to assign the original developer account
            privileges to the new account.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="account-categories"></a>6.2.11 Account Categories</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091722839088"></a><a class="indexterm" name="idm140091722837600"></a><a class="indexterm" name="idm140091722836112"></a><a class="indexterm" name="idm140091722835040"></a><a class="indexterm" name="idm140091722833552"></a><p>
      As of MySQL 8.0.16, MySQL incorporates the concept of user account
      categories, based on the
      <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#system-user-accounts" title="System and Regular Accounts">System and Regular Accounts</a></p></li><li class="listitem"><p><a class="xref" href="security.html#system-user-operations" title="Operations Affected by the SYSTEM_USER Privilege">Operations Affected by the SYSTEM_USER Privilege</a></p></li><li class="listitem"><p><a class="xref" href="security.html#system-user-sessions" title="System and Regular Sessions">System and Regular Sessions</a></p></li><li class="listitem"><p><a class="xref" href="security.html#protecting-system-accounts" title="Protecting System Accounts Against Manipulation by Regular Accounts">Protecting System Accounts Against Manipulation by Regular Accounts</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="system-user-accounts"></a>System and Regular Accounts</h4>

</div>

</div>

</div>
<p>
        MySQL incorporates the concept of user account categories, with
        system and regular users distinguished according to whether they
        have the <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A user with the <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a>
            privilege is a system user.
          </p></li><li class="listitem"><p>
            A user without the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege is a
            regular user.
</p></li></ul>
</div>
<p>
        The <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege has an
        effect on the accounts to which a given user can apply its other
        privileges, as well as whether the user is protected from other
        accounts:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A system user can modify both system and regular accounts.
            That is, a user who has the appropriate privileges to
            perform a given operation on regular accounts is enabled by
            possession of <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> to
            also perform the operation on system accounts. A system
            account can be modified only by system users with
            appropriate privileges, not by regular users.
          </p></li><li class="listitem"><p>
            A regular user with appropriate privileges can modify
            regular accounts, but not system accounts. A regular account
            can be modified by both system and regular users with
            appropriate privileges.
</p></li></ul>
</div>
<p>
        If a user has the appropriate privileges to perform a given
        operation on regular accounts,
        <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> enables the user to
        also perform the operation on system accounts.
        <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> does not imply any
        other privilege, so the ability to perform a given account
        operation remains predicated on possession of any other required
        privileges. For example, if a user can grant the
        <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> and
        <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a> privileges to regular
        accounts, then with <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a>
        the user can also grant <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a>
        and <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a> to system accounts.
      </p><p>
        The distinction between system and regular accounts enables
        better control over certain account administration issues by
        protecting accounts that have the
        <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege from
        accounts that do not have the privilege. For example, the
        <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege enables not
        only creation of new accounts, but modification and removal of
        existing accounts. Without the system user concept, a user who
        has the <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege can
        modify or drop any existing account, including the
        <code class="literal">root</code> account. The concept of system user
        enables restricting modifications to the <code class="literal">root</code>
        account (itself a system account) so they can be made only by
        system users. Regular users with the <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE
        USER</code></a> privilege can still modify or drop existing
        accounts, but only regular accounts.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="system-user-operations"></a>Operations Affected by the SYSTEM_USER Privilege</h4>

</div>

</div>

</div>
<p>
        The <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege affects
        these operations:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Account manipulation.
          </p><p>
            Account manipulation includes creating and dropping
            accounts, granting and revoking privileges, changing account
            authentication characteristics such as credentials or
            authentication plugin, and changing other account
            characteristics such as password expiration policy.
          </p><p>
            The <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege is
            required to manipulate system accounts using
            account-management statements such as
            <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> and
            <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>. To prevent an account
            from modifying system accounts this way, make it a regular
            account by not granting it the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege.
            (However, to fully protect system accounts against regular
            accounts, you must also withhold modification privileges for
            the <code class="literal">mysql</code> system schema from regular
            accounts. See <a class="xref" href="security.html#protecting-system-accounts" title="Protecting System Accounts Against Manipulation by Regular Accounts">Protecting System Accounts Against Manipulation by Regular Accounts</a>.)
          </p></li><li class="listitem"><p>
            Killing current sessions and statements executing within
            them.
          </p><p>
            To kill a session or statement that is executing with the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege, your
            own session must have the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege, in
            addition to any other required privilege
            (<a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a> or
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>).
          </p><p>
            Prior to MySQL 8.0.16,
            <a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a> or
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> are sufficient to kill
            any session or statement.
          </p></li><li class="listitem"><p>
            Setting the <code class="literal">DEFINER</code> for stored objects.
          </p><p>
            To set the <code class="literal">DEFINER</code> attribute for a stored
            object to an account that has the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege, you
            must have the <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a>
            privilege, in addition to any other required privilege
            (<a class="link" href="security.html#priv_set-user-id"><code class="literal">SET_USER_ID</code></a> or
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>).
          </p><p>
            Prior to MySQL 8.0.16,
            <a class="link" href="security.html#priv_set-user-id"><code class="literal">SET_USER_ID</code></a> or
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> are sufficient to
            specify any <code class="literal">DEFINER</code> value for stored
            objects.
          </p></li><li class="listitem"><p>
            Specifying mandatory roles.
          </p><p>
            A role that has the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege cannot
            be listed in the value of the
            <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a> system
            variable.
          </p><p>
            Prior to MySQL 8.0.16, any role can be listed in
            <a class="link" href="server-administration.html#sysvar_mandatory_roles"><code class="literal">mandatory_roles</code></a>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="system-user-sessions"></a>System and Regular Sessions</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091722756576"></a><a class="indexterm" name="idm140091722755120"></a><a class="indexterm" name="idm140091722753632"></a><p>
        Sessions executing within the server are distinguished as system
        or regular sessions, similar to the distinction between system
        and regular users:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A session that possesses the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege is a
            system session.
          </p></li><li class="listitem"><p>
            A session that does not possess the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege is a
            regular session.
</p></li></ul>
</div>
<p>
        A regular session is able to perform only operations permitted
        to regular users. A system session is additionally able to
        perform operations permitted only to system users.
      </p><p>
        The privileges possessed by a session are those granted directly
        to its underlying account, plus those granted to all roles
        currently active within the session. Thus, a session may be a
        system session because its account has been granted the
        <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege directly,
        or because the session has activated a role that has the
        <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege. Roles
        granted to an account that are not active within the session do
        not affect session privileges.
      </p><p>
        Because activating and deactivating roles can change the
        privileges possessed by sessions, a session may change from a
        regular session to a system session or vice versa. If a session
        activates or deactivates a role that has the
        <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege, the
        appropriate change between regular and system session takes
        place immediately, for that session only:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If a regular session activates a role with the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege, the
            session becomes a system session.
          </p></li><li class="listitem"><p>
            If a system session deactivates a role with the
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege, the
            session becomes a regular session, unless some other role
            with the <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a>
            privilege remains active.
</p></li></ul>
</div>
<p>
        These operations have no effect on existing sessions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If the <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege
            is granted to or revoked from an account, existing sessions
            for the account do not change between regular and system
            sessions. The grant or revoke operation affects only
            sessions for subsequent connections by the account.
          </p></li><li class="listitem"><p>
            Statements executed by a stored object invoked within a
            session execute with the system or regular status of the
            parent session, even if the object
            <code class="literal">DEFINER</code> attribute names a system account.
</p></li></ul>
</div>
<p>
        Because role activation affects only sessions and not accounts,
        granting a role that has the
        <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege to a
        regular account does not protect that account against regular
        users. The role protects only sessions for the account in which
        the role has been activated, and protects the session only
        against being killed by regular sessions.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="protecting-system-accounts"></a>Protecting System Accounts Against Manipulation by Regular Accounts</h4>

</div>

</div>

</div>
<p>
        Account manipulation includes creating and dropping accounts,
        granting and revoking privileges, changing account
        authentication characteristics such as credentials or
        authentication plugin, and changing other account
        characteristics such as password expiration policy.
      </p><p>
        Account manipulation can be done two ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            By using account-management statements such as
            <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> and
            <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>. This is the preferred
            method.
          </p></li><li class="listitem"><p>
            By direct grant-table modification using statements such as
            <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a> and
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>. This method is
            discouraged but possible for users with the appropriate
            privileges on the <code class="literal">mysql</code> system schema
            that contains the grant tables.
</p></li></ul>
</div>
<p>
        To fully protect system accounts against modification by a given
        account, make it a regular account and do not grant it
        modification privileges for the <code class="literal">mysql</code> schema:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege is
            required to manipulate system accounts using
            account-management statements. To prevent an account from
            modifying system accounts this way, make it a regular
            account by not granting
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> to it. This
            includes not granting
            <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> to any roles
            granted to the account.
          </p></li><li class="listitem"><p>
            Privileges for the <code class="literal">mysql</code> schema enable
            manipulation of system accounts through direct modification
            of the grant tables, even if the modifying account is a
            regular account. To restrict unauthorized direct
            modification of system accounts by a regular account, do not
            grant modification privileges for the
            <code class="literal">mysql</code> schema to the account (or any roles
            granted to the account). If a regular account must have
            global privileges that apply to all schemas,
            <code class="literal">mysql</code> schema modifications can be
            prevented using privilege restrictions imposed using partial
            revokes. See <a class="xref" href="security.html#partial-revokes" title="6.2.12 Privilege Restriction Using Partial Revokes">Section 6.2.12, “Privilege Restriction Using Partial Revokes”</a>.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          Unlike withholding the
          <a class="link" href="security.html#priv_system-user"><code class="literal">SYSTEM_USER</code></a> privilege, which
          prevents an account from modifying system accounts but not
          regular accounts, withholding <code class="literal">mysql</code> schema
          privileges prevents an account from modifying system accounts
          as well as regular accounts. This should not be an issue
          because, as mentioned, direct grant-table modification is
          discouraged.
</p>
</div>
<p>
        Suppose that you want to create a user <code class="literal">u1</code> who
        has all privileges on all schemas, except that
        <code class="literal">u1</code> should be a regular user without the
        ability to modify system accounts. Assuming that the
        <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a> system variable
        is enabled, configure <code class="literal">u1</code> as follows:
      </p><pre data-lang="sql" class="programlisting">
CREATE USER u1 IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';

GRANT ALL ON *.* TO u1 WITH GRANT OPTION;
-- GRANT ALL includes SYSTEM_USER, so at this point
-- u1 can manipulate system or regular accounts

REVOKE SYSTEM_USER ON *.* FROM u1;
-- Revoking SYSTEM_USER makes u1 a regular user;
-- now u1 can use account-management statements
-- to manipulate only regular accounts

REVOKE ALL ON mysql.* FROM u1;
-- This partial revoke prevents u1 from directly
-- modifying grant tables to manipulate accounts
</pre><p>
        To prevent all <code class="literal">mysql</code> system schema access by
        an account, revoke all its privileges on the
        <code class="literal">mysql</code> schema, as just shown. It is also
        possible to permit partial <code class="literal">mysql</code> schema
        access, such as read-only access. The following example creates
        an account that has <code class="literal">SELECT</code>,
        <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, and
        <code class="literal">DELETE</code> privileges globally for all schemas,
        but only <code class="literal">SELECT</code> for the
        <code class="literal">mysql</code> schema:
      </p><pre data-lang="sql" class="programlisting">
CREATE USER u2 IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO u2;
REVOKE INSERT, UPDATE, DELETE ON mysql.* FROM u2;
</pre><p>
        Another possibility is to revoke all <code class="literal">mysql</code>
        schema privileges but grant access to specific
        <code class="literal">mysql</code> tables or columns. This can be done
        even with a partial revoke on <code class="literal">mysql</code>. The
        following statements enable read-only access to
        <code class="literal">u1</code> within the <code class="literal">mysql</code>
        schema, but only for the <code class="literal">db</code> table and the
        <code class="literal">Host</code> and <code class="literal">User</code> columns of
        the <code class="literal">user</code> table:
      </p><pre data-lang="sql" class="programlisting">
CREATE USER u3 IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
GRANT ALL ON *.* TO u3;
REVOKE ALL ON mysql.* FROM u3;
GRANT SELECT ON mysql.db TO u3;
GRANT SELECT(Host,User) ON mysql.user TO u3;
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="partial-revokes"></a>6.2.12 Privilege Restriction Using Partial Revokes</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091722679920"></a><a class="indexterm" name="idm140091722678880"></a><p>
      Prior to MySQL 8.0.16, it is not possible to grant privileges that
      apply globally except for certain schemas. As of MySQL 8.0.16,
      that is possible if the
      <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a> system variable
      is enabled. Specifically, for users who have privileges at the
      global level, <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a>
      enables privileges for specific schemas to be revoked while
      leaving the privileges in place for other schemas. Privilege
      restrictions thus imposed may be useful for administration of
      accounts that have global privileges but should not be permitted
      to access certain schemas. For example, it is possible to permit
      an account to modify any table except those in the
      <code class="literal">mysql</code> system schema.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#partial-revokes-usage" title="Using Partial Revokes">Using Partial Revokes</a></p></li><li class="listitem"><p><a class="xref" href="security.html#partial-revokes-versus-schema-grants" title="Partial Revokes Versus Explicit Schema Grants">Partial Revokes Versus Explicit Schema Grants</a></p></li><li class="listitem"><p><a class="xref" href="security.html#partial-revokes-disabling" title="Disabling Partial Revokes">Disabling Partial Revokes</a></p></li><li class="listitem"><p><a class="xref" href="security.html#partial-revokes-replication" title="Partial Revokes and Replication">Partial Revokes and Replication</a></p></li></ul>
</div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        For brevity, <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>
        statements shown here do not include passwords. For production
        use, always assign account passwords.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="partial-revokes-usage"></a>Using Partial Revokes</h4>

</div>

</div>

</div>
<p>
        The <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a> system
        variable controls whether privilege restrictions can be placed
        on accounts. By default,
        <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a> is disabled and
        attempts to partially revoke global privileges produce an error:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT, INSERT ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>REVOKE INSERT ON world.* FROM u1;</code></strong>
ERROR 1141 (42000): There is no such grant defined for user 'u1' on host '%'
</pre><p>
        To permit the <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> operation,
        enable <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a>:
      </p><pre data-lang="sql" class="programlisting">
SET PERSIST partial_revokes = ON;
</pre><p>
        <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
        PERSIST</code></a> sets the value for the running MySQL instance.
        It also saves the value, causing it to be used for subsequent
        server restarts. To change a value for the running MySQL
        instance without saving it for subsequent restarts, use the
        <code class="literal">GLOBAL</code> keyword rather than
        <code class="literal">PERSIST</code>. See <a class="xref" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment">Section 13.7.5.1, “SET Syntax for Variable Assignment”</a>.
      </p><p>
        With <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a> enabled,
        the partial revoke succeeds:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>REVOKE INSERT ON world.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+------------------------------------------+
| Grants for u1@%                          |
+------------------------------------------+
| GRANT SELECT, INSERT ON *.* TO `u1`@`%`  |
| REVOKE INSERT ON `world`.* FROM `u1`@`%` |
+------------------------------------------+
</pre><p>
        <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> lists partial revokes
        as <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> statements in its
        output. The result indicates that <code class="literal">u1</code> has
        global <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> and
        <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> privileges, except that
        <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> cannot be exercised for
        tables in the <code class="literal">world</code> schema. That is, access
        by <code class="literal">u1</code> to <code class="literal">world</code> tables is
        read only.
      </p><p>
        The server records privilege restrictions implemented through
        partial revokes in the <code class="literal">mysql.user</code> system
        table. If an account has partial revokes, its
        <code class="literal">User_attributes</code> column value has a
        <code class="literal">Restrictions</code> attribute:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT User, Host, User_attributes-&gt;&gt;'$.Restrictions'</code></strong>
       <strong class="userinput"><code>FROM mysql.user WHERE User_attributes-&gt;&gt;'$.Restrictions' &lt;&gt; '';</code></strong>
+------+------+------------------------------------------------------+
| User | Host | User_attributes-&gt;&gt;'$.Restrictions'                   |
+------+------+------------------------------------------------------+
| u1   | %    | [{"Database": "world", "Privileges": ["INSERT"]}] |
+------+------+------------------------------------------------------+
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Although partial revokes can be imposed for any schema,
          privilege restrictions on the <code class="literal">mysql</code> system
          schema in particular are useful as part of a strategy for
          preventing regular accounts from modifying system accounts.
          See <a class="xref" href="security.html#protecting-system-accounts" title="Protecting System Accounts Against Manipulation by Regular Accounts">Protecting System Accounts Against Manipulation by Regular Accounts</a>.
</p>
</div>
<p>
        Partial revoke operations are subject to these conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Partial revokes must name the schema literally. Schema names
            that contain the <code class="literal">%</code> or
            <code class="literal">_</code> SQL wildcard characters (for example,
            <code class="literal">myschema%</code>) are not permitted.
          </p></li><li class="listitem"><p>
            It is possible to use partial revokes to place restrictions
            on nonexistent schemas, but only if the revoked privilege is
            granted globally. If a privilege is not granted globally,
            revoking it for a nonexistent schema produces an error.
          </p></li><li class="listitem"><p>
            Partial revokes apply at the schema level only. You cannot
            use partial revokes for privileges that apply only globally
            (such as <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> or
            <a class="link" href="security.html#priv_binlog-admin"><code class="literal">BINLOG_ADMIN</code></a>), or for table,
            column, or routine privileges.
</p></li></ul>
</div>
<p>
        As mentioned previously, partial revokes of schema-level
        privileges appear in <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a>
        output as <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> statements. This
        differs from how <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a>
        represents <span class="quote">“<span class="quote">plain</span>”</span> schema-level privileges:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When granted, schema-level privileges are represented by
            their own <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statements in
            the output:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT UPDATE ON mysql.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT DELETE ON world.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+---------------------------------------+
| Grants for u1@%                       |
+---------------------------------------+
| GRANT USAGE ON *.* TO `u1`@`%`        |
| GRANT UPDATE ON `mysql`.* TO `u1`@`%` |
| GRANT DELETE ON `world`.* TO `u1`@`%` |
+---------------------------------------+
</pre></li><li class="listitem"><p>
            When revoked, schema-level privileges simply disappear from
            the output. They do not appear as
            <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> statements:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>REVOKE UPDATE ON mysql.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>REVOKE DELETE ON world.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+--------------------------------+
| Grants for u1@%                |
+--------------------------------+
| GRANT USAGE ON *.* TO `u1`@`%` |
+--------------------------------+
</pre></li></ul>
</div>
<p>
        When a user grants a privilege, any restriction the grantor has
        on the privilege is inherited by the grantee, unless the grantee
        already has the privilege without the restriction. Consider the
        following two users, one of whom has the global
        <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege:
      </p><pre data-lang="sql" class="programlisting">
CREATE USER u1, u2;
GRANT SELECT ON *.* TO u2;
</pre><p>
        Suppose that an administrative user <code class="literal">admin</code> has
        a global but partially revoked
        <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER admin;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT ON *.* TO admin WITH GRANT OPTION;</code></strong>
mysql&gt; <strong class="userinput"><code>REVOKE SELECT ON mysql.* FROM admin;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR admin;</code></strong>
+------------------------------------------------------+
| Grants for admin@%                                   |
+------------------------------------------------------+
| GRANT SELECT ON *.* TO `admin`@`%` WITH GRANT OPTION |
| REVOKE SELECT ON `mysql`.* FROM `admin`@`%`          |
+------------------------------------------------------+
</pre><p>
        If <code class="literal">admin</code> grants
        <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> globally to
        <code class="literal">u1</code> and <code class="literal">u2</code>, the result
        differs for each user:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If <code class="literal">admin</code> grants
            <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> globally to
            <code class="literal">u1</code>, who has no
            <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege to begin
            with, <code class="literal">u1</code> inherits the
            <code class="literal">admin</code> privilege restriction:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>GRANT SELECT ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+------------------------------------------+
| Grants for u1@%                          |
+------------------------------------------+
| GRANT SELECT ON *.* TO `u1`@`%`          |
| REVOKE SELECT ON `mysql`.* FROM `u1`@`%` |
+------------------------------------------+
</pre></li><li class="listitem"><p>
            On the other hand, <code class="literal">u2</code> already holds a
            global <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> privilege
            without restriction. <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>
            can only add to a grantee's existing privileges, not reduce
            them, so if <code class="literal">admin</code> grants
            <a class="link" href="security.html#priv_select"><code class="literal">SELECT</code></a> globally to
            <code class="literal">u2</code>, <code class="literal">u2</code> does not
            inherit the <code class="literal">admin</code> restriction:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>GRANT SELECT ON *.* TO u2;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u2;</code></strong>
+---------------------------------+
| Grants for u2@%                 |
+---------------------------------+
| GRANT SELECT ON *.* TO `u2`@`%` |
+---------------------------------+
</pre></li></ul>
</div>
<p>
        If a <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statement includes an
        <code class="literal">AS <em class="replaceable"><code>user</code></em></code> clause,
        the privilege restrictions applied are those on the user/role
        combination specified by the clause, rather than those on the
        user who executes the statement. For information about the
        <code class="literal">AS</code> clause, see <a class="xref" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax">Section 13.7.1.6, “GRANT Syntax”</a>.
      </p><p>
        Restrictions on new privileges granted to an account are added
        to any existing restrictions for that account:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>REVOKE INSERT ON mysql.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+---------------------------------------------------------+
| Grants for u1@%                                         |
+---------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO `u1`@`%` |
| REVOKE INSERT ON `mysql`.* FROM `u1`@`%`                |
+---------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>REVOKE DELETE, UPDATE ON db2.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+---------------------------------------------------------+
| Grants for u1@%                                         |
+---------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO `u1`@`%` |
| REVOKE UPDATE, DELETE ON `db2`.* FROM `u1`@`%`          |
| REVOKE INSERT ON `mysql`.* FROM `u1`@`%`                |
+---------------------------------------------------------+
</pre><p>
        Aggregation of privilege restrictions applies both when
        privileges are partially revoked explicitly (as just shown) and
        when restrictions are inherited implicitly from the user who
        executes the statement or the user mentioned in an <code class="literal">AS
        <em class="replaceable"><code>user</code></em></code> clause.
      </p><p>
        If an account has a privilege restriction on a schema:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The account cannot grant to other accounts a privilege on
            the restricted schema or any object within it.
          </p></li><li class="listitem"><p>
            Another account that does not have the restriction can grant
            privileges to the restricted account for the restricted
            schema or objects within it. Suppose that an unrestricted
            user executes these statements:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER u1;
GRANT SELECT, INSERT, UPDATE ON *.* TO u1;
REVOKE SELECT, INSERT, UPDATE ON mysql.* FROM u1;
GRANT SELECT ON mysql.user TO u1;          -- grant table privilege
GRANT SELECT(Host,User) ON mysql.db TO u1; -- grant column privileges
</pre><p>
            The resulting account has these privileges, with the ability
            to perform limited operations within the restricted schema:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+-----------------------------------------------------------+
| Grants for u1@%                                           |
+-----------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE ON *.* TO `u1`@`%`           |
| REVOKE SELECT, INSERT, UPDATE ON `mysql`.* FROM `u1`@`%`  |
| GRANT SELECT (`Host`, `User`) ON `mysql`.`db` TO `u1`@`%` |
| GRANT SELECT ON `mysql`.`user` TO `u1`@`%`                |
+-----------------------------------------------------------+
</pre></li></ul>
</div>
<p>
        If an account has a restriction on a global privilege, the
        restriction is removed by any of these actions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Granting the privilege globally to the account by an account
            that has no restriction on the privilege.
          </p></li><li class="listitem"><p>
            Granting the privilege at the schema level.
          </p></li><li class="listitem"><p>
            Revoking the privilege globally.
</p></li></ul>
</div>
<p>
        Consider a user <code class="literal">u1</code> who holds several
        privileges globally, but with restrictions on
        <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a>,
        <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a> and
        <a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a>:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>REVOKE INSERT, UPDATE, DELETE ON mysql.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+----------------------------------------------------------+
| Grants for u1@%                                          |
+----------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO `u1`@`%`  |
| REVOKE INSERT, UPDATE, DELETE ON `mysql`.* FROM `u1`@`%` |
+----------------------------------------------------------+
</pre><p>
        Granting a privilege globally to <code class="literal">u1</code> from an
        account with no restriction removes the privilege restriction.
        For example, to remove the <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a>
        restriction:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>GRANT INSERT ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+---------------------------------------------------------+
| Grants for u1@%                                         |
+---------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO `u1`@`%` |
| REVOKE UPDATE, DELETE ON `mysql`.* FROM `u1`@`%`        |
+---------------------------------------------------------+
</pre><p>
        Granting a privilege at the schema level to
        <code class="literal">u1</code> removes the privilege restriction. For
        example, to remove the <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a>
        restriction:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>GRANT UPDATE ON mysql.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+---------------------------------------------------------+
| Grants for u1@%                                         |
+---------------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO `u1`@`%` |
| REVOKE DELETE ON `mysql`.* FROM `u1`@`%`                |
+---------------------------------------------------------+
</pre><p>
        Revoking a global privilege removes the privilege, including any
        restrictions on it. For example, to remove the
        <a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a> restriction (at the cost
        of removing all <a class="link" href="security.html#priv_delete"><code class="literal">DELETE</code></a> access):
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>REVOKE DELETE ON *.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+-------------------------------------------------+
| Grants for u1@%                                 |
+-------------------------------------------------+
| GRANT SELECT, INSERT, UPDATE ON *.* TO `u1`@`%` |
+-------------------------------------------------+
</pre><p>
        If an account has a privilege at both the global and schema
        levels, you must revoke it at the schema level twice to effect a
        partial revoke. Suppose that <code class="literal">u1</code> has these
        privileges, where <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> is held
        both globally and on the <code class="literal">world</code> schema:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT SELECT, INSERT ON *.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT INSERT ON world.* TO u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+-----------------------------------------+
| Grants for u1@%                         |
+-----------------------------------------+
| GRANT SELECT, INSERT ON *.* TO `u1`@`%` |
| GRANT INSERT ON `world`.* TO `u1`@`%`   |
+-----------------------------------------+
</pre><p>
        Revoking <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> on
        <code class="literal">world</code> revokes the schema-level privilege
        (<a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> no longer displays
        the schema-level <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>
        statement):
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>REVOKE INSERT ON world.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+-----------------------------------------+
| Grants for u1@%                         |
+-----------------------------------------+
| GRANT SELECT, INSERT ON *.* TO `u1`@`%` |
+-----------------------------------------+
</pre><p>
        Revoking <a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> on
        <code class="literal">world</code> again performs a partial revoke of the
        global privilege (<a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> now
        includes a schema-level <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a>
        statement):
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>REVOKE INSERT ON world.* FROM u1;</code></strong>
mysql&gt; <strong class="userinput"><code>SHOW GRANTS FOR u1;</code></strong>
+------------------------------------------+
| Grants for u1@%                          |
+------------------------------------------+
| GRANT SELECT, INSERT ON *.* TO `u1`@`%`  |
| REVOKE INSERT ON `world`.* FROM `u1`@`%` |
+------------------------------------------+
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="partial-revokes-versus-schema-grants"></a>Partial Revokes Versus Explicit Schema Grants</h4>

</div>

</div>

</div>
<p>
        To provide access to accounts for some schemas but not others,
        partial revokes provide an alternative to the approach of
        explicitly granting schema-level access without granting global
        privileges. The two approaches have different advantages and
        disadvantages.
      </p><p>
        Granting schema-level privileges and not global privileges:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Adding a new schema: The schema is inaccessible to existing
            accounts by default. For any account to which the schema
            should be accessible, the DBA must grant schema-level
            access.
          </p></li><li class="listitem"><p>
            Adding a new account: The DBA must grant schema-level access
            for each schema to which the account should have access.
</p></li></ul>
</div>
<p>
        Granting global privileges in conjunction with partial revokes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Adding a new schema: The schema is accessible to existing
            accounts that have global privileges. For any such account
            to which the schema should be inaccessible, the DBA must add
            a partial revoke.
          </p></li><li class="listitem"><p>
            Adding a new account: The DBA must grant the global
            privileges, plus a partial revoke on each restricted schema.
</p></li></ul>
</div>
<p>
        The approach that uses explicit schema-level grant is more
        convenient for accounts for which access is limited to a few
        schemas. The approach that uses partial revokes is more
        convenient for accounts with broad access to all schemas except
        a few.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="partial-revokes-disabling"></a>Disabling Partial Revokes</h4>

</div>

</div>

</div>
<p>
        Once enabled, <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a>
        cannot be disabled if any account has privilege restrictions. If
        any such account exists, disabling
        <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a> fails:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            For attempts to disable
            <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a> at startup,
            the server logs an error message and enables
            <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a>.
          </p></li><li class="listitem"><p>
            For attempts to disable
            <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a> at runtime,
            an error occurs and the
            <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a> value
            remains unchanged.
</p></li></ul>
</div>
<p>
        To disable <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a> when
        restrictions exist, the restrictions first must be removed:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Determine which accounts have partial revokes:
          </p><pre data-lang="sql" class="programlisting">
SELECT User, Host, User_attributes-&gt;&gt;'$.Restrictions'
FROM mysql.user WHERE User_attributes-&gt;&gt;'$.Restrictions' &lt;&gt; '';
</pre></li><li class="listitem"><p>
            For each such account, remove its privilege restrictions.
            Suppose that the previous step shows account
            <code class="literal">u1</code> to have these restrictions:
          </p><pre data-lang="sql" class="programlisting">
[{"Database": "world", "Privileges": ["INSERT", "DELETE"]
</pre><p>
            Restriction removal can be done various ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Grant the privileges globally, without restrictions:
              </p><pre data-lang="sql" class="programlisting">
GRANT INSERT, DELETE ON *.* TO u1;
</pre></li><li class="listitem"><p>
                Grant the privileges at the schema level:
              </p><pre data-lang="sql" class="programlisting">
GRANT INSERT, DELETE ON world.* TO u1;
</pre></li><li class="listitem"><p>
                Revoke the privileges globally (assuming that they are
                no longer needed):
              </p><pre data-lang="sql" class="programlisting">
REVOKE INSERT, DELETE ON *.* FROM u1;
</pre></li><li class="listitem"><p>
                Remove the account itself (assuming that it is no longer
                needed):
              </p><pre data-lang="sql" class="programlisting">
DROP USER u1;
</pre></li></ul>
</div>
</li></ol>
</div>
<p>
        After all privilege restrictions are removed, it is possible to
        disable partial revokes:
      </p><pre data-lang="sql" class="programlisting">
SET PERSIST partial_revokes = OFF;
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="partial-revokes-replication"></a>Partial Revokes and Replication</h4>

</div>

</div>

</div>
<p>
        In replication scenarios, if
        <a class="link" href="server-administration.html#sysvar_partial_revokes"><code class="literal">partial_revokes</code></a> is enabled on
        any host, it must be enabled on all hosts. Otherwise,
        <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> statements to partially
        revoke a global privilege do not have the same effect for all
        hosts on which replication occurs, potentially resulting in
        replication inconsistencies or errors.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="privilege-changes"></a>6.2.13 When Privilege Changes Take Effect</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091722457472"></a><a class="indexterm" name="idm140091722456016"></a><p>
      If the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server is started without the
      <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a> option, it
      reads all grant table contents into memory during its startup
      sequence. The in-memory tables become effective for access control
      at that point.
    </p><p>
      If you modify the grant tables indirectly using an
      account-management statement, the server notices these changes and
      loads the grant tables into memory again immediately.
      Account-management statements are described in
      <a class="xref" href="sql-syntax.html#account-management-sql" title="13.7.1 Account Management Statements">Section 13.7.1, “Account Management Statements”</a>. Examples include
      <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>,
      <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a>, <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET
      PASSWORD</code></a>, and <a class="link" href="sql-syntax.html#rename-user" title="13.7.1.7 RENAME USER Syntax"><code class="literal">RENAME
      USER</code></a>.
    </p><p>
      If you modify the grant tables directly using statements such as
      <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> (which is not recommended),
      the changes have no effect on privilege checking until you either
      tell the server to reload the tables or restart it. Thus, if you
      change the grant tables directly but forget to reload them, the
      changes have <span class="emphasis"><em>no effect</em></span> until you restart the
      server. This may leave you wondering why your changes seem to make
      no difference!
    </p><p>
      To tell the server to reload the grant tables, perform a
      flush-privileges operation. This can be done by issuing a
      <a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a> statement or by
      executing a <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-privileges</strong></span></a> or
      <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin reload</strong></span></a> command.
    </p><p>
      A grant table reload affects privileges for each existing client
      session as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Table and column privilege changes take effect with the
          client's next request.
        </p></li><li class="listitem"><p>
          Database privilege changes take effect the next time the
          client executes a <code class="literal">USE
          <em class="replaceable"><code>db_name</code></em></code> statement.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Client applications may cache the database name; thus, this
            effect may not be visible to them without actually changing
            to a different database.
</p>
</div>
</li><li class="listitem"><p>
          Global privileges and passwords are unaffected for a connected
          client. These changes take effect only in sessions for
          subsequent connections.
</p></li></ul>
</div>
<p>
      Changes to the set of active roles within a session take effect
      immediately, for that session only. The <a class="link" href="sql-syntax.html#set-role" title="13.7.1.11 SET ROLE Syntax"><code class="literal">SET
      ROLE</code></a> statement performs session role activation and
      deactivation (see <a class="xref" href="sql-syntax.html#set-role" title="13.7.1.11 SET ROLE Syntax">Section 13.7.1.11, “SET ROLE Syntax”</a>).
    </p><p>
      If the server is started with the
      <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a> option, it does
      not read the grant tables or implement any access control. Any
      user can connect and perform any operation, <span class="emphasis"><em>which is
      insecure.</em></span> To cause a server thus started to read the
      tables and enable access checking, flush the privileges.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="assigning-passwords"></a>6.2.14 Assigning Account Passwords</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091722425168"></a><a class="indexterm" name="idm140091722424128"></a><a class="indexterm" name="idm140091722423056"></a><a class="indexterm" name="idm140091722421568"></a><p>
      Required credentials for clients that connect to the MySQL server
      can include a password. This section describes how to assign
      passwords for MySQL accounts.
    </p><p>
      MySQL stores credentials in the <code class="literal">user</code> table in
      the <code class="literal">mysql</code> system database. Operations that
      assign or modify passwords are permitted only to users with the
      <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege, or,
      alternatively, privileges for the <code class="literal">mysql</code>
      database (<a class="link" href="security.html#priv_insert"><code class="literal">INSERT</code></a> privilege to
      create new accounts, <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a>
      privilege to modify existing accounts). If the
      <a class="link" href="server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a> system variable is
      enabled, use of account-modification statements such as
      <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
      <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> additionally requires
      the <a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a> or
      <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege.
    </p><p>
      The discussion here summarizes syntax only for the most common
      password-assignment statements. For complete details on other
      possibilities, see <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>,
      <a class="xref" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax">Section 13.7.1.1, “ALTER USER Syntax”</a>, and <a class="xref" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax">Section 13.7.1.10, “SET PASSWORD Syntax”</a>.
    </p><p>
      MySQL uses plugins to perform client authentication; see
      <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>. In password-assigning
      statements, the authentication plugin associated with an account
      performs any hashing required of a cleartext password specified.
      This enables MySQL to obfuscate passwords prior to storing them in
      the <code class="literal">mysql.user</code> system table. For the statements
      described here, MySQL automatically hashes the password specified.
      There are also syntaxes for <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE
      USER</code></a> and <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> that
      permit hashed values to be specified literally. For details, see
      the descriptions of those statements.
    </p><p>
      To assign a password when you create a new account, use
      <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> and include an
      <code class="literal">IDENTIFIED BY</code> clause:
    </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
      <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> also supports syntax
      for specifying the account authentication plugin. See
      <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>.
    </p><p>
      To assign or change a password for an existing account, use the
      <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> statement with an
      <code class="literal">IDENTIFIED BY</code> clause:
    </p><pre data-lang="sql" class="programlisting">
ALTER USER 'jeffrey'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
      If you are not connected as an anonymous user, you can change your
      own password without naming your own account literally:
    </p><pre data-lang="sql" class="programlisting">
ALTER USER USER() IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
      To change an account password from the command line, use the
      <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a> command:
    </p><pre data-lang="terminal" class="programlisting">
mysqladmin -u <em class="replaceable"><code>user_name</code></em> -h <em class="replaceable"><code>host_name</code></em> password "<em class="replaceable"><code>password</code></em>"
</pre><p>
      The account for which this command sets the password is the one
      with a row in the <code class="literal">mysql.user</code> system table that
      matches <em class="replaceable"><code>user_name</code></em> in the
      <code class="literal">User</code> column and the client host <span class="emphasis"><em>from
      which you connect</em></span> in the <code class="literal">Host</code>
      column.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
        Setting a password using <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a> should be
        considered <span class="emphasis"><em>insecure</em></span>. On some systems, your
        password becomes visible to system status programs such as
        <span class="command"><strong>ps</strong></span> that may be invoked by other users to
        display command lines. MySQL clients typically overwrite the
        command-line password argument with zeros during their
        initialization sequence. However, there is still a brief
        interval during which the value is visible. Also, on some
        systems this overwriting strategy is ineffective and the
        password remains visible to <span class="command"><strong>ps</strong></span>. (SystemV Unix
        systems and perhaps others are subject to this problem.)
</p>
</div>
<p>
      If you are using MySQL Replication, be aware that, currently, a
      password used by a replication slave as part of a
      <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1 CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER TO</code></a> statement is
      effectively limited to 32 characters in length; if the password is
      longer, any excess characters are truncated. This is not due to
      any limit imposed by the MySQL Server generally, but rather is an
      issue specific to MySQL Replication. (For more information, see
      Bug #43439.)
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="password-management"></a>6.2.15 Password Management</h3>

</div>

</div>

</div>
<p>
      MySQL supports these password-management capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Password expiration, to require passwords to be changed
          periodically.
        </p></li><li class="listitem"><p>
          Password reuse restrictions, to prevent old passwords from
          being chosen again.
        </p></li><li class="listitem"><p>
          Password verification, to require that password changes also
          specify the current password to be replaced.
        </p></li><li class="listitem"><p>
          Dual passwords, to enable clients to connect using either a
          primary or secondary password.
        </p></li><li class="listitem"><p>
          Password strength assessment, to require strong passwords.
</p></li></ul>
</div>
<p>
      The following sections these capabilities, except password
      strength assessment, which is implemented using the
      <code class="literal">validate_password</code> plugin and is described in
      <a class="xref" href="security.html#validate-password" title="6.4.3 The Password Validation Component">Section 6.4.3, “The Password Validation Component”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#password-expiration-policy" title="Password Expiration Policy">Password Expiration Policy</a></p></li><li class="listitem"><p><a class="xref" href="security.html#password-reuse-policy" title="Password Reuse Policy">Password Reuse Policy</a></p></li><li class="listitem"><p><a class="xref" href="security.html#password-reverification-policy" title="Password Verification-Required Policy">Password Verification-Required Policy</a></p></li><li class="listitem"><p><a class="xref" href="security.html#dual-passwords" title="Dual Password Support">Dual Password Support</a></p></li></ul>
</div>

<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
        MySQL implements password-management capabilities using tables
        in the <code class="literal">mysql</code> system database. If you upgrade
        MySQL from an earlier version, your system tables might not be
        up to date. In that case, the server writes messages similar to
        these to the error log during the startup process (the exact
        numbers may vary):
      </p><pre data-lang="none" class="programlisting">
[ERROR] Column count of mysql.user is wrong. Expected
49, found 47. The table is probably corrupted
[Warning] ACL table mysql.password_history missing.
Some operations may fail.
</pre><p>
        To correct the issue, perform the MySQL upgrade procedure. See
        <a class="xref" href="installing.html#upgrading" title="2.11 Upgrading MySQL">Section 2.11, “Upgrading MySQL”</a>. Until this is done,
        <span class="emphasis"><em>password changes are not possible.</em></span>
</p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        The password-management capabilities described here apply only
        to accounts that store credentials internally in the
        <code class="literal">mysql.user</code> system table
        (<code class="literal">mysql_native_password</code>,
        <code class="literal">sha256_password</code>, or
        <code class="literal">caching_sha2_password</code>). For accounts that use
        plugins that perform authentication against an external
        credential system, password management must be handled
        externally against that system as well.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="password-expiration-policy"></a>Password Expiration Policy</h4>

</div>

</div>

</div>
<p>
        MySQL enables database administrators to expire account
        passwords manually, and to establish a policy for automatic
        password expiration. Expiration policy can be established
        globally, and individual accounts can be set to either defer to
        the global policy or override the global policy with specific
        per-account behavior.
      </p><p>
        To expire an account password manually, use the
        <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> statement:
      </p><pre data-lang="sql" class="programlisting">
ALTER USER 'jeffrey'@'localhost' PASSWORD EXPIRE;
</pre><p>
        This operation marks the password expired in the corresponding
        row in the <code class="literal">mysql.user</code> system table.
      </p><p>
        Password expiration according to policy is automatic and is
        based on password age, which for a given account is assessed
        from the date and time of its most recent password change. The
        <code class="literal">mysql.user</code> system table indicates for each
        account when its password was last changed, and the server
        automatically treats the password as expired at client
        connection time if its age is greater than its permitted
        lifetime. This works with no explicit manual password
        expiration.
      </p><p>
        To establish automatic password-expiration policy globally, use
        the <a class="link" href="server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a>
        system variable. Its default value is 0, which disables
        automatic password expiration. If the value of
        <a class="link" href="server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a> is a
        positive integer <em class="replaceable"><code>N</code></em>, it indicates the
        permitted password lifetime, such that passwords must be changed
        every <em class="replaceable"><code>N</code></em> days.
      </p><p>
        Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To establish a global policy that passwords have a lifetime
            of approximately six months, start the server with these
            lines in a server <code class="filename">my.cnf</code> file:
          </p><pre data-lang="ini" class="programlisting">
[mysqld]
default_password_lifetime=180
</pre></li><li class="listitem"><p>
            To establish a global policy such that passwords never
            expire, set
            <a class="link" href="server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a>
            to 0:
          </p><pre data-lang="ini" class="programlisting">
[mysqld]
default_password_lifetime=0
</pre></li><li class="listitem"><p>
            <a class="link" href="server-administration.html#sysvar_default_password_lifetime"><code class="literal">default_password_lifetime</code></a>
            can also be set and persisted at runtime:
          </p><pre data-lang="sql" class="programlisting">
SET PERSIST default_password_lifetime = 180;
SET PERSIST default_password_lifetime = 0;
</pre><p>
            <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
            PERSIST</code></a> sets the value for the running MySQL
            instance. It also saves the value to be used for subsequent
            server restarts; see <a class="xref" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment">Section 13.7.5.1, “SET Syntax for Variable Assignment”</a>. To
            change a value for the running MySQL instance without saving
            it for subsequent restarts, use the
            <code class="literal">GLOBAL</code> keyword rather than
            <code class="literal">PERSIST</code>.
</p></li></ul>
</div>
<p>
        The global password-expiration policy applies to all accounts
        that have not been set to override it. To establish policy for
        individual accounts, use the <code class="literal">PASSWORD EXPIRE</code>
        option of the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> and
        <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> statements. See
        <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>, and <a class="xref" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax">Section 13.7.1.1, “ALTER USER Syntax”</a>.
      </p><p>
        Example account-specific statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Require the password to be changed every 90 days:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;
ALTER USER 'jeffrey'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;
</pre><p>
            This expiration option overrides the global policy for all
            accounts named by the statement.
          </p></li><li class="listitem"><p>
            Disable password expiration:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost' PASSWORD EXPIRE NEVER;
ALTER USER 'jeffrey'@'localhost' PASSWORD EXPIRE NEVER;
</pre><p>
            This expiration option overrides the global policy for all
            accounts named by the statement.
          </p></li><li class="listitem"><p>
            Defer to the global expiration policy for all accounts named
            by the statement:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost' PASSWORD EXPIRE DEFAULT;
ALTER USER 'jeffrey'@'localhost' PASSWORD EXPIRE DEFAULT;
</pre></li></ul>
</div>
<p>
        When a client successfully connects, the server determines
        whether the account password has expired:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The server checks whether the password has been manually
            expired.
          </p></li><li class="listitem"><p>
            Otherwise, the server checks whether the password age is
            greater than its permitted lifetime according to the
            automatic password expiration policy. If so, the server
            considers the password expired.
</p></li></ul>
</div>
<p>
        If the password is expired (whether manually or automatically),
        the server either disconnects the client or restricts the
        operations permitted to it (see
        <a class="xref" href="security.html#expired-password-handling" title="6.2.16 Server Handling of Expired Passwords">Section 6.2.16, “Server Handling of Expired Passwords”</a>). Operations
        performed by a restricted client result in an error until the
        user establishes a new account password:
      </p><a class="indexterm" name="idm140091722309904"></a><a class="indexterm" name="idm140091722308864"></a><a class="indexterm" name="idm140091722307376"></a><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT 1;</code></strong>
ERROR 1820 (HY000): You must reset your password using ALTER USER
statement before executing this statement.

mysql&gt; <strong class="userinput"><code>ALTER USER USER() IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';</code></strong>
Query OK, 0 rows affected (0.01 sec)

mysql&gt; <strong class="userinput"><code>SELECT 1;</code></strong>
+---+
| 1 |
+---+
| 1 |
+---+
1 row in set (0.00 sec)
</pre><p>
        After the client resets the password, the server restores normal
        access for the session, as well as for subsequent connections
        that use the account. It is also possible for an administrative
        user to reset the account password, but any existing restricted
        sessions for that account remain restricted. A client using the
        account must disconnect and reconnect before statements can be
        executed successfully.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          It is possible to <span class="quote">“<span class="quote">reset</span>”</span> a password by setting
          it to its current value. As a matter of good policy, it is
          preferable to choose a different password. DBAs can enforce
          non-reuse by establishing an appropriate password-reuse
          policy. See <a class="xref" href="security.html#password-reuse-policy" title="Password Reuse Policy">Password Reuse Policy</a>.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="password-reuse-policy"></a>Password Reuse Policy</h4>

</div>

</div>

</div>
<p>
        MySQL enables restrictions to be placed on reuse of previous
        passwords. Reuse restrictions can be established based on number
        of password changes, time elapsed, or both. Reuse policy can be
        established globally, and individual accounts can be set to
        either defer to the global policy or override the global policy
        with specific per-account behavior.
      </p><p>
        The password history for an account consists of passwords it has
        been assigned in the past. MySQL can restrict new passwords from
        being chosen from this history:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If an account is restricted on the basis of number of
            password changes, a new password cannot be chosen from a
            specified number of the most recent passwords. For example,
            if the minimum number of password changes is set to 3, a new
            password cannot be the same as any of the most recent 3
            passwords.
          </p></li><li class="listitem"><p>
            If an account is restricted based on time elapsed, a new
            password cannot be chosen from passwords in the history that
            are newer than a specified number of days. For example, if
            the password reuse interval is set to 60, a new password
            must not be among those previously chosen within the last 60
            days.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          The empty password does not count in the password history and
          is subject to reuse at any time.
</p>
</div>
<p>
        To establish password-reuse policy globally, use the
        <a class="link" href="server-administration.html#sysvar_password_history"><code class="literal">password_history</code></a> and
        <a class="link" href="server-administration.html#sysvar_password_reuse_interval"><code class="literal">password_reuse_interval</code></a> system
        variables.
      </p><p>
        Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To prohibit reusing any of the last 6 passwords or passwords
            newer than 365 days, put these lines in the server
            <code class="filename">my.cnf</code> file:
          </p><pre data-lang="ini" class="programlisting">
[mysqld]
password_history=6
password_reuse_interval=365
</pre></li><li class="listitem"><p>
            To set and persist the variables at runtime, use statements
            like this:
          </p><pre data-lang="ini" class="programlisting">
SET PERSIST password_history = 6;
SET PERSIST password_reuse_interval = 365;
</pre><p>
            <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
            PERSIST</code></a> sets the value for the running MySQL
            instance. It also saves the value to be used for subsequent
            server restarts; see <a class="xref" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment">Section 13.7.5.1, “SET Syntax for Variable Assignment”</a>. To
            change a value for the running MySQL instance without saving
            it for subsequent restarts, use the
            <code class="literal">GLOBAL</code> keyword rather than
            <code class="literal">PERSIST</code>.
</p></li></ul>
</div>
<p>
        The global password-reuse policy applies to all accounts that
        have not been set to override it. To establish policy for
        individual accounts, use the <code class="literal">PASSWORD HISTORY</code>
        and <code class="literal">PASSWORD REUSE INTERVAL</code> options of the
        <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> and
        <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> statements. See
        <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>, and <a class="xref" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax">Section 13.7.1.1, “ALTER USER Syntax”</a>.
      </p><p>
        Example account-specific statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Require a minimum of 5 password changes before permitting
            reuse:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost' PASSWORD HISTORY 5;
ALTER USER 'jeffrey'@'localhost' PASSWORD HISTORY 5;
</pre><p>
            This history-length option overrides the global policy for
            all accounts named by the statement.
          </p></li><li class="listitem"><p>
            Require a minimum of 365 days elapsed before permitting
            reuse:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost' PASSWORD REUSE INTERVAL 365 DAY;
ALTER USER 'jeffrey'@'localhost' PASSWORD REUSE INTERVAL 365 DAY;
</pre><p>
            This time-elapsed option overrides the global policy for all
            accounts named by the statement.
          </p></li><li class="listitem"><p>
            To combine both types of reuse restrictions, use
            <code class="literal">PASSWORD HISTORY</code> and <code class="literal">PASSWORD
            REUSE INTERVAL</code> together:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost'
  PASSWORD HISTORY 5
  PASSWORD REUSE INTERVAL 365 DAY;
ALTER USER 'jeffrey'@'localhost'
  PASSWORD HISTORY 5
  PASSWORD REUSE INTERVAL 365 DAY;
</pre><p>
            These options override both global policy reuse restrictions
            for all accounts named by the statement.
          </p></li><li class="listitem"><p>
            Defer to the global policy for both types of reuse
            restrictions:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost'
  PASSWORD HISTORY DEFAULT
  PASSWORD REUSE INTERVAL DEFAULT;
ALTER USER 'jeffrey'@'localhost'
  PASSWORD HISTORY DEFAULT
  PASSWORD REUSE INTERVAL DEFAULT;
</pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="password-reverification-policy"></a>Password Verification-Required Policy</h4>

</div>

</div>

</div>
<p>
        As of MySQL 8.0.13, it is possible to require that attempts to
        change an account password be verified by specifying the current
        password to be replaced. This enables DBAs to prevent users from
        changing a password without proving that they know the current
        password. Such changes could otherwise occur, for example, if
        one user walks away from a terminal session temporarily without
        logging out, and a malicious user uses the session to change the
        original user's MySQL password. This can have unfortunate
        consequences:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The original user becomes unable to access MySQL until the
            account password is reset by an administrator.
          </p></li><li class="listitem"><p>
            Until the password reset occurs, the malicious user can
            access MySQL with the benign user's changed credentials.
</p></li></ul>
</div>
<p>
        Password-verification policy can be established globally, and
        individual accounts can be set to either defer to the global
        policy or override the global policy with specific per-account
        behavior.
      </p><p>
        For each account, its <code class="literal">mysql.user</code> row
        indicates whether there is an account-specific setting requiring
        verification of the current password for password change
        attempts. The setting is established by the <code class="literal">PASSWORD
        REQUIRE</code> option of the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE
        USER</code></a> and <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>
        statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If the account setting is <code class="literal">PASSWORD REQUIRE
            CURRENT</code>, password changes must specify the current
            password.
          </p></li><li class="listitem"><p>
            If the account setting is <code class="literal">PASSWORD REQUIRE CURRENT
            OPTIONAL</code>, password changes may but need not
            specify the current password.
          </p></li><li class="listitem"><p>
            If the account setting is <code class="literal">PASSWORD REQUIRE CURRENT
            DEFAULT</code>, the
            <a class="link" href="server-administration.html#sysvar_password_require_current"><code class="literal">password_require_current</code></a>
            system variable determines the verification-required policy
            for the account:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                If
                <a class="link" href="server-administration.html#sysvar_password_require_current"><code class="literal">password_require_current</code></a>
                is enabled, password changes must specify the current
                password.
              </p></li><li class="listitem"><p>
                If
                <a class="link" href="server-administration.html#sysvar_password_require_current"><code class="literal">password_require_current</code></a>
                is disabled, password changes may but need not specify
                the current password.
</p></li></ul>
</div>
</li></ul>
</div>
<p>
        In other words, if the account setting is not <code class="literal">PASSWORD
        REQUIRE CURRENT DEFAULT</code>, the account setting takes
        precedence over the global policy established by the
        <a class="link" href="server-administration.html#sysvar_password_require_current"><code class="literal">password_require_current</code></a> system
        variable. Otherwise, the account defers to the
        <a class="link" href="server-administration.html#sysvar_password_require_current"><code class="literal">password_require_current</code></a>
        setting.
      </p><p>
        By default, password verification is optional:
        <a class="link" href="server-administration.html#sysvar_password_require_current"><code class="literal">password_require_current</code></a> is
        disabled and accounts created with no <code class="literal">PASSWORD
        REQUIRE</code> option default to <code class="literal">PASSWORD REQUIRE
        CURRENT DEFAULT</code>.
      </p><p>
        The following table shows how per-account settings interact with
        <a class="link" href="server-administration.html#sysvar_password_require_current"><code class="literal">password_require_current</code></a> system
        variable values to determine account password
        verification-required policy.
</p>
<div class="table">
<a name="password-verification-policy-table"></a><p class="title"><b>Table 6.10 Password-Verification Policy</b></p>
<div class="table-contents">
<table summary="Interaction of mysql.user table and password_require_current system variable for password-verification policy."><col width="40*"><col width="30*"><col width="30*"><thead><tr>
            <th scope="col">Per-Account Setting</th>
            <th scope="col">password_require_current System Variable</th>
            <th scope="col">Password Changes Require Current Password?</th>
          </tr></thead><tbody><tr>
            <td scope="row"><code class="literal">PASSWORD REQUIRE CURRENT</code></td>
            <td scope="row"><code class="literal">OFF</code></td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row"><code class="literal">PASSWORD REQUIRE CURRENT</code></td>
            <td scope="row"><code class="literal">ON</code></td>
            <td>Yes</td>
          </tr><tr>
            <td scope="row"><code class="literal">PASSWORD REQUIRE CURRENT OPTIONAL</code></td>
            <td scope="row"><code class="literal">OFF</code></td>
            <td>No</td>
          </tr><tr>
            <td scope="row"><code class="literal">PASSWORD REQUIRE CURRENT OPTIONAL</code></td>
            <td scope="row"><code class="literal">ON</code></td>
            <td>No</td>
          </tr><tr>
            <td scope="row"><code class="literal">PASSWORD REQUIRE CURRENT DEFAULT</code></td>
            <td scope="row"><code class="literal">OFF</code></td>
            <td>No</td>
          </tr><tr>
            <td scope="row"><code class="literal">PASSWORD REQUIRE CURRENT DEFAULT</code></td>
            <td scope="row"><code class="literal">ON</code></td>
            <td>Yes</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Privileged users can change any account password without
          specifying the current password, regardless of the
          verification-required policy. A privileged user is one who has
          the global <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a>
          privilege or the <a class="link" href="security.html#priv_update"><code class="literal">UPDATE</code></a>
          privilege for the <code class="literal">mysql</code> system database.
</p>
</div>
<p>
        To establish password-verification policy globally, use the
        <a class="link" href="server-administration.html#sysvar_password_require_current"><code class="literal">password_require_current</code></a> system
        variable. Its default value is <code class="literal">OFF</code>, so it is
        not required that account password changes specify the current
        password.
      </p><p>
        Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To establish a global policy that password changes must
            specify the current password, start the server with these
            lines in a server <code class="filename">my.cnf</code> file:
          </p><pre data-lang="ini" class="programlisting">
[mysqld]
password_require_current=ON
</pre></li><li class="listitem"><p>
            To set and persist
            <a class="link" href="server-administration.html#sysvar_password_require_current"><code class="literal">password_require_current</code></a> at
            runtime, use a statement such as one of these:
          </p><pre data-lang="sql" class="programlisting">
SET PERSIST password_require_current = ON;
SET PERSIST password_require_current = OFF;
</pre><p>
            <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
            PERSIST</code></a> sets the value for the running MySQL
            instance. It also saves the value to be used for subsequent
            server restarts; see <a class="xref" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment">Section 13.7.5.1, “SET Syntax for Variable Assignment”</a>. To
            change a value for the running MySQL instance without saving
            it for subsequent restarts, use the
            <code class="literal">GLOBAL</code> keyword rather than
            <code class="literal">PERSIST</code>.
</p></li></ul>
</div>
<p>
        The global password verification-required policy applies to all
        accounts that have not been set to override it. To establish
        policy for individual accounts, use the <code class="literal">PASSWORD
        REQUIRE</code> options of the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE
        USER</code></a> and <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>
        statements. See <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>, and
        <a class="xref" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax">Section 13.7.1.1, “ALTER USER Syntax”</a>.
      </p><p>
        Example account-specific statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Require that password changes specify the current password:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT;
ALTER USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT;
</pre><p>
            This verification option overrides the global policy for all
            accounts named by the statement.
          </p></li><li class="listitem"><p>
            Do not require that password changes specify the current
            password (the current password may but need not be given):
          </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT OPTIONAL;
ALTER USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT OPTIONAL;
</pre><p>
            This verification option overrides the global policy for all
            accounts named by the statement.
          </p></li><li class="listitem"><p>
            Defer to the global password verification-required policy
            for all accounts named by the statement:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT DEFAULT;
ALTER USER 'jeffrey'@'localhost' PASSWORD REQUIRE CURRENT DEFAULT;
</pre></li></ul>
</div>
<p>
        Verification of the current password comes into play when a user
        changes a password using the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER
        USER</code></a> or <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a>
        statement. The examples use <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER
        USER</code></a>, which is preferred over <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET
        PASSWORD</code></a>, but the principles described here are the
        same for both statements.
      </p><p>
        In password-change statements, a <code class="literal">REPLACE</code>
        clause specifies the current password to be replaced. Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Change the current user's password:
          </p><pre data-lang="sql" class="programlisting">
ALTER USER USER() IDENTIFIED BY '<em class="replaceable"><code>auth_string</code></em>' REPLACE '<em class="replaceable"><code>current_auth_string</code></em>';
</pre></li><li class="listitem"><p>
            Change a named user's password:
          </p><pre data-lang="sql" class="programlisting">
ALTER USER 'jeffrey'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>auth_string</code></em>'
  REPLACE '<em class="replaceable"><code>current_auth_string</code></em>';
</pre></li><li class="listitem"><p>
            Change a named user's authentication plugin and password:
          </p><pre data-lang="sql" class="programlisting">
ALTER USER 'jeffrey'@'localhost'
  IDENTIFIED WITH caching_sha2_password BY '<em class="replaceable"><code>auth_string</code></em>'
  REPLACE '<em class="replaceable"><code>current_auth_string</code></em>';
</pre></li></ul>
</div>
<p>
        The <code class="literal">REPLACE</code> clause works like this:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">REPLACE</code> must be given if password changes
            for the account are required to specify the current
            password, as verification that the user attempting to make
            the change actually knows the current password.
          </p></li><li class="listitem"><p>
            <code class="literal">REPLACE</code> is optional if password changes
            for the account may but need not specify the current
            password.
          </p></li><li class="listitem"><p>
            If <code class="literal">REPLACE</code> is specified, it must specify
            the correct current password, or an error occurs. This is
            true even if <code class="literal">REPLACE</code> is optional.
          </p></li><li class="listitem"><p>
            <code class="literal">REPLACE</code> can be specified only when
            changing the account password for the current user. (This
            means that in the examples just shown, the statements that
            explicitly name the account for <code class="literal">jeffrey</code>
            fail unless the current user is <code class="literal">jeffrey</code>.)
            This is true even if the change is attempted for another
            user by a privileged user; however, such a user can change
            any password without specifying <code class="literal">REPLACE</code>.
          </p></li><li class="listitem"><p>
            <code class="literal">REPLACE</code> is omitted from the binary log to
            avoid writing cleartext passwords to it.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="dual-passwords"></a>Dual Password Support</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091722138960"></a><a class="indexterm" name="idm140091722137472"></a><a class="indexterm" name="idm140091722136400"></a><a class="indexterm" name="idm140091722135328"></a><p>
        As of MySQL 8.0.14, user accounts are permitted to have dual
        passwords, designated as primary and secondary passwords.
        Dual-password capability makes it possible to seamlessly perform
        credential changes in scenarios like this:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A system has a large number of MySQL servers, possibly
            involving replication.
          </p></li><li class="listitem"><p>
            Multiple applications connect to different MySQL servers.
          </p></li><li class="listitem"><p>
            Periodic credential changes must be made to the account or
            accounts used by the applications to connect to the servers.
</p></li></ul>
</div>
<p>
        Consider how a credential change must be performed in the
        preceding type of scenario when an account is permitted only a
        single password. In this case, there must be close cooperation
        in the timing of when the account password change is made and
        propagated throughout all servers, and when all applications
        that use the account are updated to use the new password. This
        process may involve downtime during which servers or
        applications are unavailable.
      </p><p>
        With dual passwords, credential changes can be made more easily,
        in phases, without requiring close cooperation, and without
        downtime:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            For each affected account, establish a new primary password
            on the servers, retaining the current password as the
            secondary password. This enables servers to recognize either
            the primary or secondary password for each account, while
            applications can continue to connect to the servers using
            the same password as previously (which is now the secondary
            password).
          </p></li><li class="listitem"><p>
            After the password change has propagated to all servers,
            modify applications that use any affected account to connect
            using the account primary password.
          </p></li><li class="listitem"><p>
            After all applications have been migrated from the secondary
            passwords to the primary passwords, the secondary passwords
            are no longer needed and can be discarded. After this change
            has propagated to all servers, only the primary password for
            each account can be used to connect. The credential change
            is now complete.
</p></li></ol>
</div>
<p>
        MySQL implements dual-password capability with syntax that saves
        and discards secondary passwords:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <code class="literal">RETAIN CURRENT PASSWORD</code> clause for
            the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> and
            <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> statements saves
            an account current password as its secondary password when
            you assign a new primary password.
          </p></li><li class="listitem"><p>
            The <code class="literal">DISCARD OLD PASSWORD</code> clause for
            <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> discards an
            account secondary password, leaving only the primary
            password.
</p></li></ul>
</div>
<p>
        Suppose that, for the previously described credential-change
        scenario, an account named
        <code class="literal">'appuser1'@'host1.example.com'</code> is used by
        applications to connect to servers, and that the account
        password is to be changed from
        <code class="literal">'<em class="replaceable"><code>password_a</code></em>'</code> to
        <code class="literal">'<em class="replaceable"><code>password_b</code></em>'</code>.
      </p><p>
        To perform this change of credentials, use <code class="literal">ALTER
        USER</code> as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            On each server that is not a replication slave, establish
            <code class="literal">'<em class="replaceable"><code>password_b</code></em>'</code>
            as the new <code class="literal">appuser1</code> primary password,
            retaining the current password as the secondary password:
          </p><pre data-lang="sql" class="programlisting">
ALTER USER 'appuser1'@'host1.example.com'
  IDENTIFIED BY '<em class="replaceable"><code>password_b</code></em>'
  RETAIN CURRENT PASSWORD;
</pre></li><li class="listitem"><p>
            Wait for the password change to replicate throughout the
            system to all slave servers.
          </p></li><li class="listitem"><p>
            Modify each application that uses the
            <code class="literal">appuser1</code> account so that it connects to
            the servers using a password of
            <code class="literal">'<em class="replaceable"><code>password_b</code></em>'</code>
            rather than
            <code class="literal">'<em class="replaceable"><code>password_a</code></em>'</code>.
          </p></li><li class="listitem"><p>
            At this point, the secondary password is no longer needed.
            On each server that is not a replication slave, discard the
            secondary password:
          </p><pre data-lang="sql" class="programlisting">
ALTER USER 'appuser1'@'host1.example.com'
  DISCARD OLD PASSWORD;
</pre></li><li class="listitem"><p>
            After the discard-password change has replicated to all
            slave servers, the credential change is complete.
</p></li></ol>
</div>
<p>
        The <code class="literal">RETAIN CURRENT PASSWORD</code> and
        <code class="literal">DISCARD OLD PASSWORD</code> clauses have the
        following effects:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">RETAIN CURRENT PASSWORD</code> retains an
            account current password as its secondary password,
            replacing any existing secondary password. The new password
            becomes the primary password, but clients can use the
            account to connect to the server using either the primary or
            secondary password. (Exception: If the new password
            specified by the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>
            or <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> statement is
            empty, the secondary password becomes empty as well, even if
            <code class="literal">RETAIN CURRENT PASSWORD</code> is given.)
          </p></li><li class="listitem"><p>
            If you specify <code class="literal">RETAIN CURRENT PASSWORD</code>
            for an account that has an empty primary password, the
            statement fails.
          </p></li><li class="listitem"><p>
            If an account has a secondary password and you change its
            primary password without specifying <code class="literal">RETAIN CURRENT
            PASSWORD</code>, the secondary password remains
            unchanged.
          </p></li><li class="listitem"><p>
            For <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>, if you change
            the authentication plugin assigned to the account, the
            secondary password is discarded. If you change the
            authentication plugin and also specify <code class="literal">RETAIN
            CURRENT PASSWORD</code>, the statement fails.
          </p></li><li class="listitem"><p>
            For <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>,
            <code class="literal">DISCARD OLD PASSWORD</code> discards the
            secondary password, if one exists. The account retains only
            its primary password, and clients can use the account to
            connect to the server only with the primary password.
</p></li></ul>
</div>
<p>
        Statements that modify secondary passwords require these
        privileges:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The
            <a class="link" href="security.html#priv_application-password-admin"><code class="literal">APPLICATION_PASSWORD_ADMIN</code></a>
            privilege is required to use the <code class="literal">RETAIN CURRENT
            PASSWORD</code> or <code class="literal">DISCARD OLD
            PASSWORD</code> clause for <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER
            USER</code></a> and <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET
            PASSWORD</code></a> statements that apply to your own
            account. The privilege is required to manipulate your own
            secondary password because most users require only one
            password.
          </p></li><li class="listitem"><p>
            If an account is to be permitted to manipulate secondary
            passwords for all accounts, it should be granted the
            <a class="link" href="security.html#priv_create-user"><code class="literal">CREATE USER</code></a> privilege rather
            than
            <a class="link" href="security.html#priv_application-password-admin"><code class="literal">APPLICATION_PASSWORD_ADMIN</code></a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="expired-password-handling"></a>6.2.16 Server Handling of Expired Passwords</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091722069680"></a><a class="indexterm" name="idm140091722068608"></a><a class="indexterm" name="idm140091722067120"></a><p>
      MySQL provides password-expiration capability, which enables
      database administrators to require that users reset their
      password. Passwords can be expired manually, and on the basis of a
      policy for automatic expiration (see
      <a class="xref" href="security.html#password-management" title="6.2.15 Password Management">Section 6.2.15, “Password Management”</a>).
    </p><p>
      For each connection that uses an account with an expired password,
      the server either disconnects the client or restricts the client
      to <span class="quote">“<span class="quote">sandbox mode,</span>”</span> in which the server permits to the
      client only those operations necessary to reset the expired
      password. Which action is taken by the server depends on both
      client and server settings, as discussed later.
    </p><p>
      If the server disconnects the client, it returns an
      <a class="link" href="error-handling.html#error_er_must_change_password_login"><code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code></a>
      error:
    </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u myuser -p</code></strong>
Password: <strong class="userinput"><code>******</code></strong>
ERROR 1862 (HY000): Your password has expired. To log in you must
change it using a client that supports expired passwords.
</pre><p>
      If the server restricts the client to sandbox mode, these
      operations are permitted within the client session:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The client can reset the account password with
          <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> or
          <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a>. After the
          password has been reset, the server restores normal access for
          the session, as well as for subsequent connections that use
          the account.
        </p><p>
          It is possible to <span class="quote">“<span class="quote">reset</span>”</span> a password by setting
          it to its current value. As a matter of good policy, it is
          preferable to choose a different password. DBAs can enforce
          non-reuse by establishing an appropriate password-reuse
          policy. See <a class="xref" href="security.html#password-reuse-policy" title="Password Reuse Policy">Password Reuse Policy</a>.
        </p></li><li class="listitem"><p>
          The client can use
          <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET</code></a>
          statements.
</p></li></ul>
</div>
<p>
      For any operation not permitted within the session, the server
      returns an <a class="link" href="error-handling.html#error_er_must_change_password"><code class="literal">ER_MUST_CHANGE_PASSWORD</code></a>
      error:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>USE performance_schema;</code></strong>
ERROR 1820 (HY000): You must reset your password using ALTER USER
statement before executing this statement.

mysql&gt; <strong class="userinput"><code>SELECT 1;</code></strong>
ERROR 1820 (HY000): You must reset your password using ALTER USER
statement before executing this statement.
</pre><p>
      That is what normally happens for interactive invocations of the
      <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client because by default such
      invocations are put in sandbox mode. To clear the error and resume
      normal functioning, select a new password.
    </p><p>
      For noninteractive invocations of the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a>
      client (for example, in batch mode), the server normally
      disconnects the client if the password is expired. To permit
      noninteractive <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> invocations to stay
      connected so that the password can be changed (using the
      statements just described), add the
      <a class="link" href="programs.html#option_mysql_connect-expired-password"><code class="option">--connect-expired-password</code></a> option to
      the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> command.
    </p><p>
      As mentioned previously, whether the server disconnects an
      expired-password client or restricts it to sandbox mode depends on
      a combination of client and server settings. The following
      discussion describes the relevant settings and how they interact.
      The discussion applies only for accounts with expired passwords.
      If a client connects using a nonexpired password, the server
      handles the client normally.
    </p><p>
      On the client side, a given client indicates whether it can handle
      sandbox mode for expired passwords. For clients that use the C
      client library, there are two ways to do this:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Pass the
          <code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code> flag
          to <a class="link" href="connectors-apis.html#mysql-options" title="28.7.7.50 mysql_options()"><code class="literal">mysql_options()</code></a> prior to
          connecting:
        </p><pre data-lang="c" class="programlisting">
arg = 1;
result = mysql_options(mysql,
                       MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS,
                       &amp;arg);
</pre><p>
          The <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client enables
          <code class="literal">MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS</code> if
          invoked interactively or the
          <a class="link" href="programs.html#option_mysql_connect-expired-password"><code class="option">--connect-expired-password</code></a>
          option is given.
        </p></li><li class="listitem"><p>
          Pass the
          <code class="literal">CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS</code> flag to
          <a class="link" href="connectors-apis.html#mysql-real-connect" title="28.7.7.54 mysql_real_connect()"><code class="literal">mysql_real_connect()</code></a> at
          connection time:
        </p><pre data-lang="c" class="programlisting">
mysql = mysql_real_connect(mysql,
                           host, user, password, db,
                           port, unix_socket,
                           CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS);
</pre></li></ul>
</div>
<p>
      Other MySQL Connectors have their own conventions for indicating
      readiness to handle sandbox mode. See the documentation for the
      Connector in which you are interested.
    </p><p>
      On the server side, if a client indicates that it can handle
      expired passwords, the server puts it in sandbox mode.
    </p><p>
      If a client does not indicate that it can handle expired passwords
      (or uses an older version of the client library that cannot so
      indicate), the server action depends on the value of the
      <a class="link" href="server-administration.html#sysvar_disconnect_on_expired_password"><code class="literal">disconnect_on_expired_password</code></a>
      system variable:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If
          <a class="link" href="server-administration.html#sysvar_disconnect_on_expired_password"><code class="literal">disconnect_on_expired_password</code></a>
          is enabled (the default), the server disconnects the client
          with an
          <a class="link" href="error-handling.html#error_er_must_change_password_login"><code class="literal">ER_MUST_CHANGE_PASSWORD_LOGIN</code></a>
          error.
        </p></li><li class="listitem"><p>
          If
          <a class="link" href="server-administration.html#sysvar_disconnect_on_expired_password"><code class="literal">disconnect_on_expired_password</code></a>
          is disabled, the server puts the client in sandbox mode.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="pluggable-authentication"></a>6.2.17 Pluggable Authentication</h3>

</div>

</div>

</div>
<p>
      When a client connects to the MySQL server, the server uses the
      user name provided by the client and the client host to select the
      appropriate account row from the <code class="literal">mysql.user</code>
      system table. The server then authenticates the client,
      determining from the account row which authentication plugin
      applies to the client:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If the server cannot find the plugin, an error occurs and the
          connection attempt is rejected.
        </p></li><li class="listitem"><p>
          Otherwise, the server invokes that plugin to authenticate the
          user, and the plugin returns a status to the server indicating
          whether the user provided the correct password and is
          permitted to connect.
</p></li></ul>
</div>
<p>
      Pluggable authentication enables these important capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><b>Choice of authentication methods. </b>
            Pluggable authentication makes it easy for DBAs to choose
            and change the authentication method used for individual
            MySQL accounts.
          </p></li><li class="listitem"><p><b>External authentication. </b>
            Pluggable authentication makes it possible for clients to
            connect to the MySQL server with credentials appropriate for
            authentication methods that store credentials elsewhere than
            in the <code class="literal">mysql.user</code> system table. For
            example, plugins can be created to use external
            authentication methods such as PAM, Windows login IDs, LDAP,
            or Kerberos.
          </p></li><li class="listitem"><p><b>Proxy users: </b>
            If a user is permitted to connect, an authentication plugin
            can return to the server a user name different from the name
            of the connecting user, to indicate that the connecting user
            is a proxy for another user (the proxied user). While the
            connection lasts, the proxy user is treated, for purposes of
            access control, as having the privileges of the proxied
            user. In effect, one user impersonates another. For more
            information, see <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        If you start the server with the
        <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a> option,
        authentication plugins are not used even if loaded because the
        server performs no client authentication and permits any client
        to connect. Because this is insecure, if the server is started
        with the <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a>
        option, it enables
        <a class="link" href="server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a> automatically
        to prevent remote connections.
</p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#pluggable-authentication-available-plugins" title="Available Authentication Plugins">Available Authentication Plugins</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pluggable-authentication-usage" title="Authentication Plugin Usage">Authentication Plugin Usage</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pluggable-authentication-compatibility" title="Authentication Plugin Client/Server Compatibility">Authentication Plugin Client/Server Compatibility</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pluggable-authentication-connector-writing" title="Authentication Plugin Connector-Writing Considerations">Authentication Plugin Connector-Writing Considerations</a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="pluggable-authentication-available-plugins"></a>Available Authentication Plugins</h4>

</div>

</div>

</div>
<p>
        MySQL 8.0 provides these authentication plugins:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A plugin that performs native authentication; that is,
            authentication based on the password hashing method in use
            from before the introduction of pluggable authentication in
            MySQL. The <code class="literal">mysql_native_password</code> plugin
            implements authentication based on this native password
            hashing method. See
            <a class="xref" href="security.html#native-pluggable-authentication" title="6.4.1.1 Native Pluggable Authentication">Section 6.4.1.1, “Native Pluggable Authentication”</a>.
          </p></li><li class="listitem"><p>
            Plugins that perform authentication using SHA-256 password
            hashing. This is stronger encryption than that available
            with native authentication. See
            <a class="xref" href="security.html#sha256-pluggable-authentication" title="6.4.1.2 SHA-256 Pluggable Authentication">Section 6.4.1.2, “SHA-256 Pluggable Authentication”</a>, and
            <a class="xref" href="security.html#caching-sha2-pluggable-authentication" title="6.4.1.3 Caching SHA-2 Pluggable Authentication">Section 6.4.1.3, “Caching SHA-2 Pluggable Authentication”</a>.
          </p></li><li class="listitem"><p>
            A client-side plugin that sends the password to the server
            without hashing or encryption. This plugin is used in
            conjunction with server-side plugins that require access to
            the password exactly as provided by the client user. See
            <a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 Client-Side Cleartext Pluggable Authentication">Section 6.4.1.4, “Client-Side Cleartext Pluggable Authentication”</a>.
          </p></li><li class="listitem"><p>
            A plugin that performs external authentication using PAM
            (Pluggable Authentication Modules), enabling MySQL Server to
            use PAM to authenticate MySQL users. This plugin supports
            proxy users as well. See
            <a class="xref" href="security.html#pam-pluggable-authentication" title="6.4.1.5 PAM Pluggable Authentication">Section 6.4.1.5, “PAM Pluggable Authentication”</a>.
          </p></li><li class="listitem"><p>
            A plugin that performs external authentication on Windows,
            enabling MySQL Server to use native Windows services to
            authenticate client connections. Users who have logged in to
            Windows can connect from MySQL client programs to the server
            based on the information in their environment without
            specifying an additional password. This plugin supports
            proxy users as well. See
            <a class="xref" href="security.html#windows-pluggable-authentication" title="6.4.1.6 Windows Pluggable Authentication">Section 6.4.1.6, “Windows Pluggable Authentication”</a>.
          </p></li><li class="listitem"><p>
            Plugins that perform authentication using LDAP (Lightweight
            Directory Access Protocol) to authenticate MySQL users by
            accessing directory services such as X.500. These plugins
            support proxy users as well. See
            <a class="xref" href="security.html#ldap-pluggable-authentication" title="6.4.1.7 LDAP Pluggable Authentication">Section 6.4.1.7, “LDAP Pluggable Authentication”</a>.
          </p></li><li class="listitem"><p>
            A plugin that prevents all client connections to any account
            that uses it. Use cases for this plugin include proxied
            accounts that should never permit direct login but are
            accessed only through proxy accounts and accounts that must
            be able to execute stored programs and views with elevated
            privileges without exposing those privileges to ordinary
            users. See
            <a class="xref" href="security.html#no-login-pluggable-authentication" title="6.4.1.8 No-Login Pluggable Authentication">Section 6.4.1.8, “No-Login Pluggable Authentication”</a>.
          </p></li><li class="listitem"><p>
            A plugin that authenticates clients that connect from the
            local host through the Unix socket file. See
            <a class="xref" href="security.html#socket-pluggable-authentication" title="6.4.1.9 Socket Peer-Credential Pluggable Authentication">Section 6.4.1.9, “Socket Peer-Credential Pluggable Authentication”</a>.
          </p></li><li class="listitem"><p>
            A test plugin that checks account credentials and logs
            success or failure to the server error log. This plugin is
            intended for testing and development purposes, and as an
            example of how to write an authentication plugin. See
            <a class="xref" href="security.html#test-pluggable-authentication" title="6.4.1.10 Test Pluggable Authentication">Section 6.4.1.10, “Test Pluggable Authentication”</a>.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          For information about current restrictions on the use of
          pluggable authentication, including which connectors support
          which plugins, see
          <a class="xref" href="restrictions.html#pluggable-authentication-restrictions" title="C.9 Restrictions on Pluggable Authentication">Section C.9, “Restrictions on Pluggable Authentication”</a>.
        </p><p>
          Third-party connector developers should read that section to
          determine the extent to which a connector can take advantage
          of pluggable authentication capabilities and what steps to
          take to become more compliant.
</p>
</div>
<p>
        If you are interested in writing your own authentication
        plugins, see <a class="xref" href="extending-mysql.html#writing-authentication-plugins" title="29.2.4.9 Writing Authentication Plugins">Section 29.2.4.9, “Writing Authentication Plugins”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="pluggable-authentication-usage"></a>Authentication Plugin Usage</h4>

</div>

</div>

</div>
<p>
        This section provides general instructions for installing and
        using authentication plugins. For instructions specific to a
        given plugin, see the section that describes that plugin under
        <a class="xref" href="security.html#authentication-plugins" title="6.4.1 Authentication Plugins">Section 6.4.1, “Authentication Plugins”</a>.
      </p><p>
        In general, pluggable authentication uses a pair of
        corresponding plugins on the server and client sides, so you use
        a given authentication method like this:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If necessary, install the plugin library or libraries
            containing the appropriate plugins. On the server host,
            install the library containing the server-side plugin, so
            that the server can use it to authenticate client
            connections. Similarly, on each client host, install the
            library containing the client-side plugin for use by client
            programs. Authentication plugins that are built in need not
            be installed.
          </p></li><li class="listitem"><p>
            For each MySQL account that you create, specify the
            appropriate server-side plugin to use for authentication. If
            the account is to use the default authentication plugin, the
            account-creation statement need not specify the plugin
            explicitly. The
            <a class="link" href="server-administration.html#sysvar_default_authentication_plugin"><code class="literal">default_authentication_plugin</code></a>
            system variable configures the default authentication
            plugin.
          </p></li><li class="listitem"><p>
            When a client connects, the server-side plugin tells the
            client program which client-side plugin to use for
            authentication.
</p></li></ul>
</div>
<p>
        In the case that an account uses an authentication method that
        is the default for both the server and the client program, the
        server need not communicate to the client which client-side
        plugin to use, and a round trip in client/server negotiation can
        be avoided.
      </p><p>
        For standard MySQL clients such as <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> and
        <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a>, the
        <a class="link" href="programs.html#option_mysql_default-auth"><code class="option">--default-auth=<em class="replaceable"><code>plugin_name</code></em></code></a>
        option can be specified on the command line as a hint about
        which client-side plugin the program can expect to use, although
        the server will override this if the server-side plugin
        associated with the user account requires a different
        client-side plugin.
      </p><p>
        If the client program does not find the client-side plugin
        library file, specify a
        <a class="link" href="programs.html#option_mysql_plugin-dir"><code class="option">--plugin-dir=<em class="replaceable"><code>dir_name</code></em></code></a>
        option to indicate the plugin library directory location.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="pluggable-authentication-compatibility"></a>Authentication Plugin Client/Server Compatibility</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721954432"></a><p>
        Pluggable authentication enables flexibility in the choice of
        authentication methods for MySQL accounts, but in some cases
        client connections cannot be established due to authentication
        plugin incompatibility between the client and server.
      </p><p>
        The general compatibility principle for a successful client
        connection to a given account on a given server is that the
        client and server both must support the authentication
        <span class="emphasis"><em>method</em></span> required by the account. Because
        authentication methods are implemented by authentication
        plugins, the client and server both must support the
        authentication <span class="emphasis"><em>plugin</em></span> required by the
        account.
      </p><p>
        Authentication plugin incompatibilities can arise in various
        ways. Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Connect using a MySQL 5.7 client from 5.7.22 or lower to a
            MySQL 8.0 server account that authenticates with
            <code class="literal">caching_sha2_password</code>. This fails because
            the 5.7 client does not recognize the plugin, which was
            introduced in MySQL 8.0. (This issue is addressed in MySQL
            5.7 as of 5.7.23, when
            <code class="literal">caching_sha2_password</code> client-side support
            was added to the MySQL client library and client programs.)
          </p></li><li class="listitem"><p>
            Connect using a MySQL 5.5 client to a MySQL 5.6 server
            account that authenticates with
            <code class="literal">sha256_password</code>. This fails because the
            5.5 client does not recognize the plugin, which was
            introduced in MySQL 5.6.
          </p></li><li class="listitem"><p>
            Connect using a MySQL 5.7 client to a pre-5.7 server account
            that authenticates with
            <code class="literal">mysql_old_password</code>. This fails for
            multiple reasons. First, such a connection requires
            <code class="option">--secure-auth=0</code>, which is no longer a
            supported option. Even were it supported, the 5.7 client
            does not recognize the plugin because it was removed in
            MySQL 5.7.
          </p></li><li class="listitem"><p>
            Connect using a MySQL 5.7 client from a Community
            distribution to a MySQL 5.7 Enterprise server account that
            authenticates using one of the Enterprise-only LDAP
            authentication plugins. This fails because the Community
            client does not have access to the Enterprise plugin.
</p></li></ul>
</div>
<p>
        In general, these compatibility issues do not arise when
        connections are made between a client and server from the same
        MySQL distribution. When connections are made between a client
        and server from different MySQL series, issues can arise. These
        issues are inherent in the development process when MySQL
        introduces new authentication plugins or removes old ones. To
        minimize the potential for incompatibilities, regularly upgrade
        the server, clients, and connectors on a timely basis.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="pluggable-authentication-connector-writing"></a>Authentication Plugin Connector-Writing Considerations</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721939584"></a><p>
        Various implementations of the MySQL client/server protocol
        exist. The <code class="literal">libmysqlclient</code> C API client
        library is one implementation. Some MySQL connectors (typically
        those not written in C) provide their own implementation.
        However, not all protocol implementations handle plugin
        authentication the same way. This section describes an
        authentication issue that protocol implementors should take into
        account.
      </p><p>
        In the client/server protocol, the server tells connecting
        clients which authentication plugin it considers the default. If
        the protocol implementation used by the client tries to load the
        default plugin and that plugin does not exist on the client
        side, the load operation fails. This is an unnecessary failure
        if the default plugin is not the plugin actually required by the
        account to which the client is trying to connect.
      </p><p>
        If a client/server protocol implementation does not have its own
        notion of default authentication plugin and always tries to load
        the default plugin specified by the server, it will fail with an
        error if that plugin is not available.
      </p><p>
        To avoid this problem, the protocol implementation used by the
        client should have its own default plugin and should use it as
        its first choice (or, alternatively, fall back to this default
        in case of failure to load the default plugin specified by the
        server). Example:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            In MySQL 5.7, <code class="literal">libmysqlclient</code> uses as its
            default choice either
            <code class="literal">mysql_native_password</code> or the plugin
            specified through the <code class="literal">MYSQL_DEFAULT_AUTH</code>
            option for <a class="link" href="connectors-apis.html#mysql-options" title="28.7.7.50 mysql_options()"><code class="literal">mysql_options()</code></a>.
          </p></li><li class="listitem"><p>
            When a 5.7 client tries to connect to an 8.0 server, the
            server specifies <code class="literal">caching_sha2_password</code> as
            its default authentication plugin, but the client still
            sends credential details per either
            <code class="literal">mysql_native_password</code> or whatever is
            specified through <code class="literal">MYSQL_DEFAULT_AUTH</code>.
          </p></li><li class="listitem"><p>
            The only time the client loads the plugin specified by the
            server is for a change-plugin request, but in that case it
            can be any plugin depending on the user account. In this
            case, the client must try to load the plugin, and if that
            plugin is not available, an error is not optional.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="proxy-users"></a>6.2.18 Proxy Users</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721922400"></a><p>
      The MySQL server authenticates client connections using
      authentication plugins. The plugin that authenticates a given
      connection may request that the connecting (external) user be
      treated as a different user for privilege-checking purposes. This
      enables the external user to be a proxy for the second user; that
      is, to assume the privileges of the second user:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The external user is a <span class="quote">“<span class="quote">proxy user</span>”</span> (a user who
          can impersonate or become known as another user).
        </p></li><li class="listitem"><p>
          The second user is a <span class="quote">“<span class="quote">proxied user</span>”</span> (a user whose
          identity and privileges can be assumed by a proxy user).
</p></li></ul>
</div>
<p>
      This section describes how the proxy user capability works. For
      general information about authentication plugins, see
      <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>. For information about
      specific plugins, see <a class="xref" href="security.html#authentication-plugins" title="6.4.1 Authentication Plugins">Section 6.4.1, “Authentication Plugins”</a>.
      For information about writing authentication plugins that support
      proxy users, see
      <a class="xref" href="extending-mysql.html#writing-authentication-plugins-proxy-users" title="29.2.4.9.4 Implementing Proxy User Support in Authentication Plugins">Section 29.2.4.9.4, “Implementing Proxy User Support in Authentication Plugins”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#proxy-users-support-requirements" title="Requirements for Proxy User Support">Requirements for Proxy User Support</a></p></li><li class="listitem"><p><a class="xref" href="security.html#proxy-users-granting-proxy-privilege" title="Granting and Revoking the PROXY Privilege">Granting and Revoking the PROXY Privilege</a></p></li><li class="listitem"><p><a class="xref" href="security.html#default-proxy-users" title="Default Proxy Users">Default Proxy Users</a></p></li><li class="listitem"><p><a class="xref" href="security.html#proxy-users-conflicts" title="Default Proxy User and Anonymous User Conflicts">Default Proxy User and Anonymous User Conflicts</a></p></li><li class="listitem"><p><a class="xref" href="security.html#proxy-users-server-user-mapping" title="Server Support for Proxy User Mapping">Server Support for Proxy User Mapping</a></p></li><li class="listitem"><p><a class="xref" href="security.html#proxy-users-system-variables" title="Proxy User System Variables">Proxy User System Variables</a></p></li></ul>
</div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        As an alternative to proxy users, you may find that roles
        provide a suitable way to map users onto specific sets of named
        privileges. See <a class="xref" href="security.html#roles" title="6.2.10 Using Roles">Section 6.2.10, “Using Roles”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="proxy-users-support-requirements"></a>Requirements for Proxy User Support</h4>

</div>

</div>

</div>
<p>
        For proxying to occur for a given authentication plugin, these
        conditions must be satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Proxying must be supported, either by the plugin itself, or
            by the MySQL server on behalf of the plugin. In the latter
            case, server support may need to be enabled explicitly; see
            <a class="xref" href="security.html#proxy-users-server-user-mapping" title="Server Support for Proxy User Mapping">Server Support for Proxy User Mapping</a>.
          </p></li><li class="listitem"><p>
            The account for the external proxy user must be set up to be
            authenticated by the plugin. Use the
            <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement to
            associate an account with an authentication plugin, or
            <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> to change its
            plugin.
          </p></li><li class="listitem"><p>
            The account for the proxied user must exist and be granted
            the privileges to be assumed by the proxy user. Use the
            <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> and
            <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statements for this.
          </p></li><li class="listitem"><p>
            The proxy user account must have the
            <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for the
            proxied account. Use the
            <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statement for this.
          </p></li><li class="listitem"><p>
            For a client connecting to the proxy account to be treated
            as a proxy user, the authentication plugin must return a
            user name different from the client user name, to indicate
            the user name of the proxied account that defines the
            privileges to be assumed by the proxy user.
          </p><p>
            Alternatively, for plugins that are provided proxy mapping
            by the server, the proxied user is determined from the
            <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege held by the
            proxy user.
</p></li></ul>
</div>
<p>
        The proxy mechanism permits mapping only the external client
        user name to the proxied user name. There is no provision for
        mapping host names:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When a client connects to the server, the server determines
            the proper account based on the user name passed by the
            client program and the host from which the client connects.
          </p></li><li class="listitem"><p>
            If that account is a proxy account, the server attempts to
            find a match for a proxied account using the user name
            returned by the authentication plugin and the host name of
            the proxy account. The host name in the proxied account is
            ignored.
</p></li></ul>
</div>
<p>
        Consider the following account definitions:
      </p><pre data-lang="sql" class="programlisting">
-- create proxy account
CREATE USER 'employee_ext'@'localhost'
  IDENTIFIED WITH my_auth_plugin
  AS 'my_auth_string';

-- create proxied account and grant its privileges
CREATE USER 'employee'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>employee_password</code></em>';
GRANT ALL
  ON employees.*
  TO 'employee'@'localhost';

-- grant PROXY privilege to proxy account for proxied account
GRANT PROXY
  ON 'employee'@'localhost'
  TO 'employee_ext'@'localhost';
</pre><p>
        When a client connects as <code class="literal">employee_ext</code> from
        the local host, MySQL uses the plugin named
        <code class="literal">my_auth_plugin</code> to perform authentication.
        Suppose that <code class="literal">my_auth_plugin</code> returns a user
        name of <code class="literal">employee</code> to the server, based on the
        content of <code class="literal">'my_auth_string'</code> and perhaps by
        consulting some external authentication system. The name
        <code class="literal">employee</code> differs from
        <code class="literal">employee_ext</code>, so returning
        <code class="literal">employee</code> serves as a request to the server to
        treat the <code class="literal">employee_ext</code> external user, for
        purposes of privilege checking, as the
        <code class="literal">employee</code> local user.
      </p><p>
        In this case, <code class="literal">employee_ext</code> is the proxy user
        and <code class="literal">employee</code> is the proxied user.
      </p><p>
        The server verifies that proxy authentication for
        <code class="literal">employee</code> is possible for the
        <code class="literal">employee_ext</code> user by checking whether
        <code class="literal">employee_ext</code> (the proxy user) has the
        <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for
        <code class="literal">employee</code> (the proxied user). If this
        privilege has not been granted, an error occurs. Otherwise,
        <code class="literal">employee_ext</code> assumes the privileges of
        <code class="literal">employee</code>. The server checks statements
        executed during the client session by
        <code class="literal">employee_ext</code> against the privileges granted
        to <code class="literal">employee</code>. In this case,
        <code class="literal">employee_ext</code> can access tables in the
        <code class="literal">employees</code> database.
      </p><p>
        When proxying occurs, the <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a>
        and <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> functions can
        be used to see the difference between the connecting user (the
        proxy user) and the account whose privileges apply during the
        current session (the proxied user). For the example just
        described, those functions return these values:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+------------------------+--------------------+
| USER()                 | CURRENT_USER()     |
+------------------------+--------------------+
| employee_ext@localhost | employee@localhost |
+------------------------+--------------------+
</pre><p>
        In the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement that
        creates the proxy user account, the <code class="literal">IDENTIFIED
        WITH</code> clause that names the proxy-supporting
        authentication plugin is optionally followed by an <code class="literal">AS
        '<em class="replaceable"><code>auth_string</code></em>'</code> clause
        specifying a string that the server passes to the plugin when
        the user connects. If present, the string provides information
        that helps the plugin determine how to map the proxy (external)
        client user name to a proxied user name. It is up to each plugin
        whether it requires the <code class="literal">AS</code> clause. If so, the
        format of the authentication string depends on how the plugin
        intends to use it. Consult the documentation for a given plugin
        for information about the authentication string values it
        accepts.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="proxy-users-granting-proxy-privilege"></a>Granting and Revoking the PROXY Privilege</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721853616"></a><p>
        The <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege is needed to
        enable an external user to connect as and have the privileges of
        another user. To grant this privilege, use the
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statement. For example:
      </p><pre data-lang="sql" class="programlisting">
GRANT PROXY ON '<em class="replaceable"><code>proxied_user</code></em>' TO '<em class="replaceable"><code>proxy_user</code></em>';
</pre><a class="indexterm" name="idm140091721847344"></a><a class="indexterm" name="idm140091721845856"></a><p>
        The statement creates a row in the
        <code class="literal">mysql.proxies_priv</code> grant table.
      </p><p>
        At connection time, <em class="replaceable"><code>proxy_user</code></em> must
        represent a valid externally authenticated MySQL user, and
        <em class="replaceable"><code>proxied_user</code></em> must represent a valid
        locally authenticated user. Otherwise, the connection attempt
        fails.
      </p><p>
        The corresponding <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> syntax
        is:
      </p><pre data-lang="sql" class="programlisting">
REVOKE PROXY ON '<em class="replaceable"><code>proxied_user</code></em>' FROM '<em class="replaceable"><code>proxy_user</code></em>';
</pre><p>
        MySQL <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> and
        <a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE Syntax"><code class="literal">REVOKE</code></a> syntax extensions work as
        usual. Examples:
      </p><pre data-lang="sql" class="programlisting">
-- grant PROXY to multiple accounts
GRANT PROXY ON 'a' TO 'b', 'c', 'd';

-- revoke PROXY from multiple accounts
REVOKE PROXY ON 'a' FROM 'b', 'c', 'd';

-- grant PROXY to account and enable account to grant
-- PROXY to proxied account
GRANT PROXY ON 'a' TO 'd' WITH GRANT OPTION;

-- grant PROXY to anonymous account
GRANT PROXY ON 'a' TO ''@'';
</pre><p>
        The <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege can be
        granted in these cases:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            By a user that has <code class="literal">GRANT PROXY ... WITH GRANT
            OPTION</code> for
            <em class="replaceable"><code>proxied_user</code></em>.
          </p></li><li class="listitem"><p>
            By <em class="replaceable"><code>proxied_user</code></em> for itself: The
            value of <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> must exactly
            match <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> and
            <em class="replaceable"><code>proxied_user</code></em>, for both the user
            name and host name parts of the account name.
</p></li></ul>
</div>
<p>
        The initial <code class="literal">root</code> account created during MySQL
        installation has the
        <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY ... WITH GRANT
        OPTION</code></a> privilege for <code class="literal">''@''</code>, that
        is, for all users and all hosts. This enables
        <code class="literal">root</code> to set up proxy users, as well as to
        delegate to other accounts the authority to set up proxy users.
        For example, <code class="literal">root</code> can do this:
      </p><pre data-lang="sql" class="programlisting">
CREATE USER 'admin'@'localhost'
  IDENTIFIED BY 'test';
GRANT PROXY
  ON ''@''
  TO 'admin'@'localhost'
  WITH GRANT OPTION;
</pre><p>
        Those statements create an <code class="literal">admin</code> user that
        can manage all <code class="literal">GRANT PROXY</code> mappings. For
        example, <code class="literal">admin</code> can do this:
      </p><pre data-lang="sql" class="programlisting">
GRANT PROXY ON sally TO joe;
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="default-proxy-users"></a>Default Proxy Users</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721815088"></a><a class="indexterm" name="idm140091721813600"></a><p>
        To specify that some or all users should connect using a given
        authentication plugin, create a <span class="quote">“<span class="quote">blank</span>”</span> MySQL
        account (<code class="literal">''@''</code>), associate it with that
        plugin, and let the plugin return the real authenticated user
        name (if different from the blank user). For example, suppose
        that there exists a plugin named <code class="literal">ldap_auth</code>
        that implements LDAP authentication and maps connecting users
        onto either a developer or manager account. To set up proxying
        of users onto these accounts, use the following statements:
      </p><pre data-lang="sql" class="programlisting">
-- create default proxy account
CREATE USER ''@'' IDENTIFIED WITH ldap_auth
  AS 'O=Oracle, OU=MySQL';

-- create proxied accounts
CREATE USER 'developer'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>developer_password</code></em>';
CREATE USER 'manager'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>manager_password</code></em>';

-- grant PROXY privilege to default proxy account for proxied accounts
GRANT PROXY
  ON 'manager'@'localhost'
  TO ''@'';
GRANT PROXY
  ON 'developer'@'localhost'
  TO ''@'';
</pre><p>
        Now assume that a client connects as follows:
      </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=myuser --password ...</code></strong>
Enter password: <em class="replaceable"><code>myuser_password</code></em>
</pre><p>
        The server will not find <code class="literal">myuser</code> defined as a
        MySQL user. But because there is a blank user account
        (<code class="literal">''@''</code>) that matches the client user name and
        host name, the server authenticates the client against that
        account: The server invokes the <code class="literal">ldap_auth</code>
        authentication plugin and passes <code class="literal">myuser</code> and
        <em class="replaceable"><code>myuser_password</code></em> to it as the user
        name and password.
      </p><p>
        If the <code class="literal">ldap_auth</code> plugin finds in the LDAP
        directory that <em class="replaceable"><code>myuser_password</code></em> is not
        the correct password for <code class="literal">myuser</code>,
        authentication fails and the server rejects the connection.
      </p><p>
        If the password is correct and <code class="literal">ldap_auth</code>
        finds that <code class="literal">myuser</code> is a developer, it returns
        the user name <code class="literal">developer</code> to the MySQL server,
        rather than <code class="literal">myuser</code>. Returning a user name
        different from the client user name of <code class="literal">myuser</code>
        signals to the server that it should treat
        <code class="literal">myuser</code> as a proxy. The server verifies that
        <code class="literal">''@''</code> can authenticate as
        <code class="literal">developer</code> (because that account has the
        <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege to do so) and
        accepts the connection. The session proceeds with
        <code class="literal">myuser</code> having the privileges of
        <code class="literal">developer</code>, the proxied user. (These
        privileges should be set up by the DBA using
        <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a> statements, not shown.) The
        <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> and
        <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> functions return
        these values:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+------------------+---------------------+
| USER()           | CURRENT_USER()      |
+------------------+---------------------+
| myuser@localhost | developer@localhost |
+------------------+---------------------+
</pre><p>
        If the plugin instead finds in the LDAP directory that
        <code class="literal">myuser</code> is a manager, it returns
        <code class="literal">manager</code> as the user name and the session
        proceeds with <code class="literal">myuser</code> having the privileges of
        <code class="literal">manager</code>.
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+------------------+-------------------+
| USER()           | CURRENT_USER()    |
+------------------+-------------------+
| myuser@localhost | manager@localhost |
+------------------+-------------------+
</pre><p>
        For simplicity, external authentication cannot be multilevel:
        Neither the credentials for <code class="literal">developer</code> nor
        those for <code class="literal">manager</code> are taken into account in
        the preceding example. However, they are still used if a client
        tries to connect and authenticate directly as the
        <code class="literal">developer</code> or <code class="literal">manager</code>
        account, which is why those proxied accounts should be assigned
        passwords.
      </p><p>
        Other ways to ensure that the proxied accounts cannot be used
        directly:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Include the <code class="literal">ACCOUNT LOCK</code> option when you
            create the accounts. See <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>.
          </p></li><li class="listitem"><p>
            Associate the accounts with the
            <code class="literal">mysql_no_login</code> authentication plugin. See
            <a class="xref" href="security.html#no-login-pluggable-authentication" title="6.4.1.8 No-Login Pluggable Authentication">Section 6.4.1.8, “No-Login Pluggable Authentication”</a>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="proxy-users-conflicts"></a>Default Proxy User and Anonymous User Conflicts</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721767984"></a><p>
        If you intend to create a default proxy user, check for other
        existing <span class="quote">“<span class="quote">match any user</span>”</span> accounts that take
        precedence over the default proxy user because they can prevent
        that user from working as intended.
      </p><p>
        In the preceding discussion, the default proxy user account has
        <code class="literal">''</code> in the host part, which matches any host.
        If you set up a default proxy user, take care to also check
        whether nonproxy accounts exist with the same user part and
        <code class="literal">'%'</code> in the host part, because
        <code class="literal">'%'</code> also matches any host, but has precedence
        over <code class="literal">''</code> by the rules that the server uses to
        sort account rows internally (see
        <a class="xref" href="security.html#connection-access" title="6.2.6 Access Control, Stage 1: Connection Verification">Section 6.2.6, “Access Control, Stage 1: Connection Verification”</a>).
      </p><p>
        Suppose that a MySQL installation includes these two accounts:
      </p><pre data-lang="sql" class="programlisting">
-- create default proxy account
CREATE USER ''@''
  IDENTIFIED WITH some_plugin
  AS 'some_auth_string';
-- create anonymous account
CREATE USER ''@'%'
  IDENTIFIED BY '<em class="replaceable"><code>some_password</code></em>';
</pre><p>
        The first account (<code class="literal">''@''</code>) is intended as the
        default proxy user, used to authenticate connections for users
        who do not otherwise match a more-specific account. The second
        account (<code class="literal">''@'%'</code>) is an anonymous-user
        account, which might have been created, for example, to enable
        users without their own account to connect anonymously.
      </p><p>
        Both accounts have the same user part (<code class="literal">''</code>),
        which matches any user. And each account has a host part that
        matches any host. Nevertheless, there is a priority in account
        matching for connection attempts because the matching rules sort
        a host of <code class="literal">'%'</code> ahead of <code class="literal">''</code>.
        For accounts that do not match any more-specific account, the
        server attempts to authenticate them against
        <code class="literal">''@'%'</code> (the anonymous user) rather than
        <code class="literal">''@''</code> (the default proxy user). As a result,
        the default proxy account is never used.
      </p><p>
        To avoid this problem, use one of the following strategies:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Remove the anonymous account so that it does not conflict
            with the default proxy user. This might be a good idea
            anyway if you want to associate every connection with a
            named user.
          </p></li><li class="listitem"><p>
            Use a more-specific default proxy user that matches ahead of
            the anonymous user. For example, to permit only
            <code class="literal">localhost</code> proxy connections, use
            <code class="literal">''@'localhost'</code>:
          </p><pre data-lang="sql" class="programlisting">
CREATE USER ''@'localhost'
  IDENTIFIED WITH some_plugin
  AS 'some_auth_string';
</pre><p>
            In addition, modify any <code class="literal">GRANT PROXY</code>
            statements to name <code class="literal">''@'localhost'</code> rather
            than <code class="literal">''@''</code> as the proxy user.
          </p><p>
            Be aware that this strategy prevents anonymous-user
            connections from <code class="literal">localhost</code>.
          </p></li><li class="listitem"><p>
            Use a named default account rather than an anonymous default
            account. For an example of this technique, consult the
            instructions for using the
            <code class="literal">authentication_windows</code> plugin. See
            <a class="xref" href="security.html#windows-pluggable-authentication" title="6.4.1.6 Windows Pluggable Authentication">Section 6.4.1.6, “Windows Pluggable Authentication”</a>
          </p></li><li class="listitem"><p>
            Create multiple proxy users, one for local connections and
            one for <span class="quote">“<span class="quote">everything else</span>”</span> (remote connections).
            This can be useful particularly when local users should have
            different privileges from remote users.
          </p><p>
            Create the proxy users:
          </p><pre data-lang="sql" class="programlisting">
-- create proxy user for local connections
CREATE USER ''@'localhost'
  IDENTIFIED WITH some_plugin
  AS 'some_auth_string';
-- create proxy user for remote connections
CREATE USER ''@'%'
  IDENTIFIED WITH some_plugin
  AS 'some_auth_string';
</pre><p>
            Create the proxied users:
          </p><pre data-lang="sql" class="programlisting">
-- create proxied user for local connections
CREATE USER 'developer'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>some_password</code></em>';
-- create proxied user for remote connections
CREATE USER 'developer'@'%'
  IDENTIFIED BY '<em class="replaceable"><code>some_password</code></em>';
</pre><p>
            Grant the proxy privilege to each proxy user for the
            corresponding proxied user:
          </p><pre data-lang="sql" class="programlisting">
GRANT PROXY
  ON 'developer'@'localhost'
  TO ''@'localhost';
GRANT PROXY
  ON 'developer'@'%'
  TO ''@'%';
</pre><p>
            Finally, grant appropriate privileges to the local and
            remote proxied users (not shown).
          </p><p>
            Assume that the
            <code class="literal">some_plugin</code>/<code class="literal">'some_auth_string'</code>
            combination causes <code class="literal">some_plugin</code> to map the
            client user name to <code class="literal">developer</code>. Local
            connections match the <code class="literal">''@'localhost'</code>
            proxy user, which maps to the
            <code class="literal">'developer'@'localhost'</code> proxied user.
            Remote connections match the <code class="literal">''@'%'</code> proxy
            user, which maps to the <code class="literal">'developer'@'%'</code>
            proxied user.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="proxy-users-server-user-mapping"></a>Server Support for Proxy User Mapping</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721726064"></a><p>
        Some authentication plugins implement proxy user mapping for
        themselves (for example, the PAM and Windows authentication
        plugins). Other authentication plugins do not support proxy
        users by default. Of these, some can request that the MySQL
        server itself map proxy users according to granted proxy
        privileges: <code class="literal">mysql_native_password</code>,
        <code class="literal">sha256_password</code>. If the
        <a class="link" href="server-administration.html#sysvar_check_proxy_users"><code class="literal">check_proxy_users</code></a> system
        variable is enabled, the server performs proxy user mapping for
        any authentication plugins that make such a request:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            By default,
            <a class="link" href="server-administration.html#sysvar_check_proxy_users"><code class="literal">check_proxy_users</code></a> is
            disabled, so the server performs no proxy user mapping even
            for authentication plugins that request server support for
            proxy users.
          </p><a class="indexterm" name="idm140091721718576"></a><a class="indexterm" name="idm140091721717536"></a></li><li class="listitem"><p>
            If <a class="link" href="server-administration.html#sysvar_check_proxy_users"><code class="literal">check_proxy_users</code></a> is
            enabled, it may also be necessary to enable a
            plugin-specific system variable to take advantage of server
            proxy user mapping support:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                For the <code class="literal">mysql_native_password</code> plugin,
                enable
                <a class="link" href="server-administration.html#sysvar_mysql_native_password_proxy_users"><code class="literal">mysql_native_password_proxy_users</code></a>.
              </p><a class="indexterm" name="idm140091721710736"></a><a class="indexterm" name="idm140091721709696"></a></li><li class="listitem"><p>
                For the <code class="literal">sha256_password</code> plugin,
                enable
                <a class="link" href="server-administration.html#sysvar_sha256_password_proxy_users"><code class="literal">sha256_password_proxy_users</code></a>.
</p><a class="indexterm" name="idm140091721705344"></a><a class="indexterm" name="idm140091721704240"></a></li></ul>
</div>
</li></ul>
</div>
<p>
        Proxy user mapping performed by the server is subject to these
        restrictions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The server will not proxy to or from an anonymous user, even
            if the associated <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a>
            privilege is granted.
          </p></li><li class="listitem"><p>
            When a single account has been granted proxy privileges for
            more than one proxied account, server proxy user mapping is
            nondeterministic. Therefore, granting to a single account
            proxy privileges for multiple proxied accounts is
            discouraged.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="proxy-users-system-variables"></a>Proxy User System Variables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721696864"></a><p>
        Two system variables help trace the proxy login process:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="server-administration.html#sysvar_proxy_user"><code class="literal">proxy_user</code></a>: This value is
            <code class="literal">NULL</code> if proxying is not used. Otherwise,
            it indicates the proxy user account. For example, if a
            client authenticates through the <code class="literal">''@''</code>
            proxy account, this variable is set as follows:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@proxy_user;</code></strong>
+--------------+
| @@proxy_user |
+--------------+
| ''@''        |
+--------------+
</pre></li><li class="listitem"><p>
            <a class="link" href="server-administration.html#sysvar_external_user"><code class="literal">external_user</code></a>: Sometimes
            the authentication plugin may use an external user to
            authenticate to the MySQL server. For example, when using
            Windows native authentication, a plugin that authenticates
            using the windows API does not need the login ID passed to
            it. However, it still uses a Windows user ID to
            authenticate. The plugin may return this external user ID
            (or the first 512 UTF-8 bytes of it) to the server using the
            <code class="literal">external_user</code> read-only session variable.
            If the plugin does not set this variable, its value is
            <code class="literal">NULL</code>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="account-locking"></a>6.2.19 Account Locking</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721683776"></a><p>
      MySQL supports locking and unlocking user accounts using the
      <code class="literal">ACCOUNT LOCK</code> and <code class="literal">ACCOUNT
      UNLOCK</code> clauses for the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE
      USER</code></a> and <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>
      statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          When used with <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
          these clauses specify the initial locking state for a new
          account. In the absence of either clause, the account is
          created in an unlocked state.
        </p></li><li class="listitem"><p>
          When used with <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>,
          these clauses specify the new locking state for an existing
          account. In the absence of either clause, the account locking
          state remains unchanged.
</p></li></ul>
</div>
<p>
      Account locking state is recorded in the
      <code class="literal">account_locked</code> column of the
      <code class="literal">mysql.user</code> system table. The output from
      <a class="link" href="sql-syntax.html#show-create-user" title="13.7.6.12 SHOW CREATE USER Syntax"><code class="literal">SHOW CREATE USER</code></a> indicates whether
      an account is locked or unlocked.
    </p><p>
      If a client attempts to connect to a locked account, the attempt
      fails. The server increments the
      <a class="link" href="server-administration.html#statvar_Locked_connects"><code class="literal">Locked_connects</code></a> status variable
      that indicates the number of attempts to connect to a locked
      account, returns an
      <a class="link" href="error-handling.html#error_er_account_has_been_locked"><code class="literal">ER_ACCOUNT_HAS_BEEN_LOCKED</code></a> error,
      and writes a message to the error log:
    </p><pre data-lang="none" class="programlisting">
Access denied for user '<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'.
Account is locked.
</pre><p>
      Locking an account does not affect being able to connect using a
      proxy user that assumes the identity of the locked account. It
      also does not affect the ability to execute stored programs or
      views that have a <code class="literal">DEFINER</code> clause naming the
      locked account. That is, the ability to use a proxied account or
      stored programs or views is not affected by locking the account.
    </p><p>
      The account-locking capability depends on the presence of the
      <code class="literal">account_locked</code> column in the
      <code class="literal">mysql.user</code> system table. For upgrades from
      MySQL versions older than 5.7.6, perform the MySQL upgrade
      procedure to ensure that this column exists. See
      <a class="xref" href="installing.html#upgrading" title="2.11 Upgrading MySQL">Section 2.11, “Upgrading MySQL”</a>. For nonupgraded installations that
      have no <code class="literal">account_locked</code> column, the server
      treats all accounts as unlocked, and using the <code class="literal">ACCOUNT
      LOCK</code> or <code class="literal">ACCOUNT UNLOCK</code> clauses
      produces an error.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="user-resources"></a>6.2.20 Setting Account Resource Limits</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721657328"></a><a class="indexterm" name="idm140091721655872"></a><a class="indexterm" name="idm140091721654384"></a><a class="indexterm" name="idm140091721653312"></a><a class="indexterm" name="idm140091721652240"></a><a class="indexterm" name="idm140091721651152"></a><p>
      One means of restricting client use of MySQL server resources is
      to set the global
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> system
      variable to a nonzero value. This limits the number of
      simultaneous connections that can be made by any given account,
      but places no limits on what a client can do once connected. In
      addition, setting
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> does not
      enable management of individual accounts. Both types of control
      are of interest to MySQL administrators.
    </p><p>
      To address such concerns, MySQL permits limits for individual
      accounts on use of these server resources:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The number of queries an account can issue per hour
        </p></li><li class="listitem"><p>
          The number of updates an account can issue per hour
        </p></li><li class="listitem"><p>
          The number of times an account can connect to the server per
          hour
        </p></li><li class="listitem"><p>
          The number of simultaneous connections to the server by an
          account
</p></li></ul>
</div>
<p>
      Any statement that a client can issue counts against the query
      limit. Only statements that modify databases or tables count
      against the update limit.
    </p><p>
      An <span class="quote">“<span class="quote">account</span>”</span> in this context corresponds to a row in
      the <code class="literal">mysql.user</code> system table. That is, a
      connection is assessed against the <code class="literal">User</code> and
      <code class="literal">Host</code> values in the <code class="literal">user</code>
      table row that applies to the connection. For example, an account
      <code class="literal">'usera'@'%.example.com'</code> corresponds to a row in
      the <code class="literal">user</code> table that has <code class="literal">User</code>
      and <code class="literal">Host</code> values of <code class="literal">usera</code> and
      <code class="literal">%.example.com</code>, to permit
      <code class="literal">usera</code> to connect from any host in the
      <code class="literal">example.com</code> domain. In this case, the server
      applies resource limits in this row collectively to all
      connections by <code class="literal">usera</code> from any host in the
      <code class="literal">example.com</code> domain because all such connections
      use the same account.
    </p><p>
      Before MySQL 5.0, an <span class="quote">“<span class="quote">account</span>”</span> was assessed against
      the actual host from which a user connects. This older method of
      accounting may be selected by starting the server with the
      <a class="link" href="server-administration.html#option_mysqld_old-style-user-limits"><code class="option">--old-style-user-limits</code></a> option. In
      this case, if <code class="literal">usera</code> connects simultaneously
      from <code class="literal">host1.example.com</code> and
      <code class="literal">host2.example.com</code>, the server applies the
      account resource limits separately to each connection. If
      <code class="literal">usera</code> connects again from
      <code class="literal">host1.example.com</code>, the server applies the
      limits for that connection together with the existing connection
      from that host.
    </p><p>
      To establish resource limits for an account at account-creation
      time, use the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>
      statement. To modify the limits for an existing account, use
      <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>. Provide a
      <code class="literal">WITH</code> clause that names each resource to be
      limited. The default value for each limit is zero (no limit). For
      example, to create a new account that can access the
      <code class="literal">customer</code> database, but only in a limited
      fashion, issue these statements:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE USER 'francis'@'localhost' IDENTIFIED BY 'frank'</code></strong>
    -&gt; <strong class="userinput"><code>    WITH MAX_QUERIES_PER_HOUR 20</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_UPDATES_PER_HOUR 10</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_CONNECTIONS_PER_HOUR 5</code></strong>
    -&gt; <strong class="userinput"><code>         MAX_USER_CONNECTIONS 2;</code></strong>
</pre><p>
      The limit types need not all be named in the
      <code class="literal">WITH</code> clause, but those named can be present in
      any order. The value for each per-hour limit should be an integer
      representing a count per hour. For
      <code class="literal">MAX_USER_CONNECTIONS</code>, the limit is an integer
      representing the maximum number of simultaneous connections by the
      account. If this limit is set to zero, the global
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> system
      variable value determines the number of simultaneous connections.
      If <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> is also
      zero, there is no limit for the account.
    </p><p>
      To modify limits for an existing account, use an
      <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> statement. The following
      statement changes the query limit for <code class="literal">francis</code>
      to 100:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER USER 'francis'@'localhost' WITH MAX_QUERIES_PER_HOUR 100;</code></strong>
</pre><p>
      The statement modifies only the limit value specified and leaves
      the account otherwise unchanged.
    </p><p>
      To remove a limit, set its value to zero. For example, to remove
      the limit on how many times per hour <code class="literal">francis</code>
      can connect, use this statement:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER USER 'francis'@'localhost' WITH MAX_CONNECTIONS_PER_HOUR 0;</code></strong>
</pre><p>
      As mentioned previously, the simultaneous-connection limit for an
      account is determined from the
      <code class="literal">MAX_USER_CONNECTIONS</code> limit and the
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> system
      variable. Suppose that the global
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> value is 10
      and three accounts have individual resource limits specified as
      follows:
    </p><pre data-lang="sql" class="programlisting">
ALTER USER 'user1'@'localhost' WITH MAX_USER_CONNECTIONS 0;
ALTER USER 'user2'@'localhost' WITH MAX_USER_CONNECTIONS 5;
ALTER USER 'user3'@'localhost' WITH MAX_USER_CONNECTIONS 20;
</pre><p>
      <code class="literal">user1</code> has a connection limit of 10 (the global
      <a class="link" href="server-administration.html#sysvar_max_user_connections"><code class="literal">max_user_connections</code></a> value)
      because it has a <code class="literal">MAX_USER_CONNECTIONS</code> limit of
      zero. <code class="literal">user2</code> and <code class="literal">user3</code> have
      connection limits of 5 and 20, respectively, because they have
      nonzero <code class="literal">MAX_USER_CONNECTIONS</code> limits.
    </p><p>
      The server stores resource limits for an account in the
      <code class="literal">user</code> table row corresponding to the account.
      The <code class="literal">max_questions</code>,
      <code class="literal">max_updates</code>, and
      <code class="literal">max_connections</code> columns store the per-hour
      limits, and the <code class="literal">max_user_connections</code> column
      stores the <code class="literal">MAX_USER_CONNECTIONS</code> limit. (See
      <a class="xref" href="security.html#grant-tables" title="6.2.3 Grant Tables">Section 6.2.3, “Grant Tables”</a>.)
    </p><p>
      Resource-use counting takes place when any account has a nonzero
      limit placed on its use of any of the resources.
    </p><p>
      As the server runs, it counts the number of times each account
      uses resources. If an account reaches its limit on number of
      connections within the last hour, the server rejects further
      connections for the account until that hour is up. Similarly, if
      the account reaches its limit on the number of queries or updates,
      the server rejects further queries or updates until the hour is
      up. In all such cases, the server issues appropriate error
      messages.
    </p><p>
      Resource counting occurs per account, not per client. For example,
      if your account has a query limit of 50, you cannot increase your
      limit to 100 by making two simultaneous client connections to the
      server. Queries issued on both connections are counted together.
    </p><p>
      The current per-hour resource-use counts can be reset globally for
      all accounts, or individually for a given account:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          To reset the current counts to zero for all accounts, issue a
          <a class="link" href="sql-syntax.html#flush-user-resources"><code class="literal">FLUSH USER_RESOURCES</code></a> statement.
          The counts also can be reset by reloading the grant tables
          (for example, with a <a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH
          PRIVILEGES</code></a> statement or a <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          reload</strong></span></a> command).
        </p></li><li class="listitem"><p>
          The counts for an individual account can be reset to zero by
          setting any of its limits again. Specify a limit value equal
          to the value currently assigned to the account.
</p></li></ul>
</div>
<p>
      Per-hour counter resets do not affect the
      <code class="literal">MAX_USER_CONNECTIONS</code> limit.
    </p><p>
      All counts begin at zero when the server starts. Counts do not
      carry over through server restarts.
    </p><p>
      For the <code class="literal">MAX_USER_CONNECTIONS</code> limit, an edge
      case can occur if the account currently has open the maximum
      number of connections permitted to it: A disconnect followed
      quickly by a connect can result in an error
      (<a class="link" href="error-handling.html#error_er_too_many_user_connections"><code class="literal">ER_TOO_MANY_USER_CONNECTIONS</code></a> or
      <a class="link" href="error-handling.html#error_er_user_limit_reached"><code class="literal">ER_USER_LIMIT_REACHED</code></a>) if the
      server has not fully processed the disconnect by the time the
      connect occurs. When the server finishes disconnect processing,
      another connection will once more be permitted.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="problems-connecting"></a>6.2.21 Troubleshooting Problems Connecting to MySQL</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721570816"></a><a class="indexterm" name="idm140091721569776"></a><a class="indexterm" name="idm140091721568288"></a><p>
      If you encounter problems when you try to connect to the MySQL
      server, the following items describe some courses of action you
      can take to correct the problem.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Make sure that the server is running. If it is not, clients
          cannot connect to it. For example, if an attempt to connect to
          the server fails with a message such as one of those
          following, one cause might be that the server is not running:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql</code></strong>
ERROR 2003: Can't connect to MySQL server on '<em class="replaceable"><code>host_name</code></em>' (111)
shell&gt; <strong class="userinput"><code>mysql</code></strong>
ERROR 2002: Can't connect to local MySQL server through socket
'/tmp/mysql.sock' (111)
</pre></li><li class="listitem"><p>
          It might be that the server is running, but you are trying to
          connect using a TCP/IP port, named pipe, or Unix socket file
          different from the one on which the server is listening. To
          correct this when you invoke a client program, specify a
          <a class="link" href="programs.html#option_general_port"><code class="option">--port</code></a> option to indicate the
          proper port number, or a
          <a class="link" href="programs.html#option_general_socket"><code class="option">--socket</code></a> option to indicate
          the proper named pipe or Unix socket file. To find out where
          the socket file is, you can use this command:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>netstat -ln | grep mysql</code></strong>
</pre></li><li class="listitem"><p>
          Make sure that the server has not been configured to ignore
          network connections or (if you are attempting to connect
          remotely) that it has not been configured to listen only
          locally on its network interfaces. If the server was started
          with <a class="link" href="server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a>, it will
          not accept TCP/IP connections at all. If the server was
          started with the <a class="link" href="server-administration.html#sysvar_bind_address"><code class="literal">bind_address</code></a>
          system variable set to <code class="literal">127.0.0.1</code>, it will
          listen for TCP/IP connections only locally on the loopback
          interface and will not accept remote connections.
        </p></li><li class="listitem"><p>
          Check to make sure that there is no firewall blocking access
          to MySQL. Your firewall may be configured on the basis of the
          application being executed, or the port number used by MySQL
          for communication (3306 by default). Under Linux or Unix,
          check your IP tables (or similar) configuration to ensure that
          the port has not been blocked. Under Windows, applications
          such as ZoneAlarm or Windows Firewall may need to be
          configured not to block the MySQL port.
        </p></li><li class="listitem"><p>
          The grant tables must be properly set up so that the server
          can use them for access control. For some distribution types
          (such as binary distributions on Windows, or RPM distributions
          on Linux), the installation process initializes the MySQL data
          directory, including the <code class="literal">mysql</code> system
          database containing the grant tables. For distributions that
          do not do this, you must initialize the data directory
          manually. For details, see <a class="xref" href="installing.html#postinstallation" title="2.10 Postinstallation Setup and Testing">Section 2.10, “Postinstallation Setup and Testing”</a>.
        </p><p>
          To determine whether you need to initialize the grant tables,
          look for a <code class="filename">mysql</code> directory under the data
          directory. (The data directory normally is named
          <code class="filename">data</code> or <code class="filename">var</code> and is
          located under your MySQL installation directory.) Make sure
          that you have a file named <code class="filename">user.MYD</code> in
          the <code class="filename">mysql</code> database directory. If not,
          initialize the data directory. After doing so and starting the
          server, you should be able to connect to the server.
        </p></li><li class="listitem"><p>
          After a fresh installation, if you try to log on to the server
          as <code class="literal">root</code> without using a password, you might
          get the following error message.
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u root </code></strong>
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
</pre><p>
          It means a root password has already been assigned during
          installation and it has to be supplied. See
          <a class="xref" href="installing.html#default-privileges" title="2.10.4 Securing the Initial MySQL Account">Section 2.10.4, “Securing the Initial MySQL Account”</a> on the different ways the
          password could have been assigned and, in some cases, how to
          find it. If you need to reset the root password, see
          instructions in <a class="xref" href="error-handling.html#resetting-permissions" title="B.4.3.2 How to Reset the Root Password">Section B.4.3.2, “How to Reset the Root Password”</a>. After
          you have found or reset your password, log on again as
          <code class="literal">root</code> using the
          <a class="link" href="programs.html#option_general_password"><code class="option">--password</code></a> (or
          <a class="link" href="programs.html#option_general_password"><code class="option">-p</code></a>)
          option:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u root -p </code></strong>
Enter password: 
</pre><p>
          However, the server is going to let you connect as
          <code class="literal">root</code> without using a password if you have
          initialized MySQL using <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld
          --initialize-insecure</strong></span></a> (see
          <a class="xref" href="installing.html#data-directory-initialization" title="2.10.1 Initializing the Data Directory">Section 2.10.1, “Initializing the Data Directory”</a> for details).
          That is a security risk, so you should set a password for the
          <code class="literal">root</code> account; see
          <a class="xref" href="installing.html#default-privileges" title="2.10.4 Securing the Initial MySQL Account">Section 2.10.4, “Securing the Initial MySQL Account”</a> for instructions.
        </p></li><li class="listitem"><p>
          If you have updated an existing MySQL installation to a newer
          version, did you perform the MySQL upgrade procedure? If not,
          do so. The structure of the grant tables changes occasionally
          when new capabilities are added, so after an upgrade you
          should always make sure that your tables have the current
          structure. For instructions, see <a class="xref" href="installing.html#upgrading" title="2.11 Upgrading MySQL">Section 2.11, “Upgrading MySQL”</a>.
        </p></li><li class="listitem"><p>
          If a client program receives the following error message when
          it tries to connect, it means that the server expects
          passwords in a newer format than the client is capable of
          generating:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql</code></strong>
Client does not support authentication protocol requested
by server; consider upgrading MySQL client
</pre></li><li class="listitem"><p>
          <a class="indexterm" name="idm140091721525216"></a>

          <a class="indexterm" name="idm140091721524144"></a>

          <a class="indexterm" name="idm140091721523072"></a>

          <a class="indexterm" name="idm140091721522000"></a>

          <a class="indexterm" name="idm140091721520928"></a>

          Remember that client programs use connection parameters
          specified in option files or environment variables. If a
          client program seems to be sending incorrect default
          connection parameters when you have not specified them on the
          command line, check any applicable option files and your
          environment. For example, if you get <code class="literal">Access
          denied</code> when you run a client without any options,
          make sure that you have not specified an old password in any
          of your option files!
        </p><p>
          You can suppress the use of option files by a client program
          by invoking it with the
          <a class="link" href="programs.html#option_general_no-defaults"><code class="option">--no-defaults</code></a> option. For
          example:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysqladmin --no-defaults -u root version</code></strong>
</pre><p>
          The option files that clients use are listed in
          <a class="xref" href="programs.html#option-files" title="4.2.2.2 Using Option Files">Section 4.2.2.2, “Using Option Files”</a>. Environment variables are
          listed in <a class="xref" href="programs.html#environment-variables" title="4.9 MySQL Program Environment Variables">Section 4.9, “MySQL Program Environment Variables”</a>.
        </p></li><li class="listitem"><p>
          If you get the following error, it means that you are using an
          incorrect <code class="literal">root</code> password:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysqladmin -u root -p<em class="replaceable"><code>xxxx</code></em> ver</code></strong>
Access denied for user 'root'@'localhost' (using password: YES)
</pre><p>
          If the preceding error occurs even when you have not specified
          a password, it means that you have an incorrect password
          listed in some option file. Try the
          <a class="link" href="programs.html#option_general_no-defaults"><code class="option">--no-defaults</code></a> option as
          described in the previous item.
        </p><p>
          For information on changing passwords, see
          <a class="xref" href="security.html#assigning-passwords" title="6.2.14 Assigning Account Passwords">Section 6.2.14, “Assigning Account Passwords”</a>.
        </p><p>
          If you have lost or forgotten the <code class="literal">root</code>
          password, see <a class="xref" href="error-handling.html#resetting-permissions" title="B.4.3.2 How to Reset the Root Password">Section B.4.3.2, “How to Reset the Root Password”</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">localhost</code> is a synonym for your local host
          name, and is also the default host to which clients try to
          connect if you specify no host explicitly.
        </p><p>
          You can use a <a class="link" href="programs.html#option_general_host"><code class="option">--host=127.0.0.1</code></a>
          option to name the server host explicitly. This will make a
          TCP/IP connection to the local <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
          server. You can also use TCP/IP by specifying a
          <a class="link" href="programs.html#option_general_host"><code class="option">--host</code></a> option that uses the
          actual host name of the local host. In this case, the host
          name must be specified in a <code class="literal">user</code> table row
          on the server host, even though you are running the client
          program on the same host as the server.
        </p></li><li class="listitem"><p>
          The <code class="literal">Access denied</code> error message tells you
          who you are trying to log in as, the client host from which
          you are trying to connect, and whether you were using a
          password. Normally, you should have one row in the
          <code class="literal">user</code> table that exactly matches the host
          name and user name that were given in the error message. For
          example, if you get an error message that contains
          <code class="literal">using password: NO</code>, it means that you tried
          to log in without a password.
        </p></li><li class="listitem"><p>
          If you get an <code class="literal">Access denied</code> error when
          trying to connect to the database with <code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em></code>, you may have a
          problem with the <code class="literal">user</code> table. Check this by
          executing <code class="literal">mysql -u root mysql</code> and issuing
          this SQL statement:
        </p><pre data-lang="sql" class="programlisting">
SELECT * FROM user;
</pre><p>
          The result should include a row with the
          <code class="literal">Host</code> and <code class="literal">User</code> columns
          matching your client's host name and your MySQL user name.
        </p></li><li class="listitem"><p>
          If the following error occurs when you try to connect from a
          host other than the one on which the MySQL server is running,
          it means that there is no row in the <code class="literal">user</code>
          table with a <code class="literal">Host</code> value that matches the
          client host:
        </p><pre data-lang="none" class="programlisting">
Host ... is not allowed to connect to this MySQL server
</pre><p>
          You can fix this by setting up an account for the combination
          of client host name and user name that you are using when
          trying to connect.
        </p><p>
          If you do not know the IP address or host name of the machine
          from which you are connecting, you should put a row with
          <code class="literal">'%'</code> as the <code class="literal">Host</code> column
          value in the <code class="literal">user</code> table. After trying to
          connect from the client machine, use a <code class="literal">SELECT
          USER()</code> query to see how you really did connect. Then
          change the <code class="literal">'%'</code> in the
          <code class="literal">user</code> table row to the actual host name that
          shows up in the log. Otherwise, your system is left insecure
          because it permits connections from any host for the given
          user name.
        </p><p>
          On Linux, another reason that this error might occur is that
          you are using a binary MySQL version that is compiled with a
          different version of the <code class="literal">glibc</code> library than
          the one you are using. In this case, you should either upgrade
          your operating system or <code class="literal">glibc</code>, or download
          a source distribution of MySQL version and compile it
          yourself. A source RPM is normally trivial to compile and
          install, so this is not a big problem.
        </p></li><li class="listitem"><p>
          If you specify a host name when trying to connect, but get an
          error message where the host name is not shown or is an IP
          address, it means that the MySQL server got an error when
          trying to resolve the IP address of the client host to a name:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysqladmin -u root -p<em class="replaceable"><code>xxxx</code></em> -h <em class="replaceable"><code>some_hostname</code></em> ver</code></strong>
Access denied for user 'root'@'' (using password: YES)
</pre><p>
          If you try to connect as <code class="literal">root</code> and get the
          following error, it means that you do not have a row in the
          <code class="literal">user</code> table with a <code class="literal">User</code>
          column value of <code class="literal">'root'</code> and that
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> cannot resolve the host name for
          your client:
        </p><pre data-lang="none" class="programlisting">
Access denied for user ''@'unknown'
</pre><p>
          These errors indicate a DNS problem. To fix it, execute
          <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-hosts</strong></span></a> to reset the
          internal DNS host cache. See <a class="xref" href="optimization.html#host-cache" title="8.12.4.2 DNS Lookup Optimization and the Host Cache">Section 8.12.4.2, “DNS Lookup Optimization and the Host Cache”</a>.
        </p><p>
          Some permanent solutions are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Determine what is wrong with your DNS server and fix it.
            </p></li><li class="listitem"><p>
              Specify IP addresses rather than host names in the MySQL
              grant tables.
            </p></li><li class="listitem"><p>
              Put an entry for the client machine name in
              <code class="filename">/etc/hosts</code> on Unix or
              <code class="filename">\windows\hosts</code> on Windows.
            </p></li><li class="listitem"><p>
              Start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
              <a class="link" href="server-administration.html#option_mysqld_skip-name-resolve"><code class="option">--skip-name-resolve</code></a> option.
            </p></li><li class="listitem"><p>
              Start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
              <a class="link" href="server-administration.html#option_mysqld_skip-host-cache"><code class="option">--skip-host-cache</code></a> option.
            </p></li><li class="listitem"><p>
              On Unix, if you are running the server and the client on
              the same machine, connect to <code class="literal">localhost</code>.
              For connections to <code class="literal">localhost</code>, MySQL
              programs attempt to connect to the local server by using a
              Unix socket file, unless there are connection parameters
              specified to ensure that the client makes a TCP/IP
              connection. For more information, see
              <a class="xref" href="programs.html#connecting" title="4.2.3 Connecting to the MySQL Server">Section 4.2.3, “Connecting to the MySQL Server”</a>.
            </p></li><li class="listitem"><p>
              On Windows, if you are running the server and the client
              on the same machine and the server supports named pipe
              connections, connect to the host name <code class="literal">.</code>
              (period). Connections to <code class="literal">.</code> use a named
              pipe rather than TCP/IP.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          If <code class="literal">mysql -u root</code> works but <code class="literal">mysql
          -h <em class="replaceable"><code>your_hostname</code></em> -u root</code>
          results in <code class="literal">Access denied</code> (where
          <em class="replaceable"><code>your_hostname</code></em> is the actual host
          name of the local host), you may not have the correct name for
          your host in the <code class="literal">user</code> table. A common
          problem here is that the <code class="literal">Host</code> value in the
          <code class="literal">user</code> table row specifies an unqualified
          host name, but your system's name resolution routines return a
          fully qualified domain name (or vice versa). For example, if
          you have a row with host <code class="literal">'pluto'</code> in the
          <code class="literal">user</code> table, but your DNS tells MySQL that
          your host name is <code class="literal">'pluto.example.com'</code>, the
          row does not work. Try adding a row to the
          <code class="literal">user</code> table that contains the IP address of
          your host as the <code class="literal">Host</code> column value.
          (Alternatively, you could add a row to the
          <code class="literal">user</code> table with a <code class="literal">Host</code>
          value that contains a wildcard (for example,
          <code class="literal">'pluto.%'</code>). However, use of
          <code class="literal">Host</code> values ending with
          <code class="literal">%</code> is <span class="emphasis"><em>insecure</em></span> and is
          <span class="emphasis"><em>not</em></span> recommended!)
        </p></li><li class="listitem"><p>
          If <code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em></code> works but
          <code class="literal">mysql -u <em class="replaceable"><code>user_name</code></em>
          <em class="replaceable"><code>some_db</code></em></code> does not, you
          have not granted access to the given user for the database
          named <em class="replaceable"><code>some_db</code></em>.
        </p></li><li class="listitem"><p>
          If <code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em></code> works when
          executed on the server host, but <code class="literal">mysql -h
          <em class="replaceable"><code>host_name</code></em> -u
          <em class="replaceable"><code>user_name</code></em></code> does not work
          when executed on a remote client host, you have not enabled
          access to the server for the given user name from the remote
          host.
        </p></li><li class="listitem"><p>
          If you cannot figure out why you get <code class="literal">Access
          denied</code>, remove from the <code class="literal">user</code>
          table all rows that have <code class="literal">Host</code> values
          containing wildcards (rows that contain <code class="literal">'%'</code>
          or <code class="literal">'_'</code> characters). A very common error is
          to insert a new row with
          <code class="literal">Host</code>=<code class="literal">'%'</code> and
          <code class="literal">User</code>=<code class="literal">'<em class="replaceable"><code>some_user</code></em>'</code>,
          thinking that this enables you to specify
          <code class="literal">localhost</code> to connect from the same machine.
          The reason that this does not work is that the default
          privileges include a row with
          <code class="literal">Host</code>=<code class="literal">'localhost'</code> and
          <code class="literal">User</code>=<code class="literal">''</code>. Because that
          row has a <code class="literal">Host</code> value
          <code class="literal">'localhost'</code> that is more specific than
          <code class="literal">'%'</code>, it is used in preference to the new
          row when connecting from <code class="literal">localhost</code>! The
          correct procedure is to insert a second row with
          <code class="literal">Host</code>=<code class="literal">'localhost'</code> and
          <code class="literal">User</code>=<code class="literal">'<em class="replaceable"><code>some_user</code></em>'</code>,
          or to delete the row with
          <code class="literal">Host</code>=<code class="literal">'localhost'</code> and
          <code class="literal">User</code>=<code class="literal">''</code>. After deleting
          the row, remember to issue a <a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH
          PRIVILEGES</code></a> statement to reload the grant tables. See
          also <a class="xref" href="security.html#connection-access" title="6.2.6 Access Control, Stage 1: Connection Verification">Section 6.2.6, “Access Control, Stage 1: Connection Verification”</a>.
        </p></li><li class="listitem"><p>
          If you are able to connect to the MySQL server, but get an
          <code class="literal">Access denied</code> message whenever you issue a
          <a class="link" href="sql-syntax.html#select-into" title="13.2.10.1 SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
          OUTFILE</code></a> or <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD DATA</code></a>
          statement, your row in the <code class="literal">user</code> table does
          not have the <a class="link" href="security.html#priv_file"><code class="literal">FILE</code></a> privilege
          enabled.
        </p></li><li class="listitem"><p>
          If you change the grant tables directly (for example, by using
          <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements) and your
          changes seem to be ignored, remember that you must execute a
          <a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a> statement or a
          <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin flush-privileges</strong></span></a> command to
          cause the server to reload the privilege tables. Otherwise,
          your changes have no effect until the next time the server is
          restarted. Remember that after you change the
          <code class="literal">root</code> password with an
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a> statement, you will not
          need to specify the new password until after you flush the
          privileges, because the server will not know you've changed
          the password yet!
        </p></li><li class="listitem"><p>
          If your privileges seem to have changed in the middle of a
          session, it may be that a MySQL administrator has changed
          them. Reloading the grant tables affects new client
          connections, but it also affects existing connections as
          indicated in <a class="xref" href="security.html#privilege-changes" title="6.2.13 When Privilege Changes Take Effect">Section 6.2.13, “When Privilege Changes Take Effect”</a>.
        </p></li><li class="listitem"><p>
          If you have access problems with a Perl, PHP, Python, or ODBC
          program, try to connect to the server with <code class="literal">mysql -u
          <em class="replaceable"><code>user_name</code></em>
          <em class="replaceable"><code>db_name</code></em></code> or <code class="literal">mysql
          -u <em class="replaceable"><code>user_name</code></em>
          -p<em class="replaceable"><code>your_pass</code></em>
          <em class="replaceable"><code>db_name</code></em></code>. If you are able
          to connect using the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client, the
          problem lies with your program, not with the access
          privileges. (There is no space between <code class="option">-p</code> and
          the password; you can also use the
          <a class="link" href="programs.html#option_general_password"><code class="option">--password=<em class="replaceable"><code>your_pass</code></em></code></a>
          syntax to specify the password. If you use the
          <code class="option">-p</code> or
          <a class="link" href="programs.html#option_general_password"><code class="option">--password</code></a> option with no
          password value, MySQL prompts you for the password.)
        </p></li><li class="listitem"><p>
          For testing purposes, start the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
          server with the
          <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a> option.
          Then you can change the MySQL grant tables and use the
          <a class="link" href="sql-syntax.html#show-grants" title="13.7.6.21 SHOW GRANTS Syntax"><code class="literal">SHOW GRANTS</code></a> statement to check
          whether your modifications have the desired effect. When you
          are satisfied with your changes, execute <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin
          flush-privileges</strong></span></a> to tell the
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server to reload the privileges.
          This enables you to begin using the new grant table contents
          without stopping and restarting the server.
        </p></li><li class="listitem"><p>
          If everything else fails, start the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>
          server with a debugging option (for example,
          <a class="link" href="server-administration.html#option_mysqld_debug"><code class="option">--debug=d,general,query</code></a>). This
          prints host and user information about attempted connections,
          as well as information about each command issued. See
          <a class="xref" href="extending-mysql.html#dbug-package" title="29.5.4 The DBUG Package">Section 29.5.4, “The DBUG Package”</a>.
        </p></li><li class="listitem"><p>
          If you have any other problems with the MySQL grant tables and
          feel you must post the problem to the mailing list, always
          provide a dump of the MySQL grant tables. You can dump the
          tables with the <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump mysql</strong></span></a> command. To
          file a bug report, see the instructions at
          <a class="xref" href="introduction.html#bug-reports" title="1.7 How to Report Bugs or Problems">Section 1.7, “How to Report Bugs or Problems”</a>. In some cases, you may need to
          restart <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with
          <a class="link" href="server-administration.html#option_mysqld_skip-grant-tables"><code class="option">--skip-grant-tables</code></a> to run
          <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="account-activity-auditing"></a>6.2.22 SQL-Based Account Activity Auditing</h3>

</div>

</div>

</div>
<p>
      Applications can use the following guidelines to perform SQL-based
      auditing that ties database activity to MySQL accounts.
    </p><p>
      MySQL accounts correspond to rows in the
      <code class="literal">mysql.user</code> system table. When a client connects
      successfully, the server authenticates the client to a particular
      row in this table. The <code class="literal">User</code> and
      <code class="literal">Host</code> column values in this row uniquely
      identify the account and correspond to the
      <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>
      format in which account names are written in SQL statements.
    </p><p>
      The account used to authenticate a client determines which
      privileges the client has. Normally, the
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> function can be
      invoked to determine which account this is for the client user.
      Its value is constructed from the <code class="literal">User</code> and
      <code class="literal">Host</code> columns of the <code class="literal">user</code>
      table row for the account.
    </p><p>
      However, there are circumstances under which the
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> value corresponds
      not to the client user but to a different account. This occurs in
      contexts when privilege checking is not based the client's
      account:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Stored routines (procedures and functions) defined with the
          <code class="literal">SQL SECURITY DEFINER</code> characteristic
        </p></li><li class="listitem"><p>
          Views defined with the <code class="literal">SQL SECURITY DEFINER</code>
          characteristic
        </p></li><li class="listitem"><p>
          Triggers and events
</p></li></ul>
</div>
<p>
      In those contexts, privilege checking is done against the
      <code class="literal">DEFINER</code> account and
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> refers to that
      account, not to the account for the client who invoked the stored
      routine or view or who caused the trigger to activate. To
      determine the invoking user, you can call the
      <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> function, which returns a
      value indicating the actual user name provided by the client and
      the host from which the client connected. However, this value does
      not necessarily correspond directly to an account in the
      <code class="literal">user</code> table, because the
      <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> value never contains
      wildcards, whereas account values (as returned by
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a>) may contain user
      name and host name wildcards.
    </p><p>
      For example, a blank user name matches any user, so an account of
      <code class="literal">''@'localhost'</code> enables clients to connect as an
      anonymous user from the local host with any user name. In this
      case, if a client connects as <code class="literal">user1</code> from the
      local host, <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> and
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> return different
      values:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+-----------------+----------------+
| USER()          | CURRENT_USER() |
+-----------------+----------------+
| user1@localhost | @localhost     |
+-----------------+----------------+
</pre><p>
      The host name part of an account can contain wildcards, too. If
      the host name contains a <code class="literal">'%'</code> or
      <code class="literal">'_'</code> pattern character or uses netmask notation,
      the account can be used for clients connecting from multiple hosts
      and the <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> value will
      not indicate which one. For example, the account
      <code class="literal">'user2'@'%.example.com'</code> can be used by
      <code class="literal">user2</code> to connect from any host in the
      <code class="literal">example.com</code> domain. If <code class="literal">user2</code>
      connects from <code class="literal">remote.example.com</code>,
      <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> and
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> return different
      values:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER();</code></strong>
+--------------------------+---------------------+
| USER()                   | CURRENT_USER()      |
+--------------------------+---------------------+
| user2@remote.example.com | user2@%.example.com |
+--------------------------+---------------------+
</pre><p>
      If an application must invoke
      <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> for user auditing (for
      example, if it does auditing from within triggers) but must also
      be able to associate the <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a>
      value with an account in the <code class="literal">user</code> table, it is
      necessary to avoid accounts that contain wildcards in the
      <code class="literal">User</code> or <code class="literal">Host</code> column.
      Specifically, do not permit <code class="literal">User</code> to be empty
      (which creates an anonymous-user account), and do not permit
      pattern characters or netmask notation in <code class="literal">Host</code>
      values. All accounts must have a nonempty <code class="literal">User</code>
      value and literal <code class="literal">Host</code> value.
    </p><p>
      With respect to the previous examples, the
      <code class="literal">''@'localhost'</code> and
      <code class="literal">'user2'@'%.example.com'</code> accounts should be
      changed not to use wildcards:
    </p><pre data-lang="sql" class="programlisting">
RENAME USER ''@'localhost' TO 'user1'@'localhost';
RENAME USER 'user2'@'%.example.com' TO 'user2'@'remote.example.com';
</pre><p>
      If <code class="literal">user2</code> must be able to connect from several
      hosts in the <code class="literal">example.com</code> domain, there should
      be a separate account for each host.
    </p><p>
      To extract the user name or host name part from a
      <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> or
      <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> value, use the
      <a class="link" href="functions.html#function_substring-index"><code class="literal">SUBSTRING_INDEX()</code></a> function:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',1);</code></strong>
+---------------------------------------+
| SUBSTRING_INDEX(CURRENT_USER(),'@',1) |
+---------------------------------------+
| user1                                 |
+---------------------------------------+

mysql&gt; <strong class="userinput"><code>SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',-1);</code></strong>
+----------------------------------------+
| SUBSTRING_INDEX(CURRENT_USER(),'@',-1) |
+----------------------------------------+
| localhost                              |
+----------------------------------------+
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="encrypted-connections"></a>6.3 Using Encrypted Connections</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#using-encrypted-connections">6.3.1 Configuring MySQL to Use Encrypted Connections</a></span></dt><dt><span class="section"><a href="security.html#encrypted-connection-options">6.3.2 Command Options for Encrypted Connections</a></span></dt><dt><span class="section"><a href="security.html#creating-ssl-rsa-files">6.3.3 Creating SSL and RSA Certificates and Keys</a></span></dt><dt><span class="section"><a href="security.html#ssl-libraries">6.3.4 SSL Library-Dependent Capabilities</a></span></dt><dt><span class="section"><a href="security.html#building-with-encrypted-connection-support">6.3.5 Building MySQL with Support for Encrypted Connections</a></span></dt><dt><span class="section"><a href="security.html#encrypted-connection-protocols-ciphers">6.3.6 Encrypted Connection Protocols and Ciphers</a></span></dt><dt><span class="section"><a href="security.html#windows-and-ssh">6.3.7 Connecting to MySQL Remotely from Windows with SSH</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091721296032"></a><a class="indexterm" name="idm140091721294992"></a><a class="indexterm" name="idm140091721293920"></a><a class="indexterm" name="idm140091721292832"></a><a class="indexterm" name="idm140091721291744"></a><a class="indexterm" name="idm140091721290672"></a><a class="indexterm" name="idm140091721289600"></a><a class="indexterm" name="idm140091721288528"></a><p>
    With an unencrypted connection between the MySQL client and the
    server, someone with access to the network could watch all your
    traffic and inspect the data being sent or received between client
    and server.
  </p><a class="indexterm" name="idm140091721286448"></a><p>
    When you must move information over a network in a secure fashion,
    an unencrypted connection is unacceptable. To make any kind of data
    unreadable, use encryption. Encryption algorithms must include
    security elements to resist many kinds of known attacks such as
    changing the order of encrypted messages or replaying data twice.
  </p><p>
    MySQL supports encrypted connections between clients and the server
    using the TLS (Transport Layer Security) protocol. TLS is sometimes
    referred to as SSL (Secure Sockets Layer) but MySQL does not
    actually use the SSL protocol for encrypted connections because its
    encryption is weak (see
    <a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.6 Encrypted Connection Protocols and Ciphers">Section 6.3.6, “Encrypted Connection Protocols and Ciphers”</a>).
  </p><p>
    TLS uses encryption algorithms to ensure that data received over a
    public network can be trusted. It has mechanisms to detect data
    change, loss, or replay. TLS also incorporates algorithms that
    provide identity verification using the X.509 standard.
  </p><a class="indexterm" name="idm140091721282480"></a><p>
    X.509 makes it possible to identify someone on the Internet. In
    basic terms, there should be some entity called a <span class="quote">“<span class="quote">Certificate
    Authority</span>”</span> (or CA) that assigns electronic certificates to
    anyone who needs them. Certificates rely on asymmetric encryption
    algorithms that have two encryption keys (a public key and a secret
    key). A certificate owner can present the certificate to another
    party as proof of identity. A certificate consists of its owner's
    public key. Any data encrypted using this public key can be
    decrypted only using the corresponding secret key, which is held by
    the owner of the certificate.
  </p><p>
    MySQL can be compiled for encrypted-connection support using OpenSSL
    or wolfSSL. For a comparison of the packages, see
    <a class="xref" href="security.html#ssl-libraries" title="6.3.4 SSL Library-Dependent Capabilities">Section 6.3.4, “SSL Library-Dependent Capabilities”</a> For information about the encryption
    protocols and ciphers each package supports, see
    <a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.6 Encrypted Connection Protocols and Ciphers">Section 6.3.6, “Encrypted Connection Protocols and Ciphers”</a>.
  </p><p>
    By default, MySQL programs attempt to connect using encryption if
    the server supports encrypted connections, falling back to an
    unencrypted connection if an encrypted connection cannot be
    established. For information about options that affect use of
    encrypted connections, see
    <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a> and
    <a class="xref" href="security.html#encrypted-connection-options" title="6.3.2 Command Options for Encrypted Connections">Section 6.3.2, “Command Options for Encrypted Connections”</a>.
  </p><p>
    MySQL performs encryption on a per-connection basis, and use of
    encryption for a given user can be optional or mandatory. This
    enables you to choose an encrypted or unencrypted connection
    according to the requirements of individual applications. For
    information on how to require users to use encrypted connections,
    see the discussion of the <code class="literal">REQUIRE</code> clause of the
    <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement in
    <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>. See also the description of the
    <a class="link" href="server-administration.html#sysvar_require_secure_transport"><code class="literal">require_secure_transport</code></a> system
    variable at <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 Server System Variables">Section 5.1.8, “Server System Variables”</a>
  </p><p>
    Encrypted connections can be used between master and slave
    replication servers. See
    <a class="xref" href="replication.html#replication-solutions-encrypted-connections" title="17.3.9 Setting Up Replication to Use Encrypted Connections">Section 17.3.9, “Setting Up Replication to Use Encrypted Connections”</a>.
  </p><p>
    For information about using encrypted connections from the MySQL C
    API, see <a class="xref" href="connectors-apis.html#c-api-encrypted-connections" title="28.7.22 C API Encrypted Connection Support">Section 28.7.22, “C API Encrypted Connection Support”</a>.
  </p><p>
    It is also possible to connect using encryption from within an SSH
    connection to the MySQL server host. For an example, see
    <a class="xref" href="security.html#windows-and-ssh" title="6.3.7 Connecting to MySQL Remotely from Windows with SSH">Section 6.3.7, “Connecting to MySQL Remotely from Windows with SSH”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="using-encrypted-connections"></a>6.3.1 Configuring MySQL to Use Encrypted Connections</h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140091721264928"></a><a class="indexterm" name="idm140091721263888"></a><a class="indexterm" name="idm140091721262416"></a><p>
      Several options are available to indicate whether to use encrypted
      connections, and to specify the appropriate certificate and key
      files. This section provides general guidance about configuring
      the server and clients for encrypted connections:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#using-encrypted-connections-server-side-startup-configuration" title="Server-Side Startup Configuration for Encrypted Connections">Server-Side Startup Configuration for Encrypted Connections</a></p></li><li class="listitem"><p><a class="xref" href="security.html#using-encrypted-connections-server-side-runtime-configuration" title="Server-Side Runtime Configuration for Encrypted Connections">Server-Side Runtime Configuration for Encrypted Connections</a></p></li><li class="listitem"><p><a class="xref" href="security.html#using-encrypted-connections-client-side-configuration" title="Client-Side Configuration for Encrypted Connections">Client-Side Configuration for Encrypted Connections</a></p></li><li class="listitem"><p><a class="xref" href="security.html#mandatory-encrypted-connections" title="Configuring Encrypted Connections as Mandatory">Configuring Encrypted Connections as Mandatory</a></p></li></ul>
</div>
<p>
      For a complete list of options related to establishment of
      encrypted connections, see
      <a class="xref" href="security.html#encrypted-connection-options" title="6.3.2 Command Options for Encrypted Connections">Section 6.3.2, “Command Options for Encrypted Connections”</a>. Instructions for
      creating any required certificate and key files are available in
      <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 Creating SSL and RSA Certificates and Keys">Section 6.3.3, “Creating SSL and RSA Certificates and Keys”</a>.
    </p><p>
      Encrypted connections also can be used in these contexts:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Between master and slave replication servers. See
          <a class="xref" href="replication.html#replication-solutions-encrypted-connections" title="17.3.9 Setting Up Replication to Use Encrypted Connections">Section 17.3.9, “Setting Up Replication to Use Encrypted Connections”</a>.
        </p></li><li class="listitem"><p>
          Among Group Replication servers. See
          <a class="xref" href="group-replication.html#group-replication-secure-socket-layer-support-ssl" title="18.5.2 Group Replication Secure Socket Layer (SSL) Support">Section 18.5.2, “Group Replication Secure Socket Layer (SSL) Support”</a>.
        </p></li><li class="listitem"><p>
          By client programs that are based on the MySQL C API. See
          <a class="xref" href="connectors-apis.html#c-api-encrypted-connections" title="28.7.22 C API Encrypted Connection Support">Section 28.7.22, “C API Encrypted Connection Support”</a>.
</p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="using-encrypted-connections-server-side-startup-configuration"></a>Server-Side Startup Configuration for Encrypted Connections</h4>

</div>

</div>

</div>
<p>
        On the server side, the <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>
        option specifies that the server permits but does not require
        encrypted connections. This option is enabled by default, so it
        need not be specified explicitly.
      </p><p>
        To require that clients connect using encrypted connections,
        enable the
        <a class="link" href="server-administration.html#sysvar_require_secure_transport"><code class="literal">require_secure_transport</code></a> system
        variable. See <a class="xref" href="security.html#mandatory-encrypted-connections" title="Configuring Encrypted Connections as Mandatory">Configuring Encrypted Connections as Mandatory</a>.
      </p><p>
        These options on the server side specify the certificate and key
        files the server uses when permitting clients to establish
        encrypted connections:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a>: The path name of
            the Certificate Authority (CA) certificate file.
            (<code class="option">--ssl-capath</code> is similar but specifies the
            path name of a directory of CA certificate files.)
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a>: The path name of
            the server public key certificate file. This certificate can
            be sent to the client and authenticated against the CA
            certificate that it has.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a>: The path name of
            the server private key file.
</p></li></ul>
</div>
<p>
        For example, to enable the server for encrypted connections,
        start it with these lines in the <code class="filename">my.cnf</code>
        file, changing the file names as necessary:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
ssl-ca=ca.pem
ssl-cert=server-cert.pem
ssl-key=server-key.pem
</pre><p>
        To specify in addition that clients are required to use
        encrypted connections, enable the
        <a class="link" href="server-administration.html#sysvar_require_secure_transport"><code class="literal">require_secure_transport</code></a> system
        variable:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
ssl-ca=ca.pem
ssl-cert=server-cert.pem
ssl-key=server-key.pem
require_secure_transport=ON
</pre><p>
        Each certificate and key option names a file in PEM format.
        Should you need to create the required certificate and key
        files, see <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 Creating SSL and RSA Certificates and Keys">Section 6.3.3, “Creating SSL and RSA Certificates and Keys”</a>. MySQL
        servers compiled using OpenSSL can generate missing certificate
        and key files automatically at startup. See
        <a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql" title="6.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL">Section 6.3.3.1, “Creating SSL and RSA Certificates and Keys using MySQL”</a>.
        Alternatively, if you have a MySQL source distribution, you can
        test your setup using the demonstration certificate and key
        files in its <code class="filename">mysql-test/std_data</code> directory.
      </p><p>
        The server performs certificate and key file autodiscovery. If
        <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a> is enabled (possibly along
        with <a class="link" href="security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher</code></a>) and other
        <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code> options
        are <span class="emphasis"><em>not</em></span> given to configure encrypted
        connections explicitly, the server attempts to enable encrypted
        connection support automatically at startup:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If the server discovers valid certificate and key files
            named <code class="filename">ca.pem</code>,
            <code class="filename">server-cert.pem</code>, and
            <code class="filename">server-key.pem</code> in the data directory,
            it enables support for encrypted connections by clients.
            (The files need not have been generated automatically; what
            matters is that they have those names and are valid.)
          </p></li><li class="listitem"><p>
            If the server does not find valid certificate and key files
            in the data directory, it continues executing but without
            support for encrypted connections.
</p></li></ul>
</div>
<p>
        If the server automatically enables encrypted connection
        support, it writes a note to the error log. If the server
        discovers that the CA certificate is self-signed, it writes a
        warning to the error log. (The certificate is self-signed if
        created automatically by the server, or manually using
        <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a>.)
      </p><p>
        MySQL also provides these options for server-side SSL control:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher</code></a>: The list of
            permitted ciphers for connection encryption.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a>: The path name of
            the file containing certificate revocation lists.
            (<code class="option">--ssl-crlpath</code> is similar but specifies the
            path name of a directory of certificate revocation-list
            files.)
</p></li></ul>
</div>
<p>
        The values of the
        <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code> options
        set the values of the corresponding system variables
        (<a class="link" href="server-administration.html#sysvar_ssl_ca"><code class="literal">ssl_ca</code></a>,
        <a class="link" href="server-administration.html#sysvar_ssl_cert"><code class="literal">ssl_cert</code></a>,
        <a class="link" href="server-administration.html#sysvar_ssl_key"><code class="literal">ssl_key</code></a>, and so forth).
      </p><p>
        To explicitly specify which encryption protocols and
        ciphersuites the server permits for encrypted connections, use
        the <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a> and
        <a class="link" href="server-administration.html#sysvar_tls_ciphersuites"><code class="literal">tls_ciphersuites</code></a> system
        variables; see
        <a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.6 Encrypted Connection Protocols and Ciphers">Section 6.3.6, “Encrypted Connection Protocols and Ciphers”</a>. For
        example, you can set
        <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a> to prevent clients
        from using less-secure protocols.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="using-encrypted-connections-server-side-runtime-configuration"></a>Server-Side Runtime Configuration for Encrypted Connections</h4>

</div>

</div>

</div>
<p>
        Certain encryption-related system variables can be set at
        runtime:
        <a class="link" href="server-administration.html#sysvar_require_secure_transport"><code class="literal">require_secure_transport</code></a>, and
        (as of MySQL 8.0.16)
        <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a> and
        <a class="link" href="server-administration.html#sysvar_tls_ciphersuites"><code class="literal">tls_ciphersuites</code></a>. If changed
        with <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
        GLOBAL</code></a>, the new values apply to connections
        established subsequent to the change, and apply only until
        server restart. If changed with
        <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
        PERSIST</code></a>, the new values also apply to subsequent
        server restarts. See <a class="xref" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment">Section 13.7.5.1, “SET Syntax for Variable Assignment”</a>.
      </p><p>
        In addition, as of MySQL 8.0.16, the SSL context the server uses
        for new connections is reconfigurable at runtime. This
        capability may be useful, for example, to avoid restarting a
        MySQL server that has been running so long that its SSL
        certificate has expired.
      </p><p>
        The server creates the initial SSL context from the values that
        the context-related system variables have at startup. It also
        initializes a set of context-related status variables to
        indicate the values used in the context. The following table
        shows the system variables that define the SSL context and the
        corresponding status variables that indicate the currently
        active context values.
</p>
<div class="table">
<a name="ssl-context-variables-table"></a><p class="title"><b>Table 6.11 Corresponding System and Status Variables Related to Server SSL Context</b></p>
<div class="table-contents">
<table summary="The system variables that define the server SSL context and the corresponding status variables that indicate active context values."><col width="45*"><col width="55*"><thead><tr>
            <th scope="col">System Variable Name</th>
            <th scope="col">Status Variable Name</th>
          </tr></thead><tbody><tr>
            <td scope="row"><a class="link" href="server-administration.html#sysvar_ssl_ca"><code class="literal">ssl_ca</code></a></td>
            <td><a class="link" href="server-administration.html#statvar_Current_tls_ca"><code class="literal">Current_tls_ca</code></a></td>
          </tr><tr>
            <td scope="row"><a class="link" href="server-administration.html#sysvar_ssl_capath"><code class="literal">ssl_capath</code></a></td>
            <td><a class="link" href="server-administration.html#statvar_Current_tls_capath"><code class="literal">Current_tls_capath</code></a></td>
          </tr><tr>
            <td scope="row"><a class="link" href="server-administration.html#sysvar_ssl_cert"><code class="literal">ssl_cert</code></a></td>
            <td><a class="link" href="server-administration.html#statvar_Current_tls_cert"><code class="literal">Current_tls_cert</code></a></td>
          </tr><tr>
            <td scope="row"><a class="link" href="server-administration.html#sysvar_ssl_cipher"><code class="literal">ssl_cipher</code></a></td>
            <td><a class="link" href="server-administration.html#statvar_Current_tls_cipher"><code class="literal">Current_tls_cipher</code></a></td>
          </tr><tr>
            <td scope="row"><a class="link" href="server-administration.html#sysvar_ssl_crl"><code class="literal">ssl_crl</code></a></td>
            <td><a class="link" href="server-administration.html#statvar_Current_tls_crl"><code class="literal">Current_tls_crl</code></a></td>
          </tr><tr>
            <td scope="row"><a class="link" href="server-administration.html#sysvar_ssl_crlpath"><code class="literal">ssl_crlpath</code></a></td>
            <td><a class="link" href="server-administration.html#statvar_Current_tls_crlpath"><code class="literal">Current_tls_crlpath</code></a></td>
          </tr><tr>
            <td scope="row"><a class="link" href="server-administration.html#sysvar_ssl_key"><code class="literal">ssl_key</code></a></td>
            <td><a class="link" href="server-administration.html#statvar_Current_tls_key"><code class="literal">Current_tls_key</code></a></td>
          </tr><tr>
            <td scope="row"><a class="link" href="server-administration.html#sysvar_tls_ciphersuites"><code class="literal">tls_ciphersuites</code></a></td>
            <td><a class="link" href="server-administration.html#statvar_Current_tls_ciphersuites"><code class="literal">Current_tls_ciphersuites</code></a></td>
          </tr><tr>
            <td scope="row"><a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a></td>
            <td><a class="link" href="server-administration.html#statvar_Current_tls_version"><code class="literal">Current_tls_version</code></a></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        To reconfigure the SSL context at runtime, use this procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Set any SSL context-related system variables that should be
            changed to their new values.
          </p></li><li class="listitem"><p>
            Execute <a class="link" href="sql-syntax.html#alter-instance-reload-tls"><code class="literal">ALTER INSTANCE RELOAD
            TLS</code></a>. This statement reconfigures the active SSL
            context from the current values of the SSL context-related
            system variables. It also sets the context-related status
            variables to reflect the new active context values. The
            statement requires the
            <a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a> privilege.
          </p></li><li class="listitem"><p>
            New connections established after execution of
            <a class="link" href="sql-syntax.html#alter-instance-reload-tls"><code class="literal">ALTER INSTANCE RELOAD TLS</code></a> use
            the new SSL context. Existing connections remain unaffected.
            If existing connections should be terminated, use the
            <a class="link" href="sql-syntax.html#kill" title="13.7.7.4 KILL Syntax"><code class="literal">KILL</code></a> statement.
</p></li></ol>
</div>
<p>
        The members of each pair of system and status variables may have
        different values temporarily due to the way the reconfiguration
        procedure works:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Changes to the system variables prior to
            <a class="link" href="sql-syntax.html#alter-instance-reload-tls"><code class="literal">ALTER INSTANCE RELOAD TLS</code></a> do
            not change the SSL context. At this point, those changes
            have no effect on new connections, and corresponding
            context-related system and status variables may have
            different values. This enables you to make any changes
            required to the system variables, then update the active SSL
            context atomically with <a class="link" href="sql-syntax.html#alter-instance-reload-tls"><code class="literal">ALTER INSTANCE
            RELOAD TLS</code></a> after all system variable changes have
            been made.
          </p></li><li class="listitem"><p>
            After <a class="link" href="sql-syntax.html#alter-instance-reload-tls"><code class="literal">ALTER INSTANCE RELOAD
            TLS</code></a>, corresponding system and status variables
            have the same values. This remains true until the next
            change to the system variables.
</p></li></ul>
</div>
<p>
        In some cases, <a class="link" href="sql-syntax.html#alter-instance-reload-tls"><code class="literal">ALTER INSTANCE RELOAD
        TLS</code></a> by itself may suffice to reconfigure the SSL
        context, without changing any system variables. Suppose that the
        certificate in the file named by
        <a class="link" href="server-administration.html#sysvar_ssl_cert"><code class="literal">ssl_cert</code></a> has expired. It is
        sufficient to replace the existing file contents with a
        nonexpired certificate and execute <a class="link" href="sql-syntax.html#alter-instance-reload-tls"><code class="literal">ALTER
        INSTANCE RELOAD TLS</code></a> to cause the new file contents to
        be read and used for new connections.
      </p><p>
        By default, the <code class="literal">RELOAD TLS</code> action rolls back
        with an error and has no effect if the configuration values do
        not permit creation of a new SSL context. The previous context
        values continue to be used for new connections.
      </p><p>
        If the optional <code class="literal">NO ROLLBACK ON ERROR</code> clause
        is given and a new context cannot be created, rollback does not
        occur. Instead, a warning is generated and SSL is disabled for
        new connections.
      </p><p>
        The server-side <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a> option has
        an effect only at server startup on whether the server accepts
        SSL connections. It is ignored by, and has no effect on the
        operation of, <a class="link" href="sql-syntax.html#alter-instance-reload-tls"><code class="literal">ALTER INSTANCE RELOAD
        TLS</code></a>. For example, you can use
        <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl=0</code></a> to start the server with
        SSL connections disabled, then reconfigure SSL and execute
        <a class="link" href="sql-syntax.html#alter-instance-reload-tls"><code class="literal">ALTER INSTANCE RELOAD TLS</code></a> to
        enable SSL connections at runtime.
      </p><p>
        <a class="link" href="sql-syntax.html#alter-instance-reload-tls"><code class="literal">ALTER INSTANCE RELOAD TLS</code></a> changes
        only the SSL context the server itself uses for new connections.
        It does not affect the SSL context used by other enabled server
        plugins or components such as X Plugin or Group
        Replication.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Prior to MySQL 8.0.16, the SSL context-related system
          variables are not dynamic. They can be set at server startup,
          but cannot be changed thereafter. These system variables
          therefore determine the SSL context values the server uses for
          all new connections.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="using-encrypted-connections-client-side-configuration"></a>Client-Side Configuration for Encrypted Connections</h4>

</div>

</div>

</div>
<p>
        By default, MySQL client programs attempt to establish an
        encrypted connection if the server supports encrypted
        connections, with further control available through the
        <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a> option:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            In the absence of an
            <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a> option, clients
            attempt to connect using encryption, falling back to an
            unencrypted connection if an encrypted connection cannot be
            established. This is also the behavior with an explicit
            <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=PREFFERED</code></a> option.
          </p></li><li class="listitem"><p>
            With <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=REQUIRED</code></a>,
            clients require an encrypted connection and fail if one
            cannot be established.
          </p></li><li class="listitem"><p>
            With <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=DISABLED</code></a>,
            clients use an unencrypted connection.
          </p></li><li class="listitem"><p>
            With <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_CA</code></a> or
            <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_IDENTITY</code></a>,
            clients require an encrypted connection, and also perform
            verification against the server CA certificate and (with
            <code class="literal">VERIFY_IDENTITY</code>) against the server host
            name in its certificate.
</p></li></ul>
</div>
<p>
        Attempts to establish an unencrypted connection fail if the
        <a class="link" href="server-administration.html#sysvar_require_secure_transport"><code class="literal">require_secure_transport</code></a> system
        variable is enabled on the server side to cause the server to
        require encrypted connections. See
        <a class="xref" href="security.html#mandatory-encrypted-connections" title="Configuring Encrypted Connections as Mandatory">Configuring Encrypted Connections as Mandatory</a>.
      </p><p>
        The following options on the client side identify the
        certificate and key files clients use when establishing
        encrypted connections to the server. They are similar to the
        options used on the server side, but
        <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a> and
        <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a> identify the client
        public and private key:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a>: The path name of
            the Certificate Authority (CA) certificate file. This
            option, if used, must specify the same certificate used by
            the server. (<code class="option">--ssl-capath</code> is similar but
            specifies the path name of a directory of CA certificate
            files.)
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a>: The path name of
            the client public key certificate file.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a>: The path name of
            the client private key file.
</p></li></ul>
</div>
<p>
        For additional security relative to that provided by the default
        encryption, clients can supply a CA certificate matching the one
        used by the server and enable host name identity verification.
        In this way, the server and client place their trust in the same
        CA certificate and the client verifies that the host to which it
        connected is the one intended:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To specify the CA certificate, use
            <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> (or
            <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a>), and specify
            <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_CA</code></a>.
          </p></li><li class="listitem"><p>
            To enable host name identity verification as well, use
            <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_IDENTITY</code></a>
            rather than
            <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_CA</code></a>.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          Host name identity verification with
          <code class="literal">VERIFY_IDENTITY</code> does not work with
          self-signed certificates created automatically by the server,
          or manually using <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a> (see
          <a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql" title="6.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL">Section 6.3.3.1, “Creating SSL and RSA Certificates and Keys using MySQL”</a>). Such
          self-signed certificates do not contain the server name as the
          Common Name value.
        </p><p>
          Host name identity verification also does not work with
          certificates that specify the Common Name using wildcards
          because that name is compared verbatim to the server name.
</p>
</div>
<p>
        MySQL also provides these options for client-side SSL control:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher</code></a>: The list of
            permitted ciphers for connection encryption.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a>: The path name of
            the file containing certificate revocation lists.
            (<code class="option">--ssl-crlpath</code> is similar but specifies the
            path name of a directory of certificate revocation-list
            files.)
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#option_general_tls-version"><code class="option">--tls-version</code></a>,
            <a class="link" href="security.html#option_general_tls-ciphersuites"><code class="option">--tls-ciphersuites</code></a>: The
            permitted encryption protocols and ciphersuites; see
            <a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.6 Encrypted Connection Protocols and Ciphers">Section 6.3.6, “Encrypted Connection Protocols and Ciphers”</a>.
</p></li></ul>
</div>
<p>
        Depending on the encryption requirements of the MySQL account
        used by a client, the client may be required to specify certain
        options to connect using encryption to the MySQL server.
      </p><p>
        Suppose that you want to connect using an account that has no
        special encryption requirements or that was created using a
        <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement that
        included the <code class="literal">REQUIRE SSL</code> clause. Assuming
        that the server supports encrypted connections, a client can
        connect using encryption with no
        <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a> option or with an
        explicit <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=PREFFERED</code></a>
        option:
      </p><pre data-lang="terminal" class="programlisting">
mysql
</pre><p>
        Or:
      </p><pre data-lang="terminal" class="programlisting">
mysql --ssl-mode=PREFERRED
</pre><p>
        For an account created with a <code class="literal">REQUIRE SSL</code>
        clause, the connection attempt fails if an encrypted connection
        cannot be established. For an account with no special encryption
        requirements, the attempt falls back to an unencrypted
        connection if an encrypted connection cannot be established. To
        prevent fallback and fail if an encrypted connection cannot be
        obtained, connect like this:
      </p><pre data-lang="terminal" class="programlisting">
mysql --ssl-mode=REQUIRED
</pre><p>
        If the account has more stringent security requirements, other
        options must be specified to establish an encrypted connection:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            For accounts created with a <code class="literal">REQUIRE X509</code>
            clause, clients must specify at least
            <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a> and
            <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a>. In addition,
            <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> (or
            <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a>) is recommended
            so that the public certificate provided by the server can be
            verified. For example:
          </p><pre data-lang="terminal" class="programlisting">
mysql --ssl-ca=ca.pem \
      --ssl-cert=client-cert.pem \
      --ssl-key=client-key.pem
</pre></li><li class="listitem"><p>
            For accounts created with a <code class="literal">REQUIRE
            ISSUER</code> or <code class="literal">REQUIRE SUBJECT</code>
            clause, the encryption requirements are the same as for
            <code class="literal">REQUIRE X509</code>, but the certificate must
            match the issue or subject, respectively, specified in the
            account definition.
</p></li></ul>
</div>
<p>
        For additional information about the <code class="literal">REQUIRE</code>
        clause, see <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>.
      </p><p>
        To prevent use of encryption and override other
        <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code> options,
        invoke the client program with
        <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=DISABLED</code></a>:
      </p><pre data-lang="terminal" class="programlisting">
mysql --ssl-mode=DISABLED
</pre><p>
        To determine whether the current connection with the server uses
        encryption, check the session value of the
        <a class="link" href="server-administration.html#statvar_Ssl_cipher"><code class="literal">Ssl_cipher</code></a> status variable. If
        the value is empty, the connection is not encrypted. Otherwise,
        the connection is encrypted and the value indicates the
        encryption cipher. For example:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW SESSION STATUS LIKE 'Ssl_cipher';</code></strong>
+---------------+---------------------------+
| Variable_name | Value                     |
+---------------+---------------------------+
| Ssl_cipher    | DHE-RSA-AES128-GCM-SHA256 |
+---------------+---------------------------+
</pre><p>
        For the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client, an alternative is to
        use the <code class="literal">STATUS</code> or <code class="literal">\s</code>
        command and check the <code class="literal">SSL</code> line:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>\s</code></strong>
...
SSL: Not in use
...
</pre><p>
        Or:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>\s</code></strong>
...
SSL: Cipher in use is DHE-RSA-AES128-GCM-SHA256
...
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="mandatory-encrypted-connections"></a>Configuring Encrypted Connections as Mandatory</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091721030080"></a><p>
        For some MySQL deployments it may be not only desirable but
        mandatory to use encrypted connections (for example, to satisfy
        regulatory requirements). This section discusses configuration
        settings that enable you to do this. These levels of control are
        available:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            You can configure the server to require the clients connect
            using encrypted connections.
          </p></li><li class="listitem"><p>
            You can invoke individual client programs to require an
            encrypted connection, even if the server permits but does
            not require encryption.
          </p></li><li class="listitem"><p>
            You can configure individual MySQL accounts to be usable
            only over encrypted connections.
</p></li></ul>
</div>
<p>
        To require that clients connect using encrypted connections,
        enable the
        <a class="link" href="server-administration.html#sysvar_require_secure_transport"><code class="literal">require_secure_transport</code></a> system
        variable. For example, put these lines in the server
        <code class="filename">my.cnf</code> file:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
require_secure_transport=ON
</pre><p>
        Alternatively, to set and persist the value at runtime, use this
        statement:
      </p><pre data-lang="sql" class="programlisting">
SET PERSIST require_secure_transport=ON;
</pre><p>
        <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
        PERSIST</code></a> sets the value for the running MySQL instance.
        It also saves the value, causing it to be used for subsequent
        server restarts. See <a class="xref" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment">Section 13.7.5.1, “SET Syntax for Variable Assignment”</a>.
      </p><p>
        With <a class="link" href="server-administration.html#sysvar_require_secure_transport"><code class="literal">require_secure_transport</code></a>
        enabled, client connections to the server are required to use
        some form of secure transport, and the server permits only
        TCP/IP connections that use SSL, or connections that use a
        socket file (on Unix) or shared memory (on Windows). The server
        rejects nonsecure connection attempts, which fail with an
        <a class="link" href="error-handling.html#error_er_secure_transport_required"><code class="literal">ER_SECURE_TRANSPORT_REQUIRED</code></a>
        error.
      </p><p>
        To invoke a client program such that it requires an encrypted
        connection whether or not the server requires encryption, use an
        <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a> option value of
        <code class="literal">REQUIRED</code>, <code class="literal">VERIFY_CA</code>, or
        <code class="literal">VERIFY_IDENTITY</code>. For example:
      </p><pre data-lang="terminal" class="programlisting">
mysql --ssl-mode=REQUIRED
mysqldump --ssl-mode=VERIFY_CA
mysqladmin --ssl-mode=VERIFY_IDENTITY
</pre><p>
        To configure a MySQL account to be usable only over encrypted
        connections, include a <code class="literal">REQUIRE</code> clause in the
        <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement that
        creates the account, specifying in that clause the encryption
        characteristics you require. For example, to require an
        encrypted connection and the use of a valid X.509 certificate,
        use <code class="literal">REQUIRE X509</code>:
      </p><pre data-lang="sql" class="programlisting">
CREATE USER 'jeffrey'@'localhost' REQUIRE X509;
</pre><p>
        For additional information about the <code class="literal">REQUIRE</code>
        clause, see <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>.
      </p><p>
        To modify existing accounts that have no encryption
        requirements, use the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>
        statement.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="encrypted-connection-options"></a>6.3.2 Command Options for Encrypted Connections</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091720999952"></a><a class="indexterm" name="idm140091720998464"></a><a class="indexterm" name="idm140091720996976"></a><a class="indexterm" name="idm140091720995520"></a><p>
      This section describes options that specify whether to use
      encrypted connections, the names of certificate and key files, and
      other parameters related to encrypted-connection support. These
      options can be given on the command line or in an option file. For
      examples of suggested use and how to check whether a connection is
      encrypted, see <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>.
    </p><p>
      For information about using encrypted connections from the MySQL C
      API, see <a class="xref" href="connectors-apis.html#c-api-encrypted-connections" title="28.7.22 C API Encrypted Connection Support">Section 28.7.22, “C API Encrypted Connection Support”</a>.
</p>
<div class="table">
<a name="idm140091720991376"></a><p class="title"><b>Table 6.12 Encrypted-Connection Option Summary</b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Command-line options available for establishing encrypted connections."><col width="31%"><col width="56%"><col width="12%"><thead><tr><th scope="col">Format</th>
<th scope="col">Description</th>
<th scope="col">Introduced</th>
</tr></thead><tbody><tr><td scope="row"><a class="link" href="security.html#option_general_ssl">--skip-ssl</a></td>
<td>Do not use encrypted connection</td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl">--ssl</a></td>
<td>Enable encrypted connection</td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-ca">--ssl-ca</a></td>
<td>File that contains list of trusted SSL Certificate Authorities</td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-capath">--ssl-capath</a></td>
<td>Directory that contains trusted SSL Certificate Authority certificate files</td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-cert">--ssl-cert</a></td>
<td>File that contains X.509 certificate</td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-cipher">--ssl-cipher</a></td>
<td>List of permitted ciphers for connection encryption</td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-crl">--ssl-crl</a></td>
<td>File that contains certificate revocation lists</td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-crlpath">--ssl-crlpath</a></td>
<td>Directory that contains certificate revocation-list files</td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-fips-mode">--ssl-fips-mode</a></td>
<td>Whether to enable FIPS mode on client side</td>
<td>8.0.11</td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-key">--ssl-key</a></td>
<td>File that contains X.509 key</td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_ssl-mode">--ssl-mode</a></td>
<td>Security state of connection to server</td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_tls-ciphersuites">--tls-ciphersuites</a></td>
<td>TLSv1.3 ciphersuites permitted for encrypted connections</td>
<td>8.0.16</td>
</tr><tr><td scope="row"><a class="link" href="security.html#option_general_tls-version">--tls-version</a></td>
<td>Protocols permitted for encrypted connections</td>
<td></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_general_ssl"></a>
          <a class="indexterm" name="idm140091720934608"></a>

          <a class="indexterm" name="idm140091720933568"></a>

          <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            The client-side <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a> option
            is removed in MySQL 8.0. For client programs,
            use <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a> instead.
</p>
</div>
<p>
          On the server side, the <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>
          option specifies that the server permits but does not require
          encrypted connections. The option is enabled on the server
          side by default. <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a> is
          implied by other
          <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code> options,
          as indicated in the descriptions for those options.
        </p><p>
          The <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a> option in negated
          form indicates that encryption should <span class="emphasis"><em>not</em></span>
          be used and overrides other
          <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code> options.
          Specify the option as <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl=0</code></a>
          or a synonym
          (<a class="link" href="security.html#option_general_ssl"><code class="option">--skip-ssl</code></a>,
          <a class="link" href="security.html#option_general_ssl"><code class="option">--disable-ssl</code></a>).
        </p><p>
          To specify additional parameters for encrypted connections,
          use at least <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a> and
          <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a> on the server side
          and <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> on the client
          side. See <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>. That
          section also describes server capabilities for certificate and
          key file autogeneration and autodiscovery.
        </p></li><li class="listitem"><p><a name="option_general_ssl-ca"></a>
          <a class="indexterm" name="idm140091720914544"></a>

          <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca=<em class="replaceable"><code>file_name</code></em></code></a>
        </p><p>
          The path name of the Certificate Authority (CA) certificate
          file in PEM format. On the server side, this option implies
          <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
        </p><p>
          To tell the client not to authenticate the server certificate
          when establishing an encrypted connection to the server,
          specify neither <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> nor
          <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a>. The server still
          verifies the client according to any applicable requirements
          established for the client account, and it still uses any
          <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> or
          <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a> option values
          specified on the server side.
        </p></li><li class="listitem"><p><a name="option_general_ssl-capath"></a>
          <a class="indexterm" name="idm140091720904944"></a>

          <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath=<em class="replaceable"><code>dir_name</code></em></code></a>
        </p><p>
          The path name of the directory that contains trusted SSL
          certificate authority (CA) certificate files in PEM format. On
          the server side, this option implies
          <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
        </p><p>
          To tell the client not to authenticate the server certificate
          when establishing an encrypted connection to the server,
          specify neither <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> nor
          <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a>. The server still
          verifies the client according to any applicable requirements
          established for the client account, and it still uses any
          <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> or
          <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a> option values
          specified on the server side.
        </p><p>
          Support for this option depends on the SSL library used to
          compile MySQL. See <a class="xref" href="security.html#ssl-libraries" title="6.3.4 SSL Library-Dependent Capabilities">Section 6.3.4, “SSL Library-Dependent Capabilities”</a>.
        </p></li><li class="listitem"><p><a name="option_general_ssl-cert"></a>
          <a class="indexterm" name="idm140091720894048"></a>

          <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert=<em class="replaceable"><code>file_name</code></em></code></a>
        </p><p>
          The path name of the SSL public key certificate file in PEM
          format. On the client side, this is the client public key
          certificate. On the server side, this is the server public key
          certificate. On the server side, this option implies
          <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
        </p></li><li class="listitem"><p><a name="option_general_ssl-cipher"></a>
          <a class="indexterm" name="idm140091720888864"></a>

          <a class="link" href="security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher=<em class="replaceable"><code>cipher_list</code></em></code></a>
        </p><p>
          The list of permitted ciphers for connection encryption. If no
          cipher in the list is supported, encrypted connections will
          not work. On the server side, this option implies
          <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
        </p><p>
          For greatest portability,
          <em class="replaceable"><code>cipher_list</code></em> should be a list of one
          or more cipher names, separated by colons. Examples:
        </p><pre data-lang="terminal" class="programlisting">
--ssl-cipher=AES128-SHA
--ssl-cipher=DHE-RSA-AES128-GCM-SHA256:AES128-SHA
</pre><p>
          OpenSSL supports a more flexible syntax for specifying
          ciphers, as described in the OpenSSL documentation at
          <a class="ulink" href="https://www.openssl.org/docs/manmaster/man1/ciphers.html" target="_top">https://www.openssl.org/docs/manmaster/man1/ciphers.html</a>.
          wolfSSL does not, so attempts to use that extended syntax fail
          for a MySQL distribution compiled using wolfSSL.
        </p><p>
          For information about which encryption ciphers MySQL supports,
          see <a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.6 Encrypted Connection Protocols and Ciphers">Section 6.3.6, “Encrypted Connection Protocols and Ciphers”</a>.
        </p></li><li class="listitem"><p><a name="option_general_ssl-crl"></a>
          <a class="indexterm" name="idm140091720879264"></a>

          <a class="link" href="security.html#option_general_ssl-crl"><code class="option">--ssl-crl=<em class="replaceable"><code>file_name</code></em></code></a>
        </p><p>
          The path name of the file containing certificate revocation
          lists in PEM format. On the server side, this option implies
          <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
        </p><p>
          If neither <a class="link" href="security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a> nor
          <a class="link" href="security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath</code></a> is given, no CRL
          checks are performed, even if the CA path contains certificate
          revocation lists.
        </p><p>
          Support for this option depends on the SSL library used to
          compile MySQL. See <a class="xref" href="security.html#ssl-libraries" title="6.3.4 SSL Library-Dependent Capabilities">Section 6.3.4, “SSL Library-Dependent Capabilities”</a>.
        </p></li><li class="listitem"><p><a name="option_general_ssl-crlpath"></a>
          <a class="indexterm" name="idm140091720870608"></a>

          <a class="link" href="security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath=<em class="replaceable"><code>dir_name</code></em></code></a>
        </p><p>
          The path name of the directory that contains certificate
          revocation-list files in PEM format. On the server side, this
          option implies <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
        </p><p>
          If neither <a class="link" href="security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a> nor
          <a class="link" href="security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath</code></a> is given, no CRL
          checks are performed, even if the CA path contains certificate
          revocation lists.
        </p><p>
          Support for this option depends on the SSL library used to
          compile MySQL. See <a class="xref" href="security.html#ssl-libraries" title="6.3.4 SSL Library-Dependent Capabilities">Section 6.3.4, “SSL Library-Dependent Capabilities”</a>.
        </p></li><li class="listitem"><p><a name="option_general_ssl-fips-mode"></a>
          <a class="link" href="security.html#option_general_ssl-fips-mode"><code class="option">--ssl-fips-mode={OFF|ON|STRICT}</code></a>
        </p><a class="indexterm" name="idm140091720860832"></a><p>
          Controls whether to enable FIPS mode on the client side. The
          <a class="link" href="security.html#option_general_ssl-fips-mode"><code class="option">--ssl-fips-mode</code></a> option differs
          from other
          <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code> options
          in that it is not used to establish encrypted connections, but
          rather to affect which cryptographic operations are permitted.
          See <a class="xref" href="security.html#fips-mode" title="6.5 FIPS Support">Section 6.5, “FIPS Support”</a>.
        </p><p>
          These <a class="link" href="security.html#option_general_ssl-fips-mode"><code class="option">--ssl-fips-mode</code></a> values
          are permitted:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">OFF</code>: Disable FIPS mode.
            </p></li><li class="listitem"><p>
              <code class="literal">ON</code>: Enable FIPS mode.
            </p></li><li class="listitem"><p>
              <code class="literal">STRICT</code>: Enable <span class="quote">“<span class="quote">strict</span>”</span>
              FIPS mode.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            If the OpenSSL FIPS Object Module is not available, the only
            permitted value for
            <a class="link" href="security.html#option_general_ssl-fips-mode"><code class="option">--ssl-fips-mode</code></a> is
            <code class="literal">OFF</code>. In this case, setting
            <a class="link" href="security.html#option_general_ssl-fips-mode"><code class="option">--ssl-fips-mode</code></a> to
            <code class="literal">ON</code> or <code class="literal">STRICT</code> causes
            the client to produce a warning at startup and to operate in
            non-FIPS mode.
</p>
</div>
</li><li class="listitem"><p><a name="option_general_ssl-key"></a>
          <a class="indexterm" name="idm140091720843760"></a>

          <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key=<em class="replaceable"><code>file_name</code></em></code></a>
        </p><p>
          The path name of the SSL private key file in PEM format. On
          the client side, this is the client private key. On the server
          side, this is the server private key. On the server side, this
          option implies <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a>.
        </p><p>
          If the key file is protected by a passphrase, the program
          prompts the user for the passphrase. The password must be
          given interactively; it cannot be stored in a file. If the
          passphrase is incorrect, the program continues as if it could
          not read the key.
        </p><p>
          For better security, use a certificate with an RSA key size of
          at least 2048 bits.
        </p></li><li class="listitem"><p><a name="option_general_ssl-mode"></a>
          <a class="indexterm" name="idm140091720837552"></a>

          <a class="indexterm" name="idm140091720836096"></a>

          <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=<em class="replaceable"><code>mode</code></em></code></a>
        </p><p>
          This option is available only for client programs, not the
          server. It specifies the security state of the connection to
          the server. These option values are permitted:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">PREFERRED</code>: Establish an encrypted
              connection if the server supports encrypted connections,
              falling back to an unencrypted connection if an encrypted
              connection cannot be established. This is the default if
              <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a> is not
              specified.
            </p><p>
              Encrypted connections over Unix sockets are disabled by
              default, so <code class="literal">PREFERRED</code> does not
              establish an encrypted connection. To enforce encryption
              for Unix socket connections, use
              <code class="literal">REQUIRED</code> or above.
            </p></li><li class="listitem"><p>
              <code class="literal">REQUIRED</code>: Establish an encrypted
              connection if the server supports encrypted connections.
              The connection attempt fails if an encrypted connection
              cannot be established.
            </p></li><li class="listitem"><p>
              <code class="literal">VERIFY_CA</code>: Like
              <code class="literal">REQUIRED</code>, but additionally verify the
              server Certificate Authority (CA) certificate against the
              configured CA certificates. The connection attempt fails
              if no valid matching CA certificates are found.
            </p></li><li class="listitem"><p>
              <code class="literal">VERIFY_IDENTITY</code>: Like
              <code class="literal">VERIFY_CA</code>, but additionally perform
              host name identity verification by checking the host name
              the client uses for connecting to the server against the
              identity in the certificate that the server sends to the
              client:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                  As of MySQL 8.0.12, if the client uses OpenSSL 1.0.2
                  or higher, the client checks whether the host name
                  that it uses for connecting matches either the Subject
                  Alternative Name value or the Common Name value in the
                  server certificate.
                </p></li><li class="listitem"><p>
                  Otherwise, the client checks whether the host name
                  that it uses for connecting matches the Common Name
                  value in the server certificate.
</p></li></ul>
</div>
<p>
              The connection fails if there is a mismatch. For encrypted
              connections, this option helps prevent man-in-the-middle
              attacks.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                Host name identity verification with
                <code class="literal">VERIFY_IDENTITY</code> does not work with
                self-signed certificates created automatically by the
                server, or manually using
                <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a> (see
                <a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql" title="6.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL">Section 6.3.3.1, “Creating SSL and RSA Certificates and Keys using MySQL”</a>).
                Such self-signed certificates do not contain the server
                name as the Common Name value.
              </p><p>
                Host name identity verification also does not work with
                certificates that specify the Common Name using
                wildcards because that name is compared verbatim to the
                server name.
</p>
</div>
</li><li class="listitem"><p>
              <code class="literal">DISABLED</code>: Establish an unencrypted
              connection.
</p></li></ul>
</div>
<p>
          The <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a> option
          interacts with CA certificate options as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a> is not
              explicitly set otherwise, use of
              <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> or
              <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a> implies
              <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode=VERIFY_CA</code></a>.
            </p></li><li class="listitem"><p>
              For <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a> values of
              <code class="literal">VERIFY_CA</code> or
              <code class="literal">VERIFY_IDENTITY</code>,
              <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> or
              <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a> is also
              required, to supply a CA certificate that matches the one
              used by the server.
            </p></li><li class="listitem"><p>
              An explicit <a class="link" href="security.html#option_general_ssl-mode"><code class="option">--ssl-mode</code></a>
              option with a value other than
              <code class="literal">VERIFY_CA</code> or
              <code class="literal">VERIFY_IDENTITY</code>, together with an
              explicit <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> or
              <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a> option,
              produces a warning that no verification of the server
              certificate will be done, despite a CA certificate option
              being specified.
</p></li></ul>
</div>
<p>
          To require use of encrypted connections by a MySQL account,
          use <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> to create the
          account with a <code class="literal">REQUIRE SSL</code> clause, or use
          <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> for an existing
          account to add a <code class="literal">REQUIRE SSL</code> clause.
          Connection attempts by clients that use the account will be
          rejected unless MySQL supports encrypted connections and an
          encrypted connection can be established.
        </p><p>
          The <code class="literal">REQUIRE</code> clause permits other
          encryption-related options, which can be used to enforce
          security requirements stricter than <code class="literal">REQUIRE
          SSL</code>. For additional details about which command
          options may or must be specified by clients that connect using
          accounts configured using the various
          <code class="literal">REQUIRE</code> options, see the description of
          <code class="literal">REQUIRE</code> in <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>.
        </p></li><li class="listitem"><p><a name="option_general_tls-ciphersuites"></a>
          <a class="indexterm" name="idm140091720784560"></a>

          <a class="link" href="security.html#option_general_tls-ciphersuites"><code class="option">--tls-ciphersuites=<em class="replaceable"><code>ciphersuite_list</code></em></code></a>
        </p><p>
          For client programs, specifies which TLSv1.3 ciphersuites the
          client permits for encrypted connections. The value is a list
          of one or more colon-separated ciphersuite names. For example:
        </p><pre data-lang="terminal" class="programlisting">
mysql --tls-ciphersuites="<em class="replaceable"><code>suite1</code></em>:<em class="replaceable"><code>suite2</code></em>:<em class="replaceable"><code>suite3</code></em>"
</pre><p>
          The ciphersuites that can be named for this option depend on
          the SSL library used to compile MySQL. For details, see
          <a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.6 Encrypted Connection Protocols and Ciphers">Section 6.3.6, “Encrypted Connection Protocols and Ciphers”</a>.
        </p><p>
          This option was added in MySQL 8.0.16.
        </p><p>
          To specify which ciphersuites the server permits, use the
          <a class="link" href="server-administration.html#sysvar_tls_ciphersuites"><code class="literal">tls_ciphersuites</code></a> system
          variable instead.
        </p></li><li class="listitem"><p><a name="option_general_tls-version"></a>
          <a class="indexterm" name="idm140091720774704"></a>

          <a class="link" href="security.html#option_general_tls-version"><code class="option">--tls-version=<em class="replaceable"><code>protocol_list</code></em></code></a>
        </p><p>
          For client programs, specifies which protocols the client
          permits for encrypted connections. The value is a list of one
          or more comma-separated protocol names. For example:
        </p><pre data-lang="terminal" class="programlisting">
mysql --tls-version="TLSv1.1,TLSv1.2"
</pre><p>
          The protocols that can be named for this option depend on the
          SSL library used to compile MySQL. For details, see
          <a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.6 Encrypted Connection Protocols and Ciphers">Section 6.3.6, “Encrypted Connection Protocols and Ciphers”</a>.
        </p><p>
          To specify which protocols the server permits, use the
          <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a> system variable
          instead.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="creating-ssl-rsa-files"></a>6.3.3 Creating SSL and RSA Certificates and Keys</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#creating-ssl-rsa-files-using-mysql">6.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL</a></span></dt><dt><span class="section"><a href="security.html#creating-ssl-files-using-openssl">6.3.3.2 Creating SSL Certificates and Keys Using openssl</a></span></dt><dt><span class="section"><a href="security.html#creating-rsa-files-using-openssl">6.3.3.3 Creating RSA Keys Using openssl</a></span></dt></dl>
</div>
<p>
      The following discussion describes how to create the files
      required for SSL and RSA support in MySQL. File creation can be
      performed using facilities provided by MySQL itself, or by
      invoking the <span class="command"><strong>openssl</strong></span> command directly.
    </p><p>
      SSL certificate and key files enable MySQL to support encrypted
      connections using SSL. See
      <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>.
    </p><p>
      RSA key files enable MySQL to support secure password exchange
      over unencrypted connections for accounts authenticated by the
      <code class="literal">sha256_password</code> or
      <code class="literal">caching_sha2_password</code> plugin. See
      <a class="xref" href="security.html#sha256-pluggable-authentication" title="6.4.1.2 SHA-256 Pluggable Authentication">Section 6.4.1.2, “SHA-256 Pluggable Authentication”</a>, and
      <a class="xref" href="security.html#caching-sha2-pluggable-authentication" title="6.4.1.3 Caching SHA-2 Pluggable Authentication">Section 6.4.1.3, “Caching SHA-2 Pluggable Authentication”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="creating-ssl-rsa-files-using-mysql"></a>6.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL</h4>
</div>
</div>
</div>
<p>
        MySQL provides these ways to create the SSL certificate and key
        files and RSA key-pair files required to support encrypted
        connections using SSL and secure password exchange using RSA
        over unencrypted connections, if those files are missing:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The server can autogenerate these files at startup, for
            MySQL distributions compiled using OpenSSL.
          </p></li><li class="listitem"><p>
            Users can invoke the <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a>
            utility manually.
          </p></li><li class="listitem"><p>
            For some distribution types, such as RPM packages,
            <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a> invocation occurs
            during data directory initialization. In this case, the
            MySQL distribution need not have been compiled using OpenSSL
            as long as the <span class="command"><strong>openssl</strong></span> command is
            available.
</p></li></ul>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Important
</div>
<p>
          Server autogeneration and
          <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a> help lower the barrier
          to using SSL by making it easier to generate the required
          files. However, certificates generated by these methods are
          self-signed, which may not be very secure. After you gain
          experience using such files, consider obtaining
          certificate/key material from a registered certificate
          authority.
</p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql-automatic" title="Automatic SSL and RSA File Generation">Automatic SSL and RSA File Generation</a></p></li><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql-manual-using-mysql-ssl-rsa-setup" title="Manual SSL and RSA File Generation Using mysql_ssl_rsa_setup">Manual SSL and RSA File Generation Using mysql_ssl_rsa_setup</a></p></li><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql-ssl-and-rsa-file-characteristics" title="SSL and RSA File Characteristics">SSL and RSA File Characteristics</a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-rsa-files-using-mysql-automatic"></a>Automatic SSL and RSA File Generation</h5>

</div>

</div>

</div>
<p>
          For MySQL distributions compiled using OpenSSL, the MySQL
          server has the capability of automatically generating missing
          SSL and RSA files at startup. The
          <a class="link" href="server-administration.html#sysvar_auto_generate_certs"><code class="literal">auto_generate_certs</code></a>,
          <a class="link" href="server-administration.html#sysvar_sha256_password_auto_generate_rsa_keys"><code class="literal">sha256_password_auto_generate_rsa_keys</code></a>,
          and
          <a class="link" href="server-administration.html#sysvar_caching_sha2_password_auto_generate_rsa_keys"><code class="literal">caching_sha2_password_auto_generate_rsa_keys</code></a>
          system variables control automatic generation of these files.
          These variables are enabled by default. They can be enabled at
          startup and inspected but not set at runtime.
        </p><p>
          At startup, the server automatically generates server-side and
          client-side SSL certificate and key files in the data
          directory if the
          <a class="link" href="server-administration.html#sysvar_auto_generate_certs"><code class="literal">auto_generate_certs</code></a> system
          variable is enabled, no SSL options other than
          <a class="link" href="security.html#option_general_ssl"><code class="option">--ssl</code></a> are specified, and the
          server-side SSL files are missing from the data directory.
          These files enable encrypted client connections using SSL; see
          <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              The server checks the data directory for SSL files with
              the following names:
            </p><pre data-lang="ini" class="programlisting">
ca.pem
server-cert.pem
server-key.pem
</pre></li><li class="listitem"><p>
              If any of those files are present, the server creates no
              SSL files. Otherwise, it creates them, plus some
              additional files:
            </p><pre data-lang="ini" class="programlisting">
ca.pem               Self-signed CA certificate
ca-key.pem           CA private key
server-cert.pem      Server certificate
server-key.pem       Server private key
client-cert.pem      Client certificate
client-key.pem       Client private key
</pre></li><li class="listitem"><p>
              If the server autogenerates SSL files, it uses the names
              of the <code class="filename">ca.pem</code>,
              <code class="filename">server-cert.pem</code>, and
              <code class="filename">server-key.pem</code> files to set the
              corresponding system variables
              (<a class="link" href="server-administration.html#sysvar_ssl_ca"><code class="literal">ssl_ca</code></a>,
              <a class="link" href="server-administration.html#sysvar_ssl_cert"><code class="literal">ssl_cert</code></a>,
              <a class="link" href="server-administration.html#sysvar_ssl_key"><code class="literal">ssl_key</code></a>).
</p></li></ol>
</div>
<p>
          At startup, the server automatically generates RSA
          private/public key-pair files in the data directory if all of
          these conditions are true: The
          <a class="link" href="server-administration.html#sysvar_sha256_password_auto_generate_rsa_keys"><code class="literal">sha256_password_auto_generate_rsa_keys</code></a>
          or
          <a class="link" href="server-administration.html#sysvar_caching_sha2_password_auto_generate_rsa_keys"><code class="literal">caching_sha2_password_auto_generate_rsa_keys</code></a>
          system variable is enabled; no RSA options are specified; the
          RSA files are missing from the data directory. These key-pair
          files enable secure password exchange using RSA over
          unencrypted connections for accounts authenticated by the
          <code class="literal">sha256_password</code> or
          <code class="literal">caching_sha2_password</code> plugin; see
          <a class="xref" href="security.html#sha256-pluggable-authentication" title="6.4.1.2 SHA-256 Pluggable Authentication">Section 6.4.1.2, “SHA-256 Pluggable Authentication”</a>, and
          <a class="xref" href="security.html#caching-sha2-pluggable-authentication" title="6.4.1.3 Caching SHA-2 Pluggable Authentication">Section 6.4.1.3, “Caching SHA-2 Pluggable Authentication”</a>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              The server checks the data directory for RSA files with
              the following names:
            </p><pre data-lang="ini" class="programlisting">
private_key.pem      Private member of private/public key pair
public_key.pem       Public member of private/public key pair
</pre></li><li class="listitem"><p>
              If any of these files are present, the server creates no
              RSA files. Otherwise, it creates them.
            </p></li><li class="listitem"><p>
              If the server autogenerates the RSA files, it uses their
              names to set the corresponding system variables
              (<a class="link" href="server-administration.html#sysvar_sha256_password_private_key_path"><code class="literal">sha256_password_private_key_path</code></a>
              and
              <a class="link" href="server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a>;
              <a class="link" href="server-administration.html#sysvar_caching_sha2_password_private_key_path"><code class="literal">caching_sha2_password_private_key_path</code></a>
              and
              <a class="link" href="server-administration.html#sysvar_caching_sha2_password_public_key_path"><code class="literal">caching_sha2_password_public_key_path</code></a>).
</p></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-rsa-files-using-mysql-manual-using-mysql-ssl-rsa-setup"></a>Manual SSL and RSA File Generation Using mysql_ssl_rsa_setup</h5>

</div>

</div>

</div>
<p>
          MySQL distributions include a
          <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a> utility that can be
          invoked manually to generate SSL and RSA files. This utility
          is included with all MySQL distributions (whether compiled
          using OpenSSL or wolfSSL), but it does require that the
          <span class="command"><strong>openssl</strong></span> command be available. For usage
          instructions, see <a class="xref" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files">Section 4.4.3, “<span class="command"><strong>mysql_ssl_rsa_setup</strong></span> — Create SSL/RSA Files”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-rsa-files-using-mysql-ssl-and-rsa-file-characteristics"></a>SSL and RSA File Characteristics</h5>

</div>

</div>

</div>
<p>
          SSL and RSA files created automatically by the server or by
          invoking <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a> have these
          characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              SSL and RSA keys are have a size of 2048 bits.
            </p></li><li class="listitem"><p>
              The SSL CA certificate is self signed.
            </p></li><li class="listitem"><p>
              The SSL server and client certificates are signed with the
              CA certificate and key, using the
              <code class="literal">sha256WithRSAEncryption</code> signature
              algorithm.
            </p></li><li class="listitem"><p>
              SSL certificates use these Common Name (CN) values, with
              the appropriate certificate type (CA, Server, Client):
            </p><pre data-lang="ini" class="programlisting">
ca.pem:         MySQL_Server_<em class="replaceable"><code>suffix</code></em>_Auto_Generated_CA_Certificate
server-cert.pm: MySQL_Server_<em class="replaceable"><code>suffix</code></em>_Auto_Generated_Server_Certificate
client-cert.pm: MySQL_Server_<em class="replaceable"><code>suffix</code></em>_Auto_Generated_Client_Certificate
</pre><p>
              The <em class="replaceable"><code>suffix</code></em> value is based on
              the MySQL version number. For files generated by
              <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a>, the suffix can be
              specified explicitly using the
              <a class="link" href="programs.html#option_mysql_ssl_rsa_setup_suffix"><code class="option">--suffix</code></a>
              option.
            </p><p>
              For files generated by the server, if the resulting CN
              values exceed 64 characters, the
              <code class="literal">_<em class="replaceable"><code>suffix</code></em></code>
              portion of the name is omitted.
            </p></li><li class="listitem"><p>
              SSL files have blank values for Country (C), State or
              Province (ST), Organization (O), Organization Unit Name
              (OU) and email address.
            </p></li><li class="listitem"><p>
              SSL files created by the server or by
              <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a> are valid for ten
              years from the time of generation.
            </p></li><li class="listitem"><p>
              RSA files do not expire.
            </p></li><li class="listitem"><p>
              SSL files have different serial numbers for each
              certificate/key pair (1 for CA, 2 for Server, 3 for
              Client).
            </p></li><li class="listitem"><p>
              Files created automatically by the server are owned by the
              account that runs the server. Files created using
              <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a> are owned by the
              user who invoked that program. This can be changed on
              systems that support the <code class="literal">chown()</code> system
              call if the program is invoked by <code class="literal">root</code>
              and the <a class="link" href="programs.html#option_mysql_ssl_rsa_setup_uid"><code class="option">--uid</code></a>
              option is given to specify the user who should own the
              files.
            </p></li><li class="listitem"><p>
              On Unix and Unix-like systems, the file access mode is 644
              for certificate files (that is, world readable) and 600
              for key files (that is, accessible only by the account
              that runs the server).
</p></li></ul>
</div>
<p>
          To see the contents of an SSL certificate (for example, to
          check the range of dates over which it is valid), invoke
          <span class="command"><strong>openssl</strong></span> directly:
        </p><pre data-lang="terminal" class="programlisting">
openssl x509 -text -in ca.pem
openssl x509 -text -in server-cert.pem
openssl x509 -text -in client-cert.pem
</pre><p>
          It is also possible to check SSL certificate expiration
          information using this SQL statement:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Ssl_server_not%';</code></strong>
+-----------------------+--------------------------+
| Variable_name         | Value                    |
+-----------------------+--------------------------+
| Ssl_server_not_after  | Apr 28 14:16:39 2027 GMT |
| Ssl_server_not_before | May  1 14:16:39 2017 GMT |
+-----------------------+--------------------------+
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="creating-ssl-files-using-openssl"></a>6.3.3.2 Creating SSL Certificates and Keys Using openssl</h4>

</div>

</div>

</div>
<p>
        This section describes how to use the <span class="command"><strong>openssl</strong></span>
        command to set up SSL certificate and key files for use by MySQL
        servers and clients. The first example shows a simplified
        procedure such as you might use from the command line. The
        second shows a script that contains more detail. The first two
        examples are intended for use on Unix and both use the
        <span class="command"><strong>openssl</strong></span> command that is part of OpenSSL. The
        third example describes how to set up SSL files on Windows.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          There are easier alternatives to generating the files required
          for SSL than the procedure described here: Let the server
          autogenerate them or use the
          <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a> program. See
          <a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql" title="6.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL">Section 6.3.3.1, “Creating SSL and RSA Certificates and Keys using MySQL”</a>.
</p>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Important
</div>
<p>
          Whatever method you use to generate the certificate and key
          files, the Common Name value used for the server and client
          certificates/keys must each differ from the Common Name value
          used for the CA certificate. Otherwise, the certificate and
          key files will not work for servers compiled using OpenSSL. A
          typical error in this case is:
        </p><pre data-lang="ini" class="programlisting">
ERROR 2026 (HY000): SSL connection error:
error:00000001:lib(0):func(0):reason(1)
</pre>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-files-using-openssl-unix-command-line" title="Example 1: Creating SSL Files from the Command Line on Unix">Example 1: Creating SSL Files from the Command Line on Unix</a></p></li><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-files-using-openssl-unix-script" title="Example 2: Creating SSL Files Using a Script on Unix">Example 2: Creating SSL Files Using a Script on Unix</a></p></li><li class="listitem"><p><a class="xref" href="security.html#creating-ssl-files-using-openssl-windows" title="Example 3: Creating SSL Files on Windows">Example 3: Creating SSL Files on Windows</a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-files-using-openssl-unix-command-line"></a>Example 1: Creating SSL Files from the Command Line on Unix</h5>

</div>

</div>

</div>
<p>
          The following example shows a set of commands to create MySQL
          server and client certificate and key files. You will need to
          respond to several prompts by the <span class="command"><strong>openssl</strong></span>
          commands. To generate test files, you can press Enter to all
          prompts. To generate files for production use, you should
          provide nonempty responses.
        </p><pre data-lang="terminal" class="programlisting">
# Create clean environment
rm -rf newcerts
mkdir newcerts &amp;&amp; cd newcerts

# Create CA certificate
openssl genrsa 2048 &gt; ca-key.pem
openssl req -new -x509 -nodes -days 3600 \
        -key ca-key.pem -out ca.pem

# Create server certificate, remove passphrase, and sign it
# server-cert.pem = public key, server-key.pem = private key
openssl req -newkey rsa:2048 -days 3600 \
        -nodes -keyout server-key.pem -out server-req.pem
openssl rsa -in server-key.pem -out server-key.pem
openssl x509 -req -in server-req.pem -days 3600 \
        -CA ca.pem -CAkey ca-key.pem -set_serial 01 -out server-cert.pem

# Create client certificate, remove passphrase, and sign it
# client-cert.pem = public key, client-key.pem = private key
openssl req -newkey rsa:2048 -days 3600 \
        -nodes -keyout client-key.pem -out client-req.pem
openssl rsa -in client-key.pem -out client-key.pem
openssl x509 -req -in client-req.pem -days 3600 \
        -CA ca.pem -CAkey ca-key.pem -set_serial 01 -out client-cert.pem
</pre><p>
          After generating the certificates, verify them:
        </p><pre data-lang="terminal" class="programlisting">
openssl verify -CAfile ca.pem server-cert.pem client-cert.pem
</pre><p>
          You should see a response like this:
        </p><pre data-lang="ini" class="programlisting">
server-cert.pem: OK
client-cert.pem: OK
</pre><p>
          To see the contents of a certificate (for example, to check
          the range of dates over which a certificate is valid), invoke
          <span class="command"><strong>openssl</strong></span> like this:
        </p><pre data-lang="terminal" class="programlisting">
openssl x509 -text -in ca.pem
openssl x509 -text -in server-cert.pem
openssl x509 -text -in client-cert.pem
</pre><p>
          Now you have a set of files that can be used as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">ca.pem</code>: Use this as the argument to
              <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> on the server and
              client sides. (The CA certificate, if used, must be the
              same on both sides.)
            </p></li><li class="listitem"><p>
              <code class="filename">server-cert.pem</code>,
              <code class="filename">server-key.pem</code>: Use these as the
              arguments to <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a>
              and <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a> on the
              server side.
            </p></li><li class="listitem"><p>
              <code class="filename">client-cert.pem</code>,
              <code class="filename">client-key.pem</code>: Use these as the
              arguments to <a class="link" href="security.html#option_general_ssl-cert"><code class="option">--ssl-cert</code></a>
              and <a class="link" href="security.html#option_general_ssl-key"><code class="option">--ssl-key</code></a> on the
              client side.
</p></li></ul>
</div>
<p>
          For additional usage instructions, see
          <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-files-using-openssl-unix-script"></a>Example 2: Creating SSL Files Using a Script on Unix</h5>

</div>

</div>

</div>
<p>
          Here is an example script that shows how to set up SSL
          certificate and key files for MySQL. After executing the
          script, use the files for SSL connections as described in
          <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>.
        </p><pre data-lang="terminal" class="programlisting">
DIR=`pwd`/openssl
PRIV=$DIR/private

mkdir $DIR $PRIV $DIR/newcerts
cp /usr/share/ssl/openssl.cnf $DIR
replace ./demoCA $DIR -- $DIR/openssl.cnf

# Create necessary files: $database, $serial and $new_certs_dir
# directory (optional)

touch $DIR/index.txt
echo "01" &gt; $DIR/serial

#
# Generation of Certificate Authority(CA)
#

openssl req -new -x509 -keyout $PRIV/cakey.pem -out $DIR/ca.pem \
    -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ................++++++
# .........++++++
# writing new private key to '/home/monty/openssl/private/cakey.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL admin
# Email Address []:

#
# Create server request and key
#
openssl req -new -keyout $DIR/server-key.pem -out \
    $DIR/server-req.pem -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ..++++++
# ..........++++++
# writing new private key to '/home/monty/openssl/server-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL server
# Email Address []:
#
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Remove the passphrase from the key
#
openssl rsa -in $DIR/server-key.pem -out $DIR/server-key.pem

#
# Sign server cert
#
openssl ca -cert $DIR/ca.pem -policy policy_anything \
    -out $DIR/server-cert.pem -config $DIR/openssl.cnf \
    -infiles $DIR/server-req.pem

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL admin'
# Certificate is to be certified until Sep 13 14:22:46 2003 GMT
# (365 days)
# Sign the certificate? [y/n]:y
#
#
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Create client request and key
#
openssl req -new -keyout $DIR/client-key.pem -out \
    $DIR/client-req.pem -days 3600 -config $DIR/openssl.cnf

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# .....................................++++++
# .............................................++++++
# writing new private key to '/home/monty/openssl/client-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be
# incorporated into your certificate request.
# What you are about to enter is what is called a Distinguished Name
# or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL user
# Email Address []:
#
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Remove the passphrase from the key
#
openssl rsa -in $DIR/client-key.pem -out $DIR/client-key.pem

#
# Sign client cert
#

openssl ca -cert $DIR/ca.pem -policy policy_anything \
    -out $DIR/client-cert.pem -config $DIR/openssl.cnf \
    -infiles $DIR/client-req.pem

# Sample output:
# Using configuration from /home/monty/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL user'
# Certificate is to be certified until Sep 13 16:45:17 2003 GMT
# (365 days)
# Sign the certificate? [y/n]:y
#
#
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Create a my.cnf file that you can use to test the certificates
#

cat &lt;&lt;EOF &gt; $DIR/my.cnf
[client]
ssl-ca=$DIR/ca.pem
ssl-cert=$DIR/client-cert.pem
ssl-key=$DIR/client-key.pem
[mysqld]
ssl-ca=$DIR/ca.pem
ssl-cert=$DIR/server-cert.pem
ssl-key=$DIR/server-key.pem
EOF
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="creating-ssl-files-using-openssl-windows"></a>Example 3: Creating SSL Files on Windows</h5>

</div>

</div>

</div>
<p>
          Download OpenSSL for Windows if it is not installed on your
          system. An overview of available packages can be seen here:
        </p><pre data-lang="ini" class="programlisting">
<a class="ulink" href="http://www.slproweb.com/products/Win32OpenSSL.html" target="_top">http://www.slproweb.com/products/Win32OpenSSL.html</a>
</pre><p>
          Choose the Win32 OpenSSL Light or Win64 OpenSSL Light package,
          depending on your architecture (32-bit or 64-bit). The default
          installation location will be
          <code class="literal">C:\OpenSSL-Win32</code> or
          <code class="literal">C:\OpenSSL-Win64</code>, depending on which
          package you downloaded. The following instructions assume a
          default location of <code class="literal">C:\OpenSSL-Win32</code>.
          Modify this as necessary if you are using the 64-bit package.
        </p><p>
          If a message occurs during setup indicating
          <code class="literal">'...critical component is missing: Microsoft Visual
          C++ 2008 Redistributables'</code>, cancel the setup and
          download one of the following packages as well, again
          depending on your architecture (32-bit or 64-bit):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Visual C++ 2008 Redistributables (x86), available at:
            </p><pre data-lang="ini" class="programlisting">
<a class="ulink" href="http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF" target="_top">http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF</a>
</pre></li><li class="listitem"><p>
              Visual C++ 2008 Redistributables (x64), available at:
            </p><pre data-lang="ini" class="programlisting">
<a class="ulink" href="http://www.microsoft.com/downloads/details.aspx?familyid=bd2a6171-e2d6-4230-b809-9a8d7548c1b6" target="_top">http://www.microsoft.com/downloads/details.aspx?familyid=bd2a6171-e2d6-4230-b809-9a8d7548c1b6</a>
</pre></li></ul>
</div>
<p>
          After installing the additional package, restart the OpenSSL
          setup procedure.
        </p><p>
          During installation, leave the default
          <code class="filename">C:\OpenSSL-Win32</code> as the install path, and
          also leave the default option <code class="literal">'Copy OpenSSL DLL files
          to the Windows system directory'</code> selected.
        </p><p>
          When the installation has finished, add
          <code class="filename">C:\OpenSSL-Win32\bin</code> to the Windows
          System Path variable of your server (depending on your version
          of Windows, the following path-setting instructions might
          differ slightly):
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              On the Windows desktop, right-click the <span class="guiicon">My
              Computer</span> icon, and select
              <span class="guimenuitem">Properties</span>.
            </p></li><li class="listitem"><p>
              Select the <span class="guimenuitem">Advanced</span> tab from
              the <span class="guimenu">System Properties</span> menu that
              appears, and click the <span class="guibutton">Environment
              Variables</span> button.
            </p></li><li class="listitem"><p>
              Under <span class="guilabel">System Variables</span>, select
              <span class="guimenuitem">Path</span>, then click the
              <span class="guibutton">Edit</span> button. The <span class="guimenu">Edit
              System Variable</span> dialogue should appear.
            </p></li><li class="listitem"><p>
              Add <code class="literal">';C:\OpenSSL-Win32\bin'</code> to the end
              (notice the semicolon).
            </p></li><li class="listitem"><p>
              Press OK 3 times.
            </p></li><li class="listitem"><p>
              Check that OpenSSL was correctly integrated into the Path
              variable by opening a new command console
              (<span class="command"><strong>Start&gt;Run&gt;cmd.exe</strong></span>) and verifying
              that OpenSSL is available:
            </p><pre data-lang="terminal" class="programlisting">
Microsoft Windows [Version ...]
Copyright (c) 2006 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;<strong class="userinput"><code>cd \</code></strong>

C:\&gt;<strong class="userinput"><code>openssl</code></strong>
OpenSSL&gt; <strong class="userinput"><code>exit</code></strong> &lt;&lt;&lt; If you see the OpenSSL prompt, installation was successful.

C:\&gt;
</pre></li></ol>
</div>
<p>
          After OpenSSL has been installed, use instructions similar to
          those from Example 1 (shown earlier in this section), with the
          following changes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Change the following Unix commands:
            </p><pre data-lang="terminal" class="programlisting">
# Create clean environment
rm -rf newcerts
mkdir newcerts &amp;&amp; cd newcerts
</pre><p>
              On Windows, use these commands instead:
            </p><pre data-lang="terminal" class="programlisting">
# Create clean environment
md c:\newcerts
cd c:\newcerts
</pre></li><li class="listitem"><p>
              When a <code class="literal">'\'</code> character is shown at the
              end of a command line, this <code class="literal">'\'</code>
              character must be removed and the command lines entered
              all on a single line.
</p></li></ul>
</div>
<p>
          After generating the certificate and key files, to use them
          for SSL connections, see
          <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="creating-rsa-files-using-openssl"></a>6.3.3.3 Creating RSA Keys Using openssl</h4>

</div>

</div>

</div>
<p>
        This section describes how to use the <span class="command"><strong>openssl</strong></span>
        command to set up the RSA key files that enable MySQL to support
        secure password exchange over unencrypted connections for
        accounts authenticated by the <code class="literal">sha256_password</code>
        and <code class="literal">caching_sha2_password</code> plugins.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          There are easier alternatives to generating the files required
          for RSA than the procedure described here: Let the server
          autogenerate them or use the
          <a class="link" href="programs.html#mysql-ssl-rsa-setup" title="4.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files"><span class="command"><strong>mysql_ssl_rsa_setup</strong></span></a> program. See
          <a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql" title="6.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL">Section 6.3.3.1, “Creating SSL and RSA Certificates and Keys using MySQL”</a>.
</p>
</div>
<p>
        To create the RSA private and public key-pair files, run these
        commands while logged into the system account used to run the
        MySQL server so the files will be owned by that account:
      </p><pre data-lang="terminal" class="programlisting">
openssl genrsa -out private_key.pem 2048
openssl rsa -in private_key.pem -pubout -out public_key.pem
</pre><p>
        Those commands create 2,048-bit keys. To create stronger keys,
        use a larger value.
      </p><p>
        Then set the access modes for the key files. The private key
        should be readable only by the server, whereas the public key
        can be freely distributed to client users:
      </p><pre data-lang="terminal" class="programlisting">
chmod 400 private_key.pem
chmod 444 public_key.pem
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="ssl-libraries"></a>6.3.4 SSL Library-Dependent Capabilities</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091720571952"></a><a class="indexterm" name="idm140091720570512"></a><a class="indexterm" name="idm140091720569024"></a><p>
      MySQL can be compiled using OpenSSL or wolfSSL, both of which
      enable encrypted connections based on the OpenSSL API:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MySQL Enterprise Edition binary distributions are compiled using OpenSSL. It is
          not possible to use wolfSSL with MySQL Enterprise Edition.
        </p></li><li class="listitem"><p>
          MySQL Community Edition binary distributions are compiled
          using OpenSSL.
        </p></li><li class="listitem"><p>
          MySQL Community Edition source distributions can be compiled
          using either OpenSSL or wolfSSL (see
          <a class="xref" href="security.html#building-with-encrypted-connection-support" title="6.3.5 Building MySQL with Support for Encrypted Connections">Section 6.3.5, “Building MySQL with Support for Encrypted Connections”</a>).
</p></li></ul>
</div>
<p>
      OpenSSL and wolfSSL offer the same basic functionality, but MySQL
      distributions compiled using OpenSSL have additional features:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          OpenSSL supports a more flexible syntax for specifying ciphers
          for the <a class="link" href="security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher</code></a> option,
          and supports a wider range of encryption ciphers from which to
          choose. See <a class="xref" href="security.html#encrypted-connection-options" title="6.3.2 Command Options for Encrypted Connections">Section 6.3.2, “Command Options for Encrypted Connections”</a>,
          and <a class="xref" href="security.html#encrypted-connection-protocols-ciphers" title="6.3.6 Encrypted Connection Protocols and Ciphers">Section 6.3.6, “Encrypted Connection Protocols and Ciphers”</a>.
        </p></li><li class="listitem"><p>
          OpenSSL supports the
          <a class="link" href="security.html#option_general_ssl-capath"><code class="option">--ssl-capath</code></a>. MySQL
          distributions compiled using wolfSSL do not because wolfSSL
          does not look in any directory and do not follow a chained
          certificate tree. wolfSSL requires that all components of the
          CA certificate tree be contained within a single CA
          certificate tree and that each certificate in the file has a
          unique SubjectName value. To work around this limitation,
          concatenate the individual certificate files comprising the
          certificate tree into a new file and specify that file as the
          value of the <a class="link" href="security.html#option_general_ssl-ca"><code class="option">--ssl-ca</code></a> option.
        </p></li><li class="listitem"><p>
          OpenSSL supports the
          <a class="link" href="security.html#option_general_ssl-crl"><code class="option">--ssl-crl</code></a>, and
          <a class="link" href="security.html#option_general_ssl-crlpath"><code class="option">--ssl-crlpath</code></a> options.
          Distributions compiled using wolfSSL do not because revocation
          lists do not work with wolfSSL. (wolfSSL accepts these options
          but silently ignores them.)
        </p></li><li class="listitem"><p>
          OpenSSL 1.1.1 and higher supports the TLSv1.3 protocol.
        </p></li><li class="listitem"><p>
          Accounts that authenticate using the
          <code class="literal">sha256_password</code> plugin can use RSA key
          files for secure password exchange over unencrypted
          connections. See
          <a class="xref" href="security.html#sha256-pluggable-authentication" title="6.4.1.2 SHA-256 Pluggable Authentication">Section 6.4.1.2, “SHA-256 Pluggable Authentication”</a>. (Accounts
          that authenticate using the
          <code class="literal">caching_sha2_password</code> plugin can use RSA
          key pair-based password exchange regardless of whether MySQL
          was compiled using OpenSSL or wolfSSL. See
          <a class="xref" href="security.html#caching-sha2-pluggable-authentication" title="6.4.1.3 Caching SHA-2 Pluggable Authentication">Section 6.4.1.3, “Caching SHA-2 Pluggable Authentication”</a>.)
        </p></li><li class="listitem"><p>
          The server can automatically generate missing SSL and RSA
          certificate and key files at startup. See
          <a class="xref" href="security.html#creating-ssl-rsa-files-using-mysql" title="6.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL">Section 6.3.3.1, “Creating SSL and RSA Certificates and Keys using MySQL”</a>.
        </p></li><li class="listitem"><p>
          OpenSSL supports more encryption modes for the
          <a class="link" href="functions.html#function_aes-encrypt"><code class="literal">AES_ENCRYPT()</code></a> and
          <a class="link" href="functions.html#function_aes-decrypt"><code class="literal">AES_DECRYPT()</code></a> functions. See
          <a class="xref" href="functions.html#encryption-functions" title="12.13 Encryption and Compression Functions">Section 12.13, “Encryption and Compression Functions”</a>
</p></li></ul>
</div>
<a class="indexterm" name="idm140091720541840"></a><a class="indexterm" name="idm140091720540384"></a><p>
      Certain OpenSSL-related system and status variables are present
      only if MySQL was compiled using OpenSSL:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="server-administration.html#sysvar_auto_generate_certs"><code class="literal">auto_generate_certs</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="server-administration.html#sysvar_caching_sha2_password_auto_generate_rsa_keys"><code class="literal">caching_sha2_password_auto_generate_rsa_keys</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="server-administration.html#sysvar_sha256_password_auto_generate_rsa_keys"><code class="literal">sha256_password_auto_generate_rsa_keys</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="server-administration.html#sysvar_sha256_password_private_key_path"><code class="literal">sha256_password_private_key_path</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a>
        </p></li><li class="listitem"><p>
          <a class="link" href="server-administration.html#statvar_Rsa_public_key"><code class="literal">Rsa_public_key</code></a>
</p></li></ul>
</div>
<p>
      To determine whether a server was compiled using OpenSSL, test the
      existence of any of those variables. For example, this statement
      returns a row if OpenSSL was used and an empty result if wolfSSL
      was used:
    </p><pre data-lang="sql" class="programlisting">
SHOW STATUS LIKE 'Rsa_public_key';
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="building-with-encrypted-connection-support"></a>6.3.5 Building MySQL with Support for Encrypted Connections</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091720522960"></a><a class="indexterm" name="idm140091720521472"></a><a class="indexterm" name="idm140091720520016"></a><a class="indexterm" name="idm140091720518944"></a><p>
      To use encrypted connections between the MySQL server and client
      programs, your system must support either OpenSSL or wolfSSL:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MySQL Enterprise Edition binary distributions are compiled using OpenSSL. It is
          not possible to use wolfSSL with MySQL Enterprise Edition.
        </p></li><li class="listitem"><p>
          MySQL Community Edition binary distributions are compiled
          using OpenSSL.
        </p></li><li class="listitem"><p>
          MySQL Community Edition source distributions can be compiled
          using either OpenSSL or wolfSSL.
</p></li></ul>
</div>
<p>
      If you compile MySQL from a source distribution,
      <span class="command"><strong>CMake</strong></span> configures the distribution to use
      OpenSSL by default.
    </p><p>
      To compile using OpenSSL, use this procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Ensure that OpenSSL 1.0.1 or higher is installed on your
          system. If the installed OpenSSL version is lower than 1.0.1,
          <span class="command"><strong>CMake</strong></span> produces an error at MySQL
          configuration time. If it is necessary to obtain OpenSSL,
          visit <a class="ulink" href="http://www.openssl.org" target="_top">http://www.openssl.org</a>.
        </p></li><li class="listitem"><p>
          The <a class="link" href="installing.html#option_cmake_with_ssl"><code class="option">WITH_SSL</code></a>
          <span class="command"><strong>CMake</strong></span> option determines which SSL library
          to use for compiling MySQL (see
          <a class="xref" href="installing.html#source-configuration-options" title="2.9.4 MySQL Source-Configuration Options">Section 2.9.4, “MySQL Source-Configuration Options”</a>). The default
          is <a class="link" href="installing.html#option_cmake_with_ssl"><code class="option">-DWITH_SSL=system</code></a>, which uses
          OpenSSL. To make this explicit, specify that option on the
          <span class="command"><strong>CMake</strong></span> command line. For example:
        </p><pre data-lang="terminal" class="programlisting">
cmake . -DWITH_SSL=system
</pre><p>
          That command configures the distribution to use the installed
          OpenSSL library. Alternatively, to explicitly specify the path
          name to the OpenSSL installation, use the following syntax.
          This can be useful if you have multiple versions of OpenSSL
          installed, to prevent <span class="command"><strong>CMake</strong></span> from choosing
          the wrong one:
        </p><pre data-lang="terminal" class="programlisting">
cmake . -DWITH_SSL=<em class="replaceable"><code>path_name</code></em>
</pre></li><li class="listitem"><p>
          Compile and install the distribution.
</p></li></ol>
</div>
<p>
      To compile using wolfSSL, download the wolfSSL distribution and
      apply a small patch. For instructions, see the
      <code class="filename">extra/README-wolfssl.txt</code> file.
    </p><p>
      To check whether a <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server supports
      encrypted connections, examine the value of the
      <a class="link" href="server-administration.html#sysvar_have_ssl"><code class="literal">have_ssl</code></a> system variable:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'have_ssl';</code></strong>
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| have_ssl      | YES   |
+---------------+-------+
</pre><p>
      If the value is <code class="literal">YES</code>, the server supports
      encrypted connections. If the value is
      <code class="literal">DISABLED</code>, the server is capable of supporting
      encrypted connections but was not started with the appropriate
      <code class="option">--ssl-<em class="replaceable"><code>xxx</code></em></code> options to
      enable encrypted connections to be used; see
      <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>.
    </p><p>
      To determine whether a server was compiled using OpenSSL or
      wolfSSL, check the existence of any of the system or status
      variables that are present only for OpenSSL. See
      <a class="xref" href="security.html#ssl-libraries" title="6.3.4 SSL Library-Dependent Capabilities">Section 6.3.4, “SSL Library-Dependent Capabilities”</a>
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="encrypted-connection-protocols-ciphers"></a>6.3.6 Encrypted Connection Protocols and Ciphers</h3>

</div>

</div>

</div>
<p>
      To determine which encryption protocol and cipher are in use for
      an encrypted connection, use the following statements to check the
      values of the <a class="link" href="server-administration.html#statvar_Ssl_version"><code class="literal">Ssl_version</code></a> and
      <a class="link" href="server-administration.html#statvar_Ssl_cipher"><code class="literal">Ssl_cipher</code></a> status variables:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW SESSION STATUS LIKE 'Ssl_version';</code></strong>
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| Ssl_version   | TLSv1 |
+---------------+-------+
mysql&gt; <strong class="userinput"><code>SHOW SESSION STATUS LIKE 'Ssl_cipher';</code></strong>
+---------------+---------------------------+
| Variable_name | Value                     |
+---------------+---------------------------+
| Ssl_cipher    | DHE-RSA-AES128-GCM-SHA256 |
+---------------+---------------------------+
</pre><p>
      If the connection is not encrypted, both variables have an empty
      value.
    </p><p>
      MySQL supports encrypted connections using the TLSv1, TLSv1.1,
      TLSv1.2, and TLSv1.3 protocols.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        Support for the TLSv1.3 protocol is available as of MySQL
        8.0.16, but requires compiling MySQL using OpenSSL 1.1.1 or
        higher. If the SSL library does not support TLSv1.3, neither
        does MySQL and the TLSv1.3-related parts of the following
        discussion do not apply.
      </p><p>
        Currently, Group Replication does not support TLSv1.3.
</p>
</div>
<p>
      The value of the <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a>
      system variable determines which protocols a server permits for
      encrypted connections. The
      <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a> value applies to
      connections from clients and from slave servers using regular
      master/slave replication. The variable value is a list of one or
      more comma-separated protocol names from this list (not
      case-sensitive): TLSv1, TLSv1.1, TLSv1.2, and (if available)
      TLSV1.3. By default, this variable lists all protocols supported
      by the SSL library used to compile MySQL. To determine the value
      of <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a> at runtime, use
      this statement:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GLOBAL VARIABLES LIKE 'tls_version';</code></strong>
+---------------+-----------------------+
| Variable_name | Value                 |
+---------------+-----------------------+
| tls_version   | TLSv1,TLSv1.1,TLSv1.2 |
+---------------+-----------------------+
</pre><p>
      To change the value of
      <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a>, set it at server
      startup. For example, to permit connections that use the TLSv1.1
      or TLSv1.2 protocol, but prohibit connections that use the
      less-secure TLSv1 protocol, use these lines in the server
      <code class="filename">my.cnf</code> file:
    </p><pre data-lang="ini" class="programlisting">
[mysqld]
tls_version=TLSv1.1,TLSv1.2
</pre><p>
      To be even more restrictive and permit only TLSv1.2 connections,
      set <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a> like this:
    </p><pre data-lang="ini" class="programlisting">
[mysqld]
tls_version=TLSv1.2
</pre><p>
      As of MySQL 8.0.16, <code class="literal">tls_version</code> can also be
      changed at runtime. See
      <a class="xref" href="security.html#using-encrypted-connections-server-side-runtime-configuration" title="Server-Side Runtime Configuration for Encrypted Connections">Server-Side Runtime Configuration for Encrypted Connections</a>.
    </p><p>
      For client programs, the
      <a class="link" href="security.html#option_general_tls-version"><code class="option">--tls-version</code></a> option specifies
      which TLS protocols a client permits for connections to the
      server. The format of the option value is the same as for the
      <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a> system variable.
    </p><p>
      For regular replication, the <code class="literal">MASTER_TLS_VERSION</code>
      option for the <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1 CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER TO</code></a>
      statement specifies which TLS protocols a slave server permits for
      connections to the master. The format of the option value is the
      same as for the <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a>
      system variable. See
      <a class="xref" href="replication.html#replication-solutions-encrypted-connections" title="17.3.9 Setting Up Replication to Use Encrypted Connections">Section 17.3.9, “Setting Up Replication to Use Encrypted Connections”</a>.
    </p><p>
      The protocols that can be specified for
      <code class="literal">MASTER_TLS_VERSION</code> depend only on the SSL
      library. This option is independent of and not affected by the
      <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a> value configured on
      the slave server. For example, a server that acts as a replication
      slave can be configured with
      <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a> set to TLSv1.3 to
      permit only incoming connections that use TLSv1.3, but also
      configured with <code class="literal">MASTER_TLS_VERSION</code> set to
      TLSv1.2 to connect as a slave only to masters that permit TLSv1.2.
    </p><p>
      By default, MySQL attempts to use the highest TLS protocol version
      available, depending on the SSL library used to compile the server
      and client, which key size is used, and whether the server or
      client are restricted from using some protocols (for example, by
      means of
      <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version</code></a>/<a class="link" href="security.html#option_general_tls-version"><code class="option">--tls-version</code></a>):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If TLSv1.3 is available, it is used if possible. If not, MySQL
          continues through the list of available protocols, using
          TLSv1.2 if possible, and so forth.
        </p></li><li class="listitem"><p>
          TLSv1.2 does not work with all ciphers that have a key size of
          512 bits or less. To use this protocol with such a key, use
          <a class="link" href="security.html#option_general_ssl-cipher"><code class="option">--ssl-cipher</code></a> to specify the
          cipher name explicitly:
        </p><pre data-lang="none" class="programlisting">
AES128-SHA
AES128-SHA256
AES256-SHA
AES256-SHA256
CAMELLIA128-SHA
CAMELLIA256-SHA
DES-CBC3-SHA
DHE-RSA-AES256-SHA
RC4-MD5
RC4-SHA
SEED-SHA
</pre></li><li class="listitem"><p>
          For better security, use a certificate with an RSA key size of
          at least 2048 bits.
</p></li></ul>
</div>
<p>
      If the server and client protocol capabilities have no protocol in
      common, the server terminates the connection request. Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          if the server is configured with
          <a class="link" href="server-administration.html#sysvar_tls_version"><code class="literal">tls_version=TLSv1.1,TLSv1.2</code></a>,
          connection attempts fail for clients invoked with
          <a class="link" href="security.html#option_general_tls-version"><code class="option">--tls-version=TLSv1</code></a>, and for
          older clients that do not support the
          <a class="link" href="security.html#option_general_tls-version"><code class="option">--tls-version</code></a> option and
          implicitly support only TLSv1.
        </p></li><li class="listitem"><p>
          Similarly, connection attempts fail for replication slaves
          configured with <code class="literal">MASTER_TLS_VERSION =
          'TLSv1'</code>, and for older slaves that do not support
          the <code class="literal">MASTER_TLS_VERSION</code> option and
          implicitly support only TLSv1.
</p></li></ul>
</div>
<p>
      OpenSSL 1.1.1 and higher supports the following ciphersuites, the
      first three of which are enabled by default:
    </p><pre data-lang="none" class="programlisting">
TLS_AES_128_GCM_SHA256
TLS_AES_256_GCM_SHA384
TLS_CHACHA20_POLY1305_SHA256
TLS_AES_128_CCM_SHA256
TLS_AES_128_CCM_8_SHA256 
</pre><p>
      To configure the permitted TLSv1.3 ciphersuites explicitly:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          On the server side, use the
          <a class="link" href="server-administration.html#sysvar_tls_ciphersuites"><code class="literal">tls_ciphersuites</code></a> system
          variable.
        </p></li><li class="listitem"><p>
          On the client side, use the
          <a class="link" href="security.html#option_general_tls-ciphersuites"><code class="option">--tls-ciphersuites</code></a> option.
</p></li></ul>
</div>
<p>
      In each case, the configuration value is a list of one or more
      colon-separated ciphersuite names.
    </p><p>
      MySQL permits specifying a list of protocols to support. This list
      is passed directly down to the underlying SSL library and is
      ultimately up to that library what protocols it actually enables
      from the supplied list. Please refer to the MySQL source code and
      the OpenSSL
      <a class="ulink" href="https://www.openssl.org/docs/man1.1.0/ssl/SSL_CTX_new.html" target="_top"><code class="literal">SSL_CTX_new()</code></a>
      documentation for information about how the SSL library handles
      this.
    </p><p>
      To determine which ciphers a given server supports, use the
      following statement to check the value of the
      <a class="link" href="server-administration.html#statvar_Ssl_cipher_list"><code class="literal">Ssl_cipher_list</code></a> status variable:
    </p><pre data-lang="sql" class="programlisting">
SHOW SESSION STATUS LIKE 'Ssl_cipher_list';
</pre><p>
      The <a class="link" href="server-administration.html#statvar_Ssl_cipher_list"><code class="literal">Ssl_cipher_list</code></a> status
      variable lists the possible SSL ciphers (empty for non-SSL
      connections). If MySQL supports TLSv1.3, the value includes the
      possible TLSv1.3 ciphersuites.
    </p><p>
      Order of ciphers passed by MySQL to the SSL library is
      significant. More secure ciphers are mentioned first in the list,
      and the first cipher supported by the provided certificate is
      selected.
    </p><p>
      MySQL passes this cipher list to the SSL library:
    </p><pre data-lang="none" class="programlisting">
ECDHE-ECDSA-AES128-GCM-SHA256
ECDHE-ECDSA-AES256-GCM-SHA384
ECDHE-RSA-AES128-GCM-SHA256
ECDHE-RSA-AES256-GCM-SHA384
ECDHE-ECDSA-AES128-SHA256
ECDHE-RSA-AES128-SHA256
ECDHE-ECDSA-AES256-SHA384
ECDHE-RSA-AES256-SHA384
DHE-RSA-AES128-GCM-SHA256
DHE-DSS-AES128-GCM-SHA256
DHE-RSA-AES128-SHA256
DHE-DSS-AES128-SHA256
DHE-DSS-AES256-GCM-SHA384
DHE-RSA-AES256-SHA256
DHE-DSS-AES256-SHA256
ECDHE-RSA-AES128-SHA
ECDHE-ECDSA-AES128-SHA
ECDHE-RSA-AES256-SHA
ECDHE-ECDSA-AES256-SHA
DHE-DSS-AES128-SHA
DHE-RSA-AES128-SHA
TLS_DHE_DSS_WITH_AES_256_CBC_SHA
DHE-RSA-AES256-SHA
AES128-GCM-SHA256
DH-DSS-AES128-GCM-SHA256
ECDH-ECDSA-AES128-GCM-SHA256
AES256-GCM-SHA384
DH-DSS-AES256-GCM-SHA384
ECDH-ECDSA-AES256-GCM-SHA384
AES128-SHA256
DH-DSS-AES128-SHA256
ECDH-ECDSA-AES128-SHA256
AES256-SHA256
DH-DSS-AES256-SHA256
ECDH-ECDSA-AES256-SHA384
AES128-SHA
DH-DSS-AES128-SHA
ECDH-ECDSA-AES128-SHA
AES256-SHA
DH-DSS-AES256-SHA
ECDH-ECDSA-AES256-SHA
DHE-RSA-AES256-GCM-SHA384
DH-RSA-AES128-GCM-SHA256
ECDH-RSA-AES128-GCM-SHA256
DH-RSA-AES256-GCM-SHA384
ECDH-RSA-AES256-GCM-SHA384
DH-RSA-AES128-SHA256
ECDH-RSA-AES128-SHA256
DH-RSA-AES256-SHA256
ECDH-RSA-AES256-SHA384
ECDHE-RSA-AES128-SHA
ECDHE-ECDSA-AES128-SHA
ECDHE-RSA-AES256-SHA
ECDHE-ECDSA-AES256-SHA
DHE-DSS-AES128-SHA
DHE-RSA-AES128-SHA
TLS_DHE_DSS_WITH_AES_256_CBC_SHA
DHE-RSA-AES256-SHA
AES128-SHA
DH-DSS-AES128-SHA
ECDH-ECDSA-AES128-SHA
AES256-SHA
DH-DSS-AES256-SHA
ECDH-ECDSA-AES256-SHA
DH-RSA-AES128-SHA
ECDH-RSA-AES128-SHA
DH-RSA-AES256-SHA
ECDH-RSA-AES256-SHA
DES-CBC3-SHA
</pre><p>
      These cipher restrictions are in place:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The following ciphers are permanently restricted:
        </p><pre data-lang="none" class="programlisting">
!DHE-DSS-DES-CBC3-SHA
!DHE-RSA-DES-CBC3-SHA
!ECDH-RSA-DES-CBC3-SHA
!ECDH-ECDSA-DES-CBC3-SHA
!ECDHE-RSA-DES-CBC3-SHA
!ECDHE-ECDSA-DES-CBC3-SHA
</pre></li><li class="listitem"><p>
          The following categories of ciphers are permanently
          restricted:
        </p><pre data-lang="none" class="programlisting">
!aNULL
!eNULL
!EXPORT
!LOW
!MD5
!DES
!RC2
!RC4
!PSK
!SSLv3
</pre></li></ul>
</div>
<p>
      If the server is started using a compatible certificate that uses
      any of the preceding restricted ciphers or cipher categories, the
      server starts with support for encrypted connections disabled.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="windows-and-ssh"></a>6.3.7 Connecting to MySQL Remotely from Windows with SSH</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140091720413232"></a><a class="indexterm" name="idm140091720412224"></a><a class="indexterm" name="idm140091720410736"></a><p>
      This section describes how to get an encrypted connection to a
      remote MySQL server with SSH. The information was provided by
      David Carlson <code class="email">&lt;<a class="email" href="mailto:dcarlson@mplcomm.com">dcarlson@mplcomm.com</a>&gt;</code>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Install an SSH client on your Windows machine. For a
          comparison of SSH clients, see
          <a class="ulink" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients" target="_top">http://en.wikipedia.org/wiki/Comparison_of_SSH_clients</a>.
        </p></li><li class="listitem"><p>
          Start your Windows SSH client. Set <code class="literal">Host_Name =
          <em class="replaceable"><code>yourmysqlserver_URL_or_IP</code></em></code>.
          Set
          <code class="literal">userid=<em class="replaceable"><code>your_userid</code></em></code>
          to log in to your server. This <code class="literal">userid</code> value
          might not be the same as the user name of your MySQL account.
        </p></li><li class="listitem"><p>
          Set up port forwarding. Either do a remote forward (Set
          <code class="literal">local_port: 3306</code>, <code class="literal">remote_host:
          <em class="replaceable"><code>yourmysqlservername_or_ip</code></em></code>,
          <code class="literal">remote_port: 3306</code> ) or a local forward (Set
          <code class="literal">port: 3306</code>, <code class="literal">host:
          localhost</code>, <code class="literal">remote port: 3306</code>).
        </p></li><li class="listitem"><p>
          Save everything, otherwise you will have to redo it the next
          time.
        </p></li><li class="listitem"><p>
          Log in to your server with the SSH session you just created.
        </p></li><li class="listitem"><p>
          On your Windows machine, start some ODBC application (such as
          Access).
        </p></li><li class="listitem"><p>
          Create a new file in Windows and link to MySQL using the ODBC
          driver the same way you normally do, except type in
          <code class="literal">localhost</code> for the MySQL host server, not
          <em class="replaceable"><code>yourmysqlservername</code></em>.
</p></li></ol>
</div>
<p>
      At this point, you should have an ODBC connection to MySQL,
      encrypted using SSH.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="security-plugins"></a>6.4 Security Components and Plugins</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#authentication-plugins">6.4.1 Authentication Plugins</a></span></dt><dt><span class="section"><a href="security.html#connection-control">6.4.2 The Connection-Control Plugins</a></span></dt><dt><span class="section"><a href="security.html#validate-password">6.4.3 The Password Validation Component</a></span></dt><dt><span class="section"><a href="security.html#keyring">6.4.4 The MySQL Keyring</a></span></dt><dt><span class="section"><a href="security.html#audit-log">6.4.5 MySQL Enterprise Audit</a></span></dt><dt><span class="section"><a href="security.html#audit-api-message-emit">6.4.6 The Audit Message Component</a></span></dt><dt><span class="section"><a href="security.html#firewall">6.4.7 MySQL Enterprise Firewall</a></span></dt><dt><span class="section"><a href="security.html#data-masking">6.4.8 MySQL Enterprise Data Masking and De-Identification</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091720390464"></a><a class="indexterm" name="idm140091720389008"></a><a class="indexterm" name="idm140091720387520"></a><a class="indexterm" name="idm140091720386032"></a><p>
    MySQL includes several components and plugins that implement
    security features:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Plugins for authenticating attempts by clients to connect to
        MySQL Server. Plugins are available for several authentication
        protocols. For general discussion of the authentication process,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>. For
        characteristics of specific authentication plugins, see
        <a class="xref" href="security.html#authentication-plugins" title="6.4.1 Authentication Plugins">Section 6.4.1, “Authentication Plugins”</a>.
      </p></li><li class="listitem"><p>
        A password-validation component for implementing password
        strength policies and assessing the strength of potential
        passwords. See <a class="xref" href="security.html#validate-password" title="6.4.3 The Password Validation Component">Section 6.4.3, “The Password Validation Component”</a>.
      </p></li><li class="listitem"><p>
        Keyring plugins that provide secure storage for sensitive
        information. See <a class="xref" href="security.html#keyring" title="6.4.4 The MySQL Keyring">Section 6.4.4, “The MySQL Keyring”</a>.
      </p></li><li class="listitem"><p>
        (MySQL Enterprise Edition only) MySQL Enterprise Audit, implemented using a server plugin, uses
        the open MySQL Audit API to enable standard, policy-based
        monitoring and logging of connection and query activity executed
        on specific MySQL servers. Designed to meet the Oracle audit
        specification, MySQL Enterprise Audit provides an out of box, easy to use
        auditing and compliance solution for applications that are
        governed by both internal and external regulatory guidelines.
        See <a class="xref" href="security.html#audit-log" title="6.4.5 MySQL Enterprise Audit">Section 6.4.5, “MySQL Enterprise Audit”</a>.
      </p></li><li class="listitem"><p>
        A user-defined function enables applications to add their own
        message events to the audit log. See
        <a class="xref" href="security.html#audit-api-message-emit" title="6.4.6 The Audit Message Component">Section 6.4.6, “The Audit Message Component”</a>.
      </p></li><li class="listitem"><p>
        (MySQL Enterprise Edition only) MySQL Enterprise Firewall, an application-level firewall that enables
        database administrators to permit or deny SQL statement
        execution based on matching against whitelists of accepted
        statement patterns. This helps harden MySQL Server against
        attacks such as SQL injection or attempts to exploit
        applications by using them outside of their legitimate query
        workload characteristics. See <a class="xref" href="security.html#firewall" title="6.4.7 MySQL Enterprise Firewall">Section 6.4.7, “MySQL Enterprise Firewall”</a>.
      </p></li><li class="listitem"><p>
        (MySQL Enterprise Edition only) MySQL Enterprise Data Masking and De-Identification, implemented as a plugin library
        containing a plugin and a set of user-defined functions. Data
        masking hides sensitive information by replacing real values
        with substitutes. MySQL Enterprise Data Masking and De-Identification functions enable masking existing
        data using several methods such as obfuscation (removing
        identifying characteristics), generation of formatted random
        data, and data replacement or substitution. See
        <a class="xref" href="security.html#data-masking" title="6.4.8 MySQL Enterprise Data Masking and De-Identification">Section 6.4.8, “MySQL Enterprise Data Masking and De-Identification”</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="authentication-plugins"></a>6.4.1 Authentication Plugins</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#native-pluggable-authentication">6.4.1.1 Native Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#sha256-pluggable-authentication">6.4.1.2 SHA-256 Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#caching-sha2-pluggable-authentication">6.4.1.3 Caching SHA-2 Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#cleartext-pluggable-authentication">6.4.1.4 Client-Side Cleartext Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#pam-pluggable-authentication">6.4.1.5 PAM Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#windows-pluggable-authentication">6.4.1.6 Windows Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#ldap-pluggable-authentication">6.4.1.7 LDAP Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#no-login-pluggable-authentication">6.4.1.8 No-Login Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#socket-pluggable-authentication">6.4.1.9 Socket Peer-Credential Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#test-pluggable-authentication">6.4.1.10 Test Pluggable Authentication</a></span></dt><dt><span class="section"><a href="security.html#pluggable-authentication-system-variables">6.4.1.11 Pluggable Authentication System Variables</a></span></dt></dl>
</div>
<p>
      The following sections describe pluggable authentication methods
      available in MySQL and the plugins that implement these methods.
      For general discussion of the authentication process, see
      <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>.
    </p><p>
      The default plugin is indicated by the value of the
      <a class="link" href="server-administration.html#sysvar_default_authentication_plugin"><code class="literal">default_authentication_plugin</code></a>
      system variable.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="native-pluggable-authentication"></a>6.4.1.1 Native Pluggable Authentication</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091720365056"></a><a class="indexterm" name="idm140091720363952"></a><p>
        MySQL includes a <code class="literal">mysql_native_password</code> plugin
        that implements native authentication; that is, authentication
        based on the password hashing method in use from before the
        introduction of pluggable authentication.
      </p><p>
        The following table shows the plugin names on the server and
        client sides.
</p>
<div class="table">
<a name="idm140091720360624"></a><p class="title"><b>Table 6.13 Plugin and Library Names for Native Password Authentication</b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for native password authentication."><col width="30%"><col width="70%"><thead><tr>
            <th scope="col">Plugin or File</th>
            <th scope="col">Plugin or File Name</th>
          </tr></thead><tbody><tr>
            <td scope="row">Server-side plugin</td>
            <td><code class="literal">mysql_native_password</code></td>
          </tr><tr>
            <td scope="row">Client-side plugin</td>
            <td><code class="literal">mysql_native_password</code></td>
          </tr><tr>
            <td scope="row">Library file</td>
            <td>None (plugins are built in)</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The following sections provide installation and usage
        information specific to native pluggable authentication:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#native-pluggable-authentication-installation" title="Installing Native Pluggable Authentication">Installing Native Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#native-pluggable-authentication-usage" title="Using Native Pluggable Authentication">Using Native Pluggable Authentication</a></p></li></ul>
</div>
<p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="native-pluggable-authentication-installation"></a>Installing Native Pluggable Authentication</h5>
</div>
</div>
</div>
<p>
          The <code class="literal">mysql_native_password</code> plugin exists in
          server and client forms:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The server-side plugin is built into the server, need not
              be loaded explicitly, and cannot be disabled by unloading
              it.
            </p></li><li class="listitem"><p>
              The client-side plugin is built into the
              <code class="literal">libmysqlclient</code> client library and is
              available to any program linked against
              <code class="literal">libmysqlclient</code>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="native-pluggable-authentication-usage"></a>Using Native Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          MySQL client programs use
          <code class="literal">mysql_native_password</code> by default. The
          <a class="link" href="programs.html#option_mysql_default-auth"><code class="option">--default-auth</code></a> option can be
          used as a hint about which client-side plugin the program can
          expect to use:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --default-auth=mysql_native_password ...</code></strong>
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="sha256-pluggable-authentication"></a>6.4.1.2 SHA-256 Pluggable Authentication</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091720329520"></a><a class="indexterm" name="idm140091720328432"></a><p>
        MySQL provides two authentication plugins that implement SHA-256
        hashing for user account passwords:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">sha256_password</code>: Implements basic SHA-256
            authentication.
          </p></li><li class="listitem"><p>
            <code class="literal">caching_sha2_password</code>: Implements SHA-256
            authentication (like <code class="literal">sha256_password</code>),
            but uses caching on the server side for better performance
            and has additional features for wider applicability.
</p></li></ul>
</div>
<p>
        This section describes the original noncaching SHA-2
        authentication plugin. For information about the caching plugin,
        see <a class="xref" href="security.html#caching-sha2-pluggable-authentication" title="6.4.1.3 Caching SHA-2 Pluggable Authentication">Section 6.4.1.3, “Caching SHA-2 Pluggable Authentication”</a>.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
          In MySQL 8.0, <code class="literal">caching_sha2_password</code> is the
          default authentication plugin rather than
          <code class="literal">mysql_native_password</code>. For information
          about the implications of this change for server operation and
          compatibility of the server with clients and connectors, see
          <a class="xref" href="installing.html#upgrade-caching-sha2-password" title="caching_sha2_password as the Preferred Authentication Plugin">caching_sha2_password as the Preferred Authentication Plugin</a>.
        </p><p>
          Because <code class="literal">caching_sha2_password</code> is the
          default authentication plugin in MySQL 8.0 and provides a
          superset of the capabilities of the
          <code class="literal">sha256_password</code> authentication plugin,
          <code class="literal">sha256_password</code> is deprecated and will be
          removed in a future MySQL version. MySQL accounts that
          authenticate using <code class="literal">sha256_password</code> should
          be migrated to use <code class="literal">caching_sha2_password</code>
          instead.
</p>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Important
</div>
<p>
          To connect to the server using an account that authenticates
          with the <code class="literal">sha256_password</code> plugin, you must
          use either a TLS connection or an unencrypted connection that
          supports password exchange using an RSA key pair, as described
          later in this section. Either way, the
          <code class="literal">sha256_password</code> plugin uses MySQL's
          encryption capabilities. See
          <a class="xref" href="security.html#encrypted-connections" title="6.3 Using Encrypted Connections">Section 6.3, “Using Encrypted Connections”</a>.
</p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          In the name <code class="literal">sha256_password</code>,
          <span class="quote">“<span class="quote">sha256</span>”</span> refers to the 256-bit digest length the
          plugin uses for encryption. In the name
          <code class="literal">caching_sha2_password</code>, <span class="quote">“<span class="quote">sha2</span>”</span>
          refers more generally to the SHA-2 class of encryption
          algorithms, of which 256-bit encryption is one instance. The
          latter name choice leaves room for future expansion of
          possible digest lengths without changing the plugin name.
</p>
</div>
<p>
        The following table shows the plugin names on the server and
        client sides.
</p>
<div class="table">
<a name="idm140091720306240"></a><p class="title"><b>Table 6.14 Plugin and Library Names for SHA-256 Authentication</b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for SHA-256 password authentication."><col width="30%"><col width="70%"><thead><tr>
            <th scope="col">Plugin or File</th>
            <th scope="col">Plugin or File Name</th>
          </tr></thead><tbody><tr>
            <td scope="row">Server-side plugin</td>
            <td><code class="literal">sha256_password</code></td>
          </tr><tr>
            <td scope="row">Client-side plugin</td>
            <td><code class="literal">sha256_password</code></td>
          </tr><tr>
            <td scope="row">Library file</td>
            <td>None (plugins are built in)</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The following sections provide installation and usage
        information specific to SHA-256 pluggable authentication:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#sha256-pluggable-authentication-installation" title="Installing SHA-256 Pluggable Authentication">Installing SHA-256 Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#sha256-pluggable-authentication-usage" title="Using SHA-256 Pluggable Authentication">Using SHA-256 Pluggable Authentication</a></p></li></ul>
</div>
<p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="sha256-pluggable-authentication-installation"></a>Installing SHA-256 Pluggable Authentication</h5>
</div>
</div>
</div>
<p>
          The <code class="literal">sha256_password</code> plugin exists in server
          and client forms:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The server-side plugin is built into the server, need not
              be loaded explicitly, and cannot be disabled by unloading
              it.
            </p></li><li class="listitem"><p>
              The client-side plugin is built into the
              <code class="literal">libmysqlclient</code> client library and is
              available to any program linked against
              <code class="literal">libmysqlclient</code>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="sha256-pluggable-authentication-usage"></a>Using SHA-256 Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          To set up an account that uses the
          <code class="literal">sha256_password</code> plugin for SHA-256 password
          hashing, use the following statement, where
          <em class="replaceable"><code>password</code></em> is the desired account
          password:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'sha256user'@'localhost'
IDENTIFIED WITH sha256_password BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          The server assigns the <code class="literal">sha256_password</code>
          plugin to the account and uses it to encrypt the password
          using SHA-256, storing those values in the
          <code class="literal">plugin</code> and
          <code class="literal">authentication_string</code> columns of the
          <code class="literal">mysql.user</code> system table.
        </p><p>
          The preceding instructions do not assume that
          <code class="literal">sha256_password</code> is the default
          authentication plugin. If <code class="literal">sha256_password</code>
          is the default authentication plugin, a simpler
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> syntax can be used.
        </p><p>
          To start the server with the default authentication plugin set
          to <code class="literal">sha256_password</code>, put these lines in the
          server option file:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
default_authentication_plugin=sha256_password
</pre><p>
          That causes the <code class="literal">sha256_password</code> plugin to
          be used by default for new accounts. As a result, it is
          possible to create the account and set its password without
          naming the plugin explicitly:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'sha256user'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          Another consequence of setting
          <a class="link" href="server-administration.html#sysvar_default_authentication_plugin"><code class="literal">default_authentication_plugin</code></a>
          to <code class="literal">sha256_password</code> is that, to use some
          other plugin for account creation, you must specify that
          plugin explicitly. For example, to use the
          <code class="literal">mysql_native_password</code> plugin, use this
          statement:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'nativeuser'@'localhost'
IDENTIFIED WITH mysql_native_password BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          <code class="literal">sha256_password</code> supports connections over
          secure transport. <code class="literal">sha256_password</code> also
          supports encrypted password exchange using RSA over
          unencrypted connections if these conditions are satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              MySQL is compiled using OpenSSL. MySQL can be compiled
              using either OpenSSL or yaSSL (see
              <a class="xref" href="security.html#ssl-libraries" title="6.3.4 SSL Library-Dependent Capabilities">Section 6.3.4, “SSL Library-Dependent Capabilities”</a>), and
              <code class="literal">sha256_password</code> works with
              distributions compiled using either package, but RSA
              support requires OpenSSL.
            </p></li><li class="listitem"><p>
              The MySQL server to which you wish to connect is
              configured to support RSA (using the RSA configuration
              procedure given later in this section).
</p></li></ul>
</div>
<p>
          RSA support has these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              On the server side, two system variables name the RSA
              private and public key-pair files:
              <a class="link" href="server-administration.html#sysvar_sha256_password_private_key_path"><code class="literal">sha256_password_private_key_path</code></a>
              and
              <a class="link" href="server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a>.
              The database administrator must set these variables at
              server startup if the key files to use have names that
              differ from the system variable default values.
            </p></li><li class="listitem"><p>
              The server uses the
              <a class="link" href="server-administration.html#sysvar_sha256_password_auto_generate_rsa_keys"><code class="literal">sha256_password_auto_generate_rsa_keys</code></a>
              system variable to determine whether to automatically
              generate the RSA key-pair files. See
              <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 Creating SSL and RSA Certificates and Keys">Section 6.3.3, “Creating SSL and RSA Certificates and Keys”</a>.
            </p></li><li class="listitem"><p>
              The <a class="link" href="server-administration.html#statvar_Rsa_public_key"><code class="literal">Rsa_public_key</code></a>
              status variable displays the RSA public key value used by
              the <code class="literal">sha256_password</code> authentication
              plugin.
            </p></li><li class="listitem"><p>
              Clients that are in possession of the RSA public key can
              perform RSA key pair-based password exchange with the
              server during the connection process, as described later.
            </p></li><li class="listitem"><p>
              For connections by accounts that authenticate with
              <code class="literal">sha256_password</code> and RSA public key
              pair-based password exchange, the server sends the RSA
              public key to the client as needed. However, if a copy of
              the public key is available on the client host, the client
              can use it to save a round trip in the client/server
              protocol:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  For these command-line clients, use the
                  <a class="link" href="programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a>
                  option to specify the RSA public key file:
                  <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a>,
                  <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a>,
                  <a class="link" href="programs.html#mysqlbinlog" title="4.6.8 mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a>,
                  <a class="link" href="programs.html#mysqlcheck" title="4.5.3 mysqlcheck — A Table Maintenance Program"><span class="command"><strong>mysqlcheck</strong></span></a>,
                  <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>,
                  <a class="link" href="programs.html#mysqlimport" title="4.5.5 mysqlimport — A Data Import Program"><span class="command"><strong>mysqlimport</strong></span></a>,
                  <a class="link" href="programs.html#mysqlpump" title="4.5.6 mysqlpump — A Database Backup Program"><span class="command"><strong>mysqlpump</strong></span></a>,
                  <a class="link" href="programs.html#mysqlshow" title="4.5.7 mysqlshow — Display Database, Table, and Column Information"><span class="command"><strong>mysqlshow</strong></span></a>,
                  <a class="link" href="programs.html#mysqlslap" title="4.5.8 mysqlslap — Load Emulation Client"><span class="command"><strong>mysqlslap</strong></span></a>,
                  <span class="command"><strong>mysqltest</strong></span>,
                  <a class="link" href="programs.html#mysql-upgrade" title="4.4.5 mysql_upgrade — Check and Upgrade MySQL Tables"><span class="command"><strong>mysql_upgrade</strong></span></a>.
                </p></li><li class="listitem"><p>
                  For programs that use the C API, call
                  <a class="link" href="connectors-apis.html#mysql-options" title="28.7.7.50 mysql_options()"><code class="literal">mysql_options()</code></a> to
                  specify the RSA public key file by passing the
                  <code class="literal">MYSQL_SERVER_PUBLIC_KEY</code> option and
                  the name of the file.
                </p></li><li class="listitem"><p>
                  For replication slaves, use the
                  <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1 CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER TO</code></a>
                  statement with the
                  <code class="literal">MASTER_PUBLIC_KEY_PATH</code> option to
                  specify the RSA public key file. For Group
                  Replication, the
                  <a class="link" href="group-replication.html#sysvar_group_replication_recovery_get_public_key"><code class="literal">group_replication_recovery_get_public_key</code></a>
                  system variable serves the same purpose.
</p></li></ul>
</div>
</li></ul>
</div>
<p>
          For clients that use the <code class="literal">sha256_password</code>
          plugin, passwords are never exposed as cleartext when
          connecting to the server. How password transmission occurs
          depends on whether a secure connection or RSA encryption is
          used:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the connection is secure, an RSA key pair is
              unnecessary and is not used. This applies to encrypted
              connections that use TLS. The password is sent as
              cleartext but cannot be snooped because the connection is
              secure.
            </p></li><li class="listitem"><p>
              If the connection is not secure, and an RSA key pair is
              available, the connection remains unencrypted. This
              applies to unencrypted connections without TLS. RSA is
              used only for password exchange between client and server,
              to prevent password snooping. When the server receives the
              encrypted password, it decrypts it. A scramble is used in
              the encryption to prevent repeat attacks.
            </p></li><li class="listitem"><p>
              If a secure connection is not used and RSA encryption is
              not available, the connection attempt fails because the
              password cannot be sent without being exposed as
              cleartext.
</p></li></ul>
</div>
<p>
          As mentioned previously, RSA password encryption is available
          only if MySQL was compiled using OpenSSL. The implication for
          MySQL distributions compiled using wolfSSL is that, to use
          SHA-256 passwords, clients <span class="emphasis"><em>must</em></span> use an
          encrypted connection to access the server. See
          <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            To use RSA password encryption with
            <code class="literal">sha256_password</code>, the client and server
            both must be compiled using OpenSSL, not just one of them.
</p>
</div>
<p>
          Assuming that MySQL has been compiled using OpenSSL, use the
          following procedure to enable use of an RSA key pair for
          password exchange during the client connection process:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Create the RSA private and public key-pair files using the
              instructions in <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 Creating SSL and RSA Certificates and Keys">Section 6.3.3, “Creating SSL and RSA Certificates and Keys”</a>.
            </p></li><li class="listitem"><p>
              If the private and public key files are located in the
              data directory and are named
              <code class="filename">private_key.pem</code> and
              <code class="filename">public_key.pem</code> (the default values of
              the
              <a class="link" href="server-administration.html#sysvar_sha256_password_private_key_path"><code class="literal">sha256_password_private_key_path</code></a>
              and
              <a class="link" href="server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a>
              system variables), the server uses them automatically at
              startup.
            </p><p>
              Otherwise, to name the key files explicitly, set the
              system variables to the key file names in the server
              option file. If the files are located in the server data
              directory, you need not specify their full path names:
            </p><pre data-lang="ini" class="programlisting">
[mysqld]
sha256_password_private_key_path=myprivkey.pem
sha256_password_public_key_path=mypubkey.pem
</pre><p>
              If the key files are not located in the data directory, or
              to make their locations explicit in the system variable
              values, use full path names:
            </p><pre data-lang="ini" class="programlisting">
[mysqld]
sha256_password_private_key_path=/usr/local/mysql/myprivkey.pem
sha256_password_public_key_path=/usr/local/mysql/mypubkey.pem
</pre></li><li class="listitem"><p>
              Restart the server, then connect to it and check the
              <a class="link" href="server-administration.html#statvar_Rsa_public_key"><code class="literal">Rsa_public_key</code></a> status
              variable value. The value will differ from that shown
              here, but should be nonempty:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Rsa_public_key'\G</code></strong>
*************************** 1. row ***************************
Variable_name: Rsa_public_key
        Value: -----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDO9nRUDd+KvSZgY7cNBZMNpwX6
MvE1PbJFXO7u18nJ9lwc99Du/E7lw6CVXw7VKrXPeHbVQUzGyUNkf45Nz/ckaaJa
aLgJOBCIDmNVnyU54OT/1lcs2xiyfaDMe8fCJ64ZwTnKbY2gkt1IMjUAB5Ogd5kJ
g8aV7EtKwyhHb0c30QIDAQAB
-----END PUBLIC KEY-----
</pre><p>
              If the value is empty, the server found some problem with
              the key files. Check the error log for diagnostic
              information.
</p></li></ol>
</div>
<p>
          After the server has been configured with the RSA key files,
          accounts that authenticate with the
          <code class="literal">sha256_password</code> plugin have the option of
          using those key files to connect to the server. As mentioned
          previously, such accounts can use either a secure connection
          (in which case RSA is not used) or an unencrypted connection
          that performs password exchange using RSA. Suppose that an
          unencrypted connection is used. For example:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha256user -p</code></strong>
Enter password: <em class="replaceable"><code>password</code></em>
</pre><p>
          For this connection attempt by <code class="literal">sha256user</code>,
          the server determines that <code class="literal">sha256_password</code>
          is the appropriate authentication plugin and invokes it
          (because that was the plugin specified at
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> time). The plugin
          finds that the connection is not encrypted and thus requires
          the password to be transmitted using RSA encryption. In this
          case, the plugin sends the RSA public key to the client, which
          uses it to encrypt the password and returns the result to the
          server. The plugin uses the RSA private key on the server side
          to decrypt the password and accepts or rejects the connection
          based on whether the password is correct.
        </p><p>
          The server sends the RSA public key to the client as needed.
          However, if the client has a file containing a local copy of
          the RSA public key required by the server, it can specify the
          file using the
          <a class="link" href="programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a> option:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha256user -p --server-public-key-path=<em class="replaceable"><code>file_name</code></em></code></strong>
Enter password: <em class="replaceable"><code>password</code></em>
</pre><p>
          The public key value in the file named by the
          <a class="link" href="programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a> option
          should be the same as the key value in the server-side file
          named by the
          <a class="link" href="server-administration.html#sysvar_sha256_password_public_key_path"><code class="literal">sha256_password_public_key_path</code></a>
          system variable. If the key file contains a valid public key
          value but the value is incorrect, an access-denied error
          occurs. If the key file does not contain a valid public key,
          the client program cannot use it. In this case, the
          <code class="literal">sha256_password</code> plugin sends the public key
          to the client as if no
          <a class="link" href="programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a> option
          had been specified.
        </p><p>
          Client users can obtain the RSA public key two ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The database administrator can provide a copy of the
              public key file.
            </p></li><li class="listitem"><p>
              A client user who can connect to the server some other way
              can use a <code class="literal">SHOW STATUS LIKE
              'Rsa_public_key'</code> statement and save the returned
              key value in a file.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="caching-sha2-pluggable-authentication"></a>6.4.1.3 Caching SHA-2 Pluggable Authentication</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091720173072"></a><a class="indexterm" name="idm140091720171968"></a><p>
        MySQL provides two authentication plugins that implement SHA-256
        hashing for user account passwords:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">sha256_password</code>: Implements basic SHA-256
            authentication.
          </p></li><li class="listitem"><p>
            <code class="literal">caching_sha2_password</code>: Implements SHA-256
            authentication (like <code class="literal">sha256_password</code>),
            but uses caching on the server side for better performance
            and has additional features for wider applicability.
</p></li></ul>
</div>
<p>
        This section describes the caching SHA-2 authentication plugin.
        For information about the original basic (noncaching) plugin,
        see <a class="xref" href="security.html#sha256-pluggable-authentication" title="6.4.1.2 SHA-256 Pluggable Authentication">Section 6.4.1.2, “SHA-256 Pluggable Authentication”</a>.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
          In MySQL 8.0, <code class="literal">caching_sha2_password</code> is the
          default authentication plugin rather than
          <code class="literal">mysql_native_password</code>. For information
          about the implications of this change for server operation and
          compatibility of the server with clients and connectors, see
          <a class="xref" href="installing.html#upgrade-caching-sha2-password" title="caching_sha2_password as the Preferred Authentication Plugin">caching_sha2_password as the Preferred Authentication Plugin</a>.
</p>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Important
</div>
<p>
          To connect to the server using an account that authenticates
          with the <code class="literal">caching_sha2_password</code> plugin, you
          must use either a secure connection or an unencrypted
          connection that supports password exchange using an RSA key
          pair, as described later in this section. Either way, the
          <code class="literal">caching_sha2_password</code> plugin uses MySQL's
          encryption capabilities. See
          <a class="xref" href="security.html#encrypted-connections" title="6.3 Using Encrypted Connections">Section 6.3, “Using Encrypted Connections”</a>.
</p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          In the name <code class="literal">sha256_password</code>,
          <span class="quote">“<span class="quote">sha256</span>”</span> refers to the 256-bit digest length the
          plugin uses for encryption. In the name
          <code class="literal">caching_sha2_password</code>, <span class="quote">“<span class="quote">sha2</span>”</span>
          refers more generally to the SHA-2 class of encryption
          algorithms, of which 256-bit encryption is one instance. The
          latter name choice leaves room for future expansion of
          possible digest lengths without changing the plugin name.
</p>
</div>
<p>
        The <code class="literal">caching_sha2_password</code> plugin has these
        advantages, compared to <code class="literal">sha256_password</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            On the server side, an in-memory cache enables faster
            reauthentication of users who have connected previously when
            they connect again.
          </p></li><li class="listitem"><p>
            RSA-based password exchange is available regardless of the
            SSL library against which MySQL is linked.
          </p></li><li class="listitem"><p>
            Support is provided for client connections that use the Unix
            socket-file and shared-memory protocols.
</p></li></ul>
</div>
<p>
        The following table shows the plugin names on the server and
        client sides.
</p>
<div class="table">
<a name="idm140091720148960"></a><p class="title"><b>Table 6.15 Plugin and Library Names for SHA-2 Authentication</b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for SHA-2 password authentication."><col width="30%"><col width="70%"><thead><tr>
            <th scope="col">Plugin or File</th>
            <th scope="col">Plugin or File Name</th>
          </tr></thead><tbody><tr>
            <td scope="row">Server-side plugin</td>
            <td><code class="literal">caching_sha2_password</code></td>
          </tr><tr>
            <td scope="row">Client-side plugin</td>
            <td><code class="literal">caching_sha2_password</code></td>
          </tr><tr>
            <td scope="row">Library file</td>
            <td>None (plugins are built in)</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The following sections provide installation and usage
        information specific to caching SHA-2 pluggable authentication:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#caching-sha2-pluggable-authentication-installation" title="Installing SHA-2 Pluggable Authentication">Installing SHA-2 Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#caching-sha2-pluggable-authentication-usage" title="Using SHA-2 Pluggable Authentication">Using SHA-2 Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#caching-sha2-pluggable-authentication-cache-operation" title="Cache Operation for SHA-2 Pluggable Authentication">Cache Operation for SHA-2 Pluggable Authentication</a></p></li></ul>
</div>
<p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="caching-sha2-pluggable-authentication-installation"></a>Installing SHA-2 Pluggable Authentication</h5>
</div>
</div>
</div>
<p>
          The <code class="literal">caching_sha2_password</code> plugin exists in
          server and client forms:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The server-side plugin is built into the server, need not
              be loaded explicitly, and cannot be disabled by unloading
              it.
            </p></li><li class="listitem"><p>
              The client-side plugin is built into the
              <code class="literal">libmysqlclient</code> client library and is
              available to any program linked against
              <code class="literal">libmysqlclient</code>.
</p></li></ul>
</div>
<p>
          The server-side plugin uses the
          <code class="literal">sha2_cache_cleaner</code> audit plugin as a helper
          to perform password cache management.
          <code class="literal">sha2_cache_cleaner</code>, like
          <code class="literal">caching_sha2_password</code>, is built in and need
          not be installed.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="caching-sha2-pluggable-authentication-usage"></a>Using SHA-2 Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          To set up an account that uses the
          <code class="literal">caching_sha2_password</code> plugin for SHA-256
          password hashing, use the following statement, where
          <em class="replaceable"><code>password</code></em> is the desired account
          password:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'sha2user'@'localhost'
IDENTIFIED WITH caching_sha2_password BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          The server assigns the
          <code class="literal">caching_sha2_password</code> plugin to the account
          and uses it to encrypt the password using SHA-256, storing
          those values in the <code class="literal">plugin</code> and
          <code class="literal">authentication_string</code> columns of the
          <code class="literal">mysql.user</code> system table.
        </p><p>
          The preceding instructions do not assume that
          <code class="literal">caching_sha2_password</code> is the default
          authentication plugin. If
          <code class="literal">caching_sha2_password</code> is the default
          authentication plugin, a simpler <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE
          USER</code></a> syntax can be used.
        </p><p>
          To start the server with the default authentication plugin set
          to <code class="literal">caching_sha2_password</code>, put these lines
          in the server option file:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
default_authentication_plugin=caching_sha2_password
</pre><p>
          That causes the <code class="literal">caching_sha2_password</code>
          plugin to be used by default for new accounts. As a result, it
          is possible to create the account and set its password without
          naming the plugin explicitly:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'sha2user'@'localhost' IDENTIFIED BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          Another consequence of setting
          <a class="link" href="server-administration.html#sysvar_default_authentication_plugin"><code class="literal">default_authentication_plugin</code></a>
          to <code class="literal">caching_sha2_password</code> is that, to use
          some other plugin for account creation, you must specify that
          plugin explicitly. For example, to use the
          <code class="literal">mysql_native_password</code> plugin, use this
          statement:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'nativeuser'@'localhost'
IDENTIFIED WITH mysql_native_password BY '<em class="replaceable"><code>password</code></em>';
</pre><p>
          <code class="literal">caching_sha2_password</code> supports connections
          over secure transport. If you follow the RSA configuration
          procedure given later in this section, it also supports
          encrypted password exchange using RSA over unencrypted
          connections. RSA support has these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              On the server side, two system variables name the RSA
              private and public key-pair files:
              <a class="link" href="server-administration.html#sysvar_caching_sha2_password_private_key_path"><code class="literal">caching_sha2_password_private_key_path</code></a>
              and
              <a class="link" href="server-administration.html#sysvar_caching_sha2_password_public_key_path"><code class="literal">caching_sha2_password_public_key_path</code></a>.
              The database administrator must set these variables at
              server startup if the key files to use have names that
              differ from the system variable default values.
            </p></li><li class="listitem"><p>
              The server uses the
              <a class="link" href="server-administration.html#sysvar_caching_sha2_password_auto_generate_rsa_keys"><code class="literal">caching_sha2_password_auto_generate_rsa_keys</code></a>
              system variable to determine whether to automatically
              generate the RSA key-pair files. See
              <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 Creating SSL and RSA Certificates and Keys">Section 6.3.3, “Creating SSL and RSA Certificates and Keys”</a>.
            </p></li><li class="listitem"><p>
              The
              <a class="link" href="server-administration.html#statvar_Caching_sha2_password_rsa_public_key"><code class="literal">Caching_sha2_password_rsa_public_key</code></a>
              status variable displays the RSA public key value used by
              the <code class="literal">caching_sha2_password</code>
              authentication plugin.
            </p></li><li class="listitem"><p>
              Clients that are in possession of the RSA public key can
              perform RSA key pair-based password exchange with the
              server during the connection process, as described later.
            </p></li><li class="listitem"><p>
              For connections by accounts that authenticate with
              <code class="literal">caching_sha2_password</code> and RSA key
              pair-based password exchange, the server does not send the
              RSA public key to clients by default. Clients can use a
              client-side copy of the required public key, or request
              the public key from the server.
            </p><p>
              Use of a trusted local copy of the public key enables the
              client to avoid a round trip in the client/server
              protocol, and is more secure than requesting the public
              key from the server. On the other hand, requesting the
              public key from the server is more convenient (it requires
              no management of a client-side file) and may be acceptable
              in secure network environments.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  For command-line clients, use the
                  <a class="link" href="programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a>
                  option to specify the RSA public key file. Use the
                  <a class="link" href="programs.html#option_mysql_get-server-public-key"><code class="option">--get-server-public-key</code></a>
                  option to request the public key from the server. The
                  following programs support the two options:
                  <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a>, <span class="command"><strong>mysqlsh</strong></span>,
                  <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a>,
                  <a class="link" href="programs.html#mysqlbinlog" title="4.6.8 mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a>,
                  <a class="link" href="programs.html#mysqlcheck" title="4.5.3 mysqlcheck — A Table Maintenance Program"><span class="command"><strong>mysqlcheck</strong></span></a>,
                  <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>,
                  <a class="link" href="programs.html#mysqlimport" title="4.5.5 mysqlimport — A Data Import Program"><span class="command"><strong>mysqlimport</strong></span></a>,
                  <a class="link" href="programs.html#mysqlpump" title="4.5.6 mysqlpump — A Database Backup Program"><span class="command"><strong>mysqlpump</strong></span></a>,
                  <a class="link" href="programs.html#mysqlshow" title="4.5.7 mysqlshow — Display Database, Table, and Column Information"><span class="command"><strong>mysqlshow</strong></span></a>,
                  <a class="link" href="programs.html#mysqlslap" title="4.5.8 mysqlslap — Load Emulation Client"><span class="command"><strong>mysqlslap</strong></span></a>,
                  <span class="command"><strong>mysqltest</strong></span>,
                  <a class="link" href="programs.html#mysql-upgrade" title="4.4.5 mysql_upgrade — Check and Upgrade MySQL Tables"><span class="command"><strong>mysql_upgrade</strong></span></a>.
                </p></li><li class="listitem"><p>
                  For programs that use the C API, call
                  <a class="link" href="connectors-apis.html#mysql-options" title="28.7.7.50 mysql_options()"><code class="literal">mysql_options()</code></a> to
                  specify the RSA public key file by passing the
                  <code class="literal">MYSQL_SERVER_PUBLIC_KEY</code> option and
                  the name of the file, or request the public key from
                  the server by passing the
                  <code class="literal">MYSQL_OPT_GET_SERVER_PUBLIC_KEY</code>
                  option.
                </p></li><li class="listitem"><p>
                  For replication slaves, use the
                  <a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1 CHANGE MASTER TO Syntax"><code class="literal">CHANGE MASTER TO</code></a>
                  statement with the
                  <code class="literal">MASTER_PUBLIC_KEY_PATH</code> option to
                  specify the RSA public key file, or the
                  <code class="literal">GET_MASTER_PUBLIC_KEY</code> option to
                  request the public key from the master. For Group
                  Replication, the
                  <a class="link" href="group-replication.html#sysvar_group_replication_recovery_public_key_path"><code class="literal">group_replication_recovery_public_key_path</code></a>
                  and
                  <a class="link" href="group-replication.html#sysvar_group_replication_recovery_get_public_key"><code class="literal">group_replication_recovery_get_public_key</code></a>
                  system variables serve the same purpose.
</p></li></ul>
</div>
<p>
              In all cases, if the option is given to specify a valid
              public key file, it takes precedence over the option to
              request the public key from the server.
</p></li></ul>
</div>
<p>
          For clients that use the
          <code class="literal">caching_sha2_password</code> plugin, passwords are
          never exposed as cleartext when connecting to the server. How
          password transmission occurs depends on whether a secure
          connection or RSA encryption is used:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the connection is secure, an RSA key pair is
              unnecessary and is not used. This applies to encrypted TCP
              connections that use TLS, as well as Unix socket-file and
              shared-memory connections. The password is sent as
              cleartext but cannot be snooped because the connection is
              secure.
            </p></li><li class="listitem"><p>
              If the connection is not secure, an RSA key pair is used.
              This applies to unencrypted TCP connections without TLS
              and named-pipe connections. RSA is used only for password
              exchange between client and server, to prevent password
              snooping. When the server receives the encrypted password,
              it decrypts it. A scramble is used in the encryption to
              prevent repeat attacks.
</p></li></ul>
</div>
<p>
          To enable use of an RSA key pair for password exchange during
          the client connection process, use the following procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Create the RSA private and public key-pair files using the
              instructions in <a class="xref" href="security.html#creating-ssl-rsa-files" title="6.3.3 Creating SSL and RSA Certificates and Keys">Section 6.3.3, “Creating SSL and RSA Certificates and Keys”</a>.
            </p></li><li class="listitem"><p>
              If the private and public key files are located in the
              data directory and are named
              <code class="filename">private_key.pem</code> and
              <code class="filename">public_key.pem</code> (the default values of
              the
              <a class="link" href="server-administration.html#sysvar_caching_sha2_password_private_key_path"><code class="literal">caching_sha2_password_private_key_path</code></a>
              and
              <a class="link" href="server-administration.html#sysvar_caching_sha2_password_public_key_path"><code class="literal">caching_sha2_password_public_key_path</code></a>
              system variables), the server uses them automatically at
              startup.
            </p><p>
              Otherwise, to name the key files explicitly, set the
              system variables to the key file names in the server
              option file. If the files are located in the server data
              directory, you need not specify their full path names:
            </p><pre data-lang="ini" class="programlisting">
[mysqld]
caching_sha2_password_private_key_path=myprivkey.pem
caching_sha2_password_public_key_path=mypubkey.pem
</pre><p>
              If the key files are not located in the data directory, or
              to make their locations explicit in the system variable
              values, use full path names:
            </p><pre data-lang="ini" class="programlisting">
[mysqld]
caching_sha2_password_private_key_path=/usr/local/mysql/myprivkey.pem
caching_sha2_password_public_key_path=/usr/local/mysql/mypubkey.pem
</pre></li><li class="listitem"><p>
              Restart the server, then connect to it and check the
              <a class="link" href="server-administration.html#statvar_Caching_sha2_password_rsa_public_key"><code class="literal">Caching_sha2_password_rsa_public_key</code></a>
              status variable value. The value will differ from that
              shown here, but should be nonempty:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'Caching_sha2_password_rsa_public_key'\G</code></strong>
*************************** 1. row ***************************
Variable_name: Caching_sha2_password_rsa_public_key
        Value: -----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDO9nRUDd+KvSZgY7cNBZMNpwX6
MvE1PbJFXO7u18nJ9lwc99Du/E7lw6CVXw7VKrXPeHbVQUzGyUNkf45Nz/ckaaJa
aLgJOBCIDmNVnyU54OT/1lcs2xiyfaDMe8fCJ64ZwTnKbY2gkt1IMjUAB5Ogd5kJ
g8aV7EtKwyhHb0c30QIDAQAB
-----END PUBLIC KEY-----
</pre><p>
              If the value is empty, the server found some problem with
              the key files. Check the error log for diagnostic
              information.
</p></li></ol>
</div>
<p>
          After the server has been configured with the RSA key files,
          accounts that authenticate with the
          <code class="literal">caching_sha2_password</code> plugin have the
          option of using those key files to connect to the server. As
          mentioned previously, such accounts can use either a secure
          connection (in which case RSA is not used) or an unencrypted
          connection that performs password exchange using RSA. Suppose
          that an unencrypted connection is used. For example:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha2user -p</code></strong>
Enter password: <em class="replaceable"><code>password</code></em>
</pre><p>
          For this connection attempt by <code class="literal">sha2user</code>,
          the server determines that
          <code class="literal">caching_sha2_password</code> is the appropriate
          authentication plugin and invokes it (because that was the
          plugin specified at <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>
          time). The plugin finds that the connection is not encrypted
          and thus requires the password to be transmitted using RSA
          encryption. However, the server does not send the public key
          to the client, and the client provided no public key, so it
          cannot encrypt the password and the connection fails:
        </p><pre data-lang="simple" class="programlisting">
ERROR 2061 (HY000): Authentication plugin 'caching_sha2_password'
reported error: Authentication requires secure connection.
</pre><p>
          To request the RSA public key from the server, specify the
          <a class="link" href="programs.html#option_mysql_get-server-public-key"><code class="option">--get-server-public-key</code></a> option:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha2user -p --get-server-public-key</code></strong>
Enter password: <em class="replaceable"><code>password</code></em>
</pre><p>
          In this case, the server sends the RSA public key to the
          client, which uses it to encrypt the password and returns the
          result to the server. The plugin uses the RSA private key on
          the server side to decrypt the password and accepts or rejects
          the connection based on whether the password is correct.
        </p><p>
          Alternatively, if the client has a file containing a local
          copy of the RSA public key required by the server, it can
          specify the file using the
          <a class="link" href="programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a> option:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --ssl-mode=DISABLED -u sha2user -p --server-public-key-path=<em class="replaceable"><code>file_name</code></em></code></strong>
Enter password: <em class="replaceable"><code>password</code></em>
</pre><p>
          In this case, the client uses the public key to encrypt the
          password and returns the result to the server. The plugin uses
          the RSA private key on the server side to decrypt the password
          and accepts or rejects the connection based on whether the
          password is correct.
        </p><p>
          The public key value in the file named by the
          <a class="link" href="programs.html#option_mysql_server-public-key-path"><code class="option">--server-public-key-path</code></a> option
          should be the same as the key value in the server-side file
          named by the
          <a class="link" href="server-administration.html#sysvar_caching_sha2_password_public_key_path"><code class="literal">caching_sha2_password_public_key_path</code></a>
          system variable. If the key file contains a valid public key
          value but the value is incorrect, an access-denied error
          occurs. If the key file does not contain a valid public key,
          the client program cannot use it.
        </p><p>
          Client users can obtain the RSA public key two ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The database administrator can provide a copy of the
              public key file.
            </p></li><li class="listitem"><p>
              A client user who can connect to the server some other way
              can use a <code class="literal">SHOW STATUS LIKE
              'Caching_sha2_password_rsa_public_key'</code> statement
              and save the returned key value in a file.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="caching-sha2-pluggable-authentication-cache-operation"></a>Cache Operation for SHA-2 Pluggable Authentication</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091720010592"></a><a class="indexterm" name="idm140091720009504"></a><p>
          On the server side, the
          <code class="literal">caching_sha2_password</code> plugin uses an
          in-memory cache for faster authentication of clients who have
          connected previously. Entries consist of
          account-name/password-hash pairs. The cache works like this:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              When a client connects,
              <code class="literal">caching_sha2_password</code> checks whether
              the client and password match some cache entry. If so,
              authentication succeeds.
            </p></li><li class="listitem"><p>
              If there is no matching cache entry, the plugin attempts
              to verify the client against the credentials in the
              <code class="literal">mysql.user</code> system table. If this
              succeeds, <code class="literal">caching_sha2_password</code> adds an
              entry for the client to the hash. Otherwise,
              authentication fails and the connection is rejected.
</p></li></ol>
</div>
<p>
          In this way, when a client first connects, authentication
          against the <code class="literal">mysql.user</code> system table occurs.
          When the client connects subsequently, faster authentication
          against the cache occurs.
        </p><p>
          Password cache operations other than adding entries are
          handled by the <code class="literal">sha2_cache_cleaner</code> audit
          plugin, which performs these actions on behalf of
          <code class="literal">caching_sha2_password</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              It clears the cache entry for any account that is renamed
              or dropped, or any account for which the credentials or
              authentication plugin are changed.
            </p></li><li class="listitem"><p>
              It empties the cache when the <a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH
              PRIVILEGES</code></a> statement is executed.
            </p></li><li class="listitem"><p>
              It empties the cache at server shutdown. (This means the
              cache is not persistent across server restarts.)
</p></li></ul>
</div>
<p>
          Cache clearing operations affect the authentication
          requirements for subsequent client connections. For each user
          account, the first client connection for the user after any of
          the following operations must use a secure connection (made
          using TCP using TLS credentials, a Unix socket file, or shared
          memory) or RSA key pair-based password exchange:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              After account creation.
            </p></li><li class="listitem"><p>
              After a password change for the account.
            </p></li><li class="listitem"><p>
              After <a class="link" href="sql-syntax.html#rename-user" title="13.7.1.7 RENAME USER Syntax"><code class="literal">RENAME USER</code></a> for the
              account.
            </p></li><li class="listitem"><p>
              After <a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a>.
</p></li></ul>
</div>
<p>
          <a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a> clears the
          entire cache and affects all accounts that use the
          <code class="literal">caching_sha2_password</code> plugin. The other
          operations clear specific cache entries and affect only
          accounts that are part of the operation.
        </p><p>
          Once the user authenticates successfully, the account is
          entered into the cache and subsequent connections do not
          require a secure connection or the RSA key pair, until another
          cache clearing event occurs that affects the account. (When
          the cache can be used, the server uses a challenge-response
          mechanism that does not use cleartext password transmission
          and does not require a secure connection.)
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="cleartext-pluggable-authentication"></a>6.4.1.4 Client-Side Cleartext Pluggable Authentication</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091719981888"></a><a class="indexterm" name="idm140091719980784"></a><p>
        A client-side authentication plugin is available that enables
        clients to send passwords to the server as cleartext, without
        hashing or encryption. This plugin is built into the MySQL
        client library.
      </p><p>
        The following table shows the plugin name.
</p>
<div class="table">
<a name="idm140091719978192"></a><p class="title"><b>Table 6.16 Plugin and Library Names for Cleartext Authentication</b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for cleartext password authentication."><col width="30%"><col width="70%"><thead><tr>
            <th scope="col">Plugin or File</th>
            <th scope="col">Plugin or File Name</th>
          </tr></thead><tbody><tr>
            <td scope="row">Server-side plugin</td>
            <td>None, see discussion</td>
          </tr><tr>
            <td scope="row">Client-side plugin</td>
            <td><code class="literal">mysql_clear_password</code></td>
          </tr><tr>
            <td scope="row">Library file</td>
            <td>None (plugin is built in)</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        Many client-side authentication plugins perform hashing or
        encryption of a password before the client sends it to the
        server. This enables clients to avoid sending passwords as
        cleartext.
      </p><p>
        Hashing or encryption cannot be done for authentication schemes
        that require the server to receive the password as entered on
        the client side. In such cases, the client-side
        <code class="literal">mysql_clear_password</code> plugin is used, which
        enables the client to send the password to the server as
        cleartext. There is no corresponding server-side plugin. Rather,
        <code class="literal">mysql_clear_password</code> can be used on the
        client side in concert with any server-side plugin that needs a
        cleartext password. (Examples are the PAM and simple LDAP
        authentication plugins; see
        <a class="xref" href="security.html#pam-pluggable-authentication" title="6.4.1.5 PAM Pluggable Authentication">Section 6.4.1.5, “PAM Pluggable Authentication”</a>, and
        <a class="xref" href="security.html#ldap-pluggable-authentication" title="6.4.1.7 LDAP Pluggable Authentication">Section 6.4.1.7, “LDAP Pluggable Authentication”</a>.)
      </p><p>
        The following discussion provides usage information specific to
        cleartext pluggable authentication. For general information
        about pluggable authentication in MySQL, see
        <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Sending passwords as cleartext may be a security problem in
          some configurations. To avoid problems if there is any
          possibility that the password would be intercepted, clients
          should connect to MySQL Server using a method that protects
          the password. Possibilities include SSL (see
          <a class="xref" href="security.html#encrypted-connections" title="6.3 Using Encrypted Connections">Section 6.3, “Using Encrypted Connections”</a>), IPsec, or a private
          network.
</p>
</div>
<p>
        To make inadvertent use of the
        <code class="literal">mysql_clear_password</code> plugin less likely,
        MySQL clients must explicitly enable it. This can be done in
        several ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Set the <code class="literal">LIBMYSQL_ENABLE_CLEARTEXT_PLUGIN</code>
            environment variable to a value that begins with
            <code class="literal">1</code>, <code class="literal">Y</code>, or
            <code class="literal">y</code>. This enables the plugin for all client
            connections.
          </p></li><li class="listitem"><p>
            The <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a>, <a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin — Client for Administering a MySQL Server"><span class="command"><strong>mysqladmin</strong></span></a>,
            <a class="link" href="programs.html#mysqlcheck" title="4.5.3 mysqlcheck — A Table Maintenance Program"><span class="command"><strong>mysqlcheck</strong></span></a>, <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>,
            <a class="link" href="programs.html#mysqlshow" title="4.5.7 mysqlshow — Display Database, Table, and Column Information"><span class="command"><strong>mysqlshow</strong></span></a>, and
            <a class="link" href="programs.html#mysqlslap" title="4.5.8 mysqlslap — Load Emulation Client"><span class="command"><strong>mysqlslap</strong></span></a> client programs support an
            <code class="option">--enable-cleartext-plugin</code> option that
            enables the plugin on a per-invocation basis.
          </p></li><li class="listitem"><p>
            The <a class="link" href="connectors-apis.html#mysql-options" title="28.7.7.50 mysql_options()"><code class="literal">mysql_options()</code></a> C API
            function supports a
            <code class="literal">MYSQL_ENABLE_CLEARTEXT_PLUGIN</code> option that
            enables the plugin on a per-connection basis. Also, any
            program that uses <code class="literal">libmysqlclient</code> and
            reads option files can enable the plugin by including an
            <code class="literal">enable-cleartext-plugin</code> option in an
            option group read by the client library.
</p></li></ul>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="pam-pluggable-authentication"></a>6.4.1.5 PAM Pluggable Authentication</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091719937184"></a><a class="indexterm" name="idm140091719936080"></a><a class="indexterm" name="idm140091719934592"></a><a class="indexterm" name="idm140091719933120"></a><a class="indexterm" name="idm140091719931648"></a><a class="indexterm" name="idm140091719930560"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          PAM pluggable authentication is an extension included in
          MySQL Enterprise Edition, a commercial product. To learn more about commercial
          products, see <a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a>.
</p>
</div>
<p>
        MySQL Enterprise Edition supports an authentication method that enables MySQL
        Server to use PAM (Pluggable Authentication Modules) to
        authenticate MySQL users. PAM enables a system to use a standard
        interface to access various kinds of authentication methods,
        such as traditional Unix passwords or an LDAP directory.
      </p><p>
        PAM pluggable authentication provides these capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            External authentication: PAM authentication enables MySQL
            Server to accept connections from users defined outside the
            MySQL grant tables and that authenticate using methods
            supported by PAM.
          </p></li><li class="listitem"><p>
            Proxy user support: PAM authentication can return to MySQL a
            user name different from the external user name passed by
            the client program, based on the PAM groups the external
            user is a member of and the authentication string provided.
            This means that the plugin can return the MySQL user that
            defines the privileges the external PAM-authenticated user
            should have. For example, an operating sytem user named
            <code class="literal">joe</code> can connect and have the privileges
            of a MySQL user named <code class="literal">developer</code>.
</p></li></ul>
</div>
<p>
        PAM pluggable authentication has been tested on Linux and macOS.
      </p><p>
        The following table shows the plugin and library file names. The
        file name suffix might differ on your system. The file must be
        located in the directory named by the
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable. For
        installation information, see
        <a class="xref" href="security.html#pam-pluggable-authentication-installation" title="Installing PAM Pluggable Authentication">Installing PAM Pluggable Authentication</a>.
</p>
<div class="table">
<a name="idm140091719918400"></a><p class="title"><b>Table 6.17 Plugin and Library Names for PAM Authentication</b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for PAM password authentication."><col width="30%"><col width="70%"><thead><tr>
            <th scope="col">Plugin or File</th>
            <th scope="col">Plugin or File Name</th>
          </tr></thead><tbody><tr>
            <td scope="row">Server-side plugin</td>
            <td><code class="literal">authentication_pam</code></td>
          </tr><tr>
            <td scope="row">Client-side plugin</td>
            <td><code class="literal">mysql_clear_password</code></td>
          </tr><tr>
            <td scope="row">Library file</td>
            <td><code class="filename">authentication_pam.so</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The client-side <code class="literal">mysql_clear_password</code>
        cleartext plugin that communicates with the server-side PAM
        plugin is built into the <code class="literal">libmysqlclient</code>
        client library and is included in all distributions, including
        community distributions. Inclusion of the client-side cleartext
        plugin in all MySQL distributions enables clients from any
        distribution to connect to a server that has the server-side PAM
        plugin loaded.
      </p><p>
        The following sections provide installation and usage
        information specific to PAM pluggable authentication:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#pam-pluggable-authentication-how-it-works" title="How PAM Authentication of MySQL Users Works">How PAM Authentication of MySQL Users Works</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-pluggable-authentication-installation" title="Installing PAM Pluggable Authentication">Installing PAM Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-pluggable-authentication-uninstallation" title="Uninstalling PAM Pluggable Authentication">Uninstalling PAM Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-pluggable-authentication-usage" title="Using PAM Pluggable Authentication">Using PAM Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-authentication-unix-without-proxy" title="Unix Password Authentication without Proxy Users">Unix Password Authentication without Proxy Users</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-authentication-ldap-without-proxy" title="LDAP Authentication without Proxy Users">LDAP Authentication without Proxy Users</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-authentication-unix-with-proxy" title="Unix Password Authentication with Proxy Users and Group Mapping">Unix Password Authentication with Proxy Users and Group Mapping</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-authentication-unix-password-store" title="PAM Authentication Access to Unix Password Store">PAM Authentication Access to Unix Password Store</a></p></li><li class="listitem"><p><a class="xref" href="security.html#pam-pluggable-authentication-debugging" title="PAM Authentication Debugging">PAM Authentication Debugging</a></p></li></ul>
</div>
<p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>. For information
        about the <code class="literal">mysql_clear_password</code> plugin, see
        <a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 Client-Side Cleartext Pluggable Authentication">Section 6.4.1.4, “Client-Side Cleartext Pluggable Authentication”</a>. For proxy
        user information, see <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="pam-pluggable-authentication-how-it-works"></a>How PAM Authentication of MySQL Users Works</h5>
</div>
</div>
</div>
<p>
          This section provides a general overview of how MySQL and PAM
          work together to authenticate MySQL users. For examples
          showing how to set up MySQL accounts to use specific PAM
          services, see
          <a class="xref" href="security.html#pam-pluggable-authentication-usage" title="Using PAM Pluggable Authentication">Using PAM Pluggable Authentication</a>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              The client program and the server communicate, with the
              client sending to the server the client user name (the
              operating system user name by default) and password:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  The client user name is the external user name.
                </p></li><li class="listitem"><p>
                  For accounts that use the PAM server-side
                  authentication plugin, the corresponding client-side
                  plugin is <code class="literal">mysql_clear_password</code>.
                  This client-side plugin performs no password hashing,
                  with the result that the client sends the password to
                  the server as cleartext.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              The server finds a matching MySQL account based on the
              external user name and the host from which the client
              connects. The PAM plugin uses the information passed to it
              by MySQL Server (such as user name, host name, password,
              and authentication string). When you define a MySQL
              account that authenticates using PAM, the authentication
              string contains:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  A PAM service name, which is a name that the system
                  administrator can use to refer to an authentication
                  method for a particular application. There can be
                  multiple applications associated with a single
                  database server instance, so the choice of service
                  name is left to the SQL application developer.
                </p></li><li class="listitem"><p>
                  Optionally, if proxying is to be used, a mapping from
                  PAM groups to MySQL user names.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              The plugin uses the PAM service named in the
              authentication string to check the user credentials and
              returns <code class="literal">'Authentication succeeded, Username is
              <em class="replaceable"><code>user_name</code></em>'</code> or
              <code class="literal">'Authentication failed'</code>. The password
              must be appropriate for the password store used by the PAM
              service. Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  For traditional Unix passwords, the service looks up
                  passwords stored in the
                  <code class="filename">/etc/shadow</code> file.
                </p></li><li class="listitem"><p>
                  For LDAP, the service looks up passwords stored in an
                  LDAP directory.
</p></li></ul>
</div>
<p>
              If the credentials check fails, the server refuses the
              connection.
            </p></li><li class="listitem"><p>
              Otherwise, the authentication string indicates whether
              proxying occurs. If the string contains no PAM group
              mapping, proxying does not occur. In this case, the MySQL
              user name is the same as the external user name.
            </p></li><li class="listitem"><p>
              Otherwise, proxying is indicated based on the PAM group
              mapping, with the MySQL user name determined based on the
              first matching group in the mapping list. The meaning of
              <span class="quote">“<span class="quote">PAM group</span>”</span> depends on the PAM service.
              Examples:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  For traditional Unix passwords, groups are Unix groups
                  defined in the <code class="filename">/etc/group</code> file,
                  possibly supplemented with additional PAM information
                  in a file such as
                  <code class="filename">/etc/security/group.conf</code>.
                </p></li><li class="listitem"><p>
                  For LDAP, groups are LDAP groups defined in an LDAP
                  directory.
</p></li></ul>
</div>
<p>
              If the proxy user (the external user) has the
              <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for the
              proxied MySQL user name, proxying occurs, with the proxy
              user assuming the privileges of the proxied user.
</p></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-pluggable-authentication-installation"></a>Installing PAM Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          This section describes how to install the PAM authentication
          plugin. For general information about installing plugins, see
          <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>.
        </p><p>
          To be usable by the server, the plugin library file must be
          located in the MySQL plugin directory (the directory named by
          the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
          variable). If necessary, configure the plugin directory
          location by setting the value of
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
        </p><p>
          The plugin library file base name is
          <code class="literal">authentication_pam</code>. The file name suffix
          differs per platform (for example, <code class="filename">.so</code>
          for Unix and Unix-like systems, <code class="filename">.dll</code> for
          Windows).
        </p><p>
          To load the plugin at server startup, use the
          <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option to
          name the library file that contains it. With this
          plugin-loading method, the option must be given each time the
          server starts. For example, put these lines in the server
          <code class="filename">my.cnf</code> file (adjust the
          <code class="filename">.so</code> suffix for your platform as
          necessary):
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
plugin-load-add=authentication_pam.so
</pre><p>
          After modifying <code class="filename">my.cnf</code>, restart the
          server to cause the new settings to take effect.
        </p><p>
          Alternatively, to register the plugin at runtime, use this
          statement (adjust the <code class="filename">.so</code> suffix as
          necessary):
        </p><pre data-lang="sql" class="programlisting">
INSTALL PLUGIN authentication_pam SONAME 'authentication_pam.so';
</pre><p>
          <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> loads the plugin
          immediately, and also registers it in the
          <code class="literal">mysql.plugins</code> system table to cause the
          server to load it for each subsequent normal startup.
        </p><p>
          To verify plugin installation, examine the
          <a class="link" href="information-schema.html#plugins-table" title="25.18 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table
          or use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.6.25 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>
          statement (see
          <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 Obtaining Server Plugin Information">Section 5.6.2, “Obtaining Server Plugin Information”</a>). For example:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%pam%';</code></strong>
+--------------------+---------------+
| PLUGIN_NAME        | PLUGIN_STATUS |
+--------------------+---------------+
| authentication_pam | ACTIVE        |
+--------------------+---------------+
</pre><p>
          If the plugin fails to initialize, check the server error log
          for diagnostic messages.
        </p><p>
          To associate MySQL accounts with the PAM plugin, see
          <a class="xref" href="security.html#pam-pluggable-authentication-usage" title="Using PAM Pluggable Authentication">Using PAM Pluggable Authentication</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-pluggable-authentication-uninstallation"></a>Uninstalling PAM Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          The method used to uninstall the PAM authentication plugin
          depends on how you installed it:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If you installed the plugin at server startup using a
              <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option,
              restart the server without the option.
            </p></li><li class="listitem"><p>
              If you installed the plugin at runtime using
              <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>, it remains
              installed across server restarts. To uninstall it, use
              <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a>:
            </p><pre data-lang="sql" class="programlisting">
UNINSTALL PLUGIN authentication_pam;
</pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-pluggable-authentication-usage"></a>Using PAM Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          This section describes in general terms how to use the PAM
          authentication plugin to connect from MySQL client programs to
          the server. The following sections provide instructions for
          using PAM authentication in specific ways. It is assumed that
          the server is running with the server-side PAM plugin enabled,
          as described in
          <a class="xref" href="security.html#pam-pluggable-authentication-installation" title="Installing PAM Pluggable Authentication">Installing PAM Pluggable Authentication</a>.
        </p><p>
          To refer to the PAM authentication plugin in the
          <code class="literal">IDENTIFIED WITH</code> clause of a
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement, use the
          name <code class="literal">authentication_pam</code>. For example:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_pam
  AS '<em class="replaceable"><code>auth_string</code></em>';
</pre><p>
          The authentication string specifies the following types of
          information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The PAM service name (see
              <a class="xref" href="security.html#pam-pluggable-authentication-how-it-works" title="How PAM Authentication of MySQL Users Works">How PAM Authentication of MySQL Users Works</a>).
              Examples in the following discussion use a service name of
              <code class="literal">mysql-unix</code> for authentication using
              traditional Unix passwords, and
              <code class="literal">mysql-ldap</code> for authentication using
              LDAP.
            </p></li><li class="listitem"><p>
              For proxy support, PAM provides a way for a PAM module to
              return to the server a MySQL user name other than the
              external user name passed by the client program when it
              connects to the server. Use the authentication string to
              control the mapping from external user names to MySQL user
              names. If you want to take advantage of proxy user
              capabilities, the authentication string must include this
              kind of mapping.
</p></li></ul>
</div>
<p>
          For example, if an account uses the
          <code class="literal">mysql-unix</code> PAM service name and should map
          operating system users in the <code class="literal">root</code> and
          <code class="literal">users</code> PAM groups to the
          <code class="literal">developer</code> and <code class="literal">data_entry</code>
          MySQL users, respectively, use a statement like this:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_pam
  AS 'mysql-unix, root=developer, users=data_entry';
</pre><p>
          Authentication string syntax for the PAM authentication plugin
          follows these rules:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The string consists of a PAM service name, optionally
              followed by a PAM group mapping list consisting of one or
              more keyword/value pairs each specifying a PAM group name
              and a MySQL user name:
            </p><pre data-lang="none" class="programlisting">
<em class="replaceable"><code>pam_service_name</code></em>[,<em class="replaceable"><code>pam_group_name</code></em>=<em class="replaceable"><code>mysql_user_name</code></em>]...
</pre><p>
              The plugin parses the authentication string for each
              connection attempt that uses the account. To minimize
              overhead, keep the string as short as possible.
            </p></li><li class="listitem"><p>
              Each
              <code class="literal"><em class="replaceable"><code>pam_group_name</code></em>=<em class="replaceable"><code>mysql_user_name</code></em></code>
              pair must be preceded by a comma.
            </p></li><li class="listitem"><p>
              Leading and trailing spaces not inside double quotation
              marks are ignored.
            </p></li><li class="listitem"><p>
              Unquoted <em class="replaceable"><code>pam_service_name</code></em>,
              <em class="replaceable"><code>pam_group_name</code></em>, and
              <em class="replaceable"><code>mysql_user_name</code></em> values can
              contain anything except equal sign, comma, or space.
            </p></li><li class="listitem"><p>
              If a <em class="replaceable"><code>pam_service_name</code></em>,
              <em class="replaceable"><code>pam_group_name</code></em>, or
              <em class="replaceable"><code>mysql_user_name</code></em> value is quoted
              with double quotation marks, everything between the
              quotation marks is part of the value. This is necessary,
              for example, if the value contains space characters. All
              characters are legal except double quotation mark and
              backslash (<code class="literal">\</code>). To include either
              character, escape it with a backslash.
</p></li></ul>
</div>
<p>
          If the plugin successfully authenticates the external user
          name (the name passed by the client), it looks for a PAM group
          mapping list in the authentication string and, if present,
          uses it to return a different MySQL user name to the MySQL
          server based on which PAM groups the external user is a member
          of:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the authentication string contains no PAM group mapping
              list, the plugin returns the external name.
            </p></li><li class="listitem"><p>
              If the authentication string does contain a PAM group
              mapping list, the plugin examines each
              <code class="literal"><em class="replaceable"><code>pam_group_name</code></em>=<em class="replaceable"><code>mysql_user_name</code></em></code>
              pair in the list from left to right and tries to find a
              match for the <em class="replaceable"><code>pam_group_name</code></em>
              value in a non-MySQL directory of the groups assigned to
              the authenticated user and returns
              <em class="replaceable"><code>mysql_user_name</code></em> for the first
              match it finds. If the plugin finds no match for any PAM
              group, it returns the external name. If the plugin is not
              capable of looking up a group in a directory, it ignores
              the PAM group mapping list and returns the external name.
</p></li></ul>
</div>
<p>
          The following sections describe how to set up several
          authentication scenarios that use the PAM authentication
          plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              No proxy users. This uses PAM only to check login names
              and passwords. Every external user permitted to connect to
              MySQL Server should have a matching MySQL account that is
              defined to use PAM authentication. (For a MySQL account of
              <code class="literal">'<em class="replaceable"><code>user_name</code></em>'@'<em class="replaceable"><code>host_name</code></em>'</code>
              to match the external user,
              <em class="replaceable"><code>user_name</code></em> must be the external
              user name and <em class="replaceable"><code>host_name</code></em> must
              match the host from which the client connects.)
              Authentication can be performed by various PAM-supported
              methods. Later discussion shows how to authenticate client
              credentials using traditional Unix passwords, and
              passwords in LDAP.
            </p><p>
              PAM authentication, when not done through proxy users or
              PAM groups, requires the MySQL user name to be same as the
              operating system user name. MySQL user names are limited
              to 32 characters (see <a class="xref" href="security.html#grant-tables" title="6.2.3 Grant Tables">Section 6.2.3, “Grant Tables”</a>),
              which limits PAM nonproxy authentication to Unix accounts
              with names of at most 32 characters.
            </p></li><li class="listitem"><p>
              Proxy users only, with PAM group mapping. For this
              scenario, create one or more MySQL accounts that define
              different sets of privileges. (Ideally, nobody should
              connect using those accounts directly.) Then define a
              default user authenticating through PAM that uses some
              mapping scheme (usually based on the external PAM groups
              the users are members of) to map all the external user
              names to the few MySQL accounts holding the privilege
              sets. Any client who connects and specifies an external
              user name as the client user name is mapped to one of the
              MySQL accounts and uses its privileges. The discussion
              shows how to set this up using traditional Unix passwords,
              but other PAM methods such as LDAP could be used instead.
</p></li></ul>
</div>
<p>
          Variations on these scenarios are possible:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              You can permit some users to log in directly (without
              proxying) but require others to connect through proxy
              accounts.
            </p></li><li class="listitem"><p>
              You can use one PAM authentication method for some users,
              and another method for other users, by using differing PAM
              service names among your PAM-authenticated accounts. For
              example, you can use the <code class="literal">mysql-unix</code> PAM
              service for some users, and <code class="literal">mysql-ldap</code>
              for others.
</p></li></ul>
</div>
<p>
          The examples make the following assumptions. You might need to
          make some adjustments if your system is set up differently.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The login name and password are <code class="literal">antonio</code>
              and <em class="replaceable"><code>antonio_password</code></em>,
              respectively. Change these to correspond to the user you
              want to authenticate.
            </p></li><li class="listitem"><p>
              The PAM configuration directory is
              <code class="filename">/etc/pam.d</code>.
            </p></li><li class="listitem"><p>
              The PAM service name corresponds to the authentication
              method (<code class="literal">mysql-unix</code> or
              <code class="literal">mysql-ldap</code> in this discussion). To use
              a given PAM service, you must set up a PAM file with the
              same name in the PAM configuration directory (creating the
              file if it does not exist). In addition, you must name the
              PAM service in the authentication string of the
              <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement for
              any account that authenticates using that PAM service.
</p></li></ul>
</div>
<p>
          The PAM authentication plugin checks at initialization time
          whether the <code class="literal">AUTHENTICATION_PAM_LOG</code>
          environment value is set in the server's startup environment.
          If so, the plugin enables logging of diagnostic messages to
          the standard output. Depending on how your server is started,
          the message might appear on the console or in the error log.
          These messages can be helpful for debugging PAM-related
          problems that occur when the plugin performs authentication.
          For more information, see
          <a class="xref" href="security.html#pam-pluggable-authentication-debugging" title="PAM Authentication Debugging">PAM Authentication Debugging</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-authentication-unix-without-proxy"></a>Unix Password Authentication without Proxy Users</h5>

</div>

</div>

</div>
<p>
          This authentication scenario uses PAM to check external users
          defined in terms of operating system user names and Unix
          passwords, without proxying. Every such external user
          permitted to connect to MySQL Server should have a matching
          MySQL account that is defined to use PAM authentication
          through traditional Unix password store.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Traditional Unix passwords are checked using the
            <code class="filename">/etc/shadow</code> file. For information
            regarding possible problems related to this file, see
            <a class="xref" href="security.html#pam-authentication-unix-password-store" title="PAM Authentication Access to Unix Password Store">PAM Authentication Access to Unix Password Store</a>.
</p>
</div>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Verify that Unix authentication permits logins to the
              operating system with the user name
              <code class="literal">antonio</code> and password
              <em class="replaceable"><code>antonio_password</code></em>.
            </p></li><li class="listitem"><p>
              Set up PAM to authenticate MySQL connections using
              traditional Unix passwords by creating a
              <code class="literal">mysql-unix</code> PAM service file named
              <code class="filename">/etc/pam.d/mysql-unix</code>. The file
              contents are system dependent, so check existing
              login-related files in the <code class="filename">/etc/pam.d</code>
              directory to see what they look like. On Linux, the
              <code class="filename">mysql-unix</code> file might look like this:
            </p><pre data-lang="none" class="programlisting">
#%PAM-1.0
auth            include         password-auth
account         include         password-auth
</pre><p>
              For macOS, use <code class="literal">login</code> rather than
              <code class="literal">password-auth</code>.
            </p><p>
              The PAM file format might differ on some systems. For
              example, on Ubuntu and other Debian-based systems, use
              these file contents instead:
            </p><pre data-lang="none" class="programlisting">
@include common-auth
@include common-account
@include common-session-noninteractive
</pre></li><li class="listitem"><p>
              Create a MySQL account with the same user name as the
              operating system user name and define it to authenticate
              using the PAM plugin and the <code class="literal">mysql-unix</code>
              PAM service:
            </p><pre data-lang="sql" class="programlisting">
CREATE USER 'antonio'@'localhost'
  IDENTIFIED WITH authentication_pam
  AS 'mysql-unix';
GRANT ALL PRIVILEGES
  ON mydb.*
  TO 'antonio'@'localhost';
</pre><p>
              Here, the authentication string contains only the PAM
              service name, <code class="literal">mysql-unix</code>, which
              authenticates Unix passwords.
            </p></li><li class="listitem"><p>
              Use the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> command-line client to
              connect to the MySQL server as <code class="literal">antonio</code>.
              For example:
            </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=antonio --password --enable-cleartext-plugin</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>antonio_password</code></em></code></strong>
</pre><p>
              The server should permit the connection and the following
              query should return output as shown:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+-------------------+--------------+
| USER()            | CURRENT_USER()    | @@proxy_user |
+-------------------+-------------------+--------------+
| antonio@localhost | antonio@localhost | NULL         |
+-------------------+-------------------+--------------+
</pre><p>
              This demonstrates that the <code class="literal">antonio</code>
              operating system user is authenticated to have the
              privileges granted to the <code class="literal">antonio</code> MySQL
              user, and that no proxying has occurred.
</p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            The client-side <code class="literal">mysql_clear_password</code>
            authentication plugin leaves the password untouched, so
            client programs send it to the MySQL server as cleartext.
            This enables the password to be passed as is to PAM. A
            cleartext password is necessary to use the server-side PAM
            library, but may be a security problem in some
            configurations. These measures minimize the risk:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                To make inadvertent use of the
                <code class="literal">mysql_clear_password</code> plugin less
                likely, MySQL clients must explicitly enable it (for
                example, with the
                <code class="option">--enable-cleartext-plugin</code> option). See
                <a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 Client-Side Cleartext Pluggable Authentication">Section 6.4.1.4, “Client-Side Cleartext Pluggable Authentication”</a>.
              </p></li><li class="listitem"><p>
                To avoid password exposure with the
                <code class="literal">mysql_clear_password</code> plugin enabled,
                MySQL clients should connect to the MySQL server using
                an encrypted connection. See
                <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>.
</p></li></ul>
</div>

</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-authentication-ldap-without-proxy"></a>LDAP Authentication without Proxy Users</h5>

</div>

</div>

</div>
<p>
          This authentication scenario uses PAM to check external users
          defined in terms of operating system user names and LDAP
          passwords, without proxying. Every such external user
          permitted to connect to MySQL Server should have a matching
          MySQL account that is defined to use PAM authentication
          through LDAP.
        </p><p>
          To use PAM LDAP pluggable authentication for MySQL, these
          prerequisites must be satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              An LDAP server must be available for the PAM LDAP service
              to communicate with.
            </p></li><li class="listitem"><p>
              LDAP users to be authenticated by MySQL must be present in
              the directory managed by the LDAP server.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            Another way to use LDAP for MySQL user authentication is to
            use the LDAP-specific authentication plugins. See
            <a class="xref" href="security.html#ldap-pluggable-authentication" title="6.4.1.7 LDAP Pluggable Authentication">Section 6.4.1.7, “LDAP Pluggable Authentication”</a>.
</p>
</div>
<p>
          Configure MySQL for PAM LDAP authentication as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Verify that Unix authentication permits logins to the
              operating system with the user name
              <code class="literal">antonio</code> and password
              <em class="replaceable"><code>antonio_password</code></em>.
            </p></li><li class="listitem"><p>
              Set up PAM to authenticate MySQL connections using LDAP by
              creating a <code class="literal">mysql-ldap</code> PAM service file
              named <code class="filename">/etc/pam.d/mysql-ldap</code>. The file
              contents are system dependent, so check existing
              login-related files in the <code class="filename">/etc/pam.d</code>
              directory to see what they look like. On Linux, the
              <code class="filename">mysql-ldap</code> file might look like this:
            </p><pre data-lang="none" class="programlisting">
#%PAM-1.0
auth        required    pam_ldap.so
account     required    pam_ldap.so
</pre><p>
              If PAM object files have a suffix different from
              <code class="filename">.so</code> on your system, substitute the
              correct suffix.
            </p><p>
              The PAM file format might differ on some systems.
            </p></li><li class="listitem"><p>
              Create a MySQL account with the same user name as the
              operating system user name and define it to authenticate
              using the PAM plugin and the <code class="literal">mysql-ldap</code>
              PAM service:
            </p><pre data-lang="sql" class="programlisting">
CREATE USER 'antonio'@'localhost'
  IDENTIFIED WITH authentication_pam
  AS 'mysql-ldap';
GRANT ALL PRIVILEGES
  ON mydb.*
  TO 'antonio'@'localhost';
</pre><p>
              Here, the authentication string contains only the PAM
              service name, <code class="literal">mysql-ldap</code>, which
              authenticates using LDAP.
            </p></li><li class="listitem"><p>
              Connecting to the server is the same as described in
              <a class="xref" href="security.html#pam-authentication-unix-without-proxy" title="Unix Password Authentication without Proxy Users">Unix Password Authentication without Proxy Users</a>.
</p></li></ol>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-authentication-unix-with-proxy"></a>Unix Password Authentication with Proxy Users and Group Mapping</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091719704368"></a><p>
          The authentication scheme described here uses proxying and PAM
          group mapping to map connecting MySQL users who authenticate
          using PAM onto other MySQL accounts that define different sets
          of privileges. Users do not connect directly through the
          accounts that define the privileges. Instead, they connect
          through a default proxy user authenticated using PAM, such
          that all the external users are mapped to the MySQL accounts
          that hold the privileges. Any user who connects is mapped to
          one of those MySQL accounts, the privileges for which
          determine the database operations permitted to the external
          user.
        </p><p>
          The procedure shown here uses Unix password authentication. To
          use LDAP instead, see the early steps of
          <a class="xref" href="security.html#pam-authentication-ldap-without-proxy" title="LDAP Authentication without Proxy Users">LDAP Authentication without Proxy Users</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Traditional Unix passwords are checked using the
            <code class="filename">/etc/shadow</code> file. For information
            regarding possible problems related to this file, see
            <a class="xref" href="security.html#pam-authentication-unix-password-store" title="PAM Authentication Access to Unix Password Store">PAM Authentication Access to Unix Password Store</a>.
</p>
</div>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Verify that Unix authentication permits logins to the
              operating system with the user name
              <code class="literal">antonio</code> and password
              <em class="replaceable"><code>antonio_password</code></em>.
            </p></li><li class="listitem"><p>
              Verify that <code class="literal">antonio</code> is a member of the
              <code class="literal">root</code> or <code class="literal">users</code> PAM
              group.
            </p></li><li class="listitem"><p>
              Set up PAM to authenticate the
              <code class="literal">mysql-unix</code> PAM service through
              operating system users by creating a file named
              <code class="filename">/etc/pam.d/mysql-unix</code>. The file
              contents are system dependent, so check existing
              login-related files in the <code class="filename">/etc/pam.d</code>
              directory to see what they look like. On Linux, the
              <code class="filename">mysql-unix</code> file might look like this:
            </p><pre data-lang="none" class="programlisting">
#%PAM-1.0
auth            include         password-auth
account         include         password-auth
</pre><p>
              For macOS, use <code class="literal">login</code> rather than
              <code class="literal">password-auth</code>.
            </p><p>
              The PAM file format might differ on some systems. For
              example, on Ubuntu and other Debian-based systems, use
              these file contents instead:
            </p><pre data-lang="none" class="programlisting">
@include common-auth
@include common-account
@include common-session-noninteractive
</pre></li><li class="listitem"><p>
              Create a default proxy user (<code class="literal">''@''</code>)
              that maps external PAM users to the proxied accounts:
            </p><pre data-lang="sql" class="programlisting">
CREATE USER ''@''
  IDENTIFIED WITH authentication_pam
  AS 'mysql-unix, root=developer, users=data_entry';
</pre><p>
              Here, the authentication string contains the PAM service
              name, <code class="literal">mysql-unix</code>, which authenticates
              Unix passwords. The authentication string also maps
              external users in the <code class="literal">root</code> and
              <code class="literal">users</code> PAM groups to the
              <code class="literal">developer</code> and
              <code class="literal">data_entry</code> MySQL user names,
              respectively.
            </p><p>
              The PAM group mapping list following the PAM service name
              is required when you set up proxy users. Otherwise, the
              plugin cannot tell how to perform mapping from external
              user names to the proper proxied MySQL user names.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                If your MySQL installation has anonymous users, they
                might conflict with the default proxy user. For more
                information about this problem, and ways of dealing with
                it, see <a class="xref" href="security.html#proxy-users-conflicts" title="Default Proxy User and Anonymous User Conflicts">Default Proxy User and Anonymous User Conflicts</a>.
</p>
</div>
</li><li class="listitem"><p>
              Create proxied accounts that have the required privileges
              for MySQL access:
            </p><pre data-lang="sql" class="programlisting">
CREATE USER 'developer'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>very secret password</code></em>';
CREATE USER 'data_entry'@'localhost'
  IDENTIFIED BY '<em class="replaceable"><code>very secret password</code></em>';

GRANT ALL PRIVILEGES
  ON mydevdb.*
  TO 'developer'@'localhost';
GRANT ALL PRIVILEGES
  ON mydb.*
  TO 'data_entry'@'localhost';
</pre><p>
              If you do not let anyone know the passwords for these
              accounts, clients cannot use them to connect directly to
              the MySQL server. Instead, it is expected that users who
              authenticate using PAM will use the
              <code class="literal">developer</code> or
              <code class="literal">data_entry</code> account by proxy based on
              their PAM group.
            </p><p>
              Other ways to ensure that the proxied accounts cannot be
              used directly:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  Include the <code class="literal">ACCOUNT LOCK</code> option
                  when you create the accounts. See
                  <a class="xref" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax">Section 13.7.1.3, “CREATE USER Syntax”</a>.
                </p></li><li class="listitem"><p>
                  Associate the accounts with the
                  <code class="literal">mysql_no_login</code> authentication
                  plugin. See
                  <a class="xref" href="security.html#no-login-pluggable-authentication" title="6.4.1.8 No-Login Pluggable Authentication">Section 6.4.1.8, “No-Login Pluggable Authentication”</a>.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              Grant the <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege
              to the proxy account for each proxied account:
            </p><pre data-lang="sql" class="programlisting">
GRANT PROXY
  ON 'developer'@'localhost'
  TO ''@'';
GRANT PROXY
  ON 'data_entry'@'localhost'
  TO ''@'';
</pre></li><li class="listitem"><p>
              Use the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> command-line client to
              connect to the MySQL server as <code class="literal">antonio</code>.
            </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=antonio --password --enable-cleartext-plugin</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>antonio_password</code></em></code></strong>
</pre><p>
              The server authenticates the connection using the
              <code class="literal">''@''</code> proxy account. The resulting
              privileges for <code class="literal">antonio</code> depend on which
              PAM groups <code class="literal">antonio</code> is a member of. If
              <code class="option">antonio</code> is a member of the
              <code class="literal">root</code> PAM group, the PAM plugin maps
              <code class="literal">root</code> to the
              <code class="literal">developer</code> MySQL user name and returns
              that name to the server. The server verifies that
              <code class="literal">''@''</code> has the
              <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for
              <code class="literal">developer</code> and permits the connection.
              The following query should return output as shown:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+---------------------+--------------+
| USER()            | CURRENT_USER()      | @@proxy_user |
+-------------------+---------------------+--------------+
| antonio@localhost | developer@localhost | ''@''        |
+-------------------+---------------------+--------------+
</pre><p>
              This demonstrates that the <code class="literal">antonio</code>
              operating system user is authenticated to have the
              privileges granted to the <code class="literal">developer</code>
              MySQL user, and that proxying occurred through the default
              proxy account.
            </p><p>
              If <code class="literal">antonio</code> is not a member of the
              <code class="literal">root</code> PAM group but is a member of the
              <code class="literal">users</code> PAM group, a similar process
              occurs, but the plugin maps <code class="literal">user</code> PAM
              group membership to the <code class="literal">data_entry</code>
              MySQL user name and returns that name to the server:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-------------------+----------------------+--------------+
| USER()            | CURRENT_USER()       | @@proxy_user |
+-------------------+----------------------+--------------+
| antonio@localhost | data_entry@localhost | ''@''        |
+-------------------+----------------------+--------------+
</pre><p>
              This demonstrates that the <code class="literal">antonio</code>
              operating system user is authenticated to have the
              privileges of the <code class="literal">data_entry</code> MySQL
              user, and that proxying occurred through the default proxy
              account.
</p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            The client-side <code class="literal">mysql_clear_password</code>
            authentication plugin leaves the password untouched, so
            client programs send it to the MySQL server as cleartext.
            This enables the password to be passed as is to PAM. A
            cleartext password is necessary to use the server-side PAM
            library, but may be a security problem in some
            configurations. These measures minimize the risk:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                To make inadvertent use of the
                <code class="literal">mysql_clear_password</code> plugin less
                likely, MySQL clients must explicitly enable it (for
                example, with the
                <code class="option">--enable-cleartext-plugin</code> option). See
                <a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 Client-Side Cleartext Pluggable Authentication">Section 6.4.1.4, “Client-Side Cleartext Pluggable Authentication”</a>.
              </p></li><li class="listitem"><p>
                To avoid password exposure with the
                <code class="literal">mysql_clear_password</code> plugin enabled,
                MySQL clients should connect to the MySQL server using
                an encrypted connection. See
                <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>.
</p></li></ul>
</div>

</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-authentication-unix-password-store"></a>PAM Authentication Access to Unix Password Store</h5>

</div>

</div>

</div>
<p>
          On some systems, Unix authentication uses a password store
          such as <code class="filename">/etc/shadow</code>, a file that
          typically has restricted access permissions. This can cause
          MySQL PAM-based authentication to fail. Unfortunately, the PAM
          implementation does not permit distinguishing <span class="quote">“<span class="quote">password
          could not be checked</span>”</span> (due, for example, to inability
          to read <code class="filename">/etc/shadow</code>) from <span class="quote">“<span class="quote">password
          does not match.</span>”</span> If you are using Unix password store
          for PAM authentication, you may be able to enable access to it
          from MySQL using one of the following methods:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Assuming that the MySQL server is run from the
              <code class="literal">mysql</code> operating system account, put
              that account in the <code class="literal">shadow</code> group that
              has <code class="filename">/etc/shadow</code> access:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                  Create a <code class="literal">shadow</code> group in
                  <code class="filename">/etc/group</code>.
                </p></li><li class="listitem"><p>
                  Add the <code class="literal">mysql</code> operating system user
                  to the <code class="literal">shadow</code> group in
                  <code class="filename">/etc/group</code>.
                </p></li><li class="listitem"><p>
                  Assign <code class="filename">/etc/group</code> to the
                  <code class="literal">shadow</code> group and enable the group
                  read permission:
                </p><pre data-lang="terminal" class="programlisting">
chgrp shadow /etc/shadow
chmod g+r /etc/shadow
</pre></li><li class="listitem"><p>
                  Restart the MySQL server.
</p></li></ol>
</div>
</li><li class="listitem"><p>
              If you are using the <code class="literal">pam_unix</code> module
              and the <span class="command"><strong>unix_chkpwd</strong></span> utility, enable
              password store access as follows:
            </p><pre data-lang="terminal" class="programlisting">
chmod u-s /usr/sbin/unix_chkpwd
setcap cap_dac_read_search+ep /usr/sbin/unix_chkpwd
</pre><p>
              Adjust the path to <span class="command"><strong>unix_chkpwd</strong></span> as
              necessary for your platform.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="pam-pluggable-authentication-debugging"></a>PAM Authentication Debugging</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091719602880"></a><a class="indexterm" name="idm140091719601776"></a><p>
          The PAM authentication plugin checks at initialization time
          whether the <code class="literal">AUTHENTICATION_PAM_LOG</code>
          environment value is set (the value does not matter). If so,
          the plugin enables logging of diagnostic messages to the
          standard output. These messages may be helpful for debugging
          PAM-related problems that occur when the plugin performs
          authentication.
        </p><p>
          Some messages include reference to PAM plugin source files and
          line numbers, which enables plugin actions to be tied more
          closely to the location in the code where they occur.
        </p><p>
          Another technique for debugging connection failures and
          determining what is happening during connection attempts is to
          configure PAM authentication to permit all connections, then
          check the system log files. This technique should be used only
          on a <span class="emphasis"><em>temporary</em></span> basis, and not on a
          production server.
        </p><p>
          Configure a PAM service file named
          <code class="filename">/etc/pam.d/mysql-any-password</code> with these
          contents (the format may differ on some systems):
        </p><pre data-lang="none" class="programlisting">
#%PAM-1.0
auth        required    pam_permit.so
account     required    pam_permit.so
</pre><p>
          Create an account that uses the PAM plugin and names the
          <code class="literal">mysql-any-password</code> PAM service:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'testuser'@'localhost'
  IDENTIFIED WITH authentication_pam
  AS 'mysql-any-password';
</pre><p>
          The <code class="literal">mysql-any-password</code> service file causes
          any authentication attempt to return true, even for incorrect
          passwords. If an authentication attempt fails, that tells you
          the configuration problem is on the MySQL side. Otherwise, the
          problem is on the operating system/PAM side. To see what might
          be happening, check system log files such as
          <code class="filename">/var/log/secure</code>,
          <code class="filename">/var/log/audit.log</code>,
          <code class="filename">/var/log/syslog</code>, or
          <code class="filename">/var/log/messages</code>.
        </p><p>
          After determining what the problem is, remove the
          <code class="filename">mysql-any-password</code> PAM service file to
          disable any-password access.
</p>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="windows-pluggable-authentication"></a>6.4.1.6 Windows Pluggable Authentication</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091719585456"></a><a class="indexterm" name="idm140091719584352"></a><a class="indexterm" name="idm140091719582864"></a><a class="indexterm" name="idm140091719581760"></a><a class="indexterm" name="idm140091719580256"></a><a class="indexterm" name="idm140091719578752"></a><a class="indexterm" name="idm140091719577248"></a><a class="indexterm" name="idm140091719576160"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Windows pluggable authentication is an extension included in
          MySQL Enterprise Edition, a commercial product. To learn more about commercial
          products, see <a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a>.
</p>
</div>
<p>
        MySQL Enterprise Edition for Windows supports an authentication method that
        performs external authentication on Windows, enabling MySQL
        Server to use native Windows services to authenticate client
        connections. Users who have logged in to Windows can connect
        from MySQL client programs to the server based on the
        information in their environment without specifying an
        additional password.
      </p><p>
        The client and server exchange data packets in the
        authentication handshake. As a result of this exchange, the
        server creates a security context object that represents the
        identity of the client in the Windows OS. This identity includes
        the name of the client account. Windows pluggable authentication
        uses the identity of the client to check whether it is a given
        account or a member of a group. By default, negotiation uses
        Kerberos to authenticate, then NTLM if Kerberos is unavailable.
      </p><p>
        Windows pluggable authentication provides these capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            External authentication: Windows authentication enables
            MySQL Server to accept connections from users defined
            outside the MySQL grant tables who have logged in to
            Windows.
          </p></li><li class="listitem"><p>
            Proxy user support: Windows authentication can return to
            MySQL a user name different from the external user name
            passed by the client program. This means that the plugin can
            return the MySQL user that defines the privileges the
            external Windows-authenticated user should have. For
            example, a Windows user named <code class="literal">joe</code> can
            connect and have the privileges of a MySQL user named
            <code class="literal">developer</code>.
</p></li></ul>
</div>
<p>
        The following table shows the plugin and library file names. The
        file must be located in the directory named by the
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable.
</p>
<div class="table">
<a name="idm140091719564992"></a><p class="title"><b>Table 6.18 Plugin and Library Names for Windows Authentication</b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for Windows password authentication."><col width="30%"><col width="70%"><thead><tr>
            <th scope="col">Plugin or File</th>
            <th scope="col">Plugin or File Name</th>
          </tr></thead><tbody><tr>
            <td scope="row">Server-side plugin</td>
            <td><code class="literal">authentication_windows</code></td>
          </tr><tr>
            <td scope="row">Client-side plugin</td>
            <td><code class="literal">authentication_windows_client</code></td>
          </tr><tr>
            <td scope="row">Library file</td>
            <td><code class="filename">authentication_windows.dll</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The library file includes only the server-side plugin. The
        client-side plugin is built into the
        <code class="literal">libmysqlclient</code> client library.
      </p><p>
        The server-side Windows authentication plugin is included only
        in MySQL Enterprise Edition. It is not included in MySQL community distributions.
        The client-side plugin is included in all distributions,
        including community distributions. This permits clients from any
        distribution to connect to a server that has the server-side
        plugin loaded.
      </p><p>
        The Windows authentication plugin is supported on any version of
        Windows supported by MySQL 8.0 (see
        <a class="ulink" href="https://www.mysql.com/support/supportedplatforms/database.html" target="_top">https://www.mysql.com/support/supportedplatforms/database.html</a>).
      </p><p>
        The following sections provide installation and usage
        information specific to Windows pluggable authentication:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#windows-pluggable-authentication-installation" title="Installing Windows Pluggable Authentication">Installing Windows Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#windows-pluggable-authentication-uninstallation" title="Uninstalling Windows Pluggable Authentication">Uninstalling Windows Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#windows-pluggable-authentication-usage" title="Using Windows Pluggable Authentication">Using Windows Pluggable Authentication</a></p></li></ul>
</div>
<p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>. For proxy user
        information, see <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="windows-pluggable-authentication-installation"></a>Installing Windows Pluggable Authentication</h5>
</div>
</div>
</div>
<p>
          This section describes how to install the Windows
          authentication plugin. For general information about
          installing plugins, see <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>.
        </p><p>
          To be usable by the server, the plugin library file must be
          located in the MySQL plugin directory (the directory named by
          the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
          variable). If necessary, configure the plugin directory
          location by setting the value of
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
        </p><p>
          To load the plugin at server startup, use the
          <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option to
          name the library file that contains it. With this
          plugin-loading method, the option must be given each time the
          server starts. For example, put these lines in the server
          <code class="filename">my.cnf</code> file:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
plugin-load-add=authentication_windows.dll
</pre><p>
          After modifying <code class="filename">my.cnf</code>, restart the
          server to cause the new settings to take effect.
        </p><p>
          Alternatively, to register the plugin at runtime, use this
          statement:
        </p><pre data-lang="sql" class="programlisting">
INSTALL PLUGIN authentication_windows SONAME 'authentication_windows.dll';
</pre><p>
          <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> loads the plugin
          immediately, and also registers it in the
          <code class="literal">mysql.plugins</code> system table to cause the
          server to load it for each subsequent normal startup.
        </p><p>
          To verify plugin installation, examine the
          <a class="link" href="information-schema.html#plugins-table" title="25.18 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table
          or use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.6.25 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>
          statement (see
          <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 Obtaining Server Plugin Information">Section 5.6.2, “Obtaining Server Plugin Information”</a>). For example:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%windows%';</code></strong>
+------------------------+---------------+
| PLUGIN_NAME            | PLUGIN_STATUS |
+------------------------+---------------+
| authentication_windows | ACTIVE        |
+------------------------+---------------+
</pre><p>
          If the plugin fails to initialize, check the server error log
          for diagnostic messages.
        </p><p>
          To associate MySQL accounts with the Windows authentication
          plugin, see
          <a class="xref" href="security.html#windows-pluggable-authentication-usage" title="Using Windows Pluggable Authentication">Using Windows Pluggable Authentication</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="windows-pluggable-authentication-uninstallation"></a>Uninstalling Windows Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          The method used to uninstall the Windows authentication plugin
          depends on how you installed it:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If you installed the plugin at server startup using a
              <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option,
              restart the server without the option.
            </p></li><li class="listitem"><p>
              If you installed the plugin at runtime using
              <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>, it remains
              installed across server restarts. To uninstall it, use
              <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a>:
            </p><pre data-lang="sql" class="programlisting">
UNINSTALL PLUGIN authentication_windows;
</pre></li></ul>
</div>
<p>
          In addition, remove any startup options that set Windows
          plugin-related system variables.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="windows-pluggable-authentication-usage"></a>Using Windows Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          The Windows authentication plugin supports the use of MySQL
          accounts such that users who have logged in to Windows can
          connect to the MySQL server without having to specify an
          additional password. It is assumed that the server is running
          with the server-side plugin enabled, as described in
          <a class="xref" href="security.html#windows-pluggable-authentication-installation" title="Installing Windows Pluggable Authentication">Installing Windows Pluggable Authentication</a>.
          Once the DBA has enabled the server-side plugin and set up
          accounts to use it, clients can connect using those accounts
          with no other setup required on their part.
        </p><p>
          To refer to the Windows authentication plugin in the
          <code class="literal">IDENTIFIED WITH</code> clause of a
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement, use the
          name <code class="literal">authentication_windows</code>. Suppose that
          the Windows users <code class="literal">Rafal</code> and
          <code class="literal">Tasha</code> should be permitted to connect to
          MySQL, as well as any users in the
          <code class="literal">Administrators</code> or <code class="literal">Power
          Users</code> group. To set this up, create a MySQL account
          named <code class="literal">sql_admin</code> that uses the Windows
          plugin for authentication:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal, Tasha, Administrators, "Power Users"';
</pre><p>
          The plugin name is <code class="literal">authentication_windows</code>.
          The string following the <code class="literal">AS</code> keyword is the
          authentication string. It specifies that the Windows users
          named <code class="literal">Rafal</code> or <code class="literal">Tasha</code> are
          permitted to authenticate to the server as the MySQL user
          <code class="literal">sql_admin</code>, as are any Windows users in the
          <code class="literal">Administrators</code> or <code class="literal">Power
          Users</code> group. The latter group name contains a space,
          so it must be quoted with double quote characters.
        </p><p>
          After you create the <code class="literal">sql_admin</code> account, a
          user who has logged in to Windows can attempt to connect to
          the server using that account:
        </p><pre data-lang="terminal" class="programlisting">
C:\&gt; <strong class="userinput"><code>mysql --user=sql_admin</code></strong>
</pre><p>
          No password is required here. The
          <code class="literal">authentication_windows</code> plugin uses the
          Windows security API to check which Windows user is
          connecting. If that user is named <code class="literal">Rafal</code> or
          <code class="literal">Tasha</code>, or is a member of the
          <code class="literal">Administrators</code> or <code class="literal">Power
          Users</code> group, the server grants access and the client
          is authenticated as <code class="literal">sql_admin</code> and has
          whatever privileges are granted to the
          <code class="literal">sql_admin</code> account. Otherwise, the server
          denies access.
        </p><p>
          Authentication string syntax for the Windows authentication
          plugin follows these rules:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The string consists of one or more user mappings separated
              by commas.
            </p></li><li class="listitem"><p>
              Each user mapping associates a Windows user or group name
              with a MySQL user name:
            </p><pre data-lang="none" class="programlisting">
<em class="replaceable"><code>win_user_or_group_name=mysql_user_name</code></em>
<em class="replaceable"><code>win_user_or_group_name</code></em>
</pre><p>
              For the latter syntax, with no
              <em class="replaceable"><code>mysql_user_name</code></em> value given,
              the implicit value is the MySQL user created by the
              <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement.
              Thus, these statements are equivalent:
            </p><pre data-lang="sql" class="programlisting">
CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal, Tasha, Administrators, "Power Users"';

CREATE USER sql_admin
  IDENTIFIED WITH authentication_windows
  AS 'Rafal=sql_admin, Tasha=sql_admin, Administrators=sql_admin,
      "Power Users"=sql_admin';
</pre></li><li class="listitem"><p>
              Each backslash (<code class="literal">'\'</code>) in a value must be
              doubled because backslash is the escape character in MySQL
              strings.
            </p></li><li class="listitem"><p>
              Leading and trailing spaces not inside double quotation
              marks are ignored.
            </p></li><li class="listitem"><p>
              Unquoted <em class="replaceable"><code>win_user_or_group_name</code></em>
              and <em class="replaceable"><code>mysql_user_name</code></em> values can
              contain anything except equal sign, comma, or space.
            </p></li><li class="listitem"><p>
              If a <em class="replaceable"><code>win_user_or_group_name</code></em> and
              or <em class="replaceable"><code>mysql_user_name</code></em> value is
              quoted with double quotation marks, everything between the
              quotation marks is part of the value. This is necessary,
              for example, if the name contains space characters. All
              characters within double quotes are legal except double
              quotation mark and backslash. To include either character,
              escape it with a backslash.
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>win_user_or_group_name</code></em> values
              use conventional syntax for Windows principals, either
              local or in a domain. Examples (note the doubling of
              backslashes):
            </p><pre data-lang="none" class="programlisting">
domain\\user
.\\user
domain\\group
.\\group
BUILTIN\\WellKnownGroup
</pre></li></ul>
</div>
<p>
          When invoked by the server to authenticate a client, the
          plugin scans the authentication string left to right for a
          user or group match to the Windows user. If there is a match,
          the plugin returns the corresponding
          <em class="replaceable"><code>mysql_user_name</code></em> to the MySQL
          server. If there is no match, authentication fails.
        </p><p>
          A user name match takes preference over a group name match.
          Suppose that the Windows user named
          <code class="literal">win_user</code> is a member of
          <code class="literal">win_group</code> and the authentication string
          looks like this:
        </p><pre data-lang="none" class="programlisting">
'win_group = sql_user1, win_user = sql_user2'
</pre><p>
          When <code class="literal">win_user</code> connects to the MySQL server,
          there is a match both to <code class="literal">win_group</code> and to
          <code class="literal">win_user</code>. The plugin authenticates the user
          as <code class="literal">sql_user2</code> because the more-specific user
          match takes precedence over the group match, even though the
          group is listed first in the authentication string.
        </p><p>
          Windows authentication always works for connections from the
          same computer on which the server is running. For
          cross-computer connections, both computers must be registered
          with Windows Active Directory. If they are in the same Windows
          domain, it is unnecessary to specify a domain name. It is also
          possible to permit connections from a different domain, as in
          this example:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER sql_accounting
  IDENTIFIED WITH authentication_windows
  AS 'SomeDomain\\Accounting';
</pre><p>
          Here <code class="literal">SomeDomain</code> is the name of the other
          domain. The backslash character is doubled because it is the
          MySQL escape character within strings.
        </p><a class="indexterm" name="idm140091719456496"></a><p>
          MySQL supports the concept of proxy users whereby a client can
          connect and authenticate to the MySQL server using one account
          but while connected has the privileges of another account (see
          <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>). Suppose that you want Windows
          users to connect using a single user name but be mapped based
          on their Windows user and group names onto specific MySQL
          accounts as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The <code class="literal">local_user</code> and
              <code class="literal">MyDomain\domain_user</code> local and domain
              Windows users should map to the
              <code class="literal">local_wlad</code> MySQL account.
            </p></li><li class="listitem"><p>
              Users in the <code class="literal">MyDomain\Developers</code> domain
              group should map to the <code class="literal">local_dev</code> MySQL
              account.
            </p></li><li class="listitem"><p>
              Local machine administrators should map to the
              <code class="literal">local_admin</code> MySQL account.
</p></li></ul>
</div>
<p>
          To set this up, create a proxy account for Windows users to
          connect to, and configure this account so that users and
          groups map to the appropriate MySQL accounts
          (<code class="literal">local_wlad</code>, <code class="literal">local_dev</code>,
          <code class="literal">local_admin</code>). In addition, grant the MySQL
          accounts the privileges appropriate to the operations they
          need to perform. The following instructions use
          <code class="literal">win_proxy</code> as the proxy account, and
          <code class="literal">local_wlad</code>, <code class="literal">local_dev</code>,
          and <code class="literal">local_admin</code> as the proxied accounts.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Create the proxy MySQL account:
            </p><pre data-lang="sql" class="programlisting">
CREATE USER win_proxy
  IDENTIFIED WITH  authentication_windows
  AS 'local_user = local_wlad,
      MyDomain\\domain_user = local_wlad,
      MyDomain\\Developers = local_dev,
      BUILTIN\\Administrators = local_admin';
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                If your MySQL installation has anonymous users, they
                might conflict with the default proxy user. For more
                information about this problem, and ways of dealing with
                it, see <a class="xref" href="security.html#proxy-users-conflicts" title="Default Proxy User and Anonymous User Conflicts">Default Proxy User and Anonymous User Conflicts</a>.
</p>
</div>
</li><li class="listitem"><p>
              For proxying to work, the proxied accounts must exist, so
              create them:
            </p><pre data-lang="sql" class="programlisting">
CREATE USER local_wlad IDENTIFIED BY 'wlad_pass';
CREATE USER local_dev IDENTIFIED BY 'dev_pass';
CREATE USER local_admin IDENTIFIED BY  'admin_pass';
</pre><p>
              If you do not let anyone know the passwords for these
              accounts, other users cannot use them to connect directly
              to the MySQL server.
            </p><p>
              You should also issue <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>
              statements (not shown) that grant each proxied account the
              privileges it needs.
            </p></li><li class="listitem"><p>
              The proxy account must have the
              <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege for each
              proxied account:
            </p><pre data-lang="sql" class="programlisting">
GRANT PROXY ON local_wlad TO win_proxy;
GRANT PROXY ON local_dev TO win_proxy;
GRANT PROXY ON local_admin TO win_proxy;
</pre></li></ol>
</div>
<p>
          Now the Windows users <code class="literal">local_user</code> and
          <code class="literal">MyDomain\domain_user</code> can connect to the
          MySQL server as <code class="literal">win_proxy</code> and when
          authenticated have the privileges of the account given in the
          authentication string—in this case,
          <code class="literal">local_wlad</code>. A user in the
          <code class="literal">MyDomain\Developers</code> group who connects as
          <code class="literal">win_proxy</code> has the privileges of the
          <code class="literal">local_dev</code> account. A user in the
          <code class="literal">BUILTIN\Administrators</code> group has the
          privileges of the <code class="literal">local_admin</code> account.
        </p><p>
          To configure authentication so that all Windows users who do
          not have their own MySQL account go through a proxy account,
          substitute the default proxy user (<code class="literal">''@''</code>)
          for <code class="literal">win_proxy</code> in the preceding
          instructions. For information about the default proxy user,
          see <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>.
        </p><p>
          To use the Windows authentication plugin with Connector/NET
          connection strings in Connector/NET 6.4.4 and higher, see
          <a class="ulink" href="https://dev.mysql.com/doc/connector-net/en/connector-net-programming-authentication-windows-native.html" target="_top">Using the Windows Native Authentication Plugin</a>.
        </p><p>
          Additional control over the Windows authentication plugin is
          provided by the
          <a class="link" href="server-administration.html#sysvar_authentication_windows_use_principal_name"><code class="literal">authentication_windows_use_principal_name</code></a>
          and
          <a class="link" href="server-administration.html#sysvar_authentication_windows_log_level"><code class="literal">authentication_windows_log_level</code></a>
          system variables. See
          <a class="xref" href="server-administration.html#server-system-variables" title="5.1.8 Server System Variables">Section 5.1.8, “Server System Variables”</a>.
</p>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="ldap-pluggable-authentication"></a>6.4.1.7 LDAP Pluggable Authentication</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091719411568"></a><a class="indexterm" name="idm140091719410064"></a><a class="indexterm" name="idm140091719408560"></a><a class="indexterm" name="idm140091719407056"></a><a class="indexterm" name="idm140091719405568"></a><a class="indexterm" name="idm140091719404480"></a><a class="indexterm" name="idm140091719402976"></a><a class="indexterm" name="idm140091719401488"></a><a class="indexterm" name="idm140091719400000"></a><a class="indexterm" name="idm140091719398512"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          LDAP pluggable authentication is an extension included in
          MySQL Enterprise Edition, a commercial product. To learn more about commercial
          products, see <a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a>.
</p>
</div>
<p>
        MySQL Enterprise Edition supports an authentication method that enables MySQL
        Server to use LDAP (Lightweight Directory Access Protocol) to
        authenticate MySQL users by accessing directory services such as
        X.500. MySQL uses LDAP to fetch user, credential, and group
        information.
      </p><p>
        LDAP pluggable authentication provides these capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            External authentication: LDAP authentication enables MySQL
            Server to accept connections from users defined outside the
            MySQL grant tables in LDAP directories.
          </p></li><li class="listitem"><p>
            Proxy user support: LDAP authentication can return to MySQL
            a user name different from the external user name passed by
            the client program, based on the LDAP groups the external
            user is a member of. This means that an LDAP plugin can
            return the MySQL user that defines the privileges the
            external LDAP-authenticated user should have. For example,
            an LDAP user named <code class="literal">joe</code> can connect and
            have the privileges of a MySQL user named
            <code class="literal">developer</code>, if the LDAP group for
            <code class="literal">joe</code> is <code class="literal">developer</code>.
          </p></li><li class="listitem"><p>
            Security: Using TLS, connections to the LDAP server can be
            secure.
</p></li></ul>
</div>
<p>
        The following table shows the plugin and library file names. The
        file name suffix might differ on your system. The files must be
        located in the directory named by the
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable.
</p>
<div class="table">
<a name="idm140091719386048"></a><p class="title"><b>Table 6.19 Plugin and Library Names for LDAP Authentication</b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for LDAP password authentication."><col width="30%"><col width="70%"><thead><tr>
            <th scope="col">Plugin or File</th>
            <th scope="col">Plugin or File Name</th>
          </tr></thead><tbody><tr>
            <td scope="row">Server-side plugin names</td>
            <td><code class="literal">authentication_ldap_sasl</code>,
              <code class="literal">authentication_ldap_simple</code></td>
          </tr><tr>
            <td scope="row">Client-side plugin names</td>
            <td><code class="literal">authentication_ldap_sasl_client</code>,
              <code class="literal">mysql_clear_password</code></td>
          </tr><tr>
            <td scope="row">Library file names</td>
            <td><code class="filename">authentication_ldap_sasl.so</code>,
              <code class="filename">authentication_ldap_sasl_client.so</code>,
              <code class="filename">authentication_ldap_simple.so</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The library files include only the
        <code class="literal">authentication_ldap_<em class="replaceable"><code>XXX</code></em></code>
        authentication plugins. The client-side
        <code class="literal">mysql_clear_password</code> plugin is built into the
        <code class="literal">libmysqlclient</code> client library.
      </p><p>
        The two server-side LDAP plugins each work with a specific
        client-side plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The server-side
            <code class="literal">authentication_ldap_simple</code> plugin
            performs simple LDAP authentication. For connections by
            accounts that use this plugin, client programs use the
            client-side <code class="literal">mysql_clear_password</code> plugin,
            which sends the password to the server as cleartext. No
            password hashing or encryption is used, so a secure
            connection between the MySQL client and server is
            recommended to prevent password exposure.
          </p></li><li class="listitem"><p>
            The server-side <code class="literal">authentication_ldap_sasl</code>
            plugin performs SASL-based LDAP authentication. For
            connections by accounts that use this plugin, client
            programs use the client-side
            <code class="literal">authentication_ldap_sasl_client</code> plugin.
            The client-side and server-side SASL LDAP plugins use SASL
            messages for secure transmission of credentials within the
            LDAP protocol, to avoid sending the cleartext password
            between the MySQL client and server.
</p></li></ul>
</div>
<p>
        The following sections provide installation and usage
        information specific to LDAP pluggable authentication:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-prerequisites" title="Prerequisites for LDAP Pluggable Authentication">Prerequisites for LDAP Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-how-it-works" title="How LDAP Authentication of MySQL Users Works">How LDAP Authentication of MySQL Users Works</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-installation" title="Installing LDAP Pluggable Authentication">Installing LDAP Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-uninstallation" title="Uninstalling LDAP Pluggable Authentication">Uninstalling LDAP Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage" title="Using LDAP Pluggable Authentication">Using LDAP Pluggable Authentication</a></p></li></ul>
</div>
<p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>. For information
        about the <code class="literal">mysql_clear_password</code> plugin, see
        <a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 Client-Side Cleartext Pluggable Authentication">Section 6.4.1.4, “Client-Side Cleartext Pluggable Authentication”</a>. For proxy
        user information, see <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          If your system supports PAM and permits LDAP as a PAM
          authentication method, another way to use LDAP for MySQL user
          authentication is to use the server-side
          <code class="literal">authentication_pam</code> plugin. See
          <a class="xref" href="security.html#pam-pluggable-authentication" title="6.4.1.5 PAM Pluggable Authentication">Section 6.4.1.5, “PAM Pluggable Authentication”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="ldap-pluggable-authentication-prerequisites"></a>Prerequisites for LDAP Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          To use LDAP pluggable authentication for MySQL, these
          prerequisites must be satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              An LDAP server must be available for the LDAP
              authentication plugins to communicate with.
            </p></li><li class="listitem"><p>
              LDAP users to be authenticated by MySQL must be present in
              the directory managed by the LDAP server.
            </p></li><li class="listitem"><p>
              An LDAP client library must be available on systems where
              the server-side
              <code class="literal">authentication_ldap_sasl</code> or
              <code class="literal">authentication_ldap_simple</code> plugin is
              used. Currently, supported libraries are the Windows
              native LDAP library, or the OpenLDAP library on
              non-Windows systems.
            </p></li><li class="listitem"><p>
              To use SASL-based LDAP authentication:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  The LDAP server must be configured to communicate with
                  a SASL server.
                </p></li><li class="listitem"><p>
                  A SASL client library must be is available on systems
                  where the client-side
                  <code class="literal">authentication_ldap_sasl_client</code>
                  plugin is used. Currently, the only supported library
                  is the Cyrus SASL library.
</p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="ldap-pluggable-authentication-how-it-works"></a>How LDAP Authentication of MySQL Users Works</h5>

</div>

</div>

</div>
<p>
          This section provides a general overview of how MySQL and LDAP
          work together to authenticate MySQL users. For examples
          showing how to set up MySQL accounts to use specific LDAP
          authentication plugins, see
          <a class="xref" href="security.html#ldap-pluggable-authentication-usage" title="Using LDAP Pluggable Authentication">Using LDAP Pluggable Authentication</a>.
        </p><p>
          The client connects to the MySQL server, providing the MySQL
          client user name and the LDAP password:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              For simple LDAP authentication, the client-side and
              server-side plugins communicate the password as cleartext.
            </p></li><li class="listitem"><p>
              For SASL-based LDAP authentication, the client-side and
              server-side plugins use SASL messages for secure
              transmission of credentials within the LDAP protocol, to
              avoid sending the cleartext password between the MySQL
              client and server.
</p></li></ul>
</div>
<p>
          If the client user name and host name match no MySQL account,
          the connection is rejected.
        </p><p>
          If there is a matching MySQL account, authentication against
          LDAP occurs. The LDAP server looks for an entry matching the
          user and authenticates the entry against the LDAP password:
</p><a class="indexterm" name="idm140091719330080"></a><a class="indexterm" name="idm140091719328624"></a>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the MySQL account names an the LDAP user distinguished
              name (DN), LDAP authentication uses that value and the
              LDAP password provided by the client. (To associate an
              LDAP user DN with a MySQL account, include a
              <code class="literal">BY</code> clause that specifies an
              authentication string in the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE
              USER</code></a> statement that creates the account.)
            </p></li><li class="listitem"><p>
              If the MySQL account names no LDAP user DN, LDAP
              authentication uses the user name and LDAP password
              provided by the client. In this case, the authentication
              plugin first binds to the LDAP server using the root DN
              and password as credentials to find the user DN based on
              the client user name, then authenticates that user DN
              against the LDAP password. This bind using the root
              credentials fails if the root DN and password are set to
              incorrect values, or are empty (not set) and the LDAP
              server does not permit anonymous connections.
</p></li></ul>
</div>
<p>
          If the LDAP server finds no match or multiple matches,
          authentication fails and the client connection is rejected.
        </p><p>
          If the LDAP server finds a single match, LDAP authentication
          succeeds (assuming that the password is correct), the LDAP
          server returns the LDAP entry, and the authentication plugin
          determines the name of the authenticated user based on that
          entry:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the LDAP entry has a group attribute (by default, the
              <code class="literal">cn</code> attribute), the plugin returns its
              value as the authenticated user name.
            </p></li><li class="listitem"><p>
              If the LDAP entry has no group attribute, the
              authentication plugin returns the client user name as the
              authenticated user name.
</p></li></ul>
</div>
<p>
          The MySQL server compares the client user name with the
          authenticated user name to determine whether proxying occurs
          for the client session:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the names are the same, no proxying occurs: The MySQL
              account matching the client user name is used for
              privilege checking.
            </p></li><li class="listitem"><p>
              If the names differ, proxying occurs: MySQL looks for an
              account matching the authenticated user name. That account
              becomes the proxied user, which is used for privilege
              checking. The MySQL account that matched the client user
              name is treated as the external proxy user.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="ldap-pluggable-authentication-installation"></a>Installing LDAP Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          This section describes how to install the LDAP authentication
          plugins. For general information about installing plugins, see
          <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>.
        </p><p>
          To be usable by the server, the plugin library files must be
          located in the MySQL plugin directory (the directory named by
          the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
          variable). If necessary, configure the plugin directory
          location by setting the value of
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
        </p><p>
          The server-side plugin library file base names are
          <code class="literal">authentication_ldap_sasl</code> and
          <code class="literal">authentication_ldap_simple</code>. The file name
          suffix differs per platform (for example,
          <code class="filename">.so</code> for Unix and Unix-like systems,
          <code class="filename">.dll</code> for Windows).
        </p><p>
          To load the plugins at server startup, use
          <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> options to
          name the library files that contain them. With this
          plugin-loading method, the options must be given each time the
          server starts. Also, specify values for any plugin-provided
          system variables you wish to configure.
        </p><p>
          Each server-side LDAP plugin exposes a set of system variables
          that enable its operation to be configured. Setting most of
          these is optional, but you must set the variables that specify
          the LDAP server host (so the plugin knows where to connect)
          and base distinguished name for LDAP bind operations (to limit
          the scope of searches and obtain faster searches). For details
          about all LDAP system variables, see
          <a class="xref" href="security.html#pluggable-authentication-system-variables" title="6.4.1.11 Pluggable Authentication System Variables">Section 6.4.1.11, “Pluggable Authentication System Variables”</a>.
        </p><p>
          To load the plugins and set the LDAP server host and base
          distinguished name for LDAP bind operations, put lines such as
          these in your <code class="filename">my.cnf</code> file (adjust the
          <code class="filename">.so</code> suffix for your platform as
          necessary):
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
plugin-load-add=authentication_ldap_sasl.so
authentication_ldap_sasl_server_host=127.0.0.1
authentication_ldap_sasl_bind_base_dn="dc=example,dc=com"
plugin-load-add=authentication_ldap_simple.so
authentication_ldap_simple_server_host=127.0.0.1
authentication_ldap_simple_bind_base_dn="dc=example,dc=com"
</pre><p>
          After modifying <code class="filename">my.cnf</code>, restart the
          server to cause the new settings to take effect.
        </p><p>
          Alternatively, to register the plugins at runtime, use these
          statements (adjust the <code class="filename">.so</code> suffix as
          necessary):
        </p><pre data-lang="sql" class="programlisting">
INSTALL PLUGIN authentication_ldap_sasl
  SONAME 'authentication_ldap_sasl.so';
INSTALL PLUGIN authentication_ldap_simple
  SONAME 'authentication_ldap_simple.so';
</pre><p>
          <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> loads the plugin
          immediately, and also registers it in the
          <code class="literal">mysql.plugins</code> system table to cause the
          server to load it for each subsequent normal startup.
        </p><p>
          After installing the plugins at runtime, their system
          variables become available and you can add settings for them
          to your <code class="filename">my.cnf</code> file to configure the
          plugins for subsequent restarts. For example:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
authentication_ldap_sasl_server_host=127.0.0.1
authentication_ldap_sasl_bind_base_dn="dc=example,dc=com"
authentication_ldap_simple_server_host=127.0.0.1
authentication_ldap_simple_bind_base_dn="dc=example,dc=com"
</pre><p>
          After modifying <code class="filename">my.cnf</code>, restart the
          server to cause the new settings to take effect.
        </p><p>
          Alternatively, to set and persist the values at runtime, use
          these statements:
        </p><pre data-lang="sql" class="programlisting">
SET PERSIST authentication_ldap_sasl_server_host='127.0.0.1';
SET PERSIST authentication_ldap_sasl_bind_base_dn='dc=example,dc=com';
SET PERSIST authentication_ldap_simple_server_host='127.0.0.1';
SET PERSIST authentication_ldap_simple_bind_base_dn='dc=example,dc=com';
</pre><p>
          <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
          PERSIST</code></a> sets the value for the running MySQL
          instance. It also saves the value, causing it to be used for
          subsequent server restarts. To change a value for the running
          MySQL instance without saving it for subsequent restarts, use
          the <code class="literal">GLOBAL</code> keyword rather than
          <code class="literal">PERSIST</code>. See
          <a class="xref" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment">Section 13.7.5.1, “SET Syntax for Variable Assignment”</a>.
        </p><p>
          To verify plugin installation, examine the
          <a class="link" href="information-schema.html#plugins-table" title="25.18 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table
          or use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.6.25 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>
          statement (see
          <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 Obtaining Server Plugin Information">Section 5.6.2, “Obtaining Server Plugin Information”</a>). For example:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%ldap%';</code></strong>
+----------------------------+---------------+
| PLUGIN_NAME                | PLUGIN_STATUS |
+----------------------------+---------------+
| authentication_ldap_sasl   | ACTIVE        |
| authentication_ldap_simple | ACTIVE        |
+----------------------------+---------------+
</pre><p>
          If a plugin fails to initialize, check the server error log
          for diagnostic messages.
        </p><p>
          To associate MySQL accounts with an LDAP plugin, see
          <a class="xref" href="security.html#ldap-pluggable-authentication-usage" title="Using LDAP Pluggable Authentication">Using LDAP Pluggable Authentication</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Additional Notes for SELinux
</div>
<a class="indexterm" name="idm140091719274128"></a><p>
            On systems running EL6 or EL that have SELinux enabled,
            changes to the SELinux policy are required to enable the
            MySQL LDAP plugins to communicate with the LDAP service:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                Create a file <code class="filename">mysqlldap.te</code> with
                these contents:
              </p><pre data-lang="simple" class="programlisting">
module mysqlldap 1.0;

require {
        type ldap_port_t;
        type mysqld_t;
        class tcp_socket name_connect;
}

#============= mysqld_t ==============

allow mysqld_t ldap_port_t:tcp_socket name_connect;
</pre></li><li class="listitem"><p>
                Compile the security policy module into a binary
                representation:
              </p><pre data-lang="terminal" class="programlisting">
checkmodule -M -m mysqlldap.te -o mysqlldap.mod
</pre></li><li class="listitem"><p>
                Create an SELinux policy module package:
              </p><pre data-lang="terminal" class="programlisting">
semodule_package -m mysqlldap.mod  -o mysqlldap.pp
</pre></li><li class="listitem"><p>
                Install the module package:
              </p><pre data-lang="terminal" class="programlisting">
semodule -i mysqlldap.pp
</pre></li><li class="listitem"><p>
                When the SELinux policy changes has been made, restart
                the MySQL server:
              </p><pre data-lang="terminal" class="programlisting">
service mysqld restart
</pre></li></ol>
</div>

</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="ldap-pluggable-authentication-uninstallation"></a>Uninstalling LDAP Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          The method used to uninstall the LDAP authentication plugins
          depends on how you installed them:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If you installed the plugins at server startup using
              <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> options,
              restart the server without those options.
            </p></li><li class="listitem"><p>
              If you installed the plugins at runtime using
              <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>, they remain
              installed across server restarts. To uninstall them, use
              <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a>:
            </p><pre data-lang="sql" class="programlisting">
UNINSTALL PLUGIN authentication_ldap_sasl;
UNINSTALL PLUGIN authentication_ldap_simple;
</pre></li></ul>
</div>
<p>
          In addition, remove from your <code class="filename">my.cnf</code> file
          any startup options that set LDAP plugin-related system
          variables. If you used
          <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
          PERSIST</code></a> to persist LDAP system variables, use
          <a class="link" href="sql-syntax.html#reset-persist" title="13.7.7.7 RESET PERSIST Syntax"><code class="literal">RESET PERSIST</code></a> to remove the
          settings.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="ldap-pluggable-authentication-usage"></a>Using LDAP Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          This section describes how to enable MySQL accounts to connect
          to the MySQL server using LDAP pluggable authentication. It is
          assumed that the server is running with the appropriate
          server-side plugins enabled, as described in
          <a class="xref" href="security.html#ldap-pluggable-authentication-installation" title="Installing LDAP Pluggable Authentication">Installing LDAP Pluggable Authentication</a>,
          and that the appropriate client-side plugins are available on
          the client host.
        </p><p>
          This section does not describe LDAP configuration or
          administration. It is assumed that you are familiar with those
          topics.
        </p><p>
          The two server-side LDAP plugins each work with a specific
          client-side plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The server-side
              <code class="literal">authentication_ldap_simple</code> plugin
              performs simple LDAP authentication. For connections by
              accounts that use this plugin, client programs use the
              client-side <code class="literal">mysql_clear_password</code>
              plugin, which sends the password to the server as
              cleartext. No password hashing or encryption is used, so a
              secure connection between the MySQL client and server is
              recommended to prevent password exposure.
            </p></li><li class="listitem"><p>
              The server-side
              <code class="literal">authentication_ldap_sasl</code> plugin
              performs SASL-based LDAP authentication. For connections
              by accounts that use this plugin, client programs use the
              client-side
              <code class="literal">authentication_ldap_sasl_client</code> plugin.
              The client-side and server-side SASL LDAP plugins use SASL
              messages for secure transmission of credentials within the
              LDAP protocol, to avoid sending the cleartext password
              between the MySQL client and server.
</p></li></ul>
</div>
<p>
          Overall requirements for LDAP authentication of MySQL users:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              There must be an LDAP directory entry for each user to be
              authenticated.
            </p></li><li class="listitem"><p>
              There must be a MySQL user account that specifies a
              server-side LDAP authentication plugin and optionally
              names the associated LDAP user distinguished name (DN).
              (To associate an LDAP user DN with a MySQL account,
              include a <code class="literal">BY</code> clause in the
              <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement that
              creates the account.) If an account names no LDAP string,
              LDAP authentication uses the user name specified by the
              client to find the LDAP entry.
            </p></li><li class="listitem"><p>
              Client programs connect using the connection method
              appropriate for the server-side authentication plugin the
              MySQL account uses. For LDAP authentication, connections
              require the MySQL user name and LDAP password. In
              addition, for accounts that use the server-side
              <code class="literal">authentication_ldap_simple</code> plugin,
              invoke client programs with the
              <code class="option">--enable-cleartext-plugin</code> option to
              enable the client-side
              <code class="literal">mysql_clear_password</code> plugin.
</p></li></ul>
</div>
<p>
          The instructions here assume the following scenario:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              MySQL users <code class="literal">betsy</code> and
              <code class="literal">boris</code> authenticate to the LDAP entries
              for <code class="literal">betsy_ldap</code> and
              <code class="literal">boris_ldap</code>, respectively. (It is not
              necessary that the MySQL and LDAP user names differ. The
              use of different names in this discussion helps clarify
              whether an operation context is MySQL or LDAP.)
            </p></li><li class="listitem"><p>
              LDAP entries use the <code class="literal">uid</code> attribute to
              specify user names. This may vary depending on LDAP
              server. Some LDAP servers use the <code class="literal">cn</code>
              attribute for user names rather than
              <code class="literal">uid</code>. To change the attribute, modify
              the
              <a class="link" href="security.html#sysvar_authentication_ldap_simple_user_search_attr"><code class="literal">authentication_ldap_simple_user_search_attr</code></a>
              or
              <a class="link" href="security.html#sysvar_authentication_ldap_sasl_user_search_attr"><code class="literal">authentication_ldap_sasl_user_search_attr</code></a>
              system variable appropriately.
            </p></li><li class="listitem"><p>
              These LDAP entries are available in the directory managed
              by the LDAP server, to provide distinguished name values
              that uniquely identify each user:
            </p><pre data-lang="ini" class="programlisting">
uid=betsy_ldap,ou=People,dc=example,dc=com
uid=boris_ldap,ou=People,dc=example,dc=com
</pre></li><li class="listitem"><p>
              <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statements that
              create MySQL accounts name an LDAP user in the
              <code class="literal">BY</code> clause, to indicate which LDAP entry
              the MySQL account authenticates against.
</p></li></ul>
</div>
<p>
          The instructions for setting up an account that uses LDAP
          authentication depend on which server-side LDAP plugin is
          used.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage-simple" title="Simple LDAP Authentication">Simple LDAP Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage-sasl" title="SASL-Based LDAP Authentication">SASL-Based LDAP Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage-user-dn-suffix" title="LDAP Authentication User DN Suffixes">LDAP Authentication User DN Suffixes</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage-proxying" title="LDAP Authentication with Proxying">LDAP Authentication with Proxying</a></p></li><li class="listitem"><p><a class="xref" href="security.html#ldap-pluggable-authentication-usage-group-mapping" title="LDAP Authentication Group Preference and Mapping Specification">LDAP Authentication Group Preference and Mapping Specification</a></p></li></ul>
</div>
<h6><a name="ldap-pluggable-authentication-usage-simple"></a>Simple LDAP Authentication</h6><p>
          To configure a MySQL account for simple LDAP authentication,
          the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement
          specifies the <code class="literal">authentication_ldap_simple</code>
          plugin, and optionally names the LDAP user distinguished name
          (DN):
        </p><pre data-lang="sql" class="programlisting">
CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_ldap_simple
  [BY '<em class="replaceable"><code>LDAP user DN</code></em>'];
</pre><p>
          Suppose that a MySQL user <code class="literal">betsy</code> has this
          entry in the LDAP directory:
        </p><pre data-lang="ini" class="programlisting">
uid=betsy_ldap,ou=People,dc=example,dc=com
</pre><p>
          Then the statement to create the MySQL account for
          <code class="literal">betsy</code> looks like this:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'betsy'@'localhost'
  IDENTIFIED WITH authentication_ldap_simple
  BY 'uid=betsy_ldap,ou=People,dc=example,dc=com';
</pre><p>
          The authentication string specified in the
          <code class="literal">BY</code> clause does not include the LDAP
          password. That must be provided by the client user at connect
          time.
        </p><p>
          Clients connect to the MySQL server by providing the MySQL
          user name and LDAP password, and by enabling the client-side
          <code class="literal">mysql_clear_password</code> plugin:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=betsy --password --enable-cleartext-plugin</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>betsy_password</code></em></code></strong> <em class="replaceable"><code>(betsy_ldap LDAP password)</code></em>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            The client-side <code class="literal">mysql_clear_password</code>
            authentication plugin leaves the password untouched, so
            client programs send it to the MySQL server as cleartext.
            This enables the password to be passed as is to the LDAP
            server. A cleartext password is necessary to use the
            server-side LDAP library without SASL, but may be a security
            problem in some configurations. These measures minimize the
            risk:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                To make inadvertent use of the
                <code class="literal">mysql_clear_password</code> plugin less
                likely, MySQL clients must explicitly enable it (for
                example, with the
                <code class="option">--enable-cleartext-plugin</code> option). See
                <a class="xref" href="security.html#cleartext-pluggable-authentication" title="6.4.1.4 Client-Side Cleartext Pluggable Authentication">Section 6.4.1.4, “Client-Side Cleartext Pluggable Authentication”</a>.
              </p></li><li class="listitem"><p>
                To avoid password exposure with the
                <code class="literal">mysql_clear_password</code> plugin enabled,
                MySQL clients should connect to the MySQL server using
                an encrypted connection. See
                <a class="xref" href="security.html#using-encrypted-connections" title="6.3.1 Configuring MySQL to Use Encrypted Connections">Section 6.3.1, “Configuring MySQL to Use Encrypted Connections”</a>.
</p></li></ul>
</div>

</div>
<p>
          The authentication process occurs as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              The client-side plugin sends <code class="literal">betsy</code> and
              <em class="replaceable"><code>betsy_password</code></em> as the client
              user name and LDAP password to the MySQL server.
            </p></li><li class="listitem"><p>
              The connection attempt matches the
              <code class="literal">'betsy'@'localhost'</code> account. The
              server-side LDAP plugin finds that this account has an
              authentication string of
              <code class="literal">'uid=betsy_ldap,ou=People,dc=example,dc=com'</code>
              to name the LDAP user DN. The plugin sends this string and
              the LDAP password to the LDAP server.
            </p></li><li class="listitem"><p>
              The LDAP server finds the LDAP entry for
              <code class="literal">betsy_ldap</code> and the password matches, so
              LDAP authentication succeeds.
            </p></li><li class="listitem"><p>
              The LDAP entry has no group attribute, so the server-side
              plugin returns the client user name
              (<code class="literal">betsy</code>) as the authenticated user. This
              is the same user name supplied by the client, so no
              proxying occurs and the client session uses the
              <code class="literal">'betsy'@'localhost'</code> account for
              privilege checking.
</p></li></ol>
</div>
<p>
          Had the matching LDAP entry contained a group attribute, that
          attribute value would have been the authenticated user name
          and, if the value differed from <code class="literal">betsy</code>,
          proxying would have occurred. For examples that use the group
          attribute, see
          <a class="xref" href="security.html#ldap-pluggable-authentication-usage-proxying" title="LDAP Authentication with Proxying">LDAP Authentication with Proxying</a>.
        </p><p>
          Had the <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement
          contained no <code class="literal">BY</code> clause to specify the
          <code class="literal">betsy_ldap</code> LDAP distinguished name,
          authentication attempts would use the user name provided by
          the client (in this case, <code class="literal">betsy</code>). In the
          absence of an LDAP entry for <code class="literal">betsy</code>,
          authentication would fail.
        </p><h6><a name="ldap-pluggable-authentication-usage-sasl"></a>SASL-Based LDAP Authentication</h6><p>
          To configure a MySQL account for SASL LDAP authentication, the
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement specifies
          the <code class="literal">authentication_ldap_sasl</code> plugin, and
          optionally names the LDAP user distinguished name (DN):
        </p><pre data-lang="sql" class="programlisting">
CREATE USER <em class="replaceable"><code>user</code></em>
  IDENTIFIED WITH authentication_ldap_sasl
  [BY '<em class="replaceable"><code>LDAP user DN</code></em>'];
</pre><p>
          Suppose that a MySQL user <code class="literal">boris</code> has this
          entry in the LDAP directory:
        </p><pre data-lang="ini" class="programlisting">
uid=boris_ldap,ou=People,dc=example,dc=com
</pre><p>
          Then the statement to create the MySQL account for
          <code class="literal">boris</code> looks like this:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'boris'@'localhost'
  IDENTIFIED WITH authentication_ldap_sasl
  BY 'uid=boris_ldap,ou=People,dc=example,dc=com';
</pre><p>
          The authentication string specified in the
          <code class="literal">BY</code> clause does not include the LDAP
          password. That must be provided by the client user at connect
          time.
        </p><p>
          Clients connect to the MySQL server by providing the MySQL
          user name and LDAP password:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=boris --password</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>boris_password</code></em></code></strong> <em class="replaceable"><code>(boris_ldap LDAP password)</code></em>
</pre><p>
          For the server-side
          <code class="literal">authentication_ldap_sasl</code> plugin, clients
          use the client-side
          <code class="literal">authentication_ldap_sasl_client</code> plugin. If
          a client program does not find the client-side plugin, specify
          a <code class="option">--plugin-dir</code> option that names the
          directory where the plugin library file is installed.
        </p><p>
          The authentication process for <code class="literal">boris</code> is
          similar to that previously described for
          <code class="literal">betsy</code> with simple LDAP authentication,
          except that the client-side and server-side SASL LDAP plugins
          use SASL messages for secure transmission of credentials
          within the LDAP protocol, to avoid sending the cleartext
          password between the MySQL client and server.
        </p><h6><a name="ldap-pluggable-authentication-usage-user-dn-suffix"></a>LDAP Authentication User DN Suffixes</h6><p>
          LDAP authentication plugins permit the authentication string
          that provides user DN information to begin with a
          <code class="literal">+</code> prefix character:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              In the absence of a <code class="literal">+</code> character, the
              authentication string value is treated as is without
              modification.
            </p></li><li class="listitem"><p>
              If the authentication string begins with
              <code class="literal">+</code>, the plugin constructs the full user
              DN value from the user name sent by the client, together
              with the DN specified in the authentication string (with
              the <code class="literal">+</code> removed). In the constructed DN,
              the client user name becomes the value of the attribute
              that specifies LDAP user names. This is
              <code class="literal">uid</code> by default; to change the
              attribute, modify the
              <a class="link" href="security.html#sysvar_authentication_ldap_simple_user_search_attr"><code class="literal">authentication_ldap_simple_user_search_attr</code></a>
              or
              <a class="link" href="security.html#sysvar_authentication_ldap_sasl_user_search_attr"><code class="literal">authentication_ldap_sasl_user_search_attr</code></a>
              system variable appropriately. The authentication string
              is stored as given in the <code class="literal">mysql.user</code>
              system table, with the full user DN constructed on the fly
              before authentication.
</p></li></ul>
</div>
<p>
          This account authentication string does not have
          <code class="literal">+</code> at the beginning, so it is taken as the
          full user DN:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'baldwin'
  IDENTIFIED WITH authentication_ldap_simple
  BY 'uid=admin,ou=People,dc=example,dc=com';
</pre><p>
          The client connects with the user name specified in the
          account (<code class="literal">baldwin</code>). In this case, that name
          is not used because the authentication string has no prefix
          and thus fully specifies the user DN.
        </p><p>
          This account authentication string does have
          <code class="literal">+</code> at the beginning, so it is taken as just
          part of the user DN:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'accounting'
  IDENTIFIED WITH authentication_ldap_simple
  BY '+ou=People,dc=example,dc=com';
</pre><p>
          The client connects with the user name specified in the
          account (<code class="literal">accounting</code>), which in this case is
          used as the <code class="literal">uid</code> attribute together with the
          authentication string to construct the user DN:
          <code class="literal">uid=accounting,ou=People,dc=example,dc=com</code>
        </p><p>
          The accounts in the preceding examples have a nonempty user
          name, so the client always connects to the MySQL server using
          the same name as specified in the account definition. If an
          account has an empty user name, such as the generic anonymous
          <code class="literal">''@'%'</code> proxy account described in
          <a class="xref" href="security.html#ldap-pluggable-authentication-usage-proxying" title="LDAP Authentication with Proxying">LDAP Authentication with Proxying</a>,
          clients might connect to the MySQL server with varying user
          names. But the principle is the same: If the authentication
          string begins with <code class="literal">+</code>, the plugin uses the
          user name sent by the client together with the authentication
          string to construct the user DN.
        </p><h6><a name="ldap-pluggable-authentication-usage-proxying"></a>LDAP Authentication with Proxying</h6><a class="indexterm" name="idm140091719124768"></a><p>
          LDAP authentication plugins support proxying, enabling a user
          to connect to the MySQL server as one user but assume the
          privileges of a different user. This section describes basic
          LDAP plugin proxy support. The LDAP plugins also support
          specification of group preference and proxy user mapping; see
          <a class="xref" href="security.html#ldap-pluggable-authentication-usage-group-mapping" title="LDAP Authentication Group Preference and Mapping Specification">LDAP Authentication Group Preference and Mapping Specification</a>.
        </p><p>
          The authentication scheme described here uses proxying based
          on mapping LDAP group attribute values to connecting MySQL
          users who authenticate using LDAP onto other MySQL accounts
          that define different sets of privileges. Users do not connect
          directly through the accounts that define the privileges.
          Instead, they connect through a default proxy user
          authenticated with LDAP, such that all the external logins are
          mapped to the MySQL accounts that hold the privileges. Any
          user who connects is mapped to one of those MySQL accounts,
          the privileges for which determine the database operations
          permitted to the external user.
        </p><p>
          The instructions here assume the following scenario:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              LDAP entries use the <code class="literal">uid</code> and
              <code class="literal">cn</code> attributes to specify user name and
              group values, respectively. To use different user and
              group attribute names, set the appropriate system
              variables to configure the plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  For <code class="literal">authentication_ldap_simple</code>: Set
                  <a class="link" href="security.html#sysvar_authentication_ldap_simple_user_search_attr"><code class="literal">authentication_ldap_simple_user_search_attr</code></a>
                  and
                  <a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_attr"><code class="literal">authentication_ldap_simple_group_search_attr</code></a>.
                </p></li><li class="listitem"><p>
                  For <code class="literal">authentication_ldap_sasl</code>: Set
                  <a class="link" href="security.html#sysvar_authentication_ldap_sasl_user_search_attr"><code class="literal">authentication_ldap_sasl_user_search_attr</code></a>
                  and
                  <a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_attr"><code class="literal">authentication_ldap_sasl_group_search_attr</code></a>.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              These LDAP entries are available in the directory managed
              by the LDAP server, to provide distinguished name values
              that uniquely identify each user:
            </p><pre data-lang="ini" class="programlisting">
uid=basha,ou=People,dc=example,dc=com,cn=accounting
uid=basil,ou=People,dc=example,dc=com,cn=front_office
</pre><p>
              The group attribute values will become the authenticated
              user names, so they name the <code class="literal">accounting</code>
              and <code class="literal">front_office</code> proxied accounts.
            </p></li><li class="listitem"><p>
              The examples assume use of SASL LDAP authentication. Make
              the appropriate adjustments for simple LDAP
              authentication.
</p></li></ul>
</div>
<p>
          Create the default proxy MySQL account:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER ''@'%'
  IDENTIFIED WITH authentication_ldap_simple;
</pre><p>
          The proxy account definition has no <code class="literal">BY
          '<em class="replaceable"><code>auth_string</code></em>'</code> clause to
          name an LDAP user DN. Thus:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              When clients connect, the client user name is used as the
              LDAP user name to search for.
            </p></li><li class="listitem"><p>
              The matching LDAP entry is expected to include a group
              attribute naming the proxied MySQL account that defines
              the privileges the client should have.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            If your MySQL installation has anonymous users, they might
            conflict with the default proxy user. For more information
            about this problem, and ways of dealing with it, see
            <a class="xref" href="security.html#proxy-users-conflicts" title="Default Proxy User and Anonymous User Conflicts">Default Proxy User and Anonymous User Conflicts</a>.
</p>
</div>
<p>
          Create the proxied accounts and grant their privileges:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'accounting'@'localhost' ACCOUNT LOCK;
CREATE USER 'front_office'@'localhost' ACCOUNT LOCK;

GRANT ALL PRIVILEGES
  ON accountingdb.*
  TO 'accounting'@'localhost';
GRANT ALL PRIVILEGES
  ON frontdb.*
  TO 'front_office'@'localhost';
</pre><p>
          Grant the <a class="link" href="security.html#priv_proxy"><code class="literal">PROXY</code></a> privilege to
          the proxy account for each proxied account:
        </p><pre data-lang="sql" class="programlisting">
GRANT PROXY
  ON 'accounting'@'localhost'
  TO ''@'%';
GRANT PROXY
  ON 'front_office'@'localhost'
  TO ''@'%';
</pre><p>
          Use the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> command-line client to
          connect to the MySQL server as <code class="literal">basha</code>.
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=basha --password</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>basha_password</code></em></code></strong> <em class="replaceable"><code>(basha LDAP password)</code></em>
</pre><p>
          Authentication occurs as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              The server authenticates the connection using the
              <code class="literal">''@'%'</code> account, for client user
              <code class="literal">basha</code>.
            </p></li><li class="listitem"><p>
              The matching LDAP entry is:
            </p><pre data-lang="ini" class="programlisting">
uid=basha,ou=People,dc=example,dc=com,cn=accounting
</pre></li><li class="listitem"><p>
              The matching LDAP entry has group attribute
              <code class="literal">cn=accounting</code>, so
              <code class="literal">accounting</code> becomes the authenticated
              user.
            </p></li><li class="listitem"><p>
              The authenticated user differs from the client user name
              <code class="literal">basha</code>, with the result that
              <code class="literal">basha</code> is treated as a proxy for
              <code class="literal">accounting</code>, and
              <code class="literal">basha</code> assumes the privileges of the
              <code class="literal">accounting</code> account. The following query
              should return output as shown:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-----------------+----------------------+--------------+
| USER()          | CURRENT_USER()       | @@proxy_user |
+-----------------+----------------------+--------------+
| basha@localhost | accounting@localhost | ''@'%'       |
+-----------------+----------------------+--------------+
</pre></li></ol>
</div>
<p>
          This demonstrates that <code class="literal">basha</code> uses the
          privileges granted to the <code class="literal">accounting</code> MySQL
          account, and that proxying occurred through the default proxy
          user account.
        </p><p>
          Now connect as <code class="literal">basil</code> instead:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=basil --password</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>basil_password</code></em></code></strong> <em class="replaceable"><code>(basil LDAP password)</code></em>
</pre><p>
          The authentication process for <code class="literal">basil</code> is
          similar to that previously described for
          <code class="literal">basha</code>:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              The server authenticates the connection using the
              <code class="literal">''@'%'</code> account, for client user
              <code class="literal">basil</code>.
            </p></li><li class="listitem"><p>
              The matching LDAP entry is:
            </p><pre data-lang="ini" class="programlisting">
uid=basil,ou=People,dc=example,dc=com,cn=front_office
</pre></li><li class="listitem"><p>
              The matching LDAP entry has group attribute
              <code class="literal">cn=front_office</code>, so
              <code class="literal">front_office</code> becomes the authenticated
              user.
            </p></li><li class="listitem"><p>
              The authenticated user differs from the client user name
              <code class="literal">basil</code>, with the result that
              <code class="literal">basil</code> is treated as a proxy for
              <code class="literal">front_office</code>, and
              <code class="literal">basil</code> assumes the privileges of the
              <code class="literal">front_office</code> account. The following
              query should return output as shown:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT USER(), CURRENT_USER(), @@proxy_user;</code></strong>
+-----------------+------------------------+--------------+
| USER()          | CURRENT_USER()         | @@proxy_user |
+-----------------+------------------------+--------------+
| basil@localhost | front_office@localhost | ''@'%'       |
+-----------------+------------------------+--------------+
</pre></li></ol>
</div>
<p>
          This demonstrates that <code class="literal">basil</code> uses the
          privileges granted to the <code class="literal">front_office</code>
          MySQL account, and that proxying occurred through the default
          proxy user account.
        </p><h6><a name="ldap-pluggable-authentication-usage-group-mapping"></a>LDAP Authentication Group Preference and Mapping Specification</h6><a class="indexterm" name="idm140091719046368"></a><a class="indexterm" name="idm140091719044880"></a><p>
          As described in
          <a class="xref" href="security.html#ldap-pluggable-authentication-usage-proxying" title="LDAP Authentication with Proxying">LDAP Authentication with Proxying</a>,
          basic LDAP authentication proxying works by the principle that
          the plugin uses the first group name returned by the LDAP
          server as the MySQL proxy user account name. This simple
          capability does not enable specifying any preference about
          which group name to use if the LDAP server returns multiple
          names, or any name other than the group name as the proxy user
          name.
        </p><p>
          As of MySQL 8.0.14, for MySQL accounts that use LDAP
          authentication, the authentication string can specify the
          following information to enable greater proxying flexibility:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              A list of groups in preference order, such that the plugin
              uses the first group name in the list that matches a group
              returned by the LDAP server.
            </p></li><li class="listitem"><p>
              A mapping from group names to proxy user names, such that
              a group name when matched can provide a specified name to
              use as the proxy user. This provides an alternative to
              using the group name as the proxy user.
</p></li></ul>
</div>
<p>
          Consider the following MySQL proxy account definition:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER ''@'%'
  IDENTIFIED WITH authentication_ldap_sasl
  BY '+ou=People,dc=example,dc=com#grp1=usera,grp2,grp3=userc';
</pre><p>
          The authentication string has a user DN suffix
          <code class="literal">ou=People,dc=example,dc=com</code> prefixed by the
          <code class="literal">+</code> character. Thus, as described in
          <a class="xref" href="security.html#ldap-pluggable-authentication-usage-user-dn-suffix" title="LDAP Authentication User DN Suffixes">LDAP Authentication User DN Suffixes</a>,
          the full user DN is constructed from the user DN suffix as
          specified, plus the client user name as the
          <code class="literal">uid</code> attribute.
        </p><p>
          The remaining part of the authentication string begins with
          <code class="literal">#</code>, which signifies the beginning of group
          preference and mapping information. This part of the
          authentication string lists group names in the order
          <code class="literal">grp1</code>, <code class="literal">grp2</code>,
          <code class="literal">grp3</code>. The LDAP plugin compares that list
          with the set of group names returned by the LDAP server,
          looking in list order for a match against the returned names.
          The plugin uses the first match, or if there is no match,
          authentication fails.
        </p><p>
          Suppose that the LDAP server returns groups
          <code class="literal">grp3</code>, <code class="literal">grp2</code>, and
          <code class="literal">grp7</code>. The LDAP plugin uses
          <code class="literal">grp2</code> because it is the first group in the
          authentication string that matches, even though it is not the
          first group returned by the LDAP server. If the LDAP server
          returns <code class="literal">grp4</code>, <code class="literal">grp2</code>, and
          <code class="literal">grp1</code>, the plugin uses
          <code class="literal">grp1</code> even though <code class="literal">grp2</code>
          also matches. <code class="literal">grp1</code> has a precedence higher
          than <code class="literal">grp2</code> because it is listed earlier in
          the authentication string.
        </p><p>
          Assuming that the plugin finds a group name match, it performs
          mapping from that group name to the MySQL proxy user name, if
          there is one. For the example proxy account, mapping occurs as
          follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the matching group name is <code class="literal">grp1</code> or
              <code class="literal">grp3</code>, those are associated in the
              authentication string with user names
              <code class="literal">usera</code> and <code class="literal">userc</code>,
              respectively. The plugin uses the corresponding associated
              user name as the proxy user name.
            </p></li><li class="listitem"><p>
              If the matching group name is <code class="literal">grp2</code>,
              there is no associated user name in the authentication
              string. The plugin uses <code class="literal">grp2</code> as the
              proxy user name.
</p></li></ul>
</div>
<p>
          If the LDAP server returns a group in DN format, the LDAP
          plugin parses the group DN to extract the group name from it.
        </p><p>
          To specify LDAP group preference and mapping information,
          these principles apply:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Begin the group preference and mapping part of the
              authentication string with a <code class="literal">#</code> prefix
              character.
            </p></li><li class="listitem"><p>
              The group preference and mapping specification is a list
              of one or more items, separated by commas. Each item has
              the form
              <code class="literal"><em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>user_name</code></em></code>
              or <em class="replaceable"><code>group_name</code></em>. Items should be
              listed in group name preference order. For a group name
              selected by the plugin as a match from set of group names
              returned by the LDAP server, the two syntaxes differ in
              effect as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  For an item specified as
                  <code class="literal"><em class="replaceable"><code>group_name</code></em>=<em class="replaceable"><code>user_name</code></em></code>
                  (with a user name), the group name maps to the user
                  name, which is used as the MySQL proxy user name.
                </p></li><li class="listitem"><p>
                  For an item specified as
                  <em class="replaceable"><code>group_name</code></em> (with no user
                  name), the group name is used as the MySQL proxy user
                  name.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              To quote a group or user name that contains special
              characters such as space, surround it by double quote
              (<code class="literal">"</code>) characters. For example, if an item
              has group and user names of <code class="literal">my group
              name</code> and <code class="literal">my user name</code>, it
              must be written in a group mapping using quotes:
            </p><pre data-lang="none" class="programlisting">
"my group name"="my user name"
</pre><p>
              If an item has group and user names of
              <code class="literal">my_group_name</code> and
              <code class="literal">my_user_name</code> (which contain no special
              characters), it may but need not be written using quotes.
              Any of the following are valid:
            </p><pre data-lang="none" class="programlisting">
my_group_name=my_user_name
my_group_name="my_user_name"
"my_group_name"=my_user_name
"my_group_name"="my_user_name"
</pre></li><li class="listitem"><p>
              To escape a character, precede it by a backslash
              (<code class="literal">\</code>). This is useful particularly to
              include a literal double quote or backslash, which are
              otherwise not included literally.
            </p></li><li class="listitem"><p>
              A user DN need not be present in the authentication
              string, but if present, it must precede the group
              preference and mapping part. A user DN can be given as a
              full user DN, or as a user DN suffix with a
              <code class="literal">+</code> prefix character.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="no-login-pluggable-authentication"></a>6.4.1.8 No-Login Pluggable Authentication</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091718991488"></a><a class="indexterm" name="idm140091718990400"></a><p>
        The <code class="literal">mysql_no_login</code> server-side authentication
        plugin prevents all client connections to any account that uses
        it. Use cases for such a plugin include proxied accounts that
        should never permit direct login but are accessed only through
        proxy accounts and accounts that must be able to execute stored
        programs and views with elevated privileges without exposing
        those privileges to ordinary users.
      </p><p>
        The following table shows the plugin and library file names. The
        file name suffix might differ on your system. The file must be
        located in the directory named by the
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable.
</p>
<div class="table">
<a name="idm140091718985520"></a><p class="title"><b>Table 6.20 Plugin and Library Names for No-Login Authentication</b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for no-login password authentication."><col width="30%"><col width="70%"><thead><tr>
            <th scope="col">Plugin or File</th>
            <th scope="col">Plugin or File Name</th>
          </tr></thead><tbody><tr>
            <td scope="row">Server-side plugin</td>
            <td><code class="literal">mysql_no_login</code></td>
          </tr><tr>
            <td scope="row">Client-side plugin</td>
            <td>None</td>
          </tr><tr>
            <td scope="row">Library file</td>
            <td><code class="filename">mysql_no_login.so</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The following sections provide installation and usage
        information specific to no-login pluggable authentication:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#no-login-pluggable-authentication-installation" title="Installing No-Login Pluggable Authentication">Installing No-Login Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#no-login-pluggable-authentication-uninstallation" title="Uninstalling No-Login Pluggable Authentication">Uninstalling No-Login Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#no-login-pluggable-authentication-usage" title="Using No-Login Pluggable Authentication">Using No-Login Pluggable Authentication</a></p></li></ul>
</div>
<p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>. For proxy user
        information, see <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="no-login-pluggable-authentication-installation"></a>Installing No-Login Pluggable Authentication</h5>
</div>
</div>
</div>
<p>
          This section describes how to install the no-login
          authentication plugin. For general information about
          installing plugins, see <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>.
        </p><p>
          To be usable by the server, the plugin library file must be
          located in the MySQL plugin directory (the directory named by
          the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
          variable). If necessary, configure the plugin directory
          location by setting the value of
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
        </p><p>
          The plugin library file base name is
          <code class="literal">mysql_no_login</code>. The file name suffix
          differs per platform (for example, <code class="filename">.so</code>
          for Unix and Unix-like systems, <code class="filename">.dll</code> for
          Windows).
        </p><p>
          To load the plugin at server startup, use the
          <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option to
          name the library file that contains it. With this
          plugin-loading method, the option must be given each time the
          server starts. For example, put these lines in the server
          <code class="filename">my.cnf</code> file (adjust the
          <code class="filename">.so</code> suffix for your platform as
          necessary):
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
plugin-load-add=mysql_no_login.so
</pre><p>
          After modifying <code class="filename">my.cnf</code>, restart the
          server to cause the new settings to take effect.
        </p><p>
          Alternatively, to register the plugin at runtime, use this
          statement (adjust the <code class="filename">.so</code> suffix as
          necessary):
        </p><pre data-lang="sql" class="programlisting">
INSTALL PLUGIN mysql_no_login SONAME 'mysql_no_login.so';
</pre><p>
          <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> loads the plugin
          immediately, and also registers it in the
          <code class="literal">mysql.plugins</code> system table to cause the
          server to load it for each subsequent normal startup.
        </p><p>
          To verify plugin installation, examine the
          <a class="link" href="information-schema.html#plugins-table" title="25.18 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table
          or use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.6.25 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>
          statement (see
          <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 Obtaining Server Plugin Information">Section 5.6.2, “Obtaining Server Plugin Information”</a>). For example:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%login%';</code></strong>
+----------------+---------------+
| PLUGIN_NAME    | PLUGIN_STATUS |
+----------------+---------------+
| mysql_no_login | ACTIVE        |
+----------------+---------------+
</pre><p>
          If the plugin fails to initialize, check the server error log
          for diagnostic messages.
        </p><p>
          To associate MySQL accounts with the no-login plugin, see
          <a class="xref" href="security.html#no-login-pluggable-authentication-usage" title="Using No-Login Pluggable Authentication">Using No-Login Pluggable Authentication</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="no-login-pluggable-authentication-uninstallation"></a>Uninstalling No-Login Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          The method used to uninstall the no-login authentication
          plugin depends on how you installed it:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If you installed the plugin at server startup using a
              <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option,
              restart the server without the option.
            </p></li><li class="listitem"><p>
              If you installed the plugin at runtime using
              <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>, it remains
              installed across server restarts. To uninstall it, use
              <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a>:
            </p><pre data-lang="sql" class="programlisting">
UNINSTALL PLUGIN mysql_no_login;
</pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="no-login-pluggable-authentication-usage"></a>Using No-Login Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          This section describes how to use the no-login authentication
          plugin to prevent connections from MySQL client programs to
          the server. It is assumed that the server is running with the
          server-side plugin enabled, as described in
          <a class="xref" href="security.html#no-login-pluggable-authentication-installation" title="Installing No-Login Pluggable Authentication">Installing No-Login Pluggable Authentication</a>.
        </p><p>
          To refer to the no-login authentication plugin in the
          <code class="literal">IDENTIFIED WITH</code> clause of a
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> statement, use the
          name <code class="literal">mysql_no_login</code>.
        </p><p>
          An account that authenticates using
          <code class="literal">mysql_no_login</code> may be used as the
          <code class="literal">DEFINER</code> for stored program and view
          objects. If such an object definition also includes
          <code class="literal">SQL SECURITY DEFINER</code>, it executes with that
          account's privileges. DBAs can use this behavior to provide
          access to confidential or sensitive data that is exposed only
          through well-controlled interfaces.
        </p><p>
          The following example provides a simple illustration of these
          principles. It defines an account that does not permit client
          connections, and associates with it a view that exposes only
          certain columns of the <code class="literal">mysql.user</code> system
          table:
        </p><pre data-lang="sql" class="programlisting">
CREATE DATABASE nologindb;
CREATE USER 'nologin'@'localhost'
  IDENTIFIED WITH mysql_no_login;
GRANT ALL ON nologindb.*
  TO 'nologin'@'localhost';
GRANT SELECT ON mysql.user
  TO 'nologin'@'localhost';
CREATE DEFINER = 'nologin'@'localhost'
  SQL SECURITY DEFINER
  VIEW nologindb.myview
  AS SELECT User, Host FROM mysql.user;
</pre><p>
          To provide protected access to the view to an ordinary user,
          do this:
        </p><pre data-lang="sql" class="programlisting">
GRANT SELECT ON nologindb.myview
  TO 'ordinaryuser'@'localhost';
</pre><p>
          Now the ordinary user can use the view to access the limited
          information it presents:
        </p><pre data-lang="sql" class="programlisting">
SELECT * FROM nologindb.myview;
</pre><p>
          Attempts by the user to access columns other than those
          exposed by the view result in an error, as do all attempts to
          select from the view by users not granted access to it.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Because the <code class="literal">nologin</code> account cannot be
            used directly, the operations required to set up objects
            that it uses must be performed by <code class="literal">root</code> or
            similar account with the privileges required to create the
            objects and set <code class="literal">DEFINER</code> values.
</p>
</div>
<p>
          An account that authenticates using
          <code class="literal">mysql_no_login</code> may be used as a proxied
          base user for proxy accounts:
        </p><pre data-lang="sql" class="programlisting">
-- create proxied account
CREATE USER 'proxy_base'@'localhost'
  IDENTIFIED WITH mysql_no_login;
-- grant privileges to proxied account
GRANT ...
  ON ...
  TO 'proxy_base'@'localhost';
-- permit real_user to be a proxy account for proxied account
GRANT PROXY
  ON 'proxy_base'@'localhost'
  TO 'real_user'@'localhost';
</pre><p>
          This enables clients to access MySQL through the proxy account
          (<code class="literal">real_user</code>) but not to bypass the proxy
          mechanism by connecting directly as the proxied user
          (<code class="literal">proxy_base</code>).
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="socket-pluggable-authentication"></a>6.4.1.9 Socket Peer-Credential Pluggable Authentication</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091718906080"></a><a class="indexterm" name="idm140091718905040"></a><p>
        The server-side <code class="literal">auth_socket</code> authentication
        plugin authenticates clients that connect from the local host
        through the Unix socket file. The plugin uses the
        <code class="literal">SO_PEERCRED</code> socket option to obtain
        information about the user running the client program. Thus, the
        plugin can be used only on systems that support the
        <code class="literal">SO_PEERCRED</code> option, such as Linux.
      </p><p>
        The source code for this plugin can be examined as a relatively
        simple example demonstrating how to write a loadable
        authentication plugin.
      </p><p>
        The following table shows the plugin and library file names. The
        file must be located in the directory named by the
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable.
</p>
<div class="table">
<a name="idm140091718898288"></a><p class="title"><b>Table 6.21 Plugin and Library Names for Socket Peer-Credential Authentication</b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for socket peer-credential password authentication."><col width="30%"><col width="70%"><thead><tr>
            <th scope="col">Plugin or File</th>
            <th scope="col">Plugin or File Name</th>
          </tr></thead><tbody><tr>
            <td scope="row">Server-side plugin</td>
            <td><code class="literal">auth_socket</code></td>
          </tr><tr>
            <td scope="row">Client-side plugin</td>
            <td>None, see discussion</td>
          </tr><tr>
            <td scope="row">Library file</td>
            <td><code class="filename">auth_socket.so</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The following sections provide installation and usage
        information specific to socket pluggable authentication:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#socket-pluggable-authentication-installation" title="Installing Socket Pluggable Authentication">Installing Socket Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#socket-pluggable-authentication-uninstallation" title="Uninstalling Socket Pluggable Authentication">Uninstalling Socket Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#socket-pluggable-authentication-usage" title="Using Socket Pluggable Authentication">Using Socket Pluggable Authentication</a></p></li></ul>
</div>
<p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="socket-pluggable-authentication-installation"></a>Installing Socket Pluggable Authentication</h5>
</div>
</div>
</div>
<p>
          This section describes how to install the socket
          authentication plugin. For general information about
          installing plugins, see <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>.
        </p><p>
          To be usable by the server, the plugin library file must be
          located in the MySQL plugin directory (the directory named by
          the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
          variable). If necessary, configure the plugin directory
          location by setting the value of
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
        </p><p>
          To load the plugin at server startup, use the
          <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option to
          name the library file that contains it. With this
          plugin-loading method, the option must be given each time the
          server starts. For example, put these lines in the server
          <code class="filename">my.cnf</code> file:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
plugin-load-add=auth_socket.so
</pre><p>
          After modifying <code class="filename">my.cnf</code>, restart the
          server to cause the new settings to take effect.
        </p><p>
          Alternatively, to register the plugin at runtime, use this
          statement:
        </p><pre data-lang="sql" class="programlisting">
INSTALL PLUGIN auth_socket SONAME 'auth_socket.so';
</pre><p>
          <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> loads the plugin
          immediately, and also registers it in the
          <code class="literal">mysql.plugins</code> system table to cause the
          server to load it for each subsequent normal startup.
        </p><p>
          To verify plugin installation, examine the
          <a class="link" href="information-schema.html#plugins-table" title="25.18 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table
          or use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.6.25 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>
          statement (see
          <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 Obtaining Server Plugin Information">Section 5.6.2, “Obtaining Server Plugin Information”</a>). For example:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%socket%';</code></strong>
+-------------+---------------+
| PLUGIN_NAME | PLUGIN_STATUS |
+-------------+---------------+
| auth_socket | ACTIVE        |
+-------------+---------------+
</pre><p>
          If the plugin fails to initialize, check the server error log
          for diagnostic messages.
        </p><p>
          To associate MySQL accounts with the socket plugin, see
          <a class="xref" href="security.html#socket-pluggable-authentication-usage" title="Using Socket Pluggable Authentication">Using Socket Pluggable Authentication</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="socket-pluggable-authentication-uninstallation"></a>Uninstalling Socket Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          The method used to uninstall the socket authentication plugin
          depends on how you installed it:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If you installed the plugin at server startup using a
              <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option,
              restart the server without the option.
            </p></li><li class="listitem"><p>
              If you installed the plugin at runtime using
              <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>, it remains
              installed across server restarts. To uninstall it, use
              <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a>:
            </p><pre data-lang="sql" class="programlisting">
UNINSTALL PLUGIN auth_socket;
</pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="socket-pluggable-authentication-usage"></a>Using Socket Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          The socket plugin checks whether the socket user name (the
          operating system user name) matches the MySQL user name
          specified by the client program to the server. If the names do
          not match, the plugin checks whether the socket user name
          matches the name specified in the
          <code class="literal">authentication_string</code> column of the
          <code class="literal">mysql.user</code> system table row. If a match is
          found, the plugin permits the connection. The
          <code class="literal">authentication_string</code> value can be
          specified using an <code class="literal">IDENTIFIED ...AS</code> clause
          with <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
          <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>.
        </p><p>
          Suppose that a MySQL account is created for an operating
          system user named <code class="literal">valerie</code> who is to be
          authenticated by the <code class="literal">auth_socket</code> plugin for
          connections from the local host through the socket file:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'valerie'@'localhost' IDENTIFIED WITH auth_socket;
</pre><p>
          If a user on the local host with a login name of
          <code class="literal">stefanie</code> invokes <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a>
          with the option <code class="option">--user=valerie</code> to connect
          through the socket file, the server uses
          <code class="literal">auth_socket</code> to authenticate the client. The
          plugin determines that the <code class="option">--user</code> option
          value (<code class="literal">valerie</code>) differs from the client
          user's name (<code class="literal">stephanie</code>) and refuses the
          connection. If a user named <code class="literal">valerie</code> tries
          the same thing, the plugin finds that the user name and the
          MySQL user name are both <code class="literal">valerie</code> and
          permits the connection. However, the plugin refuses the
          connection even for <code class="literal">valerie</code> if the
          connection is made using a different protocol, such as TCP/IP.
        </p><p>
          To permit both the <code class="literal">valerie</code> and
          <code class="literal">stephanie</code> operating system users to access
          MySQL through socket file connections that use the account,
          this can be done two ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Name both users at account-creation time, one following
              <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>, and the other
              in the authentication string:
            </p><pre data-lang="sql" class="programlisting">
CREATE USER 'valerie'@'localhost' IDENTIFIED WITH auth_socket AS 'stephanie';
</pre></li><li class="listitem"><p>
              If you have already used <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE
              USER</code></a> to create the account for a single user,
              use <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> to add the
              second user:
            </p><pre data-lang="sql" class="programlisting">
CREATE USER 'valerie'@'localhost' IDENTIFIED WITH auth_socket;
ALTER USER 'valerie'@'localhost' IDENTIFIED WITH auth_socket AS 'stephanie';
</pre></li></ul>
</div>
<p>
          To access the account, both <code class="literal">valerie</code> and
          <code class="literal">stephanie</code> specify
          <code class="option">--user=valerie</code> at connect time.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="test-pluggable-authentication"></a>6.4.1.10 Test Pluggable Authentication</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091718815520"></a><a class="indexterm" name="idm140091718814416"></a><a class="indexterm" name="idm140091718812928"></a><a class="indexterm" name="idm140091718811840"></a><p>
        MySQL includes a test plugin that checks account credentials and
        logs success or failure to the server error log. This is a
        loadable plugin (not built in) and must be installed prior to
        use.
      </p><p>
        The test plugin source code is separate from the server source,
        unlike the built-in native plugin, so it can be examined as a
        relatively simple example demonstrating how to write a loadable
        authentication plugin.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          This plugin is intended for testing and development purposes,
          and is not for use in production environments or on servers
          that are exposed to public networks.
</p>
</div>
<p>
        The following table shows the plugin and library file names. The
        file name suffix might differ on your system. The file must be
        located in the directory named by the
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system variable.
</p>
<div class="table">
<a name="idm140091718806256"></a><p class="title"><b>Table 6.22 Plugin and Library Names for Test Authentication</b></p>
<div class="table-contents">
<table summary="Names for the plugins and library file used for test password authentication."><col width="30%"><col width="70%"><thead><tr>
            <th scope="col">Plugin or File</th>
            <th scope="col">Plugin or File Name</th>
          </tr></thead><tbody><tr>
            <td scope="row">Server-side plugin</td>
            <td><code class="literal">test_plugin_server</code></td>
          </tr><tr>
            <td scope="row">Client-side plugin</td>
            <td><code class="literal">auth_test_plugin</code></td>
          </tr><tr>
            <td scope="row">Library file</td>
            <td><code class="filename">auth_test_plugin.so</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
        The following sections provide installation and usage
        information specific to test pluggable authentication:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#test-pluggable-authentication-installation" title="Installing Test Pluggable Authentication">Installing Test Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#test-pluggable-authentication-uninstallation" title="Uninstalling Test Pluggable Authentication">Uninstalling Test Pluggable Authentication</a></p></li><li class="listitem"><p><a class="xref" href="security.html#test-pluggable-authentication-usage" title="Using Test Pluggable Authentication">Using Test Pluggable Authentication</a></p></li></ul>
</div>
<p>
        For general information about pluggable authentication in MySQL,
        see <a class="xref" href="security.html#pluggable-authentication" title="6.2.17 Pluggable Authentication">Section 6.2.17, “Pluggable Authentication”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="test-pluggable-authentication-installation"></a>Installing Test Pluggable Authentication</h5>
</div>
</div>
</div>
<p>
          This section describes how to install the test authentication
          plugin. For general information about installing plugins, see
          <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>.
        </p><p>
          To be usable by the server, the plugin library file must be
          located in the MySQL plugin directory (the directory named by
          the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
          variable). If necessary, configure the plugin directory
          location by setting the value of
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
        </p><p>
          To load the plugin at server startup, use the
          <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option to
          name the library file that contains it. With this
          plugin-loading method, the option must be given each time the
          server starts. For example, put these lines in the server
          <code class="filename">my.cnf</code> file (adjust the
          <code class="filename">.so</code> suffix for your platform as
          necessary):
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
plugin-load-add=auth_test_plugin.so
</pre><p>
          After modifying <code class="filename">my.cnf</code>, restart the
          server to cause the new settings to take effect.
        </p><p>
          Alternatively, to register the plugin at runtime, use this
          statement (adjust the <code class="filename">.so</code> suffix as
          necessary):
        </p><pre data-lang="sql" class="programlisting">
INSTALL PLUGIN test_plugin_server SONAME 'auth_test_plugin.so';
</pre><p>
          <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> loads the plugin
          immediately, and also registers it in the
          <code class="literal">mysql.plugins</code> system table to cause the
          server to load it for each subsequent normal startup.
        </p><p>
          To verify plugin installation, examine the
          <a class="link" href="information-schema.html#plugins-table" title="25.18 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table
          or use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.6.25 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a>
          statement (see
          <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 Obtaining Server Plugin Information">Section 5.6.2, “Obtaining Server Plugin Information”</a>). For example:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE '%test_plugin%';</code></strong>
+--------------------+---------------+
| PLUGIN_NAME        | PLUGIN_STATUS |
+--------------------+---------------+
| test_plugin_server | ACTIVE        |
+--------------------+---------------+
</pre><p>
          If the plugin fails to initialize, check the server error log
          for diagnostic messages.
        </p><p>
          To associate MySQL accounts with the test plugin, see
          <a class="xref" href="security.html#test-pluggable-authentication-usage" title="Using Test Pluggable Authentication">Using Test Pluggable Authentication</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="test-pluggable-authentication-uninstallation"></a>Uninstalling Test Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          The method used to uninstall the test authentication plugin
          depends on how you installed it:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If you installed the plugin at server startup using a
              <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option,
              restart the server without the option.
            </p></li><li class="listitem"><p>
              If you installed the plugin at runtime using
              <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>, it remains
              installed across server restarts. To uninstall it, use
              <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a>:
            </p><pre data-lang="sql" class="programlisting">
UNINSTALL PLUGIN test_plugin_server;
</pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="test-pluggable-authentication-usage"></a>Using Test Pluggable Authentication</h5>

</div>

</div>

</div>
<p>
          To use the test authentication plugin, create an account and
          name that plugin in the <code class="literal">IDENTIFIED WITH</code>
          clause:
        </p><pre data-lang="sql" class="programlisting">
CREATE USER 'testuser'@'localhost'
IDENTIFIED WITH test_plugin_server
BY '<em class="replaceable"><code>testpassword</code></em>';
</pre><p>
          Then provide the <a class="link" href="programs.html#option_general_user"><code class="option">--user</code></a> and
          <a class="link" href="programs.html#option_general_password"><code class="option">--password</code></a> options for that
          account when you connect to the server. For example:
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql --user=testuser --password</code></strong>
Enter password: <strong class="userinput"><code><em class="replaceable"><code>testpassword</code></em></code></strong>
</pre><p>
          The plugin fetches the password as received from the client
          and compares it with the value stored in the
          <code class="literal">authentication_string</code> column of the account
          row in the <code class="literal">mysql.user</code> system table. If the
          two values match, the plugin returns the
          <code class="literal">authentication_string</code> value as the new
          effective user ID.
        </p><p>
          You can look in the server error log for a message indicating
          whether authentication succeeded (notice that the password is
          reported as the <span class="quote">“<span class="quote">user</span>”</span>):
        </p><pre data-lang="none" class="programlisting">
[Note] Plugin test_plugin_server reported:
'successfully authenticated user <em class="replaceable"><code>testpassword</code></em>'
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="pluggable-authentication-system-variables"></a>6.4.1.11 Pluggable Authentication System Variables</h4>

</div>

</div>

</div>
<p>
        These variables are unavailable unless the appropriate
        server-side plugin is installed:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">authentication_ldap_sasl</code> for system
            variables with names of the form
            <code class="literal">authentication_ldap_sasl_<em class="replaceable"><code>xxx</code></em></code>
          </p></li><li class="listitem"><p>
            <code class="literal">authentication_ldap_simple</code> for system
            variables with names of the form
            <code class="literal">authentication_ldap_simple_<em class="replaceable"><code>xxx</code></em></code>
</p></li></ul>
</div>
<div class="table">
<a name="idm140091718732256"></a><p class="title"><b>Table 6.23 Authentication Plugin System Variable
Summary</b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Reference for authentication plugin system variables."><col width="20%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><thead><tr><th scope="col">Name</th>
<th scope="col">Cmd-Line</th>
<th scope="col">Option File</th>
<th scope="col">System Var</th>
<th scope="col">Status Var</th>
<th scope="col">Var Scope</th>
<th scope="col">Dynamic</th>
</tr></thead><tbody><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_auth_method_name">authentication_ldap_sasl_auth_method_name</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_base_dn">authentication_ldap_sasl_bind_base_dn</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_dn">authentication_ldap_sasl_bind_root_dn</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_pwd">authentication_ldap_sasl_bind_root_pwd</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_ca_path">authentication_ldap_sasl_ca_path</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_attr">authentication_ldap_sasl_group_search_attr</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_filter">authentication_ldap_sasl_group_search_filter</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_init_pool_size">authentication_ldap_sasl_init_pool_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_log_status">authentication_ldap_sasl_log_status</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_max_pool_size">authentication_ldap_sasl_max_pool_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_server_host">authentication_ldap_sasl_server_host</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_server_port">authentication_ldap_sasl_server_port</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_tls">authentication_ldap_sasl_tls</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_user_search_attr">authentication_ldap_sasl_user_search_attr</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_auth_method_name">authentication_ldap_simple_auth_method_name</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_base_dn">authentication_ldap_simple_bind_base_dn</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_dn">authentication_ldap_simple_bind_root_dn</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_pwd">authentication_ldap_simple_bind_root_pwd</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_ca_path">authentication_ldap_simple_ca_path</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_attr">authentication_ldap_simple_group_search_attr</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_filter">authentication_ldap_simple_group_search_filter</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_init_pool_size">authentication_ldap_simple_init_pool_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_log_status">authentication_ldap_simple_log_status</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_max_pool_size">authentication_ldap_simple_max_pool_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_server_host">authentication_ldap_simple_server_host</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_server_port">authentication_ldap_simple_server_port</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_tls">authentication_ldap_simple_tls</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_authentication_ldap_simple_user_search_attr">authentication_ldap_simple_user_search_attr</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_authentication_windows_log_level">authentication_windows_log_level</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_authentication_windows_use_principal_name">authentication_windows_use_principal_name</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_auth_method_name"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_auth_method_name"><code class="literal">authentication_ldap_sasl_auth_method_name</code></a>
</p><a class="indexterm" name="idm140091718501664"></a><a class="indexterm" name="idm140091718500544"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_auth_method_name"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-auth-method-name=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_auth_method_name">authentication_ldap_sasl_auth_method_name</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">SCRAM-SHA-1</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the authentication method
            name. Communication between the authentication plugin and
            the LDAP server occurs according to this authentication
            method. These authentication method values are permitted:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">SCRAM-SHA-1</code>: Authentication uses a
                SASL challenge-response mechanism to ensure password
                security.
              </p><p>
                The client-side
                <code class="literal">authentication_ldap_sasl_client</code>
                plugin communicates with the SASL server, using the
                password to create a challenge and obtain a SASL request
                buffer, then passes this buffer to the server-side
                <code class="literal">authentication_ldap_sasl</code> plugin. The
                client-side and server-side SASL LDAP plugins use SASL
                messages for secure transmission of credentials within
                the LDAP protocol, to avoid sending the cleartext
                password between the MySQL client and server.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_bind_base_dn"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_base_dn"><code class="literal">authentication_ldap_sasl_bind_base_dn</code></a>
</p><a class="indexterm" name="idm140091718461088"></a><a class="indexterm" name="idm140091718460048"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_bind_base_dn"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-bind-base-dn=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_base_dn">authentication_ldap_sasl_bind_base_dn</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the base distinguished name
            (DN). This variable can be used to limit the scope of
            searches by anchoring them at a certain location (the
            <span class="quote">“<span class="quote">base</span>”</span>) within the search tree.
          </p><p>
            Suppose that members of one set of LDAP user entries each
            have this form:
          </p><pre data-lang="ini" class="programlisting">
uid=<em class="replaceable"><code>user_name</code></em>,ou=People,dc=example,dc=com
</pre><p>
            And that members of another set of LDAP user entries each
            have this form:
          </p><pre data-lang="ini" class="programlisting">
uid=<em class="replaceable"><code>user_name</code></em>,ou=Admin,dc=example,dc=com
</pre><p>
            Then searches work like this for different base DN values:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                If the base DN is
                <code class="literal">ou=People,dc=example,dc=com</code>: Searches
                find user entries only in the first set.
              </p></li><li class="listitem"><p>
                If the base DN is
                <code class="literal">ou=Admin,dc=example,dc=com</code>: Searches
                find user entries only in the second set.
              </p></li><li class="listitem"><p>
                If the base DN is
                <code class="literal">ou=dc=example,dc=com</code>: Searches find
                user entries in the first or second set.
</p></li></ul>
</div>
<p>
            In general, more specific base DN values result in faster
            searches because they limit the search scope more.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_bind_root_dn"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_dn"><code class="literal">authentication_ldap_sasl_bind_root_dn</code></a>
</p><a class="indexterm" name="idm140091718414496"></a><a class="indexterm" name="idm140091718413456"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_bind_root_dn"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-bind-root-dn=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_dn">authentication_ldap_sasl_bind_root_dn</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the root distinguished name
            (DN). This variable is used in conjunction with
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_pwd"><code class="literal">authentication_ldap_sasl_bind_root_pwd</code></a>
            as the credentials for authenticating to the LDAP server for
            the purpose of performing searches. Authentication uses
            either one or two LDAP bind operations, depending on whether
            the MySQL account names an LDAP user DN:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                If the account does not name a user DN:
                <code class="literal">authentication_ldap_sasl</code> performs an
                initial LDAP binding using
                <a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_dn"><code class="literal">authentication_ldap_sasl_bind_root_dn</code></a>
                and
                <a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_pwd"><code class="literal">authentication_ldap_sasl_bind_root_pwd</code></a>.
                (These are both empty by default, so if they are not
                set, the LDAP server must permit anonymous connections.)
                The resulting bind LDAP handle is used to search for the
                user DN, based on the client user name.
                <code class="literal">authentication_ldap_sasl</code> performs a
                second bind using the user DN and client-supplied
                password.
              </p></li><li class="listitem"><p>
                If the account does name a user DN: The first bind
                operation is unnecessary in this case.
                <code class="literal">authentication_ldap_sasl</code> performs a
                single bind using the user DN and client-supplied
                password. This is faster than if the MySQL account does
                not specify an LDAP user DN.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_bind_root_pwd"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_pwd"><code class="literal">authentication_ldap_sasl_bind_root_pwd</code></a>
</p><a class="indexterm" name="idm140091718369312"></a><a class="indexterm" name="idm140091718368272"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_bind_root_pwd"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-bind-root-pwd=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_pwd">authentication_ldap_sasl_bind_root_pwd</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the password for the root
            distinguished name. This variable is used in conjunction
            with
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_bind_root_dn"><code class="literal">authentication_ldap_sasl_bind_root_dn</code></a>.
            See the description of that variable.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_ca_path"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_ca_path"><code class="literal">authentication_ldap_sasl_ca_path</code></a>
</p><a class="indexterm" name="idm140091718332160"></a><a class="indexterm" name="idm140091718331056"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_ca_path"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-ca-path=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_ca_path">authentication_ldap_sasl_ca_path</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the absolute path of the
            certificate authority file. Specify this file if it is
            desired that the authentication plugin perform verification
            of the LDAP server certificate.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              In addition to setting the
              <a class="link" href="security.html#sysvar_authentication_ldap_sasl_ca_path"><code class="literal">authentication_ldap_sasl_ca_path</code></a>
              variable to the file name, you must add the appropriate
              certificate authority certificates to the file and enable
              the
              <a class="link" href="security.html#sysvar_authentication_ldap_sasl_tls"><code class="literal">authentication_ldap_sasl_tls</code></a>
              system variable.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_group_search_attr"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_attr"><code class="literal">authentication_ldap_sasl_group_search_attr</code></a>
</p><a class="indexterm" name="idm140091718292496"></a><a class="indexterm" name="idm140091718291376"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_group_search_attr"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-group-search-attr=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_attr">authentication_ldap_sasl_group_search_attr</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">cn</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the name of the attribute that
            specifies group names in LDAP directory entries. If
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_attr"><code class="literal">authentication_ldap_sasl_group_search_attr</code></a>
            has its default value of <code class="literal">cn</code>, searches
            return the <code class="literal">cn</code> value as the group name.
            For example, if an LDAP entry with a <code class="literal">uid</code>
            value of <code class="literal">user1</code> has a
            <code class="literal">cn</code> attribute of
            <code class="literal">mygroup</code>, searches for
            <code class="literal">user1</code> return <code class="literal">mygroup</code>
            as the group name.
          </p><p>
            This variable should be the empty string if you want no
            group or proxy authentication.
          </p><p>
            If the group search attribute is
            <code class="literal">isMemberOf</code>, LDAP authentication directly
            retrieves the user attribute <code class="literal">isMemberOf</code>
            value and assigns it as group information. If the group
            search attribute is not <code class="literal">isMemberOf</code>, LDAP
            authentication searches for all groups where the user is a
            member. (The latter is the default behavior.) This behavior
            is based on how LDAP group information can be stored two
            ways: 1) A group entry can have an attribute named
            <code class="literal">memberUid</code> or <code class="literal">member</code>
            with a value that is a user name; 2) A user entry can have
            an attribute named <code class="literal">isMemberOf</code> with values
            that are group names.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_group_search_filter"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_filter"><code class="literal">authentication_ldap_sasl_group_search_filter</code></a>
</p><a class="indexterm" name="idm140091718243488"></a><a class="indexterm" name="idm140091718242368"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_group_search_filter"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-group-search-filter=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_group_search_filter">authentication_ldap_sasl_group_search_filter</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">(|(&amp;(objectClass=posixGroup)(memberUid=%s))(&amp;(objectClass=group)(member=%s)))</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the custom group search
            filter.
          </p><p>
            The search filter value can contain <code class="literal">{UA}</code>
            and <code class="literal">{UD}</code> notation to represent the user
            name and the full user DN. For example,
            <code class="literal">{UA}</code> is replaced with a user name such as
            <code class="literal">"admin"</code>, whereas <code class="literal">{UD}</code>
            is replaced with a use full DN such as
            <code class="literal">"uid=admin,ou=People,dc=example,dc=com"</code>.
            The following value is the default, which supports both
            OpenLDAP and Active Directory:
          </p><pre data-lang="simple" class="programlisting">
(|(&amp;(objectClass=posixGroup)(memberUid={UA}))
  (&amp;(objectClass=group)(member={UD})))
</pre><p>
            In some cases for the user scenario,
            <code class="literal">memberOf</code> is a simple user attribute that
            holds no group information. For additional flexibility, an
            optional <code class="literal">{GA}</code> prefix can be used with the
            group search attribute. Any group attribute with a {GA}
            prefix is treated as a user attribute having group names.
            For example, with a value of
            <code class="literal">{GA}MemberOf</code>, if the group value is the
            DN, the first attribute value from the group DN is returned
            as the group name.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_init_pool_size"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_init_pool_size"><code class="literal">authentication_ldap_sasl_init_pool_size</code></a>
</p><a class="indexterm" name="idm140091718198176"></a><a class="indexterm" name="idm140091718197136"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_init_pool_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-init-pool-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_init_pool_size">authentication_ldap_sasl_init_pool_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">10</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">32767</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the initial size of the pool
            of connections to the LDAP server. Choose the value for this
            variable based on the average number of concurrent
            authentication requests to the LDAP server.
          </p><p>
            The plugin uses
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_init_pool_size"><code class="literal">authentication_ldap_sasl_init_pool_size</code></a>
            and
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_max_pool_size"><code class="literal">authentication_ldap_sasl_max_pool_size</code></a>
            together for connection-pool management:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                When the authentication plugin initializes, it creates
                <a class="link" href="security.html#sysvar_authentication_ldap_sasl_init_pool_size"><code class="literal">authentication_ldap_sasl_init_pool_size</code></a>
                connections, unless
                <a class="link" href="security.html#sysvar_authentication_ldap_sasl_max_pool_size"><code class="literal">authentication_ldap_sasl_max_pool_size=0</code></a>
                to disable pooling.
              </p></li><li class="listitem"><p>
                If the plugin receives an anthentication request when
                there are no free connections in the current connection
                pool, the plugin can create a new connection, up to the
                maximum connection pool size given by
                <a class="link" href="security.html#sysvar_authentication_ldap_sasl_max_pool_size"><code class="literal">authentication_ldap_sasl_max_pool_size</code></a>.
              </p></li><li class="listitem"><p>
                If the plugin receives a request when the pool size is
                already at its maximum and there are no free
                connections, authentication fails.
              </p></li><li class="listitem"><p>
                When the plugin unloads, it closes all pooled
                connections.
</p></li></ul>
</div>
<p>
            Changes to plugin system variable settings may have no
            effect on connections already in the pool. For example,
            modifying the LDAP server host, port, or TLS settings does
            not affect existing connections. However, if the original
            variable values were invalid and the connection pool could
            not be initialized, the plugin attempts to reinitialize the
            pool for the next LDAP request. In this case, the new system
            variable values are used for the reinitialization attempt.
          </p><p>
            If
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_max_pool_size"><code class="literal">authentication_ldap_sasl_max_pool_size=0</code></a>
            to disable pooling, each LDAP connection opened by the
            plugin uses the values the system variables have at that
            time.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_log_status"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_log_status"><code class="literal">authentication_ldap_sasl_log_status</code></a>
</p><a class="indexterm" name="idm140091718141728"></a><a class="indexterm" name="idm140091718140688"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_log_status"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-log-status=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_log_status">authentication_ldap_sasl_log_status</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">5</code></td>
</tr></tbody></table>
</div>
<a class="indexterm" name="idm140091718102848"></a><p>
            For SASL LDAP authentication, the logging level. The
            following table shows the permitted level values and their
            meanings.
</p>
<div class="table">
<a name="idm140091718100784"></a><p class="title"><b>Table 6.24 Log Levels for authentication_ldap_sasl_log_status</b></p>
<div class="table-contents">
<table summary="authentication_ldap_sasl_log_status system variable option values and types of messages logged per value."><col width="30%"><col width="70%"><thead><tr>
                <th scope="col">Option Value</th>
                <th scope="col">Types of Messages Logged</th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">1</code></td>
                <td>No messages</td>
              </tr><tr>
                <td scope="row"><code class="literal">2</code></td>
                <td>Error messages</td>
              </tr><tr>
                <td scope="row"><code class="literal">3</code></td>
                <td>Error and warning messages</td>
              </tr><tr>
                <td scope="row"><code class="literal">4</code></td>
                <td>Error, warning, and information messages</td>
              </tr><tr>
                <td scope="row"><code class="literal">5</code></td>
                <td>All messages</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><a class="indexterm" name="idm140091718080704"></a><a class="indexterm" name="idm140091718079216"></a><a class="indexterm" name="idm140091718078112"></a><p>
            On the client side, messages can be logged to the standard
            output by setting the
            <code class="literal">AUTHENTICATION_LDAP_CLIENT_LOG</code>
            environment variable. The permitted and default values are
            the same as for
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_log_status"><code class="literal">authentication_ldap_sasl_log_status</code></a>.
          </p><p>
            The <code class="literal">AUTHENTICATION_LDAP_CLIENT_LOG</code>
            environment variable applies only to SASL LDAP
            authentication. It has no effect for simple LDAP
            authentication because the client plugin in that case is
            <code class="literal">mysql_clear_password</code>, which knows nothing
            about LDAP operations.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_max_pool_size"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_max_pool_size"><code class="literal">authentication_ldap_sasl_max_pool_size</code></a>
</p><a class="indexterm" name="idm140091718069232"></a><a class="indexterm" name="idm140091718068192"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_max_pool_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-max-pool-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_max_pool_size">authentication_ldap_sasl_max_pool_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">32767</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the maximum size of the pool
            of connections to the LDAP server. To disable connection
            pooling, set this variable to 0.
          </p><p>
            This variable is used in conjunction with
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_init_pool_size"><code class="literal">authentication_ldap_sasl_init_pool_size</code></a>.
            See the description of that variable.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_server_host"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_server_host"><code class="literal">authentication_ldap_sasl_server_host</code></a>
</p><a class="indexterm" name="idm140091718025312"></a><a class="indexterm" name="idm140091718024272"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_server_host"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-server-host=host_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_server_host">authentication_ldap_sasl_server_host</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the LDAP server host. The
            permitted values for this variable depend on the
            authentication method:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                For
                <a class="link" href="security.html#sysvar_authentication_ldap_sasl_auth_method_name"><code class="literal">authentication_ldap_sasl_auth_method_name=SCRAM-SHA-1</code></a>:
                The LDAP server host can be a host name or IP address.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_server_port"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_server_port"><code class="literal">authentication_ldap_sasl_server_port</code></a>
</p><a class="indexterm" name="idm140091717989872"></a><a class="indexterm" name="idm140091717988832"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_server_port"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-server-port=port_num</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_server_port">authentication_ldap_sasl_server_port</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">389</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">32376</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the LDAP server TCP/IP port
            number.
          </p><p>
            As of MySQL 8.0.14, if the LDAP port number is configured as
            636 or 3269, the plugin uses LDAPS (LDAP over SSL) instead
            of LDAP. (LDAPS differs from <code class="literal">startTLS</code>.)
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_tls"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_tls"><code class="literal">authentication_ldap_sasl_tls</code></a>
</p><a class="indexterm" name="idm140091717946720"></a><a class="indexterm" name="idm140091717945616"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_tls"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-tls[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_tls">authentication_ldap_sasl_tls</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, whether connections by the
            plugin to the LDAP server are secure. If this variable is
            enabled, the plugin uses TLS to connect securely to the LDAP
            server. If you enable this variable, you may also wish to
            set the
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_ca_path"><code class="literal">authentication_ldap_sasl_ca_path</code></a>
            variable.
          </p><p>
            MySQL LDAP plugins support the StartTLS method, which
            initializes TLS on top of a plain LDAP connection. The
            <code class="literal">ldaps</code> method is deprecated and MySQL does
            not support it.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_sasl_user_search_attr"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_user_search_attr"><code class="literal">authentication_ldap_sasl_user_search_attr</code></a>
</p><a class="indexterm" name="idm140091717908064"></a><a class="indexterm" name="idm140091717906944"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_sasl_user_search_attr"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-sasl-user-search-attr=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_sasl_user_search_attr">authentication_ldap_sasl_user_search_attr</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">uid</code></td>
</tr></tbody></table>
</div>
<p>
            For SASL LDAP authentication, the name of the attribute that
            specifies user names in LDAP directory entries. If a user
            distinguished name is not provided, the authentication
            plugin searches for the name using this attribute. For
            example, if the
            <a class="link" href="security.html#sysvar_authentication_ldap_sasl_user_search_attr"><code class="literal">authentication_ldap_sasl_user_search_attr</code></a>
            value is <code class="literal">uid</code>, a search for the user name
            <code class="literal">user1</code> finds entries with a
            <code class="literal">uid</code> value of <code class="literal">user1</code>.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_auth_method_name"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_auth_method_name"><code class="literal">authentication_ldap_simple_auth_method_name</code></a>
</p><a class="indexterm" name="idm140091717867680"></a><a class="indexterm" name="idm140091717866560"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_auth_method_name"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-auth-method-name=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_auth_method_name">authentication_ldap_simple_auth_method_name</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">SIMPLE</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the authentication method
            name. Communication between the authentication plugin and
            the LDAP server occurs according to this authentication
            method. These authentication method values are permitted:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <code class="literal">SIMPLE</code>: This authentication method
                uses either one or two LDAP bind operations, depending
                on whether the MySQL account names an LDAP user
                distinguished name. See the description of
                <a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_dn"><code class="literal">authentication_ldap_simple_bind_root_dn</code></a>.
              </p></li><li class="listitem"><p>
                <code class="literal">AD-FOREST</code>:
                <code class="literal">authentication_ldap_simple</code> searches
                all the domains in the Active Directory forest,
                performing an LDAP bind to each Active Directory domain
                until the user is found in some domain.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
              For simple LDAP authentication, it is recommended to also
              set TLS parameters to require that communication with the
              LDAP server take place over secure connections.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_bind_base_dn"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_base_dn"><code class="literal">authentication_ldap_simple_bind_base_dn</code></a>
</p><a class="indexterm" name="idm140091717824592"></a><a class="indexterm" name="idm140091717823552"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_bind_base_dn"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-bind-base-dn=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_base_dn">authentication_ldap_simple_bind_base_dn</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the base distinguished name
            (DN). This variable can be used to limit the scope of
            searches by anchoring them at a certain location (the
            <span class="quote">“<span class="quote">base</span>”</span>) within the search tree.
          </p><p>
            Suppose that members of one set of LDAP user entries each
            have this form:
          </p><pre data-lang="ini" class="programlisting">
uid=<em class="replaceable"><code>user_name</code></em>,ou=People,dc=example,dc=com
</pre><p>
            And that members of another set of LDAP user entries each
            have this form:
          </p><pre data-lang="ini" class="programlisting">
uid=<em class="replaceable"><code>user_name</code></em>,ou=Admin,dc=example,dc=com
</pre><p>
            Then searches work like this for different base DN values:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                If the base DN is
                <code class="literal">ou=People,dc=example,dc=com</code>: Searches
                find user entries only in the first set.
              </p></li><li class="listitem"><p>
                If the base DN is
                <code class="literal">ou=Admin,dc=example,dc=com</code>: Searches
                find user entries only in the second set.
              </p></li><li class="listitem"><p>
                If the base DN is
                <code class="literal">ou=dc=example,dc=com</code>: Searches find
                user entries in the first or second set.
</p></li></ul>
</div>
<p>
            In general, more specific base DN values result in faster
            searches because they limit the search scope more.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_bind_root_dn"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_dn"><code class="literal">authentication_ldap_simple_bind_root_dn</code></a>
</p><a class="indexterm" name="idm140091717778048"></a><a class="indexterm" name="idm140091717777008"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_bind_root_dn"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-bind-root-dn=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_dn">authentication_ldap_simple_bind_root_dn</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the root distinguished name
            (DN). This variable is used in conjunction with
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_pwd"><code class="literal">authentication_ldap_simple_bind_root_pwd</code></a>
            as the credentials for authenticating to the LDAP server for
            the purpose of performing searches. Authentication uses
            either one or two LDAP bind operations, depending on whether
            the MySQL account names an LDAP user DN:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                If the account does not name a user DN:
                <code class="literal">authentication_ldap_simple</code> performs
                an initial LDAP binding using
                <a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_dn"><code class="literal">authentication_ldap_simple_bind_root_dn</code></a>
                and
                <a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_pwd"><code class="literal">authentication_ldap_simple_bind_root_pwd</code></a>.
                (These are both empty by default, so if they are not
                set, the LDAP server must permit anonymous connections.)
                The resulting bind LDAP handle is used to search for the
                user DN, based on the client user name.
                <code class="literal">authentication_ldap_simple</code> performs a
                second bind using the user DN and client-supplied
                password.
              </p></li><li class="listitem"><p>
                If the account does name a user DN: The first bind
                operation is unnecessary in this case.
                <code class="literal">authentication_ldap_simple</code> performs a
                single bind using the user DN and client-supplied
                password. This is faster than if the MySQL account does
                not specify an LDAP user DN.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_bind_root_pwd"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_pwd"><code class="literal">authentication_ldap_simple_bind_root_pwd</code></a>
</p><a class="indexterm" name="idm140091717732944"></a><a class="indexterm" name="idm140091717731824"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_bind_root_pwd"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-bind-root-pwd=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_pwd">authentication_ldap_simple_bind_root_pwd</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the password for the root
            distinguished name. This variable is used in conjunction
            with
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_bind_root_dn"><code class="literal">authentication_ldap_simple_bind_root_dn</code></a>.
            See the description of that variable.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_ca_path"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_ca_path"><code class="literal">authentication_ldap_simple_ca_path</code></a>
</p><a class="indexterm" name="idm140091717695472"></a><a class="indexterm" name="idm140091717694432"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_ca_path"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-ca-path=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_ca_path">authentication_ldap_simple_ca_path</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the absolute path of the
            certificate authority file. Specify this file if it is
            desired that the authentication plugin perform verification
            of the LDAP server certificate.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              In addition to setting the
              <a class="link" href="security.html#sysvar_authentication_ldap_simple_ca_path"><code class="literal">authentication_ldap_simple_ca_path</code></a>
              variable to the file name, you must add the appropriate
              certificate authority certificates to the file and enable
              the
              <a class="link" href="security.html#sysvar_authentication_ldap_simple_tls"><code class="literal">authentication_ldap_simple_tls</code></a>
              system variable.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_group_search_attr"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_attr"><code class="literal">authentication_ldap_simple_group_search_attr</code></a>
</p><a class="indexterm" name="idm140091717655808"></a><a class="indexterm" name="idm140091717654688"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_group_search_attr"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-group-search-attr=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_attr">authentication_ldap_simple_group_search_attr</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">cn</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the name of the attribute
            that specifies group names in LDAP directory entries. If
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_attr"><code class="literal">authentication_ldap_simple_group_search_attr</code></a>
            has its default value of <code class="literal">cn</code>, searches
            return the <code class="literal">cn</code> value as the group name.
            For example, if an LDAP entry with a <code class="literal">uid</code>
            value of <code class="literal">user1</code> has a
            <code class="literal">cn</code> attribute of
            <code class="literal">mygroup</code>, searches for
            <code class="literal">user1</code> return <code class="literal">mygroup</code>
            as the group name.
          </p><p>
            If the group search attribute is
            <code class="literal">isMemberOf</code>, LDAP authentication directly
            retrieves the user attribute <code class="literal">isMemberOf</code>
            value and assigns it as group information. If the group
            search attribute is not <code class="literal">isMemberOf</code>, LDAP
            authentication searches for all groups where the user is a
            member. (The latter is the default behavior.) This behavior
            is based on how LDAP group information can be stored two
            ways: 1) A group entry can have an attribute named
            <code class="literal">memberUid</code> or <code class="literal">member</code>
            with a value that is a user name; 2) A user entry can have
            an attribute named <code class="literal">isMemberOf</code> with values
            that are group names.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_group_search_filter"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_filter"><code class="literal">authentication_ldap_simple_group_search_filter</code></a>
</p><a class="indexterm" name="idm140091717607312"></a><a class="indexterm" name="idm140091717606192"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_group_search_filter"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-group-search-filter=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_group_search_filter">authentication_ldap_simple_group_search_filter</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">(|(&amp;(objectClass=posixGroup)(memberUid=%s))(&amp;(objectClass=group)(member=%s)))</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the custom group search
            filter.
          </p><p>
            The search filter value can contain <code class="literal">{UA}</code>
            and <code class="literal">{UD}</code> notation to represent the user
            name and the full user DN. For example,
            <code class="literal">{UA}</code> is replaced with a user name such as
            <code class="literal">"admin"</code>, whereas <code class="literal">{UD}</code>
            is replaced with a use full DN such as
            <code class="literal">"uid=admin,ou=People,dc=example,dc=com"</code>.
            The following value is the default, which supports both
            OpenLDAP and Active Directory:
          </p><pre data-lang="simple" class="programlisting">
(|(&amp;(objectClass=posixGroup)(memberUid={UA}))
  (&amp;(objectClass=group)(member={UD})))
</pre><p>
            In some cases for the user scenario,
            <code class="literal">memberOf</code> is a simple user attribute that
            holds no group information. For additional flexibility, an
            optional <code class="literal">{GA}</code> prefix can be used with the
            group search attribute. Any group attribute with a {GA}
            prefix is treated as a user attribute having group names.
            For example, with a value of
            <code class="literal">{GA}MemberOf</code>, if the group value is the
            DN, the first attribute value from the group DN is returned
            as the group name.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_init_pool_size"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_init_pool_size"><code class="literal">authentication_ldap_simple_init_pool_size</code></a>
</p><a class="indexterm" name="idm140091717562048"></a><a class="indexterm" name="idm140091717560928"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_init_pool_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-init-pool-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_init_pool_size">authentication_ldap_simple_init_pool_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">10</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">32767</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the initial size of the pool
            of connections to the LDAP server. Choose the value for this
            variable based on the average number of concurrent
            authentication requests to the LDAP server.
          </p><p>
            The plugin uses
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_init_pool_size"><code class="literal">authentication_ldap_simple_init_pool_size</code></a>
            and
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_max_pool_size"><code class="literal">authentication_ldap_simple_max_pool_size</code></a>
            together for connection-pool management:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                When the authentication plugin initializes, it creates
                <a class="link" href="security.html#sysvar_authentication_ldap_simple_init_pool_size"><code class="literal">authentication_ldap_simple_init_pool_size</code></a>
                connections, unless
                <a class="link" href="security.html#sysvar_authentication_ldap_simple_max_pool_size"><code class="literal">authentication_ldap_simple_max_pool_size=0</code></a>
                to disable pooling.
              </p></li><li class="listitem"><p>
                If the plugin receives an anthentication request when
                there are no free connections in the current connection
                pool, the plugin can create a new connection, up to the
                maximum connection pool size given by
                <a class="link" href="security.html#sysvar_authentication_ldap_simple_max_pool_size"><code class="literal">authentication_ldap_simple_max_pool_size</code></a>.
              </p></li><li class="listitem"><p>
                If the plugin receives a request when the pool size is
                already at its maximum and there are no free
                connections, authentication fails.
              </p></li><li class="listitem"><p>
                When the plugin unloads, it closes all pooled
                connections.
</p></li></ul>
</div>
<p>
            Changes to plugin system variable settings may have no
            effect on connections already in the pool. For example,
            modifying the LDAP server host, port, or TLS settings does
            not affect existing connections. However, if the original
            variable values were invalid and the connection pool could
            not be initialized, the plugin attempts to reinitialize the
            pool for the next LDAP request. In this case, the new system
            variable values are used for the reinitialization attempt.
          </p><p>
            If
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_max_pool_size"><code class="literal">authentication_ldap_simple_max_pool_size=0</code></a>
            to disable pooling, each LDAP connection opened by the
            plugin uses the values the system variables have at that
            time.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_log_status"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_log_status"><code class="literal">authentication_ldap_simple_log_status</code></a>
</p><a class="indexterm" name="idm140091717504832"></a><a class="indexterm" name="idm140091717503792"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_log_status"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-log-status=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_log_status">authentication_ldap_simple_log_status</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">5</code></td>
</tr></tbody></table>
</div>
<a class="indexterm" name="idm140091717465872"></a><p>
            For simple LDAP authentication, the logging level. The
            following table shows the permitted level values and their
            meanings.
</p>
<div class="table">
<a name="idm140091717463808"></a><p class="title"><b>Table 6.25 Log Levels for authentication_ldap_simple_log_status</b></p>
<div class="table-contents">
<table summary="authentication_ldap_simple_log_status system variable option values and types of messages logged per value."><col width="30%"><col width="70%"><thead><tr>
                <th scope="col">Option Value</th>
                <th scope="col">Types of Messages Logged</th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">1</code></td>
                <td>No messages</td>
              </tr><tr>
                <td scope="row"><code class="literal">2</code></td>
                <td>Error messages</td>
              </tr><tr>
                <td scope="row"><code class="literal">3</code></td>
                <td>Error and warning messages</td>
              </tr><tr>
                <td scope="row"><code class="literal">4</code></td>
                <td>Error, warning, and information messages</td>
              </tr><tr>
                <td scope="row"><code class="literal">5</code></td>
                <td>All messages</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_max_pool_size"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_max_pool_size"><code class="literal">authentication_ldap_simple_max_pool_size</code></a>
</p><a class="indexterm" name="idm140091717441232"></a><a class="indexterm" name="idm140091717440112"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_max_pool_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-max-pool-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_max_pool_size">authentication_ldap_simple_max_pool_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">32767</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the maximum size of the pool
            of connections to the LDAP server. To disable connection
            pooling, set this variable to 0.
          </p><p>
            This variable is used in conjunction with
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_init_pool_size"><code class="literal">authentication_ldap_simple_init_pool_size</code></a>.
            See the description of that variable.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_server_host"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_server_host"><code class="literal">authentication_ldap_simple_server_host</code></a>
</p><a class="indexterm" name="idm140091717397120"></a><a class="indexterm" name="idm140091717396080"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_server_host"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-server-host=host_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_server_host">authentication_ldap_simple_server_host</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the LDAP server host. The
            permitted values for this variable depend on the
            authentication method:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                For
                <a class="link" href="security.html#sysvar_authentication_ldap_simple_auth_method_name"><code class="literal">authentication_ldap_simple_auth_method_name=SIMPLE</code></a>:
                The LDAP server host can be a host name or IP address.
              </p></li><li class="listitem"><p>
                For
                <a class="link" href="security.html#sysvar_authentication_ldap_simple_auth_method_name"><code class="literal">authentication_ldap_simple_auth_method_name=AD-FOREST</code></a>.
                The LDAP server host can be an Active Directory domain
                name. For example, for an LDAP server URL of
                <code class="literal">ldap://example.mem.local:389</code>, the
                server name can be <code class="literal">mem.local</code>.
              </p><p>
                An Active Directory forest setup can have multiple
                domains (LDAP server IPs), which can be discovered using
                DNS. On Unix and Unix-like systems, some additional
                setup may be required to configure your DNS server with
                SRV records that specify the LDAP servers for the Active
                Directory domain. Suppose that your configuration has
                these properties:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
                    The name server that provides information about
                    Active Directory domains has IP address
                    <code class="literal">10.172.166.100</code>.
                  </p></li><li class="listitem"><p>
                    The LDAP servers have names
                    <code class="literal">ldap1.mem.local</code> through
                    <code class="literal">ldap3.mem.local</code> and IP addresses
                    <code class="literal">10.172.166.101</code> through
                    <code class="literal">10.172.166.103</code>.
</p></li></ul>
</div>
<p>
                You want the LDAP servers to be discoverable using SRV
                searches. For example, at the command line, a command
                like this should list the LDAP servers:
              </p><pre data-lang="terminal" class="programlisting">
host -t SRV _ldap._tcp.mem.local
</pre><p>
                Perform the DNS configuration as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                    Add a line to <code class="filename">/etc/resolv.conf</code>
                    to specify the name server that provides information
                    about Active Directory domains:
                  </p><pre data-lang="none" class="programlisting">
nameserver 10.172.166.100
</pre></li><li class="listitem"><p>
                    Configure the appropriate zone file for the name
                    server with SRV records for the LDAP servers:
                  </p><pre data-lang="none" class="programlisting">
_ldap._tcp.mem.local. 86400 IN SRV 0 100 389 ldap1.mem.local.
_ldap._tcp.mem.local. 86400 IN SRV 0 100 389 ldap2.mem.local.
_ldap._tcp.mem.local. 86400 IN SRV 0 100 389 ldap3.mem.local.
</pre></li><li class="listitem"><p>
                    It may also be necessary to specify the IP address
                    for the LDAP servers in
                    <code class="filename">/etc/hosts</code> if the server host
                    cannot be resolved. For example, add lines like this
                    to the file:
                  </p><pre data-lang="none" class="programlisting">
10.172.166.101 ldap1.mem.local
10.172.166.102 ldap2.mem.local
10.172.166.103 ldap3.mem.local
</pre></li></ol>
</div>
<p>
                With the DNS configured as just described, the
                server-side LDAP plugin can discover the LDAP servers
                and will try to authenticate in all domains until
                authentication succeeds or there are no more servers.
              </p><p>
                Windows needs no such settings as just described. Given
                the LDAP server host in the
                <a class="link" href="security.html#sysvar_authentication_ldap_simple_server_host"><code class="literal">authentication_ldap_simple_server_host</code></a>
                value, the Windows LDAP library searches all domains and
                attempts to authenticate.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_server_port"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_server_port"><code class="literal">authentication_ldap_simple_server_port</code></a>
</p><a class="indexterm" name="idm140091717338000"></a><a class="indexterm" name="idm140091717336960"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_server_port"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-server-port=port_num</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_server_port">authentication_ldap_simple_server_port</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">389</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">32376</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the LDAP server TCP/IP port
            number.
          </p><p>
            As of MySQL 8.0.14, if the LDAP port number is configured as
            636 or 3269, the plugin uses LDAPS (LDAP over SSL) instead
            of LDAP. (LDAPS differs from <code class="literal">startTLS</code>.)
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_tls"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_tls"><code class="literal">authentication_ldap_simple_tls</code></a>
</p><a class="indexterm" name="idm140091717294848"></a><a class="indexterm" name="idm140091717293744"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_tls"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-tls[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_tls">authentication_ldap_simple_tls</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, whether connections by the
            plugin to the LDAP server are secure. If this variable is
            enabled, the plugin uses TLS to connect securely to the LDAP
            server. If you enable this variable, you may also wish to
            set the
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_ca_path"><code class="literal">authentication_ldap_simple_ca_path</code></a>
            variable.
          </p><p>
            MySQL LDAP plugins support the StartTLS method, which
            initializes TLS on top of a plain LDAP connection. The
            <code class="literal">ldaps</code> method is deprecated and MySQL does
            not support it.
          </p></li><li class="listitem"><p><a name="sysvar_authentication_ldap_simple_user_search_attr"></a>
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_user_search_attr"><code class="literal">authentication_ldap_simple_user_search_attr</code></a>
</p><a class="indexterm" name="idm140091717256096"></a><a class="indexterm" name="idm140091717254976"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for authentication_ldap_simple_user_search_attr"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--authentication-ldap-simple-user-search-attr=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_authentication_ldap_simple_user_search_attr">authentication_ldap_simple_user_search_attr</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">uid</code></td>
</tr></tbody></table>
</div>
<p>
            For simple LDAP authentication, the name of the attribute
            that specifies user names in LDAP directory entries. If a
            user distinguished name is not provided, the authentication
            plugin searches for the name using this attribute. For
            example, if the
            <a class="link" href="security.html#sysvar_authentication_ldap_simple_user_search_attr"><code class="literal">authentication_ldap_simple_user_search_attr</code></a>
            value is <code class="literal">uid</code>, a search for the user name
            <code class="literal">user1</code> finds entries with a
            <code class="literal">uid</code> value of <code class="literal">user1</code>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="connection-control"></a>6.4.2 The Connection-Control Plugins</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#connection-control-installation">6.4.2.1 Connection-Control Plugin Installation</a></span></dt><dt><span class="section"><a href="security.html#connection-control-variables">6.4.2.2 Connection-Control System and Status Variables</a></span></dt></dl>
</div>
<p>
      MySQL Server includes a plugin library that enables administrators
      to introduce an increasing delay in server response to clients
      after a certain number of consecutive failed connection attempts.
      This capability provides a deterrent that slows down brute force
      attacks that attempt to access MySQL user accounts. The plugin
      library contains two plugins:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">CONNECTION_CONTROL</code> checks incoming
          connections and adds a delay to server responses as necessary.
          This plugin also exposes system variables that enable its
          operation to be configured and a status variable that provides
          rudimentary monitoring information.
        </p><p>
          The <code class="literal">CONNECTION_CONTROL</code> plugin uses the
          audit plugin interface (see
          <a class="xref" href="extending-mysql.html#writing-audit-plugins" title="29.2.4.8 Writing Audit Plugins">Section 29.2.4.8, “Writing Audit Plugins”</a>). To collect
          information, it subscribes to the
          <code class="literal">MYSQL_AUDIT_CONNECTION_CLASSMASK</code> event
          class, and processes
          <code class="literal">MYSQL_AUDIT_CONNECTION_CONNECT</code> and
          <code class="literal">MYSQL_AUDIT_CONNECTION_CHANGE_USER</code>
          subevents to check whether the server should introduce a delay
          before responding to client connection attempts.
        </p></li><li class="listitem"><p>
          <code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code>
          implements an <code class="literal">INFORMATION_SCHEMA</code> table that
          exposes more detailed monitoring information for failed
          connection attempts.
</p></li></ul>
</div>
<p>
      The following sections provide information about
      connection-control plugin installation and configuration. For
      information about the
      <a class="link" href="information-schema.html#connection-control-failed-login-attempts-table" title="25.41.1 The INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS Table"><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code></a>
      table, see
      <a class="xref" href="information-schema.html#connection-control-failed-login-attempts-table" title="25.41.1 The INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS Table">Section 25.41.1, “The INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS Table”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="connection-control-installation"></a>6.4.2.1 Connection-Control Plugin Installation</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091717202944"></a><a class="indexterm" name="idm140091717201440"></a><a class="indexterm" name="idm140091717199952"></a><a class="indexterm" name="idm140091717198432"></a><p>
        This section describes how to install the connection-control
        plugins, <code class="literal">CONNECTION_CONTROL</code> and
        <code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code>. For
        general information about installing plugins, see
        <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>.
      </p><p>
        To be usable by the server, the plugin library file must be
        located in the MySQL plugin directory (the directory named by
        the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
        variable). If necessary, configure the plugin directory location
        by setting the value of
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
      </p><p>
        The plugin library file base name is
        <code class="literal">connection_control</code>. The file name suffix
        differs per platform (for example, <code class="filename">.so</code> for
        Unix and Unix-like systems, <code class="filename">.dll</code> for
        Windows).
      </p><p>
        To load the plugins at server startup, use the
        <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option to name
        the library file that contains them. With this plugin-loading
        method, the option must be given each time the server starts.
        For example, put these lines in the server
        <code class="filename">my.cnf</code> file (adjust the
        <code class="filename">.so</code> suffix for your platform as necessary):
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
plugin-load-add=connection_control.so
</pre><p>
        After modifying <code class="filename">my.cnf</code>, restart the server
        to cause the new settings to take effect.
      </p><p>
        Alternatively, to register the plugins at runtime, use these
        statements (adjust the <code class="filename">.so</code> suffix as
        necessary):
      </p><pre data-lang="sql" class="programlisting">
INSTALL PLUGIN CONNECTION_CONTROL
  SONAME 'connection_control.so';
INSTALL PLUGIN CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS
  SONAME 'connection_control.so';
</pre><p>
        <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> loads the plugin
        immediately, and also registers it in the
        <code class="literal">mysql.plugins</code> system table to cause the
        server to load it for each subsequent normal startup.
      </p><p>
        To verify plugin installation, examine the
        <a class="link" href="information-schema.html#plugins-table" title="25.18 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table or
        use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.6.25 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a> statement
        (see <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 Obtaining Server Plugin Information">Section 5.6.2, “Obtaining Server Plugin Information”</a>). For
        example:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE 'connection%';</code></strong>
+------------------------------------------+---------------+
| PLUGIN_NAME                              | PLUGIN_STATUS |
+------------------------------------------+---------------+
| CONNECTION_CONTROL                       | ACTIVE        |
| CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS | ACTIVE        |
+------------------------------------------+---------------+
</pre><p>
        If a plugin fails to initialize, check the server error log for
        diagnostic messages.
      </p><p>
        If the plugins have been previously registered with
        <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> or are loaded with
        <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a>, you can use
        the <code class="option">--connection-control</code> and
        <code class="option">--connection-control-failed-login-attempts</code>
        options at server startup to control plugin activation. For
        example, to load the plugins at startup and prevent them from
        being removed at runtime, use these options:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
plugin-load-add=connection_control.so
connection-control=FORCE_PLUS_PERMANENT
connection-control-failed-login-attempts=FORCE_PLUS_PERMANENT
</pre><p>
        If it is desired to prevent the server from running without a
        given connection-control plugin, use an option value of
        <code class="literal">FORCE</code> or
        <code class="literal">FORCE_PLUS_PERMANENT</code> to force server startup
        to fail if the plugin does not initialize successfully.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          It is possible to install one plugin without the other, but
          both must be installed for full connection-control capability.
          In particular, installing only the
          <code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code>
          plugin is of little use because without the
          <code class="literal">CONNECTION_CONTROL</code> plugin to provide the
          data that populates the
          <a class="link" href="information-schema.html#connection-control-failed-login-attempts-table" title="25.41.1 The INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS Table"><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code></a>
          table, retrievals from the table will always be empty.
</p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#connection-control-plugin-delay-configuration" title="Connection Delay Configuration">Connection Delay Configuration</a></p></li><li class="listitem"><p><a class="xref" href="security.html#connection-control-plugin-failure-assessment" title="Connection Failure Assessment">Connection Failure Assessment</a></p></li><li class="listitem"><p><a class="xref" href="security.html#connection-control-plugin-failure-monitoring" title="Connection Failure Monitoring">Connection Failure Monitoring</a></p></li></ul>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="connection-control-plugin-delay-configuration"></a>Connection Delay Configuration</h5>

</div>

</div>

</div>
<p>
          To enable you to configure its operation, the
          <code class="literal">CONNECTION_CONTROL</code> plugin exposes several
          system variables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>:
              The number of consecutive failed connection attempts
              permitted to clients before the server adds a delay for
              subsequent connection attempts.
            </p></li><li class="listitem"><p>
              <a class="link" href="security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a>:
              The amount of delay to add for each consecutive connection
              failure above the threshold.
            </p></li><li class="listitem"><p>
              <a class="link" href="security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a>:
              The maximum delay to add.
</p></li></ul>
</div>
<p>
          To entirely disable checking for failed connection attempts,
          set
          <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
          to zero. If
          <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
          is nonzero, the amount of delay is zero up through that many
          consecutive failed connection attempts. Thereafter, the amount
          of delay is the number of failed attempts above the threshold,
          multiplied by
          <a class="link" href="security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a>
          milliseconds. For example, with the default
          <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
          and
          <a class="link" href="security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a>
          values of 3 and 1000, respectively, there is no delay for the
          first three consecutive failed connection attempts by a
          client, a delay of 1000 milliseconds for the fourth failed
          attempt, 2000 milliseconds for the fifth failed attempt, and
          so on, up to the maximum delay permitted by
          <a class="link" href="security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a>.
        </p><p>
          You can set the <code class="literal">CONNECTION_CONTROL</code> system
          variables at server startup or runtime. Suppose that you want
          to permit four consecutive failed connection attempts before
          the server starts delaying its responses, and to increase the
          delay by 1500 milliseconds for each additional failure after
          that. To set the relevant variables at server startup, put
          these lines in the server <code class="filename">my.cnf</code> file:
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
plugin-load-add=connection_control.so
connection_control_failed_connections_threshold=4
connection_control_min_connection_delay=1500
</pre><p>
          To set and persist the variables at runtime, use these
          statements:
        </p><pre data-lang="sql" class="programlisting">
SET PERSIST connection_control_failed_connections_threshold = 4;
SET PERSIST connection_control_min_connection_delay = 1500;
</pre><p>
          <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
          PERSIST</code></a> sets the value for the running MySQL
          instance. It also saves the value, causing it to be used for
          subsequent server restarts. To change a value for the running
          MySQL instance without saving it for subsequent restarts, use
          the <code class="literal">GLOBAL</code> keyword rather than
          <code class="literal">PERSIST</code>. See
          <a class="xref" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment">Section 13.7.5.1, “SET Syntax for Variable Assignment”</a>.
        </p><p>
          The
          <a class="link" href="security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a>
          and
          <a class="link" href="security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a>
          system variables have fixed minimum and maximum values of 1000
          and 2147483647, respectively. In addition, the permitted range
          of values of each variable also depends on the current value
          of the other:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a>
              cannot be set greater than the current value of
              <a class="link" href="security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a>.
            </p></li><li class="listitem"><p>
              <a class="link" href="security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a>
              cannot be set less than the current value of
              <a class="link" href="security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a>.
</p></li></ul>
</div>
<p>
          Thus, to make the changes required for some configurations,
          you might need to set the variables in a specific order.
          Suppose that the current minimum and maximum delays are 1000
          and 2000, and that you want to set them to 3000 and 5000. You
          cannot first set
          <a class="link" href="security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a>
          to 3000 because that is greater than the current
          <a class="link" href="security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a>
          value of 2000. Instead, set
          <a class="link" href="security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a>
          to 5000, then set
          <a class="link" href="security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a>
          to 3000.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="connection-control-plugin-failure-assessment"></a>Connection Failure Assessment</h5>

</div>

</div>

</div>
<p>
          When the <code class="literal">CONNECTION_CONTROL</code> plugin is
          installed, it checks connection attempts and tracks whether
          they fail or succeed. For this purpose, a failed connection
          attempt is one for which the client user and host match a
          known MySQL account but the provided credentials are
          incorrect, or do not match any known account.
        </p><p>
          Failed-connection counting is based on the user/host
          combination for each connection attempt. Determination of the
          applicable user name and host name takes proxying into account
          and occurs as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If the client user proxies another user, the proxying
              user's information is used. For example, if
              <code class="literal">external_user@example.com</code> proxies
              <code class="literal">proxy_user@example.com</code>, connection
              counting uses the proxying user,
              <code class="literal">external_user@example.com</code>, rather than
              the proxied user,
              <code class="literal">proxy_user@example.com</code>. Both
              <code class="literal">external_user@example.com</code> and
              <code class="literal">proxy_user@example.com</code> must have valid
              entries in the <code class="literal">mysql.user</code> system table
              and a proxy relationship between them must be defined in
              the <code class="literal">mysql.proxies_priv</code> system table
              (see <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>).
            </p></li><li class="listitem"><p>
              If the client user does not proxy another user, but does
              match a <code class="literal">mysql.user</code> entry, counting uses
              the <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> value
              corresponding to that entry. For example, if a user
              <code class="literal">user1</code> connecting from a host
              <code class="literal">host1.example.com</code> matches a
              <code class="literal">user1@host1.example.com</code> entry, counting
              uses <code class="literal">user1@host1.example.com</code>. If the
              user matches a <code class="literal">user1@%.example.com</code>,
              <code class="literal">user1@%.com</code>, or
              <code class="literal">user1@%</code> entry instead, counting uses
              <code class="literal">user1@%.example.com</code>,
              <code class="literal">user1@%.com</code>, or
              <code class="literal">user1@%</code>, respectively.
</p></li></ul>
</div>
<p>
          For the cases just described, the connection attempt matches
          some <code class="literal">mysql.user</code> entry, and whether the
          request succeeds or fails depends on whether the client
          provides the correct authentication credentials. For example,
          if the client presents an incorrect password, the connection
          attempt fails.
        </p><p>
          If the connection attempt matches no
          <code class="literal">mysql.user</code> entry, the attempt fails. In
          this case, no <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a>
          value is available and connection-failure counting uses the
          user name provided by the client and the client host as
          determined by the server. For example, if a client attempts to
          connect as user <code class="literal">user2</code> from host
          <code class="literal">host2.example.com</code>, the user name part is
          available in the client request and the server determines the
          host information. The user/host combination used for counting
          is <code class="literal">user2@host2.example.com</code>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            The server maintains information about which client hosts
            can possibly connect to the server (essentially the union of
            host values for <code class="literal">mysql.user</code> entries). If a
            client attempts to connect from any other host, the server
            rejects the attempt at an early stage of connection setup:
          </p><pre data-lang="none" class="programlisting">
ERROR 1130 (HY000): Host '<em class="replaceable"><code>host_name</code></em>' is not
allowed to connect to this MySQL server
</pre><p>
            Because this type of rejection occurs so early,
            <code class="literal">CONNECTION_CONTROL</code> does not see it, and
            does not count it.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="connection-control-plugin-failure-monitoring"></a>Connection Failure Monitoring</h5>

</div>

</div>

</div>
<p>
          To monitor failed connections, use these information sources:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The
              <a class="link" href="security.html#statvar_Connection_control_delay_generated"><code class="literal">Connection_control_delay_generated</code></a>
              status variable indicates the number of times the server
              added a delay to its response to a failed connection
              attempt. This does not count attempts that occur before
              reaching the threshold defined by the
              <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
              system variable.
            </p></li><li class="listitem"><p>
              The <code class="literal">INFORMATION_SCHEMA</code>
              <a class="link" href="information-schema.html#connection-control-failed-login-attempts-table" title="25.41.1 The INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS Table"><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code></a>
              table provides information about the current number of
              consecutive failed connection attempts per client
              user/host combination. This counts all failed attempts,
              regardless of whether they were delayed.
</p></li></ul>
</div>
<p>
          Assigning a value to
          <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
          at runtime resets all accumulated failed-connection counters
          to zero, which has these visible effects:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The
              <a class="link" href="security.html#statvar_Connection_control_delay_generated"><code class="literal">Connection_control_delay_generated</code></a>
              status variable is reset to zero.
            </p></li><li class="listitem"><p>
              The
              <a class="link" href="information-schema.html#connection-control-failed-login-attempts-table" title="25.41.1 The INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS Table"><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code></a>
              table becomes empty.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="connection-control-variables"></a>6.4.2.2 Connection-Control System and Status Variables</h4>

</div>

</div>

</div>
<p>
        This section describes the system and status variables that the
        <code class="literal">CONNECTION_CONTROL</code> plugin provides to enable
        its operation to be configured and monitored.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#connection-control-plugin-system-variables" title="Connection-Control System Variables">Connection-Control System Variables</a></p></li><li class="listitem"><p><a class="xref" href="security.html#connection-control-plugin-status-variables" title="Connection-Control Status Variables">Connection-Control Status Variables</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="connection-control-plugin-system-variables"></a>Connection-Control System Variables</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091717057664"></a><p>
          If the <code class="literal">CONNECTION_CONTROL</code> plugin is
          installed, it exposes these system variables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_connection_control_failed_connections_threshold"></a>
              <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
</p><a class="indexterm" name="idm140091717052336"></a><a class="indexterm" name="idm140091717051216"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for connection_control_failed_connections_threshold"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--connection-control-failed-connections-threshold=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.1</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold">connection_control_failed_connections_threshold</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">3</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2147483647</code></td>
</tr></tbody></table>
</div>
<p>
              The number of consecutive failed connection attempts
              permitted to clients before the server adds a delay for
              subsequent connection attempts:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  If the variable has a nonzero value
                  <em class="replaceable"><code>N</code></em>, the server adds a delay
                  beginning with consecutive failed attempt
                  <em class="replaceable"><code>N</code></em>+1. If a client has
                  reached the point where connection responses are
                  delayed, the delay also occurs for the next subsequent
                  successful connection.
                </p></li><li class="listitem"><p>
                  Setting this variable to zero disables
                  failed-connection counting. In this case, the server
                  never adds delays.
</p></li></ul>
</div>
<p>
              For information about how
              <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
              interacts with other connection-control system and status
              variables, see
              <a class="xref" href="security.html#connection-control-installation" title="6.4.2.1 Connection-Control Plugin Installation">Section 6.4.2.1, “Connection-Control Plugin Installation”</a>.
            </p></li><li class="listitem"><p><a name="sysvar_connection_control_max_connection_delay"></a>
              <a class="link" href="security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a>
</p><a class="indexterm" name="idm140091717004032"></a><a class="indexterm" name="idm140091717002992"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for connection_control_max_connection_delay"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--connection-control-max-connection-delay=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.1</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_connection_control_max_connection_delay">connection_control_max_connection_delay</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">2147483647</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2147483647</code></td>
</tr></tbody></table>
</div>
<p>
              The maximum delay in milliseconds for server response to
              failed connection attempts, if
              <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
              is greater than zero.
            </p><p>
              For information about how
              <a class="link" href="security.html#sysvar_connection_control_max_connection_delay"><code class="literal">connection_control_max_connection_delay</code></a>
              interacts with other connection-control system and status
              variables, see
              <a class="xref" href="security.html#connection-control-installation" title="6.4.2.1 Connection-Control Plugin Installation">Section 6.4.2.1, “Connection-Control Plugin Installation”</a>.
            </p></li><li class="listitem"><p><a name="sysvar_connection_control_min_connection_delay"></a>
              <a class="link" href="security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a>
</p><a class="indexterm" name="idm140091716957984"></a><a class="indexterm" name="idm140091716956944"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for connection_control_min_connection_delay"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--connection-control-min-connection-delay=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.1</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_connection_control_min_connection_delay">connection_control_min_connection_delay</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">1000</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">2147483647</code></td>
</tr></tbody></table>
</div>
<p>
              The minimum delay in milliseconds for server response to
              failed connection attempts, if
              <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
              is greater than zero. This is also the amount by which the
              server increases the delay for additional successive
              failures once it begins delaying.
            </p><p>
              For information about how
              <a class="link" href="security.html#sysvar_connection_control_min_connection_delay"><code class="literal">connection_control_min_connection_delay</code></a>
              interacts with other connection-control system and status
              variables, see
              <a class="xref" href="security.html#connection-control-installation" title="6.4.2.1 Connection-Control Plugin Installation">Section 6.4.2.1, “Connection-Control Plugin Installation”</a>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="connection-control-plugin-status-variables"></a>Connection-Control Status Variables</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091716912752"></a><p>
          If the <code class="literal">CONNECTION_CONTROL</code> plugin is
          installed, it exposes this status variable:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Connection_control_delay_generated"></a>
              <a class="link" href="security.html#statvar_Connection_control_delay_generated"><code class="literal">Connection_control_delay_generated</code></a>
            </p><a class="indexterm" name="idm140091716907376"></a><a class="indexterm" name="idm140091716906336"></a><p>
              The number of times the server added a delay to its
              response to a failed connection attempt. This does not
              count attempts that occur before reaching the threshold
              defined by the
              <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
              system variable.
            </p><p>
              This variable provides a simple counter. For more detailed
              connection-control monitoring information, examine the
              <code class="literal">INFORMATION_SCHEMA</code>
              <a class="link" href="information-schema.html#connection-control-failed-login-attempts-table" title="25.41.1 The INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS Table"><code class="literal">CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS</code></a>
              table; see
              <a class="xref" href="information-schema.html#connection-control-failed-login-attempts-table" title="25.41.1 The INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS Table">Section 25.41.1, “The INFORMATION_SCHEMA CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS Table”</a>.
            </p><p>
              Assigning a value to
              <a class="link" href="security.html#sysvar_connection_control_failed_connections_threshold"><code class="literal">connection_control_failed_connections_threshold</code></a>
              at runtime resets
              <a class="link" href="security.html#statvar_Connection_control_delay_generated"><code class="literal">Connection_control_delay_generated</code></a>
              to zero.
</p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="validate-password"></a>6.4.3 The Password Validation Component</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#validate-password-installation">6.4.3.1 Password Validation Component Installation and Uninstallation</a></span></dt><dt><span class="section"><a href="security.html#validate-password-options-variables">6.4.3.2 Password Validation Options and Variables</a></span></dt><dt><span class="section"><a href="security.html#validate-password-transitioning">6.4.3.3 Transitioning to the Password Validation Component</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091716894608"></a><a class="indexterm" name="idm140091716893552"></a><a class="indexterm" name="idm140091716892464"></a><a class="indexterm" name="idm140091716891392"></a><p>
      The <code class="literal">validate_password</code> component serves to test
      passwords and improve security. This component exposes system
      variables that enable you to define password policy, and status
      variables for component monitoring.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        In MySQL 8.0.4, the <code class="literal">validate_password</code> plugin
        was reimplemented as the <code class="literal">validate_password</code>
        component. The following instructions describe how to use the
        component, not the plugin. For instructions on using the plugin,
        see <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/validate-password.html" target="_top">The Password Validation Plugin</a> in
        <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/" target="_top">MySQL 5.7 Reference Manual</a>.
      </p><p>
        The plugin form of <code class="literal">validate_password</code> is still
        available but is deprecated and will be removed in a future
        version of MySQL. MySQL installations that use the plugin should
        make the transition to using the component instead. See
        <a class="xref" href="security.html#validate-password-transitioning" title="6.4.3.3 Transitioning to the Password Validation Component">Section 6.4.3.3, “Transitioning to the Password Validation Component”</a>.
</p>
</div>
<p>
      The <code class="literal">validate_password</code> component implements
      these capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          In SQL statements that assign a password supplied as a
          cleartext value, the component checks the password against the
          current password policy and rejects the password if it is weak
          (the statement returns an
          <a class="link" href="error-handling.html#error_er_not_valid_password"><code class="literal">ER_NOT_VALID_PASSWORD</code></a> error).
          This applies to the <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a>,
          <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a>,
          <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>, and
          <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> statements.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a>
          SQL function assesses the strength of potential passwords. The
          function takes a password argument and returns an integer from
          0 (weak) to 100 (strong).
</p></li></ul>
</div>
<p>
      For example, <code class="literal">validate_password</code> checks the
      cleartext password in the following statement. Under the default
      password policy, which requires passwords to be at least 8
      characters long, the password is weak and the statement produces
      an error:
    </p><a class="indexterm" name="idm140091716870160"></a><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER USER USER() IDENTIFIED BY 'abc';</code></strong>
ERROR 1819 (HY000): Your password does not satisfy the current
policy requirements
</pre><p>
      Passwords specified as hashed values are not checked because the
      original password value is not available for checking:
    </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>ALTER USER 'jeffrey'@'localhost'</code></strong>
       <strong class="userinput"><code>IDENTIFIED WITH mysql_native_password</code></strong>
       <strong class="userinput"><code>AS '*0D3CED9BEC10A777AEC23CCC353A8C08A633045E';</code></strong>
Query OK, 0 rows affected (0.01 sec)
</pre><p>
      To configure password checking, modify the system variables having
      names of the form
      <code class="literal">validate_password.<em class="replaceable"><code>xxx</code></em></code>;
      these are the parameters that control password policy. See
      <a class="xref" href="security.html#validate-password-options-variables" title="6.4.3.2 Password Validation Options and Variables">Section 6.4.3.2, “Password Validation Options and Variables”</a>.
    </p><p>
      If <code class="literal">validate_password</code> is not installed, the
      <code class="literal">validate_password.<em class="replaceable"><code>xxx</code></em></code>
      system variables are not available, passwords in statements are
      not checked, and the
      <a class="link" href="functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a>
      function always returns 0. For example, without the plugin
      installed, accounts can be assigned passwords shorter than 8
      characters.
    </p><p>
      Assuming that <code class="literal">validate_password</code> is installed,
      it implements three levels of password checking:
      <code class="literal">LOW</code>, <code class="literal">MEDIUM</code>, and
      <code class="literal">STRONG</code>. The default is
      <code class="literal">MEDIUM</code>; to change this, modify the value of
      <a class="link" href="security.html#sysvar_validate_password.policy"><code class="literal">validate_password.policy</code></a>. The
      policies implement increasingly strict password tests. The
      following descriptions refer to default parameter values, which
      can be modified by changing the appropriate system variables.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">LOW</code> policy tests password length only.
          Passwords must be at least 8 characters long. To change this
          length, modify
          <a class="link" href="security.html#sysvar_validate_password.length"><code class="literal">validate_password.length</code></a>.
        </p></li><li class="listitem"><p>
          <code class="literal">MEDIUM</code> policy adds the conditions that
          passwords must contain at least 1 numeric character, 1
          lowercase character, 1 uppercase character, and 1 special
          (nonalphanumeric) character. To change these values, modify
          <a class="link" href="security.html#sysvar_validate_password.number_count"><code class="literal">validate_password.number_count</code></a>,
          <a class="link" href="security.html#sysvar_validate_password.mixed_case_count"><code class="literal">validate_password.mixed_case_count</code></a>,
          and
          <a class="link" href="security.html#sysvar_validate_password.special_char_count"><code class="literal">validate_password.special_char_count</code></a>.
        </p></li><li class="listitem"><p>
          <code class="literal">STRONG</code> policy adds the condition that
          password substrings of length 4 or longer must not match words
          in the dictionary file, if one has been specified. To specify
          the dictionary file, modify
          <a class="link" href="security.html#sysvar_validate_password.dictionary_file"><code class="literal">validate_password.dictionary_file</code></a>.
</p></li></ul>
</div>
<p>
      In addition, <code class="literal">validate_password</code> supports the
      capability of rejecting passwords that match the user name part of
      the effective user account for the current session, either forward
      or in reverse. To provide control over this capability,
      <code class="literal">validate_password</code> exposes a
      <a class="link" href="security.html#sysvar_validate_password.check_user_name"><code class="literal">validate_password.check_user_name</code></a>
      system variable, which is enabled by default.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="validate-password-installation"></a>6.4.3.1 Password Validation Component Installation and Uninstallation</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091716835248"></a><a class="indexterm" name="idm140091716833792"></a><a class="indexterm" name="idm140091716832288"></a><a class="indexterm" name="idm140091716830800"></a><p>
        This section describes how to install and uninstall the
        <code class="literal">validate_password</code> password-validation
        component. For general information about installing and
        uninstalling components, see
        <a class="xref" href="server-administration.html#server-components" title="5.5 MySQL Server Components">Section 5.5, “MySQL Server Components”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          If you install MySQL 8.0 using the
          <a class="ulink" href="https://dev.mysql.com/downloads/repo/yum/" target="_top">MySQL Yum
          repository</a>,
          <a class="ulink" href="https://dev.mysql.com/downloads/repo/suse/" target="_top">MySQL SLES
          Repository</a>, or
          <a class="link" href="installing.html#linux-installation-rpm" title="2.5.4 Installing MySQL on Linux Using RPM Packages from Oracle">RPM packages provided
          by Oracle</a>, the <code class="literal">validate_password</code>
          component is enabled by default after you start your MySQL
          Server for the first time.
        </p><p>
          Upgrades to MySQL 8.0 from 5.7
          using Yum or RPM packages leave the
          <code class="literal">validate_password</code> plugin in place. To make
          the transition from the <code class="literal">validate_password</code>
          plugin to the <code class="literal">validate_password</code> component,
          see <a class="xref" href="security.html#validate-password-transitioning" title="6.4.3.3 Transitioning to the Password Validation Component">Section 6.4.3.3, “Transitioning to the Password Validation Component”</a>.
</p>
</div>
<p>
        To be usable by the server, the component library file must be
        located in the MySQL plugin directory (the directory named by
        the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
        variable). If necessary, configure the plugin directory location
        by setting the value of
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
      </p><p>
        To install the <code class="literal">validate_password</code> component,
        use this statement:
      </p><pre data-lang="sql" class="programlisting">
INSTALL COMPONENT 'file://component_validate_password';
</pre><p>
        Component installation is a one-time operation that need not be
        done per server startup. <a class="link" href="sql-syntax.html#install-component" title="13.7.4.3 INSTALL COMPONENT Syntax"><code class="literal">INSTALL
        COMPONENT</code></a> loads the component, and also registers it
        in the <code class="literal">mysql.component</code> system table to cause
        it to be loaded during subsequent server startups.
      </p><p>
        To uninstall the <code class="literal">validate_password</code> component,
        use this statement:
      </p><pre data-lang="sql" class="programlisting">
UNINSTALL COMPONENT 'file://component_validate_password';
</pre><p>
        <a class="link" href="sql-syntax.html#uninstall-component" title="13.7.4.5 UNINSTALL COMPONENT Syntax"><code class="literal">UNINSTALL COMPONENT</code></a> unloads the
        component, and deregisters it from the
        <code class="literal">mysql.component</code> system table to cause it not
        to be loaded during subsequent server startups.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="validate-password-options-variables"></a>6.4.3.2 Password Validation Options and Variables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091716803440"></a><p>
        This section describes the system and status variables that
        <code class="literal">validate_password</code> provides to enable its
        operation to be configured and monitored.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#validate-password-system-variables" title="Password Validation Component System Variables">Password Validation Component System Variables</a></p></li><li class="listitem"><p><a class="xref" href="security.html#validate-password-status-variables" title="Password Validation Component Status Variables">Password Validation Component Status Variables</a></p></li><li class="listitem"><p><a class="xref" href="security.html#validate-password-plugin-options" title="Password Validation Plugin Options">Password Validation Plugin Options</a></p></li><li class="listitem"><p><a class="xref" href="security.html#validate-password-plugin-system-variables" title="Password Validation Plugin System Variables">Password Validation Plugin System Variables</a></p></li><li class="listitem"><p><a class="xref" href="security.html#validate-password-plugin-status-variables" title="Password Validation Plugin Status Variables">Password Validation Plugin Status Variables</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="validate-password-system-variables"></a>Password Validation Component System Variables</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091716793840"></a><p>
          If the <code class="literal">validate_password</code> component is
          enabled, it exposes several system variables that enable
          configuration of password checking:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'validate_password.%';</code></strong>
+--------------------------------------+--------+
| Variable_name                        | Value  |
+--------------------------------------+--------+
| validate_password.check_user_name    | ON     |
| validate_password.dictionary_file    |        |
| validate_password.length             | 8      |
| validate_password.mixed_case_count   | 1      |
| validate_password.number_count       | 1      |
| validate_password.policy             | MEDIUM |
| validate_password.special_char_count | 1      |
+--------------------------------------+--------+
</pre><p>
          To change how passwords are checked, you can set these system
          variables at server startup or at runtime. The following list
          describes the meaning of each variable.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_validate_password.check_user_name"></a>
              <a class="indexterm" name="idm140091716786992"></a>

              <a class="indexterm" name="idm140091716785952"></a>

              <a class="link" href="security.html#sysvar_validate_password.check_user_name"><code class="literal">validate_password.check_user_name</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password.check_user_name"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password.check-user-name[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.check_user_name">validate_password.check_user_name</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
              Whether <code class="literal">validate_password</code> compares
              passwords to the user name part of the effective user
              account for the current session and rejects them if they
              match. This variable is unavailable unless
              <code class="literal">validate_password</code> is installed.
            </p><p>
              By default,
              <a class="link" href="security.html#sysvar_validate_password.check_user_name"><code class="literal">validate_password.check_user_name</code></a>
              is enabled. This variable controls user name matching
              independent of the value of
              <a class="link" href="security.html#sysvar_validate_password.policy"><code class="literal">validate_password.policy</code></a>.
            </p><p>
              When
              <a class="link" href="security.html#sysvar_validate_password.check_user_name"><code class="literal">validate_password.check_user_name</code></a>
              is enabled, it has these effects:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  Checking occurs in all contexts for which
                  <code class="literal">validate_password</code> is invoked, which
                  includes use of statements such as
                  <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> or
                  <a class="link" href="sql-syntax.html#set-password" title="13.7.1.10 SET PASSWORD Syntax"><code class="literal">SET PASSWORD</code></a> to change
                  the current user's password, and invocation of
                  functions such as
                  <a class="link" href="functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a>.
                </p></li><li class="listitem"><p>
                  The user names used for comparison are taken from the
                  values of the <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a>
                  and <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a>
                  functions for the current session. An implication is
                  that a user who has sufficient privileges to set
                  another user's password can set the password to that
                  user's name, and cannot set that user's password to
                  the name of the user executing the statement. For
                  example, <code class="literal">'root'@'localhost'</code> can set
                  the password for
                  <code class="literal">'jeffrey'@'localhost'</code> to
                  <code class="literal">'jeffrey'</code>, but cannot set the
                  password to <code class="literal">'root</code>.
                </p></li><li class="listitem"><p>
                  Only the user name part of the
                  <a class="link" href="functions.html#function_user"><code class="literal">USER()</code></a> and
                  <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> function
                  values is used, not the host name part. If a user name
                  is empty, no comparison occurs.
                </p></li><li class="listitem"><p>
                  If a password is the same as the user name or its
                  reverse, a match occurs and the password is rejected.
                </p></li><li class="listitem"><p>
                  User-name matching is case sensitive. The password and
                  user name values are compared as binary strings on a
                  byte-by-byte basis.
                </p></li><li class="listitem"><p>
                  If a password matches the user name,
                  <a class="link" href="functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a>
                  returns 0 regardless of how other
                  <code class="literal">validate_password</code> system variables
                  are set.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_validate_password.dictionary_file"></a>
              <a class="indexterm" name="idm140091716723680"></a>

              <a class="indexterm" name="idm140091716722640"></a>

              <a class="link" href="security.html#sysvar_validate_password.dictionary_file"><code class="literal">validate_password.dictionary_file</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password.dictionary_file"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password.dictionary-file=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.dictionary_file">validate_password.dictionary_file</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>File name</td>
</tr></tbody></table>
</div>
<p>
              The path name of the dictionary file that
              <code class="literal">validate_password</code> uses for checking
              passwords. This variable is unavailable unless
              <code class="literal">validate_password</code> is installed.
            </p><p>
              By default, this variable has an empty value and
              dictionary checks are not performed. For dictionary checks
              to occur, the variable value must be nonempty. If the file
              is named as a relative path, it is interpreted relative to
              the server data directory. File contents should be
              lowercase, one word per line. Contents are treated as
              having a character set of <code class="literal">utf8</code>. The
              maximum permitted file size is 1MB.
            </p><p>
              For the dictionary file to be used during password
              checking, the password policy must be set to 2
              (<code class="literal">STRONG</code>); see the description of the
              <a class="link" href="security.html#sysvar_validate_password.policy"><code class="literal">validate_password.policy</code></a>
              system variable. Assuming that is true, each substring of
              the password of length 4 up to 100 is compared to the
              words in the dictionary file. Any match causes the
              password to be rejected. Comparisons are not case
              sensitive.
            </p><p>
              For
              <a class="link" href="functions.html#function_validate-password-strength"><code class="literal">VALIDATE_PASSWORD_STRENGTH()</code></a>,
              the password is checked against all policies, including
              <code class="literal">STRONG</code>, so the strength assessment
              includes the dictionary check regardless of the
              <a class="link" href="security.html#sysvar_validate_password.policy"><code class="literal">validate_password.policy</code></a>
              value.
            </p><p>
              <a class="link" href="security.html#sysvar_validate_password.dictionary_file"><code class="literal">validate_password.dictionary_file</code></a>
              can be set at runtime and assigning a value causes the
              named file to be read without a server restart.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password.length"></a>
              <a class="indexterm" name="idm140091716679184"></a>

              <a class="indexterm" name="idm140091716678080"></a>

              <a class="link" href="security.html#sysvar_validate_password.length"><code class="literal">validate_password.length</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password.length"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password.length=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.length">validate_password.length</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">8</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p>
              The minimum number of characters that
              <code class="literal">validate_password</code> requires passwords to
              have. This variable is unavailable unless
              <code class="literal">validate_password</code> is installed.
            </p><p>
              The
              <a class="link" href="security.html#sysvar_validate_password.length"><code class="literal">validate_password.length</code></a>
              minimum value is a function of several other related
              system variables. The value cannot be set less than the
              value of this expression:
            </p><pre data-lang="none" class="programlisting">
validate_password.number_count
+ validate_password.special_char_count
+ (2 * validate_password.mixed_case_count)
</pre><p>
              If <code class="literal">validate_password</code> adjusts the value
              of
              <a class="link" href="security.html#sysvar_validate_password.length"><code class="literal">validate_password.length</code></a>
              due to the preceding constraint, it writes a message to
              the error log.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password.mixed_case_count"></a>
              <a class="indexterm" name="idm140091716633392"></a>

              <a class="indexterm" name="idm140091716632352"></a>

              <a class="link" href="security.html#sysvar_validate_password.mixed_case_count"><code class="literal">validate_password.mixed_case_count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password.mixed_case_count"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password.mixed-case-count=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.mixed_case_count">validate_password.mixed_case_count</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p>
              The minimum number of lowercase and uppercase characters
              that <code class="literal">validate_password</code> requires
              passwords to have if the password policy is
              <code class="literal">MEDIUM</code> or stronger. This variable is
              unavailable unless <code class="literal">validate_password</code> is
              installed.
            </p><p>
              For a given
              <a class="link" href="security.html#sysvar_validate_password.mixed_case_count"><code class="literal">validate_password.mixed_case_count</code></a>
              value, the password must have that many lowercase
              characters, and that many uppercase characters.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password.number_count"></a>
              <a class="indexterm" name="idm140091716590384"></a>

              <a class="indexterm" name="idm140091716589280"></a>

              <a class="link" href="security.html#sysvar_validate_password.number_count"><code class="literal">validate_password.number_count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password.number_count"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password.number-count=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.number_count">validate_password.number_count</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p>
              The minimum number of numeric (digit) characters that
              <code class="literal">validate_password</code> requires passwords to
              have if the password policy is <code class="literal">MEDIUM</code>
              or stronger. This variable is unavailable unless
              <code class="literal">validate_password</code> is installed.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password.policy"></a>
              <a class="indexterm" name="idm140091716549344"></a>

              <a class="indexterm" name="idm140091716548240"></a>

              <a class="link" href="security.html#sysvar_validate_password.policy"><code class="literal">validate_password.policy</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password.policy"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password.policy=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.policy">validate_password.policy</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p><p class="valid-value"><code class="literal">2</code></p></td>
</tr></tbody></table>
</div>
<p>
              The password policy enforced by
              <code class="literal">validate_password</code>. This variable is
              unavailable unless <code class="literal">validate_password</code> is
              installed.
            </p><p>
              <a class="link" href="security.html#sysvar_validate_password.policy"><code class="literal">validate_password.policy</code></a>
              affects how <code class="literal">validate_password</code> uses its
              other policy-setting system variables, except for checking
              passwords against user names, which is controlled
              independently by
              <a class="link" href="security.html#sysvar_validate_password.check_user_name"><code class="literal">validate_password.check_user_name</code></a>.
            </p><p>
              The
              <a class="link" href="security.html#sysvar_validate_password.policy"><code class="literal">validate_password.policy</code></a>
              value can be specified using numeric values 0, 1, 2, or
              the corresponding symbolic values <code class="literal">LOW</code>,
              <code class="literal">MEDIUM</code>, <code class="literal">STRONG</code>. The
              following table describes the tests performed for each
              policy. For the length test, the required length is the
              value of the
              <a class="link" href="security.html#sysvar_validate_password.length"><code class="literal">validate_password.length</code></a>
              system variable. Similarly, the required values for the
              other tests are given by other
              <code class="literal">validate_password.<em class="replaceable"><code>xxx</code></em></code>
              variables.
</p>
<div class="informaltable">
<table summary="Password policies enforced by the validate_password component and the tests performed for each policy."><col width="20%"><col width="80%"><thead><tr>
                  <th scope="col">Policy</th>
                  <th scope="col">Tests Performed</th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">0</code> or <code class="literal">LOW</code></td>
                  <td>Length</td>
                </tr><tr>
                  <td scope="row"><code class="literal">1</code> or <code class="literal">MEDIUM</code></td>
                  <td>Length; numeric, lowercase/uppercase, and special characters</td>
                </tr><tr>
                  <td scope="row"><code class="literal">2</code> or <code class="literal">STRONG</code></td>
                  <td>Length; numeric, lowercase/uppercase, and special characters; dictionary
                    file</td>
</tr></tbody></table>
</div>
</li><li class="listitem"><p><a name="sysvar_validate_password.special_char_count"></a>
              <a class="indexterm" name="idm140091716480224"></a>

              <a class="indexterm" name="idm140091716479184"></a>

              <a class="link" href="security.html#sysvar_validate_password.special_char_count"><code class="literal">validate_password.special_char_count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password.special_char_count"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password.special-char-count=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password.special_char_count">validate_password.special_char_count</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p>
              The minimum number of nonalphanumeric characters that
              <code class="literal">validate_password</code> requires passwords to
              have if the password policy is <code class="literal">MEDIUM</code>
              or stronger. This variable is unavailable unless
              <code class="literal">validate_password</code> is installed.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="validate-password-status-variables"></a>Password Validation Component Status Variables</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091716438608"></a><p>
          If the <code class="literal">validate_password</code> component is
          enabled, it exposes status variables that provide operational
          information:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW STATUS LIKE 'validate_password.%';</code></strong>
+-----------------------------------------------+---------------------+
| Variable_name                                 | Value               |
+-----------------------------------------------+---------------------+
| validate_password.dictionary_file_last_parsed | 2018-01-15 08:33:49 |
| validate_password.dictionary_file_words_count | 1902                |
+-----------------------------------------------+---------------------+
</pre><p>
          The following list describes the meaning of each status
          variable.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_validate_password.dictionary_file_last_parsed"></a>
              <a class="indexterm" name="idm140091716432016"></a>

              <a class="indexterm" name="idm140091716430896"></a>

              <a class="link" href="security.html#statvar_validate_password.dictionary_file_last_parsed"><code class="literal">validate_password.dictionary_file_last_parsed</code></a>
            </p><p>
              When the dictionary file was last parsed. This variable is
              unavailable unless <code class="literal">validate_password</code> is
              installed.
            </p></li><li class="listitem"><p><a name="statvar_validate_password.dictionary_file_words_count"></a>
              <a class="indexterm" name="idm140091716425616"></a>

              <a class="indexterm" name="idm140091716424496"></a>

              <a class="link" href="security.html#statvar_validate_password.dictionary_file_words_count"><code class="literal">validate_password.dictionary_file_words_count</code></a>
            </p><p>
              The number of words read from the dictionary file. This
              variable is unavailable unless
              <code class="literal">validate_password</code> is installed.
</p></li></ul>
</div>

</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="validate-password-plugin-options"></a>Password Validation Plugin Options</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091716418816"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            In MySQL 8.0.4, the <code class="literal">validate_password</code>
            plugin was reimplemented as the
            <code class="literal">validate_password</code> component. The
            <code class="literal">validate_password</code> plugin is deprecated
            and will be removed in a future version of MySQL.
            Consequently, its options are also deprecated and will be
            removed. MySQL installations that use the plugin should make
            the transition to using the component instead. See
            <a class="xref" href="security.html#validate-password-transitioning" title="6.4.3.3 Transitioning to the Password Validation Component">Section 6.4.3.3, “Transitioning to the Password Validation Component”</a>.
</p>
</div>
<p>
          To control activation of the
          <code class="literal">validate_password</code> plugin, use this option:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_validate-password"></a>
              <a class="indexterm" name="idm140091716410880"></a>

              <a class="indexterm" name="idm140091716409424"></a>

              <a class="link" href="security.html#option_mysqld_validate-password"><code class="option">--validate-password[=<em class="replaceable"><code>value</code></em>]</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate-password"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password[=value]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">ON</code></p><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">FORCE</code></p><p class="valid-value"><code class="literal">FORCE_PLUS_PERMANENT</code></p></td>
</tr></tbody></table>
</div>
<p>
              This option controls how the server loads the deprecated
              <code class="literal">validate_password</code> plugin at startup.
              The value should be one of those available for
              plugin-loading options, as described in
              <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>. For example,
              <a class="link" href="security.html#option_mysqld_validate-password"><code class="option">--validate-password=FORCE_PLUS_PERMANENT</code></a>
              tells the server to load the plugin at startup and
              prevents it from being removed while the server is
              running.
            </p><p>
              This option is available only if the
              <code class="literal">validate_password</code> plugin has been
              previously registered with <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL
              PLUGIN</code></a> or is loaded with
              <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a>. See
              <a class="xref" href="security.html#validate-password-installation" title="6.4.3.1 Password Validation Component Installation and Uninstallation">Section 6.4.3.1, “Password Validation Component Installation and Uninstallation”</a>.
</p></li></ul>
</div>

</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="validate-password-plugin-system-variables"></a>Password Validation Plugin System Variables</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091716376272"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            In MySQL 8.0.4, the <code class="literal">validate_password</code>
            plugin was reimplemented as the
            <code class="literal">validate_password</code> component. The
            <code class="literal">validate_password</code> plugin is deprecated
            and will be removed in a future version of MySQL.
            Consequently, its system variables are also deprecated and
            will be removed. Use the corresponding system variables of
            the <code class="literal">validate_password</code> component; see
            <a class="xref" href="security.html#validate-password-system-variables" title="Password Validation Component System Variables">Password Validation Component System Variables</a>. MySQL
            installations that use the plugin should make the transition
            to using the component instead. See
            <a class="xref" href="security.html#validate-password-transitioning" title="6.4.3.3 Transitioning to the Password Validation Component">Section 6.4.3.3, “Transitioning to the Password Validation Component”</a>.
</p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_validate_password_check_user_name"></a>
              <a class="indexterm" name="idm140091716367904"></a>

              <a class="indexterm" name="idm140091716366864"></a>

              <a class="link" href="security.html#sysvar_validate_password_check_user_name"><code class="literal">validate_password_check_user_name</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_check_user_name"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password-check-user-name[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_check_user_name">validate_password_check_user_name</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
              This <code class="literal">validate_password</code> plugin system
              variable is deprecated and will be removed in a future
              version of MySQL. Use the corresponding
              <a class="link" href="security.html#sysvar_validate_password.check_user_name"><code class="literal">validate_password.check_user_name</code></a>
              system variable of the
              <code class="literal">validate_password</code> component instead.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_dictionary_file"></a>
              <a class="indexterm" name="idm140091716331888"></a>

              <a class="indexterm" name="idm140091716330848"></a>

              <a class="link" href="security.html#sysvar_validate_password_dictionary_file"><code class="literal">validate_password_dictionary_file</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_dictionary_file"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password-dictionary-file=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_dictionary_file">validate_password_dictionary_file</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>File name</td>
</tr></tbody></table>
</div>
<p>
              This <code class="literal">validate_password</code> plugin system
              variable is deprecated and will be removed in a future
              version of MySQL. Use the corresponding
              <a class="link" href="security.html#sysvar_validate_password.dictionary_file"><code class="literal">validate_password.dictionary_file</code></a>
              system variable of the
              <code class="literal">validate_password</code> component instead.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_length"></a>
              <a class="indexterm" name="idm140091716298928"></a>

              <a class="indexterm" name="idm140091716297824"></a>

              <a class="link" href="security.html#sysvar_validate_password_length"><code class="literal">validate_password_length</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_length"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password-length=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_length">validate_password_length</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">8</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p>
              This <code class="literal">validate_password</code> plugin system
              variable is deprecated and will be removed in a future
              version of MySQL. Use the corresponding
              <a class="link" href="security.html#sysvar_validate_password.length"><code class="literal">validate_password.length</code></a>
              system variable of the
              <code class="literal">validate_password</code> component instead.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_mixed_case_count"></a>
              <a class="indexterm" name="idm140091716259984"></a>

              <a class="indexterm" name="idm140091716258944"></a>

              <a class="link" href="security.html#sysvar_validate_password_mixed_case_count"><code class="literal">validate_password_mixed_case_count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_mixed_case_count"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password-mixed-case-count=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_mixed_case_count">validate_password_mixed_case_count</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p>
              This <code class="literal">validate_password</code> plugin system
              variable is deprecated and will be removed in a future
              version of MySQL. Use the corresponding
              <a class="link" href="security.html#sysvar_validate_password.mixed_case_count"><code class="literal">validate_password.mixed_case_count</code></a>
              system variable of the
              <code class="literal">validate_password</code> component instead.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_number_count"></a>
              <a class="indexterm" name="idm140091716220976"></a>

              <a class="indexterm" name="idm140091716219872"></a>

              <a class="link" href="security.html#sysvar_validate_password_number_count"><code class="literal">validate_password_number_count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_number_count"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password-number-count=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_number_count">validate_password_number_count</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p>
              This <code class="literal">validate_password</code> plugin system
              variable is deprecated and will be removed in a future
              version of MySQL. Use the corresponding
              <a class="link" href="security.html#sysvar_validate_password.number_count"><code class="literal">validate_password.number_count</code></a>
              system variable of the
              <code class="literal">validate_password</code> component instead.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_policy"></a>
              <a class="indexterm" name="idm140091716182064"></a>

              <a class="indexterm" name="idm140091716180960"></a>

              <a class="link" href="security.html#sysvar_validate_password_policy"><code class="literal">validate_password_policy</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_policy"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password-policy=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_policy">validate_password_policy</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">0</code></p><p class="valid-value"><code class="literal">1</code></p><p class="valid-value"><code class="literal">2</code></p></td>
</tr></tbody></table>
</div>
<p>
              This <code class="literal">validate_password</code> plugin system
              variable is deprecated and will be removed in a future
              version of MySQL. Use the corresponding
              <a class="link" href="security.html#sysvar_validate_password.policy"><code class="literal">validate_password.policy</code></a>
              system variable of the
              <code class="literal">validate_password</code> component instead.
            </p></li><li class="listitem"><p><a name="sysvar_validate_password_special_char_count"></a>
              <a class="indexterm" name="idm140091716140800"></a>

              <a class="indexterm" name="idm140091716139760"></a>

              <a class="link" href="security.html#sysvar_validate_password_special_char_count"><code class="literal">validate_password_special_char_count</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for validate_password_special_char_count"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--validate-password-special-char-count=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_validate_password_special_char_count">validate_password_special_char_count</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p>
              This <code class="literal">validate_password</code> plugin system
              variable is deprecated and will be removed in a future
              version of MySQL. Use the corresponding
              <a class="link" href="security.html#sysvar_validate_password.special_char_count"><code class="literal">validate_password.special_char_count</code></a>
              system variable of the
              <code class="literal">validate_password</code> component instead.
</p></li></ul>
</div>

</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="validate-password-plugin-status-variables"></a>Password Validation Plugin Status Variables</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091716101296"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            In MySQL 8.0.4, the <code class="literal">validate_password</code>
            plugin was reimplemented as the
            <code class="literal">validate_password</code> component. The
            <code class="literal">validate_password</code> plugin is deprecated
            and will be removed in a future version of MySQL.
            Consequently, its status variables are also deprecated and
            will be removed. Use the corresponding status variables of
            the <code class="literal">validate_password</code> component; see
            <a class="xref" href="security.html#validate-password-status-variables" title="Password Validation Component Status Variables">Password Validation Component Status Variables</a>. MySQL
            installations that use the plugin should make the transition
            to using the component instead. See
            <a class="xref" href="security.html#validate-password-transitioning" title="6.4.3.3 Transitioning to the Password Validation Component">Section 6.4.3.3, “Transitioning to the Password Validation Component”</a>.
</p>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_validate_password_dictionary_file_last_parsed"></a>
              <a class="indexterm" name="idm140091716092880"></a>

              <a class="indexterm" name="idm140091716091760"></a>

              <a class="link" href="security.html#statvar_validate_password_dictionary_file_last_parsed"><code class="literal">validate_password_dictionary_file_last_parsed</code></a>
            </p><p>
              This <code class="literal">validate_password</code> plugin status
              variable is deprecated and will be removed in a future
              version of MySQL. Use the corresponding
              <a class="link" href="security.html#statvar_validate_password.dictionary_file_last_parsed"><code class="literal">validate_password.dictionary_file_last_parsed</code></a>
              status variable of the
              <code class="literal">validate_password</code> component instead.
            </p></li><li class="listitem"><p><a name="statvar_validate_password_dictionary_file_words_count"></a>
              <a class="indexterm" name="idm140091716084416"></a>

              <a class="indexterm" name="idm140091716083296"></a>

              <a class="link" href="security.html#statvar_validate_password_dictionary_file_words_count"><code class="literal">validate_password_dictionary_file_words_count</code></a>
            </p><p>
              This <code class="literal">validate_password</code> plugin status
              variable is deprecated and will be removed in a future
              version of MySQL. Use the corresponding
              <a class="link" href="security.html#statvar_validate_password.dictionary_file_words_count"><code class="literal">validate_password.dictionary_file_words_count</code></a>
              status variable of the
              <code class="literal">validate_password</code> component instead.
</p></li></ul>
</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="validate-password-transitioning"></a>6.4.3.3 Transitioning to the Password Validation Component</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091716075312"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          In MySQL 8.0.4, the <code class="literal">validate_password</code>
          plugin was reimplemented as the
          <code class="literal">validate_password</code> component. The
          <code class="literal">validate_password</code> plugin is deprecated and
          will be removed in a future version of MySQL.
</p>
</div>
<p>
        MySQL installations that currently use the
        <code class="literal">validate_password</code> plugin should make the
        transition to using the <code class="literal">validate_password</code>
        component instead. To do so, use the following procedure. The
        procedure installs the component before uninstalling the plugin,
        to avoid having a time window during which no password
        validation occurs. (The component and plugin can be installed
        simultaneously. In this case, the server attempts to use the
        component, falling back to the plugin if the component is
        unavailable.)
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Install the <code class="literal">validate_password</code> component:
          </p><pre data-lang="sql" class="programlisting">
INSTALL COMPONENT 'file://component_validate_password';
</pre></li><li class="listitem"><p>
            Test the <code class="literal">validate_password</code> component to
            ensure that it works as expected. If you need to set any
            <code class="literal">validate_password.<em class="replaceable"><code>xxx</code></em></code>
            system variables, you can do so at runtime using
            <code class="literal">SET
            GLOBAL</code>. (Any option file changes that must be made
            are performed in the next step.)
          </p></li><li class="listitem"><p>
            Adjust any references to the plugin system and status
            variables to refer to the corresponding component system and
            status variables. Suppose that you configure the plugin at
            startup using an option file like this:
          </p><pre data-lang="ini" class="programlisting">
[mysqld]
validate-password=FORCE_PLUS_PERMANENT
validate_password_dictionary_file=/usr/share/dict/words
validate_password_length=10
validate_password_number_count=2
</pre><p>
            To adjust the option file, omit the
            <a class="link" href="security.html#option_mysqld_validate-password"><code class="option">--validate-password</code></a> option
            (it applies only to the plugin, not the component), and
            modify the system variable references:
          </p><pre data-lang="ini" class="programlisting">
[mysqld]
validate_password.dictionary_file=/usr/share/dict/words
validate_password.length=10
validate_password.number_count=2
</pre><p>
            Similar adjustments are needed for applications that refer
            at runtime to <code class="literal">validate_password</code> plugin
            system and status variables.
          </p></li><li class="listitem"><p>
            Uninstall the <code class="literal">validate_password</code> plugin:
          </p><pre data-lang="sql" class="programlisting">
UNINSTALL PLUGIN validate_password;
</pre><p>
            If the <code class="literal">validate_password</code> plugin is loaded
            at server startup using a
            <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a> or
            <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option,
            omit that option from the server startup procedure. For
            example, if the option is listed in a server option file,
            remove it from the file.
          </p></li><li class="listitem"><p>
            Restart the server.
</p></li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="keyring"></a>6.4.4 The MySQL Keyring</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#keyring-installation">6.4.4.1 Keyring Plugin Installation</a></span></dt><dt><span class="section"><a href="security.html#keyring-file-plugin">6.4.4.2 Using the keyring_file File-Based Plugin</a></span></dt><dt><span class="section"><a href="security.html#keyring-encrypted-file-plugin">6.4.4.3 Using the keyring_encrypted_file Keyring Plugin</a></span></dt><dt><span class="section"><a href="security.html#keyring-okv-plugin">6.4.4.4 Using the keyring_okv KMIP Plugin</a></span></dt><dt><span class="section"><a href="security.html#keyring-aws-plugin">6.4.4.5 Using the keyring_aws Amazon Web Services Keyring Plugin</a></span></dt><dt><span class="section"><a href="security.html#keyring-key-migration">6.4.4.6 Migrating Keys Between Keyring Keystores</a></span></dt><dt><span class="section"><a href="security.html#keyring-key-types">6.4.4.7 Supported Keyring Key Types</a></span></dt><dt><span class="section"><a href="security.html#keyring-udfs-general-purpose">6.4.4.8 General-Purpose Keyring Key-Management Functions</a></span></dt><dt><span class="section"><a href="security.html#keyring-udfs-plugin-specific">6.4.4.9 Plugin-Specific Keyring Key-Management Functions</a></span></dt><dt><span class="section"><a href="security.html#keyring-options">6.4.4.10 Keyring Command Options</a></span></dt><dt><span class="section"><a href="security.html#keyring-system-variables">6.4.4.11 Keyring System Variables</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091716046832"></a><p>
      MySQL Server supports a keyring that enables internal server
      components and plugins to securely store sensitive information for
      later retrieval. The implementation is plugin-based:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">keyring_file</code> plugin stores keyring data
          in a file local to the server host. This plugin is available
          in all MySQL distributions, Community Edition and Enterprise
          Edition included. See <a class="xref" href="security.html#keyring-file-plugin" title="6.4.4.2 Using the keyring_file File-Based Plugin">Section 6.4.4.2, “Using the keyring_file File-Based Plugin”</a>.
        </p></li><li class="listitem"><p>
          The <code class="literal">keyring_encrypted_file</code> plugin stores
          keyring data in an encrypted file local to the server host.
          This plugin is available in MySQL Enterprise Edition distributions. See
          <a class="xref" href="security.html#keyring-encrypted-file-plugin" title="6.4.4.3 Using the keyring_encrypted_file Keyring Plugin">Section 6.4.4.3, “Using the keyring_encrypted_file Keyring Plugin”</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">keyring_okv</code> is a KMIP 1.1 plugin for use
          with KMIP-compatible back end keyring storage products such as
          Oracle Key Vault and Gemalto SafeNet KeySecure Appliance. This
          plugin is available in MySQL Enterprise Edition distributions. See
          <a class="xref" href="security.html#keyring-okv-plugin" title="6.4.4.4 Using the keyring_okv KMIP Plugin">Section 6.4.4.4, “Using the keyring_okv KMIP Plugin”</a>.
        </p></li><li class="listitem"><p>
          The <code class="literal">keyring_aws</code> plugin communicates with
          the Amazon Web Services Key Management Service for key
          generation and uses a local file for key storage. This plugin
          is available in MySQL Enterprise Edition distributions. See
          <a class="xref" href="security.html#keyring-aws-plugin" title="6.4.4.5 Using the keyring_aws Amazon Web Services Keyring Plugin">Section 6.4.4.5, “Using the keyring_aws Amazon Web Services Keyring Plugin”</a>.
        </p></li><li class="listitem"><p>
          A MySQL server operational mode enables migration of keys
          between underlying keyring keystores. This enables DBAs to
          switch a MySQL installation from one keyring plugin to
          another. See <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.6 Migrating Keys Between Keyring Keystores">Section 6.4.4.6, “Migrating Keys Between Keyring Keystores”</a>.
        </p></li><li class="listitem"><p>
          An SQL interface for keyring key management is implemented as
          a set of user-defined functions (UDFs). See
          <a class="xref" href="security.html#keyring-udfs-general-purpose" title="6.4.4.8 General-Purpose Keyring Key-Management Functions">Section 6.4.4.8, “General-Purpose Keyring Key-Management Functions”</a>.
        </p></li><li class="listitem"><p>
          As of MySQL 8.0.16, the
          <a class="link" href="performance-schema.html#keyring-keys-table" title="26.12.17.2 The keyring_keys table"><code class="literal">keyring_keys</code></a> table exposes
          metadata for keys in the keyring. Key metadata includes key
          IDs, key owners, and backend key IDs. The
          <a class="link" href="performance-schema.html#keyring-keys-table" title="26.12.17.2 The keyring_keys table"><code class="literal">keyring_keys</code></a> table does not
          expose any sensitive keyring data such as key contents. See
          <a class="xref" href="performance-schema.html#keyring-keys-table" title="26.12.17.2 The keyring_keys table">Section 26.12.17.2, “The keyring_keys table”</a>.
</p><a class="indexterm" name="idm140091716026768"></a><a class="indexterm" name="idm140091716025280"></a></li></ul>
</div>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p>
        The <code class="literal">keyring_file</code> and
        <code class="literal">keyring_encrypted_file</code> plugins for encryption
        key management are not intended as a regulatory compliance
        solution. Security standards such as PCI, FIPS, and others
        require use of key management systems to secure, manage, and
        protect encryption keys in key vaults or hardware security
        modules (HSMs).
</p>
</div>
<p>
      Uses for the keyring within MySQL include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">InnoDB</code> storage engine uses the keyring
          to store its key for tablespace encryption.
          <code class="literal">InnoDB</code> can use any supported keyring
          plugin.
        </p></li><li class="listitem"><p>
          MySQL Enterprise Audit uses the keyring to store the audit log file
          encryption password. The audit log plugin can use any
          supported keyring plugin.
        </p></li><li class="listitem"><p>
          When binary log encryption has been activated for a MySQL
          server (by setting
          <a class="link" href="replication.html#sysvar_binlog_encryption"><code class="literal">binlog_encryption=ON</code></a>), the
          binary log encryption keys used to encrypt the file passwords
          for the binary log files and relay log files are stored in the
          keyring. Any supported keyring plugin can be used to store
          binary log encryption keys. Binary log encryption keys are
          retained as long as there are files on the server that were
          encrypted using them. When the binary log master key is
          rotated manually, all binary log encryption keys that no
          longer apply to any retained binary log files or relay log
          files are cleared from the keyring. If a retained binary log
          file or relay log file cannot be initialized for
          re-encryption, the relevant binary log encryption keys are not
          deleted in case the files can be recovered in the future. For
          example, this might be the case if a file listed in a binary
          log index file is currently unreadable, or if a channel fails
          to initialize. For more information, see
          <a class="xref" href="replication.html#replication-binlog-encryption" title="17.3.10 Encrypting Binary Log Files and Relay Log Files">Section 17.3.10, “Encrypting Binary Log Files and Relay Log Files”</a>.
</p></li></ul>
</div>
<p>
      For general keyring installation instructions, see
      <a class="xref" href="security.html#keyring-installation" title="6.4.4.1 Keyring Plugin Installation">Section 6.4.4.1, “Keyring Plugin Installation”</a>. For information specific
      to a given keyring plugin, see the section describing that plugin.
    </p><p>
      For information about using the keyring UDFs, see
      <a class="xref" href="security.html#keyring-udfs-general-purpose" title="6.4.4.8 General-Purpose Keyring Key-Management Functions">Section 6.4.4.8, “General-Purpose Keyring Key-Management Functions”</a>.
    </p><p>
      Keyring plugins and UDFs access a keyring service that provides
      the interface for server components to the keyring. For
      information about accessing the keyring plugin service and writing
      keyring plugins, see <a class="xref" href="extending-mysql.html#keyring-service" title="29.3.2 The Keyring Service">Section 29.3.2, “The Keyring Service”</a>, and
      <a class="xref" href="extending-mysql.html#writing-keyring-plugins" title="29.2.4.12 Writing Keyring Plugins">Section 29.2.4.12, “Writing Keyring Plugins”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-installation"></a>6.4.4.1 Keyring Plugin Installation</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091716005952"></a><a class="indexterm" name="idm140091716004496"></a><a class="indexterm" name="idm140091716003008"></a><a class="indexterm" name="idm140091716001504"></a><a class="indexterm" name="idm140091716000016"></a><a class="indexterm" name="idm140091715998528"></a><a class="indexterm" name="idm140091715997040"></a><a class="indexterm" name="idm140091715995552"></a><p>
        Keyring service consumers require a keyring plugin to be
        installed. MySQL provides these plugin choices:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">keyring_file</code>: A plugin that stores
            keyring data in a file local to the server host. Available
            in all MySQL distributions.
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_encrypted_file</code>: A plugin that
            stores keyring data in an encrypted file local to the server
            host. Available in MySQL Enterprise Edition distributions.
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_okv</code>: A plugin that uses
            KMIP-compatible back end keyring storage products such as
            Oracle Key Vault and Gemalto SafeNet KeySecure Appliance.
            Available in MySQL Enterprise Edition distributions.
          </p></li><li class="listitem"><p>
            <code class="literal">keyring_aws</code>: A plugin that communicates
            with the Amazon Web Services Key Management Service as a
            back end for key generation and uses a local file for key
            storage. Available in MySQL Enterprise Edition distributions.
</p></li></ul>
</div>
<p>
        This section describes how to install the keyring plugin of your
        choosing. For general information about installing plugins, see
        <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>.
      </p><p>
        If you intend to use keyring user-defined functions (UDFs) in
        conjunction with the keyring plugin, install the UDFs following
        keyring installation using the instructions in
        <a class="xref" href="security.html#keyring-udfs-general-purpose" title="6.4.4.8 General-Purpose Keyring Key-Management Functions">Section 6.4.4.8, “General-Purpose Keyring Key-Management Functions”</a>.
      </p><p>
        To be usable by the server, the plugin library file must be
        located in the MySQL plugin directory (the directory named by
        the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
        variable). If necessary, configure the plugin directory location
        by setting the value of
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
      </p><p>
        Installation for each keyring plugin is similar. The following
        instructions use <code class="literal">keyring_file</code>. Users of a
        different keyring plugin can substitute its name for
        <code class="literal">keyring_file</code>.
      </p><p>
        The <code class="literal">keyring_file</code> plugin library file base
        name is <code class="literal">keyring_file</code>. The file name suffix
        differs per platform (for example, <code class="filename">.so</code> for
        Unix and Unix-like systems, <code class="filename">.dll</code> for
        Windows).
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Only one keyring plugin should be enabled at a time. Enabling
          multiple keyring plugins is unsupported and results may not be
          as anticipated.
</p>
</div>
<p>
        The keyring plugin must be loaded early during the server
        startup sequence so that server components can access it as
        necessary during their own initialization. For example, the
        <code class="literal">InnoDB</code> storage engine uses the keyring for
        tablespace encryption, so the keyring plugin must be loaded and
        available prior to <code class="literal">InnoDB</code> initialization.
      </p><p>
        To load the plugin, use the
        <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a> option to
        name the plugin library file that contains it. For example, on
        platforms where the plugin library file suffix is
        <code class="filename">.so</code>, use these lines in the server
        <code class="filename">my.cnf</code> file (adjust the
        <code class="filename">.so</code> suffix for your platform as necessary):
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
early-plugin-load=keyring_file.so
</pre><p>
        Before starting the server, check the notes for your chosen
        keyring plugin to see whether it permits or requires additional
        configuration:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            For <code class="literal">keyring_file</code>:
            <a class="xref" href="security.html#keyring-file-plugin" title="6.4.4.2 Using the keyring_file File-Based Plugin">Section 6.4.4.2, “Using the keyring_file File-Based Plugin”</a>.
          </p></li><li class="listitem"><p>
            For <code class="literal">keyring_okv</code>:
            <a class="xref" href="security.html#keyring-okv-plugin" title="6.4.4.4 Using the keyring_okv KMIP Plugin">Section 6.4.4.4, “Using the keyring_okv KMIP Plugin”</a>.
          </p></li><li class="listitem"><p>
            For <code class="literal">keyring_aws</code>:
            <a class="xref" href="security.html#keyring-aws-plugin" title="6.4.4.5 Using the keyring_aws Amazon Web Services Keyring Plugin">Section 6.4.4.5, “Using the keyring_aws Amazon Web Services Keyring Plugin”</a>
</p></li></ul>
</div>
<p>
        After performing any plugin-specific configuration, verify
        plugin installation. With the MySQL server running, examine the
        <a class="link" href="information-schema.html#plugins-table" title="25.18 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table or
        use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.6.25 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a> statement
        (see <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 Obtaining Server Plugin Information">Section 5.6.2, “Obtaining Server Plugin Information”</a>). For
        example:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE 'keyring%';</code></strong>
+--------------+---------------+
| PLUGIN_NAME  | PLUGIN_STATUS |
+--------------+---------------+
| keyring_file | ACTIVE        |
+--------------+---------------+
</pre><p>
        If the plugin fails to initialize, check the server error log
        for diagnostic messages.
      </p><p>
        If no keyring plugin is available when a server component tries
        to access the keyring service, the service cannot be used by
        that component. As a result, the component may fail to
        initialize or may initialize with limited functionality. For
        example, if <code class="literal">InnoDB</code> finds that there are
        encrypted tablespaces when it initializes, it attempts to access
        the keyring. If the keyring is unavailable,
        <code class="literal">InnoDB</code> can access only unencrypted
        tablespaces. To ensure that <code class="literal">InnoDB</code> can access
        encrypted tablespaces as well, use
        <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a> to load the
        keyring plugin.
      </p><p>
        Plugins can be loaded by other methods, such as the
        <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a> or
        <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> option or the
        <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statement.
        However, keyring plugins loaded using those methods may be
        available too late in the server startup sequence for certain
        server components, such as <code class="literal">InnoDB</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Plugin loading using
            <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a> or
            <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a> occurs
            after <code class="literal">InnoDB</code> initialization.
          </p></li><li class="listitem"><p>
            Plugins installed using <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL
            PLUGIN</code></a> are registered in the
            <code class="literal">mysql.plugin</code> system table and loaded
            automatically for subsequent server restarts. However,
            because <code class="literal">mysql.plugin</code> is an
            <code class="literal">InnoDB</code> table, any plugins named in it can
            be loaded during startup only after
            <code class="literal">InnoDB</code> initialization.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-file-plugin"></a>6.4.4.2 Using the keyring_file File-Based Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091715933440"></a><a class="indexterm" name="idm140091715932384"></a><p>
        The <code class="literal">keyring_file</code> plugin is a keyring plugin
        that stores keyring data in a file local to the server host.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
          The <code class="literal">keyring_file</code> plugin for encryption key
          management is not intended as a regulatory compliance
          solution. Security standards such as PCI, FIPS, and others
          require use of key management systems to secure, manage, and
          protect encryption keys in key vaults or hardware security
          modules (HSMs).
</p>
</div>
<p>
        To install the <code class="literal">keyring_file</code> plugin, use the
        general keyring installation instructions found in
        <a class="xref" href="security.html#keyring-installation" title="6.4.4.1 Keyring Plugin Installation">Section 6.4.4.1, “Keyring Plugin Installation”</a>, together with the
        configuration information specific to
        <code class="literal">keyring_file</code> found here.
      </p><p>
        To be usable during the server startup process,
        <code class="literal">keyring_file</code> must be loaded using the
        <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a> option. The
        <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> system
        variable optionally configures the location of the file used by
        the <code class="literal">keyring_file</code> plugin for data storage. The
        default value is platform specific. To configure the file
        location explicitly, set the variable value at startup. For
        example, use these lines in the server
        <code class="filename">my.cnf</code> file (adjust the
        <code class="filename">.so</code> suffix and file location for your
        platform as necessary):
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
early-plugin-load=keyring_file.so
keyring_file_data=/usr/local/mysql/mysql-keyring/keyring
</pre><p>
        Keyring operations are transactional: The
        <code class="literal">keyring_file</code> plugin uses a backup file during
        write operations to ensure that it can roll back to the original
        file if an operation fails. The backup file has the same name as
        the value of the
        <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> system
        variable with a suffix of <code class="filename">.backup</code>.
      </p><p>
        For additional information about
        <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a>, see
        <a class="xref" href="security.html#keyring-system-variables" title="6.4.4.11 Keyring System Variables">Section 6.4.4.11, “Keyring System Variables”</a>.
      </p><p>
        To ensure that keys are flushed only when the correct keyring
        storage file exists, <code class="literal">keyring_file</code> stores a
        SHA-256 checksum of the keyring in the file. Before updating the
        file, the plugin verifies that it contains the expected
        checksum.
      </p><p>
        The <code class="literal">keyring_file</code> plugin supports the
        functions that comprise the standard keyring service interface.
        Keyring operations performed by those functions are accessible
        at two levels:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            SQL interface: In SQL statements, call the user-defined
            functions (UDFs) described in
            <a class="xref" href="security.html#keyring-udfs-general-purpose" title="6.4.4.8 General-Purpose Keyring Key-Management Functions">Section 6.4.4.8, “General-Purpose Keyring Key-Management Functions”</a>.
          </p></li><li class="listitem"><p>
            C interface: In C-language code, call the keyring service
            functions described in <a class="xref" href="extending-mysql.html#keyring-service" title="29.3.2 The Keyring Service">Section 29.3.2, “The Keyring Service”</a>.
</p></li></ul>
</div>
<p>
        Example (using UDFs):
      </p><pre data-lang="sql" class="programlisting">
SELECT keyring_key_generate('MyKey', 'AES', 32);
SELECT keyring_key_remove('MyKey');
</pre><p>
        The key types permitted by <code class="literal">keyring_file</code> are
        described in <a class="xref" href="security.html#keyring-key-types" title="6.4.4.7 Supported Keyring Key Types">Section 6.4.4.7, “Supported Keyring Key Types”</a>.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-encrypted-file-plugin"></a>6.4.4.3 Using the keyring_encrypted_file Keyring Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091715901360"></a><a class="indexterm" name="idm140091715900320"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The <code class="literal">keyring_encrypted_file</code> plugin is an
          extension included in MySQL Enterprise Edition, a commercial product. To learn
          more about commercial products, see
          <a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a>.
</p>
</div>
<p>
        The <code class="literal">keyring_encrypted_file</code> plugin is a
        keyring plugin that stores keyring data in an encrypted file
        local to the server host. This plugin is available as of MySQL
        5.7.21.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
          The <code class="literal">keyring_encrypted_file</code> plugin for
          encryption key management is not intended as a regulatory
          compliance solution. Security standards such as PCI, FIPS, and
          others require use of key management systems to secure,
          manage, and protect encryption keys in key vaults or hardware
          security modules (HSMs).
</p>
</div>
<p>
        To install the <code class="literal">keyring_encrypted_file</code> plugin,
        use the general keyring installation instructions found in
        <a class="xref" href="security.html#keyring-installation" title="6.4.4.1 Keyring Plugin Installation">Section 6.4.4.1, “Keyring Plugin Installation”</a>, together with the
        configuration information specific to
        <code class="literal">keyring_encrypted_file</code> found here.
      </p><p>
        To be usable during the server startup process,
        <code class="literal">keyring_encrypted_file</code> must be loaded using
        the <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a> option.
        To specify the password for encrypting the keyring data file,
        set the
        <a class="link" href="security.html#sysvar_keyring_encrypted_file_password"><code class="literal">keyring_encrypted_file_password</code></a>
        system variable. (The password is mandatory; if not specified at
        server startup, <code class="literal">keyring_encrypted_file</code>
        initialization fails.) The
        <a class="link" href="security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a>
        system variable optionally configures the location of the file
        used by the <code class="literal">keyring_encrypted_file</code> plugin for
        data storage. The default value is platform specific. To
        configure the file location explicitly, set the variable value
        at startup. For example, use these lines in the server
        <code class="filename">my.cnf</code> file (adjust the
        <code class="filename">.so</code> suffix and file location for your
        platform as necessary and substitute your chosen password):
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
early-plugin-load=keyring_encrypted_file.so
keyring_encrypted_file_data=/usr/local/mysql/mysql-keyring/keyring-encrypted
keyring_encrypted_file_password=<em class="replaceable"><code>password</code></em>
</pre><p>
        Because the <code class="filename">my.cnf</code> file stores a password
        when written as shown, it should have a restrictive mode and be
        accessible only to the account used to run the MySQL server.
      </p><p>
        Keyring operations are transactional: The
        <code class="literal">keyring_encrypted_file</code> plugin uses a backup
        file during write operations to ensure that it can roll back to
        the original file if an operation fails. The backup file has the
        same name as the value of the
        <a class="link" href="security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a>
        system variable with a suffix of <code class="filename">.backup</code>.
      </p><p>
        For additional information about the system variables used to
        configure the <code class="literal">keyring_encrypted_file</code> plugin,
        see <a class="xref" href="security.html#keyring-system-variables" title="6.4.4.11 Keyring System Variables">Section 6.4.4.11, “Keyring System Variables”</a>.
      </p><p>
        To ensure that keys are flushed only when the correct keyring
        storage file exists, <code class="literal">keyring_encrypted_file</code>
        stores a SHA-256 checksum of the keyring in the file. Before
        updating the file, the plugin verifies that it contains the
        expected checksum. In addition,
        <code class="literal">keyring_encrypted_file</code> encrypts file contents
        using AES before writing the file, and decrypts file contents
        after reading the file.
      </p><p>
        The <code class="literal">keyring_encrypted_file</code> plugin supports
        the functions that comprise the standard keyring service
        interface. Keyring operations performed by those functions are
        accessible at two levels:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            SQL interface: In SQL statements, call the user-defined
            functions (UDFs) described in
            <a class="xref" href="security.html#keyring-udfs-general-purpose" title="6.4.4.8 General-Purpose Keyring Key-Management Functions">Section 6.4.4.8, “General-Purpose Keyring Key-Management Functions”</a>.
          </p></li><li class="listitem"><p>
            C interface: In C-language code, call the keyring service
            functions described in <a class="xref" href="extending-mysql.html#keyring-service" title="29.3.2 The Keyring Service">Section 29.3.2, “The Keyring Service”</a>.
</p></li></ul>
</div>
<p>
        Example (using UDFs):
      </p><pre data-lang="sql" class="programlisting">
SELECT keyring_key_generate('MyKey', 'AES', 32);
SELECT keyring_key_remove('MyKey');
</pre><p>
        The key types permitted by
        <code class="literal">keyring_encrypted_file</code> are described in
        <a class="xref" href="security.html#keyring-key-types" title="6.4.4.7 Supported Keyring Key Types">Section 6.4.4.7, “Supported Keyring Key Types”</a>.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-okv-plugin"></a>6.4.4.4 Using the keyring_okv KMIP Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091715862816"></a><a class="indexterm" name="idm140091715861760"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The <code class="literal">keyring_okv</code> plugin is an extension
          included in MySQL Enterprise Edition, a commercial product. To learn more about
          commercial products, see <a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a>.
</p>
</div>
<p>
        The Key Management Interoperability Protocol (KMIP) enables
        communication of cryptographic keys between a key management
        server and its clients. The <code class="literal">keyring_okv</code>
        keyring plugin uses the KMIP 1.1 protocol to communicate
        securely as a client of a KMIP back end. Keyring material is
        generated exclusively by the back end, not by
        <code class="literal">keyring_okv</code>. The plugin works with these
        KMIP-compatible products:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Oracle Key Vault
          </p></li><li class="listitem"><p>
            Gemalto SafeNet KeySecure Appliance
</p></li></ul>
</div>
<p>
        The <code class="literal">keyring_okv</code> plugin supports the functions
        that comprise the standard keyring service interface. Keyring
        operations performed by those functions are accessible at two
        levels:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            SQL interface: In SQL statements, call the user-defined
            functions (UDFs) described in
            <a class="xref" href="security.html#keyring-udfs-general-purpose" title="6.4.4.8 General-Purpose Keyring Key-Management Functions">Section 6.4.4.8, “General-Purpose Keyring Key-Management Functions”</a>.
          </p></li><li class="listitem"><p>
            C interface: In C-language code, call the keyring service
            functions described in <a class="xref" href="extending-mysql.html#keyring-service" title="29.3.2 The Keyring Service">Section 29.3.2, “The Keyring Service”</a>.
</p></li></ul>
</div>
<p>
        Example (using UDFs):
      </p><pre data-lang="sql" class="programlisting">
SELECT keyring_key_generate('MyKey', 'AES', 32);
SELECT keyring_key_remove('MyKey');
</pre><p>
        The key types permitted by <code class="literal">keyring_okv</code> are
        described in <a class="xref" href="security.html#keyring-key-types" title="6.4.4.7 Supported Keyring Key Types">Section 6.4.4.7, “Supported Keyring Key Types”</a>.
      </p><p>
        To install the <code class="literal">keyring_okv</code> plugin, use the
        general keyring installation instructions found in
        <a class="xref" href="security.html#keyring-installation" title="6.4.4.1 Keyring Plugin Installation">Section 6.4.4.1, “Keyring Plugin Installation”</a>, together with the
        configuration information specific to
        <code class="literal">keyring_okv</code> found here.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#keyring-okv-configuration" title="General keyring_okv Configuration">General keyring_okv Configuration</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-okv-oracle-key-vault" title="Configuring keyring_okv for Oracle Key Vault">Configuring keyring_okv for Oracle Key Vault</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-okv-keysecure" title="Configuring keyring_okv for Gemalto SafeNet KeySecure Appliance">Configuring keyring_okv for Gemalto SafeNet KeySecure Appliance</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-okv-encrypt-key-file" title="Password-Protecting the keyring_okv Key File">Password-Protecting the keyring_okv Key File</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="keyring-okv-configuration"></a>General keyring_okv Configuration</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091715837264"></a><p>
          Regardless of which KMIP back end the
          <code class="literal">keyring_okv</code> plugin uses for keyring
          storage, the
          <a class="link" href="security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a> system
          variable configures the location of the directory used by
          <code class="literal">keyring_okv</code> for its support files. The
          default value is empty, so you must set the variable to name a
          properly configured directory before the plugin can
          communicate with the KMIP back end. Unless you do so,
          <code class="literal">keyring_okv</code> writes a message to the error
          log during server startup that it cannot communicate:
        </p><pre data-lang="none" class="programlisting">
[Warning] Plugin keyring_okv reported: 'For keyring_okv to be
initialized, please point the keyring_okv_conf_dir variable to a directory
containing Oracle Key Vault configuration file and ssl materials'
</pre><p>
          The <a class="link" href="security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a>
          variable must name a directory that contains the following
          items:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">okvclient.ora</code>: A file that contains
              details of the KMIP back end with which
              <code class="literal">keyring_okv</code> will communicate.
            </p></li><li class="listitem"><p>
              <code class="filename">ssl</code>: A directory that contains the
              certificate and key files required to establish a secure
              connection with the KMIP back end:
              <code class="filename">CA.pem</code>,
              <code class="filename">cert.pem</code>, and
              <code class="filename">key.pem</code>. If the key file is
              password-protected, the <code class="filename">ssl</code> directory
              can contain a single-line text file named
              <code class="filename">password.txt</code> containing the password
              needed to decrypt the key file.
</p></li></ul>
</div>
<p>
          Both the <code class="filename">okvclient.ora</code> file and
          <code class="filename">ssl</code> directory with the certificate and
          key files are required for <code class="literal">keyring_okv</code> to
          work properly. The procedure used to populate the
          configuration directory with these files depends on the KMIP
          back end used with <code class="literal">keyring_okv</code>, as
          described elsewhere.
        </p><p>
          The configuration directory used by
          <code class="literal">keyring_okv</code> as the location for its support
          files should have a restrictive mode and be accessible only to
          the account used to run the MySQL server. For example, on Unix
          and Unix-like systems, to use the
          <code class="filename">/usr/local/mysql/mysql-keyring-okv</code>
          directory, the following commands (executed as
          <code class="literal">root</code>) create the directory and set its mode
          and ownership:
        </p><pre data-lang="terminal" class="programlisting">
cd /usr/local/mysql
mkdir mysql-keyring-okv
chmod 750 mysql-keyring-okv
chown mysql mysql-keyring-okv
chgrp mysql mysql-keyring-okv
</pre><p>
          To be usable during the server startup process,
          <code class="literal">keyring_okv</code> must be loaded using the
          <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a> option.
          Also, set the
          <a class="link" href="security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a> system
          variable to tell <code class="literal">keyring_okv</code> where to find
          its configuration directory. For example, use these lines in
          the server <code class="filename">my.cnf</code> file (adjust the
          <code class="filename">.so</code> suffix and directory location for
          your platform as necessary):
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
early-plugin-load=keyring_okv.so
keyring_okv_conf_dir=/usr/local/mysql/mysql-keyring-okv
</pre><p>
          For additional information about
          <a class="link" href="security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a>, see
          <a class="xref" href="security.html#keyring-system-variables" title="6.4.4.11 Keyring System Variables">Section 6.4.4.11, “Keyring System Variables”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="keyring-okv-oracle-key-vault"></a>Configuring keyring_okv for Oracle Key Vault</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091715802384"></a><a class="indexterm" name="idm140091715800928"></a><p>
          The discussion here assumes that you are familiar with Oracle
          Key Vault. Some pertinent information sources:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="ulink" href="http://www.oracle.com/technetwork/database/options/key-management/overview/index.html" target="_top">Oracle
              Key Vault site</a>
            </p></li><li class="listitem"><p>
              <a class="ulink" href="http://www.oracle.com/technetwork/database/options/key-management/documentation/index.html" target="_top">Oracle
              Key Vault documentation</a>
</p></li></ul>
</div>
<p>
          In Oracle Key Vault terminology, clients that use Oracle Key
          Vault to store and retrieve security objects are called
          endpoints. To communicate with Oracle Key Vault, it is
          necessary to register as an endpoint and enroll by downloading
          and installing endpoint support files.
        </p><p>
          The following procedure briefly summarizes the process of
          setting up <code class="literal">keyring_okv</code> for use with Oracle
          Key Vault:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Create the configuration directory for the
              <code class="literal">keyring_okv</code> plugin to use.
            </p></li><li class="listitem"><p>
              Register an endpoint with Oracle Key Vault to obtain an
              enrollment token.
            </p></li><li class="listitem"><p>
              Use the enrollment token to obtain the
              <code class="filename">okvclient.jar</code> client software
              download.
            </p></li><li class="listitem"><p>
              Install the client software to populate the
              <code class="literal">keyring_okv</code> configuration directory
              that contains the Oracle Key Vault support files.
</p></li></ol>
</div>
<p>
          Use the following procedure to configure
          <code class="literal">keyring_okv</code> and Oracle Key Vault to work
          together. This description only summarizes how to interact
          with Oracle Key Vault. For details, visit the
          <a class="ulink" href="http://www.oracle.com/technetwork/database/options/key-management/overview/index.html" target="_top">Oracle
          Key Vault</a> site and consult the Oracle Key Vault
          Administrator's Guide.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Create the configuration directory that will contain the
              Oracle Key Vault support files, and make sure that the
              <a class="link" href="security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a>
              system variable is set to name that directory (for
              details, see <a class="xref" href="security.html#keyring-okv-configuration" title="General keyring_okv Configuration">General keyring_okv Configuration</a>).
            </p></li><li class="listitem"><p>
              Log in to the Oracle Key Vault management console as a
              user who has the System Administrator role.
            </p></li><li class="listitem"><p>
              Select the Endpoints tab to arrive at the Endpoints page.
              On the Endpoints page, click Add.
            </p></li><li class="listitem"><p>
              Provide the required endpoint information and click
              Register. The endpoint type should be Other. Successful
              registration results in an enrollment token.
            </p></li><li class="listitem"><p>
              Log out from the Oracle Key Vault server.
            </p></li><li class="listitem"><p>
              Connect again to the Oracle Key Vault server, this time
              without logging in. Use the endpoint enrollment token to
              enroll and request the <code class="filename">okvclient.jar</code>
              software download. Save this file to your system.
            </p></li><li class="listitem"><p>
              Install the <code class="filename">okvclient.jar</code> file using
              the following command (you must have JDK 1.4 or higher):
            </p><pre data-lang="terminal" class="programlisting">
java -jar okvclient.jar -d <em class="replaceable"><code>dir_name</code></em> [-v]
</pre><p>
              The directory name following the <code class="option">-d</code>
              option is the location in which to install extracted
              files. The <code class="option">-v</code> option, if given, causes
              log information to be produced that may be useful if the
              command fails.
            </p><p>
              When the command asks for an Oracle Key Vault endpoint
              password, do not provide one. Instead, press Enter. (The
              result is that no password will be required when the
              endpoint connects to Oracle Key Vault.)
            </p></li><li class="listitem"><p>
              The preceding command produces an
              <code class="filename">okvclient.ora</code> file, which should be
              in this location under the directory named by the
              <code class="option">-d</code> option in the preceding <span class="command"><strong>java
              -jar</strong></span> command:
            </p><pre data-lang="terminal" class="programlisting">
install_dir/conf/okvclient.ora
</pre><p>
              The file contents include lines that look something like
              this:
            </p><pre data-lang="ini" class="programlisting">
SERVER=<em class="replaceable"><code>host_ip</code></em>:<em class="replaceable"><code>port_num</code></em>
STANDBY_SERVER=<em class="replaceable"><code>host_ip</code></em>:<em class="replaceable"><code>port_num</code></em>
</pre><p>
              The <code class="literal">keyring_okv</code> plugin attempts to
              communicate with the server running on the host named by
              the <code class="literal">SERVER</code> variable and falls back to
              <code class="literal">STANDBY_SERVER</code> if that fails:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  For the <code class="literal">SERVER</code> variable, a setting
                  in the <code class="filename">okvclient.ora</code> file is
                  mandatory.
                </p></li><li class="listitem"><p>
                  For the <code class="literal">STANDBY_SERVER</code> variable, a
                  setting in the <code class="filename">okvclient.ora</code> file
                  is optional.
</p></li></ul>
</div>
</li><li class="listitem"><p>
              Go to the Oracle Key Vault installer directory and test
              the setup by running this command:
            </p><pre data-lang="terminal" class="programlisting">
okvutil/bin/okvutil list
</pre><p>
              The output should look something like this:
            </p><pre data-lang="none" class="programlisting">
Unique ID                               Type            Identifier
255AB8DE-C97F-482C-E053-0100007F28B9	Symmetric Key	-
264BF6E0-A20E-7C42-E053-0100007FB29C	Symmetric Key	-
</pre><p>
              For a fresh Oracle Key Vault server (a server without any
              key in it), the output looks like this instead, to
              indicate that there are no keys in the vault:
            </p><pre data-lang="none" class="programlisting">
no objects found
</pre></li><li class="listitem"><p>
              Use this command to extract the <code class="filename">ssl</code>
              directory containing SSL materials from the
              <code class="filename">okvclient.jar</code> file:
            </p><pre data-lang="terminal" class="programlisting">
jar xf okvclient.jar ssl
</pre></li><li class="listitem"><p>
              Copy the Oracle Key Vault support files (the
              <code class="filename">okvclient.ora</code> file and the
              <code class="filename">ssl</code> directory) into the configuration
              directory.
            </p></li><li class="listitem"><p>
              (Optional) If you wish to password-protect the key file,
              use the instructions in
              <a class="xref" href="security.html#keyring-okv-encrypt-key-file" title="Password-Protecting the keyring_okv Key File">Password-Protecting the keyring_okv Key File</a>.
</p></li></ol>
</div>
<p>
          After completing the preceding procedure, restart the MySQL
          server. It loads the <code class="literal">keyring_okv</code> plugin and
          <code class="literal">keyring_okv</code> uses the files in its
          configuration directory to communicate with Oracle Key Vault.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="keyring-okv-keysecure"></a>Configuring keyring_okv for Gemalto SafeNet KeySecure Appliance</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091715739664"></a><a class="indexterm" name="idm140091715738224"></a><a class="indexterm" name="idm140091715736704"></a><p>
          Gemalto SafeNet KeySecure Appliance uses the KMIP protocol
          (version 1.1 or 1.2). The <code class="literal">keyring_okv</code>
          keyring plugin (which supports KMIP 1.1) can use KeySecure as
          its KMIP back end for keyring storage.
        </p><p>
          Use the following procedure to configure
          <code class="literal">keyring_okv</code> and KeySecure to work together.
          The description only summarizes how to interact with
          KeySecure. For details, consult the section named Add a KMIP
          Server in the
          <a class="ulink" href="https://safenet.gemalto.com/uploadedFiles/Support_and_Downloads/AWS/007-012362-001-keysecure-appliance-user-guide-v7.1.0.pdf" target="_top">KeySecure
          User Guide</a>.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Create the configuration directory that will contain the
              KeySecure support files, and make sure that the
              <a class="link" href="security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a>
              system variable is set to name that directory (for
              details, see <a class="xref" href="security.html#keyring-okv-configuration" title="General keyring_okv Configuration">General keyring_okv Configuration</a>).
            </p></li><li class="listitem"><p>
              In the configuration directory, create a subdirectory
              named <code class="filename">ssl</code> to use for storing the
              required SSL certificate and key files.
            </p></li><li class="listitem"><p>
              In the configuration directory, create a file named
              <code class="filename">okvclient.ora</code>. It should have
              following format:
            </p><pre data-lang="ini" class="programlisting">
SERVER=<em class="replaceable"><code>host_ip</code></em>:<em class="replaceable"><code>port_num</code></em>
STANDBY_SERVER=<em class="replaceable"><code>host_ip</code></em>:<em class="replaceable"><code>port_num</code></em>
</pre><p>
              For example, if KeySecure is running on host 198.51.100.20
              and listening on port 9002, the
              <code class="filename">okvclient.ora</code> file looks like this:
            </p><pre data-lang="ini" class="programlisting">
SERVER=198.51.100.20:9002
STANDBY_SERVER=198.51.100.20:9002
</pre></li><li class="listitem"><p>
              Connect to the KeySecure Management Console as an
              administrator with credentials for Certificate Authorities
              access.
            </p></li><li class="listitem"><p>
              Navigate to Security &gt;&gt; Local CAs and create a local
              certificate authority (CA).
            </p></li><li class="listitem"><p>
              Go to Trusted CA Lists. Select Default and click on
              Properties. Then select Edit for Trusted Certificate
              Authority List and add the CA just created.
            </p></li><li class="listitem"><p>
              Download the CA and save it in the
              <code class="filename">ssl</code> directory as a file named
              <code class="filename">CA.pem</code>.
            </p></li><li class="listitem"><p>
              Navigate to Security &gt;&gt; Certificate Requests and
              create a certificate. Then you will be able to download a
              compressed <span class="command"><strong>tar</strong></span> file containing
              certificate PEM files.
            </p></li><li class="listitem"><p>
              Extract the PEM files from in the downloaded file. For
              example, if the file name is
              <code class="filename">csr_w_pk_pkcs8.gz</code>, decompress and
              unpack it using this command:
            </p><pre data-lang="terminal" class="programlisting">
tar zxvf csr_w_pk_pkcs8.gz
</pre><p>
              Two files result from the extraction operation:
              <code class="filename">certificate_request.pem</code> and
              <code class="filename">private_key_pkcs8.pem</code>.
            </p></li><li class="listitem"><p>
              Use this <span class="command"><strong>openssl</strong></span> command to decrypt the
              private key and create a file named
              <code class="filename">key.pem</code>:
            </p><pre data-lang="terminal" class="programlisting">
openssl pkcs8 -in private_key_pkcs8.pem -out key.pem
</pre></li><li class="listitem"><p>
              Copy the <code class="filename">key.pem</code> file into the
              <code class="filename">ssl</code> directory.
            </p></li><li class="listitem"><p>
              Copy the certificate request in
              <code class="filename">certificate_request.pem</code> into the
              clipboard.
            </p></li><li class="listitem"><p>
              Navigate to Security &gt;&gt; Local CAs. Select the same
              CA that you created earlier (the one you downloaded to
              create the <code class="filename">CA.pem</code> file), and click
              Sign Request. Paste the Certificate Request from the
              clipboard, choose a certificate purpose of Client (the
              keyring is a client of KeySecure), and click Sign Request.
              The result is a certificate signed with the selected CA in
              a new page.
            </p></li><li class="listitem"><p>
              Copy the signed certificate to the clipboard, then save
              the clipboard contents as a file named
              <code class="filename">cert.pem</code> in the
              <code class="filename">ssl</code> directory.
            </p></li><li class="listitem"><p>
              (Optional) If you wish to password-protect the key file,
              use the instructions in
              <a class="xref" href="security.html#keyring-okv-encrypt-key-file" title="Password-Protecting the keyring_okv Key File">Password-Protecting the keyring_okv Key File</a>.
</p></li></ol>
</div>
<p>
          After completing the preceding procedure, restart the MySQL
          server. It loads the <code class="literal">keyring_okv</code> plugin and
          <code class="literal">keyring_okv</code> uses the files in its
          configuration directory to communicate with KeySecure.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="keyring-okv-encrypt-key-file"></a>Password-Protecting the keyring_okv Key File</h5>

</div>

</div>

</div>
<p>
          You can optionally protect the key file with a password and
          supply a file containing the password to enable the key file
          to be decrypted. To so do, change location to the
          <code class="filename">ssl</code> directory and perform these steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Encrypt the <code class="filename">key.pem</code> key file. For
              example, use a command like this, and enter the encryption
              password at the prompts:
            </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>openssl rsa -des3 -in key.pem -out key.pem.new</code></strong>
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
</pre></li><li class="listitem"><p>
              Save the encryption password in a single-line text file
              named <code class="filename">password.txt</code> in the
              <code class="filename">ssl</code> directory.
            </p></li><li class="listitem"><p>
              Verify that the encrypted key file can be decrypted using
              the following command. The decrypted file should display
              on the console:
            </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>openssl rsa -in key.pem.new -passin file:password.txt</code></strong>
</pre></li><li class="listitem"><p>
              Remove the original <code class="filename">key.pem</code> file and
              rename <code class="filename">key.pem.new</code> to
              <code class="filename">key.pem</code>.
            </p></li><li class="listitem"><p>
              Change the ownership and access mode of new
              <code class="filename">key.pem</code> file and
              <code class="filename">password.txt</code> file as necessary to
              ensure that they have the same restrictions as other files
              in the <code class="filename">ssl</code> directory.
</p></li></ol>
</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-aws-plugin"></a>6.4.4.5 Using the keyring_aws Amazon Web Services Keyring Plugin</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091715672896"></a><a class="indexterm" name="idm140091715671840"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The <code class="literal">keyring_aws</code> plugin is an extension
          included in MySQL Enterprise Edition, a commercial product. To learn more about
          commercial products, see <a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a>.
</p>
</div>
<p>
        The <code class="literal">keyring_aws</code> plugin is a keyring plugin
        that communicates with the Amazon Web Services Key Management
        Service (AWS KMS) as a back end for key generation and uses a
        local file for key storage. All keyring material is generated
        exclusively by the AWS server, not by
        <code class="literal">keyring_aws</code>.
      </p><p>
        <code class="literal">keyring_aws</code> is available on these platforms:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Debian 8
          </p></li><li class="listitem"><p>
            EL7
          </p></li><li class="listitem"><p>
            macOS 10.13 and 10.14
          </p></li><li class="listitem"><p>
            SLES 12
          </p></li><li class="listitem"><p>
            Ubuntu 14.04 and 16.04
          </p></li><li class="listitem"><p>
            Windows
</p></li></ul>
</div>
<p>
        The discussion here assumes that you are familiar with AWS in
        general and KMS in particular. Some pertinent information
        sources:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="ulink" href="https://aws.amazon.com/kms/" target="_top">AWS site</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://docs.aws.amazon.com/kms/" target="_top">KMS
            documentation</a>
</p></li></ul>
</div>
<p>
        The following sections provide configuration and usage
        information for the <code class="literal">keyring_aws</code> keyring
        plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#keyring-aws-plugin-configuration" title="keyring_aws Configuration">keyring_aws Configuration</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-aws-plugin-operation" title="keyring_aws Operation">keyring_aws Operation</a></p></li><li class="listitem"><p><a class="xref" href="security.html#keyring-aws-plugin-credential-changes" title="keyring_aws Credential Changes">keyring_aws Credential Changes</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="keyring-aws-plugin-configuration"></a>keyring_aws Configuration</h5>

</div>

</div>

</div>
<p>
          To install the <code class="literal">keyring_aws</code> plugin, use the
          general installation instructions found in
          <a class="xref" href="security.html#keyring-installation" title="6.4.4.1 Keyring Plugin Installation">Section 6.4.4.1, “Keyring Plugin Installation”</a>, together with the
          plugin-specific configuration information found here.
        </p><p>
          The plugin library file contains the
          <code class="literal">keyring_aws</code> plugin and two user-defined
          functions (UDFs),
          <a class="link" href="security.html#udf_keyring-aws-rotate-cmk"><code class="literal">keyring_aws_rotate_cmk()</code></a> and
          <a class="link" href="security.html#udf_keyring-aws-rotate-keys"><code class="literal">keyring_aws_rotate_keys()</code></a>.
        </p><p>
          To configure <code class="literal">keyring_aws</code>, you must obtain a
          secret access key that provides credentials for communicating
          with AWS KMS and write it to a configuration file:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Create an AWS KMS account.
            </p></li><li class="listitem"><p>
              Use AWS KMS to create a secret access key ID and secret
              access key. The access key serves to verify your identity
              and that of your applications.
            </p></li><li class="listitem"><p>
              Use the AWS KMS account to create a customer master key
              (CMK) ID. At MySQL startup, set the
              <a class="link" href="security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a> system
              variable to the CMK ID value. This variable is mandatory
              and there is no default. (Its value can be changed at
              runtime if desired using
              <a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1 SET Syntax for Variable Assignment"><code class="literal">SET
              GLOBAL</code></a>.)
            </p></li><li class="listitem"><p>
              If necessary, create the directory in which the
              configuration file will be located. The directory should
              have a restrictive mode and be accessible only to the
              account used to run the MySQL server. For example, on Unix
              and Unix-like systems, to use
              <code class="filename">/usr/local/mysql/mysql-keyring/keyring_aws_conf</code>
              as the file name, the following commands (executed as
              <code class="literal">root</code>) create its parent directory and
              set the directory mode and ownership:
            </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>cd /usr/local/mysql</code></strong>
shell&gt; <strong class="userinput"><code>mkdir mysql-keyring</code></strong>
shell&gt; <strong class="userinput"><code>chmod 750 mysql-keyring</code></strong>
shell&gt; <strong class="userinput"><code>chown mysql mysql-keyring</code></strong>
shell&gt; <strong class="userinput"><code>chgrp mysql mysql-keyring</code></strong>
</pre><p>
              At MySQL startup, set the
              <a class="link" href="security.html#sysvar_keyring_aws_conf_file"><code class="literal">keyring_aws_conf_file</code></a>
              system variable to
              <code class="filename">/usr/local/mysql/mysql-keyring/keyring_aws_conf</code>
              to indicate the configuration file location to the server.
            </p></li><li class="listitem"><p>
              Prepare the <code class="literal">keyring_aws</code> configuration
              file, which should contain two lines:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  Line 1: The secret access key ID
                </p></li><li class="listitem"><p>
                  Line 2: The secret access key
</p></li></ul>
</div>
<p>
              For example, if the key ID is
              <code class="literal">wwwwwwwwwwwwwEXAMPLE</code> and the key is
              <code class="literal">xxxxxxxxxxxxx/yyyyyyy/zzzzzzzzEXAMPLEKEY</code>,
              the configuration file looks like this:
            </p><pre data-lang="none" class="programlisting">
wwwwwwwwwwwwwEXAMPLE
xxxxxxxxxxxxx/yyyyyyy/zzzzzzzzEXAMPLEKEY
</pre></li></ol>
</div>
<p>
          To be usable during the server startup process,
          <code class="literal">keyring_aws</code> must be loaded using the
          <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a> option. The
          <a class="link" href="security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a> system
          variable is mandatory and configures the customer master key
          (CMK) ID obtained from the AWS KMS server. The
          <a class="link" href="security.html#sysvar_keyring_aws_conf_file"><code class="literal">keyring_aws_conf_file</code></a> and
          <a class="link" href="security.html#sysvar_keyring_aws_data_file"><code class="literal">keyring_aws_data_file</code></a> system
          variables optionally configure the locations of the files used
          by the <code class="literal">keyring_aws</code> plugin for configuration
          information and data storage. The file location variable
          default values are platform specific. To configure the
          locations explicitly, set the variable values at startup. For
          example, use these lines in the server
          <code class="filename">my.cnf</code> file (adjust the
          <code class="filename">.so</code> suffix and file locations for your
          platform as necessary):
        </p><pre data-lang="ini" class="programlisting">
[mysqld]
early-plugin-load=keyring_aws.so
keyring_aws_cmk_id='arn:aws:kms:us-west-2:111122223333:key/abcd1234-ef56-ab12-cd34-ef56abcd1234'
keyring_aws_conf_file=/usr/local/mysql/mysql-keyring/keyring_aws_conf
keyring_aws_data_file=/usr/local/mysql/mysql-keyring/keyring_aws_data
</pre><p>
          For the <code class="literal">keyring_aws</code> plugin to start
          successfully, the configuration file must exist and contain
          valid secret access key information, initialized as described
          previously. The storage file need not exist. If it does not,
          <code class="literal">keyring_aws</code> attempts to create it (as well
          as its parent directory, if necessary).
        </p><p>
          For additional information about the system variables used to
          configure the <code class="literal">keyring_aws</code> plugin, see
          <a class="xref" href="security.html#keyring-system-variables" title="6.4.4.11 Keyring System Variables">Section 6.4.4.11, “Keyring System Variables”</a>.
        </p><p>
          Start the MySQL server and install the UDFs associated with
          the <code class="literal">keyring_aws</code> plugin. This is a one-time
          operation, performed by executing the following statements
          (adjust the <code class="filename">.so</code> suffix for your platform
          as necessary):
        </p><pre data-lang="sql" class="programlisting">
CREATE FUNCTION keyring_aws_rotate_cmk RETURNS INTEGER
  SONAME 'keyring_aws.so';
CREATE FUNCTION keyring_aws_rotate_keys RETURNS INTEGER
  SONAME 'keyring_aws.so';
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="keyring-aws-plugin-operation"></a>keyring_aws Operation</h5>

</div>

</div>

</div>
<p>
          At plugin startup, the <code class="literal">keyring_aws</code> plugin
          reads the AWS secret access key ID and key from its
          configuration file. It also reads any encrypted keys contained
          in its storage file into its in-memory cache.
        </p><p>
          During operation, <code class="literal">keyring_aws</code> maintains
          encrypted keys in the in-memory cache and uses the storage
          file as local persistent storage. Each keyring operation is
          transactional: <code class="literal">keyring_aws</code> either
          successfully changes both the in-memory key cache and the
          keyring storage file, or the operation fails and the keyring
          state remains unchanged.
        </p><p>
          To ensure that keys are flushed only when the correct keyring
          storage file exists, <code class="literal">keyring_aws</code> stores a
          SHA-256 checksum of the keyring in the file. Before updating
          the file, the plugin verifies that it contains the expected
          checksum.
        </p><p>
          The <code class="literal">keyring_aws</code> plugin supports the
          functions that comprise the standard keyring service
          interface. Keyring operations performed by these functions are
          accessible at two levels:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              C interface: In C-language code, call the keyring service
              functions described in <a class="xref" href="extending-mysql.html#keyring-service" title="29.3.2 The Keyring Service">Section 29.3.2, “The Keyring Service”</a>.
            </p></li><li class="listitem"><p>
              SQL interface: In SQL statements, call the user-defined
              functions (UDFs) described in
              <a class="xref" href="security.html#keyring-udfs-general-purpose" title="6.4.4.8 General-Purpose Keyring Key-Management Functions">Section 6.4.4.8, “General-Purpose Keyring Key-Management Functions”</a>.
</p></li></ul>
</div>
<p>
          Example (using UDFs):
        </p><pre data-lang="sql" class="programlisting">
SELECT keyring_key_generate('MyKey', 'AES', 32);
SELECT keyring_key_remove('MyKey');
</pre><p>
          In addition, the
          <a class="link" href="security.html#udf_keyring-aws-rotate-cmk"><code class="literal">keyring_aws_rotate_cmk()</code></a> and
          <a class="link" href="security.html#udf_keyring-aws-rotate-keys"><code class="literal">keyring_aws_rotate_keys()</code></a> UDFs
          <span class="quote">“<span class="quote">extend</span>”</span> the keyring plugin interface to provide
          AWS-related capabilities not covered by the standard keyring
          service interface. These capabilities are accessible only by
          calling the UDFs. There are no corresponding C-languge key
          service functions.
        </p><p>
          The key types permitted by <code class="literal">keyring_aws</code> are
          described in <a class="xref" href="security.html#keyring-key-types" title="6.4.4.7 Supported Keyring Key Types">Section 6.4.4.7, “Supported Keyring Key Types”</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="keyring-aws-plugin-credential-changes"></a>keyring_aws Credential Changes</h5>

</div>

</div>

</div>
<p>
          Assuming that the <code class="literal">keyring_aws</code> plugin has
          initialized properly at server startup, it is possible to
          change the credentials used for communicating with AWS KMS:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Use AWS KMS to create a new secret access key ID and
              secret access key.
            </p></li><li class="listitem"><p>
              Store the new credentials in the configuration file (the
              file named by the
              <a class="link" href="security.html#sysvar_keyring_aws_conf_file"><code class="literal">keyring_aws_conf_file</code></a>
              system variable). The file format is as described
              previously.
            </p></li><li class="listitem"><p>
              Reinitialize the <code class="literal">keyring_aws</code> plugin so
              that it rereads the configuration file. Assuming that the
              new credentials are valid, the plugin should initialize
              successfully.
            </p><p>
              There are two ways to reinitialize the plugin:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                  Restart the server. This is simpler and has no side
                  effects, but is not suitable for installations that
                  require minimal server downtime with as few restarts
                  as possible.
                </p></li><li class="listitem"><p>
                  Reinitialize the plugin without restarting the server
                  by executing the following statements (adjust the
                  <code class="filename">.so</code> suffix for your platform as
                  necessary):
                </p><pre data-lang="sql" class="programlisting">
UNINSTALL PLUGIN keyring_aws;
INSTALL PLUGIN keyring_aws SONAME 'keyring_aws.so';
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                    In addition to loading a plugin at runtime,
                    <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> has
                    the side effect of registering the plugin it in the
                    <code class="literal">mysql.plugin</code> system table.
                    Because of this, if you decide to stop using
                    <code class="literal">keyring_aws</code>, it is not sufficient
                    to remove the
                    <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a>
                    option from the set of options used to start the
                    server. That stops the plugin from loading early,
                    but the server still attempts to load it when it
                    gets to the point in the startup sequence where it
                    loads the plugins registered in
                    <code class="literal">mysql.plugin</code>.
                  </p><p>
                    Consequently, if you execute the
                    <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a> plus
                    <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>
                    sequence just described to change the AWS KMS
                    credentials, then to stop using
                    <code class="literal">keyring_aws</code>, it is necessary to
                    execute <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL
                    PLUGIN</code></a> again to unregister the plugin in
                    addition to removing the
                    <a class="link" href="server-administration.html#option_mysqld_early-plugin-load"><code class="option">--early-plugin-load</code></a>
                    option.
</p>
</div>
</li></ul>
</div>
</li></ol>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-key-migration"></a>6.4.4.6 Migrating Keys Between Keyring Keystores</h4>

</div>

</div>

</div>
<p>
        The MySQL server supports an operational mode that enables
        migration of keys between underlying keyring keystores. This
        enables DBAs to switch a MySQL installation from one keyring
        plugin to another. A migration server (that is, a server started
        in key migration mode) does not accept client connections.
        Instead, it runs only long enough to migrate keys, then exits. A
        migration server reports errors to the console (the standard
        error output).
      </p><p>
        It is possible to perform offline or online key migration:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If you are sure that no running server on the local host is
            using the source or destination keystore, an offline
            migration is possible. In this case, the migration server
            can modify the keystores without possibility of a running
            server modifying keystore content during the migration.
          </p></li><li class="listitem"><p>
            If a running server on the local host is using the source or
            destination keystore, an online migration must be performed.
            In this case, the migration server connects to the running
            server and instructs it to pause keyring operations while
            key migration is in progress.
</p></li></ul>
</div>
<p>
        The result of a key migration operation is that the destination
        keystore contains the keys it had prior to the migration, plus
        the keys from the source keystore. The source keystore is the
        same before and after the migration because keys are copied, not
        moved. If a key to be copied already exists in the destination
        keystore, an error occurs and the destination keystore is
        restored to its premigration state.
      </p><p>
        The user who invokes the server in key-migration mode must not
        be the <code class="literal">root</code> operating system user, and must
        have permission to read and write the keyring files.
      </p><p>
        To perform a key migration operation, determine which key
        migration options are needed. Migration options indicate which
        keyring plugins are involved, and whether to perform an offline
        or online migration:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To indicate the source and destination keyring plugins,
            specify these options:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="security.html#option_mysqld_keyring-migration-source"><code class="option">--keyring-migration-source</code></a>:
                The source keyring plugin that manages the keys to be
                migrated.
              </p></li><li class="listitem"><p>
                <a class="link" href="security.html#option_mysqld_keyring-migration-destination"><code class="option">--keyring-migration-destination</code></a>:
                The destination keyring plugin to which the migrated
                keys are to be copied.
</p></li></ul>
</div>
<p>
            These options tell the server to run in key migration mode.
            Both options are mandatory for all key migration operations.
            The source and destination plugins must differ, and the
            migration server must support both plugins.
          </p></li><li class="listitem"><p>
            For an offline migration, no additional key migration
            options are needed.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
              Do not perform offline migration involving a keystore that
              is in use by a running server.
</p>
</div>
</li><li class="listitem"><p>
            For an online migration, some running server currently is
            using the source or destination keystore. Specify the key
            migration options that indicate how to connect to the
            running server. This is necessary so that the migration
            server can connect to the running server and tell it to
            pause keyring use during the migration operation.
          </p><p>
            Use of any of the following options signifies an online
            migration:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <a class="link" href="security.html#option_mysqld_keyring-migration-host"><code class="option">--keyring-migration-host</code></a>:
                The host where the running server is located. This is
                always the local host.
              </p></li><li class="listitem"><p>
                <a class="link" href="security.html#option_mysqld_keyring-migration-user"><code class="option">--keyring-migration-user</code></a>,
                <a class="link" href="security.html#option_mysqld_keyring-migration-password"><code class="option">--keyring-migration-password</code></a>:
                The user name and password for the account to use to
                connect to the running server.
              </p></li><li class="listitem"><p>
                <a class="link" href="security.html#option_mysqld_keyring-migration-port"><code class="option">--keyring-migration-port</code></a>:
                For TCP/IP connections, the port number to connect to on
                the running server.
              </p></li><li class="listitem"><p>
                <a class="link" href="security.html#option_mysqld_keyring-migration-socket"><code class="option">--keyring-migration-socket</code></a>:
                For Unix socket file or Windows named pipe connections,
                the socket file or named pipe to connect to on the
                running server.
</p></li></ul>
</div>
</li></ul>
</div>
<p>
        For additional details about the key migration options, see
        <a class="xref" href="security.html#keyring-options" title="6.4.4.10 Keyring Command Options">Section 6.4.4.10, “Keyring Command Options”</a>.
      </p><p>
        Start the migration server with the key migration options
        determined as just described, possibly with other options. Keep
        the following considerations in mind:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Other server options might be required, such as other
            configuration parameters for the two keyring plugins. For
            example, if <code class="literal">keyring_file</code> is one of the
            plugins, you must set the
            <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> system
            variable if the keyring data file location is not the
            default location. Other non-keyring options may be required
            as well. One way to specify these options is by using
            <a class="link" href="programs.html#option_general_defaults-file"><code class="option">--defaults-file</code></a> to name an
            option file that contains the required options.
          </p></li><li class="listitem"><p>
            If you invoke the migration server from a system account
            different from that normally used to run MySQL, it might
            create keyring directories or files that are inaccessible to
            the server during normal operation. Suppose that
            <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> normally runs as the
            <code class="literal">mysql</code> operating system user, but you
            invoke the migration server while logged in as
            <code class="literal">isabel</code>. Any new directories or files
            created by the migration server will be owned by
            <code class="literal">isabel</code>. Subsequent startup will fail when
            a server run as the <code class="literal">mysql</code> operating
            system user attempts to access file system objects owned by
            <code class="literal">isabel</code>.
          </p><p>
            To avoid this problem, start the migration server as the
            <code class="literal">root</code> operating system user and provide a
            <code class="option">--user=<em class="replaceable"><code>user_name</code></em></code>
            option, where <em class="replaceable"><code>user_name</code></em> is the
            system account normally used to run MySQL.
          </p></li><li class="listitem"><p>
            The migration server expects path name option values to be
            full paths. Relative path names may not be resolved as you
            expect.
</p></li></ul>
</div>
<p>
        Example command line for offline key migration:
      </p><pre data-lang="terminal" class="programlisting">
mysqld --defaults-file=/usr/local/mysql/etc/my.cnf
  --keyring-migration-source=keyring_file.so
  --keyring-migration-destination=keyring_encrypted_file.so
  --keyring_encrypted_file_password=<em class="replaceable"><code>password</code></em>
</pre><p>
        Example command line for online key migration:
      </p><pre data-lang="terminal" class="programlisting">
mysqld --defaults-file=/usr/local/mysql/etc/my.cnf
  --keyring-migration-source=keyring_file.so
  --keyring-migration-destination=keyring_encrypted_file.so
  --keyring_encrypted_file_password=<em class="replaceable"><code>password</code></em>
  --keyring-migration-host=localhost
  --keyring-migration-user=root
  --keyring-migration-password=<em class="replaceable"><code>root_password</code></em>
</pre><p>
        The key migration server performs the migration operation as
        follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            (Online migration only) Connect to the running server using
            the connection options. The account used to connect must
            have the privileges required to modify the global
            <a class="link" href="security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a> system
            variable
            (<a class="link" href="security.html#priv_encryption-key-admin"><code class="literal">ENCRYPTION_KEY_ADMIN</code></a> in
            addition to either
            <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a> or
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>).
          </p></li><li class="listitem"><p>
            (Online migration only) Disable
            <a class="link" href="security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a> on the
            running server. (The running server must support
            <a class="link" href="security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a>.)
          </p></li><li class="listitem"><p>
            Load the source and destination keyring plugins.
          </p></li><li class="listitem"><p>
            Copy keys from the source keyring to the destination
            keyring.
          </p></li><li class="listitem"><p>
            Unload the keyring plugins.
          </p></li><li class="listitem"><p>
            (Online migration only) Enable
            <a class="link" href="security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a> on the
            running server.
          </p></li><li class="listitem"><p>
            (Online migration only) Disconnect from the running server.
          </p></li><li class="listitem"><p>
            Exit.
</p></li></ol>
</div>
<p>
        If an error occurs during key migration, any keys that were
        copied to the destination plugin are removed, leaving the
        destination keystore unchanged.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
          For an online migration operation, the migration server takes
          care of enabling and disabling
          <a class="link" href="security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a> on the
          running server. However, if the migration server exits
          abnormally (for example, if someone forcibly terminates it),
          it is possible that
          <a class="link" href="security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a> will not
          have been re-enabled on the running server, leaving it unable
          to perform keyring operations. In this case, it may be
          necessary to connect to the running server and enable
          <a class="link" href="security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a> manually.
</p>
</div>
<p>
        After a successful online key migration operation, the running
        server might need to be restarted:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            If the running server was using the source keystore, it need
            not be restarted after the migration.
          </p></li><li class="listitem"><p>
            If the running server was using the source keystore before
            the migration but should use the destination keystore after
            the migration, it must be reconfigured to use the
            destination keyring plugin and restarted.
          </p></li><li class="listitem"><p>
            If the running server was using the destination keystore and
            will continue to use it, it should be restarted after the
            migration to load all keys migrated into the destination
            keystore.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          MySQL server key migration mode supports pausing a single
          running server. To perform a key migration if multiple key
          servers are using the keystores involved, use this procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Connect to each running server manually and set
              <a class="link" href="security.html#sysvar_keyring_operations"><code class="literal">keyring_operations=OFF</code></a>.
            </p></li><li class="listitem"><p>
              Use the migration server to perform an offline key
              migration.
            </p></li><li class="listitem"><p>
              Connect to each running server manually and set
              <a class="link" href="security.html#sysvar_keyring_operations"><code class="literal">keyring_operations=ON</code></a>.
</p></li></ol>
</div>
<p>
          All running servers must support the
          <a class="link" href="security.html#sysvar_keyring_operations"><code class="literal">keyring_operations=ON</code></a> system
          variable.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-key-types"></a>6.4.4.7 Supported Keyring Key Types</h4>

</div>

</div>

</div>
<p>
        MySQL Keyring supports generating keys of different types
        (encryption algorithms) and lengths. The available key types
        depend on which keyring plugin is installed. A given plugin may
        also impose constraints on key lengths per key type.
      </p><p>
        <a class="xref" href="security.html#keyring-key-types-table" title="Table 6.26 Keyring Plugin Key Types">Table 6.26, “Keyring Plugin Key Types”</a> summarizes the
        permitted key types per keyring plugin. Lengths are in bytes.
        For a key generated using one of the keyring user-defined
        functions (UDFs) described in
        <a class="xref" href="security.html#keyring-udfs-general-purpose" title="6.4.4.8 General-Purpose Keyring Key-Management Functions">Section 6.4.4.8, “General-Purpose Keyring Key-Management Functions”</a>, the length can
        be no more than 2,048 bytes, due to limitations of the UDF
        interface.
</p>
<div class="table">
<a name="keyring-key-types-table"></a><p class="title"><b>Table 6.26 Keyring Plugin Key Types</b></p>
<div class="table-contents">
<table summary="Key types and lengths supported by keyring plugins."><col width="30%"><col width="20%"><col width="50%"><thead><tr>
            <th scope="col">Plugin Name</th>
            <th scope="col">Permitted Key Type</th>
            <th scope="col">Permitted Key Lengths for Key Type</th>
          </tr></thead><tbody><tr>
            <td scope="row" valign="top"><code class="literal">keyring_encrypted_file</code></td>
            <td><p class="valid-value">
                <code class="literal">AES</code>
              </p><p class="valid-value">
                <code class="literal">DSA</code>
              </p><p class="valid-value">
                <code class="literal">RSA</code>
              </p></td>
            <td><p class="valid-value">
                No special restrictions
              </p><p class="valid-value">
                No special restrictions
              </p><p class="valid-value">
                No special restrictions
              </p></td>
          </tr><tr>
            <td scope="row" valign="top"><code class="literal">keyring_file</code></td>
            <td><p class="valid-value">
                <code class="literal">AES</code>
              </p><p class="valid-value">
                <code class="literal">DSA</code>
              </p><p class="valid-value">
                <code class="literal">RSA</code>
              </p></td>
            <td><p class="valid-value">
                No special restrictions
              </p><p class="valid-value">
                No special restrictions
              </p><p class="valid-value">
                No special restrictions
              </p></td>
          </tr><tr>
            <td scope="row" valign="top"><code class="literal">keyring_okv</code></td>
            <td><code class="literal">AES</code></td>
            <td>16, 24, 32</td>
          </tr><tr>
            <td scope="row" valign="top"><code class="literal">keyring_aws</code></td>
            <td><code class="literal">AES</code></td>
            <td>16, 24, 32</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-udfs-general-purpose"></a>6.4.4.8 General-Purpose Keyring Key-Management Functions</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091715435504"></a><a class="indexterm" name="idm140091715434016"></a><a class="indexterm" name="idm140091715432528"></a><p>
        MySQL Server supports a keyring service that enables internal
        server components and plugins to securely store sensitive
        information for later retrieval.
      </p><p>
        MySQL Server also includes an SQL interface for keyring key
        management, implemented as a set of general-purpose user-defined
        functions (UDFs) that access the functions provided by the
        internal keyring service. The keyring UDFs are contained in a
        plugin library file, which also contains a
        <code class="literal">keyring_udf</code> plugin that must be enabled prior
        to UDF invocation. For these UDFs to be used, a keyring plugin
        such as <code class="literal">keyring_file</code> or
        <code class="literal">keyring_okv</code> must be enabled.
      </p><p>
        The UDFs described here are general purpose and intended for use
        with any keyring plugin. A given keyring plugin might have UDFs
        of its own that are intended for use only with that plugin; see
        <a class="xref" href="security.html#keyring-udfs-plugin-specific" title="6.4.4.9 Plugin-Specific Keyring Key-Management Functions">Section 6.4.4.9, “Plugin-Specific Keyring Key-Management Functions”</a>.
      </p><p>
        The following sections provide installation instructions for the
        keyring UDFs and demonstrate how to use them. For information
        about the keyring service functions invoked by the UDFs, see
        <a class="xref" href="extending-mysql.html#keyring-service" title="29.3.2 The Keyring Service">Section 29.3.2, “The Keyring Service”</a>. For general keyring
        information, see <a class="xref" href="security.html#keyring" title="6.4.4 The MySQL Keyring">Section 6.4.4, “The MySQL Keyring”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="keyring-udf-installation"></a>6.4.4.8.1 Installing or Uninstalling General-Purpose Keyring Functions</h5>
</div>
</div>
</div>
<a class="indexterm" name="idm140091715422736"></a><a class="indexterm" name="idm140091715421248"></a><a class="indexterm" name="idm140091715419760"></a><a class="indexterm" name="idm140091715418272"></a><a class="indexterm" name="idm140091715416784"></a><a class="indexterm" name="idm140091715415296"></a><p>
          This section describes how to install or uninstall the keyring
          user-defined functions (UDFs), which are implemented in a
          plugin library file that also contains a
          <code class="literal">keyring_udf</code> plugin. For general information
          about installing or uninstalling plugins and UDFs, see
          <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>, and
          <a class="xref" href="server-administration.html#udf-loading" title="5.7.1 Installing and Uninstalling User-Defined Functions">Section 5.7.1, “Installing and Uninstalling User-Defined Functions”</a>.
        </p><p>
          The keyring UDFs enable keyring key management operations, but
          the <code class="literal">keyring_udf</code> plugin must also be
          installed because the UDFs will not work correctly without it.
          Attempts to use the UDFs without the
          <code class="literal">keyring_udf</code> plugin result in an error.
        </p><p>
          To be usable by the server, the plugin library file must be
          located in the MySQL plugin directory (the directory named by
          the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
          variable). If necessary, configure the plugin directory
          location by setting the value of
          <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
        </p><p>
          The plugin library file base name is
          <code class="literal">keyring_udf</code>. The file name suffix differs
          per platform (for example, <code class="filename">.so</code> for Unix
          and Unix-like systems, <code class="filename">.dll</code> for Windows).
        </p><p>
          To install the <code class="literal">keyring_udf</code> plugin and the
          UDFs, use the <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>
          and <a class="link" href="sql-syntax.html#create-function" title="13.1.14 CREATE FUNCTION Syntax"><code class="literal">CREATE FUNCTION</code></a> statements
          (adjust the <code class="filename">.so</code> suffix for your platform
          as necessary):
        </p><pre data-lang="sql" class="programlisting">
INSTALL PLUGIN keyring_udf SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_generate RETURNS INTEGER
  SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_fetch RETURNS STRING
  SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_length_fetch RETURNS INTEGER
  SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_type_fetch RETURNS STRING
  SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_store RETURNS INTEGER
  SONAME 'keyring_udf.so';
CREATE FUNCTION keyring_key_remove RETURNS INTEGER
  SONAME 'keyring_udf.so';
</pre><p>
          If the plugin and UDFs are used on a master replication
          server, install them on all slave servers as well to avoid
          replication problems.
        </p><p>
          Once installed as just described, the plugin and UDFs remain
          installed until uninstalled. To remove them, use the
          <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a> and
          <a class="link" href="sql-syntax.html#drop-function" title="13.1.26 DROP FUNCTION Syntax"><code class="literal">DROP FUNCTION</code></a> statements:
        </p><pre data-lang="sql" class="programlisting">
UNINSTALL PLUGIN keyring_udf;
DROP FUNCTION keyring_key_generate;
DROP FUNCTION keyring_key_fetch;
DROP FUNCTION keyring_key_length_fetch;
DROP FUNCTION keyring_key_type_fetch;
DROP FUNCTION keyring_key_store;
DROP FUNCTION keyring_key_remove;
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="keyring-udf-usage"></a>6.4.4.8.2 Using General-Purpose Keyring Functions</h5>

</div>

</div>

</div>
<a class="indexterm" name="idm140091715391328"></a><p>
          Before using the keyring user-defined functions (UDFs),
          install them according to the instructions provided in
          <a class="xref" href="security.html#keyring-udf-installation" title="6.4.4.8.1 Installing or Uninstalling General-Purpose Keyring Functions">Section 6.4.4.8.1, “Installing or Uninstalling General-Purpose Keyring Functions”</a>.
        </p><p>
          The keyring UDFs are subject to these constraints:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              To use any keyring UDF, the <code class="literal">keyring_udf</code>
              plugin must be enabled. Otherwise, an error occurs:
            </p><pre data-lang="none" class="programlisting">
ERROR 1123 (HY000): Can't initialize function 'keyring_key_generate';
This function requires keyring_udf plugin which is not installed.
Please install
</pre><p>
              To install the <code class="literal">keyring_udf</code> plugin, see
              <a class="xref" href="security.html#keyring-udf-installation" title="6.4.4.8.1 Installing or Uninstalling General-Purpose Keyring Functions">Section 6.4.4.8.1, “Installing or Uninstalling General-Purpose Keyring Functions”</a>.
            </p></li><li class="listitem"><p>
              The keyring UDFs invoke keyring service functions (see
              <a class="xref" href="extending-mysql.html#keyring-service" title="29.3.2 The Keyring Service">Section 29.3.2, “The Keyring Service”</a>). The service functions
              in turn use whatever keyring plugin is installed (for
              example, <code class="literal">keyring_file</code> or
              <code class="literal">keyring_okv</code>). Therefore, to use any
              keyring UDF, some underlying keyring plugin must be
              enabled. Otherwise, an error occurs:
            </p><pre data-lang="none" class="programlisting">
ERROR 3188 (HY000): Function 'keyring_key_generate' failed because
underlying keyring service returned an error. Please check if a
keyring plugin is installed and that provided arguments are valid
for the keyring you are using.
</pre><p>
              To install a keyring plugin, see
              <a class="xref" href="security.html#keyring-installation" title="6.4.4.1 Keyring Plugin Installation">Section 6.4.4.1, “Keyring Plugin Installation”</a>.
            </p></li><li class="listitem"><p>
              To use any keyring UDF, a user must possess the global
              <a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege.
              Otherwise, an error occurs:
            </p><pre data-lang="none" class="programlisting">
ERROR 1123 (HY000): Can't initialize function 'keyring_key_generate';
The user is not privileged to execute this function. User needs to
have EXECUTE
</pre><p>
              To grant the global <a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a>
              privilege to a user, use this statement:
            </p><pre data-lang="sql" class="programlisting">
GRANT EXECUTE ON *.* TO <em class="replaceable"><code>user</code></em>;
</pre><p>
              Alternatively, should you prefer to avoid granting the
              global <a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege
              while still permitting users to access specific
              key-management operations, <span class="quote">“<span class="quote">wrapper</span>”</span> stored
              programs can be defined (a technique described later in
              this section).
            </p></li><li class="listitem"><p>
              A key stored in the keyring by a given user can be
              manipulated later only by the same user. That is, the
              value of the <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a>
              function at the time of key manipulation must have the
              same value as when the key was stored in the keyring.
              (This constraint rules out the use of the keyring UDFs for
              manipulation of instance-wide keys, such as those created
              by <code class="literal">InnoDB</code> to support tablespace
              encryption.)
            </p><p>
              To enable multiple users to perform operations on the same
              key, <span class="quote">“<span class="quote">wrapper</span>”</span> stored programs can be defined
              (a technique described later in this section).
            </p></li><li class="listitem"><p>
              Keyring UDFs support the key types and lengths supported
              by the underlying keyring plugin, with the additional
              constraint that keys cannot be longer than 2,048 bytes
              (16,384 bits), due to limitations of the UDF interface.
              See <a class="xref" href="security.html#keyring-key-types" title="6.4.4.7 Supported Keyring Key Types">Section 6.4.4.7, “Supported Keyring Key Types”</a>.
</p></li></ul>
</div>
<p>
          To create a new random key and store it in the keyring, call
          <a class="link" href="security.html#udf_keyring-key-generate"><code class="literal">keyring_key_generate()</code></a>, passing
          to it an ID for the key, along with the key type (encryption
          method) and its length in bytes. The following call creates a
          2,048-bit DSA-encrypted key named <code class="literal">MyKey</code>:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('MyKey', 'DSA', 256);</code></strong>
+-------------------------------------------+
| keyring_key_generate('MyKey', 'DSA', 256) |
+-------------------------------------------+
|                                         1 |
+-------------------------------------------+
</pre><p>
          A return value of 1 indicates success. If the key cannot be
          created, the return value is <code class="literal">NULL</code> and an
          error occurs. One reason this might be is that the underlying
          keyring plugin does not support the specified combination of
          key type and key length; see
          <a class="xref" href="security.html#keyring-key-types" title="6.4.4.7 Supported Keyring Key Types">Section 6.4.4.7, “Supported Keyring Key Types”</a>.
        </p><p>
          To be able to check the return type regardless of whether an
          error occurs, use <code class="literal">SELECT ... INTO
          @<em class="replaceable"><code>var_name</code></em></code> and test the
          variable value:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('', '', -1) INTO @x;</code></strong>
ERROR 3188 (HY000): Function 'keyring_key_generate' failed because
underlying keyring service returned an error. Please check if a
keyring plugin is installed and that provided arguments are valid
for the keyring you are using.
mysql&gt; <strong class="userinput"><code>SELECT @x;</code></strong>
+------+
| @x   |
+------+
| NULL |
+------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('x', 'AES', 16) INTO @x;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT @x;</code></strong>
+------+
| @x   |
+------+
|    1 |
+------+
</pre><p>
          This technique also applies to other keyring UDFs that for
          failure return a value and an error.
        </p><p>
          The ID passed to
          <a class="link" href="security.html#udf_keyring-key-generate"><code class="literal">keyring_key_generate()</code></a> provides
          a means by which to refer to the key in subsequent UDF calls.
          For example, use the key ID to retrieve its type as a string
          or its length in bytes as an integer:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_type_fetch('MyKey');</code></strong>
+---------------------------------+
| keyring_key_type_fetch('MyKey') |
+---------------------------------+
| DSA                             |
+---------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_length_fetch('MyKey');</code></strong>
+-----------------------------------+
| keyring_key_length_fetch('MyKey') |
+-----------------------------------+
|                               256 |
+-----------------------------------+
</pre><p>
          To retrieve a key value, pass the key ID to
          <a class="link" href="security.html#udf_keyring-key-fetch"><code class="literal">keyring_key_fetch()</code></a>. The
          following example uses <a class="link" href="functions.html#function_hex"><code class="literal">HEX()</code></a> to
          display the key value because it may contain nonprintable
          characters. The example also uses a short key for brevity, but
          be aware that longer keys provide better security:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('MyShortKey', 'DSA', 8);</code></strong>
+----------------------------------------------+
| keyring_key_generate('MyShortKey', 'DSA', 8) |
+----------------------------------------------+
|                                            1 |
+----------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT HEX(keyring_key_fetch('MyShortKey'));</code></strong>
+--------------------------------------+
| HEX(keyring_key_fetch('MyShortKey')) |
+--------------------------------------+
| 1DB3B0FC3328A24C                     |
+--------------------------------------+
</pre><p>
          Keyring UDFs treat key IDs, types, and values as binary
          strings, so comparisons are case-sensitive. For example, IDs
          of <code class="literal">MyKey</code> and <code class="literal">mykey</code> refer
          to different keys.
        </p><p>
          To remove a key, pass the key ID to
          <a class="link" href="security.html#udf_keyring-key-remove"><code class="literal">keyring_key_remove()</code></a>:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_remove('MyKey');</code></strong>
+-----------------------------+
| keyring_key_remove('MyKey') |
+-----------------------------+
|                           1 |
+-----------------------------+
</pre><p>
          To obfuscate and store a key that you provide, pass the key
          ID, type, and value to
          <a class="link" href="security.html#udf_keyring-key-store"><code class="literal">keyring_key_store()</code></a>:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_store('AES_key', 'AES', 'Secret string');</code></strong>
+------------------------------------------------------+
| keyring_key_store('AES_key', 'AES', 'Secret string') |
+------------------------------------------------------+
|                                                    1 |
+------------------------------------------------------+
</pre><p>
          As indicated previously, a user must have the global
          <a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege to call
          keyring UDFs, and the user who stores a key in the keyring
          initially must be the same user who performs subsequent
          operations on the key later, as determined from the
          <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> value in effect
          for each UDF call. To permit key operations to users who do
          not have the global <a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a>
          privilege or who may not be the key <span class="quote">“<span class="quote">owner,</span>”</span> use
          this technique:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              Define <span class="quote">“<span class="quote">wrapper</span>”</span> stored programs that
              encapsulate the required key operations and have a
              <code class="literal">DEFINER</code> value equal to the key owner.
            </p></li><li class="listitem"><p>
              Grant the <a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege
              for specific stored programs to the individual users who
              should be able to invoke them.
            </p></li><li class="listitem"><p>
              If the operations implemented by the wrapper stored
              programs do not include key creation, create any necessary
              keys in advance, using the account named as the
              <code class="literal">DEFINER</code> in the stored program
              definitions.
</p></li></ol>
</div>
<p>
          This technique enables keys to be shared among users and
          provides to DBAs more fine-grained control over who can do
          what with keys, without having to grant global privileges.
        </p><p>
          The following example shows how to set up a shared key named
          <code class="literal">SharedKey</code> that is owned by the DBA, and a
          <code class="literal">get_shared_key()</code> stored function that
          provides access to the current key value. The value can be
          retrieved by any user with the
          <a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a> privilege for that
          function, which is created in the
          <code class="literal">key_schema</code> schema.
        </p><p>
          From a MySQL administrative account
          (<code class="literal">'root'@'localhost'</code> in this example),
          create the administrative schema and the stored function to
          access the key:
        </p><pre data-lang="sql" class="programlisting">

mysql&gt; <strong class="userinput"><code>CREATE SCHEMA key_schema;</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE DEFINER = 'root'@'localhost'</code></strong>
       <strong class="userinput"><code>FUNCTION key_schema.get_shared_key()</code></strong>
       <strong class="userinput"><code>RETURNS BLOB READS SQL DATA</code></strong>
       <strong class="userinput"><code>RETURN keyring_key_fetch('SharedKey');</code></strong>
</pre><p>
          From the administrative account, ensure that the shared key
          exists:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('SharedKey', 'DSA', 8);</code></strong>
+---------------------------------------------+
| keyring_key_generate('SharedKey', 'DSA', 8) |
+---------------------------------------------+
|                                           1 |
+---------------------------------------------+
</pre><p>
          From the administrative account, create an ordinary user
          account to which key access is to be granted:
        </p><pre data-lang="sql" class="programlisting">

mysql&gt; <strong class="userinput"><code>CREATE USER 'key_user'@'localhost'</code></strong>
       <strong class="userinput"><code>IDENTIFIED BY 'key_user_pwd';</code></strong>
</pre><p>
          From the <code class="literal">key_user</code> account, verify that,
          without the proper <a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a>
          privilege, the new account cannot access the shared key:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT HEX(key_schema.get_shared_key());</code></strong>
ERROR 1370 (42000): execute command denied to user 'key_user'@'localhost'
for routine 'key_schema.get_shared_key'
</pre><p>
          From the administrative account, grant
          <a class="link" href="security.html#priv_execute"><code class="literal">EXECUTE</code></a> to
          <code class="literal">key_user</code> for the stored function:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>GRANT EXECUTE ON FUNCTION key_schema.get_shared_key</code></strong>
       <strong class="userinput"><code>TO 'key_user'@'localhost';</code></strong>
</pre><p>
          From the <code class="literal">key_user</code> account, verify that the
          key is now accessible:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT HEX(key_schema.get_shared_key());</code></strong>
+----------------------------------+
| HEX(key_schema.get_shared_key()) |
+----------------------------------+
| 9BAFB9E75CEEB013                 |
+----------------------------------+
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="keyring-udf-reference"></a>6.4.4.8.3 General-Purpose Keyring Function Reference</h5>

</div>

</div>

</div>
<p>
          For each general-purpose keyring user-defined function (UDF),
          this section describes its purpose, calling sequence, and
          return value. For information about the conditions under which
          these UDFs can be invoked, see
          <a class="xref" href="security.html#keyring-udf-usage" title="6.4.4.8.2 Using General-Purpose Keyring Functions">Section 6.4.4.8.2, “Using General-Purpose Keyring Functions”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="udf_keyring-key-fetch"></a>
              <a class="link" href="security.html#udf_keyring-key-fetch"><code class="literal">keyring_key_fetch(<em class="replaceable"><code>key_id</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091715282768"></a><a class="indexterm" name="idm140091715281680"></a><p>
              Given a key ID, deobfuscates and returns the key value.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              Returns the key value as a string for success,
              <code class="literal">NULL</code> if the key does not exist, or
              <code class="literal">NULL</code> and an error for failure.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                Keyring values retrieved using
                <a class="link" href="security.html#udf_keyring-key-fetch"><code class="literal">keyring_key_fetch()</code></a> are
                limited to 2,048 bytes, due to limitations of the UDF
                interface. A keyring value longer than that length can
                be stored using a keyring service function (see
                <a class="xref" href="extending-mysql.html#keyring-service" title="29.3.2 The Keyring Service">Section 29.3.2, “The Keyring Service”</a>), but if retrieved
                using <a class="link" href="security.html#udf_keyring-key-fetch"><code class="literal">keyring_key_fetch()</code></a>,
                is truncated to 2,048 bytes.
</p>
</div>
<p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('RSA_key', 'RSA', 16);</code></strong>
+--------------------------------------------+
| keyring_key_generate('RSA_key', 'RSA', 16) |
+--------------------------------------------+
|                                          1 |
+--------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT HEX(keyring_key_fetch('RSA_key'));</code></strong>
+-----------------------------------+
| HEX(keyring_key_fetch('RSA_key')) |
+-----------------------------------+
| 91C2253B696064D3556984B6630F891A  |
+-----------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_type_fetch('RSA_key');</code></strong>
+-----------------------------------+
| keyring_key_type_fetch('RSA_key') |
+-----------------------------------+
| RSA                               |
+-----------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_length_fetch('RSA_key');</code></strong>
+-------------------------------------+
| keyring_key_length_fetch('RSA_key') |
+-------------------------------------+
|                                  16 |
+-------------------------------------+
</pre><p>
              The example uses <a class="link" href="functions.html#function_hex"><code class="literal">HEX()</code></a> to
              display the key value because it may contain nonprintable
              characters. The example also uses a short key for brevity,
              but be aware that longer keys provide better security.
            </p></li><li class="listitem"><p><a name="udf_keyring-key-generate"></a>
              <a class="link" href="security.html#udf_keyring-key-generate"><code class="literal">keyring_key_generate(<em class="replaceable"><code>key_id</code></em>,
              <em class="replaceable"><code>key_type</code></em>,
              <em class="replaceable"><code>key_length</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091715259440"></a><a class="indexterm" name="idm140091715258400"></a><p>
              Generates a new random key with a given ID, type, and
              length, and stores it in the keyring. The type and length
              values must be consistent with the values supported by the
              underlying keyring plugin, with the additional constraint
              that keys cannot be longer than 2,048 bytes (16,384 bits),
              due to limitations of the UDF interface. For the permitted
              types per plugin, see <a class="xref" href="extending-mysql.html#keyring-service" title="29.3.2 The Keyring Service">Section 29.3.2, “The Keyring Service”</a>.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key_type</code></em>: A string that
                  specifies the key type.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key_length</code></em>: An integer that
                  specifies the key length in bytes. The maximum length
                  is 2,048.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              Returns 1 for success, or <code class="literal">NULL</code> and an
              error for failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_generate('RSA_key', 'RSA', 384);</code></strong>
+---------------------------------------------+
| keyring_key_generate('RSA_key', 'RSA', 384) |
+---------------------------------------------+
|                                           1 |
+---------------------------------------------+
</pre></li><li class="listitem"><p><a name="udf_keyring-key-length-fetch"></a>
              <a class="link" href="security.html#udf_keyring-key-length-fetch"><code class="literal">keyring_key_length_fetch(<em class="replaceable"><code>key_id</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091715243616"></a><a class="indexterm" name="idm140091715242528"></a><p>
              Given a key ID, returns the key length.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              Returns the key length in bytes as an integer for success,
              <code class="literal">NULL</code> if the key does not exist, or
              <code class="literal">NULL</code> and an error for failure.
            </p><p>
              Example:
            </p><p>
              See the description of
              <a class="link" href="security.html#udf_keyring-key-fetch"><code class="literal">keyring_key_fetch()</code></a>.
            </p></li><li class="listitem"><p><a name="udf_keyring-key-remove"></a>
              <a class="link" href="security.html#udf_keyring-key-remove"><code class="literal">keyring_key_remove(<em class="replaceable"><code>key_id</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091715231168"></a><a class="indexterm" name="idm140091715230080"></a><p>
              Removes the key with a given ID from the keyring.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              Returns 1 for success, or <code class="literal">NULL</code> for
              failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_remove('AES_key');</code></strong>
+-------------------------------+
| keyring_key_remove('AES_key') |
+-------------------------------+
|                             1 |
+-------------------------------+
</pre></li><li class="listitem"><p><a name="udf_keyring-key-store"></a>
              <a class="link" href="security.html#udf_keyring-key-store"><code class="literal">keyring_key_store(<em class="replaceable"><code>key_id</code></em>,
              <em class="replaceable"><code>key_type</code></em>,
              <em class="replaceable"><code>key</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091715218432"></a><a class="indexterm" name="idm140091715217344"></a><p>
              Obfuscates and stores a key in the keyring.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key_type</code></em>: A string that
                  specifies the key type.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>key</code></em>: A string that
                  specifies the key value.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              Returns 1 for success, or <code class="literal">NULL</code> and an
              error for failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT keyring_key_store('new key', 'DSA', 'My key value');</code></strong>
+-----------------------------------------------------+
| keyring_key_store('new key', 'DSA', 'My key value') |
+-----------------------------------------------------+
|                                                   1 |
+-----------------------------------------------------+
</pre></li><li class="listitem"><p><a name="udf_keyring-key-type-fetch"></a>
              <a class="link" href="security.html#udf_keyring-key-type-fetch"><code class="literal">keyring_key_type_fetch(<em class="replaceable"><code>key_id</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091715203616"></a><a class="indexterm" name="idm140091715202576"></a><p>
              Given a key ID, returns the key type.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>key_id</code></em>: A string that
                  specifies the key ID.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              Returns the key type as a string for success,
              <code class="literal">NULL</code> if the key does not exist, or
              <code class="literal">NULL</code> and an error for failure.
            </p><p>
              Example:
            </p><p>
              See the description of
              <a class="link" href="security.html#udf_keyring-key-fetch"><code class="literal">keyring_key_fetch()</code></a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-udfs-plugin-specific"></a>6.4.4.9 Plugin-Specific Keyring Key-Management Functions</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091715192256"></a><p>
        For each keyring plugin-specific user-defined function (UDF),
        this section describes its purpose, calling sequence, and return
        value. For information about general-purpose keyring UDFs, see
        <a class="xref" href="security.html#keyring-udfs-general-purpose" title="6.4.4.8 General-Purpose Keyring Key-Management Functions">Section 6.4.4.8, “General-Purpose Keyring Key-Management Functions”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="udf_keyring-aws-rotate-cmk"></a>
            <a class="link" href="security.html#udf_keyring-aws-rotate-cmk"><code class="literal">keyring_aws_rotate_cmk()</code></a>
          </p><a class="indexterm" name="idm140091715186944"></a><a class="indexterm" name="idm140091715185840"></a><p>
            This UDF is associated with the
            <code class="literal">keyring_aws</code> plugin. Its use requires the
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege.
          </p><p>
            <a class="link" href="security.html#udf_keyring-aws-rotate-cmk"><code class="literal">keyring_aws_rotate_cmk()</code></a>
            rotates the customer master key (CMK). Rotation changes only
            the key that AWS KMS uses for subsequent data key-encryption
            operations. AWS KMS maintains previous CMK versions, so keys
            generated using previous CMKs remain decryptable after
            rotation.
          </p><p>
            Rotation changes the CMK value used inside AWS KMS but does
            not change the ID used to refer to it, so there is no need
            to change the
            <a class="link" href="security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a> system
            variable after calling
            <a class="link" href="security.html#udf_keyring-aws-rotate-cmk"><code class="literal">keyring_aws_rotate_cmk()</code></a>.
          </p><p>
            Arguments:
          </p><p>
            None.
          </p><p>
            Return value:
          </p><p>
            Returns 1 for success, or <code class="literal">NULL</code> and an
            error for failure.
          </p></li><li class="listitem"><p><a name="udf_keyring-aws-rotate-keys"></a>
            <a class="link" href="security.html#udf_keyring-aws-rotate-keys"><code class="literal">keyring_aws_rotate_keys()</code></a>
          </p><a class="indexterm" name="idm140091715171872"></a><a class="indexterm" name="idm140091715170768"></a><p>
            This UDF is associated with the
            <code class="literal">keyring_aws</code> plugin. Its use requires the
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege.
          </p><p>
            <a class="link" href="security.html#udf_keyring-aws-rotate-keys"><code class="literal">keyring_aws_rotate_keys()</code></a>
            rotates keys stored in the <code class="literal">keyring_aws</code>
            storage file named by the
            <a class="link" href="security.html#sysvar_keyring_aws_data_file"><code class="literal">keyring_aws_data_file</code></a>
            system variable. Rotation sends each key stored in the file
            to AWS KMS for re-encryption using the value of the
            <a class="link" href="security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a> system
            variable as the CMK value, and stores the new encrypted keys
            in the file.
          </p><p>
            <a class="link" href="security.html#udf_keyring-aws-rotate-keys"><code class="literal">keyring_aws_rotate_keys()</code></a> is
            useful for key re-encryption under these circumstances:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                After rotating the CMK; that is, after invoking the
                <a class="link" href="security.html#udf_keyring-aws-rotate-cmk"><code class="literal">keyring_aws_rotate_cmk()</code></a>
                UDF
              </p></li><li class="listitem"><p>
                After changing the
                <a class="link" href="security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a>
                system variable to a different key value
</p></li></ul>
</div>
<p>
            Arguments:
          </p><p>
            None.
          </p><p>
            Return value:
          </p><p>
            Returns 1 for success, or <code class="literal">NULL</code> and an
            error for failure.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-options"></a>6.4.4.10 Keyring Command Options</h4>

</div>

</div>

</div>
<p>
        MySQL supports the following keyring-related command-line
        options:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_keyring-migration-destination"></a>
            <a class="link" href="security.html#option_mysqld_keyring-migration-destination"><code class="option">--keyring-migration-destination=<em class="replaceable"><code>plugin</code></em></code></a>
</p><a class="indexterm" name="idm140091715147968"></a><a class="indexterm" name="idm140091715146464"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-destination"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-migration-destination=plugin_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
            The destination keyring plugin for key migration. See
            <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.6 Migrating Keys Between Keyring Keystores">Section 6.4.4.6, “Migrating Keys Between Keyring Keystores”</a>. The format and
            interpretation of the option value is the same as described
            for the
            <a class="link" href="security.html#option_mysqld_keyring-migration-source"><code class="option">--keyring-migration-source</code></a>
            option.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              <a class="link" href="security.html#option_mysqld_keyring-migration-source"><code class="option">--keyring-migration-source</code></a>
              and
              <a class="link" href="security.html#option_mysqld_keyring-migration-destination"><code class="option">--keyring-migration-destination</code></a>
              are mandatory for all keyring migration operations. The
              source and destination plugins must differ, and the
              migration server must support both plugins.
</p>
</div>
</li><li class="listitem"><p><a name="option_mysqld_keyring-migration-host"></a>
            <a class="link" href="security.html#option_mysqld_keyring-migration-host"><code class="option">--keyring-migration-host=<em class="replaceable"><code>host_name</code></em></code></a>
</p><a class="indexterm" name="idm140091715122784"></a><a class="indexterm" name="idm140091715121280"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-host"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-migration-host=host_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">localhost</code></td>
</tr></tbody></table>
</div>
<p>
            The host location of the running server that is currently
            using one of the key migration keystores. See
            <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.6 Migrating Keys Between Keyring Keystores">Section 6.4.4.6, “Migrating Keys Between Keyring Keystores”</a>. Migration always
            occurs on the local host, so the option always specifies a
            value for connecting to a local server, such as
            <code class="literal">localhost</code>, <code class="literal">127.0.0.1</code>,
            <code class="literal">::1</code>, or the local host IP address or host
            name.
          </p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-password"></a>
            <a class="link" href="security.html#option_mysqld_keyring-migration-password"><code class="option">--keyring-migration-password[=<em class="replaceable"><code>password</code></em>]</code></a>
</p><a class="indexterm" name="idm140091715096032"></a><a class="indexterm" name="idm140091715094528"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-password"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-migration-password[=password]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
            The password for connecting to the running server that is
            currently using one of the key migration keystores. See
            <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.6 Migrating Keys Between Keyring Keystores">Section 6.4.4.6, “Migrating Keys Between Keyring Keystores”</a>. If you omit the
            <em class="replaceable"><code>password</code></em> value following the
            option name on the command line, the server prompts for one.
          </p><p>
            Specifying a password on the command line should be
            considered insecure. See
            <a class="xref" href="security.html#password-security-user" title="6.1.2.1 End-User Guidelines for Password Security">Section 6.1.2.1, “End-User Guidelines for Password Security”</a>. You can use an
            option file to avoid giving the password on the command
            line. In this case, the file should have a restrictive mode
            and be accessible only to the account used to run the
            migration server.
          </p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-port"></a>
            <a class="link" href="security.html#option_mysqld_keyring-migration-port"><code class="option">--keyring-migration-port=<em class="replaceable"><code>port_num</code></em></code></a>
</p><a class="indexterm" name="idm140091715072976"></a><a class="indexterm" name="idm140091715071472"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-port"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-migration-port=port_num</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Numeric</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">3306</code></td>
</tr></tbody></table>
</div>
<p>
            For TCP/IP connections, the port number for connecting to
            the running server that is currently using one of the key
            migration keystores. See
            <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.6 Migrating Keys Between Keyring Keystores">Section 6.4.4.6, “Migrating Keys Between Keyring Keystores”</a>.
          </p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-socket"></a>
            <a class="link" href="security.html#option_mysqld_keyring-migration-socket"><code class="option">--keyring-migration-socket=<em class="replaceable"><code>path</code></em></code></a>
</p><a class="indexterm" name="idm140091715048784"></a><a class="indexterm" name="idm140091715047280"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-socket"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-migration-socket={file_name|pipe_name}</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
            For Unix socket file or Windows named pipe connections, the
            socket file or named pipe for connecting to the running
            server that is currently using one of the key migration
            keystores. See <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.6 Migrating Keys Between Keyring Keystores">Section 6.4.4.6, “Migrating Keys Between Keyring Keystores”</a>.
          </p></li><li class="listitem"><p><a name="option_mysqld_keyring-migration-source"></a>
            <a class="link" href="security.html#option_mysqld_keyring-migration-source"><code class="option">--keyring-migration-source=<em class="replaceable"><code>plugin</code></em></code></a>
</p><a class="indexterm" name="idm140091715027552"></a><a class="indexterm" name="idm140091715026048"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-source"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-migration-source=plugin_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
            The source keyring plugin for key migration. See
            <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.6 Migrating Keys Between Keyring Keystores">Section 6.4.4.6, “Migrating Keys Between Keyring Keystores”</a>.
          </p><p>
            The option value is similar to that for
            <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a>, except that
            only one plugin library can be specified. The value is given
            as
            <em class="replaceable"><code>name</code></em><code class="literal">=</code><em class="replaceable"><code>plugin_library</code></em>
            or <em class="replaceable"><code>plugin_library</code></em>. The
            <em class="replaceable"><code>name</code></em> is the name of a plugin to
            load, and <em class="replaceable"><code>plugin_library</code></em> is the
            name of the library file that contains the plugin code. If
            the plugin library is named without any preceding plugin
            name, the server loads all plugins in the library. The
            server looks for plugin library files in the directory named
            by the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
            variable.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              <a class="link" href="security.html#option_mysqld_keyring-migration-source"><code class="option">--keyring-migration-source</code></a>
              and
              <a class="link" href="security.html#option_mysqld_keyring-migration-destination"><code class="option">--keyring-migration-destination</code></a>
              are mandatory for all keyring migration operations. The
              source and destination plugins must differ, and the
              migration server must support both plugins.
</p>
</div>
</li><li class="listitem"><p><a name="option_mysqld_keyring-migration-user"></a>
            <a class="link" href="security.html#option_mysqld_keyring-migration-user"><code class="option">--keyring-migration-user=<em class="replaceable"><code>user_name</code></em></code></a>
</p><a class="indexterm" name="idm140091714997712"></a><a class="indexterm" name="idm140091714996208"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring-migration-user"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-migration-user=user_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
            The user name for connecting to the running server that is
            currently using one of the key migration keystores. See
            <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.6 Migrating Keys Between Keyring Keystores">Section 6.4.4.6, “Migrating Keys Between Keyring Keystores”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="keyring-system-variables"></a>6.4.4.11 Keyring System Variables</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091714977536"></a><p>
        MySQL Keyring plugins support the following system variables.
        Use them to configure keyring plugin operation. These variables
        are unavailable unless the appropriate keyring plugin is
        installed (see <a class="xref" href="security.html#keyring-installation" title="6.4.4.1 Keyring Plugin Installation">Section 6.4.4.1, “Keyring Plugin Installation”</a>).
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_keyring_aws_cmk_id"></a>
            <a class="indexterm" name="idm140091714973872"></a>

            <a class="indexterm" name="idm140091714972832"></a>

            <a class="link" href="security.html#sysvar_keyring_aws_cmk_id"><code class="literal">keyring_aws_cmk_id</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_aws_cmk_id"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-aws-cmk-id=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_aws_cmk_id">keyring_aws_cmk_id</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
            The customer master key (CMK) ID obtained from the AWS KMS
            server and used by the <code class="literal">keyring_aws</code>
            plugin. This variable is unavailable unless that plugin is
            installed, but if it is installed, a value for this variable
            is mandatory.
          </p></li><li class="listitem"><p><a name="sysvar_keyring_aws_conf_file"></a>
            <a class="indexterm" name="idm140091714940336"></a>

            <a class="indexterm" name="idm140091714939296"></a>

            <a class="link" href="security.html#sysvar_keyring_aws_conf_file"><code class="literal">keyring_aws_conf_file</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_aws_conf_file"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-aws-conf-file=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_aws_conf_file">keyring_aws_conf_file</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>File name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table>
</div>
<p>
            The location of the configuration file for the
            <code class="literal">keyring_aws</code> keyring plugin. This variable
            is unavailable unless that plugin is installed.
          </p><p>
            At plugin startup, <code class="literal">keyring_aws</code> reads the
            AWS secret access key ID and key from the configuration
            file. For the <code class="literal">keyring_aws</code> plugin to start
            successfully, the configuration file must exist and contain
            valid secret access key information, initialized as
            described in <a class="xref" href="security.html#keyring-aws-plugin" title="6.4.4.5 Using the keyring_aws Amazon Web Services Keyring Plugin">Section 6.4.4.5, “Using the keyring_aws Amazon Web Services Keyring Plugin”</a>.
          </p><p>
            The default file name is
            <code class="literal">keyring_aws_conf</code>, located in the default
            keyring file directory. The location of this default
            directory is the same as for the
            <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> system
            variable. See the description of that variable for details,
            as well as for considerations to take into account if you
            create the directory manually.
          </p></li><li class="listitem"><p><a name="sysvar_keyring_aws_data_file"></a>
            <a class="indexterm" name="idm140091714898272"></a>

            <a class="indexterm" name="idm140091714897232"></a>

            <a class="link" href="security.html#sysvar_keyring_aws_data_file"><code class="literal">keyring_aws_data_file</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_aws_data_file"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-aws-data-file</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_aws_data_file">keyring_aws_data_file</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>File name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table>
</div>
<p>
            The location of the storage file for the
            <code class="literal">keyring_aws</code> keyring plugin. This variable
            is unavailable unless that plugin is installed.
          </p><p>
            At plugin startup, if the value assigned to
            <a class="link" href="security.html#sysvar_keyring_aws_data_file"><code class="literal">keyring_aws_data_file</code></a>
            specifies a file that does not exist, the
            <code class="literal">keyring_aws</code> plugin attempts to create it
            (as well as its parent directory, if necessary). If the file
            does exist, <code class="literal">keyring_aws</code> reads any
            encrypted keys contained in the file into its in-memory
            cache. <code class="literal">keyring_aws</code> does not cache
            unencrypted keys in memory.
          </p><p>
            The default file name is
            <code class="literal">keyring_aws_data</code>, located in the default
            keyring file directory. The location of this default
            directory is the same as for the
            <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> system
            variable. See the description of that variable for details,
            as well as for considerations to take into account if you
            create the directory manually.
          </p></li><li class="listitem"><p><a name="sysvar_keyring_aws_region"></a>
            <a class="link" href="security.html#sysvar_keyring_aws_region"><code class="literal">keyring_aws_region</code></a>
</p><a class="indexterm" name="idm140091714853568"></a><a class="indexterm" name="idm140091714852528"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_aws_region"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-aws-region=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_aws_region">keyring_aws_region</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">us-east-1</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">ap-northeast-1</code></p><p class="valid-value"><code class="literal">ap-northeast-2</code></p><p class="valid-value"><code class="literal">ap-south-1</code></p><p class="valid-value"><code class="literal">ap-southeast-1</code></p><p class="valid-value"><code class="literal">ap-southeast-2</code></p><p class="valid-value"><code class="literal">eu-central-1</code></p><p class="valid-value"><code class="literal">eu-west-1</code></p><p class="valid-value"><code class="literal">sa-east-1</code></p><p class="valid-value"><code class="literal">us-east-1</code></p><p class="valid-value"><code class="literal">us-west-1</code></p><p class="valid-value"><code class="literal">us-west-2</code></p></td>
</tr></tbody></table>
</div>
<p>
            The AWS region.
          </p></li><li class="listitem"><p><a name="sysvar_keyring_encrypted_file_data"></a>
            <a class="link" href="security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a>
</p><a class="indexterm" name="idm140091714804912"></a><a class="indexterm" name="idm140091714803808"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_encrypted_file_data"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-encrypted-file-data=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_encrypted_file_data">keyring_encrypted_file_data</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>File name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table>
</div>
<p>
            The path name of the data file used for secure data storage
            by the <code class="literal">keyring_encrypted_file</code> plugin.
            This variable is unavailable unless that plugin is
            installed. The file location should be in a directory
            considered for use only by keyring plugins. For example, do
            not locate the file under the data directory.
          </p><p>
            Keyring operations are transactional: The
            <code class="literal">keyring_encrypted_file</code> plugin uses a
            backup file during write operations to ensure that it can
            roll back to the original file if an operation fails. The
            backup file has the same name as the value of the
            <a class="link" href="security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a>
            system variable with a suffix of
            <code class="filename">.backup</code>.
          </p><p>
            Do not use the same
            <code class="literal">keyring_encrypted_file</code> data file for
            multiple MySQL instances. Each instance should have its own
            unique data file.
          </p><p>
            The default file name is
            <code class="filename">keyring_encrypted</code>, located in a
            directory that is platform specific and depends on the value
            of the <a class="link" href="installing.html#option_cmake_install_layout"><code class="option">INSTALL_LAYOUT</code></a>
            <span class="command"><strong>CMake</strong></span> option, as shown in the following
            table. To specify the default directory for the file
            explicitly if you are building from source, use the
            <a class="link" href="installing.html#option_cmake_install_mysqlkeyringdir"><code class="option">INSTALL_MYSQLKEYRINGDIR</code></a>
            <span class="command"><strong>CMake</strong></span> option.
</p>
<div class="informaltable">
<table summary="The default keyring_encrypted_file_data value for different INSTALL_LAYOUT values."><col width="35%"><col width="65%"><thead><tr>
                <th scope="col"><code class="literal">INSTALL_LAYOUT</code> Value</th>
                <th scope="col">Default <code class="literal">keyring_encrypted_file_data</code> Value</th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">DEB</code>, <code class="literal">RPM</code>, <code class="literal">SLES</code>,
                  <code class="literal">SVR4</code></td>
                <td><code class="filename">/var/lib/mysql-keyring/keyring_encrypted</code></td>
              </tr><tr>
                <td scope="row">Otherwise</td>
                <td><code class="filename">keyring/keyring_encrypted</code> under the
                  <a class="link" href="installing.html#option_cmake_cmake_install_prefix"><code class="option">CMAKE_INSTALL_PREFIX</code></a>
                  value</td>
</tr></tbody></table>
</div>
<p>
            At plugin startup, if the value assigned to
            <a class="link" href="security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a>
            specifies a file that does not exist, the
            <code class="literal">keyring_encrypted_file</code> plugin attempts to
            create it (as well as its parent directory, if necessary).
          </p><p>
            If you create the directory manually, it should have a
            restrictive mode and be accessible only to the account used
            to run the MySQL server. For example, on Unix and Unix-like
            systems, to use the
            <code class="filename">/usr/local/mysql/mysql-keyring</code>
            directory, the following commands (executed as
            <code class="literal">root</code>) create the directory and set its
            mode and ownership:
          </p><pre data-lang="terminal" class="programlisting">
cd /usr/local/mysql
mkdir mysql-keyring
chmod 750 mysql-keyring
chown mysql mysql-keyring
chgrp mysql mysql-keyring
</pre><p>
            If the <code class="literal">keyring_encrypted_file</code> plugin
            cannot create or access its data file, it writes an error
            message to the error log. If an attempted runtime assignment
            to
            <a class="link" href="security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a>
            results in an error, the variable value remains unchanged.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
              Once the <code class="literal">keyring_encrypted_file</code> plugin
              has created its data file and started to use it, it is
              important not to remove the file. Loss of the file will
              cause data encrypted using its keys to become
              inaccessible. (It is permissible to rename or move the
              file, as long as you change the value of
              <a class="link" href="security.html#sysvar_keyring_encrypted_file_data"><code class="literal">keyring_encrypted_file_data</code></a>
              to match.)
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_keyring_encrypted_file_password"></a>
            <a class="link" href="security.html#sysvar_keyring_encrypted_file_password"><code class="literal">keyring_encrypted_file_password</code></a>
</p><a class="indexterm" name="idm140091714730720"></a><a class="indexterm" name="idm140091714729616"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_encrypted_file_password"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-encrypted-file-password=password</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_encrypted_file_password">keyring_encrypted_file_password</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr></tbody></table>
</div>
<p>
            The password used by the
            <code class="literal">keyring_encrypted_file</code> plugin. This
            variable is unavailable unless that plugin is installed. The
            password is mandatory for plugin operation; if not specified
            at server startup, <code class="literal">keyring_encrypted_file</code>
            initialization fails.
          </p><p>
            If this variable is specified in an option file, the file
            should have a restrictive mode and be accessible only to the
            account used to run the MySQL server.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
              Once the
              <a class="link" href="security.html#sysvar_keyring_encrypted_file_password"><code class="literal">keyring_encrypted_file_password</code></a>
              value has been set, changing it does not rotate the
              keyring password and could make the server inaccessible.
              If an incorrect password is provided, the
              <code class="literal">keyring_encrypted_file</code> plugin cannot
              load keys from the encrypted keyring file.
</p>
</div>
<p>
            The password value cannot be displayed at runtime with
            <a class="link" href="sql-syntax.html#show-variables" title="13.7.6.39 SHOW VARIABLES Syntax"><code class="literal">SHOW VARIABLES</code></a> or the
            Performance Schena
            <a class="link" href="performance-schema.html#performance-schema-system-variable-tables" title="26.12.13 Performance Schema System Variable Tables"><code class="literal">global_variables</code></a> table because
            the display value is obfuscated.
          </p></li><li class="listitem"><p><a name="sysvar_keyring_file_data"></a>
            <a class="indexterm" name="idm140091714691008"></a>

            <a class="indexterm" name="idm140091714689968"></a>

            <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_file_data"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-file-data=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_file_data">keyring_file_data</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>File name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">platform specific</code></td>
</tr></tbody></table>
</div>
<p>
            The path name of the data file used for secure data storage
            by the <code class="literal">keyring_file</code> plugin. This variable
            is unavailable unless that plugin is installed. The file
            location should be in a directory considered for use only by
            keyring plugins. For example, do not locate the file under
            the data directory.
          </p><p>
            Keyring operations are transactional: The
            <code class="literal">keyring_file</code> plugin uses a backup file
            during write operations to ensure that it can roll back to
            the original file if an operation fails. The backup file has
            the same name as the value of the
            <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> system
            variable with a suffix of <code class="filename">.backup</code>.
          </p><p>
            Do not use the same <code class="literal">keyring_file</code> data
            file for multiple MySQL instances. Each instance should have
            its own unique data file.
          </p><p>
            The default file name is <code class="filename">keyring</code>,
            located in a directory that is platform specific and depends
            on the value of the
            <a class="link" href="installing.html#option_cmake_install_layout"><code class="option">INSTALL_LAYOUT</code></a>
            <span class="command"><strong>CMake</strong></span> option, as shown in the following
            table. To specify the default directory for the file
            explicitly if you are building from source, use the
            <a class="link" href="installing.html#option_cmake_install_mysqlkeyringdir"><code class="option">INSTALL_MYSQLKEYRINGDIR</code></a>
            <span class="command"><strong>CMake</strong></span> option.
</p>
<div class="informaltable">
<table summary="The default keyring_file_data value for different INSTALL_LAYOUT values."><col width="35%"><col width="65%"><thead><tr>
                <th scope="col"><code class="literal">INSTALL_LAYOUT</code> Value</th>
                <th scope="col">Default <code class="literal">keyring_file_data</code> Value</th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">DEB</code>, <code class="literal">RPM</code>, <code class="literal">SLES</code>,
                  <code class="literal">SVR4</code></td>
                <td><code class="filename">/var/lib/mysql-keyring/keyring</code></td>
              </tr><tr>
                <td scope="row">Otherwise</td>
                <td><code class="filename">keyring/keyring</code> under the
                  <a class="link" href="installing.html#option_cmake_cmake_install_prefix"><code class="option">CMAKE_INSTALL_PREFIX</code></a>
                  value</td>
</tr></tbody></table>
</div>
<p>
            At plugin startup, if the value assigned to
            <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> specifies
            a file that does not exist, the
            <code class="literal">keyring_file</code> plugin attempts to create it
            (as well as its parent directory, if necessary).
          </p><p>
            If you create the directory manually, it should have a
            restrictive mode and be accessible only to the account used
            to run the MySQL server. For example, on Unix and Unix-like
            systems, to use the
            <code class="filename">/usr/local/mysql/mysql-keyring</code>
            directory, the following commands (executed as
            <code class="literal">root</code>) create the directory and set its
            mode and ownership:
          </p><pre data-lang="terminal" class="programlisting">
cd /usr/local/mysql
mkdir mysql-keyring
chmod 750 mysql-keyring
chown mysql mysql-keyring
chgrp mysql mysql-keyring
</pre><p>
            If the <code class="literal">keyring_file</code> plugin cannot create
            or access its data file, it writes an error message to the
            error log. If an attempted runtime assignment to
            <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> results
            in an error, the variable value remains unchanged.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
              Once the <code class="literal">keyring_file</code> plugin has
              created its data file and started to use it, it is
              important not to remove the file. For example,
              <code class="literal">InnoDB</code> uses the file to store the
              master key used to decrypt the data in tables that use
              <code class="literal">InnoDB</code> tablespace encryption; see
              <a class="xref" href="innodb-storage-engine.html#innodb-tablespace-encryption" title="15.6.3.9 InnoDB Data-at-Rest Encryption">Section 15.6.3.9, “InnoDB Data-at-Rest Encryption”</a>. Loss of
              the file will cause data in such tables to become
              inaccessible. (It is permissible to rename or move the
              file, as long as you change the value of
              <a class="link" href="security.html#sysvar_keyring_file_data"><code class="literal">keyring_file_data</code></a> to
              match.) It is recommended that you create a separate
              backup of the keyring data file immediately after you
              create the first encrypted table and before and after
              master key rotation.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_keyring_okv_conf_dir"></a>
            <a class="indexterm" name="idm140091714617264"></a>

            <a class="indexterm" name="idm140091714616224"></a>

            <a class="link" href="security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_okv_conf_dir"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--keyring-okv-conf-dir=dir_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_okv_conf_dir">keyring_okv_conf_dir</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Directory name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">empty string</code></td>
</tr></tbody></table>
</div>
<p>
            The path name of the directory that stores configuration
            information used by the <code class="literal">keyring_okv</code>
            plugin. This variable is unavailable unless that plugin is
            installed. The location should be a directory considered for
            use only by the <code class="literal">keyring_okv</code> plugin. For
            example, do not locate the directory under the data
            directory.
          </p><p>
            The default
            <a class="link" href="security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a> value
            is empty. For the <code class="literal">keyring_okv</code> plugin to
            be able to access Oracle Key Vault, the value must be set to
            a directory that contains Oracle Key Vault configuration and
            SSL materials. For instructions on setting up this
            directory, see <a class="xref" href="security.html#keyring-okv-plugin" title="6.4.4.4 Using the keyring_okv KMIP Plugin">Section 6.4.4.4, “Using the keyring_okv KMIP Plugin”</a>.
          </p><p>
            The directory should have a restrictive mode and be
            accessible only to the account used to run the MySQL server.
            For example, on Unix and Unix-like systems, to use the
            <code class="filename">/usr/local/mysql/mysql-keyring-okv</code>
            directory, the following commands (executed as
            <code class="literal">root</code>) create the directory and set its
            mode and ownership:
          </p><pre data-lang="terminal" class="programlisting">
cd /usr/local/mysql
mkdir mysql-keyring-okv
chmod 750 mysql-keyring-okv
chown mysql mysql-keyring-okv
chgrp mysql mysql-keyring-okv
</pre><p>
            If the value assigned to
            <a class="link" href="security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a>
            specifies a directory that does not exist, or that does not
            contain configuration information that enables a connection
            to Oracle Key Vault to be established,
            <code class="literal">keyring_okv</code> writes an error message to
            the error log. If an attempted runtime assignment to
            <a class="link" href="security.html#sysvar_keyring_okv_conf_dir"><code class="literal">keyring_okv_conf_dir</code></a>
            results in an error, the variable value and keyring
            operation remain unchanged.
          </p></li><li class="listitem"><p><a name="sysvar_keyring_operations"></a>
            <a class="link" href="security.html#sysvar_keyring_operations"><code class="literal">keyring_operations</code></a>
</p><a class="indexterm" name="idm140091714567840"></a><a class="indexterm" name="idm140091714566800"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for keyring_operations"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.4</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_keyring_operations">keyring_operations</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
            Whether keyring operations are enabled. This variable is
            used during key migration operations. See
            <a class="xref" href="security.html#keyring-key-migration" title="6.4.4.6 Migrating Keys Between Keyring Keystores">Section 6.4.4.6, “Migrating Keys Between Keyring Keystores”</a>. The privileges
            required to modify this variable are
            <a class="link" href="security.html#priv_encryption-key-admin"><code class="literal">ENCRYPTION_KEY_ADMIN</code></a> in
            addition to either
            <a class="link" href="security.html#priv_system-variables-admin"><code class="literal">SYSTEM_VARIABLES_ADMIN</code></a> or
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>.
</p></li></ul>
</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="audit-log"></a>6.4.5 MySQL Enterprise Audit</h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#audit-log-components">6.4.5.1 Audit Log Components</a></span></dt><dt><span class="section"><a href="security.html#audit-log-installation">6.4.5.2 Installing or Uninstalling MySQL Enterprise Audit</a></span></dt><dt><span class="section"><a href="security.html#audit-log-security">6.4.5.3 MySQL Enterprise Audit Security Considerations</a></span></dt><dt><span class="section"><a href="security.html#audit-log-file-formats">6.4.5.4 Audit Log File Formats</a></span></dt><dt><span class="section"><a href="security.html#audit-log-logging-configuration">6.4.5.5 Audit Log Logging Configuration</a></span></dt><dt><span class="section"><a href="security.html#audit-log-filtering">6.4.5.6 Audit Log Filtering</a></span></dt><dt><span class="section"><a href="security.html#audit-log-legacy-filtering">6.4.5.7 Legacy Mode Audit Log Filtering</a></span></dt><dt><span class="section"><a href="security.html#audit-log-reference">6.4.5.8 Audit Log Reference</a></span></dt><dt><span class="section"><a href="security.html#audit-log-restrictions">6.4.5.9 Audit Log Restrictions</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091714531632"></a><a class="indexterm" name="idm140091714530560"></a><a class="indexterm" name="idm140091714529072"></a><a class="indexterm" name="idm140091714528000"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        MySQL Enterprise Audit is an extension included in MySQL Enterprise Edition, a commercial
        product. To learn more about commercial products, see
        <a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a>.
</p>
</div>
<p>
      MySQL Enterprise Edition includes MySQL Enterprise Audit, implemented using a server plugin named
      <code class="literal">audit_log</code>. MySQL Enterprise Audit uses the open MySQL Audit
      API to enable standard, policy-based monitoring, logging, and
      blocking of connection and query activity executed on specific
      MySQL servers. Designed to meet the Oracle audit specification,
      MySQL Enterprise Audit provides an out of box, easy to use auditing and
      compliance solution for applications that are governed by both
      internal and external regulatory guidelines.
    </p><p>
      When installed, the audit plugin enables MySQL Server to produce a
      log file containing an audit record of server activity. The log
      contents include when clients connect and disconnect, and what
      actions they perform while connected, such as which databases and
      tables they access.
    </p><p>
      After you install the audit plugin (see
      <a class="xref" href="security.html#audit-log-installation" title="6.4.5.2 Installing or Uninstalling MySQL Enterprise Audit">Section 6.4.5.2, “Installing or Uninstalling MySQL Enterprise Audit”</a>), it writes an audit log
      file. By default, the file is named <code class="filename">audit.log</code>
      in the server data directory. To change the name of the file, set
      the <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> system
      variable at server startup.
    </p><p>
      By default, audit log file contents are written in new-style XML
      format, without compression or encryption. To select the file
      format, set the <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a>
      system variable at server startup. For details on file format and
      contents, see <a class="xref" href="security.html#audit-log-file-formats" title="6.4.5.4 Audit Log File Formats">Section 6.4.5.4, “Audit Log File Formats”</a>.
    </p><p>
      For more information about controlling how logging occurs,
      including audit log file naming and format selection, see
      <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 Audit Log Logging Configuration">Section 6.4.5.5, “Audit Log Logging Configuration”</a>. To perform
      filtering of audited events, see
      <a class="xref" href="security.html#audit-log-filtering" title="6.4.5.6 Audit Log Filtering">Section 6.4.5.6, “Audit Log Filtering”</a>. For descriptions of the
      parameters used to configure the audit log plugin, see
      <a class="xref" href="security.html#audit-log-options-variables" title="6.4.5.8.4 Audit Log Options and Variables">Section 6.4.5.8.4, “Audit Log Options and Variables”</a>.
    </p><p>
      If the audit log plugin is enabled, the Performance Schema (see
      <a class="xref" href="performance-schema.html" title="Chapter 26 MySQL Performance Schema">Chapter 26, <i>MySQL Performance Schema</i></a>) has instrumentation for it.
      To identify the relevant instruments, use this query:
    </p><pre data-lang="sql" class="programlisting">
SELECT NAME FROM performance_schema.setup_instruments
WHERE NAME LIKE '%/alog/%';
</pre>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-components"></a>6.4.5.1 Audit Log Components</h4>
</div>
</div>
</div>
<p>
        MySQL Enterprise Audit is based on the audit log plugin and related
        components:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A server-side plugin named <code class="literal">audit_log</code>
            examines auditable events and determines whether to write
            them to the audit log.
          </p></li><li class="listitem"><p>
            User-defined functions enable manipulation of filtering
            definitions that control logging behavior, the encryption
            password, and log file reading.
          </p></li><li class="listitem"><p>
            Tables in the <code class="literal">mysql</code> system database
            provide persistent storage of filter and user account data.
          </p></li><li class="listitem"><p>
            System variables enable audit log configuration and status
            variables provide runtime operational information.
          </p></li><li class="listitem"><p>
            An <a class="link" href="security.html#priv_audit-admin"><code class="literal">AUDIT_ADMIN</code></a> privilege
            enable users to administer the audit log.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-installation"></a>6.4.5.2 Installing or Uninstalling MySQL Enterprise Audit</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091714500432"></a><a class="indexterm" name="idm140091714498976"></a><p>
        This section describes how to install or uninstall MySQL Enterprise Audit,
        which is implemented using the audit log plugin and related
        components described in <a class="xref" href="security.html#audit-log-components" title="6.4.5.1 Audit Log Components">Section 6.4.5.1, “Audit Log Components”</a>.
        For general information about installing plugins, see
        <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
          Read this entire section before following its instructions.
          Parts of the procedure differ depending on your environment.
</p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          If installed, the <code class="literal">audit_log</code> plugin involves
          some minimal overhead even when disabled. To avoid this
          overhead, do not install MySQL Enterprise Audit unless you plan to use it.
</p>
</div>
<p>
        To be usable by the server, the plugin library file must be
        located in the MySQL plugin directory (the directory named by
        the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
        variable). If necessary, configure the plugin directory location
        by setting the value of
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
      </p><p>
        To install MySQL Enterprise Audit, look in the <code class="filename">share</code>
        directory of your MySQL installation and choose the script that
        is appropriate for your platform. The available scripts differ
        in the suffix used to refer to the plugin library file:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="filename">audit_log_filter_win_install.sql</code>:
            Choose this script for Windows systems that use
            <code class="filename">.dll</code> as the file name suffix.
          </p></li><li class="listitem"><p>
            <code class="filename">audit_log_filter_linux_install.sql</code>:
            Choose this script for Linux and similar systems that use
            <code class="filename">.so</code> as the file name suffix.
</p></li></ul>
</div>
<p>
        Run the script as follows. The example here uses the Linux
        installation script. Make the appropriate substitution for your
        system.
      </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u root -p &lt; audit_log_filter_linux_install.sql</code></strong>
Enter password: <em class="replaceable"><code>(enter root password here)</code></em>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          Some MySQL versions have introduced changes to the structure
          of the MySQL Enterprise Audit tables. To ensure that your tables are up to
          date for upgrades from earlier versions of MySQL
          8.0, perform the MySQL upgrade procedure, making
          sure to use the option that forces an update (see
          <a class="xref" href="installing.html#upgrading" title="2.11 Upgrading MySQL">Section 2.11, “Upgrading MySQL”</a>). If you prefer to run the update
          statements only for the MySQL Enterprise Audit tables, see the following
          discussion.
        </p><p>
          As of MySQL 8.0.12, for new MySQL installations, the
          <code class="literal">USER</code> and <code class="literal">HOST</code> columns in
          the <code class="literal">audit_log_user</code> table used by MySQL Enterprise Audit
          have definitions that better correspond to the definitions of
          the <code class="literal">User</code> and <code class="literal">Host</code>
          columns in the <code class="literal">mysql.user</code> system table. For
          upgrades to an installation for which MySQL Enterprise Audit is already
          installed, it is recommended that you alter the table
          definitions as follows:
        </p><pre data-lang="sql" class="programlisting">
ALTER TABLE mysql.audit_log_user
  DROP FOREIGN KEY audit_log_user_ibfk_1;
ALTER TABLE mysql.audit_log_filter
  CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_as_ci;
ALTER TABLE mysql.audit_log_user
  CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_as_ci;
ALTER TABLE mysql.audit_log_user
  MODIFY COLUMN USER VARCHAR(32);
ALTER TABLE mysql.audit_log_user
  ADD FOREIGN KEY (FILTERNAME) REFERENCES mysql.audit_log_filter(NAME);
</pre>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          To use MySQL Enterprise Audit in the context of master/slave replication,
          Group Replication, or InnoDB cluster, you must prepare the
          slave or secondary nodes prior to running the installation
          script on the master or primary node. This is necessary
          because the <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>
          statement in the script is not replicated.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              On each slave or secondary node, extract the
              <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statement
              from the installation script and execute it manually.
            </p></li><li class="listitem"><p>
              On the master or primary node, run the installation script
              as described previously.
</p></li></ol>
</div>

</div>
<p>
        To verify plugin installation, examine the
        <a class="link" href="information-schema.html#plugins-table" title="25.18 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table or
        use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.6.25 SHOW PLUGINS Syntax"><code class="literal">SHOW PLUGINS</code></a> statement
        (see <a class="xref" href="server-administration.html#obtaining-plugin-information" title="5.6.2 Obtaining Server Plugin Information">Section 5.6.2, “Obtaining Server Plugin Information”</a>). For
        example:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT PLUGIN_NAME, PLUGIN_STATUS</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.PLUGINS</code></strong>
       <strong class="userinput"><code>WHERE PLUGIN_NAME LIKE 'audit%';</code></strong>
+-------------+---------------+
| PLUGIN_NAME | PLUGIN_STATUS |
+-------------+---------------+
| audit_log   | ACTIVE        |
+-------------+---------------+
</pre><p>
        If the plugin fails to initialize, check the server error log
        for diagnostic messages.
      </p><p>
        After MySQL Enterprise Audit is installed, you can use the
        <code class="option">--audit-log</code> option for subsequent server
        startups to control <code class="literal">audit_log</code> plugin
        activation. For example, to prevent the plugin from being
        removed at runtime, use this option:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
audit-log=FORCE_PLUS_PERMANENT
</pre><p>
        If it is desired to prevent the server from running without the
        audit plugin, use <a class="link" href="security.html#option_mysqld_audit-log"><code class="option">--audit-log</code></a>
        with a value of <code class="literal">FORCE</code> or
        <code class="literal">FORCE_PLUS_PERMANENT</code> to force server startup
        to fail if the plugin does not initialize successfully.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
          By default, rule-based audit log filtering logs no auditable
          events for any users. This differs from legacy audit log
          behavior, which logs all auditable events for all users (see
          <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.7 Legacy Mode Audit Log Filtering">Section 6.4.5.7, “Legacy Mode Audit Log Filtering”</a>). Should you wish
          to produce log-everything behavior with rule-based filtering,
          create a simple filter to enable logging and assign it to the
          default account:
        </p><pre data-lang="sql" class="programlisting">
SELECT audit_log_filter_set_filter('log_all', '{ "filter": { "log": true } }');
SELECT audit_log_filter_set_user('%', 'log_all');
</pre><p>
          The filter assigned to <code class="literal">%</code> is used for
          connections from any account that has no explicitly assigned
          filter (which initially is true for all accounts).
</p>
</div>
<p>
        Once installed as just described, MySQL Enterprise Audit remains installed
        until uninstalled. To remove it, execute the following
        statements:
      </p><pre data-lang="sql" class="programlisting">
DROP TABLE IF EXISTS mysql.audit_log_user;
DROP TABLE IF EXISTS mysql.audit_log_filter;
UNINSTALL PLUGIN audit_log;
DROP FUNCTION audit_log_filter_set_filter;
DROP FUNCTION audit_log_filter_remove_filter;
DROP FUNCTION audit_log_filter_set_user;
DROP FUNCTION audit_log_filter_remove_user;
DROP FUNCTION audit_log_filter_flush;
DROP FUNCTION audit_log_encryption_password_get;
DROP FUNCTION audit_log_encryption_password_set;
DROP FUNCTION audit_log_read;
DROP FUNCTION audit_log_read_bookmark;
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-security"></a>6.4.5.3 MySQL Enterprise Audit Security Considerations</h4>

</div>

</div>

</div>
<p>
        By default, contents of audit log files produced by the audit
        log plugin are not encrypted and may contain sensitive
        information, such as the text of SQL statements. For security
        reasons, audit log files should be written to a directory
        accessible only to the MySQL server and to users with a
        legitimate reason to view the log. The default file name is
        <code class="filename">audit.log</code> in the data directory. This can
        be changed by setting the
        <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> system variable
        at server startup. Other audit log files may exist due to log
        rotation.
      </p><p>
        For additional security, enable audit log file encryption. See
        <a class="xref" href="security.html#audit-log-file-encryption" title="Audit Log File Encryption">Audit Log File Encryption</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-file-formats"></a>6.4.5.4 Audit Log File Formats</h4>

</div>

</div>

</div>
<p>
        The MySQL server calls the audit log plugin to write an audit
        record to its log file whenever an auditable event occurs.
        Typically the first audit record written after plugin startup
        contains the server description and startup options. Elements
        following that one represent events such as client connect and
        disconnect events, executed SQL statements, and so forth. Only
        top-level statements are logged, not statements within stored
        programs such as triggers or stored procedures. Contents of
        files referenced by statements such as <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD
        DATA</code></a> are not logged.
      </p><p>
        To select the log format that the audit log plugin uses to write
        its log file, set the
        <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a> system
        variable at server startup. These formats are available:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            New-style XML format
            (<a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=NEW</code></a>): An
            XML format that has better compatibility with Oracle Audit
            Vault than old-style XML format. MySQL 8.0 uses
            new-style XML format by default.
          </p></li><li class="listitem"><p>
            Old-style XML format
            (<a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=OLD</code></a>): The
            original audit log format used by default in older MySQL
            series.
          </p></li><li class="listitem"><p>
            JSON format
            (<a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=JSON</code></a>)
</p></li></ul>
</div>
<p>
        By default, audit log file contents are written in new-style XML
        format, without compression or encryption.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          For information about issues to consider when changing the log
          format, see <a class="xref" href="security.html#audit-log-file-format" title="Audit Log File Format">Audit Log File Format</a>.
</p>
</div>
<p>
        The following sections describe the available audit logging
        formats:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-new-style-xml-format" title="New-Style XML Audit Log File Format">New-Style XML Audit Log File Format</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-old-style-xml-format" title="Old-Style XML Audit Log File Format">Old-Style XML Audit Log File Format</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-json-format" title="JSON Audit Log File Format">JSON Audit Log File Format</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="audit-log-file-new-style-xml-format"></a>New-Style XML Audit Log File Format</h5>

</div>

</div>

</div>
<p>
          Here is a sample log file in new-style XML format
          (<a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=NEW</code></a>),
          reformatted slightly for readability:
        </p><pre data-lang="xml" class="programlisting">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;AUDIT&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2017-10-16T14:06:33 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;1_2017-10-16T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Audit&lt;/NAME&gt;
  &lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
  &lt;VERSION&gt;1&lt;/VERSION&gt;
  &lt;STARTUP_OPTIONS&gt;/usr/local/mysql/bin/mysqld
    --socket=/usr/local/mysql/mysql.sock
    --port=3306&lt;/STARTUP_OPTIONS&gt;
  &lt;OS_VERSION&gt;i686-Linux&lt;/OS_VERSION&gt;
  &lt;MYSQL_VERSION&gt;5.7.21-log&lt;/MYSQL_VERSION&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2017-10-16T14:09:38 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;2_2017-10-16T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Connect&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;5&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root&lt;/USER&gt;
  &lt;OS_LOGIN/&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
  &lt;CONNECTION_TYPE&gt;SSL/TLS&lt;/CONNECTION_TYPE&gt;
  &lt;PRIV_USER&gt;root&lt;/PRIV_USER&gt;
  &lt;PROXY_USER/&gt;
  &lt;DB&gt;test&lt;/DB&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2017-10-16T14:09:38 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;6_2017-10-16T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Query&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;5&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
  &lt;OS_LOGIN/&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;drop_table&lt;/COMMAND_CLASS&gt;
  &lt;SQLTEXT&gt;DROP TABLE IF EXISTS t&lt;/SQLTEXT&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2017-10-16T14:09:39 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;8_2017-10-16T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Quit&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;5&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root&lt;/USER&gt;
  &lt;OS_LOGIN/&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
  &lt;CONNECTION_TYPE&gt;SSL/TLS&lt;/CONNECTION_TYPE&gt;
 &lt;/AUDIT_RECORD&gt;

...

 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2017-10-16T14:09:43 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;11_2017-10-16T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;Quit&lt;/NAME&gt;
  &lt;CONNECTION_ID&gt;6&lt;/CONNECTION_ID&gt;
  &lt;STATUS&gt;0&lt;/STATUS&gt;
  &lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
  &lt;USER&gt;root&lt;/USER&gt;
  &lt;OS_LOGIN/&gt;
  &lt;HOST&gt;localhost&lt;/HOST&gt;
  &lt;IP&gt;127.0.0.1&lt;/IP&gt;
  &lt;COMMAND_CLASS&gt;connect&lt;/COMMAND_CLASS&gt;
  &lt;CONNECTION_TYPE&gt;SSL/TLS&lt;/CONNECTION_TYPE&gt;
 &lt;/AUDIT_RECORD&gt;
 &lt;AUDIT_RECORD&gt;
  &lt;TIMESTAMP&gt;2017-10-16T14:09:45 UTC&lt;/TIMESTAMP&gt;
  &lt;RECORD_ID&gt;12_2017-10-16T14:06:33&lt;/RECORD_ID&gt;
  &lt;NAME&gt;NoAudit&lt;/NAME&gt;
  &lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
 &lt;/AUDIT_RECORD&gt;
&lt;/AUDIT&gt;
</pre><p>
          The audit log file is written as XML, using UTF-8 (up to 4
          bytes per character). The root element is
          <code class="literal">&lt;AUDIT&gt;</code>. The root element contains
          <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements, each of
          which provides information about an audited event. When the
          audit log plugin begins writing a new log file, it writes the
          XML declaration and opening <code class="literal">&lt;AUDIT&gt;</code>
          root element tag. When the plugin closes a log file, it writes
          the closing <code class="literal">&lt;/AUDIT&gt;</code> root element
          tag. The closing tag is not present while the file is open.
        </p><p>
          Elements within <code class="literal">&lt;AUDIT_RECORD&gt;</code>
          elements have these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Some elements appear in every
              <code class="literal">&lt;AUDIT_RECORD&gt;</code> element. Others
              are optional and may appear depending on the audit record
              type.
            </p></li><li class="listitem"><p>
              Order of elements within an
              <code class="literal">&lt;AUDIT_RECORD&gt;</code> element is not
              guaranteed.
            </p></li><li class="listitem"><p>
              Element values are not fixed length. Long values may be
              truncated as indicated in the element descriptions given
              later.
            </p></li><li class="listitem"><p>
              The <code class="literal">&lt;</code>, <code class="literal">&gt;</code>,
              <code class="literal">"</code>, and <code class="literal">&amp;</code>
              characters are encoded as <code class="literal">&amp;lt;</code>,
              <code class="literal">&amp;gt;</code>,
              <code class="literal">&amp;quot;</code>, and
              <code class="literal">&amp;amp;</code>, respectively. NUL bytes
              (U+00) are encoded as the <code class="literal">?</code> character.
            </p></li><li class="listitem"><p>
              Characters not valid as XML characters are encoded using
              numeric character references. Valid XML characters are:
            </p><pre data-lang="none" class="programlisting">
#x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]
</pre></li></ul>
</div>
<p>
          The following elements are mandatory in every
          <code class="literal">&lt;AUDIT_RECORD&gt;</code> element:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">&lt;NAME&gt;</code>
            </p><p>
              A string representing the type of instruction that
              generated the audit event, such as a command that the
              server received from a client.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;NAME&gt;Query&lt;/NAME&gt;
</pre><p>
              Some common <code class="literal">&lt;NAME&gt;</code> values:
            </p><pre data-lang="none" class="programlisting">
Audit    When auditing starts, which may be server startup time
Connect  When a client connects, also known as logging in
Query    An SQL statement (executed directly)
Prepare  Preparation of an SQL statement; usually followed by Execute
Execute  Execution of an SQL statement; usually follows Prepare
Shutdown Server shutdown
Quit     When a client disconnects
NoAudit  Auditing has been turned off
</pre><p>
              The possible values are <code class="literal">Audit</code>,
              <code class="literal">Binlog Dump</code>, <code class="literal">Change
              user</code>, <code class="literal">Close stmt</code>,
              <code class="literal">Connect Out</code>,
              <code class="literal">Connect</code>, <code class="literal">Create DB</code>,
              <code class="literal">Daemon</code>, <code class="literal">Debug</code>,
              <code class="literal">Delayed insert</code>, <code class="literal">Drop
              DB</code>, <code class="literal">Execute</code>,
              <code class="literal">Fetch</code>, <code class="literal">Field List</code>,
              <code class="literal">Init DB</code>, <code class="literal">Kill</code>,
              <code class="literal">Long Data</code>, <code class="literal">NoAudit</code>,
              <code class="literal">Ping</code>, <code class="literal">Prepare</code>,
              <code class="literal">Processlist</code>, <code class="literal">Query</code>,
              <code class="literal">Quit</code>, <code class="literal">Refresh</code>,
              <code class="literal">Register Slave</code>, <code class="literal">Reset
              stmt</code>, <code class="literal">Set option</code>,
              <code class="literal">Shutdown</code>, <code class="literal">Sleep</code>,
              <code class="literal">Statistics</code>, <code class="literal">Table
              Dump</code>, <code class="literal">Time</code>.
            </p><p>
              With the exception of <code class="literal">Audit</code> and
              <code class="literal">NoAudit</code>, these values correspond to the
              <code class="literal">COM_<em class="replaceable"><code>xxx</code></em></code>
              command values listed in the
              <code class="filename">my_command.h</code> header file. For
              example, <code class="literal">Create DB</code> and <code class="literal">Change
              user</code> correspond to
              <code class="literal">COM_CREATE_DB</code> and
              <code class="literal">COM_CHANGE_USER</code>, respectively.
            </p></li><li class="listitem"><p>
              <code class="literal">&lt;RECORD_ID&gt;</code>
            </p><p>
              A unique identifier for the audit record. The value is
              composed from a sequence number and timestamp, in the
              format
              <code class="literal"><em class="replaceable"><code>SEQ_TIMESTAMP</code></em></code>.
              When the audit log plugin opens the audit log file, it
              initializes the sequence number to the size of the audit
              log file, then increments the sequence by 1 for each
              record logged. The timestamp is a UTC value in
              <code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em></code>
              format indicating the date and time when the audit log
              plugin opened the file.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;RECORD_ID&gt;12_2017-10-16T14:06:33&lt;/RECORD_ID&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;TIMESTAMP&gt;</code>
            </p><p>
              A string representing a UTC value in
              <code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em>
              UTC</code> format indicating the date and time when the
              audit event was generated. For example, the event
              corresponding to execution of an SQL statement received
              from a client has a <code class="literal">&lt;TIMESTAMP&gt;</code>
              value occurring after the statement finishes, not when it
              was received.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;TIMESTAMP&gt;2017-10-16T14:09:45 UTC&lt;/TIMESTAMP&gt;
</pre></li></ul>
</div>
<p>
          The following elements are optional in
          <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements. Many of them
          occur only with specific <code class="literal">&lt;NAME&gt;</code>
          element values.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">&lt;COMMAND_CLASS&gt;</code>
            </p><p>
              A string that indicates the type of action performed.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;COMMAND_CLASS&gt;drop_table&lt;/COMMAND_CLASS&gt;
</pre><p>
              The values correspond to the
              <code class="literal">statement/sql/<em class="replaceable"><code>xxx</code></em></code>
              command counters. For example,
              <em class="replaceable"><code>xxx</code></em> is
              <code class="literal">drop_table</code> and
              <code class="literal">select</code> for <a class="link" href="sql-syntax.html#drop-table" title="13.1.32 DROP TABLE Syntax"><code class="literal">DROP
              TABLE</code></a> and <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a>
              statements, respectively. The following statement displays
              the possible names:
            </p><pre data-lang="sql" class="programlisting">
SELECT REPLACE(EVENT_NAME, 'statement/sql/', '') AS name
FROM performance_schema.events_statements_summary_global_by_event_name
WHERE EVENT_NAME LIKE 'statement/sql/%'
ORDER BY name;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;CONNECTION_ID&gt;</code>
            </p><p>
              An unsigned integer representing the client connection
              identifier. This is the same as the value returned by the
              <a class="link" href="functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a> function
              within the session.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;CONNECTION_ID&gt;127&lt;/CONNECTION_ID&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;CONNECTION_TYPE&gt;</code>
            </p><p>
              The security state of the connection to the server.
              Permitted values are <code class="literal">TCP/IP</code> (TCP/IP
              connection established without encryption),
              <code class="literal">SSL/TLS</code> (TCP/IP connection established
              with encryption), <code class="literal">Socket</code> (Unix socket
              file connection), <code class="literal">Named Pipe</code> (Windows
              named pipe connection), and <code class="literal">Shared
              Memory</code> (Windows shared memory connection).
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;CONNECTION_TYPE&gt;SSL/TLS&lt;/CONNECTION_TYPE&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;DB&gt;</code>
            </p><p>
              A string representing the default database name.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;DB&gt;test&lt;/DB&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;HOST&gt;</code>
            </p><p>
              A string representing the client host name.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;HOST&gt;localhost&lt;/HOST&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;IP&gt;</code>
            </p><p>
              A string representing the client IP address.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;IP&gt;127.0.0.1&lt;/IP&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;MYSQL_VERSION&gt;</code>
            </p><p>
              A string representing the MySQL server version. This is
              the same as the value of the
              <a class="link" href="functions.html#function_version"><code class="literal">VERSION()</code></a> function or
              <a class="link" href="server-administration.html#sysvar_version"><code class="literal">version</code></a> system variable.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;MYSQL_VERSION&gt;5.7.21-log&lt;/MYSQL_VERSION&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;OS_LOGIN&gt;</code>
            </p><p>
              A string representing the external user name used during
              the authentication process, as set by the plugin used to
              authenticate the client. With native (built-in) MySQL
              authentication, or if the plugin does not set the value,
              this element is empty. The value is the same as that of
              the <a class="link" href="server-administration.html#sysvar_external_user"><code class="literal">external_user</code></a> system
              variable (see <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>).
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;OS_LOGIN&gt;jeffrey&lt;/OS_LOGIN&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;OS_VERSION&gt;</code>
            </p><p>
              A string representing the operating system on which the
              server was built or is running.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;OS_VERSION&gt;x86_64-Linux&lt;/OS_VERSION&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;PRIV_USER&gt;</code>
            </p><p>
              A string representing the user that the server
              authenticated the client as. This is the user name that
              the server uses for privilege checking, and may differ
              from the <code class="literal">&lt;USER&gt;</code> value.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;PRIV_USER&gt;jeffrey&lt;/PRIV_USER&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;PROXY_USER&gt;</code>
            </p><p>
              A string representing the proxy user (see
              <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>). The value is empty if user
              proxying is not in effect.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;PROXY_USER&gt;developer&lt;/PROXY_USER&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;SERVER_ID&gt;</code>
            </p><p>
              An unsigned integer representing the server ID. This is
              the same as the value of the
              <a class="link" href="server-administration.html#sysvar_server_id"><code class="literal">server_id</code></a> system
              variable.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;SERVER_ID&gt;1&lt;/SERVER_ID&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;SQLTEXT&gt;</code>
            </p><p>
              A string representing the text of an SQL statement. The
              value can be empty. Long values may be truncated. The
              string, like the audit log file itself, is written using
              UTF-8 (up to 4 bytes per character), so the value may be
              the result of conversion. For example, the original
              statement might have been received from the client as an
              SJIS string.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;SQLTEXT&gt;DELETE FROM t1&lt;/SQLTEXT&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;STARTUP_OPTIONS&gt;</code>
            </p><p>
              A string representing the options that were given on the
              command line or in option files when the MySQL server was
              started. The first option is the path to the server
              executable.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;STARTUP_OPTIONS&gt;/usr/local/mysql/bin/mysqld
  --port=3306 --log_output=FILE&lt;/STARTUP_OPTIONS&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;STATUS&gt;</code>
            </p><p>
              An unsigned integer representing the command status: 0 for
              success, nonzero if an error occurred. This is the same as
              the value of the
              <a class="link" href="connectors-apis.html#mysql-errno" title="28.7.7.14 mysql_errno()"><code class="literal">mysql_errno()</code></a> C API
              function. See the description for
              <code class="literal">&lt;STATUS_CODE&gt;</code> for information
              about how it differs from
              <code class="literal">&lt;STATUS&gt;</code>.
            </p><p>
              The audit log does not contain the SQLSTATE value or error
              message. To see the associations between error codes,
              SQLSTATE values, and messages, see
              <a class="xref" href="error-handling.html#server-error-reference" title="B.3.1 Server Error Message Reference">Section B.3.1, “Server Error Message Reference”</a>.
            </p><p>
              Warnings are not logged.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;STATUS&gt;1051&lt;/STATUS&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;STATUS_CODE&gt;</code>
            </p><p>
              An unsigned integer representing the command status: 0 for
              success, 1 if an error occurred.
            </p><p>
              The <code class="literal">STATUS_CODE</code> value differs from the
              <code class="literal">STATUS</code> value:
              <code class="literal">STATUS_CODE</code> is 0 for success and 1 for
              error, which is compatible with the EZ_collector consumer
              for Audit Vault. <code class="literal">STATUS</code> is the value of
              the <a class="link" href="connectors-apis.html#mysql-errno" title="28.7.7.14 mysql_errno()"><code class="literal">mysql_errno()</code></a> C API
              function. This is 0 for success and nonzero for error, and
              thus is not necessarily 1 for error.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;STATUS_CODE&gt;0&lt;/STATUS_CODE&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;USER&gt;</code>
            </p><p>
              A string representing the user name sent by the client.
              This may differ from the
              <code class="literal">&lt;PRIV_USER&gt;</code> value.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;USER&gt;root[root] @ localhost [127.0.0.1]&lt;/USER&gt;
</pre></li><li class="listitem"><p>
              <code class="literal">&lt;VERSION&gt;</code>
            </p><p>
              An unsigned integer representing the version of the audit
              log file format.
            </p><p>
              Example:
            </p><pre data-lang="xml" class="programlisting">
&lt;VERSION&gt;1&lt;/VERSION&gt;
</pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-old-style-xml-format"></a>Old-Style XML Audit Log File Format</h5>

</div>

</div>

</div>
<p>
          Here is a sample log file in old-style XML format
          (<a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=OLD</code></a>),
          reformatted slightly for readability:
        </p><pre data-lang="xml" class="programlisting">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;AUDIT&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2017-10-16T14:25:00 UTC"
    RECORD_ID="1_2017-10-16T14:25:00"
    NAME="Audit"
    SERVER_ID="1"
    VERSION="1"
    STARTUP_OPTIONS="--port=3306"
    OS_VERSION="i686-Linux"
    MYSQL_VERSION="5.7.21-log"/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2017-10-16T14:25:24 UTC"
    RECORD_ID="2_2017-10-16T14:25:00"
    NAME="Connect"
    CONNECTION_ID="4"
    STATUS="0"
    STATUS_CODE="0"
    USER="root"
    OS_LOGIN=""
    HOST="localhost"
    IP="127.0.0.1"
    COMMAND_CLASS="connect"
    CONNECTION_TYPE="SSL/TLS"
    PRIV_USER="root"
    PROXY_USER=""
    DB="test"/&gt;

...

  &lt;AUDIT_RECORD
    TIMESTAMP="2017-10-16T14:25:24 UTC"
    RECORD_ID="6_2017-10-16T14:25:00"
    NAME="Query"
    CONNECTION_ID="4"
    STATUS="0"
    STATUS_CODE="0"
    USER="root[root] @ localhost [127.0.0.1]"
    OS_LOGIN=""
    HOST="localhost"
    IP="127.0.0.1"
    COMMAND_CLASS="drop_table"
    SQLTEXT="DROP TABLE IF EXISTS t"/&gt;

...

  &lt;AUDIT_RECORD
    TIMESTAMP="2017-10-16T14:25:24 UTC"
    RECORD_ID="8_2017-10-16T14:25:00"
    NAME="Quit"
    CONNECTION_ID="4"
    STATUS="0"
    STATUS_CODE="0"
    USER="root"
    OS_LOGIN=""
    HOST="localhost"
    IP="127.0.0.1"
    COMMAND_CLASS="connect"
    CONNECTION_TYPE="SSL/TLS"/&gt;
  &lt;AUDIT_RECORD
    TIMESTAMP="2017-10-16T14:25:32 UTC"
    RECORD_ID="12_2017-10-16T14:25:00"
    NAME="NoAudit"
    SERVER_ID="1"/&gt;
&lt;/AUDIT&gt;
</pre><p>
          The audit log file is written as XML, using UTF-8 (up to 4
          bytes per character). The root element is
          <code class="literal">&lt;AUDIT&gt;</code>. The root element contains
          <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements, each of
          which provides information about an audited event. When the
          audit log plugin begins writing a new log file, it writes the
          XML declaration and opening <code class="literal">&lt;AUDIT&gt;</code>
          root element tag. When the plugin closes a log file, it writes
          the closing <code class="literal">&lt;/AUDIT&gt;</code> root element
          tag. The closing tag is not present while the file is open.
        </p><p>
          Attributes of <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements
          have these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Some attributes appear in every
              <code class="literal">&lt;AUDIT_RECORD&gt;</code> element. Others
              are optional and may appear depending on the audit record
              type.
            </p></li><li class="listitem"><p>
              Order of attributes within an
              <code class="literal">&lt;AUDIT_RECORD&gt;</code> element is not
              guaranteed.
            </p></li><li class="listitem"><p>
              Attribute values are not fixed length. Long values may be
              truncated as indicated in the attribute descriptions given
              later.
            </p></li><li class="listitem"><p>
              The <code class="literal">&lt;</code>, <code class="literal">&gt;</code>,
              <code class="literal">"</code>, and <code class="literal">&amp;</code>
              characters are encoded as <code class="literal">&amp;lt;</code>,
              <code class="literal">&amp;gt;</code>,
              <code class="literal">&amp;quot;</code>, and
              <code class="literal">&amp;amp;</code>, respectively. NUL bytes
              (U+00) are encoded as the <code class="literal">?</code> character.
            </p></li><li class="listitem"><p>
              Characters not valid as XML characters are encoded using
              numeric character references. Valid XML characters are:
            </p><pre data-lang="none" class="programlisting">
#x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]
</pre></li></ul>
</div>
<p>
          The following attributes are mandatory in every
          <code class="literal">&lt;AUDIT_RECORD&gt;</code> element:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">NAME</code>
            </p><p>
              A string representing the type of instruction that
              generated the audit event, such as a command that the
              server received from a client.
            </p><p>
              Example: <code class="literal">NAME="Query"</code>
            </p><p>
              Some common <code class="literal">NAME</code> values:
            </p><pre data-lang="none" class="programlisting">
Audit    When auditing starts, which may be server startup time
Connect  When a client connects, also known as logging in
Query    An SQL statement (executed directly)
Prepare  Preparation of an SQL statement; usually followed by Execute
Execute  Execution of an SQL statement; usually follows Prepare
Shutdown Server shutdown
Quit     When a client disconnects
NoAudit  Auditing has been turned off
</pre><p>
              The possible values are <code class="literal">Audit</code>,
              <code class="literal">Binlog Dump</code>, <code class="literal">Change
              user</code>, <code class="literal">Close stmt</code>,
              <code class="literal">Connect Out</code>,
              <code class="literal">Connect</code>, <code class="literal">Create DB</code>,
              <code class="literal">Daemon</code>, <code class="literal">Debug</code>,
              <code class="literal">Delayed insert</code>, <code class="literal">Drop
              DB</code>, <code class="literal">Execute</code>,
              <code class="literal">Fetch</code>, <code class="literal">Field List</code>,
              <code class="literal">Init DB</code>, <code class="literal">Kill</code>,
              <code class="literal">Long Data</code>, <code class="literal">NoAudit</code>,
              <code class="literal">Ping</code>, <code class="literal">Prepare</code>,
              <code class="literal">Processlist</code>, <code class="literal">Query</code>,
              <code class="literal">Quit</code>, <code class="literal">Refresh</code>,
              <code class="literal">Register Slave</code>, <code class="literal">Reset
              stmt</code>, <code class="literal">Set option</code>,
              <code class="literal">Shutdown</code>, <code class="literal">Sleep</code>,
              <code class="literal">Statistics</code>, <code class="literal">Table
              Dump</code>, <code class="literal">Time</code>.
            </p><p>
              With the exception of <code class="literal">"Audit"</code> and
              <code class="literal">"NoAudit"</code>, these values correspond to
              the <code class="literal">COM_<em class="replaceable"><code>xxx</code></em></code>
              command values listed in the
              <code class="filename">my_command.h</code> header file. For
              example, <code class="literal">"Create DB"</code> and
              <code class="literal">"Change user"</code> correspond to
              <code class="literal">COM_CREATE_DB</code> and
              <code class="literal">COM_CHANGE_USER</code>, respectively.
            </p></li><li class="listitem"><p>
              <code class="literal">RECORD_ID</code>
            </p><p>
              A unique identifier for the audit record. The value is
              composed from a sequence number and timestamp, in the
              format
              <code class="literal"><em class="replaceable"><code>SEQ_TIMESTAMP</code></em></code>.
              When the audit log plugin opens the audit log file, it
              initializes the sequence number to the size of the audit
              log file, then increments the sequence by 1 for each
              record logged. The timestamp is a UTC value in
              <code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em></code>
              format indicating the date and time when the audit log
              plugin opened the file.
            </p><p>
              Example:
              <code class="literal">RECORD_ID="12_2017-10-16T14:25:00"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">TIMESTAMP</code>
            </p><p>
              A string representing a UTC value in
              <code class="literal"><em class="replaceable"><code>YYYY-MM-DD</code></em>T<em class="replaceable"><code>hh:mm:ss</code></em>
              UTC</code> format indicating the date and time when the
              audit event was generated. For example, the event
              corresponding to execution of an SQL statement received
              from a client has a <code class="literal">TIMESTAMP</code> value
              occurring after the statement finishes, not when it was
              received.
            </p><p>
              Example: <code class="literal">TIMESTAMP="2017-10-16T14:25:32
              UTC"</code>
</p></li></ul>
</div>
<p>
          The following attributes are optional in
          <code class="literal">&lt;AUDIT_RECORD&gt;</code> elements. Many of them
          occur only for elements with specific values of the
          <code class="literal">NAME</code> attribute.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">COMMAND_CLASS</code>
            </p><p>
              A string that indicates the type of action performed.
            </p><p>
              Example: <code class="literal">COMMAND_CLASS="drop_table"</code>
            </p><p>
              The values correspond to the
              <code class="literal">statement/sql/<em class="replaceable"><code>xxx</code></em></code>
              command counters. For example,
              <em class="replaceable"><code>xxx</code></em> is
              <code class="literal">drop_table</code> and
              <code class="literal">select</code> for <a class="link" href="sql-syntax.html#drop-table" title="13.1.32 DROP TABLE Syntax"><code class="literal">DROP
              TABLE</code></a> and <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a>
              statements, respectively. The following statement displays
              the possible names:
            </p><pre data-lang="sql" class="programlisting">
SELECT REPLACE(EVENT_NAME, 'statement/sql/', '') AS name
FROM performance_schema.events_statements_summary_global_by_event_name
WHERE EVENT_NAME LIKE 'statement/sql/%'
ORDER BY name;
</pre></li><li class="listitem"><p>
              <code class="literal">CONNECTION_ID</code>
            </p><p>
              An unsigned integer representing the client connection
              identifier. This is the same as the value returned by the
              <a class="link" href="functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a> function
              within the session.
            </p><p>
              Example: <code class="literal">CONNECTION_ID="127"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">CONNECTION_TYPE</code>
            </p><p>
              The security state of the connection to the server.
              Permitted values are <code class="literal">TCP/IP</code> (TCP/IP
              connection established without encryption),
              <code class="literal">SSL/TLS</code> (TCP/IP connection established
              with encryption), <code class="literal">Socket</code> (Unix socket
              file connection), <code class="literal">Named Pipe</code> (Windows
              named pipe connection), and <code class="literal">Shared
              Memory</code> (Windows shared memory connection).
            </p><p>
              Example: <code class="literal">CONNECTION_TYPE="SSL/TLS"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">DB</code>
            </p><p>
              A string representing the default database name.
            </p><p>
              Example: <code class="literal">DB="test"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">HOST</code>
            </p><p>
              A string representing the client host name.
            </p><p>
              Example: <code class="literal">HOST="localhost"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">IP</code>
            </p><p>
              A string representing the client IP address.
            </p><p>
              Example: <code class="literal">IP="127.0.0.1"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">MYSQL_VERSION</code>
            </p><p>
              A string representing the MySQL server version. This is
              the same as the value of the
              <a class="link" href="functions.html#function_version"><code class="literal">VERSION()</code></a> function or
              <a class="link" href="server-administration.html#sysvar_version"><code class="literal">version</code></a> system variable.
            </p><p>
              Example: <code class="literal">MYSQL_VERSION="5.7.21-log"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">OS_LOGIN</code>
            </p><p>
              A string representing the external user name used during
              the authentication process, as set by the plugin used to
              authenticate the client. With native (built-in) MySQL
              authentication, or if the plugin does not set the value,
              this attribute is empty. The value is the same as that of
              the <a class="link" href="server-administration.html#sysvar_external_user"><code class="literal">external_user</code></a> system
              variable (see <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>).
            </p><p>
              Example: <code class="literal">OS_LOGIN="jeffrey"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">OS_VERSION</code>
            </p><p>
              A string representing the operating system on which the
              server was built or is running.
            </p><p>
              Example: <code class="literal">OS_VERSION="x86_64-Linux"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">PRIV_USER</code>
            </p><p>
              A string representing the user that the server
              authenticated the client as. This is the user name that
              the server uses for privilege checking, and it may differ
              from the <code class="literal">USER</code> value.
            </p><p>
              Example: <code class="literal">PRIV_USER="jeffrey"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">PROXY_USER</code>
            </p><p>
              A string representing the proxy user (see
              <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>). The value is empty if user
              proxying is not in effect.
            </p><p>
              Example: <code class="literal">PROXY_USER="developer"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">SERVER_ID</code>
            </p><p>
              An unsigned integer representing the server ID. This is
              the same as the value of the
              <a class="link" href="server-administration.html#sysvar_server_id"><code class="literal">server_id</code></a> system
              variable.
            </p><p>
              Example: <code class="literal">SERVER_ID="1"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">SQLTEXT</code>
            </p><p>
              A string representing the text of an SQL statement. The
              value can be empty. Long values may be truncated. The
              string, like the audit log file itself, is written using
              UTF-8 (up to 4 bytes per character), so the value may be
              the result of conversion. For example, the original
              statement might have been received from the client as an
              SJIS string.
            </p><p>
              Example: <code class="literal">SQLTEXT="DELETE FROM t1"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">STARTUP_OPTIONS</code>
            </p><p>
              A string representing the options that were given on the
              command line or in option files when the MySQL server was
              started.
            </p><p>
              Example: <code class="literal">STARTUP_OPTIONS="--port=3306
              --log_output=FILE"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">STATUS</code>
            </p><p>
              An unsigned integer representing the command status: 0 for
              success, nonzero if an error occurred. This is the same as
              the value of the
              <a class="link" href="connectors-apis.html#mysql-errno" title="28.7.7.14 mysql_errno()"><code class="literal">mysql_errno()</code></a> C API
              function. See the description for
              <code class="literal">STATUS_CODE</code> for information about how
              it differs from <code class="literal">STATUS</code>.
            </p><p>
              The audit log does not contain the SQLSTATE value or error
              message. To see the associations between error codes,
              SQLSTATE values, and messages, see
              <a class="xref" href="error-handling.html#server-error-reference" title="B.3.1 Server Error Message Reference">Section B.3.1, “Server Error Message Reference”</a>.
            </p><p>
              Warnings are not logged.
            </p><p>
              Example: <code class="literal">STATUS="1051"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">STATUS_CODE</code>
            </p><p>
              An unsigned integer representing the command status: 0 for
              success, 1 if an error occurred.
            </p><p>
              The <code class="literal">STATUS_CODE</code> value differs from the
              <code class="literal">STATUS</code> value:
              <code class="literal">STATUS_CODE</code> is 0 for success and 1 for
              error, which is compatible with the EZ_collector consumer
              for Audit Vault. <code class="literal">STATUS</code> is the value of
              the <a class="link" href="connectors-apis.html#mysql-errno" title="28.7.7.14 mysql_errno()"><code class="literal">mysql_errno()</code></a> C API
              function. This is 0 for success and nonzero for error, and
              thus is not necessarily 1 for error.
            </p><p>
              Example: <code class="literal">STATUS_CODE="0"</code>
            </p></li><li class="listitem"><p>
              <code class="literal">USER</code>
            </p><p>
              A string representing the user name sent by the client.
              This may differ from the <code class="literal">PRIV_USER</code>
              value.
            </p></li><li class="listitem"><p>
              <code class="literal">VERSION</code>
            </p><p>
              An unsigned integer representing the version of the audit
              log file format.
            </p><p>
              Example: <code class="literal">VERSION="1"</code>
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-json-format"></a>JSON Audit Log File Format</h5>

</div>

</div>

</div>
<p>
          For JSON-format audit logging
          (<a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=JSON</code></a>), the
          log file contents form a <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a>
          array with each array element representing an audited event as
          a <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> hash of key-value pairs.
          Examples of complete event records appear later in this
          section. The following is an excerpt of partial events:
        </p><pre data-lang="json" class="programlisting">
[
  {
    "timestamp": "2018-01-15 13:50:01",
    "id": 0,
    "class": "audit",
    "event": "startup",
    ...
  },
  {
    "timestamp": "2018-01-15 15:02:32",
    "id": 0,
    "class": "connection",
    "event": "connect",
    ...
  },
  ...
  {
    "timestamp": "2018-01-15 17:37:26",
    "id": 0,
    "class": "table_access",
    "event": "insert",
      ...
  }
  ...
]
</pre><p>
          The audit log file is written using UTF-8 (up to 4 bytes per
          character). When the audit log plugin begins writing a new log
          file, it writes the opening <code class="literal">[</code> array marker.
          When the plugin closes a log file, it writes the closing
          <code class="literal">]</code> array marker. The closing marker is not
          present while the file is open.
        </p><p>
          Items within audit records have these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Some items appear in every audit record. Others are
              optional and may appear depending on the audit record
              type.
            </p></li><li class="listitem"><p>
              Order of items within an audit record is not guaranteed.
            </p></li><li class="listitem"><p>
              Item values are not fixed length. Long values may be
              truncated as indicated in the item descriptions given
              later.
            </p></li><li class="listitem"><p>
              The <code class="literal">"</code> and <code class="literal">\</code>
              characters are encoded as <code class="literal">\"</code> and
              <code class="literal">\\</code>, respectively.
</p></li></ul>
</div>
<p>
          The following examples show the JSON object formats for
          different event types (as indicated by the
          <code class="literal">class</code> and <code class="literal">event</code> items),
          reformatted slightly for readability:
        </p><p>
          Auditing startup event:
        </p><pre data-lang="json" class="programlisting">
{ "timestamp": "2018-01-15 14:21:56",
  "id": 0,
  "class": "audit",
  "event": "startup",
  "connection_id": 0,
  "startup_data": { "server_id": 1,
                    "os_version": "i686-Linux",
                    "mysql_version": "5.7.21-log",
                    "args": ["/usr/local/mysql/bin/mysqld",
                             "--loose-audit-log-format=JSON",
                             "--log-error=log.err",
                             "--pid-file=mysqld.pid",
                             "--port=3306" ] } }
</pre><p>
          When the audit log plugin starts as a result of server startup
          (as opposed to being enabled at runtime),
          <code class="literal">connection_id</code> is set to 0, and
          <code class="literal">account</code> and <code class="literal">login</code> are
          not present.
        </p><p>
          Auditing shutdown event:
        </p><pre data-lang="json" class="programlisting">
{ "timestamp": "2018-01-15 14:28:20",
  "id": 3,
  "class": "audit",
  "event": "shutdown",
  "connection_id": 0,
  "shutdown_data": { "server_id": 1 } }
</pre><p>
          When the audit log plugin is uninstalled as a result of server
          shutdown (as opposed to being disabled at runtime),
          <code class="literal">connection_id</code> is set to 0, and
          <code class="literal">account</code> and <code class="literal">login</code> are
          not present.
        </p><p>
          Connect or change-user event:
        </p><pre data-lang="json" class="programlisting">
{ "timestamp": "2018-01-15 14:23:18",
  "id": 1,
  "class": "connection",
  "event": "connect",
  "connection_id": 5,
  "account": { "user": "root", "host": "localhost" },
  "login": { "user": "root", "os": "", "ip": "::1", "proxy": "" },
  "connection_data": { "connection_type": "ssl",
                       "status": 0,
                       "db": "test" } }
</pre><p>
          Disconnect event:
        </p><pre data-lang="json" class="programlisting">
{ "timestamp": "2018-01-15 14:24:45",
  "id": 3,
  "class": "connection",
  "event": "disconnect",
  "connection_id": 5,
  "account": { "user": "root", "host": "localhost" },
  "login": { "user": "root", "os": "", "ip": "::1", "proxy": "" },
  "connection_data": { "connection_type": "ssl" } }
</pre><p>
          Query event:
        </p><pre data-lang="json" class="programlisting">
{ "timestamp": "2018-01-15 14:23:35",
  "id": 2,
  "class": "general",
  "event": "status",
  "connection_id": 5,
  "account": { "user": "root", "host": "localhost" },
  "login": { "user": "root", "os": "", "ip": "::1", "proxy": "" },
  "general_data": { "command": "Query",
                    "sql_command": "show_variables",
                    "query": "SHOW VARIABLES",
                    "status": 0 } }
</pre><p>
          Table access event (read, delete, insert, update):
        </p><pre data-lang="json" class="programlisting">
{ "timestamp": "2018-01-15 14:23:41",
  "id": 0,
  "class": "table_access",
  "event": "insert",
  "connection_id": 5,
  "account": { "user": "root", "host": "localhost" },
  "login": { "user": "root", "os": "", "ip": "127.0.0.1", "proxy": "" },
  "table_access_data": { "db": "test",
                         "table": "t1",
                         "query": "INSERT INTO t1 (i) VALUES(1),(2),(3)",
                         "sql_command": "insert" } }
</pre><p>
          The items in the following list appear at the top level of
          JSON-format audit records: Each item value is either a scalar
          or a <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> hash. For items that
          have a hash value, the description lists only the item names
          within that hash. For more complete descriptions of
          second-level hash items, see later in this section.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">account</code>
            </p><p>
              The MySQL account associated with the event. The value is
              a hash containing these items equivalent to the value of
              the <a class="link" href="functions.html#function_current-user"><code class="literal">CURRENT_USER()</code></a> function
              within the section: <code class="literal">user</code>,
              <code class="literal">host</code>.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"account": { "user": "root", "host": "localhost" }
</pre></li><li class="listitem"><p>
              <code class="literal">class</code>
            </p><p>
              A string representing the event class. The class defines
              the type of event, when taken together with the
              <code class="literal">event</code> item that specifies the event
              subclass.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"class": "connection"
</pre><p>
              The following table shows the permitted combinations of
              <code class="literal">class</code> and <code class="literal">event</code>
              values.
</p>
<div class="table">
<a name="audit-log-class-event-combinations"></a><p class="title"><b>Table 6.27 Audit Log Class and Event Combinations</b></p>
<div class="table-contents">
<table summary="Permitted combinations of audit log class and event values."><col width="30%"><col width="40%"><thead><tr>
                  <th scope="col">Class Value</th>
                  <th scope="col">Permitted Event Values</th>
                </tr></thead><tbody><tr>
                  <th scope="row" align="left"><code class="literal">audit</code></th>
                  <td><code class="literal">startup</code>, <code class="literal">shutdown</code></td>
                </tr><tr>
                  <th scope="row" align="left"><code class="literal">connection</code></th>
                  <td><code class="literal">connect</code>, <code class="literal">change_user</code>,
                    <code class="literal">disconnect</code></td>
                </tr><tr>
                  <th scope="row" align="left"><code class="literal">general</code></th>
                  <td><code class="literal">status</code></td>
                </tr><tr>
                  <th scope="row" align="left"><code class="literal">table_access_data</code></th>
                  <td><code class="literal">read</code>, <code class="literal">delete</code>,
                    <code class="literal">insert</code>, <code class="literal">update</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"></li><li class="listitem"><p>
              <code class="literal">connection_data</code>
            </p><p>
              Information about a client connection. The value is a hash
              containing these items:
              <code class="literal">connection_type</code>,
              <code class="literal">status</code>, <code class="literal">db</code>. This
              item occurs only for audit records with a
              <code class="literal">class</code> value of
              <code class="literal">connection</code>.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"connection_data": { "connection_type": "ssl",
                     "status": 0,
                     "db": "test" }
</pre></li><li class="listitem"><p>
              <code class="literal">connection_id</code>
            </p><p>
              An unsigned integer representing the client connection
              identifier. This is the same as the value returned by the
              <a class="link" href="functions.html#function_connection-id"><code class="literal">CONNECTION_ID()</code></a> function
              within the session.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"connection_id": 5
</pre></li><li class="listitem"><p>
              <code class="literal">event</code>
            </p><p>
              A string representing the subclass of the event class. The
              subclass defines the type of event, when taken together
              with the <code class="literal">class</code> item that specifies the
              event class. For more information, see the
              <code class="literal">class</code> item description.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"event": "connect"
</pre></li><li class="listitem"><p>
              <code class="literal">general_data</code>
            </p><p>
              Information about an executed statement or command. The
              value is a hash containing these items:
              <code class="literal">command</code>,
              <code class="literal">sql_command</code>, <code class="literal">query</code>,
              <code class="literal">status</code>. This item occurs only for audit
              records with a <code class="literal">class</code> value of
              <code class="literal">general</code>.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"general_data": { "command": "Query",
                  "sql_command": "show_variables",
                  "query": "SHOW VARIABLES",
                  "status": 0 }
</pre></li><li class="listitem"><p>
              <code class="literal">id</code>
            </p><p>
              An unsigned integer representing an event ID.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"id": 2
</pre><p>
              For audit records that have the same
              <code class="literal">timestamp</code> value, their
              <code class="literal">id</code> values distinguish them and form a
              sequence. Within the audit log,
              <code class="literal">timestamp</code>/<code class="literal">id</code> pairs
              are unique. These pairs are bookmarks that identify event
              locations within the log.
            </p></li><li class="listitem"><p>
              <code class="literal">login</code>
            </p><p>
              Information indicating how a client connected to the
              server. The value is a hash containing these items:
              <code class="literal">user</code>, <code class="literal">os</code>,
              <code class="literal">ip</code>, <code class="literal">proxy</code>.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"login": { "user": "root", "os": "", "ip": "::1", "proxy": "" }
</pre></li><li class="listitem"><p>
              <code class="literal">shutdown_data</code>
            </p><p>
              Information pertaining to audit log plugin termination.
              The value is a hash containing these items:
              <code class="literal">server_id</code> This item occurs only for
              audit records with <code class="literal">class</code> and
              <code class="literal">event</code> values of
              <code class="literal">audit</code> and <code class="literal">shutdown</code>,
              respectively.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"shutdown_data": { "server_id": 1 }
</pre></li><li class="listitem"><p>
              <code class="literal">startup_data</code>
            </p><p>
              Information pertaining to audit log plugin initialization.
              The value is a hash containing these items:
              <code class="literal">server_id</code>,
              <code class="literal">os_version</code>,
              <code class="literal">mysql_version</code>, <code class="literal">args</code>.
              This item occurs only for audit records with
              <code class="literal">class</code> and <code class="literal">event</code>
              values of <code class="literal">audit</code> and
              <code class="literal">startup</code>, respectively.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"startup_data": { "server_id": 1,
                  "os_version": "i686-Linux",
                  "mysql_version": "5.7.21-log",
                  "args": ["/usr/local/mysql/bin/mysqld",
                           "--loose-audit-log-format=JSON",
                           "--log-error=log.err",
                           "--pid-file=mysqld.pid",
                           "--port=3306" ] }
</pre></li><li class="listitem"><p>
              <code class="literal">table_access_data</code>
            </p><p>
              Information about an access to a table. The value is a
              hash containing these items: <code class="literal">db</code>,
              <code class="literal">table</code>, <code class="literal">query</code>,
              <code class="literal">sql_command</code>, This item occurs only for
              audit records with a <code class="literal">class</code> value of
              <code class="literal">table_access</code>.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"table_access_data": { "db": "test",
                       "table": "t1",
                       "query": "INSERT INTO t1 (i) VALUES(1),(2),(3)",
                       "sql_command": "insert" }
</pre></li><li class="listitem"><p>
              <code class="literal">timestamp</code>
            </p><p>
              A string representing a UTC value in
              <em class="replaceable"><code>YYYY-MM-DD hh:mm:ss</code></em> format
              indicating the date and time when the audit event was
              generated. For example, the event corresponding to
              execution of an SQL statement received from a client has a
              <code class="literal">timestamp</code> value occurring after the
              statement finishes, not when it was received.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"timestamp": "2018-01-15 13:50:01"
</pre><p>
              For audit records that have the same
              <code class="literal">timestamp</code> value, their
              <code class="literal">id</code> values distinguish them and form a
              sequence. Within the audit log,
              <code class="literal">timestamp</code>/<code class="literal">id</code> pairs
              are unique. These pairs are bookmarks that identify event
              locations within the log.
</p></li></ul>
</div>
<p>
          These items appear within hash values associated with
          top-level items of JSON-format audit records:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">args</code>
            </p><p>
              An array of options that were given on the command line or
              in option files when the MySQL server was started. The
              first option is the path to the server executable.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"args": ["/usr/local/mysql/bin/mysqld",
         "--loose-audit-log-format=JSON",
         "--log-error=log.err",
         "--pid-file=mysqld.pid",
         "--port=3306" ]
</pre></li><li class="listitem"><p>
              <code class="literal">command</code>
            </p><p>
              A string representing the type of instruction that
              generated the audit event, such as a command that the
              server received from a client.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"command": "Query"
</pre></li><li class="listitem"><p>
              <code class="literal">connection_type</code>
            </p><p>
              The security state of the connection to the server.
              Permitted values are <code class="literal">tcp/ip</code> (TCP/IP
              connection established without encryption),
              <code class="literal">ssl</code> (TCP/IP connection established with
              encryption), <code class="literal">socket</code> (Unix socket file
              connection), <code class="literal">named_pipe</code> (Windows named
              pipe connection), and <code class="literal">shared_memory</code>
              (Windows shared memory connection).
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"connection_type": "tcp/tcp"
</pre></li><li class="listitem"><p>
              <code class="literal">db</code>
            </p><p>
              A string representing a database name. For
              <code class="literal">connection_data</code>, it is the default
              database. For <code class="literal">table_access_data</code>, it is
              the table database.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"db": "test"
</pre></li><li class="listitem"><p>
              <code class="literal">host</code>
            </p><p>
              A string representing the client host name.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"host": "localhost"
</pre></li><li class="listitem"><p>
              <code class="literal">ip</code>
            </p><p>
              A string representing the client IP address.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"ip": "::1"
</pre></li><li class="listitem"><p>
              <code class="literal">mysql_version</code>
            </p><p>
              A string representing the MySQL server version. This is
              the same as the value of the
              <a class="link" href="functions.html#function_version"><code class="literal">VERSION()</code></a> function or
              <a class="link" href="server-administration.html#sysvar_version"><code class="literal">version</code></a> system variable.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"mysql_version": "5.7.21-log"
</pre></li><li class="listitem"><p>
              <code class="literal">os</code>
            </p><p>
              A string representing the external user name used during
              the authentication process, as set by the plugin used to
              authenticate the client. With native (built-in) MySQL
              authentication, or if the plugin does not set the value,
              this attribute is empty. The value is the same as that of
              the <a class="link" href="server-administration.html#sysvar_external_user"><code class="literal">external_user</code></a> system
              variable. See <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"os": "jeffrey"
</pre></li><li class="listitem"><p>
              <code class="literal">os_version</code>
            </p><p>
              A string representing the operating system on which the
              server was built or is running.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"os_version": "i686-Linux"
</pre></li><li class="listitem"><p>
              <code class="literal">proxy</code>
            </p><p>
              A string representing the proxy user (see
              <a class="xref" href="security.html#proxy-users" title="6.2.18 Proxy Users">Section 6.2.18, “Proxy Users”</a>). The value is empty if user
              proxying is not in effect.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"proxy": "developer"
</pre></li><li class="listitem"><p>
              <code class="literal">query</code>
            </p><p>
              A string representing the text of an SQL statement. The
              value can be empty. Long values may be truncated. The
              string, like the audit log file itself, is written using
              UTF-8 (up to 4 bytes per character), so the value may be
              the result of conversion. For example, the original
              statement might have been received from the client as an
              SJIS string.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"query": "DELETE FROM t1"
</pre></li><li class="listitem"><p>
              <code class="literal">server_id</code>
            </p><p>
              An unsigned integer representing the server ID. This is
              the same as the value of the
              <a class="link" href="server-administration.html#sysvar_server_id"><code class="literal">server_id</code></a> system
              variable.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"server_id": 1
</pre></li><li class="listitem"><p>
              <code class="literal">sql_command</code>
            </p><p>
              A string that indicates the SQL statement type.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"sql_command": "insert"
</pre><p>
              The values correspond to the
              <code class="literal">statement/sql/<em class="replaceable"><code>xxx</code></em></code>
              command counters. For example,
              <em class="replaceable"><code>xxx</code></em> is
              <code class="literal">drop_table</code> and
              <code class="literal">select</code> for <a class="link" href="sql-syntax.html#drop-table" title="13.1.32 DROP TABLE Syntax"><code class="literal">DROP
              TABLE</code></a> and <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a>
              statements, respectively. The following statement displays
              the possible names:
            </p><pre data-lang="sql" class="programlisting">
SELECT REPLACE(EVENT_NAME, 'statement/sql/', '') AS name
FROM performance_schema.events_statements_summary_global_by_event_name
WHERE EVENT_NAME LIKE 'statement/sql/%'
ORDER BY name;
</pre></li><li class="listitem"><p>
              <code class="literal">status</code>
            </p><p>
              An unsigned integer representing the command status: 0 for
              success, nonzero if an error occurred. This is the same as
              the value of the
              <a class="link" href="connectors-apis.html#mysql-errno" title="28.7.7.14 mysql_errno()"><code class="literal">mysql_errno()</code></a> C API
              function.
            </p><p>
              The audit log does not contain the SQLSTATE value or error
              message. To see the associations between error codes,
              SQLSTATE values, and messages, see
              <a class="xref" href="error-handling.html#server-error-reference" title="B.3.1 Server Error Message Reference">Section B.3.1, “Server Error Message Reference”</a>.
            </p><p>
              Warnings are not logged.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"status": 1051
</pre></li><li class="listitem"><p>
              <code class="literal">table</code>
            </p><p>
              A string representing a table name.
            </p><p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"table": "t1"
</pre></li><li class="listitem"><p>
              <code class="literal">user</code>
            </p><p>
              A string representing a user name. The meaning differs
              depending on the item within which <code class="literal">user</code>
              occurs:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  Within <code class="literal">account</code> items,
                  <code class="literal">user</code> is a string representing the
                  user that the server authenticated the client as. This
                  is the user name that the server uses for privilege
                  checking.
                </p></li><li class="listitem"><p>
                  Within <code class="literal">login</code> items,
                  <code class="literal">user</code> is a string representing the
                  user name sent by the client.
</p></li></ul>
</div>
<p>
              Example:
            </p><pre data-lang="json" class="programlisting">
"user": "root"
</pre></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-logging-configuration"></a>6.4.5.5 Audit Log Logging Configuration</h4>

</div>

</div>

</div>
<p>
        This section describes how to configure audit logging
        characteristics, such as the file to which the audit log plugin
        writes events, the format of written events, and whether to
        enable log file compression and encryption.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-name" title="Audit Log File Name">Audit Log File Name</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-format" title="Audit Log File Format">Audit Log File Format</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-compression" title="Audit Log File Compression">Audit Log File Compression</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-encryption" title="Audit Log File Encryption">Audit Log File Encryption</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-uncompression-decryption" title="Audit Log File Manual Uncompression and Decryption">Audit Log File Manual Uncompression and Decryption</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-space-management" title="Audit Log File Space Management and Name Rotation">Audit Log File Space Management and Name Rotation</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-strategy" title="Audit Logging Write Strategy">Audit Logging Write Strategy</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-file-reading" title="Audit Log File Reading">Audit Log File Reading</a></p></li></ul>
</div>
<p>
        For additional information about the user-defined functions and
        system variables that affect audit logging, see
        <a class="xref" href="security.html#audit-log-routines" title="6.4.5.8.2 Audit Log Functions">Section 6.4.5.8.2, “Audit Log Functions”</a>, and
        <a class="xref" href="security.html#audit-log-options-variables" title="6.4.5.8.4 Audit Log Options and Variables">Section 6.4.5.8.4, “Audit Log Options and Variables”</a>.
      </p><p>
        The audit log plugin can also control which audited events are
        written to the audit log file, based on event content or the
        account from which events originate. See
        <a class="xref" href="security.html#audit-log-filtering" title="6.4.5.6 Audit Log Filtering">Section 6.4.5.6, “Audit Log Filtering”</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="audit-log-file-name"></a>Audit Log File Name</h5>
</div>
</div>
</div>
<p>
          To configure the audit log file name, set the
          <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> system
          variable at server startup. By default, the name is
          <code class="filename">audit.log</code> in the server data directory.
          For security reasons, write the audit log file to a directory
          accessible only to the MySQL server and to users with a
          legitimate reason to view the log.
        </p><p>
          The plugin interprets the
          <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> value as
          composed of a base name and an optional suffix. If compression
          or encryption are enabled, the effective file name (the name
          actually used to create the log file) differs from the
          configured file name because it has additional suffixes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If compression is enabled, the plugin adds a suffix of
              <code class="filename">.gz</code>.
            </p></li><li class="listitem"><p>
              If encryption is enabled, the plugin adds a suffix of
              <code class="filename">.enc</code>.
</p></li></ul>
</div>
<p>
          The effective audit log file name is the name resulting from
          the addition of applicable compression and encryption suffixes
          to the configured file name. For example, if the configured
          <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> value is
          <code class="filename">audit.log</code>, the effective file name is one
          of the values shown in the following table.
</p>
<div class="informaltable">
<table summary="audit_log effective file names for various combinations of the compression and encryption features."><col width="50%"><col width="50%"><thead><tr>
              <th scope="col">Enabled Features</th>
              <th scope="col">Effective File Name</th>
            </tr></thead><tbody><tr>
              <td scope="row">No compression or encryption</td>
              <td><code class="filename">audit.log</code></td>
            </tr><tr>
              <td scope="row">Compression</td>
              <td><code class="filename">audit.log.gz</code></td>
            </tr><tr>
              <td scope="row">Encryption</td>
              <td><code class="filename">audit.log.enc</code></td>
            </tr><tr>
              <td scope="row">Compression, encryption</td>
              <td><code class="filename">audit.log.gz.enc</code></td>
</tr></tbody></table>
</div>
<p>
          The audit log plugin performs certain actions during
          initialization and termination based on the effective audit
          log file name:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              During initialization, the plugin checks whether a file
              with the audit log file name already exists and renames it
              if so. (In this case, the plugin assumes that the previous
              server invocation exited unexpectedly with the audit log
              plugin running.) The plugin then writes to a new empty
              audit log file.
            </p></li><li class="listitem"><p>
              During termination, the plugin renames the audit log file.
            </p></li><li class="listitem"><p>
              File renaming (whether during plugin initialization or
              termination) occurs according to the usual rules for
              automatic log file rotation; see
              <a class="xref" href="security.html#audit-log-space-management-automatic-rotation" title="Automatic Audit Log File Rotation">Automatic Audit Log File Rotation</a>.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-format"></a>Audit Log File Format</h5>

</div>

</div>

</div>
<p>
          To configure the audit log file format, set the
          <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a> system
          variable at server startup. By default, the format is
          <code class="literal">NEW</code> (new-style XML format). For details
          about each format, see
          <a class="xref" href="security.html#audit-log-file-formats" title="6.4.5.4 Audit Log File Formats">Section 6.4.5.4, “Audit Log File Formats”</a>.
        </p><p>
          If you change
          <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a>, it is
          recommended that you also change
          <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a>. Otherwise,
          there will be two sets of log files with the same base name
          but different formats.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-compression"></a>Audit Log File Compression</h5>

</div>

</div>

</div>
<p>
          Audit log file compression can be enabled for any logging
          format.
        </p><p>
          To configure audit log file compression, set the
          <a class="link" href="security.html#sysvar_audit_log_compression"><code class="literal">audit_log_compression</code></a> system
          variable at server startup. Permitted values are
          <code class="literal">NONE</code> (no compression; the default) and
          <code class="literal">GZIP</code> (GNU Zip compression).
        </p><p>
          If both compression and encryption are enabled, compression
          occurs before encryption. To recover the original file
          manually, first decrypt it, then uncompress it. See
          <a class="xref" href="security.html#audit-log-file-uncompression-decryption" title="Audit Log File Manual Uncompression and Decryption">Audit Log File Manual Uncompression and Decryption</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-encryption"></a>Audit Log File Encryption</h5>

</div>

</div>

</div>
<p>
          Audit log file encryption can be enabled for any logging
          format. Encryption is based on a user-defined password (with
          the exception of the initial password that the audit log
          plugin generates). To use this feature, the MySQL keyring must
          be enabled because audit logging uses it for password storage.
          Any keyring plugin can be used; for instructions, see
          <a class="xref" href="security.html#keyring" title="6.4.4 The MySQL Keyring">Section 6.4.4, “The MySQL Keyring”</a>.
        </p><p>
          To configure audit log file encryption, set the
          <a class="link" href="security.html#sysvar_audit_log_encryption"><code class="literal">audit_log_encryption</code></a> system
          variable at server startup. Permitted values are
          <code class="literal">NONE</code> (no encryption; the default) and
          <code class="literal">AES</code> (AES-256-CBC cipher encryption).
        </p><p>
          To set or get an encryption password, use these user-defined
          functions (UDFs):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              To set the current encryption password, invoke
              <a class="link" href="security.html#udf_audit-log-encryption-password-set"><code class="literal">audit_log_encryption_password_set()</code></a>.
              This function stores the new password in the keyring. If
              encryption is enabled, it also performs a log file
              rotation operation that renames the current log file, and
              begins a new log file encrypted with the password. File
              renaming occurs according to the usual rules for automatic
              log file rotation; see
              <a class="xref" href="security.html#audit-log-space-management-automatic-rotation" title="Automatic Audit Log File Rotation">Automatic Audit Log File Rotation</a>.
            </p><p>
              Previously written audit log files are not re-encrypted
              with the new password. Keep a record of the previous
              password should you need to decrypt those files manually.
            </p></li><li class="listitem"><p>
              To get the current encryption password, invoke
              <a class="link" href="security.html#udf_audit-log-encryption-password-get"><code class="literal">audit_log_encryption_password_get()</code></a>,
              which retrieves the password from the keyring.
</p></li></ul>
</div>
<p>
          For additional information about audit log encryption
          functions, see <a class="xref" href="security.html#audit-log-routines" title="6.4.5.8.2 Audit Log Functions">Section 6.4.5.8.2, “Audit Log Functions”</a>.
        </p><p>
          When the audit log plugin initializes, if it finds that log
          file encryption is enabled, it checks whether the keyring
          contains an audit log encryption password. If not, the plugin
          automatically generates a random initial encryption password
          and stores it in the keyring. To discover this password,
          invoke
          <a class="link" href="security.html#udf_audit-log-encryption-password-get"><code class="literal">audit_log_encryption_password_get()</code></a>.
        </p><p>
          If both compression and encryption are enabled, compression
          occurs before encryption. To recover the original file
          manually, first decrypt it, then uncompress it. See
          <a class="xref" href="security.html#audit-log-file-uncompression-decryption" title="Audit Log File Manual Uncompression and Decryption">Audit Log File Manual Uncompression and Decryption</a>.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-uncompression-decryption"></a>Audit Log File Manual Uncompression and Decryption</h5>

</div>

</div>

</div>
<p>
          Audit log files can be uncompressed and decrypted using
          standard tools. This should be done only for log files that
          have been closed (archived) and are no longer in use, not for
          the log file that the audit log plugin is currently writing.
          You can recognize archived log files because they have been
          renamed by the audit log plugin to include a timestamp in the
          file name just after the base name.
        </p><p>
          For this discussion, assume that
          <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> is set to
          <code class="filename">audit.log</code>. In that case, an archived
          audit log file has one of the names shown in the following
          table.
</p>
<div class="informaltable">
<table summary="audit_log archived file names for various combinations of the compression and encryption features."><col width="50%"><col width="50%"><thead><tr>
              <th scope="col">Enabled Features</th>
              <th scope="col">Archived File Name</th>
            </tr></thead><tbody><tr>
              <td scope="row">No compression or encryption</td>
              <td><code class="filename">audit.<em class="replaceable"><code>timestamp</code></em>.log</code></td>
            </tr><tr>
              <td scope="row">Compression</td>
              <td><code class="filename">audit.<em class="replaceable"><code>timestamp</code></em>.log.gz</code></td>
            </tr><tr>
              <td scope="row">Encryption</td>
              <td><code class="filename">audit.<em class="replaceable"><code>timestamp</code></em>.log.enc</code></td>
            </tr><tr>
              <td scope="row">Compression, encryption</td>
              <td><code class="filename">audit.<em class="replaceable"><code>timestamp</code></em>.log.gz.enc</code></td>
</tr></tbody></table>
</div>
<p>
          To uncompress a compressed log file manually, use
          <span class="command"><strong>gunzip</strong></span>, <span class="command"><strong>gzip -d</strong></span>, or
          equivalent command. For example:
        </p><pre data-lang="terminal" class="programlisting">
gunzip -c audit.<em class="replaceable"><code>timestamp</code></em>.log.gz &gt; audit.<em class="replaceable"><code>timestamp</code></em>.log
</pre><p>
          To decrypt an encrypted log file manually, use the
          <span class="command"><strong>openssl</strong></span> command. For example:
        </p><pre data-lang="terminal" class="programlisting">
openssl enc -d -aes-256-cbc -pass pass:<em class="replaceable"><code>password</code></em> -md sha256
    -in audit.<em class="replaceable"><code>timestamp</code></em>.log.enc
    -out audit.<em class="replaceable"><code>timestamp</code></em>.log
</pre><p>
          If both compression and encryption are enabled for audit
          logging, compression occurs before encryption. In this case,
          the file name has <code class="filename">.gz</code> and
          <code class="filename">.enc</code> suffixes added, corresponding to the
          order in which those operations occur. To recover the original
          file manually, perform the operations in reverse. That is,
          first decrypt the file, then uncompress it:
        </p><pre data-lang="terminal" class="programlisting">
openssl enc -d -aes-256-cbc -pass pass:<em class="replaceable"><code>password</code></em> -md sha256
    -in audit.<em class="replaceable"><code>timestamp</code></em>.log.gz.enc
    -out audit.<em class="replaceable"><code>timestamp</code></em>.log.gz
gunzip -c audit.<em class="replaceable"><code>timestamp</code></em>.log.gz &gt; audit.<em class="replaceable"><code>timestamp</code></em>.log
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-space-management"></a>Audit Log File Space Management and Name Rotation</h5>

</div>

</div>

</div>
<p>
          The audit log file has the potential to grow very large and
          consume a lot of disk space. To enable management of the space
          used by its log files, the audit log plugin provides for log
          file rotation, either manually or automatically. Rotation
          capabilities use the
          <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a> and
          <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
          system variables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              By default,
              <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size=0</code></a>
              and no log rotation occurs unless performed manually. In
              this case, use
              <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a> to close
              and reopen the current log file after manually renaming
              it.
            </p></li><li class="listitem"><p>
              If
              <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
              is greater than 0, automatic rotation occurs when a write
              to the current log file causes its size to exceed this
              value. The audit log plugin closes the file, renames it,
              and opens a new log file. With automatic rotation enabled,
              <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a> has no
              effect.
            </p></li><li class="listitem"><p>
              Automatic rotation also occurs under several other
              conditions, described later.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            Renamed log files are not removed automatically. For
            example, with size-based log file rotation, renamed log
            files do not rotate off the end of the name sequence.
            Instead, they have unique names and accumulate indefinitely.
            To avoid excessive space use, remove old files periodically,
            backing them up first as necessary.
</p>
</div>
<p>
          The following discussion describes log file rotation methods
          in greater detail.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-space-management-manual-rotation" title="Manual Audit Log File Rotation">Manual Audit Log File Rotation</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-space-management-automatic-rotation" title="Automatic Audit Log File Rotation">Automatic Audit Log File Rotation</a></p></li></ul>
</div>
<h6><a name="audit-log-space-management-manual-rotation"></a>Manual Audit Log File Rotation</h6><p>
          If <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size=0</code></a>
          (the default), no log rotation occurs unless performed
          manually. In this case, the audit log plugin closes and
          reopens the log file when the
          <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a> value changes
          from disabled to enabled. Log file renaming must be done
          externally to the server. Suppose that the log file name is
          <code class="filename">audit.log</code> and you want to maintain the
          three most recent log files, cycling through the names
          <code class="filename">audit.log.1</code> through
          <code class="filename">audit.log.3</code>. On Unix, perform rotation
          manually like this:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
              From the command line, rename the current log files:
            </p><pre data-lang="terminal" class="programlisting">
mv audit.log.2 audit.log.3
mv audit.log.1 audit.log.2
mv audit.log audit.log.1
</pre><p>
              This strategy overwrites the current
              <code class="filename">audit.log.3</code> contents, placing a bound
              on the number of archived log files and the space they
              use.
            </p></li><li class="listitem"><p>
              At this point, the plugin is still writing to the current
              log file, which has been renamed to
              <code class="filename">audit.log.1</code>. Connect to the server
              and flush the log file so the plugin closes it and reopens
              a new <code class="filename">audit.log</code> file:
            </p><pre data-lang="sql" class="programlisting">
SET GLOBAL audit_log_flush = ON;
</pre><p>
              <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a> is
              special in that its value remains <code class="literal">OFF</code>
              so that you need not disable it explicitly before enabling
              it again to perform another flush.
</p></li></ol>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            For JSON-format logging, renaming audit log files manually
            makes them unavailable to the log-reading functions because
            the audit log plugin no longer can determine that they are
            part of the log file sequence (see
            <a class="xref" href="security.html#audit-log-file-reading" title="Audit Log File Reading">Audit Log File Reading</a>). Consider setting
            <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
            greater than 0 to use size-based rotation instead.
</p>
</div>
<h6><a name="audit-log-space-management-automatic-rotation"></a>Automatic Audit Log File Rotation</h6><p>
          If <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
          is greater than 0, setting
          <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a> has no
          effect. Instead, whenever a write to the current log file
          causes its size to exceed the
          <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
          value, the audit log plugin closes the file, renames it, and
          opens a new log file.
        </p><p>
          Automatic rotation also occurs under these conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              During plugin initialization, if a file with the audit log
              file name already exists (see
              <a class="xref" href="security.html#audit-log-file-name" title="Audit Log File Name">Audit Log File Name</a>).
            </p></li><li class="listitem"><p>
              During plugin termination.
            </p></li><li class="listitem"><p>
              When the
              <a class="link" href="security.html#udf_audit-log-encryption-password-set"><code class="literal">audit_log_encryption_password_set()</code></a>
              function is called to set the encryption password.
</p></li></ul>
</div>
<p>
          The plugin renames the original file by inserting a timestamp
          just after its base name. For example, if the file name is
          <code class="filename">audit.log</code>, the plugin renames it to a
          value such as <code class="filename">audit.20180115T140633.log</code>.
          The timestamp is a UTC value in
          <code class="literal"><em class="replaceable"><code>YYYYMMDD</code></em>T<em class="replaceable"><code>hhmmss</code></em></code>
          format. The timestamp indicates rotation time for XML logging,
          and the timestamp of the last event written to the file for
          JSON logging.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-strategy"></a>Audit Logging Write Strategy</h5>

</div>

</div>

</div>
<p>
          The audit log plugin can use any of several strategies for log
          writes. Regardless of strategy, logging occurs on a
          best-effort basis, with no guarantee of consistency.
        </p><p>
          To specify a write strategy, set the
          <a class="link" href="security.html#sysvar_audit_log_strategy"><code class="literal">audit_log_strategy</code></a> system
          variable at server startup. By default, the strategy value is
          <code class="literal">ASYNCHRONOUS</code> and the plugin logs
          asynchronously to a buffer, waiting if the buffer is full.
          It's possible to tell the plugin not to wait
          (<code class="literal">PERFORMANCE</code>) or to log synchronously,
          either using file system caching
          (<code class="literal">SEMISYNCHRONOUS</code>) or forcing output with a
          <code class="literal">sync()</code> call after each write request
          (<code class="literal">SYNCHRONOUS</code>).
        </p><p>
          For asynchronous write strategy, the
          <a class="link" href="security.html#sysvar_audit_log_buffer_size"><code class="literal">audit_log_buffer_size</code></a> system
          variable is the buffer size in bytes. Set this variable at
          server startup to change the buffer size. The plugin uses a
          single buffer, which it allocates when it initializes and
          removes when it terminates. The plugin does not allocate this
          buffer for nonasynchronous write strategies.
        </p><p>
          Asynchronous logging strategy has these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Minimal impact on server performance and scalability.
            </p></li><li class="listitem"><p>
              Blocking of threads that generate audit events for the
              shortest possible time; that is, time to allocate the
              buffer plus time to copy the event to the buffer.
            </p></li><li class="listitem"><p>
              Output goes to the buffer. A separate thread handles
              writes from the buffer to the log file.
</p></li></ul>
</div>
<p>
          With asynchronous logging, the integrity of the log file may
          be compromised if a problem occurs during a write to the file
          or if the plugin does not shut down cleanly (for example, in
          the event that the server host exits unexpectedly). To reduce
          this risk, set
          <a class="link" href="security.html#sysvar_audit_log_strategy"><code class="literal">audit_log_strategy</code></a> to use
          synchronous logging.
        </p><p>
          A disadvantage of <code class="literal">PERFORMANCE</code> strategy is
          that it drops events when the buffer is full. For a heavily
          loaded server, the audit log may have events missing.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-file-reading"></a>Audit Log File Reading</h5>

</div>

</div>

</div>
<p>
          The audit log plugin enables bookmarking and reading of
          JSON-format audit log files. (These capabilities do not apply
          to files written in other log formats.)
        </p><p>
          When the audit log plugin initializes and is configured for
          JSON logging, it uses the directory containing the audit log
          file (determined from the
          <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> value) as the
          location to search for readable audit log files. To do this,
          it uses the value of
          <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> to determine
          the file base name and suffix values, then looks for files
          with names that match the following pattern, where
          <code class="literal">[...]</code> indicates optional file name parts:
        </p><pre data-lang="none" class="programlisting">
<em class="replaceable"><code>basename</code></em>[.<em class="replaceable"><code>timestamp</code></em>].<em class="replaceable"><code>suffix</code></em>[.gz][.enc]
</pre><p>
          The plugin opens each matching file, checks that it really
          contains JSON audit records, and sorts them using the
          timestamps from the first record of each file to construct a
          list of log files that are subject to use with the log-reading
          functions.
        </p><p>
          The plugin cannot include in the sequence files that were
          renamed manually and do not match the preceding pattern, or
          that were encrypted with a password no longer available in the
          keyring.
        </p><p>
          To read events from the audit log, use these user-defined
          functions (UDFs):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="security.html#udf_audit-log-read-bookmark"><code class="literal">audit_log_read_bookmark()</code></a>
              returns a <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> string
              representing a bookmark for the most recently written
              audit log event. This bookmark is suitable for passing to
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> to indicate
              to that function where to begin reading. Example bookmark:
            </p><pre data-lang="json" class="programlisting">
{ "timestamp": "2018-01-15 21:03:44", "id": 0 }
</pre></li><li class="listitem"><p>
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> reads
              events from the audit log and returns a
              <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> string containing an
              array of audit events.
</p></li></ul>
</div>
<p>
          Example <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a>
          invocation using the current bookmark:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT audit_log_read(audit_log_read_bookmark());</code></strong>
+-----------------------------------------------------------------------+
| audit_log_read(audit_log_read_bookmark())                             |
+-----------------------------------------------------------------------+
| [ {"timestamp":"2018-01-15 22:41:24","id":0,"class":"connection", ... |
+-----------------------------------------------------------------------+
</pre><p>
          Each event in the
          <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> return value is
          a <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> hash, except that the
          last array element may be a
          <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> <code class="literal">null</code>
          value to indicate no following events are available to read.
          For example:
        </p><pre data-lang="json" class="programlisting">
[
  { "timestamp": "2018-01-15 22:08:08", "id": 10,
    "class": "general", "event": "status",
    ...
  },
  {
    "timestamp": "2018-01-15 22:08:08", "id": 11,
    "class": "connection", "event": "disconnect",
    ...
  },
  {
    "timestamp": "2018-01-15 13:39:33", "id": 0,
    "class": "connection", "event": "connect",
    ...
  },
  {
    "timestamp": "2018-01-15 13:39:33", "id": 1,
    "class": "general", "event": "status",
    ...
  },
  {
    "timestamp": "2018-01-15 13:39:33", "id": 2,
    "class": "connection", "event": "disconnect",
    ...
  },
  null
]
</pre><p>
          Use <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> like this:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              For the first call to
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> within a
              session, pass a bookmark indicating where to begin
              reading.
            </p></li><li class="listitem"><p>
              If the final value of the returned array is not a
              <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a>
              <code class="literal">null</code> value, there are more events
              following those just read and
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> can be
              called without or with a bookmark argument. Without an
              argument, reading continues with the next unread event.
              With a bookmark argument, reading continues from the
              bookmark.
            </p></li><li class="listitem"><p>
              If the final value of the returned array is a
              <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a>
              <code class="literal">null</code> value, there are no more events
              left to be read and the next call to
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> must
              include a bookmark argument.
</p></li></ul>
</div>
<p>
          A bookmark is a <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> hash that
          indicates where and how much to read. The following items are
          significant in the bookmark value (other items are ignored):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">timestamp</code>, <code class="literal">id</code>: The
              location within the audit log of the first event to read.
              Both items must be present to completely specify a
              position.
            </p></li><li class="listitem"><p>
              <code class="literal">max_array_length</code>: The maximum number of
              events to read from the log. If omitted, the default is to
              read to the end of the log or until the read buffer is
              full, whichever comes first.
</p></li></ul>
</div>
<p>
          The result returned from either log-reading function is a
          binary string. To use the string with functions that require a
          nonbinary string (such as the functions that manipulate
          <code class="literal">JSON</code> values), convert it to
          <code class="literal">utf8mb4</code>. Suppose that a bookmark has this
          value:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @mark := audit_log_read_bookmark() AS mark;</code></strong>
+-------------------------------------------------+
| mark                                            |
+-------------------------------------------------+
| { "timestamp": "2018-01-15 16:10:28", "id": 2 } |
+-------------------------------------------------+
</pre><p>
          Calling <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> with
          that bookmark can return multiple events. To set a limit on
          the number of events read by
          <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a>, convert the
          bookmark to <code class="literal">utf8mb4</code>, then add to it a
          <code class="literal">max_array_length</code> item with a value of 1.
          For example, using the preceding bookmark, convert and modify
          it as follows:
        </p><pre data-lang="sql" class="programlisting">

mysql&gt; <strong class="userinput"><code>SET @mark = CONVERT(@mark USING utf8mb4);</code></strong>
mysql&gt; <strong class="userinput"><code>SET @mark := JSON_SET(@mark, '$.max_array_length', 1);</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT @mark;</code></strong>
+----------------------------------------------------------------------+
| @mark                                                                |
+----------------------------------------------------------------------+
| {"id": 2, "timestamp": "2018-01-15 16:10:28", "max_array_length": 1} |
+----------------------------------------------------------------------+
</pre><p>
          The modified bookmark, when passed to
          <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a>, produces a
          result of a single audit record.
        </p><p>
          To set a limit on the number of bytes that
          <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> reads, set the
          <a class="link" href="security.html#sysvar_audit_log_read_buffer_size"><code class="literal">audit_log_read_buffer_size</code></a>
          system variable. As of MySQL 8.0.12, this variable has a
          default of 32KB and can be set at runtime. Each client should
          set its session value of
          <a class="link" href="security.html#sysvar_audit_log_read_buffer_size"><code class="literal">audit_log_read_buffer_size</code></a>
          appropriately for its use of
          <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a>. Prior to MySQL
          8.0.12,
          <a class="link" href="security.html#sysvar_audit_log_read_buffer_size"><code class="literal">audit_log_read_buffer_size</code></a>
          has a default of 1MB, affects all clients, and can be changed
          only at server startup.
        </p><p>
          Each call to <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a>
          returns as many available items as fit within the buffer size,
          skipping items that do not fit within the buffer size. Given
          this behavior, consider these factors when assessing the
          proper buffer size for an application:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              There is a tradeoff between number of calls to
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> and items
              returned per call. With a smaller buffer size, calls
              return fewer items, so more calls are needed. With a
              larger buffer size, calls return more items, so fewer
              calls are needed.
            </p></li><li class="listitem"><p>
              With a smaller buffer size, such as the default size of
              32KB, there is a greater chance that items will exceed the
              buffer size and
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> will skip
              them. Skipped items generate warnings.
</p></li></ul>
</div>
<p>
          For additional information about audit log-reading functions,
          see <a class="xref" href="security.html#audit-log-routines" title="6.4.5.8.2 Audit Log Functions">Section 6.4.5.8.2, “Audit Log Functions”</a>.
</p>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-filtering"></a>6.4.5.6 Audit Log Filtering</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091713602736"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          This section describes how audit log filtering works if the
          audit log plugin and the accompanying audit tables and UDFs
          are installed. If the plugin is installed but not the
          accompanying audit tables and UDFs, the plugin operates in
          legacy filtering mode, described in
          <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.7 Legacy Mode Audit Log Filtering">Section 6.4.5.7, “Legacy Mode Audit Log Filtering”</a>. Legacy mode is
          filtering behavior as it was prior to MySQL 5.7.13; that is,
          before the introduction of rule-based filtering.
</p>
</div>
<p>
        The audit log plugin has the capability of controlling logging
        of audited events by filtering them:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Audited events can be filtered using these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                User account
              </p></li><li class="listitem"><p>
                Audit event class
              </p></li><li class="listitem"><p>
                Audit event subclass
              </p></li><li class="listitem"><p>
                Value of event fields such as those that indicate
                operation status or SQL statement executed
</p></li></ul>
</div>
</li><li class="listitem"><p>
            Audit filtering is rule based:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                A filter definition creates a set of auditing rules.
                Definitions can be configured to include or exclude
                events for logging based on the characteristics just
                described.
              </p></li><li class="listitem"><p>
                Filter rules have the capability of blocking (aborting)
                execution of qualifying events, in addition to existing
                capabilities for event logging.
              </p></li><li class="listitem"><p>
                Multiple filters can be defined, and any given filter
                can be assigned to any number of user accounts.
              </p></li><li class="listitem"><p>
                It is possible to define a default filter to use with
                any user account that has no explicitly assigned filter.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            Audit filters can be defined, displayed, and modified using
            an SQL interface based on user-defined functions (UDFs).
          </p></li><li class="listitem"><p>
            Audit filter definitions are stored in the tables in the
            <code class="literal">mysql</code> system database.
          </p></li><li class="listitem"><p>
            Within a given session, the value of the read-only
            <a class="link" href="security.html#sysvar_audit_log_filter_id"><code class="literal">audit_log_filter_id</code></a> system
            variable indicates whether a filter has been assigned to the
            session.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          By default, rule-based audit log filtering logs no auditable
          events for any users. To log all auditable events for all
          users, use the following statements, which create a simple
          filter to enable logging and assign it to the default account:
        </p><pre data-lang="sql" class="programlisting">
SELECT audit_log_filter_set_filter('log_all', '{ "filter": { "log": true } }');
SELECT audit_log_filter_set_user('%', 'log_all');
</pre><p>
          The filter assigned to <code class="literal">%</code> is used for
          connections from any account that has no explicitly assigned
          filter (which initially is true for all accounts).
</p>
</div>
<p>
        The following list briefly summarizes the UDFs that implement
        the SQL interface for audit filtering control:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="link" href="security.html#udf_audit-log-filter-set-filter"><code class="literal">audit_log_filter_set_filter()</code></a>:
            Define a filter
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#udf_audit-log-filter-remove-filter"><code class="literal">audit_log_filter_remove_filter()</code></a>:
            Remove a filter
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#udf_audit-log-filter-set-user"><code class="literal">audit_log_filter_set_user()</code></a>:
            Start filtering a user account
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#udf_audit-log-filter-remove-user"><code class="literal">audit_log_filter_remove_user()</code></a>:
            Stop filtering a user account
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#udf_audit-log-filter-flush"><code class="literal">audit_log_filter_flush()</code></a>:
            Flush manual changes to the filter tables to affect ongoing
            filtering
</p></li></ul>
</div>
<p>
        For usage examples and complete details about the filtering
        functions, see <a class="xref" href="security.html#audit-log-filtering-functions" title="6.4.5.6.1 Using Audit Log Filtering Functions">Section 6.4.5.6.1, “Using Audit Log Filtering Functions”</a>,
        and <a class="xref" href="security.html#audit-log-routines" title="6.4.5.8.2 Audit Log Functions">Section 6.4.5.8.2, “Audit Log Functions”</a>.
      </p><p>
        Audit log filtering functions are subject to these constraints:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            To use any filtering function, the
            <code class="literal">audit_log</code> plugin must be enabled or an
            error occurs. In addition, the audit tables must exist or an
            error occurs. To install the <code class="literal">audit_log</code>
            plugin and its accompanying UDFs and tables, see
            <a class="xref" href="security.html#audit-log-installation" title="6.4.5.2 Installing or Uninstalling MySQL Enterprise Audit">Section 6.4.5.2, “Installing or Uninstalling MySQL Enterprise Audit”</a>.
          </p></li><li class="listitem"><p>
            To use any filtering function, a user must possess the
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege or an error
            occurs. To grant the <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>
            privilege to a user account, use this statement:
          </p><pre data-lang="sql" class="programlisting">
GRANT SUPER ON *.* TO <em class="replaceable"><code>user</code></em>;
</pre><p>
            Alternatively, should you prefer to avoid granting the
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege while still
            permitting users to access specific filtering functions,
            <span class="quote">“<span class="quote">wrapper</span>”</span> stored programs can be defined. This
            technique is described in the context of keyring UDFs in
            <a class="xref" href="security.html#keyring-udf-usage" title="6.4.4.8.2 Using General-Purpose Keyring Functions">Section 6.4.4.8.2, “Using General-Purpose Keyring Functions”</a>; it can be adapted for
            use with filtering UDFs.
          </p></li><li class="listitem"><p>
            The <code class="literal">audit_log</code> plugin operates in legacy
            mode if it is installed but the accompanying audit tables
            and functions are not created. The plugin writes these
            messages to the error log at server startup:
          </p><a class="indexterm" name="idm140091713552896"></a><pre data-lang="none" class="programlisting">
[Warning] Plugin audit_log reported: 'Failed to open the audit log filter tables.'
[Warning] Plugin audit_log reported: 'Audit Log plugin supports a filtering,
which has not been installed yet. Audit Log plugin will run in the legacy
mode, which will be disabled in the next release.'
</pre><p>
            In legacy mode, filtering can be done based only on event
            account or status. For details, see
            <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.7 Legacy Mode Audit Log Filtering">Section 6.4.5.7, “Legacy Mode Audit Log Filtering”</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-filtering-functions"></a>6.4.5.6.1 Using Audit Log Filtering Functions</h5>

</div>

</div>

</div>
<p>
          Before using the audit log user-defined functions (UDFs),
          install them according to the instructions provided in
          <a class="xref" href="security.html#audit-log-installation" title="6.4.5.2 Installing or Uninstalling MySQL Enterprise Audit">Section 6.4.5.2, “Installing or Uninstalling MySQL Enterprise Audit”</a>. The
          <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege is required to
          use any of these functions.
        </p><p>
          The audit log filtering functions enable filtering control by
          providing an interface to create, modify, and remove filter
          definitions and assign filters to user accounts.
        </p><p>
          Filter definitions are <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a>
          values. For information about using
          <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> data in MySQL, see
          <a class="xref" href="data-types.html#json" title="11.6 The JSON Data Type">Section 11.6, “The JSON Data Type”</a>. This section shows some simple filter
          definitions. For more information about filter definitions,
          see <a class="xref" href="security.html#audit-log-filter-definitions" title="6.4.5.6.2 Writing Audit Log Filter Definitions">Section 6.4.5.6.2, “Writing Audit Log Filter Definitions”</a>.
        </p><p>
          When a connection arrives, the audit log plugin determines
          which filter to use for the new session by searching for the
          user account name in the current filter assignments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If a filter is assigned to the user, the audit log uses
              that filter.
            </p></li><li class="listitem"><p>
              Otherwise, if no user-specific filter assignment exists,
              but there is a filter assigned to the default account
              (<code class="literal">%</code>), the audit log uses the default
              filter.
            </p></li><li class="listitem"><p>
              Otherwise, the audit log selects no audit events from the
              session for processing.
</p></li></ul>
</div>
<p>
          If a change-user operation occurs during a session (see
          <a class="xref" href="connectors-apis.html#mysql-change-user" title="28.7.7.3 mysql_change_user()">Section 28.7.7.3, “mysql_change_user()”</a>), filter assignment for
          the session is updated using the same rules but for the new
          user.
        </p><p>
          By default, no accounts have a filter assigned, so no
          processing of auditable events occurs for any account.
        </p><p>
          Suppose that instead you want the default to be to log only
          connection-related activity (for example, to see connect,
          change-user, and disconnect events, but not the SQL statements
          users execute while connected). To achieve this, define a
          filter (shown here named <code class="literal">log_conn_events</code>)
          that enables logging only of events in the
          <code class="literal">connection</code> class, and assign that filter to
          the default account, represented by the <code class="literal">%</code>
          account name:
        </p><pre data-lang="sql" class="programlisting">
SET @f = '{ "filter": { "class": { "name": "connection" } } }';
SELECT audit_log_filter_set_filter('log_conn_events', @f);
SELECT audit_log_filter_set_user('%', 'log_conn_events');
</pre><p>
          Now the audit log uses this default account filter for
          connections from any account that has no explicitly defined
          filter.
        </p><p>
          To assign a filter explicitly to a particular user account or
          accounts, define the filter, then assign it to the relevant
          accounts:
        </p><pre data-lang="sql" class="programlisting">
SELECT audit_log_filter_set_filter('log_all', '{ "filter": { "log": true } }');
SELECT audit_log_filter_set_user('user1@localhost', 'log_all');
SELECT audit_log_filter_set_user('user2@localhost', 'log_all');
</pre><p>
          Now full logging is enabled for
          <code class="literal">user1@localhost</code> and
          <code class="literal">user2@localhost</code>. Connections from other
          accounts continue to be filtered using the default account
          filter.
        </p><p>
          To disassociate a user account from its current filter, either
          unassign the filter or assign a different filter:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              To unassign the filter from the user account:
            </p><pre data-lang="sql" class="programlisting">
SELECT audit_log_filter_remove_user('user1@localhost');
</pre><p>
              Filtering of current sessions for the account remains
              unaffected. Subsequent connections from the account are
              filtered using the default account filter if there is one,
              and are not logged otherwise.
            </p></li><li class="listitem"><p>
              To assign a different filter to the user account:
            </p><pre data-lang="sql" class="programlisting">
SELECT audit_log_filter_set_filter('log_nothing', '{ "filter": { "log": false } }');
SELECT audit_log_filter_set_user('user1@localhost', 'log_nothing');
</pre><p>
              Filtering of current sessions for the account remains
              unaffected. Subsequent connections from the account are
              filtered using the new filter. For the filter shown here,
              that means no logging for new connections from
              <code class="literal">user1@localhost</code>.
</p></li></ul>
</div>
<p>
          For audit log filtering, user name and host name comparisons
          are case-sensitive. This differs from comparisons for
          privilege checking, for which host name comparisons are not
          case-sensitive.
        </p><p>
          To remove a filter, do this:
        </p><pre data-lang="sql" class="programlisting">
SELECT audit_log_filter_remove_filter('log_nothing');
</pre><p>
          Removing a filter also unassigns it from any users to whom it
          has been assigned, including any current sessions for those
          users.
        </p><p>
          The filtering UDFs just described affect audit filtering
          immediately and update the audit log tables in the
          <code class="literal">mysql</code> system database that store filters
          and user accounts (see <a class="xref" href="security.html#audit-log-tables" title="6.4.5.8.1 Audit Log Tables">Section 6.4.5.8.1, “Audit Log Tables”</a>). It
          is also possible to modify the audit log tables directly using
          statements such as <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a>, but such changes do not
          affect filtering immediately. To flush your changes and make
          them operational, call
          <a class="link" href="security.html#udf_audit-log-filter-flush"><code class="literal">audit_log_filter_flush()</code></a>:
        </p><pre data-lang="sql" class="programlisting">
SELECT audit_log_filter_flush();
</pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
            <a class="link" href="security.html#udf_audit-log-filter-flush"><code class="literal">audit_log_filter_flush()</code></a>
            should be used only after modifying the audit tables
            directly, to force reloading all filters. Otherwise, this
            function should be avoided. It is, in effect, a simplified
            version of unloading and reloading the
            <code class="literal">audit_log</code> plugin with
            <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a> plus
            <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>.
          </p><p>
            <a class="link" href="security.html#udf_audit-log-filter-flush"><code class="literal">audit_log_filter_flush()</code></a>
            affects all current sessions and detaches them from their
            previous filters. Current sessions are no longer logged
            unless they disconnect and reconnect, or execute a
            change-user operation.
</p>
</div>
<p>
          To determine whether a filter has been assigned to the current
          session, check the session value of the read-only
          <a class="link" href="security.html#sysvar_audit_log_filter_id"><code class="literal">audit_log_filter_id</code></a> system
          variable. If the value is 0, no filter is assigned. A nonzero
          value indicates the internally maintained ID of the assigned
          filter:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT @@audit_log_filter_id;</code></strong>
+-----------------------+
| @@audit_log_filter_id |
+-----------------------+
|                     2 |
+-----------------------+
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-filter-definitions"></a>6.4.5.6.2 Writing Audit Log Filter Definitions</h5>

</div>

</div>

</div>
<p>
          Filter definitions are <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a>
          values. For information about using
          <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> data in MySQL, see
          <a class="xref" href="data-types.html#json" title="11.6 The JSON Data Type">Section 11.6, “The JSON Data Type”</a>.
        </p><p>
          Filter definitions have this form, where
          <em class="replaceable"><code>actions</code></em> indicates how filtering
          takes place:
        </p><pre data-lang="json" class="programlisting">
{ "filter": <em class="replaceable"><code>actions</code></em> }
</pre><p>
          The following discussion describes permitted constructs in
          filter definitions.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-enabling-logging" title="Logging All Events">Logging All Events</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-class-logging" title="Logging Specific Event Classes">Logging Specific Event Classes</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-subclass-logging" title="Logging Specific Event Subclasses">Logging Specific Event Subclasses</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-inclusive-exclusive" title="Inclusive and Exclusive Logging">Inclusive and Exclusive Logging</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-event-fields" title="Testing Event Field Values">Testing Event Field Values</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-blocking-events" title="Blocking Execution of Specific Events">Blocking Execution of Specific Events</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-logical-operators" title="Logical Operators">Logical Operators</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-predefined-variables" title="Referencing Predefined Variables">Referencing Predefined Variables</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-predefined-functions" title="Referencing Predefined Functions">Referencing Predefined Functions</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-filtering-filter-replacement" title="Replacing a User Filter">Replacing a User Filter</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h6 class="title"><a name="audit-log-filtering-enabling-logging"></a>Logging All Events</h6>
</div>

</div>

</div>
<p>
            To explicitly enable or disable logging of all events, use a
            <code class="literal">log</code> element in the filter:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": { "log": true }
}
</pre><p>
            The <code class="literal">log</code> value can be either
            <code class="literal">true</code> or <code class="literal">false</code>.
          </p><p>
            The preceding filter enables logging of all events. It is
            equivalent to:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": { }
}
</pre><p>
            Logging behavior depends on the <code class="literal">log</code> value
            and whether <code class="literal">class</code> or
            <code class="literal">event</code> items are specified:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                With <code class="literal">log</code> specified, its given value
                is used.
              </p></li><li class="listitem"><p>
                Without <code class="literal">log</code> specified, logging is
                <code class="literal">true</code> if no <code class="literal">class</code>
                or <code class="literal">event</code> item is specified, and
                <code class="literal">false</code> otherwise (in which case,
                <code class="literal">class</code> or <code class="literal">event</code> can
                include their own <code class="literal">log</code> item).
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-class-logging"></a>Logging Specific Event Classes</h6>
</div>

</div>

</div>
<p>
            To log events of a specific class, use a
            <code class="literal">class</code> element in the filter, with its
            <code class="literal">name</code> field denoting the name of the class
            to log:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "class": { "name": "connection" }
  }
}
</pre><p>
            The <code class="literal">name</code> value can be
            <code class="literal">connection</code>, <code class="literal">general</code>,
            or <code class="literal">table_access</code> to log connection,
            general, or table-access events, respectively.
          </p><p>
            The preceding filter enables logging of events in the
            <code class="literal">connection</code> class. It is equivalent to the
            following filter with <code class="literal">log</code> items made
            explicit:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "log": false,
    "class": { "log": true,
               "name": "connection" }
  }
}
</pre><p>
            To enable logging of multiple classes, define the
            <code class="literal">class</code> value as a
            <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> array element that names
            the classes:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "class": [
      { "name": "connection" },
      { "name": "general" },
      { "name": "table_access" }
    ]
  }
}
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              When multiple instances of a given item appear at the same
              level within a filter definition, the item values can be
              combined into a single instance of that item within an
              array value. The preceding definition can be written like
              this:
            </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "class": [
      { "name": [ "connection", "general", "table_access" ] }
    ]
  }
}
</pre>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-subclass-logging"></a>Logging Specific Event Subclasses</h6>
</div>

</div>

</div>
<p>
            To select specific event subclasses, use an
            <code class="literal">event</code> item containing a
            <code class="literal">name</code> item that names the subclasses. The
            default action for events selected by an
            <code class="literal">event</code> item is to log them. For example,
            this filter enables logging for the named event subclasses:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "class": [
      {
        "name": "connection",
        "event": [
          { "name": "connect" },
          { "name": "disconnect" }
        ]
      },
      { "name": "general" },
      {
        "name": "table_access",
        "event": [
          { "name": "insert" },
          { "name": "delete" },
          { "name": "update" }
        ]
      }
    ]
  }
}
</pre><p>
            The <code class="literal">event</code> item can also contain explicit
            <code class="literal">log</code> items to indicate whether to log
            qualifying events. This <code class="literal">event</code> item
            selects multiple events and explicitly indicates logging
            behavior for them:
          </p><pre data-lang="json" class="programlisting">
"event": [
  { "name": "read", "log": false },
  { "name": "insert", "log": true },
  { "name": "delete", "log": true },
  { "name": "update", "log": true }
]
</pre><p>
            The <code class="literal">event</code> item can also indicate whether
            to block qualifying events, if it contains an
            <code class="literal">abort</code> item. For details, see
            <a class="xref" href="security.html#audit-log-filtering-blocking-events" title="Blocking Execution of Specific Events">Blocking Execution of Specific Events</a>.
          </p><p>
            <a class="xref" href="security.html#audit-log-event-subclass-combinations" title="Table 6.28 Event Class and Subclass Combinations">Table 6.28, “Event Class and Subclass Combinations”</a>
            describes the permitted subclass values for each event
            class.
</p>
<div class="table">
<a name="audit-log-event-subclass-combinations"></a><p class="title"><b>Table 6.28 Event Class and Subclass Combinations</b></p>
<div class="table-contents">
<table summary="Permitted combiniations of event class and subclass values."><col width="20%"><col width="20%"><col width="60%"><thead><tr>
                <th scope="col">Event Class</th>
                <th scope="col">Event Subclass</th>
                <th scope="col">Description</th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">connect</code></td>
                <td>Connection initiation (successful or unsuccessful)</td>
              </tr><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">change_user</code></td>
                <td>User re-authentication with different user/password during session</td>
              </tr><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">disconnect</code></td>
                <td>Connection termination</td>
              </tr><tr>
                <td scope="row"><code class="literal">general</code></td>
                <td><code class="literal">status</code></td>
                <td>General operation information</td>
              </tr><tr>
                <td scope="row"><code class="literal">message</code></td>
                <td><code class="literal">internal</code></td>
                <td>Internally generated message</td>
              </tr><tr>
                <td scope="row"><code class="literal">message</code></td>
                <td><code class="literal">user</code></td>
                <td>Message generated by
                  <a class="link" href="security.html#udf_audit-api-message-emit-udf"><code class="literal">audit_api_message_emit_udf()</code></a></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">read</code></td>
                <td>Table read statements, such as <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> or
                  <a class="link" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT Syntax"><code class="literal">INSERT
                  INTO ... SELECT</code></a></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">delete</code></td>
                <td>Table delete statements, such as <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a>
                  or <a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">insert</code></td>
                <td>Table insert statements, such as <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>
                  or <a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE Syntax"><code class="literal">REPLACE</code></a></td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">update</code></td>
                <td>Table update statements, such as <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
            <a class="xref" href="security.html#audit-log-event-subclass-log-abort" title="Table 6.29 Log and Abort Characteristics Per Event Class and Subclass Combination">Table 6.29, “Log and Abort Characteristics Per Event Class and Subclass Combination”</a>
            describes for each event subclass whether it can be logged
            or aborted.
</p>
<div class="table">
<a name="audit-log-event-subclass-log-abort"></a><p class="title"><b>Table 6.29 Log and Abort Characteristics Per Event Class and Subclass Combination</b></p>
<div class="table-contents">
<table summary="Log and abort characteristics for event class and subclass combinations."><col width="20%"><col width="20%"><col width="30%"><col width="30%"><thead><tr>
                <th scope="col">Event Class</th>
                <th scope="col">Event Subclass</th>
                <th scope="col">Can be Logged</th>
                <th scope="col">Can be Aborted</th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">connect</code></td>
                <td>Yes</td>
                <td>No</td>
              </tr><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">change_user</code></td>
                <td>Yes</td>
                <td>No</td>
              </tr><tr>
                <td scope="row"><code class="literal">connection</code></td>
                <td><code class="literal">disconnect</code></td>
                <td>Yes</td>
                <td>No</td>
              </tr><tr>
                <td scope="row"><code class="literal">general</code></td>
                <td><code class="literal">status</code></td>
                <td>Yes</td>
                <td>No</td>
              </tr><tr>
                <td scope="row"><code class="literal">message</code></td>
                <td><code class="literal">internal</code></td>
                <td>Yes</td>
                <td>Yes</td>
              </tr><tr>
                <td scope="row"><code class="literal">message</code></td>
                <td><code class="literal">user</code></td>
                <td>Yes</td>
                <td>Yes</td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">read</code></td>
                <td>Yes</td>
                <td>Yes</td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">delete</code></td>
                <td>Yes</td>
                <td>Yes</td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">insert</code></td>
                <td>Yes</td>
                <td>Yes</td>
              </tr><tr>
                <td scope="row"><code class="literal">table_access</code></td>
                <td><code class="literal">update</code></td>
                <td>Yes</td>
                <td>Yes</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-inclusive-exclusive"></a>Inclusive and Exclusive Logging</h6>
</div>

</div>

</div>
<p>
            A filter can be defined in inclusive or exclusive mode:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                Inclusive mode logs only explicitly specified items.
              </p></li><li class="listitem"><p>
                Exclusive mode logs everything but explicitly specified
                items.
</p></li></ul>
</div>
<p>
            To perform inclusive logging, disable logging globally and
            enable logging for specific classes. This filter logs
            <code class="literal">connect</code> and <code class="literal">disconnect</code>
            events in the <code class="literal">connection</code> class, and
            events in the <code class="literal">general</code> class:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "log": false,
    "class": [
      {
        "name": "connection",
        "event": [
          { "name": "connect", "log": true },
          { "name": "disconnect", "log": true }
        ]
      },
      { "name": "general", "log": true }
    ]
  }
}
</pre><p>
            To perform exclusive logging, enable logging globally and
            disable logging for specific classes. This filter logs
            everything except events in the <code class="literal">general</code>
            class:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "log": true,
    "class":
      { "name": "general", "log": false }
  }
}
</pre><p>
            This filter logs <code class="literal">change_user</code> events in
            the <code class="literal">connection</code> class,
            <code class="literal">message</code> events, and
            <code class="literal">table_access</code> events:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "log": true,
    "class": [
      {
        "name": "connection",
        "event": [
          { "name": "connect", "log": false },
          { "name": "disconnect", "log": false }
        ]
      },
      { "name": "general", "log": false }
    ]
  }
}
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-event-fields"></a>Testing Event Field Values</h6>
</div>

</div>

</div>
<p>
            To enable logging based on specific event field values,
            specify a <code class="literal">field</code> item within the
            <code class="literal">log</code> item that indicates the field name
            and its expected value:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "class": {
    "name": "general",
      "event": {
        "name": "status",
        "log": {
          "field": { "name": "general_command.str", "value": "Query" }
        }
      }
    }
  }
}
</pre><p>
            Each event contains event class-specific fields that can be
            accessed from within a filter to perform custom filtering.
          </p><p>
            A connection event indicates when a connection-related
            activity occurs during a session, such as a user connecting
            to or disconnecting from the server.
            <a class="xref" href="security.html#audit-log-connection-event-fields" title="Table 6.30 Connection Event Fields">Table 6.30, “Connection Event Fields”</a>
            indicates the permitted fields for connection events.
</p>
<div class="table">
<a name="audit-log-connection-event-fields"></a><p class="title"><b>Table 6.30 Connection Event Fields</b></p>
<div class="table-contents">
<table summary="Permitted fields for connection events."><col width="35%"><col width="20%"><col width="45%"><thead><tr>
                <th scope="col">Field Name</th>
                <th scope="col">Field Type</th>
                <th scope="col">Description</th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">status</code></td>
                <td>integer</td>
                <td><p class="valid-value">
                    Event status:
                  </p><p class="valid-value">
                    0: OK
                  </p><p class="valid-value">
                    Otherwise: Failed
                  </p></td>
              </tr><tr>
                <td scope="row"><code class="literal">connection_id</code></td>
                <td>unsigned integer</td>
                <td>Connection ID</td>
              </tr><tr>
                <td scope="row"><code class="literal">user.str</code></td>
                <td>string</td>
                <td>User name specified during authentication</td>
              </tr><tr>
                <td scope="row"><code class="literal">user.length</code></td>
                <td>unsigned integer</td>
                <td>User name length</td>
              </tr><tr>
                <td scope="row"><code class="literal">priv_user.str</code></td>
                <td>string</td>
                <td>Authenticated user name (account user name)</td>
              </tr><tr>
                <td scope="row"><code class="literal">priv_user.length</code></td>
                <td>unsigned integer</td>
                <td>Authenticated user name length</td>
              </tr><tr>
                <td scope="row"><code class="literal">external_user.str</code></td>
                <td>string</td>
                <td>External user name (provided by third-party authentication plugin)</td>
              </tr><tr>
                <td scope="row"><code class="literal">external_user.length</code></td>
                <td>unsigned integer</td>
                <td>External user name length</td>
              </tr><tr>
                <td scope="row"><code class="literal">proxy_user.str</code></td>
                <td>string</td>
                <td>Proxy user name</td>
              </tr><tr>
                <td scope="row"><code class="literal">proxy_user.length</code></td>
                <td>unsigned integer</td>
                <td>Proxy user name length</td>
              </tr><tr>
                <td scope="row"><code class="literal">host.str</code></td>
                <td>string</td>
                <td>Connected user host</td>
              </tr><tr>
                <td scope="row"><code class="literal">host.length</code></td>
                <td>unsigned integer</td>
                <td>Connected user host length</td>
              </tr><tr>
                <td scope="row"><code class="literal">ip.str</code></td>
                <td>string</td>
                <td>Connected user IP address</td>
              </tr><tr>
                <td scope="row"><code class="literal">ip.length</code></td>
                <td>unsigned integer</td>
                <td>Connected user IP address length</td>
              </tr><tr>
                <td scope="row"><code class="literal">database.str</code></td>
                <td>string</td>
                <td>Database name specified at connect time</td>
              </tr><tr>
                <td scope="row"><code class="literal">database.length</code></td>
                <td>unsigned integer</td>
                <td>Database name length</td>
              </tr><tr>
                <td scope="row"><code class="literal">connection_type</code></td>
                <td>integer</td>
                <td><p class="valid-value">
                    Connection type:
                  </p><p class="valid-value">
                    or <code class="literal">"::undefined"</code>: Undefined
                  </p><p class="valid-value">
                    or <code class="literal">"::tcp/ip"</code>: TCP/IP
                  </p><p class="valid-value">
                    or <code class="literal">"::socket"</code>: Socket
                  </p><p class="valid-value">
                    or <code class="literal">"::named_pipe"</code>: Named pipe
                  </p><p class="valid-value">
                    or <code class="literal">"::ssl"</code>: TCP/IP with
                    encryption
                  </p><p class="valid-value">
                    or <code class="literal">"::shared_memory"</code>: Shared
                    memory
                  </p></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
            The <code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code>
            values are symbolic pseudo-constants that may be given
            instead of the literal numeric values. They must be quoted
            as strings and are case-sensitive.
          </p><p>
            A general event indicates the status code of an operation
            and its details.
            <a class="xref" href="security.html#audit-log-general-event-fields" title="Table 6.31 General Event Fields">Table 6.31, “General Event Fields”</a> indicates
            the permitted fields for general events.
</p>
<div class="table">
<a name="audit-log-general-event-fields"></a><p class="title"><b>Table 6.31 General Event Fields</b></p>
<div class="table-contents">
<table summary="Permitted field types for general events."><col width="35%"><col width="20%"><col width="45%"><thead><tr>
                <th scope="col">Field Name</th>
                <th scope="col">Field Type</th>
                <th scope="col">Description</th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">general_error_code</code></td>
                <td>integer</td>
                <td><p class="valid-value">
                    Event status:
                  </p><p class="valid-value">
                    0: OK
                  </p><p class="valid-value">
                    Otherwise: Failed
                  </p></td>
              </tr><tr>
                <td scope="row"><code class="literal">general_thread_id</code></td>
                <td>unsigned integer</td>
                <td>Connection/thread ID</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_user.str</code></td>
                <td>string</td>
                <td>User name specified during authentication</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_user.length</code></td>
                <td>unsigned integer</td>
                <td>User name length</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_command.str</code></td>
                <td>string</td>
                <td>Command name</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_command.length</code></td>
                <td>unsigned integer</td>
                <td>Command name length</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_query.str</code></td>
                <td>string</td>
                <td>SQL statement text</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_query.length</code></td>
                <td>unsigned integer</td>
                <td>SQL statement text length</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_host.str</code></td>
                <td>string</td>
                <td>Host name</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_host.length</code></td>
                <td>unsigned integer</td>
                <td>Host name length</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_sql_command.str</code></td>
                <td>string</td>
                <td>SQL command type name</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_sql_command.length</code></td>
                <td>unsigned integer</td>
                <td>SQL command type name length</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_external_user.str</code></td>
                <td>string</td>
                <td>External user name (provided by third-party authentication plugin)</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_external_user.length</code></td>
                <td>unsigned integer</td>
                <td>External user name length</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_ip.str</code></td>
                <td>string</td>
                <td>Connected user IP address</td>
              </tr><tr>
                <td scope="row"><code class="literal">general_ip.length</code></td>
                <td>unsigned integer</td>
                <td>Connection user IP address length</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
            <code class="literal">general_command.str</code> indicates a command
            name: <code class="literal">Query</code>, <code class="literal">Execute</code>,
            <code class="literal">Quit</code>, or <code class="literal">Change user</code>.
          </p><p>
            A general event with the
            <code class="literal">general_command.str</code> field set to
            <code class="literal">Query</code> or <code class="literal">Execute</code>
            contains <code class="literal">general_sql_command.str</code> set to a
            value that specifies the type of SQL command:
            <code class="literal">alter_db</code>,
            <code class="literal">alter_db_upgrade</code>,
            <code class="literal">admin_commands</code>, and so forth. These
            values can be seen as the last components of the Performance
            Schema instruments displayed by this statement:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT NAME FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE 'statement/sql/%' ORDER BY NAME;</code></strong>
+---------------------------------------+
| NAME                                  |
+---------------------------------------+
| statement/sql/alter_db                |
| statement/sql/alter_db_upgrade        |
| statement/sql/alter_event             |
| statement/sql/alter_function          |
| statement/sql/alter_instance          |
| statement/sql/alter_procedure         |
| statement/sql/alter_server            |
...
</pre><p>
            A table-access event provides information about specific
            table accesses.
            <a class="xref" href="security.html#audit-log-table-access-event-fields" title="Table 6.32 Table-Access Event Fields">Table 6.32, “Table-Access Event Fields”</a>
            indicates the permitted fields for table-access events.
</p>
<div class="table">
<a name="audit-log-table-access-event-fields"></a><p class="title"><b>Table 6.32 Table-Access Event Fields</b></p>
<div class="table-contents">
<table summary="Permitted fields for table-access events."><col width="35%"><col width="20%"><col width="45%"><thead><tr>
                <th scope="col">Field Name</th>
                <th scope="col">Field Type</th>
                <th scope="col">Description</th>
              </tr></thead><tbody><tr>
                <td scope="row"><code class="literal">connection_id</code></td>
                <td>unsigned integer</td>
                <td>Event connection ID</td>
              </tr><tr>
                <td scope="row"><code class="literal">sql_command_id</code></td>
                <td>integer</td>
                <td>SQL command ID</td>
              </tr><tr>
                <td scope="row"><code class="literal">query.str</code></td>
                <td>string</td>
                <td>SQL statement text</td>
              </tr><tr>
                <td scope="row"><code class="literal">query.length</code></td>
                <td>unsigned integer</td>
                <td>SQL statement text length</td>
              </tr><tr>
                <td scope="row"><code class="literal">table_database.str</code></td>
                <td>string</td>
                <td>Database name associated with event</td>
              </tr><tr>
                <td scope="row"><code class="literal">table_database.length</code></td>
                <td>unsigned integer</td>
                <td>Database name length</td>
              </tr><tr>
                <td scope="row"><code class="literal">table_name.str</code></td>
                <td>string</td>
                <td>Table name associated with event</td>
              </tr><tr>
                <td scope="row"><code class="literal">table_name.length</code></td>
                <td>unsigned integer</td>
                <td>Table name length</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
            The following list shows which statements produce which
            table-access events:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">read</code> event:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">SELECT</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">INSERT ... SELECT</code> (for tables
                    referenced in <code class="literal">SELECT</code> clause)
                  </p></li><li class="listitem"><p>
                    <code class="literal">REPLACE ... SELECT</code> (for tables
                    referenced in <code class="literal">SELECT</code> clause)
                  </p></li><li class="listitem"><p>
                    <code class="literal">UPDATE ... WHERE</code> (for tables
                    referenced in <code class="literal">WHERE</code> clause)
                  </p></li><li class="listitem"><p>
                    <code class="literal">HANDLER ... READ</code>
</p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">delete</code> event:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">DELETE</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">TRUNCATE TABLE</code>
</p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">insert</code> event:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">INSERT</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">INSERT ... SELECT</code> (for table
                    referenced in <code class="literal">INSERT</code> clause)
                  </p></li><li class="listitem"><p>
                    <code class="literal">REPLACE</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">REPLACE ... SELECT</code> (for table
                    referenced in <code class="literal">REPLACE</code> clause
                  </p></li><li class="listitem"><p>
                    <code class="literal">LOAD DATA</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">LOAD XML</code>
</p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">update</code> event:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <code class="literal">UPDATE</code>
                  </p></li><li class="listitem"><p>
                    <code class="literal">UPDATE ... WHERE</code> (for tables
                    referenced in <code class="literal">UPDATE</code> clause)
</p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-blocking-events"></a>Blocking Execution of Specific Events</h6>
</div>

</div>

</div>
<p>
            <code class="literal">event</code> items can include an
            <code class="literal">abort</code> item that indicates whether to
            prevent qualifying events from executing. For example,
            <code class="literal">abort</code> enables rules to be written that
            block execution of specific SQL statements.
          </p><p>
            The <code class="literal">abort</code> item must appear within an
            <code class="literal">event</code> item. For example:
          </p><pre data-lang="json" class="programlisting">
"event": {
  "name": <em class="replaceable"><code>qualifying event subclass names</code></em>
  "abort": <em class="replaceable"><code>condition</code></em>
}
</pre><p>
            For event subclasses selected by the <code class="literal">name</code>
            item, the <code class="literal">abort</code> action is true or false,
            depending on <em class="replaceable"><code>condition</code></em>
            evaluation. If the condition evaluates to true, the event is
            blocked. Otherwise, the event continues executing.
          </p><p>
            The <em class="replaceable"><code>condition</code></em> specification can
            be as simple as <code class="literal">true</code> or
            <code class="literal">false</code>, or it can be more complex such
            that evaluation depends on event characteristics.
          </p><p>
            This filter blocks <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
            <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "class": {
      "name": "table_access",
      "event": {
        "name": [ "insert", "update", "delete" ],
        "abort": true
      }
    }
  }
}
</pre><p>
            This more complex filter blocks the same statements, but
            only for a specific table
            (<code class="literal">finances.bank_account</code>):
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "class": {
      "name": "table_access",
      "event": {
        "name": [ "insert", "update", "delete" ],
        "abort": {
          "and": [
            { "field": { "name": "table_database.str", "value": "finances" } },
            { "field": { "name": "table_name.str", "value": "bank_account" } }
          ]
        }
      }
    }
  }
}
</pre><p>
            Statements matched and blocked by the filter return an error
            to the client:
          </p><pre data-lang="none" class="programlisting">
ERROR 1045 (28000): Statement was aborted by an audit log filter
</pre><p>
            Not all events can be blocked (see
            <a class="xref" href="security.html#audit-log-event-subclass-log-abort" title="Table 6.29 Log and Abort Characteristics Per Event Class and Subclass Combination">Table 6.29, “Log and Abort Characteristics Per Event Class and Subclass Combination”</a>). For
            an event that cannot, the audit log writes a warning to the
            error log rather than blocking it.
          </p><p>
            For attempts to define a filter in which the
            <code class="literal">abort</code> item appears elsewhere than in an
            <code class="literal">event</code> item, an error occurs.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-logical-operators"></a>Logical Operators</h6>
</div>

</div>

</div>
<p>
            Logical operators (<code class="literal">and</code>,
            <code class="literal">or</code>, <code class="literal">not</code>) can be used
            in <code class="literal">log</code> items. This permits construction
            of more advanced filtering configurations:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "class": {
      "name": "general",
      "event": {
        "name": "status",
        "log": {
          "or": [
            {
              "and": [
                { "field": { "name": "general_command.str",    "value": "Query" } },
                { "field": { "name": "general_command.length", "value": 5 } }
              ]
            },
            {
              "and": [
                { "field": { "name": "general_command.str",    "value": "Execute" } },
                { "field": { "name": "general_command.length", "value": 7 } }
              ]
            }
          ]
        }
      }
    }
  }
}
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-predefined-variables"></a>Referencing Predefined Variables</h6>
</div>

</div>

</div>
<p>
            To refer to a predefined variable in a
            <code class="literal">log</code> condition, use a
            <code class="literal">variable</code> item, which tests equality
            against a given value:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "class": {
      "name": "general",
      "event": {
        "name": "status",
        "log": {
          "variable": {
            "name": "audit_log_connection_policy_value", "value": "::none"
          }
        }
      }
    }
  }
}
</pre><p>
            Each predefined variable corresponds to a system variable.
            By writing a filter that tests a predefined variable, you
            can modify filter operation by setting the corresponding
            system variable, without having to redefine the filter. For
            example, by writing a filter that tests the value of the
            <code class="literal">audit_log_connection_policy_value</code>
            predefined variable, you can modify filter operation by
            changing the value of the
            <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
            system variable.
          </p><a class="indexterm" name="idm140091713003824"></a><p>
            The
            <code class="literal">audit_log_<em class="replaceable"><code>xxx</code></em>_policy</code>
            system variables are used for the legacy mode audit log (see
            <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.7 Legacy Mode Audit Log Filtering">Section 6.4.5.7, “Legacy Mode Audit Log Filtering”</a>). With
            rule-based audit log filtering, those variables remain
            visible (for example, using <a class="link" href="sql-syntax.html#show-variables" title="13.7.6.39 SHOW VARIABLES Syntax"><code class="literal">SHOW
            VARIABLES</code></a>), but changes to them have no effect
            unless you write filters containing constructs that refer to
            them.
          </p><p>
            The following list describes the permitted predefined
            variables for <code class="literal">variable</code> items:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">audit_log_connection_policy_value</code>
              </p><p>
                This variable corresponds to the value of the
                <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
                system variable. The value is an unsigned integer.
                <a class="xref" href="security.html#audit-log-connection-policy-value-values" title="Table 6.33 audit_log_connection_policy_value Values">Table 6.33, “audit_log_connection_policy_value Values”</a>
                shows the permitted values and the corresponding
                <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
                values.
</p>
<div class="table">
<a name="audit-log-connection-policy-value-values"></a><p class="title"><b>Table 6.33 audit_log_connection_policy_value Values</b></p>
<div class="table-contents">
<table summary="Permitted audit_log_connection_policy_value values and the corresponding audit_log_connection_policy values."><col width="20%"><col width="80%"><thead><tr>
                    <th scope="col">Value</th>
                    <th scope="col">Corresponding audit_log_connection_policy Value</th>
                  </tr></thead><tbody><tr>
                    <td scope="row"><code class="literal">0</code> or <code class="literal">"::none"</code></td>
                    <td><code class="literal">NONE</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">1</code> or <code class="literal">"::errors"</code></td>
                    <td><code class="literal">ERRORS</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">2</code> or <code class="literal">"::all"</code></td>
                    <td><code class="literal">ALL</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
                The
                <code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code>
                values are symbolic pseudo-constants that may be given
                instead of the literal numeric values. They must be
                quoted as strings and are case-sensitive.
              </p></li><li class="listitem"><p>
                <code class="literal">audit_log_policy_value</code>
              </p><p>
                This variable corresponds to the value of the
                <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> system
                variable. The value is an unsigned integer.
                <a class="xref" href="security.html#audit-log-policy-value-values" title="Table 6.34 audit_log_policy_value Values">Table 6.34, “audit_log_policy_value Values”</a> shows
                the permitted values and the corresponding
                <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a>
                values.
</p>
<div class="table">
<a name="audit-log-policy-value-values"></a><p class="title"><b>Table 6.34 audit_log_policy_value Values</b></p>
<div class="table-contents">
<table summary="Permitted audit_log_policy_value values and the corresponding audit_log_policy values."><col width="20%"><col width="80%"><thead><tr>
                    <th scope="col">Value</th>
                    <th scope="col">Corresponding audit_log_policy Value</th>
                  </tr></thead><tbody><tr>
                    <td scope="row"><code class="literal">0</code> or <code class="literal">"::none"</code></td>
                    <td><code class="literal">NONE</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">1</code> or <code class="literal">"::logins"</code></td>
                    <td><code class="literal">LOGINS</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">2</code> or <code class="literal">"::all"</code></td>
                    <td><code class="literal">ALL</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">3</code> or <code class="literal">"::queries"</code></td>
                    <td><code class="literal">QUERIES</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
                The
                <code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code>
                values are symbolic pseudo-constants that may be given
                instead of the literal numeric values. They must be
                quoted as strings and are case-sensitive.
              </p></li><li class="listitem"><p>
                <code class="literal">audit_log_statement_policy_value</code>
              </p><p>
                This variable corresponds to the value of the
                <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
                system variable. The value is an unsigned integer.
                <a class="xref" href="security.html#audit-log-statement-policy-value-values" title="Table 6.35 audit_log_statement_policy_value Values">Table 6.35, “audit_log_statement_policy_value Values”</a>
                shows the permitted values and the corresponding
                <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
                values.
</p>
<div class="table">
<a name="audit-log-statement-policy-value-values"></a><p class="title"><b>Table 6.35 audit_log_statement_policy_value Values</b></p>
<div class="table-contents">
<table summary="Permitted audit_log_statement_policy_value values and the corresponding audit_log_statement_policy values."><col width="20%"><col width="80%"><thead><tr>
                    <th scope="col">Value</th>
                    <th scope="col">Corresponding audit_log_statement_policy Value</th>
                  </tr></thead><tbody><tr>
                    <td scope="row"><code class="literal">0</code> or <code class="literal">"::none"</code></td>
                    <td><code class="literal">NONE</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">1</code> or <code class="literal">"::errors"</code></td>
                    <td><code class="literal">ERRORS</code></td>
                  </tr><tr>
                    <td scope="row"><code class="literal">2</code> or <code class="literal">"::all"</code></td>
                    <td><code class="literal">ALL</code></td>
</tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
                The
                <code class="literal">"::<em class="replaceable"><code>xxx</code></em>"</code>
                values are symbolic pseudo-constants that may be given
                instead of the literal numeric values. They must be
                quoted as strings and are case-sensitive.
</p></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-predefined-functions"></a>Referencing Predefined Functions</h6>
</div>

</div>

</div>
<p>
            To refer to a predefined function in a
            <code class="literal">log</code> condition, use a
            <code class="literal">function</code> item, which takes
            <code class="literal">name</code> and <code class="literal">args</code> values
            to specify the function name and its arguments,
            respectively:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "class": {
      "name": "general",
      "event": {
        "name": "status",
        "log": {
          "function": {
            "name": "find_in_include_list",
            "args": [ { "string": [ { "field": "user.str" },
                                    { "string": "@"},
                                    { "field": "host.str" } ] } ]
          }
        }
      }
    }
  }
}
</pre><p>
            The function as specified in the <code class="literal">name</code>
            item should be the function name only, without parentheses
            or the argument list. Arguments in the
            <code class="literal">args</code> item, if there is one, must be given
            in the order listed in the function description. Arguments
            can refer to predefined variables, event fields, or string
            or numeric constants.
          </p><p>
            The preceding filter determines whether to log
            <code class="literal">general</code> class <code class="literal">status</code>
            events depending on whether the current user is found in the
            <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
            system variable. That user is constructed using fields in
            the event.
          </p><p>
            The following list describes the permitted predefined
            functions for <code class="literal">function</code> items:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                <code class="literal">audit_log_exclude_accounts_is_null()</code>
              </p><p>
                Checks whether the
                <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
                system variable is <code class="literal">NULL</code>. This
                function can be helpful when defining filters that
                correspond to the legacy audit log implementation.
              </p><p>
                Arguments:
              </p><p>
                None.
              </p></li><li class="listitem"><p>
                <code class="literal">audit_log_include_accounts_is_null()</code>
              </p><p>
                Checks whether the
                <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
                system variable is <code class="literal">NULL</code>. This
                function can be helpful when defining filters that
                correspond to the legacy audit log implementation.
              </p><p>
                Arguments:
              </p><p>
                None.
              </p></li><li class="listitem"><p>
                <code class="literal">debug_sleep(millisec)</code>
              </p><p>
                Sleeps for the given number of milliseconds. This
                function is used during performance measurement.
              </p><p>
                <code class="literal">debug_sleep()</code> is available for debug
                builds only.
              </p><p>
                Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <em class="replaceable"><code>millisec</code></em>: An unsigned
                    integer that specifies the number of milliseconds to
                    sleep.
</p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">find_in_exclude_list(account)</code>
              </p><p>
                Checks whether an account string exists in the audit log
                exclude list (the value of the
                <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
                system variable).
              </p><p>
                Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <em class="replaceable"><code>account</code></em>: A string that
                    specifies the user account name.
</p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">find_in_include_list(account)</code>
              </p><p>
                Checks whether an account string exists in the audit log
                include list (the value of the
                <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
                system variable).
              </p><p>
                Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <em class="replaceable"><code>account</code></em>: A string that
                    specifies the user account name.
</p></li></ul>
</div>
</li><li class="listitem"><p>
                <code class="literal">string_find(text, substr)</code>
              </p><p>
                Checks whether the <code class="literal">substr</code> value is
                contained in the <code class="literal">text</code> value. This
                search is case-sensitive.
              </p><p>
                Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                    <em class="replaceable"><code>text</code></em>: The text string to
                    search.
                  </p></li><li class="listitem"><p>
                    <em class="replaceable"><code>substr</code></em>: The substring to
                    search for in <em class="replaceable"><code>text</code></em>.
</p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h6 class="title"><a name="audit-log-filtering-filter-replacement"></a>Replacing a User Filter</h6>
</div>

</div>

</div>
<p>
            In some cases, the filter definition can be changed
            dynamically. To do this, define a <code class="literal">filter</code>
            configuration within an existing <code class="literal">filter</code>.
            For example:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "id": "main",
    "class": {
      "name": "table_access",
      "event": {
        "name": [ "update", "delete" ],
        "log": false,
        "filter": {
          "class": {
            "name": "general",
            "event" : { "name": "status",
                        "filter": { "ref": "main" } }
          },
          "activate": {
            "or": [
              { "field": { "name": "table_name.str", "value": "temp_1" } },
              { "field": { "name": "table_name.str", "value": "temp_2" } }
            ]
          }
        }
      }
    }
  }
}
</pre><p>
            A new filter is activated when the
            <code class="literal">activate</code> element within a subfilter
            evaluates to <code class="literal">true</code>. Using
            <code class="literal">activate</code> in a top-level
            <code class="literal">filter</code> is not permitted.
          </p><p>
            A new filter can be replaced with the original one by using
            a <code class="literal">ref</code> item inside the subfilter to refer
            to the original filter <code class="literal">id</code>.
          </p><p>
            The filter shown operates like this:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
                The <code class="literal">main</code> filter waits for
                <code class="literal">table_access</code> events, either
                <code class="literal">update</code> or <code class="literal">delete</code>.
              </p></li><li class="listitem"><p>
                If the <code class="literal">update</code> or
                <code class="literal">delete</code>
                <code class="literal">table_access</code> event occurs on the
                <code class="literal">temp_1</code> or <code class="literal">temp_2</code>
                table, the filter is replaced with the internal one
                (without an <code class="literal">id</code>, since there is no
                need to refer to it explicitly).
              </p></li><li class="listitem"><p>
                If the end of the command is signalled
                (<code class="literal">general</code> / <code class="literal">status</code>
                event), an entry is written to the audit log file and
                the filter is replaced with the <code class="literal">main</code>
                filter.
</p></li></ul>
</div>
<p>
            The filter is useful to log statements that update or delete
            anything from the <code class="literal">temp_1</code> or
            <code class="literal">temp_2</code> tables, such as this one:
          </p><pre data-lang="sql" class="programlisting">
UPDATE temp_1, temp_3 SET temp_1.a=21, temp_3.a=23;
</pre><p>
            The statement generates multiple
            <code class="literal">table_access</code> events, but the audit log
            file will contain only <code class="literal">general</code> /
            <code class="literal">status</code> entries.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              Any <code class="literal">id</code> values used in the definition
              are evaluated with respect only to that definition. They
              have nothing to do with the value of the
              <a class="link" href="security.html#sysvar_audit_log_filter_id"><code class="literal">audit_log_filter_id</code></a>
              system variable.
</p>
</div>

</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-legacy-filtering"></a>6.4.5.7 Legacy Mode Audit Log Filtering</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091712836272"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          This section describes legacy audit log filtering, which
          applies if the <code class="literal">audit_log</code> plugin is
          installed but not the accompanying audit tables and UDFs
          needed for rule-based filtering.
</p>
</div>
<p>
        The audit log plugin can filter audited events. This enables you
        to control whether audited events are written to the audit log
        file based on the account from which events originate or event
        status. Status filtering occurs separately for connection events
        and statement events.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-log-account-filtering" title="Event Filtering by Account">Event Filtering by Account</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-log-status-filtering" title="Event Filtering by Status">Event Filtering by Status</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="audit-log-account-filtering"></a>Event Filtering by Account</h5>

</div>

</div>

</div>
<p>
          To filter audited events based on the originating account, set
          one of these system variables at server startup or runtime:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>:
              The accounts to include in audit logging. If this variable
              is set, only these accounts are audited.
            </p></li><li class="listitem"><p>
              <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>:
              The accounts to exclude from audit logging. If this
              variable is set, all but these accounts are audited.
</p></li></ul>
</div>
<p>
          The value for either variable can be <code class="literal">NULL</code>
          or a string containing one or more comma-separated account
          names, each in
          <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
          format. By default, both variables are
          <code class="literal">NULL</code>, in which case, no account filtering
          is done and auditing occurs for all accounts.
        </p><p>
          Modifications to
          <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a> or
          <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
          affect only connections created subsequent to the
          modification, not existing connections.
        </p><p>
          Example: To enable audit logging only for the
          <code class="literal">user1</code> and <code class="literal">user2</code> local
          host account accounts, set the
          <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
          system variable like this:
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL audit_log_include_accounts = 'user1@localhost,user2@localhost';
</pre><p>
          Only one of
          <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a> or
          <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
          can be non-<code class="literal">NULL</code> at a time:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If you set
              <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>,
              the server sets
              <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
              to <code class="literal">NULL</code>.
            </p></li><li class="listitem"><p>
              If you attempt to set
              <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>,
              an error occurs unless
              <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
              is <code class="literal">NULL</code>. In this case, you must first
              clear
              <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
              by setting it to <code class="literal">NULL</code>.
</p></li></ul>
</div>
<pre data-lang="sql" class="programlisting">
-- This sets audit_log_exclude_accounts to NULL
SET GLOBAL audit_log_include_accounts = <em class="replaceable"><code>value</code></em>;

-- This fails because audit_log_include_accounts is not NULL
SET GLOBAL audit_log_exclude_accounts = <em class="replaceable"><code>value</code></em>;

-- To set audit_log_exclude_accounts, first set
-- audit_log_include_accounts to NULL
SET GLOBAL audit_log_include_accounts = NULL;
SET GLOBAL audit_log_exclude_accounts = <em class="replaceable"><code>value</code></em>;
</pre><p>
          If you inspect the value of either variable, be aware that
          <a class="link" href="sql-syntax.html#show-variables" title="13.7.6.39 SHOW VARIABLES Syntax"><code class="literal">SHOW VARIABLES</code></a> displays
          <code class="literal">NULL</code> as an empty string. To avoid this, use
          <a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT Syntax"><code class="literal">SELECT</code></a> instead:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'audit_log_include_accounts';</code></strong>
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
| audit_log_include_accounts |       |
+----------------------------+-------+
mysql&gt; <strong class="userinput"><code>SELECT @@audit_log_include_accounts;</code></strong>
+------------------------------+
| @@audit_log_include_accounts |
+------------------------------+
| NULL                         |
+------------------------------+
</pre><p>
          If a user name or host name requires quoting because it
          contains a comma, space, or other special character, quote it
          using single quotes. If the variable value itself is quoted
          with single quotes, double each inner single quote or escape
          it with a backslash. The following statements each enable
          audit logging for the local <code class="literal">root</code> account
          and are equivalent, even though the quoting styles differ:
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL audit_log_include_accounts = 'root@localhost';
SET GLOBAL audit_log_include_accounts = '''root''@''localhost''';
SET GLOBAL audit_log_include_accounts = '\'root\'@\'localhost\'';
SET GLOBAL audit_log_include_accounts = "'root'@'localhost'";
</pre><p>
          The last statement will not work if the
          <code class="literal">ANSI_QUOTES</code> SQL mode is enabled because in
          that mode double quotes signify identifier quoting, not string
          quoting.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="audit-log-status-filtering"></a>Event Filtering by Status</h5>

</div>

</div>

</div>
<p>
          To filter audited events based on status, set the following
          system variables at server startup or runtime. These variables
          apply only for legacy audit log filtering. For JSON audit log
          filtering, different status variables apply; see
          <a class="xref" href="security.html#audit-log-options-variables" title="6.4.5.8.4 Audit Log Options and Variables">Section 6.4.5.8.4, “Audit Log Options and Variables”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>:
              Logging policy for connection events
            </p></li><li class="listitem"><p>
              <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>:
              Logging policy for statement events
</p></li></ul>
</div>
<p>
          Each variable takes a value of <code class="literal">ALL</code> (log all
          associated events; this is the default),
          <code class="literal">ERRORS</code> (log only failed events), or
          <code class="literal">NONE</code> (do not log events). For example, to
          log all statement events but only failed connection events,
          use these settings:
        </p><pre data-lang="sql" class="programlisting">
SET GLOBAL audit_log_statement_policy = ALL;
SET GLOBAL audit_log_connection_policy = ERRORS;
</pre><p>
          Another policy system variable,
          <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a>, is
          available but does not afford as much control as
          <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
          and
          <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>.
          It can be set only at server startup. At runtime, it is a
          read-only variable. It takes a value of <code class="literal">ALL</code>
          (log all events; this is the default),
          <code class="literal">LOGINS</code> (log connection events),
          <code class="literal">QUERIES</code> (log statement events), or
          <code class="literal">NONE</code> (do not log events). For any of those
          values, the audit log plugin logs all selected events without
          distinction as to success or failure. Use of
          <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> at startup
          works as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              If you do not set
              <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> or set
              it to its default of <code class="literal">ALL</code>, any explicit
              settings for
              <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
              or
              <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
              apply as specified. If not specified, they default to
              <code class="literal">ALL</code>.
            </p></li><li class="listitem"><p>
              If you set
              <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> to a
              non-<code class="literal">ALL</code> value, that value takes
              precedence over and is used to set
              <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
              and
              <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>,
              as indicated in the following table. If you also set
              either of those variables to a value other than their
              default of <code class="literal">ALL</code>, the server writes a
              message to the error log to indicate that their values are
              being overridden.
</p>
<div class="informaltable">
<table summary="How the server uses audit_log_policy to set audit_log_connection_policy and audit_log_statement_policy at startup."><col width="33%"><col width="33%"><col width="33%"><thead><tr>
                  <th scope="col">Startup audit_log_policy Value</th>
                  <th scope="col">Resulting audit_log_connection_policy Value</th>
                  <th scope="col">Resulting audit_log_statement_policy Value</th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">LOGINS</code></td>
                  <td><code class="literal">ALL</code></td>
                  <td><code class="literal">NONE</code></td>
                </tr><tr>
                  <td scope="row"><code class="literal">QUERIES</code></td>
                  <td><code class="literal">NONE</code></td>
                  <td><code class="literal">ALL</code></td>
                </tr><tr>
                  <td scope="row"><code class="literal">NONE</code></td>
                  <td><code class="literal">NONE</code></td>
                  <td><code class="literal">NONE</code></td>
</tr></tbody></table>
</div>
</li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-reference"></a>6.4.5.8 Audit Log Reference</h4>

</div>

</div>

</div>
<p>
        The following discussion serves as a reference to MySQL Enterprise Audit
        components:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="xref" href="security.html#audit-log-tables" title="6.4.5.8.1 Audit Log Tables">Section 6.4.5.8.1, “Audit Log Tables”</a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="security.html#audit-log-routines" title="6.4.5.8.2 Audit Log Functions">Section 6.4.5.8.2, “Audit Log Functions”</a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="security.html#audit-log-option-variable-reference" title="6.4.5.8.3 Audit Log Option and Variable Reference">Section 6.4.5.8.3, “Audit Log Option and Variable Reference”</a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="security.html#audit-log-options-variables" title="6.4.5.8.4 Audit Log Options and Variables">Section 6.4.5.8.4, “Audit Log Options and Variables”</a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="security.html#audit-log-status-variables" title="6.4.5.8.5 Audit Log Status Variables">Section 6.4.5.8.5, “Audit Log Status Variables”</a>
</p></li></ul>
</div>
<p>
        To install the audit log tables and functions, use the
        instructions provided in
        <a class="xref" href="security.html#audit-log-installation" title="6.4.5.2 Installing or Uninstalling MySQL Enterprise Audit">Section 6.4.5.2, “Installing or Uninstalling MySQL Enterprise Audit”</a>. Unless those
        components are installed, the <code class="literal">audit_log</code>
        plugin operates in legacy mode. See
        <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.7 Legacy Mode Audit Log Filtering">Section 6.4.5.7, “Legacy Mode Audit Log Filtering”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-tables"></a>6.4.5.8.1 Audit Log Tables</h5>
</div>
</div>
</div>
<p>
          MySQL Enterprise Audit uses tables in the <code class="literal">mysql</code> system
          database for persistent storage of filter and user account
          data. The tables can be accessed only by users with privileges
          for that database. The tables use the
          <code class="literal">InnoDB</code> storage engine.
        </p><p>
          If these tables are missing, the <code class="literal">audit_log</code>
          plugin operates in legacy mode. See
          <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.7 Legacy Mode Audit Log Filtering">Section 6.4.5.7, “Legacy Mode Audit Log Filtering”</a>.
        </p><p>
          The <code class="literal">audit_log_filter</code> table stores filter
          definitions. The table has these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">NAME</code>
            </p><p>
              The filter name.
            </p></li><li class="listitem"><p>
              <code class="literal">FILTER</code>
            </p><p>
              The filter definition associated with the filter name.
              Definitions are stored as
              <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> values.
</p></li></ul>
</div>
<p>
          The <code class="literal">audit_log_user</code> table stores user
          account information. The table has these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">USER</code>
            </p><p>
              The user name part of an account. For an account
              <code class="literal">user1@localhost</code>, the
              <code class="literal">USER</code> part is <code class="literal">user1</code>.
            </p></li><li class="listitem"><p>
              <code class="literal">HOST</code>
            </p><p>
              The host name part of an account. For an account
              <code class="literal">user1@localhost</code>, the
              <code class="literal">HOST</code> part is
              <code class="literal">localhost</code>.
            </p></li><li class="listitem"><p>
              <code class="literal">FILTERNAME</code>
            </p><p>
              The name of the filter assigned to the account. The filter
              name associates the account with a filter defined in the
              <code class="literal">audit_log_filter</code> table.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-routines"></a>6.4.5.8.2 Audit Log Functions</h5>

</div>

</div>

</div>
<p>
          This section describes, for each audit log user-defined
          function (UDF), its purpose, calling sequence, and return
          value. For information about the conditions under which these
          UDFs can be invoked, see
          <a class="xref" href="security.html#audit-log-filtering" title="6.4.5.6 Audit Log Filtering">Section 6.4.5.6, “Audit Log Filtering”</a>.
        </p><p>
          Each audit log UDF returns a string that indicates whether the
          operation succeeded. <code class="literal">OK</code> indicates success.
          <code class="literal">ERROR: <em class="replaceable"><code>message</code></em></code>
          indicates failure.
        </p><p>
          These audit log UDFs are available:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="udf_audit-log-encryption-password-get"></a>
              <a class="link" href="security.html#udf_audit-log-encryption-password-get"><code class="literal">audit_log_encryption_password_get()</code></a>
            </p><a class="indexterm" name="idm140091712686960"></a><a class="indexterm" name="idm140091712685840"></a><p>
              Retrieves the current audit log encryption password as a
              binary string. The password is fetched from the MySQL
              keyring, which must be enabled or an error occurs. Any
              keyring plugin can be used; for instructions, see
              <a class="xref" href="security.html#keyring" title="6.4.4 The MySQL Keyring">Section 6.4.4, “The MySQL Keyring”</a>.
            </p><p>
              For additional information about audit log encryption, see
              <a class="xref" href="security.html#audit-log-file-encryption" title="Audit Log File Encryption">Audit Log File Encryption</a>.
            </p><p>
              Arguments:
            </p><p>
              None.
            </p><p>
              Return value:
            </p><p>
              The password string for success (up to 766 bytes), or
              <code class="literal">NULL</code> and an error for failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT audit_log_encryption_password_get();</code></strong>
+-------------------------------------+
| audit_log_encryption_password_get() |
+-------------------------------------+
| secret                              |
+-------------------------------------+
</pre></li><li class="listitem"><p><a name="udf_audit-log-encryption-password-set"></a>
              <a class="link" href="security.html#udf_audit-log-encryption-password-set"><code class="literal">audit_log_encryption_password_set(<em class="replaceable"><code>password</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091712674096"></a><a class="indexterm" name="idm140091712672976"></a><p>
              Sets the audit log encryption password to the argument,
              stores the password in the MySQL keyring. If encryption is
              enabled, the function performs a log file rotation
              operation that renames the current log file, and begins a
              new log file encrypted with the password. The keyring must
              be enabled or an error occurs. Any keyring plugin can be
              used; for instructions, see <a class="xref" href="security.html#keyring" title="6.4.4 The MySQL Keyring">Section 6.4.4, “The MySQL Keyring”</a>.
            </p><p>
              For additional information about audit log encryption, see
              <a class="xref" href="security.html#audit-log-file-encryption" title="Audit Log File Encryption">Audit Log File Encryption</a>.
            </p><p>
              Arguments:
            </p><p>
              <em class="replaceable"><code>password</code></em>: The password string.
              The maximum permitted length is 766 bytes.
            </p><p>
              Return value:
            </p><p>
              1 for success, 0 for failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT audit_log_encryption_password_set(<em class="replaceable"><code>password</code></em>);</code></strong>
+---------------------------------------------+
| audit_log_encryption_password_set(<em class="replaceable"><code>password</code></em>) |
+---------------------------------------------+
| 1                                           |
+---------------------------------------------+
</pre></li><li class="listitem"><p><a name="udf_audit-log-filter-flush"></a>
              <a class="link" href="security.html#udf_audit-log-filter-flush"><code class="literal">audit_log_filter_flush()</code></a>
            </p><a class="indexterm" name="idm140091712660816"></a><a class="indexterm" name="idm140091712659712"></a><p>
              Calling any of the other filtering UDFs affects
              operational audit log filtering immediately and updates
              the audit log tables. If instead you modify the contents
              of those tables directly using statements such as
              <a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT Syntax"><code class="literal">INSERT</code></a>,
              <a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
              <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a>, the changes do not
              affect filtering immediately. To flush your changes and
              make them operational, call
              <a class="link" href="security.html#udf_audit-log-filter-flush"><code class="literal">audit_log_filter_flush()</code></a>.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
                <a class="link" href="security.html#udf_audit-log-filter-flush"><code class="literal">audit_log_filter_flush()</code></a>
                should be used only after modifying the audit tables
                directly, to force reloading all filters. Otherwise,
                this function should be avoided. It is, in effect, a
                simplified version of unloading and reloading the
                <code class="literal">audit_log</code> plugin with
                <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a> plus
                <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>.
              </p><p>
                <a class="link" href="security.html#udf_audit-log-filter-flush"><code class="literal">audit_log_filter_flush()</code></a>
                affects all current sessions and detaches them from
                their previous filters. Current sessions are no longer
                logged unless they disconnect and reconnect, or execute
                a change-user operation.
</p>
</div>
<p>
              If this function fails, an error message is returned and
              the audit log is disabled until the next successful call
              to <a class="link" href="security.html#udf_audit-log-filter-flush"><code class="literal">audit_log_filter_flush()</code></a>.
            </p><p>
              Arguments:
            </p><p>
              None.
            </p><p>
              Return value:
            </p><p>
              A string that indicates whether the operation succeeded.
              <code class="literal">OK</code> indicates success. <code class="literal">ERROR:
              <em class="replaceable"><code>message</code></em></code> indicates
              failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT audit_log_filter_flush();</code></strong>
+--------------------------+
| audit_log_filter_flush() |
+--------------------------+
| OK                       |
+--------------------------+
</pre></li><li class="listitem"><p><a name="udf_audit-log-filter-remove-filter"></a>
              <a class="link" href="security.html#udf_audit-log-filter-remove-filter"><code class="literal">audit_log_filter_remove_filter(<em class="replaceable"><code>filter_name</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091712634544"></a><a class="indexterm" name="idm140091712633424"></a><p>
              Given a filter name, removes the filter from the current
              set of filters. It is not an error for the filter not to
              exist.
            </p><p>
              If a removed filter is assigned to any user accounts,
              those users stop being filtered (they are removed from the
              <code class="literal">audit_log_user</code> table). Termination of
              filtering includes any current sessions for those users:
              They are detached from the filter and no longer logged.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>filter_name</code></em>: A string that
                  specifies the filter name.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              A string that indicates whether the operation succeeded.
              <code class="literal">OK</code> indicates success. <code class="literal">ERROR:
              <em class="replaceable"><code>message</code></em></code> indicates
              failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT audit_log_filter_remove_filter('SomeFilter');</code></strong>
+----------------------------------------------+
| audit_log_filter_remove_filter('SomeFilter') |
+----------------------------------------------+
| OK                                           |
+----------------------------------------------+
</pre></li><li class="listitem"><p><a name="udf_audit-log-filter-remove-user"></a>
              <a class="link" href="security.html#udf_audit-log-filter-remove-user"><code class="literal">audit_log_filter_remove_user(<em class="replaceable"><code>user_name</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091712619968"></a><a class="indexterm" name="idm140091712618864"></a><p>
              Given a user account name, cause the user to be no longer
              assigned to a filter. It is not an error if the user has
              no filter assigned. Filtering of current sessions for the
              user remains unaffected. New connections for the user are
              filtered using the default account filter if there is one,
              and are not logged otherwise.
            </p><p>
              If the name is <code class="literal">%</code>, the function removes
              the default account filter that is used for any user
              account that has no explicitly assigned filter.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>user_name</code></em>: The user account
                  name as a string in
                  <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
                  format, or <code class="literal">%</code> to represent the
                  default account.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              A string that indicates whether the operation succeeded.
              <code class="literal">OK</code> indicates success. <code class="literal">ERROR:
              <em class="replaceable"><code>message</code></em></code> indicates
              failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT audit_log_filter_remove_user('user1@localhost');</code></strong>
+-------------------------------------------------+
| audit_log_filter_remove_user('user1@localhost') |
+-------------------------------------------------+
| OK                                              |
+-------------------------------------------------+
</pre></li><li class="listitem"><p><a name="udf_audit-log-filter-set-filter"></a>
              <a class="link" href="security.html#udf_audit-log-filter-set-filter"><code class="literal">audit_log_filter_set_filter(<em class="replaceable"><code>filter_name</code></em>,
              <em class="replaceable"><code>definition</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091712602800"></a><a class="indexterm" name="idm140091712601696"></a><p>
              Given a filter name and definition, adds the filter to the
              current set of filters. If the filter already exists and
              is used by any current sessions, those sessions are
              detached from the filter and are no longer logged. This
              occurs because the new filter definition has a new filter
              ID that differs from its previous ID.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>filter_name</code></em>: A string that
                  specifies the filter name.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>definition</code></em>: A
                  <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> value that
                  specifies the filter definition.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              A string that indicates whether the operation succeeded.
              <code class="literal">OK</code> indicates success. <code class="literal">ERROR:
              <em class="replaceable"><code>message</code></em></code> indicates
              failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET @f = '{ "filter": { "log": false } }';</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT audit_log_filter_set_filter('SomeFilter', @f);</code></strong>
+-----------------------------------------------+
| audit_log_filter_set_filter('SomeFilter', @f) |
+-----------------------------------------------+
| OK                                            |
+-----------------------------------------------+
</pre></li><li class="listitem"><p><a name="udf_audit-log-filter-set-user"></a>
              <a class="link" href="security.html#udf_audit-log-filter-set-user"><code class="literal">audit_log_filter_set_user(<em class="replaceable"><code>user_name</code></em>,
              <em class="replaceable"><code>filter_name</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091712585712"></a><a class="indexterm" name="idm140091712584608"></a><p>
              Given a user account name and a filter name, assigns the
              filter to the user. A user can be assigned only one
              filter, so if the user was already assigned a filter, the
              assignment is replaced. Filtering of current sessions for
              the user remains unaffected. New connections are filtered
              using the new filter.
            </p><p>
              As a special case, the name <code class="literal">%</code>
              represents the default account. The filter is used for
              connections from any user account that has no explicitly
              assigned filter.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>user_name</code></em>: The user account
                  name as a string in
                  <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
                  format, or <code class="literal">%</code> to represent the
                  default account.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>filter_name</code></em>: A string that
                  specifies the filter name.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              A string that indicates whether the operation succeeded.
              <code class="literal">OK</code> indicates success. <code class="literal">ERROR:
              <em class="replaceable"><code>message</code></em></code> indicates
              failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT audit_log_filter_set_user('user1@localhost', 'SomeFilter');</code></strong>
+------------------------------------------------------------+
| audit_log_filter_set_user('user1@localhost', 'SomeFilter') |
+------------------------------------------------------------+
| OK                                                         |
+------------------------------------------------------------+
</pre></li><li class="listitem"><p><a name="udf_audit-log-read"></a>
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read([<em class="replaceable"><code>arg</code></em>])</code></a>
            </p><a class="indexterm" name="idm140091712567664"></a><a class="indexterm" name="idm140091712566560"></a><p>
              Reads events from the audit log and returns a binary
              <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> string containing an
              array of audit events. If the audit log format is not
              <code class="literal">JSON</code>, an error occurs.
            </p><p>
              Each event in the return value is a
              <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> hash, except that the
              last array element may be a
              <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a>
              <code class="literal">null</code> value to indicate no following
              events are available to read.
            </p><p>
              For the first call to
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> within a
              session, pass a bookmark indicating where to begin
              reading. If the final value of the returned array is not a
              <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a>
              <code class="literal">null</code> value, there are more events
              following those just read and
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> can be
              called without or with a bookmark argument. Without an
              argument, reading continues with the next unread event.
              With a bookmark argument, reading continues from the
              bookmark.
            </p><p>
              If the final value of the returned array is a
              <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a>
              <code class="literal">null</code> value, there are no more events
              left to be read and the next call to
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> must
              include a bookmark argument.
            </p><p>
              To obtain a bookmark for the most recently written event,
              call
              <a class="link" href="security.html#udf_audit-log-read-bookmark"><code class="literal">audit_log_read_bookmark()</code></a>.
            </p><p>
              For additional information about audit log-reading
              functions, see <a class="xref" href="security.html#audit-log-file-reading" title="Audit Log File Reading">Audit Log File Reading</a>.
            </p><p>
              Arguments:
            </p><p>
              <em class="replaceable"><code>arg</code></em>: An optional bookmark,
              represented as a string containing a
              <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> hash that indicates
              where and how much to read. The following items are
              significant in the <code class="literal">arg</code> value (other
              items are ignored):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">timestamp</code>, <code class="literal">id</code>:
                  The location within the audit log of the first event
                  to read. Both items must be present to completely
                  specify a position.
                </p></li><li class="listitem"><p>
                  <code class="literal">max_array_length</code>: The maximum
                  number of events to read from the log. If omitted, the
                  default is to read to the end of the log or until the
                  read buffer is full, whichever comes first.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              A binary <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> string
              containing an array of audit events for success, or
              <code class="literal">NULL</code> and an error for failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT audit_log_read(audit_log_read_bookmark());</code></strong>
+-----------------------------------------------------------------------+
| audit_log_read(audit_log_read_bookmark())                             |
+-----------------------------------------------------------------------+
| [ {"timestamp":"2018-01-15 22:41:24","id":0,"class":"connection", ... |
+-----------------------------------------------------------------------+
</pre></li><li class="listitem"><p><a name="udf_audit-log-read-bookmark"></a>
              <a class="link" href="security.html#udf_audit-log-read-bookmark"><code class="literal">audit_log_read_bookmark()</code></a>
            </p><a class="indexterm" name="idm140091712531056"></a><a class="indexterm" name="idm140091712529952"></a><p>
              Returns a binary <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a>
              string representing a bookmark for the most recently
              written audit log event. If the audit log format is not
              <code class="literal">JSON</code>, an error occurs.
            </p><p>
              The bookmark is a <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> hash
              with <code class="literal">timestamp</code> and
              <code class="literal">id</code> items indicating the event position
              within the audit log. It is suitable for passing to
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a> to indicate
              to that function where to begin reading.
            </p><p>
              For additional information about audit log-reading
              functions, see <a class="xref" href="security.html#audit-log-file-reading" title="Audit Log File Reading">Audit Log File Reading</a>.
            </p><p>
              Arguments:
            </p><p>
              None.
            </p><p>
              Return value:
            </p><p>
              A binary <a class="link" href="data-types.html#json" title="11.6 The JSON Data Type"><code class="literal">JSON</code></a> string
              containing a bookmark for success, or
              <code class="literal">NULL</code> and an error for failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT audit_log_read_bookmark();</code></strong>
+-------------------------------------------------+
| audit_log_read_bookmark()                       |
+-------------------------------------------------+
| { "timestamp": "2018-01-15 21:03:44", "id": 0 } |
+-------------------------------------------------+
</pre></li></ul>
</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-option-variable-reference"></a>6.4.5.8.3 Audit Log Option and Variable Reference</h5>

</div>

</div>

</div>

<div class="table">
<a name="idm140091712512592"></a><p class="title"><b>Table 6.36 Audit Log Option and Variable Reference</b></p>
<div class="table-contents">
<table frame="box" rules="all" summary="Reference for audit log command-line options, system variables, and status variables."><col width="20%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><col width="15%"><thead><tr><th scope="col">Name</th>
<th scope="col">Cmd-Line</th>
<th scope="col">Option File</th>
<th scope="col">System Var</th>
<th scope="col">Status Var</th>
<th scope="col">Var Scope</th>
<th scope="col">Dynamic</th>
</tr></thead><tbody><tr><td scope="row"><a class="link" href="security.html#option_mysqld_audit-log">audit-log</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_buffer_size">audit_log_buffer_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_compression">audit_log_compression</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_connection_policy">audit_log_connection_policy</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_current_session">audit_log_current_session</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Both</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_current_size">Audit_log_current_size</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_encryption">audit_log_encryption</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_event_max_drop_size">Audit_log_event_max_drop_size</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events">Audit_log_events</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events_filtered">Audit_log_events_filtered</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events_lost">Audit_log_events_lost</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_events_written">Audit_log_events_written</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_exclude_accounts">audit_log_exclude_accounts</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_file">audit_log_file</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_filter_id">audit_log_filter_id</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Both</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_flush">audit_log_flush</a></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_format">audit_log_format</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_include_accounts">audit_log_include_accounts</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_policy">audit_log_policy</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_read_buffer_size">audit_log_read_buffer_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Varies</td>
<td>Varies</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_rotate_on_size">audit_log_rotate_on_size</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_statement_policy">audit_log_statement_policy</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>Yes</td>
</tr><tr><td scope="row"><a class="link" href="security.html#sysvar_audit_log_strategy">audit_log_strategy</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_total_size">Audit_log_total_size</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr><tr><td scope="row"><a class="link" href="security.html#statvar_Audit_log_write_waits">Audit_log_write_waits</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Global</td>
<td>No</td>
</tr></tbody></table>
</div>

</div>
<br class="table-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-options-variables"></a>6.4.5.8.4 Audit Log Options and Variables</h5>

</div>

</div>

</div>
<p>
          This section describes the command options and system
          variables that configure operation of MySQL Enterprise Audit. If values
          specified at startup time are incorrect, the
          <code class="literal">audit_log</code> plugin may fail to initialize
          properly and the server does not load it. In this case, the
          server may also produce error messages for other audit log
          settings because it will not recognize them.
        </p><p>
          To configure activation of the audit log plugin, use this
          option:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_audit-log"></a>
              <a class="indexterm" name="idm140091712319856"></a>

              <a class="indexterm" name="idm140091712318400"></a>

              <a class="link" href="security.html#option_mysqld_audit-log"><code class="option">--audit-log[=<em class="replaceable"><code>value</code></em>]</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit-log"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log[=value]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">ON</code></p><p class="valid-value"><code class="literal">OFF</code></p><p class="valid-value"><code class="literal">FORCE</code></p><p class="valid-value"><code class="literal">FORCE_PLUS_PERMANENT</code></p></td>
</tr></tbody></table>
</div>
<p>
              This option controls how the server loads the
              <code class="literal">audit_log</code> plugin at startup. It is
              available only if the plugin has been previously
              registered with <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL
              PLUGIN</code></a> or is loaded with
              <a class="link" href="server-administration.html#option_mysqld_plugin-load"><code class="option">--plugin-load</code></a> or
              <a class="link" href="server-administration.html#option_mysqld_plugin-load-add"><code class="option">--plugin-load-add</code></a>. See
              <a class="xref" href="security.html#audit-log-installation" title="6.4.5.2 Installing or Uninstalling MySQL Enterprise Audit">Section 6.4.5.2, “Installing or Uninstalling MySQL Enterprise Audit”</a>.
            </p><p>
              The option value should be one of those available for
              plugin-loading options, as described in
              <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>. For example,
              <a class="link" href="security.html#option_mysqld_audit-log"><code class="option">--audit-log=FORCE_PLUS_PERMANENT</code></a>
              tells the server to load the plugin and prevent it from
              being removed while the server is running.
</p></li></ul>
</div>
<p>
          If the audit log plugin is enabled, it exposes several system
          variables that permit control over logging:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW VARIABLES LIKE 'audit_log%';</code></strong>
+-----------------------------+--------------+
| Variable_name               | Value        |
+-----------------------------+--------------+
| audit_log_buffer_size       | 1048576      |
| audit_log_connection_policy | ALL          |
| audit_log_current_session   | OFF          |
| audit_log_exclude_accounts  |              |
| audit_log_file              | audit.log    |
| audit_log_filter_id         | 0            |
| audit_log_flush             | OFF          |
| audit_log_format            | NEW          |
| audit_log_include_accounts  |              |
| audit_log_policy            | ALL          |
| audit_log_rotate_on_size    | 0            |
| audit_log_statement_policy  | ALL          |
| audit_log_strategy          | ASYNCHRONOUS |
+-----------------------------+--------------+
</pre><p>
          You can set any of these variables at server startup, and some
          of them at runtime. Those that are available only for legacy
          mode audit log filtering are so noted.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_audit_log_buffer_size"></a>
              <a class="indexterm" name="idm140091712279088"></a>

              <a class="indexterm" name="idm140091712278048"></a>

              <a class="link" href="security.html#sysvar_audit_log_buffer_size"><code class="literal">audit_log_buffer_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_buffer_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-buffer-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_buffer_size">audit_log_buffer_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">1048576</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span></td>
<td><code class="literal">4096</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (64-bit platforms)</td>
<td><code class="literal">18446744073709547520</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span> (32-bit platforms)</td>
<td><code class="literal">4294967295</code></td>
</tr></tbody></table>
</div>
<p>
              When the audit log plugin writes events to the log
              asynchronously, it uses a buffer to store event contents
              prior to writing them. This variable controls the size of
              that buffer, in bytes. The server adjusts the value to a
              multiple of 4096. The plugin uses a single buffer, which
              it allocates when it initializes and removes when it
              terminates. The plugin allocates this buffer only if
              logging is asynchronous.
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_compression"></a>
              <a class="link" href="security.html#sysvar_audit_log_compression"><code class="literal">audit_log_compression</code></a>
</p><a class="indexterm" name="idm140091712231968"></a><a class="indexterm" name="idm140091712230928"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_compression"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-compression=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_compression">audit_log_compression</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NONE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">NONE</code></p><p class="valid-value"><code class="literal">GZIP</code></p></td>
</tr></tbody></table>
</div>
<p>
              The type of compression for the audit log file. Permitted
              values are <code class="literal">NONE</code> (no compression; the
              default) and <code class="literal">GZIP</code> (GNU Zip
              compression). For more information, see
              <a class="xref" href="security.html#audit-log-file-compression" title="Audit Log File Compression">Audit Log File Compression</a>.
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_connection_policy"></a>
              <a class="indexterm" name="idm140091712190976"></a>

              <a class="indexterm" name="idm140091712189872"></a>

              <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_connection_policy"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-connection-policy=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_connection_policy">audit_log_connection_policy</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ALL</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">ALL</code></p><p class="valid-value"><code class="literal">ERRORS</code></p><p class="valid-value"><code class="literal">NONE</code></p></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
                This variable applies only to legacy mode audit log
                filtering (see
                <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.7 Legacy Mode Audit Log Filtering">Section 6.4.5.7, “Legacy Mode Audit Log Filtering”</a>).
</p>
</div>
<p>
              The policy controlling how the audit log plugin writes
              connection events to its log file. The following table
              shows the permitted values.
</p>
<div class="informaltable">
<table summary="Permitted values for the audit_log_connection_policy variable."><col width="15%"><col width="85%"><thead><tr>
                  <th scope="col">Value</th>
                  <th scope="col">Description</th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">ALL</code></td>
                  <td>Log all connection events</td>
                </tr><tr>
                  <td scope="row"><code class="literal">ERRORS</code></td>
                  <td>Log only failed connection events</td>
                </tr><tr>
                  <td scope="row"><code class="literal">NONE</code></td>
                  <td>Do not log connection events</td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
                At server startup, any explicit value given for
                <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
                may be overridden if
                <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> is
                also specified, as described in
                <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 Audit Log Logging Configuration">Section 6.4.5.5, “Audit Log Logging Configuration”</a>.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_audit_log_current_session"></a>
              <a class="indexterm" name="idm140091712129968"></a>

              <a class="indexterm" name="idm140091712128864"></a>

              <a class="link" href="security.html#sysvar_audit_log_current_session"><code class="literal">audit_log_current_session</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_current_session"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_current_session">audit_log_current_session</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global, Session</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">depends on filtering policy</code></td>
</tr></tbody></table>
</div>
<p>
              Whether audit logging is enabled for the current session.
              The session value of this variable is read only. It is set
              when the session begins based on the values of the
              <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
              and
              <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
              system variables. The audit log plugin uses the session
              value to determine whether to audit events for the
              session. (There is a global value, but the plugin does not
              use it.)
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_encryption"></a>
              <a class="link" href="security.html#sysvar_audit_log_encryption"><code class="literal">audit_log_encryption</code></a>
</p><a class="indexterm" name="idm140091712092960"></a><a class="indexterm" name="idm140091712091920"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_encryption"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-encryption=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_encryption">audit_log_encryption</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NONE</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">NONE</code></p><p class="valid-value"><code class="literal">AES</code></p></td>
</tr></tbody></table>
</div>
<p>
              The type of encryption for the audit log file. Permitted
              values are <code class="literal">NONE</code> (no encryption; the
              default) and <code class="literal">AES</code> (AES-256-CBC cipher
              encryption). For more information, see
              <a class="xref" href="security.html#audit-log-file-encryption" title="Audit Log File Encryption">Audit Log File Encryption</a>.
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_exclude_accounts"></a>
              <a class="indexterm" name="idm140091712051952"></a>

              <a class="indexterm" name="idm140091712050848"></a>

              <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_exclude_accounts"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-exclude-accounts=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_exclude_accounts">audit_log_exclude_accounts</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
                This variable applies only to legacy mode audit log
                filtering (see
                <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.7 Legacy Mode Audit Log Filtering">Section 6.4.5.7, “Legacy Mode Audit Log Filtering”</a>).
</p>
</div>
<p>
              The accounts for which events should not be logged. The
              value should be <code class="literal">NULL</code> or a string
              containing a list of one or more comma-separated account
              names. For more information, see
              <a class="xref" href="security.html#audit-log-filtering" title="6.4.5.6 Audit Log Filtering">Section 6.4.5.6, “Audit Log Filtering”</a>.
            </p><p>
              Modifications to
              <a class="link" href="security.html#sysvar_audit_log_exclude_accounts"><code class="literal">audit_log_exclude_accounts</code></a>
              affect only connections created subsequent to the
              modification, not existing connections.
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_file"></a>
              <a class="indexterm" name="idm140091712011296"></a>

              <a class="indexterm" name="idm140091712010240"></a>

              <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_file"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-file=file_name</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_file">audit_log_file</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>File name</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">audit.log</code></td>
</tr></tbody></table>
</div>
<p>
              The base name and suffix of the file to which the audit
              log plugin writes events. The default value is
              <code class="filename">audit.log</code>, regardless of logging
              format. To have the name suffix correspond to the format,
              set the name explicitly, choosing a different suffix (for
              example, <code class="filename">audit.xml</code> for XML format,
              <code class="filename">audit.json</code> for JSON format).
            </p><p>
              If the value of
              <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> is a
              relative path name, the plugin interprets it relative to
              the data directory. If the value is a full path name, the
              plugin uses the value as is. A full path name may be
              useful if it is desirable to locate audit files on a
              separate file system or directory. For security reasons,
              write the audit log file to a directory accessible only to
              the MySQL server and to users with a legitimate reason to
              view the log.
            </p><p>
              For details about how the audit log plugin interprets the
              <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> value and
              the rules for file renaming that occurs at plugin
              initialization and termination, see
              <a class="xref" href="security.html#audit-log-file-name" title="Audit Log File Name">Audit Log File Name</a>.
            </p><p>
              The audit log plugin uses the directory containing the
              audit log file (determined from the
              <a class="link" href="security.html#sysvar_audit_log_file"><code class="literal">audit_log_file</code></a> value) as
              the location to search for readable audit log files. From
              these log files and the current file, the plugin
              constructs a list of the ones that are subject to use with
              the audit log bookmarking and reading functions. See
              <a class="xref" href="security.html#audit-log-file-reading" title="Audit Log File Reading">Audit Log File Reading</a>.
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_filter_id"></a>
              <a class="indexterm" name="idm140091711965760"></a>

              <a class="indexterm" name="idm140091711964720"></a>

              <a class="link" href="security.html#sysvar_audit_log_filter_id"><code class="literal">audit_log_filter_id</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_filter_id"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_filter_id">audit_log_filter_id</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global, Session</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr></tbody></table>
</div>
<p>
              The session value of this variable indicates the
              internally maintained ID of the audit filter for the
              current session. A value of 0 means that the session has
              no filter assigned.
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_flush"></a>
              <a class="indexterm" name="idm140091711935328"></a>

              <a class="indexterm" name="idm140091711934272"></a>

              <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_flush"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_flush">audit_log_flush</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
              When this variable is set to enabled (1 or
              <code class="literal">ON</code>), the audit log plugin closes and
              reopens its log file to flush it. (The value remains
              <code class="literal">OFF</code> so that you need not disable it
              explicitly before enabling it again to perform another
              flush.) Enabling this variable has no effect unless
              <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
              is 0. For more information, see
              <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 Audit Log Logging Configuration">Section 6.4.5.5, “Audit Log Logging Configuration”</a>.
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_format"></a>
              <a class="indexterm" name="idm140091711899136"></a>

              <a class="indexterm" name="idm140091711898128"></a>

              <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_format"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-format=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_format">audit_log_format</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NEW</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">OLD</code></p><p class="valid-value"><code class="literal">NEW</code></p><p class="valid-value"><code class="literal">JSON</code></p></td>
</tr></tbody></table>
</div>
<p>
              The audit log file format. Permitted values are
              <code class="literal">OLD</code> (old-style XML),
              <code class="literal">NEW</code> (new-style XML; the default), and
              <code class="literal">JSON</code>. For details about each format,
              see <a class="xref" href="security.html#audit-log-file-formats" title="6.4.5.4 Audit Log File Formats">Section 6.4.5.4, “Audit Log File Formats”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                For information about issues to consider when changing
                the log format, see
                <a class="xref" href="security.html#audit-log-file-format" title="Audit Log File Format">Audit Log File Format</a>.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_audit_log_include_accounts"></a>
              <a class="indexterm" name="idm140091711853728"></a>

              <a class="indexterm" name="idm140091711852624"></a>

              <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_include_accounts"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-include-accounts=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_include_accounts">audit_log_include_accounts</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>String</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">NULL</code></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
                This variable applies only to legacy mode audit log
                filtering (see
                <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.7 Legacy Mode Audit Log Filtering">Section 6.4.5.7, “Legacy Mode Audit Log Filtering”</a>).
</p>
</div>
<p>
              The accounts for which events should be logged. The value
              should be <code class="literal">NULL</code> or a string containing a
              list of one or more comma-separated account names. For
              more information, see
              <a class="xref" href="security.html#audit-log-filtering" title="6.4.5.6 Audit Log Filtering">Section 6.4.5.6, “Audit Log Filtering”</a>.
            </p><p>
              Modifications to
              <a class="link" href="security.html#sysvar_audit_log_include_accounts"><code class="literal">audit_log_include_accounts</code></a>
              affect only connections created subsequent to the
              modification, not existing connections.
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_policy"></a>
              <a class="indexterm" name="idm140091711813008"></a>

              <a class="indexterm" name="idm140091711811952"></a>

              <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_policy"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-policy=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_policy">audit_log_policy</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ALL</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">ALL</code></p><p class="valid-value"><code class="literal">LOGINS</code></p><p class="valid-value"><code class="literal">QUERIES</code></p><p class="valid-value"><code class="literal">NONE</code></p></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
                This variable applies only to legacy mode audit log
                filtering (see
                <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.7 Legacy Mode Audit Log Filtering">Section 6.4.5.7, “Legacy Mode Audit Log Filtering”</a>).
</p>
</div>
<p>
              The policy controlling how the audit log plugin writes
              events to its log file. The following table shows the
              permitted values.
</p>
<div class="informaltable">
<table summary="Permitted values for the audit_log_policy variable."><col width="15%"><col width="85%"><thead><tr>
                  <th scope="col">Value</th>
                  <th scope="col">Description</th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">ALL</code></td>
                  <td>Log all events</td>
                </tr><tr>
                  <td scope="row"><code class="literal">LOGINS</code></td>
                  <td>Log only login events</td>
                </tr><tr>
                  <td scope="row"><code class="literal">QUERIES</code></td>
                  <td>Log only query events</td>
                </tr><tr>
                  <td scope="row"><code class="literal">NONE</code></td>
                  <td>Log nothing (disable the audit stream)</td>
</tr></tbody></table>
</div>
<p>
              <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> can be
              set only at server startup. At runtime, it is a read-only
              variable. Two other system variables,
              <a class="link" href="security.html#sysvar_audit_log_connection_policy"><code class="literal">audit_log_connection_policy</code></a>
              and
              <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>,
              provide finer control over logging policy and can be set
              either at startup or at runtime. If you use
              <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> at
              startup instead of the other two variables, the server
              uses its value to set those variables. For more
              information about the policy variables and their
              interaction, see
              <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 Audit Log Logging Configuration">Section 6.4.5.5, “Audit Log Logging Configuration”</a>.
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_read_buffer_size"></a>
              <a class="link" href="security.html#sysvar_audit_log_read_buffer_size"><code class="literal">audit_log_read_buffer_size</code></a>
</p><a class="indexterm" name="idm140091711744560"></a><a class="indexterm" name="idm140091711743456"></a>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_read_buffer_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-read-buffer-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span> (&gt;= 8.0.11)</td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_read_buffer_size">audit_log_read_buffer_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span> (&gt;= 8.0.12)</td>
<td>Global, Session</td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span> (8.0.11)</td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span> (&gt;= 8.0.12)</td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span> (8.0.11)</td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span> (&gt;= 8.0.11)</td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (&gt;= 8.0.12)</td>
<td><code class="literal">32768</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span> (8.0.11)</td>
<td><code class="literal">1048576</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span> (&gt;= 8.0.12)</td>
<td><code class="literal">32768</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Minimum Value</strong></span> (8.0.11)</td>
<td><code class="literal">1024</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Maximum Value</strong></span></td>
<td><code class="literal">4194304</code></td>
</tr></tbody></table>
</div>
<p>
              The buffer size for reading from the audit log file, in
              bytes. The <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a>
              function reads no more than this many bytes. Log file
              reading is supported only for JSON log format. For more
              information, see <a class="xref" href="security.html#audit-log-file-reading" title="Audit Log File Reading">Audit Log File Reading</a>.
            </p><p>
              As of MySQL 8.0.12, this variable has a default of 32KB
              and can be set at runtime. Each client should set its
              session value of
              <a class="link" href="security.html#sysvar_audit_log_read_buffer_size"><code class="literal">audit_log_read_buffer_size</code></a>
              appropriately for its use of
              <a class="link" href="security.html#udf_audit-log-read"><code class="literal">audit_log_read()</code></a>. Prior to
              MySQL 8.0.12,
              <a class="link" href="security.html#sysvar_audit_log_read_buffer_size"><code class="literal">audit_log_read_buffer_size</code></a>
              has a default of 1MB, affects all clients, and can be
              changed only at server startup.
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_rotate_on_size"></a>
              <a class="indexterm" name="idm140091711684048"></a>

              <a class="indexterm" name="idm140091711682944"></a>

              <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_rotate_on_size"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-rotate-on-size=#</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_rotate_on_size">audit_log_rotate_on_size</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Integer</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">0</code></td>
</tr></tbody></table>
</div>
<p>
              If the
              <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
              value is 0, the audit log plugin does not perform
              automatic log file rotation. Instead, use
              <a class="link" href="security.html#sysvar_audit_log_flush"><code class="literal">audit_log_flush</code></a> to close
              and reopen the log on demand. In this case, manually
              rename the file externally to the server before flushing
              it.
            </p><p>
              If the
              <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
              value is greater than 0, automatic size-based log file
              rotation occurs. Whenever a write to the log file causes
              its size to exceed the
              <a class="link" href="security.html#sysvar_audit_log_rotate_on_size"><code class="literal">audit_log_rotate_on_size</code></a>
              value, the audit log plugin closes the current log file,
              renames it, and opens a new log file.
            </p><p>
              For more information about audit log file rotation, see
              <a class="xref" href="security.html#audit-log-space-management" title="Audit Log File Space Management and Name Rotation">Audit Log File Space Management and Name Rotation</a>.
            </p><p>
              If you set this variable to a value that is not a multiple
              of 4096, it is truncated to the nearest multiple. (Thus,
              setting it to a value less than 4096 has the effect of
              setting it to 0 and no rotation occurs, except manually.)
            </p></li><li class="listitem"><p><a name="sysvar_audit_log_statement_policy"></a>
              <a class="indexterm" name="idm140091711640448"></a>

              <a class="indexterm" name="idm140091711639344"></a>

              <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_statement_policy"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-statement-policy=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_statement_policy">audit_log_statement_policy</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ALL</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">ALL</code></p><p class="valid-value"><code class="literal">ERRORS</code></p><p class="valid-value"><code class="literal">NONE</code></p></td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
                This variable applies only to legacy mode audit log
                filtering (see
                <a class="xref" href="security.html#audit-log-legacy-filtering" title="6.4.5.7 Legacy Mode Audit Log Filtering">Section 6.4.5.7, “Legacy Mode Audit Log Filtering”</a>).
</p>
</div>
<p>
              The policy controlling how the audit log plugin writes
              statement events to its log file. The following table
              shows the permitted values.
</p>
<div class="informaltable">
<table summary="Permitted values for the audit_log_statement_policy variable."><col width="15%"><col width="85%"><thead><tr>
                  <th scope="col">Value</th>
                  <th scope="col">Description</th>
                </tr></thead><tbody><tr>
                  <td scope="row"><code class="literal">ALL</code></td>
                  <td>Log all statement events</td>
                </tr><tr>
                  <td scope="row"><code class="literal">ERRORS</code></td>
                  <td>Log only failed statement events</td>
                </tr><tr>
                  <td scope="row"><code class="literal">NONE</code></td>
                  <td>Do not log statement events</td>
</tr></tbody></table>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
                At server startup, any explicit value given for
                <a class="link" href="security.html#sysvar_audit_log_statement_policy"><code class="literal">audit_log_statement_policy</code></a>
                may be overridden if
                <a class="link" href="security.html#sysvar_audit_log_policy"><code class="literal">audit_log_policy</code></a> is
                also specified, as described in
                <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 Audit Log Logging Configuration">Section 6.4.5.5, “Audit Log Logging Configuration”</a>.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_audit_log_strategy"></a>
              <a class="indexterm" name="idm140091711579376"></a>

              <a class="indexterm" name="idm140091711578336"></a>

              <a class="link" href="security.html#sysvar_audit_log_strategy"><code class="literal">audit_log_strategy</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for audit_log_strategy"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--audit-log-strategy=value</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_audit_log_strategy">audit_log_strategy</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Enumeration</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ASYNCHRONOUS</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Valid Values</strong></span></td>
<td><p class="valid-value"><code class="literal">ASYNCHRONOUS</code></p><p class="valid-value"><code class="literal">PERFORMANCE</code></p><p class="valid-value"><code class="literal">SEMISYNCHRONOUS</code></p><p class="valid-value"><code class="literal">SYNCHRONOUS</code></p></td>
</tr></tbody></table>
</div>
<p>
              The logging method used by the audit log plugin. These
              strategy values are permitted:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">ASYNCHRONOUS</code>: Log asynchronously.
                  Wait for space in the output buffer.
                </p></li><li class="listitem"><p>
                  <code class="literal">PERFORMANCE</code>: Log asynchronously.
                  Drop requests for which there is insufficient space in
                  the output buffer.
                </p></li><li class="listitem"><p>
                  <code class="literal">SEMISYNCHRONOUS</code>: Log synchronously.
                  Permit caching by the operating system.
                </p></li><li class="listitem"><p>
                  <code class="literal">SYNCHRONOUS</code>: Log synchronously.
                  Call <code class="filename">sync()</code> after each request.
</p></li></ul>
</div>
</li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="audit-log-status-variables"></a>6.4.5.8.5 Audit Log Status Variables</h5>

</div>

</div>

</div>
<p>
          If the audit log plugin is enabled, it exposes several status
          variables that provide operational information. These
          variables are available for legacy mode audit filtering and
          JSON mode audit filtering.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Audit_log_current_size"></a>
              <a class="indexterm" name="idm140091711527536"></a>

              <a class="indexterm" name="idm140091711526496"></a>

              <a class="link" href="security.html#statvar_Audit_log_current_size"><code class="literal">Audit_log_current_size</code></a>
            </p><p>
              The size of the current audit log file. The value
              increases when an event is written to the log and is reset
              to 0 when the log is rotated.
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_event_max_drop_size"></a>
              <a class="indexterm" name="idm140091711521904"></a>

              <a class="indexterm" name="idm140091711520800"></a>

              <a class="link" href="security.html#statvar_Audit_log_event_max_drop_size"><code class="literal">Audit_log_event_max_drop_size</code></a>
            </p><p>
              The size of the largest dropped event in performance
              logging mode. For a description of logging modes, see
              <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 Audit Log Logging Configuration">Section 6.4.5.5, “Audit Log Logging Configuration”</a>.
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_events"></a>
              <a class="indexterm" name="idm140091711515632"></a>

              <a class="indexterm" name="idm140091711514592"></a>

              <a class="link" href="security.html#statvar_Audit_log_events"><code class="literal">Audit_log_events</code></a>
            </p><p>
              The number of events handled by the audit log plugin,
              whether or not they were written to the log based on
              filtering policy (see
              <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 Audit Log Logging Configuration">Section 6.4.5.5, “Audit Log Logging Configuration”</a>).
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_filtered"></a>
              <a class="indexterm" name="idm140091711509360"></a>

              <a class="indexterm" name="idm140091711508256"></a>

              <a class="link" href="security.html#statvar_Audit_log_events_filtered"><code class="literal">Audit_log_events_filtered</code></a>
            </p><p>
              The number of events handled by the audit log plugin that
              were filtered (not written to the log) based on filtering
              policy (see
              <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 Audit Log Logging Configuration">Section 6.4.5.5, “Audit Log Logging Configuration”</a>).
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_lost"></a>
              <a class="indexterm" name="idm140091711502976"></a>

              <a class="indexterm" name="idm140091711501936"></a>

              <a class="link" href="security.html#statvar_Audit_log_events_lost"><code class="literal">Audit_log_events_lost</code></a>
            </p><p>
              The number of events lost in performance logging mode
              because an event was larger than than the available audit
              log buffer space. This value may be useful for assessing
              how to set
              <a class="link" href="security.html#sysvar_audit_log_buffer_size"><code class="literal">audit_log_buffer_size</code></a> to
              size the buffer for performance mode. For a description of
              logging modes, see
              <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 Audit Log Logging Configuration">Section 6.4.5.5, “Audit Log Logging Configuration”</a>.
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_events_written"></a>
              <a class="indexterm" name="idm140091711495200"></a>

              <a class="indexterm" name="idm140091711494096"></a>

              <a class="link" href="security.html#statvar_Audit_log_events_written"><code class="literal">Audit_log_events_written</code></a>
            </p><p>
              The number of events written to the audit log.
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_total_size"></a>
              <a class="indexterm" name="idm140091711489632"></a>

              <a class="indexterm" name="idm140091711488592"></a>

              <a class="link" href="security.html#statvar_Audit_log_total_size"><code class="literal">Audit_log_total_size</code></a>
            </p><p>
              The total size of events written to all audit log files.
              Unlike
              <a class="link" href="security.html#statvar_Audit_log_current_size"><code class="literal">Audit_log_current_size</code></a>,
              the value of
              <a class="link" href="security.html#statvar_Audit_log_total_size"><code class="literal">Audit_log_total_size</code></a>
              increases even when the log is rotated.
            </p></li><li class="listitem"><p><a name="statvar_Audit_log_write_waits"></a>
              <a class="indexterm" name="idm140091711481472"></a>

              <a class="indexterm" name="idm140091711480432"></a>

              <a class="link" href="security.html#statvar_Audit_log_write_waits"><code class="literal">Audit_log_write_waits</code></a>
            </p><p>
              The number of times an event had to wait for space in the
              audit log buffer in asynchronous logging mode. For a
              description of logging modes, see
              <a class="xref" href="security.html#audit-log-logging-configuration" title="6.4.5.5 Audit Log Logging Configuration">Section 6.4.5.5, “Audit Log Logging Configuration”</a>.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="audit-log-restrictions"></a>6.4.5.9 Audit Log Restrictions</h4>

</div>

</div>

</div>
<p>
        MySQL Enterprise Audit is subject to these general restrictions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Only SQL statements are logged. Changes made by no-SQL APIs,
            such as memcached, Node.JS, and the NDB API, are not logged.
          </p></li><li class="listitem"><p>
            Only top-level statements are logged, not statements within
            stored programs such as triggers or stored procedures.
          </p></li><li class="listitem"><p>
            Contents of files referenced by statements such as
            <a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA Syntax"><code class="literal">LOAD DATA</code></a> are not logged.
</p></li></ul>
</div>
<p><b>NDB Cluster. </b>
          It is possible to use MySQL Enterprise Audit with MySQL NDB Cluster,
          subject to the following conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            All changes to be logged must be done using the SQL
            interface. Changes using no-SQL interfaces, such as those
            provided by the NDB API, memcached, or ClusterJ, are not
            logged.
          </p></li><li class="listitem"><p>
            The plugin must be installed on each MySQL server that is
            used to execute SQL on the cluster.
          </p></li><li class="listitem"><p>
            Audit plugin data must be aggregated amongst all MySQL
            servers used with the cluster. This aggregation is the
            responsibility of the application or user.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="audit-api-message-emit"></a>6.4.6 The Audit Message Component</h3>

</div>

</div>

</div>
<p>
      As of MySQL 8.0.14, the <code class="literal">audit_api_message_emit</code>
      component enables applications to add their own message events to
      the audit log, using the
      <a class="link" href="security.html#udf_audit-api-message-emit-udf"><code class="literal">audit_api_message_emit_udf()</code></a>
      user-defined function.
    </p><p>
      The <code class="literal">audit_api_message_emit</code> component cooperates
      with all plugins of audit type. For concreteness, examples use the
      <code class="literal">audit_log</code> plugin described in
      <a class="xref" href="security.html#audit-log" title="6.4.5 MySQL Enterprise Audit">Section 6.4.5, “MySQL Enterprise Audit”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#audit-api-message-emit-install" title="Installing or Uninstalling the Audit Message Component">Installing or Uninstalling the Audit Message Component</a></p></li><li class="listitem"><p><a class="xref" href="security.html#audit-api-message-emit-functions" title="Audit Message Function">Audit Message Function</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h4 class="title"><a name="audit-api-message-emit-install"></a>Installing or Uninstalling the Audit Message Component</h4>

</div>

</div>

</div>
<p>
        To be usable by the server, the component library file must be
        located in the MySQL plugin directory (the directory named by
        the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
        variable). If necessary, configure the plugin directory location
        by setting the value of
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
      </p><p>
        To install the <code class="literal">audit_api_message_emit</code>
        component, use this statement:
      </p><pre data-lang="sql" class="programlisting">
INSTALL COMPONENT "file://component_audit_api_message_emit";
</pre><p>
        Component installation is a one-time operation that need not be
        done per server startup. <a class="link" href="sql-syntax.html#install-component" title="13.7.4.3 INSTALL COMPONENT Syntax"><code class="literal">INSTALL
        COMPONENT</code></a> loads the component, and also registers it
        in the <code class="literal">mysql.component</code> system table to cause
        it to be loaded during subsequent server startups.
      </p><p>
        To uninstall the <code class="literal">audit_api_message_emit</code>
        component, use this statement:
      </p><pre data-lang="sql" class="programlisting">
UNINSTALL COMPONENT "file://component_audit_api_message_emit";
</pre><p>
        <a class="link" href="sql-syntax.html#uninstall-component" title="13.7.4.5 UNINSTALL COMPONENT Syntax"><code class="literal">UNINSTALL COMPONENT</code></a> unloads the
        component, and deregisters it from the
        <code class="literal">mysql.component</code> system table to cause it not
        to be loaded during subsequent server startups.
      </p><p>
        Installing or uninstalling the
        <code class="literal">audit_api_message_emit</code> component installs or
        uninstalls the
        <a class="link" href="security.html#udf_audit-api-message-emit-udf"><code class="literal">audit_api_message_emit_udf()</code></a>
        function that the component implements. It is not necessary to
        use <code class="literal">CREATE
        FUNCTION</code> or <code class="literal">DROP
        FUNCTION</code> to do so.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h4 class="title"><a name="audit-api-message-emit-functions"></a>Audit Message Function</h4>

</div>

</div>

</div>
<p>
        This section describes the
        <a class="link" href="security.html#udf_audit-api-message-emit-udf"><code class="literal">audit_api_message_emit_udf()</code></a>
        user-defined function (UDF) implemented by the
        <code class="literal">audit_api_message_emit</code> component.
      </p><p>
        Before using the audit message function, install the audit
        message component according to the instructions provided at
        <a class="xref" href="security.html#audit-api-message-emit-install" title="Installing or Uninstalling the Audit Message Component">Installing or Uninstalling the Audit Message Component</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="udf_audit-api-message-emit-udf"></a>
            <a class="link" href="security.html#udf_audit-api-message-emit-udf"><code class="literal">audit_api_message_emit_udf(<em class="replaceable"><code>component</code></em>,
            <em class="replaceable"><code>producer</code></em>,
            <em class="replaceable"><code>message</code></em>[,
            <em class="replaceable"><code>key</code></em>,
            <em class="replaceable"><code>value</code></em>] ...)</code></a>
          </p><a class="indexterm" name="idm140091711428112"></a><a class="indexterm" name="idm140091711427008"></a><p>
            Adds a message event to the audit log. Message events
            include component, producer, and message strings of the
            caller's choosing, and optionally a set of key-value pairs.
          </p><p>
            An event posted by this UDF is sent to all enabled plugins
            of audit type, each of which handles the event according to
            its own rules. If no plugin of audit type is enabled,
            posting the event has no effect.
          </p><p>
            Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                <em class="replaceable"><code>component</code></em>: A string that
                specifies a component name.
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>producer</code></em>: A string that
                specifies a producer name.
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>message</code></em>: A string that
                specifies the event message.
              </p></li><li class="listitem"><p>
                <em class="replaceable"><code>key</code></em>,
                <em class="replaceable"><code>value</code></em>: Events may include 0
                or more key-value pairs that specify an arbitrary
                application-provided data map. Each
                <em class="replaceable"><code>key</code></em> argument is a string that
                specifies a name for its immediately following
                <em class="replaceable"><code>value</code></em> argument. Each
                <em class="replaceable"><code>value</code></em> argument specifies a
                value for its immediately following
                <em class="replaceable"><code>key</code></em> argument. Each
                <em class="replaceable"><code>value</code></em> can be a string or
                numeric value, or <code class="literal">NULL</code>.
</p></li></ul>
</div>
<p>
            Return value:
          </p><p>
            The string <code class="literal">OK</code> to indicate success. An
            error occurs if the function fails.
          </p><p>
            Example:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT audit_api_message_emit_udf('component_text',</code></strong>
                                         <strong class="userinput"><code>'producer_text',</code></strong>
                                         <strong class="userinput"><code>'message_text',</code></strong>
                                         <strong class="userinput"><code>'key1', 'value1',</code></strong>
                                         <strong class="userinput"><code>'key2', 123,</code></strong>
                                         <strong class="userinput"><code>'key3', NULL) AS 'Message';</code></strong>
+---------+
| Message |
+---------+
| OK      |
+---------+
</pre><p>
            Additional information:
          </p><p>
            Each audit plugin that receives an event posted by
            <a class="link" href="security.html#udf_audit-api-message-emit-udf"><code class="literal">audit_api_message_emit_udf()</code></a>
            logs the event in plugin-specific format. For example, the
            <code class="literal">audit_log</code> plugin (see
            <a class="xref" href="security.html#audit-log" title="6.4.5 MySQL Enterprise Audit">Section 6.4.5, “MySQL Enterprise Audit”</a>) logs message values as follows,
            depending on the log format configured by the
            <a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format</code></a> system
            variable:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                JSON format
                (<a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=JSON</code></a>):
              </p><pre data-lang="json" class="programlisting">
{
  ...
  "class": "message",
  "event": "user",
  ...
  "message_data": {
    "component": "component_text",
    "producer": "producer_text",
    "message": "message_text",
    "map": {
      "key1": "value1",
      "key2": 123,
      "key3": null
    }
  }
}
</pre></li><li class="listitem"><p>
                New-style XML format
                (<a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=NEW</code></a>):
              </p><pre data-lang="xml" class="programlisting">
&lt;AUDIT_RECORD&gt;
 ...
 &lt;NAME&gt;Message&lt;/NAME&gt;
 ...
 &lt;COMMAND_CLASS&gt;user&lt;/COMMAND_CLASS&gt;
 &lt;COMPONENT&gt;component_text&lt;/COMPONENT&gt;
 &lt;PRODUCER&gt;producer_text&lt;/PRODUCER&gt;
 &lt;MESSAGE&gt;message_text&lt;/MESSAGE&gt;
 &lt;MAP&gt;
   &lt;ELEMENT&gt;
     &lt;KEY&gt;key1&lt;/KEY&gt;
     &lt;VALUE&gt;value1&lt;/VALUE&gt;
   &lt;/ELEMENT&gt;
   &lt;ELEMENT&gt;
     &lt;KEY&gt;key2&lt;/KEY&gt;
     &lt;VALUE&gt;123&lt;/VALUE&gt;
   &lt;/ELEMENT&gt;
   &lt;ELEMENT&gt;
     &lt;KEY&gt;key3&lt;/KEY&gt;
     &lt;VALUE/&gt;
   &lt;/ELEMENT&gt;
 &lt;/MAP&gt;
&lt;/AUDIT_RECORD&gt;
</pre></li><li class="listitem"><p>
                Old-style XML format
                (<a class="link" href="security.html#sysvar_audit_log_format"><code class="literal">audit_log_format=OLD</code></a>):
              </p><pre data-lang="xml" class="programlisting">
&lt;AUDIT_RECORD
  ...
  NAME="Message"
  ...
  COMMAND_CLASS="user"
  COMPONENT="component_text"
  PRODUCER="producer_text"
  MESSAGE="message_text"/&gt;
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                  Message events logged in old-style XML format do not
                  include the key-value map due to representational
                  constraints imposed by this format.
</p>
</div>
</li></ul>
</div>
<p>
            Messages posted by
            <a class="link" href="security.html#udf_audit-api-message-emit-udf"><code class="literal">audit_api_message_emit_udf()</code></a>
            have an event class of
            <code class="literal">MYSQL_AUDIT_MESSAGE_CLASS</code> and a subclass
            of <code class="literal">MYSQL_AUDIT_MESSAGE_USER</code>. (Interally
            generated audit messages have the same class and a subclass
            of <code class="literal">MYSQL_AUDIT_MESSAGE_INTERNAL</code>; this
            subclass currently is unused.) To refer to such events in
            <code class="literal">audit_log</code> filtering rules, use a
            <code class="literal">class</code> element with a
            <code class="literal">name</code> value of <code class="literal">message</code>.
            For example:
          </p><pre data-lang="json" class="programlisting">
{
  "filter": {
    "class": {
      "name": "message"
    }
  }
}
</pre><p>
            Should it be necessary to distinguish user-generated and
            internally generated message events, test the
            <code class="literal">subclass</code> value against
            <code class="literal">user</code> or <code class="literal">internal</code>.
          </p><p>
            Filtering based on the contents of the key-value map is not
            supported.
          </p><p>
            For information about writing filtering rules, see
            <a class="xref" href="security.html#audit-log-filtering" title="6.4.5.6 Audit Log Filtering">Section 6.4.5.6, “Audit Log Filtering”</a>.
</p></li></ul>
</div>

</div>

</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="firewall"></a>6.4.7 MySQL Enterprise Firewall</h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#firewall-components">6.4.7.1 MySQL Enterprise Firewall Components</a></span></dt><dt><span class="section"><a href="security.html#firewall-installation">6.4.7.2 Installing or Uninstalling MySQL Enterprise Firewall</a></span></dt><dt><span class="section"><a href="security.html#firewall-usage">6.4.7.3 Using MySQL Enterprise Firewall</a></span></dt><dt><span class="section"><a href="security.html#firewall-reference">6.4.7.4 MySQL Enterprise Firewall Reference</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140091711376608"></a><a class="indexterm" name="idm140091711375552"></a>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        MySQL Enterprise Firewall is an extension included in MySQL Enterprise Edition, a commercial product.
        To learn more about commercial products, see
        <a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a>.
</p>
</div>
<p>
      MySQL Enterprise Edition includes MySQL Enterprise Firewall, an application-level firewall that enables
      database administrators to permit or deny SQL statement execution
      based on matching against whitelists of accepted statement
      patterns. This helps harden MySQL Server against attacks such as
      SQL injection or attempts to exploit applications by using them
      outside of their legitimate query workload characteristics.
    </p><p>
      Each MySQL account registered with the firewall has its own
      statement whitelist, enabling protection to be tailored per
      account. For a given account, the firewall can operate in
      recording, protecting, or detecting mode, for training in the
      accepted statement patterns, active protection against
      unacceptable statements, or passive detection of unacceptable
      statements. The diagram illustrates how the firewall processes
      incoming statements in each mode.
</p>
<div class="figure">
<a name="firewall-diagram"></a><p class="title"><b>Figure 6.1 MySQL Enterprise Firewall Operation</b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="images/firewall-diagram-1.png" width="682" height="481" alt="Flow chart showing how MySQL Enterprise Firewall processes incoming SQL statements in recording, protecting, and detecting modes.">
</div>

</div>

</div>
<br class="figure-break"><p>
      The following sections describe the components of MySQL Enterprise Firewall, discuss
      how to install and use it, and provide reference information for
      its components.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-components"></a>6.4.7.1 MySQL Enterprise Firewall Components</h4>
</div>
</div>
</div>
<p>
        MySQL Enterprise Firewall is based on a plugin library that implements these
        components:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A server-side plugin named <code class="literal">MYSQL_FIREWALL</code>
            examines SQL statements before they execute and, based on
            its in-memory cache, renders a decision whether to execute
            or reject each statement.
          </p></li><li class="listitem"><p>
            Server-side plugins named
            <code class="literal">MYSQL_FIREWALL_USERS</code> and
            <code class="literal">MYSQL_FIREWALL_WHITELIST</code> implement
            <code class="literal">INFORMATION_SCHEMA</code> tables that provide
            views into the firewall data cache.
          </p></li><li class="listitem"><p>
            System tables named <code class="literal">firewall_users</code> and
            <code class="literal">firewall_whitelist</code> in the
            <code class="literal">mysql</code> database provide persistent storage
            of firewall data.
          </p></li><li class="listitem"><p>
            Stored procedures named
            <code class="literal">sp_set_firewall_mode()</code> and
            <code class="literal">sp_reload_firewall_rules()</code> perform tasks
            such as registering MySQL accounts with the firewall,
            establishing their operational mode, and managing transfer
            of firewall data between the cache and the underlying system
            tables.
          </p></li><li class="listitem"><p>
            A set of user-defined functions provides an SQL-level API
            for lower-level tasks such as synchronizing the cache with
            the underlying system tables.
          </p></li><li class="listitem"><p>
            System variables enable firewall configuration and status
            variables provide runtime operational information.
          </p></li><li class="listitem"><p>
            <a class="link" href="security.html#priv_firewall-admin"><code class="literal">FIREWALL_ADMIN</code></a> and
            <a class="link" href="security.html#priv_firewall-user"><code class="literal">FIREWALL_USER</code></a> privileges
            enable users to administer firewall rules for any user, and
            their own firewall rules, respectively.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-installation"></a>6.4.7.2 Installing or Uninstalling MySQL Enterprise Firewall</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091711344560"></a><a class="indexterm" name="idm140091711343088"></a><p>
        MySQL Enterprise Firewall installation is a one-time operation that installs the
        components described in <a class="xref" href="security.html#firewall-components" title="6.4.7.1 MySQL Enterprise Firewall Components">Section 6.4.7.1, “MySQL Enterprise Firewall Components”</a>.
        Installation can be performed using a graphical interface or
        manually:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            On Windows, MySQL Installer includes an option to enable MySQL Enterprise Firewall for
            you.
          </p></li><li class="listitem"><p>
            MySQL Workbench 6.3.4 or higher can install MySQL Enterprise Firewall, enable or
            disable an installed firewall, or uninstall the firewall.
          </p></li><li class="listitem"><p>
            Manual MySQL Enterprise Firewall installation involves running a script located
            in the <code class="filename">share</code> directory of your MySQL
            installation.
</p></li></ul>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Important
</div>
<p>
          Read this entire section before following its instructions.
          Parts of the procedure differ depending on your environment.
</p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          If installed, MySQL Enterprise Firewall involves some minimal overhead even when
          disabled. To avoid this overhead, do not install the firewall
          unless you plan to use it.
</p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          MySQL Enterprise Firewall does not work together with the query cache. If the
          query cache is enabled, disable it before installing the
          firewall (see <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/query-cache-configuration.html" target="_top">Query Cache Configuration</a>).
</p>
</div>
<p>
        For usage instructions, see <a class="xref" href="security.html#firewall-usage" title="6.4.7.3 Using MySQL Enterprise Firewall">Section 6.4.7.3, “Using MySQL Enterprise Firewall”</a>.
        For reference information, see
        <a class="xref" href="security.html#firewall-reference" title="6.4.7.4 MySQL Enterprise Firewall Reference">Section 6.4.7.4, “MySQL Enterprise Firewall Reference”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#firewall-install" title="Installing MySQL Enterprise Firewall">Installing MySQL Enterprise Firewall</a></p></li><li class="listitem"><p><a class="xref" href="security.html#firewall-uninstall" title="Uninstalling MySQL Enterprise Firewall">Uninstalling MySQL Enterprise Firewall</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="firewall-install"></a>Installing MySQL Enterprise Firewall</h5>

</div>

</div>

</div>
<p>
          If MySQL Enterprise Firewall is already installed from an older version of MySQL,
          uninstall it using the instructions given later in this
          section and then restart your server before installing the
          current version. In this case, it is also necessary to
          register your configuration again.
        </p><p>
          On Windows, you can use MySQL Installer to install MySQL Enterprise Firewall, as shown in
          <a class="xref" href="security.html#firewall-installation-windows-installer" title="Figure 6.2 MySQL Enterprise Firewall Installation on Windows">Figure 6.2, “MySQL Enterprise Firewall Installation on Windows”</a>.
          Check the <span class="guilabel">Enable Enterprise Firewall</span>
          checkbox. (<span class="guilabel">Open Firewall port for network
          access</span> has a different purpose. It refers to
          Windows Firewall and controls whether Windows blocks the
          TCP/IP port on which the MySQL server listens for client
          connections.)
</p>
<div class="figure">
<a name="firewall-installation-windows-installer"></a><p class="title"><b>Figure 6.2 MySQL Enterprise Firewall Installation on Windows</b></p>
<div class="figure-contents">

<div class="mediaobject">
<img src="images/firewall-windows-installer-option.png" width="801" height="602" alt="Content is described in the surrounding text.">
</div>

</div>

</div>
<br class="figure-break"><p>
          To install MySQL Enterprise Firewall using MySQL Workbench 6.3.4 or higher, see
          <a class="ulink" href="https://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top">MySQL Enterprise Firewall Interface</a>.
        </p><p>
          To install MySQL Enterprise Firewall manually, look in the
          <code class="filename">share</code> directory of your MySQL
          installation and choose the script that is appropriate for
          your platform. The available scripts differ in the suffix used
          to refer to the plugin library file:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="filename">win_install_firewall.sql</code>: Choose this
              script for Windows systems that use
              <code class="filename">.dll</code> as the file name suffix.
            </p></li><li class="listitem"><p>
              <code class="filename">linux_install_firewall.sql</code>: Choose
              this script for Linux and similar systems that use
              <code class="filename">.so</code> as the file name suffix.
</p></li></ul>
</div>
<p>
          The installation script creates stored procedures in the
          default database, so choose a database to use. Then run the
          script as follows, naming the chosen database on the command
          line. The example here uses the <code class="literal">mysql</code>
          database and the Linux installation script. Make the
          appropriate substitutions for your system.
        </p><pre data-lang="terminal" class="programlisting">
shell&gt; <strong class="userinput"><code>mysql -u root -p mysql &lt; linux_install_firewall.sql</code></strong>
Enter password: <em class="replaceable"><code>(enter root password here)</code></em>
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            To use MySQL Enterprise Firewall in the context of master/slave replication,
            Group Replication, or InnoDB cluster, you must prepare the
            slave or secondary nodes prior to running the installation
            script on the master or primary node. This is necessary
            because the <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a>
            statements in the script are not replicated.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
                On each slave or secondary node, extract the
                <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> statements
                from the installation script and execute them manually.
              </p></li><li class="listitem"><p>
                On the master or primary node, run the installation
                script as described previously.
</p></li></ol>
</div>

</div>
<p>
          Installing MySQL Enterprise Firewall either using a graphical interface or
          manually should enable the firewall. To verify that, connect
          to the server and execute this statement:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GLOBAL VARIABLES LIKE 'mysql_firewall_mode';</code></strong>
+---------------------+-------+
| Variable_name       | Value |
+---------------------+-------+
| mysql_firewall_mode | ON    |
+---------------------+-------+
</pre><p>
          If the plugin fails to initialize, check the server error log
          for diagnostic messages.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="firewall-uninstall"></a>Uninstalling MySQL Enterprise Firewall</h5>

</div>

</div>

</div>
<p>
          MySQL Enterprise Firewall can be uninstalled using MySQL Workbench or manually.
        </p><p>
          To uninstall MySQL Enterprise Firewall using MySQL Workbench 6.3.4 or higher, see
          <a class="ulink" href="https://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top">MySQL Enterprise Firewall Interface</a>.
        </p><p>
          To uninstall MySQL Enterprise Firewall manually, execute the following
          statements. It is assumed that the stored procedures were
          created in the <code class="literal">mysql</code> database. Adjust the
          <a class="link" href="sql-syntax.html#drop-procedure" title="13.1.29 DROP PROCEDURE and DROP FUNCTION Syntax"><code class="literal">DROP PROCEDURE</code></a> statements
          appropriately if the procedures were created in a different
          database.
        </p><pre data-lang="sql" class="programlisting">
DROP TABLE mysql.firewall_whitelist;
DROP TABLE mysql.firewall_users;
UNINSTALL PLUGIN mysql_firewall;
UNINSTALL PLUGIN mysql_firewall_whitelist;
UNINSTALL PLUGIN mysql_firewall_users;
DROP FUNCTION set_firewall_mode;
DROP FUNCTION normalize_statement;
DROP FUNCTION read_firewall_whitelist;
DROP FUNCTION read_firewall_users;
DROP FUNCTION mysql_firewall_flush_status;
DROP PROCEDURE mysql.sp_set_firewall_mode;
DROP PROCEDURE mysql.sp_reload_firewall_rules;
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-usage"></a>6.4.7.3 Using MySQL Enterprise Firewall</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091711287280"></a><p>
        Before using MySQL Enterprise Firewall, install it according to the instructions
        provided in <a class="xref" href="security.html#firewall-installation" title="6.4.7.2 Installing or Uninstalling MySQL Enterprise Firewall">Section 6.4.7.2, “Installing or Uninstalling MySQL Enterprise Firewall”</a>. Also,
        MySQL Enterprise Firewall does not work together with the query cache; disable the
        query cache if it is enabled (see
        <a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/query-cache-configuration.html" target="_top">Query Cache Configuration</a>).
      </p><p>
        This section describes how to configure MySQL Enterprise Firewall using SQL
        statements. Alternatively, MySQL Workbench 6.3.4 or higher provides
        a graphical interface for firewall control. See
        <a class="ulink" href="https://dev.mysql.com/doc/workbench/en/wb-mysql-firewall.html" target="_top">MySQL Enterprise Firewall Interface</a>.
      </p><p>
        To enable or disable the firewall, set the
        <a class="link" href="security.html#sysvar_mysql_firewall_mode"><code class="literal">mysql_firewall_mode</code></a> system
        variable. By default, this variable is enabled when the firewall
        is installed. To control the initial firewall state explicitly,
        you can set the variable at server startup. For example, to
        enable the firewall in an option file, use these lines:
      </p><pre data-lang="ini" class="programlisting">
[mysqld]
mysql_firewall_mode=ON
</pre><p>
        It is also possible to disable or enable the firewall at
        runtime:
      </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL mysql_firewall_mode = OFF;</code></strong>
mysql&gt; <strong class="userinput"><code>SET GLOBAL mysql_firewall_mode = ON;</code></strong>
</pre><p>
        In addition to the global on/off firewall mode, each account
        registered with the firewall has its own operational mode. For
        an account in recording mode, the firewall learns an
        application's <span class="quote">“<span class="quote">fingerprint,</span>”</span> that is, the
        acceptable statement patterns that, taken together, form a
        whitelist. After training, switch the firewall to protecting
        mode to harden MySQL against access by statements that deviate
        from the fingerprint. For additional training, switch the
        firewall back to recording mode as necessary to update the
        whitelist with new statement patterns. An intrusion-detection
        mode is available that writes suspicious statements to the error
        log but does not deny access.
      </p><p>
        The firewall maintains whitelist rules on a per-account basis,
        enabling implementation of protection strategies such as these:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            For an application that has unique protection requirements,
            configure it to use an account that is not used for any
            other purpose.
          </p></li><li class="listitem"><p>
            For applications that are related and share protection
            requirements, configure them as a group to use the same
            account.
</p></li></ul>
</div>
<p>
        Firewall operation is based on conversion of SQL statements to
        normalized digest form. Firewall digests are like the statement
        digests used by the Performance Schema (see
        <a class="xref" href="performance-schema.html#performance-schema-statement-digests" title="26.10 Performance Schema Statement Digests and Sampling">Section 26.10, “Performance Schema Statement Digests and Sampling”</a>).
        However, unlike the Performance Schema, the relevant
        digest-related system variable is
        <a class="link" href="server-administration.html#sysvar_max_digest_length"><code class="literal">max_digest_length</code></a>.
      </p><p>
        For a connection from a registered account, the firewall
        converts each incoming statement to normalized form and
        processes it according to the account mode:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            In recording mode, the firewall adds the normalized
            statement to the account whitelist rules.
          </p></li><li class="listitem"><p>
            In protecting mode, the firewall compares the normalized
            statement to the account whitelist rules. If there is a
            match, the statement passes and the server continues to
            process it. Otherwise, the server rejects the statement and
            returns an error to the client. The firewall also writes the
            rejected statement to the error log if the
            <a class="link" href="security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a> system
            variable is enabled.
          </p></li><li class="listitem"><p>
            In detecting mode, the firewall matches statements as in
            protecting mode, but writes nonmatching statements to the
            error log without denying access.
</p></li></ul>
</div>
<p>
        Accounts that have a mode of <code class="literal">OFF</code> or are not
        registered with the firewall are ignored by it.
      </p><p>
        To protect an account using MySQL Enterprise Firewall, follow these steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            Register the account and put it in recording mode.
          </p></li><li class="listitem"><p>
            Connect to the MySQL server using the registered account and
            execute statements to be learned. This establishes the
            account's whitelist of accepted statements.
          </p></li><li class="listitem"><p>
            Switch the registered account to protecting mode.
</p></li></ol>
</div>
<p>
        The following example shows how to register an account with the
        firewall, use the firewall to learn acceptable statements for
        that account, and protect the account against execution of
        unacceptable statements. The example account,
        <code class="literal">'fwuser'@'localhost'</code>, is for use by an
        application that accesses tables in the
        <code class="literal">sakila</code> database. (This database is available
        at <a class="ulink" href="https://dev.mysql.com/doc/index-other.html" target="_top">https://dev.mysql.com/doc/index-other.html</a>.)
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          The user and host parts of the account name are quoted
          separately for statements such as <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE
          USER</code></a> and <a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT Syntax"><code class="literal">GRANT</code></a>,
          whereas to specify an account for use with a firewall
          component, name it as a single quoted string
          <code class="literal">'fwuser@localhost'</code>.
        </p><p>
          The convention for naming accounts as a single quoted string
          for firewall components means that you cannot use accounts
          that have embedded <code class="literal">@</code> characters in the user
          name.
</p>
</div>
<p>
        Perform the steps in the following procedure using an
        administrative MySQL account, except those designated for
        execution by the account registered with the firewall. The
        default database should be <code class="literal">sakila</code> for
        statements executed using the registered account.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
            If necessary, create the account to be protected (choose an
            appropriate password) and grant it privileges for the
            <code class="literal">sakila</code> database:
          </p><pre data-lang="sql" class="programlisting">

mysql&gt; <strong class="userinput"><code>CREATE USER 'fwuser'@'localhost' IDENTIFIED BY 'fWp@3sw0rd';</code></strong>
mysql&gt; <strong class="userinput"><code>GRANT ALL ON sakila.* TO 'fwuser'@'localhost';</code></strong>
</pre></li><li class="listitem"><p>
            Use the <code class="literal">sp_set_firewall_mode()</code> stored
            procedure to register the account with the firewall and
            place it in recording mode (if the procedure is located in a
            database other than <code class="literal">mysql</code>, adjust the
            statement accordingly):
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'RECORDING');</code></strong>
</pre><p>
            During the course of its execution, the stored procedure
            invokes firewall user-defined functions, which may produce
            output of their own.
          </p></li><li class="listitem"><p>
            Using the registered account, connect to the server, then
            execute some statements that are legitimate for it:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = 1;</code></strong>
mysql&gt; <strong class="userinput"><code>UPDATE rental SET return_date = NOW() WHERE rental_id = 1;</code></strong>
mysql&gt; <strong class="userinput"><code>SELECT get_customer_balance(1, NOW());</code></strong>
</pre><p>
            The firewall converts the statements to digest form and
            records them in the account whitelist.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              Until the account executes statements in recording mode,
              its whitelist is empty, which is equivalent to <span class="quote">“<span class="quote">deny
              all.</span>”</span> If switched to protecting mode, the account
              will be effectively prohibited from executing statements.
</p>
</div>
</li><li class="listitem"><p>
            At this point, the user and whitelist information is cached
            and can be seen in the firewall
            <code class="literal">INFORMATION_SCHEMA</code> tables:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT MODE FROM INFORMATION_SCHEMA.MYSQL_FIREWALL_USERS</code></strong>
       <strong class="userinput"><code>WHERE USERHOST = 'fwuser@localhost';</code></strong>
+-----------+
| MODE      |
+-----------+
| RECORDING |
+-----------+
mysql&gt; <strong class="userinput"><code>SELECT RULE FROM INFORMATION_SCHEMA.MYSQL_FIREWALL_WHITELIST</code></strong>
       <strong class="userinput"><code>WHERE USERHOST = 'fwuser@localhost';</code></strong>
+----------------------------------------------------------------------------+
| RULE                                                                       |
+----------------------------------------------------------------------------+
| SELECT `first_name` , `last_name` FROM `customer` WHERE `customer_id` = ?  |
| SELECT `get_customer_balance` ( ? , NOW ( ) )                              |
| UPDATE `rental` SET `return_date` = NOW ( ) WHERE `rental_id` = ?          |
| SELECT @@`version_comment` LIMIT ?                                         |
+----------------------------------------------------------------------------+
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              The <code class="literal">@@version_comment</code> rule comes from a
              statement sent automatically by the
              <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client when you connect to the
              server as the registered user.
            </p><p>
              It is important to train the firewall under conditions
              matching application use. For example, a given MySQL
              connector might send statements to the server at the
              beginning of a connection to determine server
              characteristics and capabilities. If an application
              normally is used through that connector, train the
              firewall that way, too. That enables those initial
              statements to become part of the whitelist for the account
              associated with the application.
</p>
</div>
</li><li class="listitem"><p>
            Use the stored procedure to switch the registered user to
            protecting mode:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'PROTECTING');</code></strong>
</pre>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
              Switching the account out of <code class="literal">RECORDING</code>
              mode synchronizes its firewall cache data to the
              underlying <code class="literal">mysql</code> system database tables
              for persistent storage. If you do not switch the mode for
              a user who is being recorded, the cached whitelist data is
              not written to the system tables and will be lost when the
              server is restarted.
</p>
</div>
</li><li class="listitem"><p>
            Using the registered account, execute some acceptable and
            unacceptable statements. The firewall matches each one
            against the account whitelist and accepts or rejects it.
          </p><p>
            This statement is not identical to a training statement but
            produces the same normalized statement as one of them, so
            the firewall accepts it:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = '48';</code></strong>
+------------+-----------+
| first_name | last_name |
+------------+-----------+
| ANN        | EVANS     |
+------------+-----------+
</pre><p>
            These statements do not match anything in the whitelist and
            each results in an error:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT first_name, last_name FROM customer WHERE customer_id = 1 OR TRUE;</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
mysql&gt; <strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
mysql&gt; <strong class="userinput"><code>TRUNCATE TABLE mysql.slow_log;</code></strong>
ERROR 1045 (28000): Statement was blocked by Firewall
</pre><p>
            The firewall also writes the rejected statements to the
            error log if the
            <a class="link" href="security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a> system
            variable is enabled. For example:
          </p><pre data-lang="none" class="programlisting">
[Note] Plugin MYSQL_FIREWALL reported:
'ACCESS DENIED for fwuser@localhost. Reason: No match in whitelist.
Statement: TRUNCATE TABLE `mysql` . `slow_log` '
</pre><p>
            You can use these log messages in your efforts to identify
            the source of attacks.
          </p></li><li class="listitem"><p>
            You can log nonmatching statements as suspicious without
            denying access. To do this, put the account in
            intrusion-detecting mode:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('fwuser@localhost', 'DETECTING');</code></strong>
</pre></li><li class="listitem"><p>
            Using the registered account, connect to the server, then
            execute a statement that does not match the whitelist:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW TABLES LIKE 'customer%';</code></strong>
+------------------------------+
| Tables_in_sakila (customer%) |
+------------------------------+
| customer                     |
| customer_list                |
+------------------------------+
</pre><p>
            In detecting mode, the firewall permits the nonmatching
            statement to execute but writes a message to the error log:
          </p><pre data-lang="none" class="programlisting">
[Note] Plugin MYSQL_FIREWALL reported:
'SUSPICIOUS STATEMENT from 'fwuser@localhost'. Reason: No match in whitelist.
Statement: SHOW TABLES LIKE ? '
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
              Detection mode writes messages as Notes, which are
              information messages. To ensure that such messages appear
              in the error log and are not discarded, make sure that the
              <a class="link" href="server-administration.html#sysvar_log_error_verbosity"><code class="literal">log_error_verbosity</code></a>
              system variable is set to a value of 3.
</p>
</div>
</li><li class="listitem"><p>
            To assess firewall activity, examine its status variables:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW GLOBAL STATUS LIKE 'Firewall%';</code></strong>
+----------------------------+-------+
| Variable_name              | Value |
+----------------------------+-------+
| Firewall_access_denied     | 3     |
| Firewall_access_granted    | 4     |
| Firewall_access_suspicious | 1     |
| Firewall_cached_entries    | 4     |
+----------------------------+-------+
</pre><p>
            The variables indicate the number of statements rejected,
            accepted, logged as suspicious, and added to the cache,
            respectively. The
            <a class="link" href="security.html#statvar_Firewall_access_granted"><code class="literal">Firewall_access_granted</code></a>
            count is 4 because of the
            <code class="literal">@@version_comment</code> statement sent by the
            <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Client"><span class="command"><strong>mysql</strong></span></a> client each of the three time you
            used it to connect as the registered user, plus the
            <a class="link" href="sql-syntax.html#show-tables" title="13.7.6.37 SHOW TABLES Syntax"><code class="literal">SHOW TABLES</code></a> statement that
            was not blocked in <code class="literal">DETECTING</code> mode.
</p></li></ol>
</div>
<p>
        Should additional training for an account be necessary, switch
        it to recording mode again, then back to protecting mode after
        executing statements to be added to the whitelist.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="firewall-reference"></a>6.4.7.4 MySQL Enterprise Firewall Reference</h4>

</div>

</div>

</div>
<p>
        The following discussion serves as a reference to MySQL Enterprise Firewall
        components:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="xref" href="security.html#firewall-tables" title="6.4.7.4.1 MySQL Enterprise Firewall Tables">Section 6.4.7.4.1, “MySQL Enterprise Firewall Tables”</a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="security.html#firewall-routines" title="6.4.7.4.2 MySQL Enterprise Firewall Procedures and Functions">Section 6.4.7.4.2, “MySQL Enterprise Firewall Procedures and Functions”</a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="security.html#firewall-system-variables" title="6.4.7.4.3 MySQL Enterprise Firewall System Variables">Section 6.4.7.4.3, “MySQL Enterprise Firewall System Variables”</a>
          </p></li><li class="listitem"><p>
            <a class="xref" href="security.html#firewall-status-variables" title="6.4.7.4.4 MySQL Enterprise Firewall Status Variables">Section 6.4.7.4.4, “MySQL Enterprise Firewall Status Variables”</a>
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-tables"></a>6.4.7.4.1 MySQL Enterprise Firewall Tables</h5>

</div>

</div>

</div>
<p>
          MySQL Enterprise Firewall maintains account and whitelist information. It uses
          <code class="literal">INFORMATION_SCHEMA</code> tables to provide views
          into cached data, and tables in the <code class="literal">mysql</code>
          system database to store this data in persistent form. When
          enabled, the firewall bases its operational decisions on the
          cached data.
        </p><p>
          The <code class="literal">INFORMATION_SCHEMA</code> tables are
          accessible by anyone. The <code class="literal">mysql</code> tables can
          be accessed only by users with privileges for that database.
        </p><p>
          The <code class="literal">INFORMATION_SCHEMA.MYSQL_FIREWALL_USERS</code>
          and <code class="literal">mysql.firewall_users</code> tables list
          registered firewall accounts and their operational modes. The
          tables have these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">USERHOST</code>
            </p><p>
              An account registered with the firewall. Each account has
              the format
              <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
              and represents actual user and host names as authenticated
              by the server. Patterns and netmasks should not be used
              when registering users.
            </p></li><li class="listitem"><p>
              <code class="literal">MODE</code>
            </p><p>
              The current firewall operational mode for the account. The
              permitted mode values are <code class="literal">OFF</code>,
              <code class="literal">DETECTING</code>,
              <code class="literal">PROTECTING</code>,
              <code class="literal">RECORDING</code>, and
              <code class="literal">RESET</code>. For details about their
              meanings, see the description of
              <code class="literal">sp_set_firewall_mode()</code> in
              <a class="xref" href="security.html#firewall-routines" title="6.4.7.4.2 MySQL Enterprise Firewall Procedures and Functions">Section 6.4.7.4.2, “MySQL Enterprise Firewall Procedures and Functions”</a>.
</p></li></ul>
</div>
<p>
          The
          <code class="literal">INFORMATION_SCHEMA.MYSQL_FIREWALL_WHITELIST</code>
          and <code class="literal">mysql.firewall_whitelist</code> tables list
          registered firewall accounts and their whitelists. The tables
          have these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">USERHOST</code>
            </p><p>
              An account registered with the firewall. The format is the
              same as for the user account tables.
            </p></li><li class="listitem"><p>
              <code class="literal">RULE</code>
            </p><p>
              A normalized statement indicating an acceptable statement
              pattern for the account. An account whitelist is the union
              of its rules.
            </p></li><li class="listitem"><p>
              <code class="literal">ID</code>
            </p><p>
              An integer column that is a primary key for the table.
              This column was added in MySQL 8.0.12.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-routines"></a>6.4.7.4.2 MySQL Enterprise Firewall Procedures and Functions</h5>

</div>

</div>

</div>
<p>
          MySQL Enterprise Firewall has stored procedures that perform tasks such as
          registering MySQL accounts with the firewall, establishing
          their operational mode, and managing transfer of firewall data
          between the cache and the underlying system tables. It also
          has a set of user-defined functions (UDFs) that provides an
          SQL-level API for lower-level tasks such as synchronizing the
          cache with the underlying system tables.
        </p><p>
          Under normal operation, the stored procedures implement the
          user interface. The UDFs are invoked by the stored procedures,
          not directly by users.
        </p><p>
          To invoke a stored procedure when the default database is not
          the database that contains the procedure, qualify the
          procedure name with the database name. For example:
        </p><pre data-lang="sql" class="programlisting">
CALL mysql.sp_set_firewall_mode(<em class="replaceable"><code>user</code></em>, <em class="replaceable"><code>mode</code></em>);
</pre><p>
          The following list describes each firewall stored procedure
          and UDF:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">sp_reload_firewall_rules(<em class="replaceable"><code>user</code></em>)</code>
            </p><p>
              This stored procedure uses firewall UDFs to reset a
              registered account and reload the in-memory rules for it
              from the rules stored in the
              <code class="literal">mysql.firewall_whitelist</code> table. This
              procedure provides control over firewall operation for
              individual accounts.
            </p><p>
              The <em class="replaceable"><code>user</code></em> argument names the
              affected account, as a string in
              <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
              format.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
CALL mysql.sp_reload_firewall_rules('fwuser@localhost');
</pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
                This procedure sets the account mode to
                <code class="literal">RESET</code>, which clears the account
                whitelist and sets its mode to <code class="literal">OFF</code>.
                If the account mode was not <code class="literal">OFF</code> prior
                to the <code class="literal">sp_reload_firewall_rules()</code>
                call, use <code class="literal">sp_set_firewall_mode()</code> to
                restore its previous mode after reloading the rules. For
                example, if the account was in
                <code class="literal">PROTECTING</code> mode, that is no longer
                true after calling
                <code class="literal">sp_reload_firewall_rules()</code> and you
                must set it to <code class="literal">PROTECTING</code> again
                explicitly.
</p>
</div>
</li><li class="listitem"><p>
              <code class="literal">sp_set_firewall_mode(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>mode</code></em>)</code>
            </p><p>
              This stored procedure registers a MySQL account with the
              firewall and establishes its operational mode. The
              procedure also invokes firewall UDFs as necessary to
              transfer firewall data between the cache and the
              underlying system tables. This procedure may be called
              even if the <code class="literal">mysql_firewall_mode</code> system
              variable is <code class="literal">OFF</code>, although setting the
              mode for an account has no operational effect while the
              firewall is disabled.
            </p><p>
              The <em class="replaceable"><code>user</code></em> argument names the
              affected account, as a string in
              <code class="literal"><em class="replaceable"><code>user_name</code></em>@<em class="replaceable"><code>host_name</code></em></code>
              format.
            </p><p>
              The <em class="replaceable"><code>mode</code></em> is the operational
              mode for the user, as a string. These mode values are
              permitted:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <code class="literal">OFF</code>: Disable the firewall for the
                  account.
                </p></li><li class="listitem"><p>
                  <code class="literal">DETECTING</code>: Intrusion-detection
                  mode: Write suspicious (nonmatching) statements to the
                  error log but do not deny access.
                </p></li><li class="listitem"><p>
                  <code class="literal">PROTECTING</code>: Protect the account by
                  matching incoming statements against the account
                  whitelist.
                </p></li><li class="listitem"><p>
                  <code class="literal">RECORDING</code>: Training mode: Record
                  acceptable statements for the account. Incoming
                  statements that do not immediately fail with a syntax
                  error are recorded to become part of the account
                  whitelist rules.
                </p></li><li class="listitem"><p>
                  <code class="literal">RESET</code>: Clear the account whitelist
                  and set the account mode to <code class="literal">OFF</code>.
</p></li></ul>
</div>
<p>
              Switching the mode for an account to any mode but
              <code class="literal">RECORDING</code> synchronizes the firewall
              cache data to the underlying <code class="literal">mysql</code>
              system database tables for persistent storage. Switching
              the mode from <code class="literal">OFF</code> to
              <code class="literal">RECORDING</code> reloads the whitelist from
              the <code class="literal">mysql.firewall_whitelist</code> table into
              the cache.
            </p><p>
              If an account has an empty whitelist, setting its mode to
              <code class="literal">PROTECTING</code> produces an error message
              that is returned in a result set, but not an SQL error:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>CALL mysql.sp_set_firewall_mode('a@b','PROTECTING');</code></strong>
+----------------------------------------------------------------------+
| set_firewall_mode(arg_userhost, arg_mode)                            |
+----------------------------------------------------------------------+
| ERROR: PROTECTING mode requested for a@b but the whitelist is empty. |
+----------------------------------------------------------------------+
1 row in set (0.02 sec)

Query OK, 0 rows affected (0.02 sec)
</pre></li><li class="listitem"><p>
              <code class="literal">mysql_firewall_flush_status()</code>
            </p><p>
              This UDF resets several firewall status variables to 0:
            </p><pre data-lang="none" class="programlisting">
Firewall_access_denied
Firewall_access_granted
Firewall_access_suspicious
</pre><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
SELECT mysql_firewall_flush_status();
</pre></li><li class="listitem"><p>
              <code class="literal">normalize_statement(<em class="replaceable"><code>stmt</code></em>)</code>
            </p><p>
              This UDF normalizes an SQL statement into the digest form
              used for whitelist rules.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
SELECT normalize_statement('SELECT * FROM t1 WHERE c1 &gt; 2');
</pre></li><li class="listitem"><p>
              <code class="literal">read_firewall_users(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>mode</code></em>)</code>
            </p><p>
              This aggregate UDF updates the firewall user cache through
              a <code class="literal">SELECT</code> statement on the
              <code class="literal">mysql.firewall_users</code> table.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
SELECT read_firewall_users('fwuser@localhost', 'RECORDING')
FROM mysql.firewall_users;
</pre></li><li class="listitem"><p>
              <code class="literal">read_firewall_whitelist(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>rule</code></em>)</code>
            </p><p>
              This aggregate UDF updates the recorded statement cache
              through a <code class="literal">SELECT</code> statement on the
              <code class="literal">mysql.firewall_whitelist</code> table.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
SELECT read_firewall_whitelist('fwuser@localhost', 'RECORDING')
FROM mysql.firewall_whitelist;
</pre></li><li class="listitem"><p>
              <code class="literal">set_firewall_mode(<em class="replaceable"><code>user</code></em>,
              <em class="replaceable"><code>mode</code></em>)</code>
            </p><p>
              This UDF manages the user cache and establishes the user
              operational mode.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
SELECT set_firewall_mode('fwuser@localhost', 'RECORDING');
</pre></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-system-variables"></a>6.4.7.4.3 MySQL Enterprise Firewall System Variables</h5>

</div>

</div>

</div>
<p>
          MySQL Enterprise Firewall supports the following system variables. Use them to
          configure firewall operation. These variables are unavailable
          unless the firewall is installed (see
          <a class="xref" href="security.html#firewall-installation" title="6.4.7.2 Installing or Uninstalling MySQL Enterprise Firewall">Section 6.4.7.2, “Installing or Uninstalling MySQL Enterprise Firewall”</a>).
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_mysql_firewall_mode"></a>
              <a class="indexterm" name="idm140091711081056"></a>

              <a class="indexterm" name="idm140091711080016"></a>

              <a class="link" href="security.html#sysvar_mysql_firewall_mode"><code class="literal">mysql_firewall_mode</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for mysql_firewall_mode"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--mysql-firewall-mode[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_mysql_firewall_mode">mysql_firewall_mode</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">ON</code></td>
</tr></tbody></table>
</div>
<p>
              Whether MySQL Enterprise Firewall is enabled (the default) or disabled.
            </p></li><li class="listitem"><p><a name="sysvar_mysql_firewall_trace"></a>
              <a class="indexterm" name="idm140091711045360"></a>

              <a class="indexterm" name="idm140091711044320"></a>

              <a class="link" href="security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a>
</p>
<div class="informaltable">
<table frame="box" rules="all" summary="Properties for mysql_firewall_trace"><col width="50%"><col width="50%"><thead><tr><th scope="col">Property</th>
<th scope="col">Value</th>
</tr></thead><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td>
<td><code class="literal">--mysql-firewall-trace[={OFF|ON}]</code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td>
<td>8.0.11</td>
</tr><tr><td scope="row"><span class="bold"><strong>System Variable</strong></span></td>
<td><code class="literal"><a class="link" href="security.html#sysvar_mysql_firewall_trace">mysql_firewall_trace</a></code></td>
</tr><tr><td scope="row"><span class="bold"><strong>Scope</strong></span></td>
<td>Global</td>
</tr><tr><td scope="row"><span class="bold"><strong>Dynamic</strong></span></td>
<td>Yes</td>
</tr><tr><td scope="row"><span class="bold"><strong><a class="link" href="optimization.html#optimizer-hints-set-var" title="Variable-Setting Hint Syntax"><code class="literal">SET_VAR</code></a> Hint Applies</strong></span></td>
<td>No</td>
</tr><tr><td scope="row"><span class="bold"><strong>Type</strong></span></td>
<td>Boolean</td>
</tr><tr><td scope="row"><span class="bold"><strong>Default Value</strong></span></td>
<td><code class="literal">OFF</code></td>
</tr></tbody></table>
</div>
<p>
              Whether the MySQL Enterprise Firewall trace is enabled or disabled (the
              default). When
              <a class="link" href="security.html#sysvar_mysql_firewall_trace"><code class="literal">mysql_firewall_trace</code></a> is
              enabled, for <code class="literal">PROTECTING</code> mode, the
              firewall writes rejected statements to the error log.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="firewall-status-variables"></a>6.4.7.4.4 MySQL Enterprise Firewall Status Variables</h5>

</div>

</div>

</div>
<p>
          MySQL Enterprise Firewall supports the following status variables. Use them to
          obtain information about firewall operational status. These
          variables are unavailable unless the firewall is installed
          (see <a class="xref" href="security.html#firewall-installation" title="6.4.7.2 Installing or Uninstalling MySQL Enterprise Firewall">Section 6.4.7.2, “Installing or Uninstalling MySQL Enterprise Firewall”</a>). Firewall status
          variables are set to 0 whenever the
          <code class="literal">MYSQL_FIREWALL</code> plugin is installed or the
          server is started. Many of them are reset to zero by the
          <code class="literal">mysql_firewall_flush_status()</code> UDF (see
          <a class="xref" href="security.html#firewall-routines" title="6.4.7.4.2 MySQL Enterprise Firewall Procedures and Functions">Section 6.4.7.4.2, “MySQL Enterprise Firewall Procedures and Functions”</a>).
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="statvar_Firewall_access_denied"></a>
              <a class="indexterm" name="idm140091711002336"></a>

              <a class="indexterm" name="idm140091711001296"></a>

              <a class="link" href="security.html#statvar_Firewall_access_denied"><code class="literal">Firewall_access_denied</code></a>
            </p><p>
              The number of statements rejected by MySQL Enterprise Firewall.
            </p></li><li class="listitem"><p><a name="statvar_Firewall_access_granted"></a>
              <a class="indexterm" name="idm140091710996800"></a>

              <a class="indexterm" name="idm140091710995760"></a>

              <a class="link" href="security.html#statvar_Firewall_access_granted"><code class="literal">Firewall_access_granted</code></a>
            </p><p>
              The number of statements accepted by MySQL Enterprise Firewall.
            </p></li><li class="listitem"><p><a name="statvar_Firewall_access_suspicious"></a>
              <a class="indexterm" name="idm140091710991216"></a>

              <a class="indexterm" name="idm140091710990112"></a>

              <a class="link" href="security.html#statvar_Firewall_access_suspicious"><code class="literal">Firewall_access_suspicious</code></a>
            </p><p>
              The number of statements logged by MySQL Enterprise Firewall as suspicious
              for users who are in <code class="literal">DETECTING</code> mode.
            </p></li><li class="listitem"><p><a name="statvar_Firewall_cached_entries"></a>
              <a class="indexterm" name="idm140091710984880"></a>

              <a class="indexterm" name="idm140091710983840"></a>

              <a class="link" href="security.html#statvar_Firewall_cached_entries"><code class="literal">Firewall_cached_entries</code></a>
            </p><p>
              The number of statements recorded by MySQL Enterprise Firewall, including
              duplicates.
</p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="data-masking"></a>6.4.8 MySQL Enterprise Data Masking and De-Identification</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="security.html#data-masking-components">6.4.8.1 MySQL Enterprise Data Masking and De-Identification Components</a></span></dt><dt><span class="section"><a href="security.html#data-masking-installation">6.4.8.2 Installing or Uninstalling MySQL Enterprise Data Masking and De-Identification</a></span></dt><dt><span class="section"><a href="security.html#data-masking-usage">6.4.8.3 Using MySQL Enterprise Data Masking and De-Identification</a></span></dt><dt><span class="section"><a href="security.html#data-masking-reference">6.4.8.4 MySQL Enterprise Data Masking and De-Identification User-Defined Function Reference</a></span></dt></dl>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
        MySQL Enterprise Data Masking and De-Identification is an extension included in MySQL Enterprise Edition, a commercial
        product. To learn more about commercial products,
        <a class="ulink" href="https://www.mysql.com/products/" target="_top">https://www.mysql.com/products/</a>.
</p>
</div>
<p>
      As of MySQL 8.0.13, MySQL Enterprise Edition provides data masking and
      de-identification capabilities:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Transformation of existing data to mask it and remove
          identifying characteristics, such as changing all digits of a
          credit card number but the last four to <code class="literal">'X'</code>
          characters.
        </p></li><li class="listitem"><p>
          Generation of random data, such as email addresses and payment
          card numbers.
</p></li></ul>
</div>
<p>
      The way that applications use these capabilities depends on the
      purpose for which the data will be used and who will access it:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Applications that use sensitive data may protect it by
          performing data masking and permitting use of partially masked
          data for client identification. Example: A call center may ask
          for clients to provide their last four Social Security number
          digits.
        </p></li><li class="listitem"><p>
          Applications that require properly formatted data, but not
          necessarily the original data, can synthesize sample data.
          Example: An application developer who is testing data
          validators but has no access to original data may synthesize
          random data with the same format.
</p></li></ul>
</div>
<p>
      Example 1:
    </p><p>
      Medical research facilities can hold patient data that comprises a
      mix of personal and medical data. This may include genetic
      sequences (long strings), test results stored in JSON format, and
      other data types. Although the data may be used mostly by
      automated analysis software, access to genome data or test results
      of particular patients is still possible. In such cases, data
      masking should be used to render this information not personally
      identifiable.
    </p><p>
      Example 2:
    </p><p>
      A credit card processor company provides a set of services using
      sensitive data, such as:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Processing a large number of financial transactions per
          second.
        </p></li><li class="listitem"><p>
          Storing a large amount of transaction-related data.
        </p></li><li class="listitem"><p>
          Protecting transaction-related data with strict requirements
          for personal data.
        </p></li><li class="listitem"><p>
          Handling client complaints about transactions using reversible
          or partially masked data.
</p></li></ul>
</div>
<p>
      A typical transaction may include many types of sensitive
      information, including:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Credit card number.
        </p></li><li class="listitem"><p>
          Transaction type and amount.
        </p></li><li class="listitem"><p>
          Merchant type.
        </p></li><li class="listitem"><p>
          Transaction cryptogram (to confirm transaction legitimacy).
        </p></li><li class="listitem"><p>
          Geolocation of GPS-equipped terminal (for fraud detection).
</p></li></ul>
</div>
<p>
      Those types of information may then be joined within a bank or
      other card-issuing financial institution with client personal
      data, such as:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Full client name (either person or company).
        </p></li><li class="listitem"><p>
          Address.
        </p></li><li class="listitem"><p>
          Date of birth.
        </p></li><li class="listitem"><p>
          Social Security number.
        </p></li><li class="listitem"><p>
          Email address.
        </p></li><li class="listitem"><p>
          Phone number.
</p></li></ul>
</div>
<p>
      Various employee roles within both the card processing company and
      the financial institution require access to that data. Some of
      these roles may require access only to masked data. Other roles
      may require access to the original data on a case-to-case basis,
      which is recorded in audit logs.
    </p><p>
      Masking and de-identification are core to regulatory compliance,
      so MySQL Enterprise Data Masking and De-Identification can help application developers satisfy privacy
      requirements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          PCI – DSS: Payment Card Data.
        </p></li><li class="listitem"><p>
          HIPAA: Privacy of Health Data, Health Information Technology
          for Economic and Clinical Health Act (HITECH Act).
        </p></li><li class="listitem"><p>
          EU General Data Protection Directive (GDPR): Protection of
          Personal Data.
        </p></li><li class="listitem"><p>
          Data Protection Act (UK): Protection of Personal Data.
        </p></li><li class="listitem"><p>
          Sarbanes Oxley, GLBA, The USA Patriot Act, Identity Theft and
          Assumption Deterrence Act of 1998.
        </p></li><li class="listitem"><p>
          FERPA – Student Data, NASD, CA SB1386 and AB 1950, State
          Data Protection Laws, Basel II.
</p></li></ul>
</div>
<p>
      The following sections describe the components of MySQL Enterprise Data Masking and De-Identification,
      discuss how to install and use it, and provide reference
      information for its components.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="data-masking-components"></a>6.4.8.1 MySQL Enterprise Data Masking and De-Identification Components</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140091710944320"></a><p>
        MySQL Enterprise Data Masking and De-Identification is based on a plugin library that implements these
        components:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            A server-side plugin named <code class="literal">data_masking</code>.
          </p></li><li class="listitem"><p>
            A set of user-defined functions (UDFs) provides an SQL-level
            API for performing masking and de-identification operations.
            Some of these functions require the
            <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="data-masking-installation"></a>6.4.8.2 Installing or Uninstalling MySQL Enterprise Data Masking and De-Identification</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140091710936752"></a><a class="indexterm" name="idm140091710935264"></a><a class="indexterm" name="idm140091710933776"></a><a class="indexterm" name="idm140091710932288"></a><p>
        This section describes how to install or uninstall MySQL Enterprise Data Masking and De-Identification,
        which is implemented as a plugin library file containing a
        plugin and user-defined functions (UDFs). For general
        information about installing or uninstalling plugins and UDFs,
        see <a class="xref" href="server-administration.html#plugin-loading" title="5.6.1 Installing and Uninstalling Plugins">Section 5.6.1, “Installing and Uninstalling Plugins”</a>, and
        <a class="xref" href="server-administration.html#udf-loading" title="5.7.1 Installing and Uninstalling User-Defined Functions">Section 5.7.1, “Installing and Uninstalling User-Defined Functions”</a>.
      </p><p>
        To be usable by the server, the plugin library file must be
        located in the MySQL plugin directory (the directory named by
        the <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> system
        variable). If necessary, configure the plugin directory location
        by setting the value of
        <a class="link" href="server-administration.html#sysvar_plugin_dir"><code class="literal">plugin_dir</code></a> at server startup.
      </p><p>
        The plugin library file base name is
        <code class="literal">data_masking</code>. The file name suffix differs
        per platform (for example, <code class="filename">.so</code> for Unix and
        Unix-like systems, <code class="filename">.dll</code> for Windows).
      </p><p>
        To install the MySQL Enterprise Data Masking and De-Identification plugin and UDFs, use the
        <a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> and
        <a class="link" href="sql-syntax.html#create-function" title="13.1.14 CREATE FUNCTION Syntax"><code class="literal">CREATE FUNCTION</code></a> statements
        (adjust the <code class="filename">.so</code> suffix for your platform as
        necessary):
      </p><pre data-lang="sql" class="programlisting">
INSTALL PLUGIN data_masking SONAME 'data_masking.so';
CREATE FUNCTION gen_blacklist RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION gen_dictionary RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION gen_dictionary_drop RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION gen_dictionary_load RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION gen_range RETURNS INTEGER
  SONAME 'data_masking.so';
CREATE FUNCTION gen_rnd_email RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION gen_rnd_pan RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION gen_rnd_ssn RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION gen_rnd_us_phone RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION mask_inner RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION mask_outer RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION mask_pan RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION mask_pan_relaxed RETURNS STRING
  SONAME 'data_masking.so';
CREATE FUNCTION mask_ssn RETURNS STRING
  SONAME 'data_masking.so';
</pre><p>
        If the plugin and UDFs are used on a master replication server,
        install them on all slave servers as well to avoid replication
        problems.
      </p><p>
        Once installed as just described, the plugin and UDFs remain
        installed until uninstalled. To remove them, use the
        <a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN Syntax"><code class="literal">UNINSTALL PLUGIN</code></a> and
        <a class="link" href="sql-syntax.html#drop-function" title="13.1.26 DROP FUNCTION Syntax"><code class="literal">DROP FUNCTION</code></a> statements:
      </p><pre data-lang="sql" class="programlisting">
UNINSTALL PLUGIN data_masking;
DROP FUNCTION gen_blacklist;
DROP FUNCTION gen_dictionary;
DROP FUNCTION gen_dictionary_drop;
DROP FUNCTION gen_dictionary_load;
DROP FUNCTION gen_range;
DROP FUNCTION gen_rnd_email;
DROP FUNCTION gen_rnd_pan;
DROP FUNCTION gen_rnd_ssn;
DROP FUNCTION gen_rnd_us_phone;
DROP FUNCTION mask_inner;
DROP FUNCTION mask_outer;
DROP FUNCTION mask_pan;
DROP FUNCTION mask_pan_relaxed;
DROP FUNCTION mask_ssn;
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="data-masking-usage"></a>6.4.8.3 Using MySQL Enterprise Data Masking and De-Identification</h4>

</div>

</div>

</div>
<p>
        Before using MySQL Enterprise Data Masking and De-Identification, install it according to the instructions
        provided at <a class="xref" href="security.html#data-masking-installation" title="6.4.8.2 Installing or Uninstalling MySQL Enterprise Data Masking and De-Identification">Section 6.4.8.2, “Installing or Uninstalling MySQL Enterprise Data Masking and De-Identification”</a>.
      </p><p>
        To use MySQL Enterprise Data Masking and De-Identification in applications, invoke the functions that are
        appropriate for the operations you wish to perform. For detailed
        function descriptions, see
        <a class="xref" href="security.html#data-masking-reference" title="6.4.8.4 MySQL Enterprise Data Masking and De-Identification User-Defined Function Reference">Section 6.4.8.4, “MySQL Enterprise Data Masking and De-Identification User-Defined Function Reference”</a>. This section
        demonstrates how to use the functions to carry out some
        representative tasks. It first presents an overview of the
        available functions, followed by some examples of how the
        functions might be used in real-world context:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#data-masking-usage-masking-functions" title="Masking Data to Remove Identifying Characteristics">Masking Data to Remove Identifying Characteristics</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-usage-generation-functions" title="Generating Random Data with Specific Characteristics">Generating Random Data with Specific Characteristics</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-usage-dictionary-functions" title="Generating Random Data Using Dictionaries">Generating Random Data Using Dictionaries</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-usage-customer-identification" title="Using Masked Data for Customer Identification">Using Masked Data for Customer Identification</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-usage-views" title="Creating Views that Display Masked Data">Creating Views that Display Masked Data</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="data-masking-usage-masking-functions"></a>Masking Data to Remove Identifying Characteristics</h5>

</div>

</div>

</div>
<p>
          MySQL provides general-purpose masking functions that mask
          arbitrary strings, and special-purpose masking functions that
          mask specific types of values.
        </p><h6><a name="idm140091710900432"></a>General-Purpose Masking Functions</h6><p>
          <a class="link" href="security.html#udf_mask-inner"><code class="literal">mask_inner()</code></a> and
          <a class="link" href="security.html#udf_mask-outer"><code class="literal">mask_outer()</code></a> are general-purpose
          functions that mask parts of arbitrary strings based on
          position within the string:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="security.html#udf_mask-inner"><code class="literal">mask_inner()</code></a> masks the
              interior of its string argument, leaving the ends
              unmasked. Other arguments specify the sizes of the
              unmasked ends.
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_inner('This is a string', 5, 1);</code></strong>
+--------------------------------------+
| mask_inner('This is a string', 5, 1) |
+--------------------------------------+
| This XXXXXXXXXXg                     |
+--------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_inner('This is a string', 1, 5);</code></strong>
+--------------------------------------+
| mask_inner('This is a string', 1, 5) |
+--------------------------------------+
| TXXXXXXXXXXtring                     |
+--------------------------------------+
</pre></li><li class="listitem"><p>
              <a class="link" href="security.html#udf_mask-outer"><code class="literal">mask_outer()</code></a> does the
              reverse, masking the ends of its string argument, leaving
              the interior unmasked. Other arguments specify the sizes
              of the masked ends.
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_outer('This is a string', 5, 1);</code></strong>
+--------------------------------------+
| mask_outer('This is a string', 5, 1) |
+--------------------------------------+
| XXXXXis a strinX                     |
+--------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_outer('This is a string', 1, 5);</code></strong>
+--------------------------------------+
| mask_outer('This is a string', 1, 5) |
+--------------------------------------+
| Xhis is a sXXXXX                     |
+--------------------------------------+
</pre></li></ul>
</div>
<p>
          By default, <a class="link" href="security.html#udf_mask-inner"><code class="literal">mask_inner()</code></a> and
          <a class="link" href="security.html#udf_mask-outer"><code class="literal">mask_outer()</code></a> use
          <code class="literal">'X'</code> as the masking character, but permit an
          optional masking-character argument:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_inner('This is a string', 5, 1, '*');</code></strong>
+-------------------------------------------+
| mask_inner('This is a string', 5, 1, '*') |
+-------------------------------------------+
| This **********g                          |
+-------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_outer('This is a string', 5, 1, '#');</code></strong>
+-------------------------------------------+
| mask_outer('This is a string', 5, 1, '#') |
+-------------------------------------------+
| #####is a strin#                          |
+-------------------------------------------+
</pre><h6><a name="idm140091710878960"></a>Special-Purpose Masking Functions</h6><p>
          Other masking functions expect a string argument representing
          a specific type of value and mask it to remove identifying
          characteristics.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            The examples here supply function arguments using the random
            value generation functions that return the appropriate type
            of value. For more information about generation functions,
            see
            <a class="xref" href="security.html#data-masking-usage-generation-functions" title="Generating Random Data with Specific Characteristics">Generating Random Data with Specific Characteristics</a>.
</p>
</div>
<p><b>Payment card Primary Account Number masking. </b>
            Masking functions provide strict and relaxed masking of
            Primary Account Numbers.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <a class="link" href="security.html#udf_mask-pan"><code class="literal">mask_pan()</code></a> masks all but the
              last four digits of the number:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_pan(gen_rnd_pan());</code></strong>
+-------------------------+
| mask_pan(gen_rnd_pan()) |
+-------------------------+
| XXXXXXXXXXXX2461        |
+-------------------------+
</pre></li><li class="listitem"><p>
              <a class="link" href="security.html#udf_mask-pan-relaxed"><code class="literal">mask_pan_relaxed()</code></a> is
              similar but does not mask the first six digits that
              indicate the payment card issuer unmasked:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed(gen_rnd_pan());</code></strong>
+---------------------------------+
| mask_pan_relaxed(gen_rnd_pan()) |
+---------------------------------+
| 770630XXXXXX0807                |
+---------------------------------+
</pre></li></ul>
</div>
<p><b>U.S. Social Security number masking. </b>
            <a class="link" href="security.html#udf_mask-ssn"><code class="literal">mask_ssn()</code></a> masks all but the
            last four digits of the number:
          </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_ssn(gen_rnd_ssn());</code></strong>
+-------------------------+
| mask_ssn(gen_rnd_ssn()) |
+-------------------------+
| XXX-XX-1723             |
+-------------------------+
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="data-masking-usage-generation-functions"></a>Generating Random Data with Specific Characteristics</h5>

</div>

</div>

</div>
<p>
          Several functions generate random values. These values can be
          used for testing, simulation, and so forth.
        </p><p>
          <a class="link" href="security.html#udf_gen-range"><code class="literal">gen_range()</code></a> returns a random
          integer selected from a given range:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_range(1, 10);</code></strong>
+------------------+
| gen_range(1, 10) |
+------------------+
|                6 |
+------------------+
</pre><p>
          <a class="link" href="security.html#udf_gen-rnd-email"><code class="literal">gen_rnd_email()</code></a> returns a random
          email address in the <code class="literal">example.com</code> domain:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_email();</code></strong>
+---------------------------+
| gen_rnd_email()           |
+---------------------------+
| ayxnq.xmkpvvy@example.com |
+---------------------------+
</pre><p>
          <a class="link" href="security.html#udf_gen-rnd-pan"><code class="literal">gen_rnd_pan()</code></a> returns a random
          payment card Primary Account Number:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_pan();</code></strong>
</pre><p>
          (The <a class="link" href="security.html#udf_gen-rnd-pan"><code class="literal">gen_rnd_pan()</code></a> function
          result is not shown because its return values should be used
          only for testing purposes, and not for publication. It cannot
          be guaranteed the number is not assigned to a legitimate
          payment account.)
        </p><p>
          <a class="link" href="security.html#udf_gen-rnd-ssn"><code class="literal">gen_rnd_ssn()</code></a> returns a random
          U.S. Social Security number with the first and second parts
          each chosen from a range not used for legitimate numbers:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_ssn();</code></strong>
+---------------+
| gen_rnd_ssn() |
+---------------+
| 912-45-1615   |
+---------------+
</pre><p>
          <a class="link" href="security.html#udf_gen-rnd-us-phone"><code class="literal">gen_rnd_us_phone()</code></a> returns a
          random U.S. phone number in the 555 area code not used for
          legitimate numbers:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_us_phone();</code></strong>
+--------------------+
| gen_rnd_us_phone() |
+--------------------+
| 1-555-747-5627     |
+--------------------+
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="data-masking-usage-dictionary-functions"></a>Generating Random Data Using Dictionaries</h5>

</div>

</div>

</div>
<p>
          MySQL Enterprise Data Masking and De-Identification enables dictionaries to be used as sources of random
          values. To use a dictionary, it must first be loaded from a
          file and given a name. Each loaded dictionary becomes part of
          the dictionary registry. Items then can be selected from
          registered dictionaries and used as random values or as
          replacements for other values.
        </p><p>
          A valid dictionary file has these characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              The file contents are plain text, one term per line.
            </p></li><li class="listitem"><p>
              Empty lines are ignored.
            </p></li><li class="listitem"><p>
              The file must contain at least one term.
</p></li></ul>
</div>
<p>
          Suppose that a file named <code class="filename">de_cities.txt</code>
          contains these city names in Germany:
        </p><pre data-lang="none" class="programlisting">
Berlin
Munich
Bremen
</pre><p>
          Also suppose that a file named
          <code class="filename">us_cities.txt</code> contains these city names
          in the United States:
        </p><pre data-lang="none" class="programlisting">
Chicago
Houston
Phoenix
El Paso
Detroit
</pre><p>
          Assume that the
          <a class="link" href="server-administration.html#sysvar_secure_file_priv"><code class="literal">secure_file_priv</code></a> system
          variable is set to
          <code class="filename">/usr/local/mysql/mysql-files</code>. In that
          case, copy the dictionary files to that directory so that the
          MySQL server can access them. Then use
          <a class="link" href="security.html#udf_gen-dictionary-load"><code class="literal">gen_dictionary_load()</code></a> to load
          the dictionaries into the dictionary registry and assign them
          names:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_load('/usr/local/mysql/mysql-files/de_cities.txt', 'DE_Cities');</code></strong>
+--------------------------------------------------------------------------------+
| gen_dictionary_load('/usr/local/mysql/mysql-files/de_cities.txt', 'DE_Cities') |
+--------------------------------------------------------------------------------+
| Dictionary load success                                                        |
+--------------------------------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_load('/usr/local/mysql/mysql-files/us_cities.txt', 'US_Cities');</code></strong>
+--------------------------------------------------------------------------------+
| gen_dictionary_load('/usr/local/mysql/mysql-files/us_cities.txt', 'US_Cities') |
+--------------------------------------------------------------------------------+
| Dictionary load success                                                        |
+--------------------------------------------------------------------------------+
</pre><p>
          To select a random term from a dictionary, use
          <a class="link" href="security.html#udf_gen-dictionary"><code class="literal">gen_dictionary()</code></a>:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary('DE_Cities');</code></strong>
+-----------------------------+
| gen_dictionary('DE_Cities') |
+-----------------------------+
| Berlin                      |
+-----------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary('US_Cities');</code></strong>
+-----------------------------+
| gen_dictionary('US_Cities') |
+-----------------------------+
| Phoenix                     |
+-----------------------------+
</pre><p>
          To select a random term from multiple dictionaries, randomly
          select one of the dictionaries, then select a term from it:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary(ELT(gen_range(1,2), 'DE_Cities', 'US_Cities'));</code></strong>
+---------------------------------------------------------------+
| gen_dictionary(ELT(gen_range(1,2), 'DE_Cities', 'US_Cities')) |
+---------------------------------------------------------------+
| Detroit                                                       |
+---------------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary(ELT(gen_range(1,2), 'DE_Cities', 'US_Cities'));</code></strong>
+---------------------------------------------------------------+
| gen_dictionary(ELT(gen_range(1,2), 'DE_Cities', 'US_Cities')) |
+---------------------------------------------------------------+
| Bremen                                                        |
+---------------------------------------------------------------+
</pre><p>
          The <a class="link" href="security.html#udf_gen-blacklist"><code class="literal">gen_blacklist()</code></a> function
          enables a term from one dictionary to be replaced by a term
          from another dictionary, which effects masking by
          substitution. Its arguments are the term to replace, the
          dictionary in which the term appears, and the dictionary from
          which to choose a replacement. For example, to substitute a
          U.S. city for a German city, or vice versa, use
          <a class="link" href="security.html#udf_gen-blacklist"><code class="literal">gen_blacklist()</code></a> like this:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_blacklist('Munich', 'DE_Cities', 'US_Cities');</code></strong>
+---------------------------------------------------+
| gen_blacklist('Munich', 'DE_Cities', 'US_Cities') |
+---------------------------------------------------+
| Houston                                           |
+---------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_blacklist('El Paso', 'US_Cities', 'DE_Cities');</code></strong>
+----------------------------------------------------+
| gen_blacklist('El Paso', 'US_Cities', 'DE_Cities') |
+----------------------------------------------------+
| Bremen                                             |
+----------------------------------------------------+
</pre><p>
          If the term to replace is not in the first dictionary,
          <a class="link" href="security.html#udf_gen-blacklist"><code class="literal">gen_blacklist()</code></a> returns it
          unchanged:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_blacklist('Moscow', 'DE_Cities', 'US_Cities');</code></strong>
+---------------------------------------------------+
| gen_blacklist('Moscow', 'DE_Cities', 'US_Cities') |
+---------------------------------------------------+
| Moscow                                            |
+---------------------------------------------------+
</pre>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="data-masking-usage-customer-identification"></a>Using Masked Data for Customer Identification</h5>

</div>

</div>

</div>
<p>
          At customer-service call centers, one common identity
          verification technique is to ask customers to provide their
          last four Social Security number (SSN) digits. For example, a
          customer might say her name is Joanna Bond and that her last
          four SSN digits are <code class="literal">0007</code>.
        </p><p>
          Suppose that a <code class="literal">customer</code> table containing
          customer records has these columns:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal">id</code>: Customer ID number.
            </p></li><li class="listitem"><p>
              <code class="literal">first_name</code>: Customer first name.
            </p></li><li class="listitem"><p>
              <code class="literal">last_name</code>: Customer last name.
            </p></li><li class="listitem"><p>
              <code class="literal">ssn</code>: Customer Social Security number.
</p></li></ul>
</div>
<p>
          The application used by customer-service representatives to
          check the customer SSN might execute a query like this:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT id, ssn</code></strong>
mysql&gt; <strong class="userinput"><code>FROM customer</code></strong>
mysql&gt; <strong class="userinput"><code>WHERE first_name = 'Joanna' AND last_name = 'Bond';</code></strong>
+-----+-------------+
| id  | ssn         |
+-----+-------------+
| 786 | 906-39-0007 |
+-----+-------------+
</pre><p>
          However, that exposes the SSN to the customer-service
          representative, who has no need to see anything but the last
          four digits. Instead, the application can use this query to
          display only the masked SSN:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT id, mask_ssn(CONVERT(ssn USING binary))</code></strong>
mysql&gt; <strong class="userinput"><code>FROM customer</code></strong>
mysql&gt; <strong class="userinput"><code>WHERE first_name = 'Joanna' AND last_name = 'Bond';</code></strong>
+-----+-------------------------------------+
| id  | mask_ssn(CONVERT(ssn USING binary)) |
+-----+-------------------------------------+
| 786 | XXX-XX-0007                         |
+-----+-------------------------------------+
</pre><p>
          Now the representative sees only what is necessary, and
          customer privacy is preserved.
        </p><p>
          Why was the <a class="link" href="functions.html#function_convert"><code class="literal">CONVERT()</code></a> function
          used for the argument to
          <a class="link" href="security.html#udf_mask-ssn"><code class="literal">mask_ssn()</code></a>? Because
          <a class="link" href="security.html#udf_mask-ssn"><code class="literal">mask_ssn()</code></a> requires an argument
          of length 11, and because UDFs treat string arguments as
          binary strings, with one byte per character. Thus, even though
          <code class="literal">ssn</code> is defined as
          <code class="literal">VARCHAR(11)</code>, if the <code class="literal">ssn</code>
          column has a multibyte character set, it appears to be longer
          than 11 bytes when passed to a UDF, and an error occurs.
          Converting the value to a binary string ensures that the UDF
          sees an argument of length 11.
        </p><p>
          A similar technique may be needed for other data masking
          functions when string arguments do not have a single-byte
          character set.
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="data-masking-usage-views"></a>Creating Views that Display Masked Data</h5>

</div>

</div>

</div>
<p>
          If masked data from a table is used for multiple queries, it
          may be convenient to define a view that produces masked data.
          That way, applications can select from the view without
          performing masking in individual queries.
        </p><p>
          For example, a masking view on the <code class="literal">customer</code>
          table from the previous section can be defined like this:
        </p><pre data-lang="sql" class="programlisting">
CREATE VIEW masked_customer AS
SELECT id, first_name, last_name, mask_ssn(CONVERT(ssn USING binary)) AS ssn
FROM customer;
</pre><p>
          Then the query to look up a customer becomes simpler but still
          returns masked data:
        </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT id, ssn</code></strong>
mysql&gt; <strong class="userinput"><code>FROM masked_customer</code></strong>
mysql&gt; <strong class="userinput"><code>WHERE first_name = 'Joanna' AND last_name = 'Bond';</code></strong>
+-----+-------------+
| id  | ssn         |
+-----+-------------+
| 786 | XXX-XX-0007 |
+-----+-------------+
</pre>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="data-masking-reference"></a>6.4.8.4 MySQL Enterprise Data Masking and De-Identification User-Defined Function Reference</h4>

</div>

</div>

</div>
<p>
        The MySQL Enterprise Data Masking and De-Identification plugin library includes several user-defined
        functions (UDFs), which may be grouped into these categories:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#data-masking-masking-functions" title="Data Masking Functions">Data Masking Functions</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-generation-functions" title="Random Data Generation Functions">Random Data Generation Functions</a></p></li><li class="listitem"><p><a class="xref" href="security.html#data-masking-dictionary-functions" title="Random Data Dictionary-Based Functions">Random Data Dictionary-Based Functions</a></p></li></ul>
</div>
<p>
        These UDFs treat string arguments as binary strings, which means
        they are implicitly case sensitive. In addition, string UDF
        return values are binary strings. If a string return value
        should be in a different character set, convert it. The
        following example shows how to convert the result of
        <a class="link" href="security.html#udf_gen-rnd-email"><code class="literal">gen_rnd_email()</code></a> to the
        <code class="literal">utf8mb4</code> character set:
      </p><pre data-lang="sql" class="programlisting">
SET @email = CONVERT(gen_rnd_email() USING utf8mb4);
</pre><p>
        It may also be necessary to convert string arguments, as
        illustrated in
        <a class="xref" href="security.html#data-masking-usage-customer-identification" title="Using Masked Data for Customer Identification">Using Masked Data for Customer Identification</a>.
</p>
<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h5 class="title"><a name="data-masking-masking-functions"></a>Data Masking Functions</h5>
</div>
</div>
</div>
<p>
          Each function in this section performs a masking operation on
          its string argument and returns the masked result.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="udf_mask-inner"></a>
              <a class="link" href="security.html#udf_mask-inner"><code class="literal">mask_inner(<em class="replaceable"><code>str</code></em>,
              <em class="replaceable"><code>margin1</code></em>,
              <em class="replaceable"><code>margin2</code></em> [,
              <em class="replaceable"><code>mask_char</code></em>])</code></a>
            </p><a class="indexterm" name="idm140091710752432"></a><a class="indexterm" name="idm140091710751312"></a><p>
              Masks the interior part of a string, leaving the ends
              untouched, and returns the result. An optional masking
              character can be specified.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>str</code></em>: The string to mask.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>margin1</code></em>: A nonnegative
                  integer that specifies the number of characters on the
                  left end of the string to remain unmasked. If the
                  value is 0, no left end characters remain unmasked.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>margin2</code></em>: A nonnegative
                  integer that specifies the number of characters on the
                  right end of the string to remain unmasked. If the
                  value is 0, no right end characters remain unmasked.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>mask_char</code></em>: (Optional) The
                  single character to use for masking. The default is
                  <code class="literal">'X'</code> if
                  <em class="replaceable"><code>mask_char</code></em> is not given.
                </p><p>
                  Because UDF string arguments are treated as binary
                  strings, the masking character must be a single-byte
                  character. Attempts to use a multibyte character
                  produce an error.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              The masked string, or <code class="literal">NULL</code> if either
              margin is negative.
            </p><p>
              If the sum of the margin values is larger than the
              argument length, no masking occurs and the argument is
              returned unchanged.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_inner('abcdef', 1, 2), mask_inner('abcdef',0, 5);</code></strong>
+----------------------------+---------------------------+
| mask_inner('abcdef', 1, 2) | mask_inner('abcdef',0, 5) |
+----------------------------+---------------------------+
| aXXXef                     | Xbcdef                    |
+----------------------------+---------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_inner('abcdef', 1, 2, '*'), mask_inner('abcdef',0, 5, '#');</code></strong>
+---------------------------------+--------------------------------+
| mask_inner('abcdef', 1, 2, '*') | mask_inner('abcdef',0, 5, '#') |
+---------------------------------+--------------------------------+
| a***ef                          | #bcdef                         |
+---------------------------------+--------------------------------+
</pre></li><li class="listitem"><p><a name="udf_mask-outer"></a>
              <a class="link" href="security.html#udf_mask-outer"><code class="literal">mask_outer(<em class="replaceable"><code>str</code></em>,
              <em class="replaceable"><code>margin1</code></em>,
              <em class="replaceable"><code>margin2</code></em> [,
              <em class="replaceable"><code>mask_char</code></em>])</code></a>
            </p><a class="indexterm" name="idm140091710730992"></a><a class="indexterm" name="idm140091710729872"></a><p>
              Masks the left and right ends of a string, leaving the
              interior unmasked, and returns the result. An optional
              masking character can be specified.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>str</code></em>: The string to mask.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>margin1</code></em>: A nonnegative
                  integer that specifies the number of characters on the
                  left end of the string to mask. If the value is 0, no
                  left end characters are masked.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>margin2</code></em>: A nonnegative
                  integer that specifies the number of characters on the
                  right end of the string to mask. If the value is 0, no
                  right end characters are masked.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>mask_char</code></em>: (Optional) The
                  single character to use for masking. The default is
                  <code class="literal">'X'</code> if
                  <em class="replaceable"><code>mask_char</code></em> is not given.
                </p><p>
                  Because UDF string arguments are treated as binary
                  strings, the masking character must be a single-byte
                  character. Attempts to use a multibyte character
                  produce an error.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              The masked string, or <code class="literal">NULL</code> if either
              margin is negative.
            </p><p>
              If the sum of the margin values is larger than the
              argument length, the entire argument is masked.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_outer('abcdef', 1, 2), mask_outer('abcdef',0, 5);</code></strong>
+----------------------------+---------------------------+
| mask_outer('abcdef', 1, 2) | mask_outer('abcdef',0, 5) |
+----------------------------+---------------------------+
| XbcdXX                     | aXXXXX                    |
+----------------------------+---------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_outer('abcdef', 1, 2, '*'), mask_outer('abcdef',0, 5, '#');</code></strong>
+---------------------------------+--------------------------------+
| mask_outer('abcdef', 1, 2, '*') | mask_outer('abcdef',0, 5, '#') |
+---------------------------------+--------------------------------+
| *bcd**                          | a#####                         |
+---------------------------------+--------------------------------+
</pre></li><li class="listitem"><p><a name="udf_mask-pan"></a>
              <a class="link" href="security.html#udf_mask-pan"><code class="literal">mask_pan(<em class="replaceable"><code>str</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091710710944"></a><a class="indexterm" name="idm140091710709824"></a><p>
              Masks a payment card Primary Account Number and returns
              the number with all but the last four digits replaced by
              <code class="literal">'X'</code> characters.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>str</code></em>: The string to mask.
                  The string must be a suitable length for the Primary
                  Account Number, but is not otherwise checked.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              The masked payment number as a string. If the argument is
              shorter than required, it is returned unchanged.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_pan(gen_rnd_pan());</code></strong>
+-------------------------+
| mask_pan(gen_rnd_pan()) |
+-------------------------+
| XXXXXXXXXXXX9102        |
+-------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan(gen_rnd_pan(19));</code></strong>
+---------------------------+
| mask_pan(gen_rnd_pan(19)) |
+---------------------------+
| XXXXXXXXXXXXXXX8268       |
+---------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan('a*Z');</code></strong>
+-----------------+
| mask_pan('a*Z') |
+-----------------+
| a*Z             |
+-----------------+
</pre></li><li class="listitem"><p><a name="udf_mask-pan-relaxed"></a>
              <a class="link" href="security.html#udf_mask-pan-relaxed"><code class="literal">mask_pan_relaxed(<em class="replaceable"><code>str</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091710696944"></a><a class="indexterm" name="idm140091710695808"></a><p>
              Masks a payment card Primary Account Number and returns
              the number with all but the first six and last four digits
              replaced by <code class="literal">'X'</code> characters. The first
              six digits indicate the payment card issuer.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>str</code></em>: The string to mask.
                  The string must be a suitable length for the Primary
                  Account Number, but is not otherwise checked.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              The masked payment number as a string. If the argument is
              shorter than required, it is returned unchanged.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed(gen_rnd_pan());</code></strong>
+---------------------------------+
| mask_pan_relaxed(gen_rnd_pan()) |
+---------------------------------+
| 551279XXXXXX3108                |
+---------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed(gen_rnd_pan(19));</code></strong>
+-----------------------------------+
| mask_pan_relaxed(gen_rnd_pan(19)) |
+-----------------------------------+
| 462634XXXXXXXXX6739               |
+-----------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed('a*Z');</code></strong>
+-------------------------+
| mask_pan_relaxed('a*Z') |
+-------------------------+
| a*Z                     |
+-------------------------+
</pre></li><li class="listitem"><p><a name="udf_mask-ssn"></a>
              <a class="link" href="security.html#udf_mask-ssn"><code class="literal">mask_ssn(<em class="replaceable"><code>str</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091710682608"></a><a class="indexterm" name="idm140091710681488"></a><p>
              Masks a U.S. Social Security number and returns the number
              with all but the last four digits replaced by
              <code class="literal">'X'</code> characters.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>str</code></em>: The string to mask.
                  The string must be 11 characters long, but is not
                  otherwise checked.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              The masked Social Security number as a string, or
              <code class="literal">NULL</code> if the argument is not the correct
              length.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_ssn('909-63-6922'), mask_ssn('abcdefghijk');</code></strong>
+-------------------------+-------------------------+
| mask_ssn('909-63-6922') | mask_ssn('abcdefghijk') |
+-------------------------+-------------------------+
| XXX-XX-6922             | XXX-XX-hijk             |
+-------------------------+-------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_ssn('909');</code></strong>
+-----------------+
| mask_ssn('909') |
+-----------------+
| NULL            |
+-----------------+
</pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="data-masking-generation-functions"></a>Random Data Generation Functions</h5>

</div>

</div>

</div>
<p>
          The functions in this section generate random values for
          different types of data. When possible, generated values have
          characteristics reserved for demonstration or test values, to
          avoid having them mistaken for legitimate data. For example,
          <a class="link" href="security.html#udf_gen-rnd-us-phone"><code class="literal">gen_rnd_us_phone()</code></a> returns a
          U.S. phone number that uses the 555 area code, which is not
          assigned to phone numbers in actual use. Individual function
          descriptions describe any exceptions to this principle.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="udf_gen-range"></a>
              <a class="link" href="security.html#udf_gen-range"><code class="literal">gen_range(<em class="replaceable"><code>lower</code></em>,
              <em class="replaceable"><code>upper</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091710664352"></a><a class="indexterm" name="idm140091710663232"></a><p>
              Generates a random number chosen from a specified range.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>lower</code></em>: An integer that
                  specifies the lower boundary of the range.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>upper</code></em>: An integer that
                  specifies the upper boundary of the range, which must
                  not be less than the lower boundary.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              A random integer in the range from
              <em class="replaceable"><code>lower</code></em> to
              <em class="replaceable"><code>upper</code></em>, inclusive, or
              <code class="literal">NULL</code> if the
              <em class="replaceable"><code>upper</code></em> argument is less than
              <em class="replaceable"><code>lower</code></em>.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_range(100, 200), gen_range(-1000, -800);</code></strong>
+---------------------+------------------------+
| gen_range(100, 200) | gen_range(-1000, -800) |
+---------------------+------------------------+
|                 177 |                   -917 |
+---------------------+------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_range(1, 0);</code></strong>
+-----------------+
| gen_range(1, 0) |
+-----------------+
|            NULL |
+-----------------+
</pre></li><li class="listitem"><p><a name="udf_gen-rnd-email"></a>
              <a class="link" href="security.html#udf_gen-rnd-email"><code class="literal">gen_rnd_email()</code></a>
            </p><a class="indexterm" name="idm140091710648480"></a><a class="indexterm" name="idm140091710647360"></a><p>
              Generates a random email address in the
              <code class="literal">example.com</code> domain.
            </p><p>
              Arguments:
            </p><p>
              None.
            </p><p>
              Return value:
            </p><p>
              A random email address as a string.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_email();</code></strong>
+---------------------------+
| gen_rnd_email()           |
+---------------------------+
| ijocv.mwvhhuf@example.com |
+---------------------------+
</pre></li><li class="listitem"><p><a name="udf_gen-rnd-pan"></a>
              <a class="link" href="security.html#udf_gen-rnd-pan"><code class="literal">gen_rnd_pan([<em class="replaceable"><code>size</code></em>])</code></a>
            </p><a class="indexterm" name="idm140091710637840"></a><a class="indexterm" name="idm140091710636720"></a><p>
              Generates a random payment card Primary Account Number.
              The number passes the Luhn check (an algorithm that
              performs a checksum verification against a check digit).
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
                Values returned from
                <a class="link" href="security.html#udf_gen-rnd-pan"><code class="literal">gen_rnd_pan()</code></a> should be
                used only for test purposes, and are not suitable for
                publication. There is no way to guarantee that a given
                return value is not assigned to a legitimate payment
                account. Should it be necessary to publish a
                <a class="link" href="security.html#udf_gen-rnd-pan"><code class="literal">gen_rnd_pan()</code></a> result,
                consider masking it with
                <a class="link" href="security.html#udf_mask-pan"><code class="literal">mask_pan()</code></a> or
                <a class="link" href="security.html#udf_mask-pan-relaxed"><code class="literal">mask_pan_relaxed()</code></a>.
</p>
</div>
<p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>size</code></em>: (Optional) An integer
                  that specifies the size of the result. The default is
                  16 if <em class="replaceable"><code>size</code></em> is not given. If
                  given, <em class="replaceable"><code>size</code></em> must be an
                  integer in the range from 12 to 19.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              A random payment number as a string, or
              <code class="literal">NULL</code> if a
              <em class="replaceable"><code>size</code></em> argument outside the
              permitted range is given.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT mask_pan(gen_rnd_pan());</code></strong>
+-------------------------+
| mask_pan(gen_rnd_pan()) |
+-------------------------+
| XXXXXXXXXXXX5805        |
+-------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan(gen_rnd_pan(19));</code></strong>
+---------------------------+
| mask_pan(gen_rnd_pan(19)) |
+---------------------------+
| XXXXXXXXXXXXXXX5067       |
+---------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed(gen_rnd_pan());</code></strong>
+---------------------------------+
| mask_pan_relaxed(gen_rnd_pan()) |
+---------------------------------+
| 398403XXXXXX9547                |
+---------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT mask_pan_relaxed(gen_rnd_pan(19));</code></strong>
+-----------------------------------+
| mask_pan_relaxed(gen_rnd_pan(19)) |
+-----------------------------------+
| 578416XXXXXXXXX6509               |
+-----------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_pan(11), gen_rnd_pan(20);</code></strong>
+-----------------+-----------------+
| gen_rnd_pan(11) | gen_rnd_pan(20) |
+-----------------+-----------------+
| NULL            | NULL            |
+-----------------+-----------------+
</pre></li><li class="listitem"><p><a name="udf_gen-rnd-ssn"></a>
              <a class="link" href="security.html#udf_gen-rnd-ssn"><code class="literal">gen_rnd_ssn()</code></a>
            </p><a class="indexterm" name="idm140091710614224"></a><a class="indexterm" name="idm140091710613104"></a><p>
              Generates a random U.S. Social Security number in
              <code class="literal"><em class="replaceable"><code>AAA</code></em>-<em class="replaceable"><code>BB</code></em>-<em class="replaceable"><code>CCCC</code></em></code>
              format. The <em class="replaceable"><code>AAA</code></em> part is greater
              than 900 and the <em class="replaceable"><code>BB</code></em> part is
              less than 70, which are characteristics not used for
              legitimate Social Security numbers.
            </p><p>
              Arguments:
            </p><p>
              None.
            </p><p>
              Return value:
            </p><p>
              A random Social Security number as a string.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_ssn();</code></strong>
+---------------+
| gen_rnd_ssn() |
+---------------+
| 951-26-0058   |
+---------------+
</pre></li><li class="listitem"><p><a name="udf_gen-rnd-us-phone"></a>
              <a class="link" href="security.html#udf_gen-rnd-us-phone"><code class="literal">gen_rnd_us_phone()</code></a>
            </p><a class="indexterm" name="idm140091710602016"></a><a class="indexterm" name="idm140091710600880"></a><p>
              Generates a random U.S. phone number in
              <code class="literal">1-555-<em class="replaceable"><code>AAA</code></em>-<em class="replaceable"><code>BBBB</code></em></code>
              format. The 555 area code is not used for legitimate phone
              numbers.
            </p><p>
              Arguments:
            </p><p>
              None.
            </p><p>
              Return value:
            </p><p>
              A random U.S. phone number as a string.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_rnd_us_phone();</code></strong>
+--------------------+
| gen_rnd_us_phone() |
+--------------------+
| 1-555-682-5423     |
+--------------------+
</pre></li></ul>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h5 class="title"><a name="data-masking-dictionary-functions"></a>Random Data Dictionary-Based Functions</h5>

</div>

</div>

</div>
<p>
          The functions in this section manipulate dictionaries of terms
          and perform generation and masking operations based on them.
          Some of these functions require the
          <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege.
        </p><p>
          When a dictionary is loaded, it becomes part of the dictionary
          registry and is assigned a name to be used by other dictionary
          functions. Dictionaries are loaded from plain text files
          containing one term per line. Empty lines are ignored. To be
          valid, a dictionary file must contain at least one nonempty
          line.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="udf_gen-blacklist"></a>
              <a class="link" href="security.html#udf_gen-blacklist"><code class="literal">gen_blacklist(<em class="replaceable"><code>str</code></em>,
              <em class="replaceable"><code>dictionary_name</code></em>,
              <em class="replaceable"><code>replacement_dictionary_name</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091710585440"></a><a class="indexterm" name="idm140091710584320"></a><p>
              Replaces a term present in one dictionary with a term from
              a second dictionary and returns the replacement term. This
              masks the original term by substitution.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>str</code></em>: A string that
                  indicates the term to replace.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>dictionary_name</code></em>: A string
                  that names the dictionary containing the term to
                  replace.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>replacement_dictionary_name</code></em>:
                  A string that names the dictionary from which to
                  choose the replacement term.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              A string randomly chosen from
              <em class="replaceable"><code>replacement_dictionary_name</code></em> as
              a replacement for <em class="replaceable"><code>str</code></em>, or
              <em class="replaceable"><code>str</code></em> if it does not appear in
              <em class="replaceable"><code>dictionary_name</code></em>, or
              <code class="literal">NULL</code> if either dictionary name is not
              in the dictionary registry.
            </p><p>
              If the term to replace appears in both dictionaries, it is
              possible for the return value to be the same term.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_blacklist('Berlin', 'DE_Cities', 'US_Cities');</code></strong>
+---------------------------------------------------+
| gen_blacklist('Berlin', 'DE_Cities', 'US_Cities') |
+---------------------------------------------------+
| Phoenix                                           |
+---------------------------------------------------+
</pre></li><li class="listitem"><p><a name="udf_gen-dictionary"></a>
              <a class="link" href="security.html#udf_gen-dictionary"><code class="literal">gen_dictionary(<em class="replaceable"><code>dictionary_name</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091710568256"></a><a class="indexterm" name="idm140091710567120"></a><p>
              Returns a random term from a dictionary.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>dictionary_name</code></em>: A string
                  that names the dictionary from which to choose the
                  term.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              A random term from the dictionary as a string, or
              <code class="literal">NULL</code> if the dictionary name is not in
              the dictionary registry.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary('mydict');</code></strong>
+--------------------------+
| gen_dictionary('mydict') |
+--------------------------+
| My term                  |
+--------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary('no-such-dict');</code></strong>
+--------------------------------+
| gen_dictionary('no-such-dict') |
+--------------------------------+
| NULL                           |
+--------------------------------+
</pre></li><li class="listitem"><p><a name="udf_gen-dictionary-drop"></a>
              <a class="link" href="security.html#udf_gen-dictionary-drop"><code class="literal">gen_dictionary_drop(<em class="replaceable"><code>dictionary_name</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091710555168"></a><a class="indexterm" name="idm140091710554032"></a><p>
              Removes a dictionary from the dictionary registry.
            </p><p>
              This function requires the
              <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>dictionary_name</code></em>: A string
                  that names the dictionary to remove from the
                  dictionary registry.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              A string that indicates whether the drop operation
              succeeded. <code class="literal">Dictionary removed</code> indicates
              success. <code class="literal">Dictionary removal error</code>
              indicates failure.
            </p><p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_drop('mydict');</code></strong>
+-------------------------------+
| gen_dictionary_drop('mydict') |
+-------------------------------+
| Dictionary removed            |
+-------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_drop('no-such-dict');</code></strong>
+-------------------------------------+
| gen_dictionary_drop('no-such-dict') |
+-------------------------------------+
| Dictionary removal error            |
+-------------------------------------+
</pre></li><li class="listitem"><p><a name="udf_gen-dictionary-load"></a>
              <a class="link" href="security.html#udf_gen-dictionary-load"><code class="literal">gen_dictionary_load(<em class="replaceable"><code>dictionary_path</code></em>,
              <em class="replaceable"><code>dictionary_name</code></em>)</code></a>
            </p><a class="indexterm" name="idm140091710539072"></a><a class="indexterm" name="idm140091710537936"></a><p>
              Loads a file into the dictionary registry and assigns the
              dictionary a name to be used with other functions that
              require a dictionary name argument.
            </p><p>
              This function requires the
              <a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a> privilege.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
                Dictionaries are not persistent. Any dictionary used by
                applications must be loaded for each server startup.
</p>
</div>
<p>
              Once loaded into the registry, a dictionary is used as is,
              even if the underlying dictionary file changes. To reload
              a dictionary, first drop it with
              <a class="link" href="security.html#udf_gen-dictionary-drop"><code class="literal">gen_dictionary_drop()</code></a>, then
              load it again with
              <a class="link" href="security.html#udf_gen-dictionary-load"><code class="literal">gen_dictionary_load()</code></a>.
            </p><p>
              Arguments:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  <em class="replaceable"><code>dictionary_path</code></em>: A string
                  that specifies the path name of the dictionary file.
                </p></li><li class="listitem"><p>
                  <em class="replaceable"><code>dictionary_name</code></em>: A string
                  that provides a name for the dictionary.
</p></li></ul>
</div>
<p>
              Return value:
            </p><p>
              A string that indicates whether the load operation
              succeeded. <code class="literal">Dictionary load success</code>
              indicates success. <code class="literal">Dictionary load
              error</code> indicates failure. Dictionary load failure
              can occur for several reasons, including:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                  A dictionary with the given name is already loaded.
                </p></li><li class="listitem"><p>
                  The dictionary file is not found.
                </p></li><li class="listitem"><p>
                  The dictionary file contains no terms.
                </p></li><li class="listitem"><p>
                  The <a class="link" href="server-administration.html#sysvar_secure_file_priv"><code class="literal">secure_file_priv</code></a>
                  system variable is set and the dictionary file is not
                  located in the directory named by the variable.
</p></li></ul>
</div>
<p>
              Example:
            </p><pre data-lang="sql" class="programlisting">
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_load('/usr/local/mysql/mysql-files/mydict','mydict');</code></strong>
+---------------------------------------------------------------------+
| gen_dictionary_load('/usr/local/mysql/mysql-files/mydict','mydict') |
+---------------------------------------------------------------------+
| Dictionary load success                                             |
+---------------------------------------------------------------------+
mysql&gt; <strong class="userinput"><code>SELECT gen_dictionary_load('/dev/null','null');</code></strong>
+-----------------------------------------+
| gen_dictionary_load('/dev/null','null') |
+-----------------------------------------+
| Dictionary load error                   |
+-----------------------------------------+
</pre></li></ul>
</div>

</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="fips-mode"></a>6.5 FIPS Support</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140091710513360"></a><a class="indexterm" name="idm140091710512288"></a><a class="indexterm" name="idm140091710510800"></a><p>
      MySQL supports FIPS mode, if compiled using OpenSSL, and an
      OpenSSL library and FIPS Object Module are available at runtime.
    </p><p>
      FIPS mode on the server side applies to cryptographic operations
      performed by the server. This includes replication (master/slave
      and Group Replication) and X Plugin, which run within the server.
      FIPS mode also applies to attempts by clients to connect to the
      server.
    </p><p>
      The following sections describe FIPS mode and how to take
      advantage of it within MySQL:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="security.html#fips-overview" title="FIPS Overview">FIPS Overview</a></p></li><li class="listitem"><p><a class="xref" href="security.html#fips-system-requirements" title="System Requirements for FIPS Mode in MySQL">System Requirements for FIPS Mode in MySQL</a></p></li><li class="listitem"><p><a class="xref" href="security.html#fips-configuration" title="Configuring FIPS Mode in MySQL">Configuring FIPS Mode in MySQL</a></p></li></ul>
</div>

<div class="simplesect">

<div class="titlepage">
<div>

<div class="simple">
<h3 class="title"><a name="fips-overview"></a>FIPS Overview</h3>

</div>

</div>

</div>
<p>
        Federal Information Processing Standards 140-2 (FIPS 140-2)
        describes a security standard that can be required by Federal
        (US Government) agencies for cryptographic modules used to
        protect sensitive or valuable information. To be considered
        acceptable for such Federal use, a cryptographic module must be
        certified for FIPS 140-2. If a system intended to protect
        sensitive data lacks the proper FIPS 140-2 certificate, Federal
        agencies cannot purchase it.
      </p><p>
        Products such as OpenSSL can be used in FIPS mode, although the
        OpenSSL library itself is not validated for FIPS. Instead, the
        OpenSSL library is used with the OpenSSL FIPS Object Module to
        enable OpenSSL-based applications to operate in FIPS mode.
      </p><p>
        For general information about FIPS and its implementation in
        OpenSSL, these references may be helpful:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <a class="ulink" href="https://doi.org/10.6028/NIST.FIPS.140-2" target="_top">National
            Institute of Standards and Technology FIPS PUB 140-2</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://www.openssl.org/docs/fips/" target="_top">OpenSSL FIPS
            140-2 Security Policy</a>
          </p></li><li class="listitem"><p>
            <a class="ulink" href="https://www.openssl.org/docs/fips/UserGuide-2.0.pdf" target="_top">User
            Guide for the OpenSSL FIPS Object Module v2.0</a>
</p></li></ul>
</div>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Important
</div>
<p>
          FIPS mode imposes conditions on cryptographic operations such
          as restrictions on acceptable encryption algorithms or
          requirements for longer key lengths. For OpenSSL, the exact
          FIPS behavior depends on the OpenSSL version. For details,
          refer to the OpenSSL FIPS User Guide.
</p>
</div>

</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="fips-system-requirements"></a>System Requirements for FIPS Mode in MySQL</h3>

</div>

</div>

</div>
<p>
        For MySQL to support FIPS mode, these system requirements must
        be satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            At build time, MySQL must be compiled using OpenSSL. FIPS
            mode cannot be used in MySQL if compilation uses a different
            SSL library.
          </p></li><li class="listitem"><p>
            At runtime, the OpenSSL library and OpenSSL FIPS Object
            Module must be available as shared (dynamically linked)
            objects. It is possible to build statically linked OpenSSL
            objects, but MySQL will not use them.
</p></li></ul>
</div>
<p>
        FIPS mode has been tested for MySQL on EL7, but may work on
        other systems.
      </p><p>
        If your platform or operating system provides the OpenSSL FIPS
        Object Module, you can use it. Otherwise, you can build the
        OpenSSL library and FIPS Object Module from source. Use the
        instructions in the OpenSSL FIPS User Guide (see
        <a class="xref" href="security.html#fips-overview" title="FIPS Overview">FIPS Overview</a>).
</p>
</div>
<div class="simplesect">
<div class="titlepage">
<div>
<div class="simple">
<h3 class="title"><a name="fips-configuration"></a>Configuring FIPS Mode in MySQL</h3>

</div>

</div>

</div>
<p>
        MySQL enables control of FIPS mode on the server side and the
        client side:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            The <a class="link" href="server-administration.html#sysvar_ssl_fips_mode"><code class="literal">ssl_fips_mode</code></a> system
            variable controls whether the server operates in FIPS mode.
          </p></li><li class="listitem"><p>
            The <a class="link" href="security.html#option_general_ssl-fips-mode"><code class="option">--ssl-fips-mode</code></a> client
            option controls whether a given MySQL client operates in
            FIPS mode.
</p></li></ul>
</div>
<p>
        The <a class="link" href="server-administration.html#sysvar_ssl_fips_mode"><code class="literal">ssl_fips_mode</code></a> system
        variable and <a class="link" href="security.html#option_general_ssl-fips-mode"><code class="option">--ssl-fips-mode</code></a>
        client option permit these values:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">OFF</code>: Disable FIPS mode.
          </p></li><li class="listitem"><p>
            <code class="literal">ON</code>: Enable FIPS mode.
          </p></li><li class="listitem"><p>
            <code class="literal">STRICT</code>: Enable <span class="quote">“<span class="quote">strict</span>”</span> FIPS
            mode.
</p></li></ul>
</div>
<p>
        On the server side, numeric
        <a class="link" href="server-administration.html#sysvar_ssl_fips_mode"><code class="literal">ssl_fips_mode</code></a> values of 0, 1,
        and 2 are equivalent to <code class="literal">OFF</code>,
        <code class="literal">ON</code>, and <code class="literal">STRICT</code>,
        respectivey.
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
          In general, <code class="literal">STRICT</code> imposes more
          restrictions than <code class="literal">ON</code>, but MySQL itself has
          no FIPS-specific code other than to specify to OpenSSL the
          FIPS mode value. The exact behavior of FIPS mode for
          <code class="literal">ON</code> or <code class="literal">STRICT</code> depends on
          the OpenSSL version. For details, refer to the OpenSSL FIPS
          User Guide (see <a class="xref" href="security.html#fips-overview" title="FIPS Overview">FIPS Overview</a>).
</p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          If the OpenSSL FIPS Object Module is not available, the only
          permitted value for
          <a class="link" href="server-administration.html#sysvar_ssl_fips_mode"><code class="literal">ssl_fips_mode</code></a> and
          <a class="link" href="security.html#option_general_ssl-fips-mode"><code class="option">--ssl-fips-mode</code></a> is
          <code class="literal">OFF</code>. An error occurs for attempts to set
          the FIPS mode to a different value.
</p>
</div>
<p>
        FIPS mode on the server side applies to cryptographic operations
        performed by the server. This includes replication (master/slave
        and Group Replication) and X Plugin, which run within the
        server.
      </p><p>
        FIPS mode also applies to attempts by clients to connect to the
        server. When enabled, on either the client or server side, it
        restricts which of the supported encryption ciphers can be
        chosen. However, enabling FIPS mode does not require that an
        encrypted connection must be used, or that user credentials must
        be encrypted. For example, if FIPS mode is enabled, stronger
        cryptographic algorithms are required. In particular, MD5 is
        restricted, so trying to establish an encrypted connection using
        an encryption cipher such as <code class="literal">RC4-MD5</code> does not
        work. But there is nothing about FIPS mode that prevents
        establishing an unencrypted connection. (To do that, you can use
        the <code class="literal">REQUIRE</code> clause for
        <a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER Syntax"><code class="literal">CREATE USER</code></a> or
        <a class="link" href="sql-syntax.html#alter-user" title="13.7.1.1 ALTER USER Syntax"><code class="literal">ALTER USER</code></a> for specific user
        accounts, or set the
        <a class="link" href="server-administration.html#sysvar_require_secure_transport"><code class="literal">require_secure_transport</code></a> system
        variable to affect all accounts.)
</p>
</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="server-administration.html">Prev</a></td>
<td width="20%" align="center"><a accesskey="u" href="">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="backup-and-recovery.html">Next</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 5 MySQL Server Administration</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top">Chapter 7 Backup and Recovery</td>
</tr>
</table>
</div>
</body>
</html>
