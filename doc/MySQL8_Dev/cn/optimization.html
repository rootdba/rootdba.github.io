<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" class="translated-ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>第8章优化</title>
		<link rel="stylesheet" href="mvl.css" type="text/css">
		<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2">
		<link rel="start" href="index.html" title="{书名}">
		<link rel="up" href="" title="">
		<link rel="prev" href="backup-and-recovery.html" title="第7章备份和恢复">
		<link rel="next" href="language-structure.html" title="第9章语言结构">
		<link type="text/css" rel="stylesheet" charset="UTF-8" href="/doc/MySQL8_Dev/translateelement.css">
	</head>

	<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
		<div class="navheader">
			<table width="100%" summary="Navigation header">
				<tbody>
					<tr>
						<th colspan="3" align="center">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8章优化</font>
							</font>
						</th>
					</tr>
					<tr>
						<td width="20%" align="left"><a accesskey="p" href="backup-and-recovery.html">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">上一页</font>
								</font>
							</a>&nbsp;</td>
						<th width="60%" align="center"></th>
						<td width="20%" align="right">&nbsp;<a accesskey="n" href="language-structure.html">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">下一个</font>
								</font>
							</a></td>
					</tr>
				</tbody>
			</table>
			<hr>
		</div>
		<div class="chapter">
			<div class="titlepage">
				<div>
					<div>
						<h1 class="title"><a name="optimization"></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8章优化</font>
							</font>
						</h1>

					</div>

				</div>

			</div>
			<div class="toc">
				<p><b>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">目录</font>
						</font>
					</b></p>
				<dl class="toc"><dt><span class="section"><a href="optimization.html#optimize-overview">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.1优化概述</font>
								</font>
							</a></span></dt><dt><span class="section"><a href="optimization.html#statement-optimization">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.2优化SQL语句</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#select-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1优化SELECT语句</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#subquery-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.2优化子查询，派生表，查看引用和公用表表达式</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#information-schema-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.3优化INFORMATION_SCHEMA查询</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#performance-schema-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.4优化性能模式查询</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#data-change-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.5优化数据变更声明</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#permission-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.6优化数据库权限</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#miscellaneous-optimization-tips">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.7其他优化技巧</font>
										</font>
									</a></span></dt></dl>
					</dd><dt><span class="section"><a href="optimization.html#optimization-indexes">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.3优化和索引</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#mysql-indexes">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.1 MySQL如何使用索引</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#primary-key-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.2主键优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#spatial-index-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.3空间索引优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#foreign-key-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.4外键优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#column-indexes">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.5列索引</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#multiple-column-indexes">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.6多列索引</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#verifying-index-usage">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.7验证索引使用情况</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#index-statistics">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.8 InnoDB和MyISAM索引统计信息收集</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#index-btree-hash">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.9 B树和哈希索引的比较</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#index-extensions">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.10索引扩展的使用</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#generated-column-index-optimizations">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.11生成列索引的优化程序使用</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#invisible-indexes">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.12隐形指数</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#descending-indexes">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.13降序索引</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#timestamp-lookups">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.3.14 TIMESTAMP列的索引查找</font>
										</font>
									</a></span></dt></dl>
					</dd><dt><span class="section"><a href="optimization.html#optimizing-database-structure">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.4优化数据库结构</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#data-size">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.1优化数据大小</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-data-types">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.2优化MySQL数据类型</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-multi-tables">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.3优化许多表格</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#internal-temporary-tables">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.4 MySQL中的内部临时表使用</font>
										</font>
									</a></span></dt></dl>
					</dd><dt><span class="section"><a href="optimization.html#optimizing-innodb">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.5优化InnoDB表</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#optimizing-innodb-storage-layout">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.5.1优化InnoDB表的存储布局</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-transaction-management">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.5.2优化InnoDB事务管理</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#innodb-performance-ro-txn">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.5.3优化InnoDB只读事务</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-logging">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.5.4优化InnoDB重做日志</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-bulk-data-loading">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.5.5 InnoDB表的批量数据加载</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-queries">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.5.6优化InnoDB查询</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-ddl-operations">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.5.7优化InnoDB DDL操作</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-diskio">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.5.8优化InnoDB磁盘I / O.</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-configuration-variables">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.5.9优化InnoDB配置变量</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-many-tables">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.5.10为具有多个表的系统优化InnoDB</font>
										</font>
									</a></span></dt></dl>
					</dd><dt><span class="section"><a href="optimization.html#optimizing-myisam">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.6优化MyISAM表</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#optimizing-queries-myisam">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.6.1优化MyISAM查询</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-myisam-bulk-data-loading">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.6.2 MyISAM表的批量数据加载</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#repair-table-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.6.3优化REPAIR TABLE语句</font>
										</font>
									</a></span></dt></dl>
					</dd><dt><span class="section"><a href="optimization.html#optimizing-memory-tables">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.7优化MEMORY表</font>
								</font>
							</a></span></dt><dt><span class="section"><a href="optimization.html#execution-plan-information">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.8了解查询执行计划</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#using-explain">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.8.1使用EXPLAIN优化查询</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#explain-output">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.8.2 EXPLAIN输出格式</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#explain-extended">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.8.3扩展EXPLAIN输出格式</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#explain-for-connection">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.8.4获取命名连接的执行计划信息</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#estimating-performance">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.8.5估计查询性能</font>
										</font>
									</a></span></dt></dl>
					</dd><dt><span class="section"><a href="optimization.html#controlling-optimizer">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.9控制查询优化器</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#controlling-query-plan-evaluation">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.9.1控制查询计划评估</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#switchable-optimizations">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.9.2可切换的优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizer-hints">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.9.3优化器提示</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#index-hints">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.9.4索引提示</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#cost-model">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.9.5优化器成本模型</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizer-statistics">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.9.6优化器统计</font>
										</font>
									</a></span></dt></dl>
					</dd><dt><span class="section"><a href="optimization.html#buffering-caching">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.10缓冲和缓存</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#innodb-buffer-pool-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.1 InnoDB缓冲池优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#myisam-key-cache">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2 MyISAM密钥缓存</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#statement-caching">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.3准备好的声明和存储程序的缓存</font>
										</font>
									</a></span></dt></dl>
					</dd><dt><span class="section"><a href="optimization.html#locking-issues">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.11优化锁定操作</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#internal-locking">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.11.1内部锁定方法</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#table-locking">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.11.2表锁定问题</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#concurrent-inserts">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.11.3并发插入</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#metadata-locking">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.11.4元数据锁定</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#external-locking">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.11.5外部锁定</font>
										</font>
									</a></span></dt></dl>
					</dd><dt><span class="section"><a href="optimization.html#optimizing-server">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.12优化MySQL服务器</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#disk-issues">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.1优化磁盘I / O.</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#symbolic-links">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.2使用符号链接</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-memory">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.3优化内存使用</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-network">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.4优化网络使用</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#resource-groups">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.5资源组</font>
										</font>
									</a></span></dt></dl>
					</dd><dt><span class="section"><a href="optimization.html#optimize-benchmarking">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.13衡量绩效（基准）</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#select-benchmarking">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.13.1测量表达式和函数的速度</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#custom-benchmarks">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.13.2使用您自己的基准</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#monitoring-performance-schema">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.13.3使用performance_schema测量性能</font>
										</font>
									</a></span></dt></dl>
					</dd><dt><span class="section"><a href="optimization.html#thread-information">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.14检查线程信息</font>
								</font>
							</a></span></dt>
					<dd>
						<dl><dt><span class="section"><a href="optimization.html#thread-commands">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.14.1线程命令值</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#general-thread-states">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.14.2一般线程状态</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#master-thread-states">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.14.3复制主线程状态</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#slave-io-thread-states">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.14.4复制从站I / O线程状态</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#slave-sql-thread-states">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.14.5复制从属SQL线程状态</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#slave-connection-thread-states">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.14.6复制从站连接线程状态</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#mysql-cluster-thread-states">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.14.7 NDB群集线程状态</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#event-scheduler-thread-states">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.14.8事件调度程序线程状态</font>
										</font>
									</a></span></dt></dl>
					</dd>
				</dl>
			</div>
			<a class="indexterm" name="idm140091709474320"></a><a class="indexterm" name="idm140091709473248"></a><a class="indexterm"
			 name="idm140091709472176"></a>
			<p>
				<font style="vertical-align: inherit;">
					<font style="vertical-align: inherit;">
						本章介绍如何优化MySQL性能并提供示例。</font>
					<font style="vertical-align: inherit;">优化涉及在多个级别配置，调整和测量性能。</font>
					<font style="vertical-align: inherit;">根据您的工作角色（开发人员，DBA或两者的组合），您可以在单个SQL语句，整个应用程序，单个数据库服务器或多个联网数据库服务器的级别进行优化。</font>
					<font style="vertical-align: inherit;">有时您可以主动并提前计划性能，而有时您可能会在出现问题后解决配置或代码问题。</font>
					<font style="vertical-align: inherit;">优化CPU和内存使用还可以提高可伸缩性，允许数据库处理更多负载而不会降低速度。
					</font>
				</font>
			</p>
			<div class="section">

				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="optimize-overview"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.1优化概述</font>
								</font>
							</h2>
						</div>
					</div>
				</div>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							数据库性能取决于数据库级别的多个因素，例如表，查询和配置设置。</font>
						<font style="vertical-align: inherit;">这些软件构造导致硬件级别的CPU和I / O操作，您必须尽可能地最小化并尽可能高效。</font>
						<font style="vertical-align: inherit;">在处理数据库性能时，首先要学习软件方面的高级规则和指南，并使用挂钟时间来衡量性能。</font>
						<font style="vertical-align: inherit;">当您成为专家时，您将了解内部发生的更多信息，并开始测量诸如CPU周期和I / O操作之类的事情。
						</font>
					</font>
				</p>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							典型用户的目标是从现有的软件和硬件配置中获得最佳的数据库性能。</font>
						<font style="vertical-align: inherit;">高级用户寻找改进MySQL软件本身的机会，或者开发自己的存储引擎和硬件设备来扩展MySQL生态系统。
						</font>
					</font>
				</p>
				<div class="itemizedlist">
					<ul class="itemizedlist" style="list-style-type: disc; ">
						<li class="listitem">
							<p><a class="xref" href="optimization.html#optimize-database-level" title="在数据库级别进行优化">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在数据库级别进行优化</font>
									</font>
								</a></p>
						</li>
						<li class="listitem">
							<p><a class="xref" href="optimization.html#optimize-hardware-level" title="在硬件级别进行优化">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在硬件级别进行优化</font>
									</font>
								</a></p>
						</li>
						<li class="listitem">
							<p><a class="xref" href="optimization.html#optimize-portability-performance" title="平衡可移植性和性能">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">平衡可移植性和性能</font>
									</font>
								</a></p>
						</li>
					</ul>
				</div>

				<div class="simplesect">

					<div class="titlepage">
						<div>

							<div class="simple">
								<h3 class="title"><a name="optimize-database-level"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在数据库级别进行优化</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								使数据库应用程序快速运行的最重要因素是其基本设计：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											表格结构合理吗？</font>
										<font style="vertical-align: inherit;">特别是，列是否具有正确的数据类型，并且每个表是否具有适合工作类型的列？</font>
										<font style="vertical-align: inherit;">例如，执行频繁更新的应用程序通常具有许多具有少量列的表，而分析大量数据的应用程序通常具有很少列的表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											是否有适当的
										</font>
									</font><a class="link" href="optimization.html#optimization-indexes" title="8.3优化和索引">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">来提高查询效率？
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您是否为每个表使用适当的存储引擎，并利用您使用的每个存储引擎的优势和功能？</font>
										<font style="vertical-align: inherit;">特别是，事务性存储引擎（例如</font>
									</font><code class="literal"><a class="link" href="optimization.html#optimizing-innodb" title="8.5&nbsp;Optimizing for InnoDB Tables">InnoDB</a></code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											非
										</font>
										<font style="vertical-align: inherit;">事务性存储引擎）的选择
										</font>
									</font><code class="literal"><a class="link" href="optimization.html#optimizing-myisam" title="8.6&nbsp;Optimizing for MyISAM Tables">MyISAM</a></code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于性能和可伸缩性来说非常重要。
										</font>
									</font>
								</p>
								<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

									<div class="admon-title">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												注意
											</font>
										</font>
									</div>
									<p>
										<code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是新表的默认存储引擎。</font>
											<font style="vertical-align: inherit;">实际上，高级
											</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">性能特征意味着
											</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表通常优于更简单的</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表，尤其是对于繁忙的数据库。
											</font>
										</font>
									</p>
								</div>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											每个表是否使用适当的行格式？</font>
										<font style="vertical-align: inherit;">此选择还取决于用于表的存储引擎。</font>
										<font style="vertical-align: inherit;">特别是，压缩表使用较少的磁盘空间，因此需要较少的磁盘I / O来读取和写入数据。</font>
										<font style="vertical-align: inherit;">压缩适用于具有</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表的</font>
										<font style="vertical-align: inherit;">所有类型的工作负载
										</font>
										<font style="vertical-align: inherit;">以及只读
										</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											应用程序是否使用适当的
										</font>
									</font><a class="link" href="optimization.html#locking-issues" title="8.11优化锁定操作">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">锁定策略</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">？</font>
										<font style="vertical-align: inherit;">例如，通过允许可能的共享访问，以便数据库操作可以并发运行，并在适当时请求独占访问，以便关键操作成为最高优先级。</font>
										<font style="vertical-align: inherit;">同样，存储引擎的选择也很重要。</font>
										<font style="vertical-align: inherit;">该</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">存储引擎处理大部分锁定的问题，而不需要您的参与，允许在数据库更好的并发，减少试验和调整的金额，让您的代码。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											是否</font>
										<font style="vertical-align: inherit;">正确</font>
									</font><a class="link" href="optimization.html#buffering-caching" title="8.10缓冲和缓存">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">使用了用于缓存的</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">所有</font><a class="link" href="optimization.html#buffering-caching"
										 title="8.10&nbsp;Buffering and Caching">
											<font style="vertical-align: inherit;">内存区域</font>
										</a>
										<font style="vertical-align: inherit;">？</font>
										<font style="vertical-align: inherit;">也就是说，足够大以容纳频繁访问的数据，但不能太大以至于它们会超载物理内存并导致分页。</font>
										<font style="vertical-align: inherit;">要配置的主要内存区域是</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">缓冲池和</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">密钥缓存。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="simplesect">
					<div class="titlepage">
						<div>
							<div class="simple">
								<h3 class="title"><a name="optimize-hardware-level"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在硬件级别进行优化</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								随着数据库变得越来越繁忙，任何数据库应用程序最终都会达到硬件限制。</font>
							<font style="vertical-align: inherit;">DBA必须评估是否可以调整应用程序或重新配置服务器以避免这些
							</font>
						</font><a class="link" href="glossary.html#glos_bottleneck" title="瓶颈">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">瓶颈</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，或者是否需要更多硬件资源。</font>
							<font style="vertical-align: inherit;">系统瓶颈通常来自这些来源：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											磁盘寻求。</font>
										<font style="vertical-align: inherit;">磁盘需要一段时间才能找到一块数据。</font>
										<font style="vertical-align: inherit;">对于现代磁盘，平均时间通常低于10毫秒，因此我们理论上可以做到大约100次寻找。</font>
										<font style="vertical-align: inherit;">这个时间用新磁盘慢慢改善，并且很难针对单个表进行优化。</font>
										<font style="vertical-align: inherit;">优化寻道时间的方法是将数据分配到多个磁盘上。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											磁盘读写。</font>
										<font style="vertical-align: inherit;">当磁盘位于正确位置时，我们需要读取或写入数据。</font>
										<font style="vertical-align: inherit;">使用现代磁盘，一个磁盘可提供至少10-20MB / s的吞吐量。</font>
										<font style="vertical-align: inherit;">这比搜索更容易优化，因为您可以从多个磁盘并行读取。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											CPU周期。</font>
										<font style="vertical-align: inherit;">当数据在主存储器中时，我们必须处理它以获得我们的结果。</font>
										<font style="vertical-align: inherit;">与内存量相比具有大表是最常见的限制因素。</font>
										<font style="vertical-align: inherit;">但是对于小桌子，速度通常不是问题。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											内存带宽。</font>
										<font style="vertical-align: inherit;">当CPU需要的数据量超过CPU缓存容量时，主内存带宽成为瓶颈。</font>
										<font style="vertical-align: inherit;">对于大多数系统来说，这是一个不常见的瓶颈，但需要注意的是。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="simplesect">
					<div class="titlepage">
						<div>
							<div class="simple">
								<h3 class="title"><a name="optimize-portability-performance"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">平衡可移植性和性能</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091709431856"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要在可移植的MySQL程序中使用面向性能的SQL扩展，您可以在</font>
						</font><code class="literal">/*! */</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">注释分隔符</font>
							<font style="vertical-align: inherit;">的语句中包含特定于MySQL的关键字</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">其他SQL服务器忽略注释的关键字。</font>
							<font style="vertical-align: inherit;">有关编写注释的信息，请参见</font>
						</font><a class="xref" href="language-structure.html#comments" title="9.6注释语法">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第9.6节“注释语法”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="statement-optimization"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.2优化SQL语句</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#select-optimization">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.1优化SELECT语句</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#subquery-optimization">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.2优化子查询，派生表，查看引用和公用表表达式</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#information-schema-optimization">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.3优化INFORMATION_SCHEMA查询</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#performance-schema-optimization">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.4优化性能模式查询</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#data-change-optimization">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.5优化数据变更声明</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#permission-optimization">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.6优化数据库权限</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#miscellaneous-optimization-tips">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.7其他优化技巧</font>
									</font>
								</a></span></dt></dl>
				</div>
				<a class="indexterm" name="idm140091709427264"></a>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							数据库应用程序的核心逻辑是通过SQL语句执行的，无论是直接通过解释器发出还是通过API在后台提交。</font>
						<font style="vertical-align: inherit;">本节中的调整准则有助于加速各种MySQL应用程序。</font>
						<font style="vertical-align: inherit;">这些准则涵盖了读取和写入数据的SQL操作，一般SQL操作的幕后开销，以及特定方案（如数据库监视）中使用的操作。
						</font>
					</font>
				</p>
				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="select-optimization"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.1优化SELECT语句</font>
									</font>
								</h3>

							</div>

						</div>

					</div>

					<div class="toc">
						<dl class="toc"><dt><span class="section"><a href="optimization.html#where-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.1 WHERE子句优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#range-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.2范围优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#index-merge-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.3索引合并优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#condition-pushdown-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.4发动机状态下推优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#index-condition-pushdown-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.5指数条件下推优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#nested-loop-joins">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.6嵌套循环连接算法</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#nested-join-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.7嵌套连接优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#outer-join-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.8外连接优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#outer-join-simplification">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.9外连接简化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#mrr-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.10多范围读取优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#bnl-bka-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.11块嵌套循环和批量密钥访问连接</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#condition-filtering">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.12条件过滤</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#constant-folding-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.13恒定折叠优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#is-null-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.14 IS NULL优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#order-by-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.15按优化顺序</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#group-by-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.16 GROUP BY优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#distinct-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.17 DISTINCT优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#limit-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.18 LIMIT查询优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#function-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.19函数调用优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#window-function-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.20窗口函数优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#row-constructor-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.21行构造函数表达式优化</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#table-scan-avoidance">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.22避免全表扫描</font>
										</font>
									</a></span></dt></dl>
					</div>
					<a class="indexterm" name="idm140091709423712"></a><a class="indexterm" name="idm140091709422256"></a><a class="indexterm"
					 name="idm140091709420768"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								查询以</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								语句</font>
							<font style="vertical-align: inherit;">的形式</font>
							<font style="vertical-align: inherit;">执行数据库中的所有查找操作。</font>
							<font style="vertical-align: inherit;">调整这些语句是首要任务，无论是为动态网页实现亚秒响应时间，还是为了产生巨大的隔夜报告而缩短工作时间。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								此外</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句，进行查询调谐技术也适用于结构，如
							</font>
						</font><a class="link" href="sql-syntax.html#create-table-select" title="13.1.20.5 CREATE TABLE ... SELECT语法"><code
							 class="literal">CREATE
								TABLE...AS SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT语法"><code class="literal">INSERT
								INTO...SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和</font>
						</font><code class="literal">WHERE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在条款
							</font>
						</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">的语句。</font>
							<font style="vertical-align: inherit;">这些语句具有额外的性能考虑因素，因为它们将写操作与面向读取的查询操作相结合。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								NDB Cluster支持连接下推优化，从而将合格连接完整地发送到NDB Cluster数据节点，在NDB Cluster数据节点中可以将它们分布在它们之间并且并行执行。</font>
							<font style="vertical-align: inherit;">有关此优化的更多信息，请参阅
							</font>
						</font><a class="xref" href="mysql-cluster.html#ndb_join_pushdown-conditions" title="NDB下推加入的条件">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">NDB下推连接的条件</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化查询的主要考虑因素是：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											要</font>
									</font><code class="literal">SELECT ... WHERE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">加快查询速度，首先要检查的是是否可以添加
										</font>
									</font><a class="link" href="glossary.html#glos_index" title="指数">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">在</font>
									</font><code class="literal">WHERE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">子句中</font>
										<font style="vertical-align: inherit;">使用的列上设置索引</font>
										<font style="vertical-align: inherit;">，以加快评估，过滤和结果的最终检索。</font>
										<font style="vertical-align: inherit;">为避免浪费磁盘空间，请构建一小组索引，以加速应用程序中使用的许多相关查询。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											索引对于引用不同表的查询尤其重要，使用
										</font>
									</font><a class="link" href="glossary.html#glos_join" title="加入">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">联接</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="link" href="glossary.html#glos_foreign_key" title="外键">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">外键等功能</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">您可以使用该</font>
									</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句来确定用于a的索引
										</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="optimization.html#mysql-indexes" title="8.3.1 MySQL如何使用索引">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.3.1节“MySQL如何使用索引”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="xref" href="optimization.html#using-explain" title="8.8.1使用EXPLAIN优化查询">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.8.1节“使用EXPLAIN优化查询”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											隔离并调整查询的任何部分，例如函数调用，这会占用过多时间。</font>
										<font style="vertical-align: inherit;">根据查询的结构，可以为结果集中的每一行调用一次函数，甚至可以为表中的每一行调用一次函数，从而大大减轻任何低效率。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											最大限度地减少</font>
										<font style="vertical-align: inherit;">
											查询中</font>
										<font style="vertical-align: inherit;">的</font>
									</font><a class="link" href="glossary.html#glos_full_table_scan" title="全表扫描">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">全表扫描</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">数
										</font>
										<font style="vertical-align: inherit;">，尤其是对于大表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											通过</font>
									</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">定期</font>
										<font style="vertical-align: inherit;">使用</font>
										<font style="vertical-align: inherit;">语句</font>
										<font style="vertical-align: inherit;">使表统计信息保持最新
										</font>
										<font style="vertical-align: inherit;">，因此优化程序具有构建高效执行计划所需的信息。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											了解特定于每个表的存储引擎的调优技术，索引技术和配置参数。</font>
										<font style="vertical-align: inherit;">双方</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">并
										</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">有两套准则的实现和维持查询高性能。</font>
										<font style="vertical-align: inherit;">有关详细信息，请参见</font>
									</font><a class="xref" href="optimization.html#optimizing-innodb-queries" title="8.5.6优化InnoDB查询">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.5.6节“优化InnoDB查询”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="xref" href="optimization.html#optimizing-queries-myisam" title="8.6.1优化MyISAM查询">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.6.1节“优化MyISAM查询”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您可以</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">使用</font>
									</font><a class="xref" href="optimization.html#innodb-performance-ro-txn" title="8.5.3优化InnoDB只读事务">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.5.3节“优化InnoDB只读事务”中</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">的技术</font><a class="xref" href="optimization.html#innodb-performance-ro-txn"
										 title="8.5.3&nbsp;Optimizing InnoDB Read-Only Transactions">
											<font style="vertical-align: inherit;">优化</font>
										</a>
										<font style="vertical-align: inherit;">表的
										</font>
										<font style="vertical-align: inherit;">单查询事务
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											避免以难以理解的方式转换查询，尤其是在优化程序自动执行某些相同转换的情况下。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果其中一个基本准则无法轻松解决性能问题，请通过阅读</font>
									</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">计划并调整索引，</font>
									</font><code class="literal">WHERE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">子句，连接子句等来</font>
										<font style="vertical-align: inherit;">调查特定查询的内部详细信息
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">（当您达到一定的专业水平时，阅读
										</font>
									</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">计划可能是您每次查询的第一步。）
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											调整MySQL用于缓存的内存区域的大小和属性。</font>
										<font style="vertical-align: inherit;">通过有效使用
										</font>
									</font><code class="literal">InnoDB</code>
									<a class="link" href="glossary.html#glos_buffer_pool" title="缓冲池">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">缓冲池</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">密钥缓存和MySQL查询缓存，重复查询运行得更快，因为在第二次及以后的时间内从内存中检索结果。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											即使对于使用高速缓存存储区域快速运行的查询，您仍可以进一步优化，以便它们需要更少的高速缓存，从而使您的应用程序更具可伸缩性。</font>
										<font style="vertical-align: inherit;">可伸缩性意味着您的应用程序可以处理更多的并发用户，更大的请求等，而不会出现性能大幅下降的情况。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											处理锁定问题，其中查询的速度可能会受到同时访问表的其他会话的影响。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="where-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.1 WHERE子句优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091709374448"></a><a class="indexterm" name="idm140091709373408"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									本节讨论可以为处理</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句</font>
								<font style="vertical-align: inherit;">进行的优化</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">这些示例使用
								</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句，但相同的优化适用</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">于</font>
							</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句中的</font>
								<font style="vertical-align: inherit;">子句
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

							<div class="admon-title">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										注意
									</font>
								</font>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										由于MySQL优化器的工作正在进行中，因此并未记录MySQL执行的所有优化。
									</font>
								</font>
							</p>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									您可能想要重写查询以更快地进行算术运算，同时牺牲可读性。</font>
								<font style="vertical-align: inherit;">因为MySQL会自动执行类似的优化，所以通常可以避免这种工作，并使查询保持更易理解和可维护的形式。</font>
								<font style="vertical-align: inherit;">MySQL执行的一些优化如下：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												删除不必要的括号：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">   （（a AND b）AND c OR（（（a AND b）AND（c AND d））））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- &gt;（a AND b AND c）OR（a AND b AND c AND d）</font></font><font></font>
</pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												恒定折叠：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">   （a &lt;b AND b = c）AND a = 5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- &gt; b&gt; 5 AND b = c AND a = 5</font></font><font></font>
</pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												恒定条件去除：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">   （b&gt; = 5 AND b = 5）OR（b = 6 AND 5 = 5）OR（b = 7 AND 5 = 6）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- &gt; b = 5或b = 6</font></font><font></font>
</pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在MySQL 8.0.14及更高版本中，这是在准备期间而不是在优化阶段期间进行的，这有助于简化连接。</font>
											<font style="vertical-align: inherit;">有关</font>
											<font style="vertical-align: inherit;">更多信息和示例，</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="optimization.html#outer-join-optimization" title="8.2.1.8外连接优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.8节“外部连接优化”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												索引使用的常量表达式仅计算一次。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												从MySQL 8.0.16开始，对具有常量值的数值类型列进行比较，检查并折叠或删除无效或不合法值：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#CREATE TABLE t（c TINYINT UNSIGNED NOT NULL）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SELECT * FROM t WHERE c«256;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-yes SELECT * FROM t WHERE 1;</font></font><font></font>
</pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												有关</font>
											<font style="vertical-align: inherit;">更多信息</font>
										</font><a class="xref" href="optimization.html#constant-folding-optimization" title="8.2.1.13恒定折叠优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">请参见</font><a class="xref" href="optimization.html#constant-folding-optimization"
											 title="8.2.1.13&nbsp;Constant-Folding Optimization">
												<font style="vertical-align: inherit;">第8.2.1.13节“常量折叠优化”</font>
											</a>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<a class="link" href="functions.html#function_count"><code class="literal">COUNT(*)</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在没有a的单个表上</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">直接从表信息</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												和</font>
										</font><code class="literal">MEMORY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表中</font>
											<font style="vertical-align: inherit;">检索</font>
											<font style="vertical-align: inherit;">。</font>
										</font><code class="literal">NOT NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">当仅与一个表一起使用时，</font>
											<font style="vertical-align: inherit;">也可以对任何</font>
											<font style="vertical-align: inherit;">表达式执行</font>
											<font style="vertical-align: inherit;">此操作</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												早期检测无效常量表达式。</font>
											<font style="vertical-align: inherit;">MySQL快速检测到某些
											</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句是不可能的，并且不返回任何行。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">HAVING</code>
										<font style="vertical-align: inherit;"></font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">如果您不使用</font>
										</font><code class="literal">GROUP
											BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或聚合函数（</font>
										</font><a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">等等），</font>
											<font style="vertical-align: inherit;">则合并
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于连接中的每个表，</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">构造</font>
											<font style="vertical-align: inherit;">一个更简单
											</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">的表来</font>
											<font style="vertical-align: inherit;">快速
											</font>
											<font style="vertical-align: inherit;">评估表，并尽快跳过行。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<a class="indexterm" name="idm140091709337600"></a>

										<a class="indexterm" name="idm140091709336528"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">

												在查询中的任何其他表之前首先读取所有常量表。</font>
											<font style="vertical-align: inherit;">常量表是以下任何一种：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															一张空表或一行表。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															与a </font>
														<font style="vertical-align: inherit;">或
														</font>
														<font style="vertical-align: inherit;">index </font>
													</font><code class="literal">WHERE</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															上</font>
														<font style="vertical-align: inherit;">的</font>
														<font style="vertical-align: inherit;">子句一起</font>
														<font style="vertical-align: inherit;">使用的表</font>
														<font style="vertical-align: inherit;">，其中所有索引部分都与常量表达式进行比较并定义为</font>
														<font style="vertical-align: inherit;">。
														</font>
													</font><code class="literal">PRIMARY KEY</code>
													<font style="vertical-align: inherit;"></font><code class="literal">UNIQUE</code>
													<font style="vertical-align: inherit;"></font><code class="literal">NOT NULL</code>
													<font style="vertical-align: inherit;"></font>
												</p>
											</li>
										</ul>
									</div>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												以下所有表都用作常量表：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t WHERE </font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t1。</font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1和t2。</font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= t1.id;
</font></font></pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												通过尝试所有可能性，可以找到加入表格的最佳连接组合。</font>
											<font style="vertical-align: inherit;">如果</font>
										</font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和</font>
										</font><code class="literal">GROUP
											BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句中的</font>
											<font style="vertical-align: inherit;">所有列
											</font>
											<font style="vertical-align: inherit;">都来自同一个表，则在加入时首先首选该表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果存在</font>
										</font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句和不同的</font>
										</font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句，或者如果
											</font>
										</font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或者</font>
										</font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												包含连接队列中第一个表以外的表中的列，则会创建临时表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果使用</font>
										</font><code class="literal">SQL_SMALL_RESULT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												修饰符，MySQL使用内存临时表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												查询每个表索引，并使用最佳索引，除非优化程序认为使用表扫描更有效。</font>
											<font style="vertical-align: inherit;">有一次，根据最佳索引是否跨越超过表的30％使用扫描，但固定百分比不再决定使用索引或扫描之间的选择。</font>
											<font style="vertical-align: inherit;">优化器现在更复杂，并且基于其他因素（例如表大小，行数和I / O块大小）进行估算。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在某些情况下，MySQL甚至无需咨询数据文件即可从索引中读取行。</font>
											<font style="vertical-align: inherit;">如果索引中使用的所有列都是数字，则仅使用索引树来解析查询。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在输出每一行之前，</font>
										</font><code class="literal">HAVING</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">将跳过</font>
											<font style="vertical-align: inherit;">与该</font>
											<font style="vertical-align: inherit;">子句</font>
											<font style="vertical-align: inherit;">不匹配的行
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									一些非常快的查询示例：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（*）FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT MIN（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），MAX（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT MAX（</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT ... FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... LIMIT 10;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT ... FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，... LIMIT 10;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL仅使用索引树解析以下查询，假设索引列是数字：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT COUNT（*）FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GROUP BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下查询使用索引来按排序顺序检索行，而不使用单独的排序传递：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ... FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT ... FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，...;
</font></font></pre>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="range-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.2范围优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									的</font>
							</font><a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">访问方法使用单个索引来检索包含一个或若干个索引值的时间间隔内表行的子集。</font>
								<font style="vertical-align: inherit;">它可用于单部分或多部分索引。</font>
								<font style="vertical-align: inherit;">以下部分描述了优化程序使用范围访问的条件。
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p><a class="xref" href="optimization.html#range-access-single-part" title="单部分索引的范围访问方法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">单部分索引的范围访问方法</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#range-access-multi-part" title="多部分索引的范围访问方法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">多部分索引的范围访问方法</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#equality-range-optimization" title="多值比较的等价范围优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">多值比较的等价范围优化</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#range-access-skip-scan" title="跳过扫描范围访问方法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">跳过扫描范围访问方法</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#row-constructor-range-optimization" title="行构造函数表达式的范围优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">行构造函数表达式的范围优化</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#range-optimization-memory-use" title="限制内存使用范围优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">限制内存使用范围优化</font>
											</font>
										</a></p>
								</li>
							</ul>
						</div>

						<div class="simplesect">

							<div class="titlepage">
								<div>

									<div class="simple">
										<h5 class="title"><a name="range-access-single-part"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">单部分索引的范围访问方法</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										对于单部分索引，索引值间隔可以方便地由</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句中</font>
									<font style="vertical-align: inherit;">的相应条件
									</font>
									<font style="vertical-align: inherit;">表示，表示为
									</font>
								</font><span class="firstterm">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">范围条件</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										而不是</font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">“ </font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">间隔”。</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">”</font>
									</font>
								</span>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										单部分索引的范围条件的定义如下：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													对于这两种</font>
											</font><code class="literal">BTREE</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和
												</font>
											</font><code class="literal">HASH</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引，使用时具有恒定值的关键部分的比较是一个范围条件
												</font>
											</font><a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font><a class="link" href="functions.html#operator_is-null"><code class="literal">IS
													NULL</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，或</font>
											</font><a class="link" href="functions.html#operator_is-not-null"><code class="literal">IS NOT
													NULL</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">运营商。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													另外，对于</font>
											</font><code class="literal">BTREE</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引，使用时具有恒定值的关键部分的比较是一个范围条件
												</font>
											</font><a class="link" href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_not-equal"><code class="literal">!=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，或
												</font>
											</font><a class="link" href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													运营商，或者</font>
											</font><a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													比较，如果该参数
												</font>
											</font><a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">是一个常数字符串不与通配符开始。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													对于所有索引类型，多个范围条件与范围条件组合</font>
											</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">或
												</font>
											</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">形成范围条件。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<span class="quote">
									<font style="vertical-align: inherit;"></font><span class="quote">
										<font style="vertical-align: inherit;"></font>
									</span>
									<font style="vertical-align: inherit;"></font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">前面描述中的</font><span class="quote">
										<font style="vertical-align: inherit;">“ </font>
									</span><span class="quote"><span class="quote">
											<font style="vertical-align: inherit;">常量值</font>
										</span></span><span class="quote">
										<font style="vertical-align: inherit;"> ”</font>
									</span>
									<font style="vertical-align: inherit;">表示以下之一：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													来自查询字符串的常量
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">来自同一连接</font>
												<font style="vertical-align: inherit;">
													的a </font>
											</font><a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													或</font>
											</font><a class="link" href="optimization.html#jointype_system"><code class="literal">system</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">table的
												</font>
												<font style="vertical-align: inherit;">列</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													不相关子查询的结果
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													任何表达式完全由前面类型的子表达式组成
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										以下是</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句中</font>
									<font style="vertical-align: inherit;">具有范围条件的查询的一些示例</font>
									<font style="vertical-align: inherit;">：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;10;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  或</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（15,18,20）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'ab％'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  或</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'BETWEEN'bar'和'foo';
</font></font></pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在优化器常量传播阶段，一些非常量值可以转换为常量。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										MySQL尝试从</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">每个可能索引</font>
									<font style="vertical-align: inherit;">的</font>
									<font style="vertical-align: inherit;">子句中</font>
									<font style="vertical-align: inherit;">提取范围条件
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">在提取过程期间，丢弃不能用于构建范围条件的条件，组合产生重叠范围的条件，并且去除产生空范围的条件。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										请考虑以下语句，其中
									</font>
								</font><code class="literal">key1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是索引列
									</font>
								</font><code class="literal">nonkey</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">且未编入索引：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （key1 &lt;'abc'AND（key1 LIKE'abcde％'或key1 LIKE'％b'））或者</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （key1 &lt;'bar'和nonkey = 4）或</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （key1 &lt;'uux'和key1&gt;'z'）;</font></font><font></font>
</pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										密钥的提取过程</font>
								</font><code class="literal">key1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">如下：
									</font>
								</font>
							</p>
							<div class="orderedlist">
								<ol class="orderedlist" type="1">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													从原始</font>
											</font><code class="literal">WHERE</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">条款</font>
												<font style="vertical-align: inherit;">开始</font>
												<font style="vertical-align: inherit;">：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（key1 &lt;'abc'AND（key1 LIKE'abcde％'或key1 LIKE'％b'））或者</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（key1 &lt;'bar'和nonkey = 4）或</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（key1 &lt;'uux'和key1&gt;'z'）</font></font><font></font>
</pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													删除</font>
											</font><code class="literal">nonkey = 4</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">并</font>
											</font><code class="literal">key1
												LIKE '%b'</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">因为它们不能用于范围扫描。</font>
												<font style="vertical-align: inherit;">删除它们的正确方法是用它们替换它们</font>
											</font><code class="literal">TRUE</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，这样我们在进行范围扫描时不会错过任何匹配的行。</font>
												<font style="vertical-align: inherit;">用</font>
											</font><code class="literal">TRUE</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">产量</font>
												<font style="vertical-align: inherit;">替换它们</font>
												<font style="vertical-align: inherit;">：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（key1 &lt;'abc'AND（key1 LIKE'abcde％'或TRUE））或</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（key1 &lt;'bar'和TRUE）或</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（key1 &lt;'uux'和key1&gt;'z'）</font></font><font></font>
</pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													折叠条件始终为真或假：
												</font>
											</font>
										</p>
										<div class="itemizedlist">
											<ul class="itemizedlist" style="list-style-type: disc; ">
												<li class="listitem">
													<p>
														<code class="literal">(key1 LIKE 'abcde%' OR TRUE)</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;"> 总是如此
															</font>
														</font>
													</p>
												</li>
												<li class="listitem">
													<p>
														<code class="literal">(key1 &lt; 'uux' AND key1 &gt;
															'z')</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;"> 总是假的
															</font>
														</font>
													</p>
												</li>
											</ul>
										</div>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													用常数替换这些条件会产生：
												</font>
											</font>
										</p>
										<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（key1 &lt;'abc'和TRUE）或（key1 &lt;'bar'和TRUE）或（FALSE）
</font></font></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													删除不必要的</font>
											</font><code class="literal">TRUE</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和
												</font>
											</font><code class="literal">FALSE</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">常量会产生：
												</font>
											</font>
										</p>
										<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（key1 &lt;'abc'）或（key1 &lt;'bar'）
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													将重叠间隔组合成一个会产生用于范围扫描的最终条件：
												</font>
											</font>
										</p>
										<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（key1 &lt;'bar'）
</font></font></pre>
									</li>
								</ol>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										通常（并且如前面的示例所示），用于范围扫描的条件比该</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句的</font>
									<font style="vertical-align: inherit;">限制性更小</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">MySQL执行额外的检查以过滤掉满足范围条件但不满足完整</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句的行。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										范围条件提取算法可以处理</font>
									<font style="vertical-align: inherit;">
										任意深度的</font>
									<font style="vertical-align: inherit;">嵌套
									</font>
								</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">/ </font>
								</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">构造，并且其输出不依赖于条件在</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句中</font>
									<font style="vertical-align: inherit;">出现的顺序
									</font>
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										MySQL不支持合并</font>
								</font><a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">空间索引</font>
									<font style="vertical-align: inherit;">的</font>
									<font style="vertical-align: inherit;">访问方法的</font>
									<font style="vertical-align: inherit;">多个范围
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">要解决此限制，</font>
									<font style="vertical-align: inherit;">除了将每个空间谓词放在不同的语句中之外</font>
									<font style="vertical-align: inherit;">，您可以使用</font>
								</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">具有相同
									</font>
								</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">语句的语句
									</font>
								</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="range-access-multi-part"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">多部分索引的范围访问方法</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										多部分索引的范围条件是单部分索引的范围条件的扩展。</font>
									<font style="vertical-align: inherit;">多部分索引上的范围条件将索引行限制在一个或多个关键元组间隔内。</font>
									<font style="vertical-align: inherit;">使用索引中的排序在一组关键元组上定义关键元组间隔。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										例如，考虑定义为的多部分索引
									</font>
									<font style="vertical-align: inherit;">，以及按键顺序列出的以下一组关键元组：
									</font>
								</font><code class="literal">key1(<em class="replaceable"><code>key_part1</code></em>,
									<em class="replaceable"><code>key_part2</code></em>,
									<em class="replaceable"><code>key_part3</code></em>)</code>
								<font style="vertical-align: inherit;"></font>
							</p>
							<pre data-lang="clike" class="programlisting"><em class="replaceable"><code>key_part1</code></em>  <em class="replaceable"><code>key_part2</code></em>  <em class="replaceable"><code>key_part3</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  NULL 1'abc'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  NULL 1'xyz'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  NULL 2'foo'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   1 1'abc'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   1 1'xyz'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   1 2'abc'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   2 1'aaa'</font></font><font></font>
</pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										条件</font>
								</font><code class="literal"><em class="replaceable"><code>key_part1</code></em>
									= 1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">定义了这个间隔：
									</font>
								</font>
							</p>
							<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1，-INF，-INF）&lt;=（ ，</font><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> </font><font style="vertical-align: inherit;">）&lt;（1，+ INF，+ INF）
</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>key_part3</code></em><font style="vertical-align: inherit;"></font></pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										间隔覆盖前面数据集中的第4，第5和第6个元组，并且可以由范围访问方法使用。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										相反，条件
									</font>
								</font><code class="literal"><em class="replaceable"><code>key_part3</code></em> =
									'abc'</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">不定义单个间隔，并且不能由范围访问方法使用。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										以下描述更详细地说明了范围条件如何适用于多部分索引。
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													对于</font>
											</font><code class="literal">HASH</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引，可以使用包含相同值的每个间隔。</font>
												<font style="vertical-align: inherit;">这意味着只能为以下形式的条件生成间隔：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting">    <em class="replaceable"><code>key_part1</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>const1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和 </font></font><em class="replaceable"><code>key_part2</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>const2</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND </font><font style="vertical-align: inherit;">;
</font></font><em class="replaceable"><code>key_partN</code></em> <em class="replaceable"><code>cmp</code></em> <em class="replaceable"><code>constN</code></em><font style="vertical-align: inherit;"></font></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													这里</font>
											</font><em class="replaceable"><code>const1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><em class="replaceable"><code>const2</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">...是常数，</font>
											</font><em class="replaceable"><code>cmp</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">是一个
												</font>
											</font><a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">或者</font>
											</font><a class="link" href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">比较运营商，以及条件覆盖所有指数部分。</font>
												<font style="vertical-align: inherit;">（也就是说，有一些</font>
											</font><em class="replaceable"><code>N</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													条件，一个用于</font>
											</font><em class="replaceable"><code>N</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">-part索引的</font>
												<font style="vertical-align: inherit;">每个部分
												</font>
												<font style="vertical-align: inherit;">。）例如，以下是三部分</font>
											</font><code class="literal">HASH</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引</font>
												<font style="vertical-align: inherit;">的范围条件
												</font>
												<font style="vertical-align: inherit;">：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IS NULL AND </font></font><em class="replaceable"><code>key_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='foo'
</font></font></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													有关被认为是常量的定义，请参阅
												</font>
											</font><a class="xref" href="optimization.html#range-access-single-part" title="单部分索引的范围访问方法">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">单部分索引的范围访问方法</font>
												</font>
											</a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													对于一个</font>
											</font><code class="literal">BTREE</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引，以一定间隔可能是条件组合可用
												</font>
											</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，其中每个条件使用的恒定值的关键部分进行比较
												</font>
											</font><a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_not-equal"><code class="literal">!=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，或
												</font>
												<font style="vertical-align: inherit;">（其中
												</font>
											</font><a class="link" href="functions.html#operator_like"><code class="literal">LIKE
													'<em class="replaceable"><code>pattern</code></em>'</code></a>
											<font style="vertical-align: inherit;"></font><code class="literal">'<em class="replaceable"><code>pattern</code></em>'</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													不以通配符开头）。</font>
												<font style="vertical-align: inherit;">可以使用间隔，只要可以确定包含与条件匹配的所有行的单个密钥元组（或者如果使用</font>
											</font><a class="link" href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													或者</font>
											</font><a class="link" href="functions.html#operator_not-equal"><code class="literal">!=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													使用</font>
												<font style="vertical-align: inherit;">两个间隔
												</font>
												<font style="vertical-align: inherit;">）。
												</font>
											</font>
										</p>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													只要比较运算符是</font>
												<font style="vertical-align: inherit;">，或</font>
											</font><a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
												<font style="vertical-align: inherit;">优化程序就会尝试使用其他关键部分来确定间隔
												</font>
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">如果操作是
												</font>
												<font style="vertical-align: inherit;">，
												</font>
												<font style="vertical-align: inherit;">，
												</font>
												<font style="vertical-align: inherit;">，
												</font>
												<font style="vertical-align: inherit;">，
												</font>
												<font style="vertical-align: inherit;">，
												</font>
												<font style="vertical-align: inherit;">，
												</font>
												<font style="vertical-align: inherit;">，或者
												</font>
												<font style="vertical-align: inherit;">，优化器使用它，但认为没有更多的关键部分。</font>
												<font style="vertical-align: inherit;">对于以下表达式，优化程序将使用
												</font>
												<font style="vertical-align: inherit;">第一个比较。</font>
												<font style="vertical-align: inherit;">它也使用
												</font>
											</font><a class="link" href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_is-null"><code
												 class="literal">IS NULL</code></a>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_greater-than"><code
												 class="literal">&gt;</code></a>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_less-than"><code
												 class="literal">&lt;</code></a>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_greater-than-or-equal"><code
												 class="literal">&gt;=</code></a>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_less-than-or-equal"><code
												 class="literal">&lt;=</code></a>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_not-equal"><code
												 class="literal">!=</code></a>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_not-equal"><code
												 class="literal">&lt;&gt;</code></a>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_between"><code
												 class="literal">BETWEEN</code></a>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_like"><code
												 class="literal">LIKE</code></a>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_equal"><code
												 class="literal">=</code></a>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_greater-than-or-equal"><code
												 class="literal">&gt;=</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													从第二次比较，但没有考虑其他关键部分，并没有使用间隔构造的第三个比较：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='foo'AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; = 10 AND </font></font><em class="replaceable"><code>key_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; 10
</font></font></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													单个间隔是：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（ '富'，10，-INF）&lt;（ ，</font><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> </font><font style="vertical-align: inherit;">）&lt;（ '富'，+ INF，+ INF）
</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>key_part3</code></em><font style="vertical-align: inherit;"></font></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													创建的间隔可能包含比初始条件更多的行。</font>
												<font style="vertical-align: inherit;">例如，前面的间隔包括</font>
											</font><code class="literal">('foo',
												11, 0)</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">不满足原始条件的值。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果包含区间内包含的行集的条件与其组合
												</font>
											</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，则它们形成一个条件，该条件覆盖其间隔的并集中包含的一组行。</font>
												<font style="vertical-align: inherit;">如果条件与</font>
											</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">它们</font>
												<font style="vertical-align: inherit;">组合
												</font>
												<font style="vertical-align: inherit;">，则它们形成一个条件，该条件覆盖其间隔的交集中包含的一组行。</font>
												<font style="vertical-align: inherit;">例如，对于这个由两部分组成的索引：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;2）OR（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; 5）
</font></font></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													间隔是：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1，-inf）&lt;（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）&lt;（1,2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（5，-inf）&lt;（</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在此示例中，第一行的间隔使用左边界的一个关键部分和右边界的两个关键部分。</font>
												<font style="vertical-align: inherit;">第二行的间隔仅使用一个关键部分。</font>
												<font style="vertical-align: inherit;">输出中</font>
												<font style="vertical-align: inherit;">的</font>
											</font><code class="literal">key_len</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">列</font>
											</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">指示使用的密钥前缀的最大长度。
												</font>
											</font>
										</p>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在某些情况下，</font>
											</font><code class="literal">key_len</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">可能表示使用了关键部件，但这可能不是您所期望的。</font>
												<font style="vertical-align: inherit;">假设
												</font>
											</font><em class="replaceable"><code>key_part1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">并且
												</font>
											</font><em class="replaceable"><code>key_part2</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">可以
												</font>
											</font><code class="literal">NULL</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">然后该
												</font>
											</font><code class="literal">key_len</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">列显示以下条件的两个关键部分长度：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; = 1 AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;2
</font></font></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													但是，事实上，条件转换为：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; = 1并且</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是NULL
</font></font></pre>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										有关如何执行优化以组合或消除单部分索引上的范围条件的间隔的说明，请参阅单部分索引的
									</font>
								</font><a class="xref" href="optimization.html#range-access-single-part" title="单部分索引的范围访问方法">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">范围访问方法</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">对多部分索引的范围条件执行类似步骤。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="equality-range-optimization"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">多值比较的等价范围优化</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										考虑这些表达式，其中
									</font>
								</font><em class="replaceable"><code>col_name</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是索引列：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>valN</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
 </font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR ... OR </font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font><em class="replaceable"><code>valN</code></em>
</pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果</font>
								</font><em class="replaceable"><code>col_name</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">等于多个值中的任何一个，</font>
									<font style="vertical-align: inherit;">则每个表达式都为真
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">这些比较是等式范围比较（其中</font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">“ </font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">范围</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;"> ”</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是单个值）。</font>
									<font style="vertical-align: inherit;">优化程序估计读取限定行的成本以进行相等范围比较，如下所示：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果有唯一索引
												</font>
											</font><em class="replaceable"><code>col_name</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，则每个范围的行估计值为1，因为最多一行可以具有给定值。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													否则，任何索引
												</font>
											</font><em class="replaceable"><code>col_name</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">都是非唯一的，并且优化器可以使用潜入索引或索引统计信息来估计每个范围的行数。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<a class="indexterm" name="idm140091709099552"></a>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										使用索引潜水时，优化程序会在范围的每一端进行潜水，并使用范围中的行数作为估计值。</font>
									<font style="vertical-align: inherit;">例如，表达式
									</font>
								</font><code class="literal"><em class="replaceable"><code>col_name</code></em> IN (10, 20,
									30)</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">具有三个相等范围，优化程序每个范围进行两次潜水以生成行估计。</font>
									<font style="vertical-align: inherit;">每对潜水产生具有给定值的行数的估计。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										索引潜水提供准确的行估计，但随着表达式中比较值的数量增加，优化程序需要更长时间才能生成行估计。</font>
									<font style="vertical-align: inherit;">索引统计的使用不如索引潜水准确，但允许对大值列表进行更快的行估计。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										该
									</font>
								</font><a class="link" href="server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										系统变量，可以配置在其优化从一个行估计策略到其他交换机值的数量。</font>
									<font style="vertical-align: inherit;">要允许使用索引潜水进行最大</font>
								</font><em class="replaceable"><code>N</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										相等范围的</font>
									<font style="vertical-align: inherit;">比较</font>
									<font style="vertical-align: inherit;">，请设置
									</font>
								</font><a class="link" href="server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										为</font>
								</font><em class="replaceable"><code>N</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">+ 1.要禁用统计数据并始终使用索引潜水
									</font>
								</font><em class="replaceable"><code>N</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，请将其设置
									</font>
								</font><a class="link" href="server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										为0。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要更新的最佳估计表索引统计信息，使用
									</font>
								</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
										TABLE</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在MySQL 8.0之前，除了使用</font>
								</font><a class="link" href="server-administration.html#sysvar_eq_range_index_dive_limit"><code class="literal">eq_range_index_dive_limit</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										系统变量</font>
									<font style="vertical-align: inherit;">之外，没有办法跳过使用索引潜水来估计索引的有用性
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">在MySQL 8.0中，对于满足所有这些条件的查询，可以进行索引潜水跳过：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													查询用于单个表，而不是多个表的连接。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													存在单索引</font>
											</font><code class="literal">FORCE INDEX</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引提示。</font>
												<font style="vertical-align: inherit;">我们的想法是，如果强制使用索引，那么从潜在的索引中获取额外开销就无法获得任何好处。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													该索引不是唯一的而不是
												</font>
											</font><code class="literal">FULLTEXT</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													没有子查询。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													不</font>
											</font><code class="literal">DISTINCT</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font><code class="literal">GROUP
												BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">或</font>
											</font><code class="literal">ORDER BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">条款存在。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										对于</font>
								</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN
										FOR
										CONNECTION</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，如果跳过索引潜水，则输出更改如下：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													对于传统输出，</font>
											</font><code class="literal">rows</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和
												</font>
											</font><code class="literal">filtered</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">值是
												</font>
											</font><code class="literal">NULL</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													对于JSON输出，
												</font>
											</font><code class="literal">rows_examined_per_scan</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">并且
												</font>
											</font><code class="literal">rows_produced_per_join</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">不显示，
												</font>
											</font><code class="literal">skip_index_dive_due_to_force</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">是
												</font>
											</font><code class="literal">true</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，并且成本计算不准确。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果没有</font>
								</font><code class="literal">FOR CONNECTION</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">则跳过索引潜水时输出不会更改。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在执行跳过索引潜水的查询后，</font>
								</font><a class="link" href="information-schema.html#optimizer-trace-table" title="25.15 INFORMATION_SCHEMA OPTIMIZER_TRACE表"><code
									 class="literal">INFORMATION_SCHEMA.OPTIMIZER_TRACE</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										表中</font>
									<font style="vertical-align: inherit;">的相应行
									</font>
									<font style="vertical-align: inherit;">包含
									</font>
								</font><code class="literal">index_dives_for_range_access</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">值
									</font>
								</font><code class="literal">skipped_due_to_force_index</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="range-access-skip-scan"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">跳过扫描范围访问方法</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										请考虑以下情形：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（f1 INT NOT NULL，f2 INT NOT NULL，PRIMARY KEY（f1，f2））;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插入t1值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （1,1），（1,2），（1,3），（1,4），（1,5），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （2,1），（2,2），（2,3），（2,4），（2,5）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO t1 SELECT f1，f2 + 5 FROM t1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO t1 SELECT f1，f2 + 10 FROM t1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO t1 SELECT f1，f2 + 20 FROM t1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO t1 SELECT f1，f2 + 40 FROM t1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析表t1;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EXPLAIN SELECT f1，f2 FROM t1 WHERE f2&gt; 40;</font></font><font></font>
</pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要执行此查询，MySQL可以选择索引扫描来获取所有行（索引包括要选择的所有列），然后应用</font>
									<font style="vertical-align: inherit;">子句中</font>
									<font style="vertical-align: inherit;">的</font>
								</font><code class="literal">f2 &gt; 40</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										条件</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">以生成最终结果集。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										范围扫描比完整索引扫描更有效，但在这种情况下不能使用，因为</font>
								</font><code class="literal">f1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第一个索引列</font>
									<font style="vertical-align: inherit;">没有条件
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">但是，从MySQL 8.0.13开始，优化器可以</font>
								</font><code class="literal">f1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">使用类似于松散索引扫描的称为Skip Scan的方法</font>
									<font style="vertical-align: inherit;">对每个值执行多个范围扫描</font>
									<font style="vertical-align: inherit;">（请参见</font>
								</font><a class="xref" href="optimization.html#group-by-optimization" title="8.2.1.16 GROUP BY优化">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.2.1.16节“GROUP BY优化”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">）：
									</font>
								</font>
							</p>
							<div class="orderedlist">
								<ol class="orderedlist" type="1">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													跳过第一个索引部分的不同值
												</font>
											</font><code class="literal">f1</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">（索引前缀）。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;"></font><code class="literal">f2 &gt; 40</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">对剩余索引部分上的条件的</font>
												<font style="vertical-align: inherit;">
													每个不同前缀值执行子范围扫描</font>
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
								</ol>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										对于前面显示的数据集，算法的运行方式如下：
									</font>
								</font>
							</p>
							<div class="orderedlist">
								<ol class="orderedlist" type="1">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													获取第一个关键部分（</font>
											</font><code class="literal">f1 = 1</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">）</font>
												<font style="vertical-align: inherit;">的第一个不同值</font>
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													根据第一个和第二个关键部分构造范围（</font>
											</font><code class="literal">f1 = 1 AND f2 &gt; 40</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">）。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													执行范围扫描。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													获取第一个关键部分（</font>
											</font><code class="literal">f1 = 2</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">）</font>
												<font style="vertical-align: inherit;">的下一个不同值</font>
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													根据第一个和第二个关键部分构造范围（</font>
											</font><code class="literal">f1 = 2 AND f2 &gt; 40</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">）。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													执行范围扫描。
												</font>
											</font>
										</p>
									</li>
								</ol>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										使用此策略会减少访问行的数量，因为MySQL会跳过不符合每个构造范围的行。</font>
									<font style="vertical-align: inherit;">此Skip Scan访问方法适用于以下条件：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													表T具有至少一个具有形式的关键部分的复合索引（[A_1，...，A_ </font>
											</font><em class="replaceable"><code>k</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，] B_1，...，B_ </font>
											</font><em class="replaceable"><code>m</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，C [，D_1，...，D_ </font>
											</font><em class="replaceable"><code>n</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">]）。</font>
												<font style="vertical-align: inherit;">关键部分A和D可能是空的，但B和C必须是非空的。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													查询仅引用一个表。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													查询不使用</font>
											</font><code class="literal">GROUP BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">或
												</font>
											</font><code class="literal">DISTINCT</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													该查询仅引用索引中的列。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													A_1，...，A_的</font>
											</font><em class="replaceable"><code>k</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">谓词必须是等式谓词，它们必须是常量。</font>
												<font style="vertical-align: inherit;">这包括
												</font>
											</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">运营商。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													查询必须是连接查询; </font>
												<font style="vertical-align: inherit;">即，
												</font>
											</font><code class="literal">AND</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">的</font>
											</font><code class="literal">OR</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													条件：
												</font>
											</font><code class="literal">(<em class="replaceable"><code>cond1</code></em>(<em class="replaceable"><code>key_part1</code></em>)
												OR
												<em class="replaceable"><code>cond2</code></em>(<em class="replaceable"><code>key_part1</code></em>))
												AND
												(<em class="replaceable"><code>cond1</code></em>(<em class="replaceable"><code>key_part2</code></em>)
												OR ...) AND ...</code>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													C上必须有一个范围条件。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													允许D列条件。</font>
												<font style="vertical-align: inherit;">D上的条件必须与C上的范围条件一起使用。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;"></font><code class="literal">EXPLAIN</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										输出中</font>
									<font style="vertical-align: inherit;">
										指示使用Skip Scan </font>
									<font style="vertical-align: inherit;">如下：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<code class="literal">Using index for skip scan</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">在
												</font>
											</font><code class="literal">Extra</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">列中表示使用松散索引Skip Scan访问方法。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果索引可用于Skip Scan，则索引应在</font>
											</font><code class="literal">possible_keys</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													列中</font>
												<font style="vertical-align: inherit;">可见</font>
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在</font>
								</font><code class="literal">"skip scan"</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">此格式</font>
									<font style="vertical-align: inherit;">的</font>
									<font style="vertical-align: inherit;">元素的</font>
									<font style="vertical-align: inherit;">优化程序跟踪输出中指示使用Skip Scan
									</font>
									<font style="vertical-align: inherit;">：
									</font>
								</font>
							</p>
							<pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“skip_scan_range”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “type”：“skip_scan”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “指数”： </font></font><em class="replaceable"><code>index_used_for_skip_scan</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “key_parts_used_for_access”：[ </font></font><em class="replaceable"><code>key_parts_used_for_access</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “范围”：[ </font></font><em class="replaceable"><code>range</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										您可能还会看到一个
									</font>
								</font><code class="literal">"best_skip_scan_summary"</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">元素。</font>
									<font style="vertical-align: inherit;">如果选择“跳过扫描”作为最佳范围访问变体，
									</font>
								</font><code class="literal">"chosen_range_access_summary"</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">则会写入a。</font>
									<font style="vertical-align: inherit;">如果选择“跳过扫描”作为总体最佳访问方法，
									</font>
								</font><code class="literal">"best_access_path"</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">则存在元素。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										使用Skip Scan取决于
									</font>
									<font style="vertical-align: inherit;">系统变量</font>
								</font><code class="literal">skip_scan</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">标志的
									</font>
								</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">值。</font>
									<font style="vertical-align: inherit;">请参见</font>
								</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.9.2节“可切换的优化”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">默认情况下，此标志为</font>
								</font><code class="literal">on</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">要禁用它，请设置</font>
								</font><code class="literal">skip_scan</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">为</font>
								</font><code class="literal">off</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										除了使用
									</font>
								</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">系统变量控制优化程序在会话范围内使用Skip Scan之外，MySQL还支持优化程序提示，以便在每个语句的基础上影​​响优化程序。</font>
									<font style="vertical-align: inherit;">请参见
									</font>
								</font><a class="xref" href="optimization.html#optimizer-hints" title="8.9.3优化器提示">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.9.3节“优化程序提示”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="row-constructor-range-optimization"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">行构造函数表达式的范围优化</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										优化器能够将范围扫描访问方法应用于此表单的查询：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ... FROM t1 WHERE（col_1，col_2）IN（（'a'，'b'），（'c'，'d'））;
</font></font></pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										以前，对于要使用的范围扫描，有必要将查询编写为：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ... FROM t1 WHERE（col_1 ='a'和col_2 ='b'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或（col_1 ='c'和col_2 ='d'）;</font></font><font></font>
</pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要使优化器使用范围扫描，查询必须满足以下条件：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													只使用</font>
											</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">谓词，而不是</font>
											</font><a class="link" href="functions.html#operator_not-in"><code class="literal">NOT IN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在</font>
											</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">谓词</font>
												<font style="vertical-align: inherit;">的左侧
												</font>
												<font style="vertical-align: inherit;">，行构造函数仅包含列引用。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在</font>
											</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">谓词</font>
												<font style="vertical-align: inherit;">的右侧
												</font>
												<font style="vertical-align: inherit;">，行构造函数仅包含运行时常量，这些常量是在执行期间绑定到常量的文字或本地列引用。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在</font>
											</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">谓词</font>
												<font style="vertical-align: inherit;">的右侧
												</font>
												<font style="vertical-align: inherit;">，有多个行构造函数。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										有关优化程序和行构造函数的更多信息，请参见
									</font>
								</font><a class="xref" href="optimization.html#row-constructor-optimization" title="8.2.1.21行构造函数表达式优化">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.2.1.21节“行构造函数表达式优化”</font>
									</font>
								</a>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="range-optimization-memory-use"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">限制内存使用范围优化</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要控制范围优化程序可用的内存，请使用
									</font>
								</font><a class="link" href="server-administration.html#sysvar_range_optimizer_max_mem_size"><code class="literal">range_optimizer_max_mem_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										系统变量：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													值为0表示</font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">“ </font>
												</font><span class="quote">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">无限制。</font>
													</font>
												</span>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">”</font>
												</font>
											</span>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													值大于0时，优化程序会在考虑范围访问方法时跟踪消耗的内存。</font>
												<font style="vertical-align: inherit;">如果要超过指定的限制，则放弃范围访问方法，并考虑其他方法，包括全表扫描。</font>
												<font style="vertical-align: inherit;">这可能不太理想。</font>
												<font style="vertical-align: inherit;">如果发生这种情况，会发生以下警告（</font>
											</font><em class="replaceable"><code>N</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">当前
												</font>
											</font><a class="link" href="server-administration.html#sysvar_range_optimizer_max_mem_size"><code class="literal">range_optimizer_max_mem_size</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													值</font>
												<font style="vertical-align: inherit;">在哪里
												</font>
												<font style="vertical-align: inherit;">）：
												</font>
											</font>
										</p>
										<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告3170内存容量的</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节数</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                   超出'range_optimizer_max_mem_size'。</font><font style="vertical-align: inherit;">范围</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                   此查询未执行优化。</font></font><font></font>
</pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													对于</font>
											</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和
												</font>
											</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">语句，如果优化器回退到全表扫描并且</font>
											</font><a class="link" href="server-administration.html#sysvar_sql_safe_updates"><code class="literal">sql_safe_updates</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">启用</font>
												<font style="vertical-align: inherit;">了
												</font>
												<font style="vertical-align: inherit;">系统变量，则会发生错误而不是警告，因为实际上没有使用任何键来确定要修改的行。</font>
												<font style="vertical-align: inherit;">有关更多信息，请参阅
												</font>
											</font><a class="xref" href="programs.html#safe-updates" title="使用安全更新模式（--safe-updates）">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">使用安全更新模式（--safe-updates）</font>
												</font>
											</a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										对于超出可用范围优化内存并且优化程序回退到不太理想的计划的单个查询，增加该
									</font>
								</font><a class="link" href="server-administration.html#sysvar_range_optimizer_max_mem_size"><code class="literal">range_optimizer_max_mem_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										值可以提高性能。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要估计处理范围表达式所需的内存量，请使用以下准则：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													对于诸如以下的简单查询，其中有一个候选键用于范围访问方法，每个谓词组合</font>
											</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													使用大约230个字节：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（*）FROM t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中a = 1或a = 2或a = 3 OR .. </font><font style="vertical-align: inherit;">a = </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													类似地，对于诸如以下的查询，每个谓词组合</font>
											</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													使用大约125个字节：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（*）FROM t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里a = 1 AND b = 1 AND c = 1 ... </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													对于带</font>
											</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													谓词</font>
												<font style="vertical-align: inherit;">的查询</font>
												<font style="vertical-align: inherit;">：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（*）FROM t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IN（1,2，...，</font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和B IN（1,2，...，</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre>
										<p>
											<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">列表</font>
												<font style="vertical-align: inherit;">
													中的每个文字值都
												</font>
												<font style="vertical-align: inherit;">计为一个谓词组合</font>
											</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">如果有两个</font>
											</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													列表，则组合的谓词
												</font>
											</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">数是每个列表中文字值的数量的乘积。</font>
												<font style="vertical-align: inherit;">因此，与</font>
											</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">前一种情况</font>
												<font style="vertical-align: inherit;">相结合的谓词数
												</font>
												<font style="vertical-align: inherit;">是
												</font>
											</font><em class="replaceable"><code>M</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">×
												</font>
											</font><em class="replaceable"><code>N</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>

						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="index-merge-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.3索引合并优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091708949232"></a><a class="indexterm" name="idm140091708948192"></a><a class="indexterm"
						 name="idm140091708947104"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><span class="firstterm">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">指数合并</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">访问方法检索与多行
								</font>
							</font><a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">扫描和他们的结果合并到一个。</font>
								<font style="vertical-align: inherit;">此访问方法仅合并来自单个表的索引扫描，而不是跨多个表扫描。</font>
								<font style="vertical-align: inherit;">合并可以生成其基础扫描的联合，交叉或交叉联合。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									可以使用Index Merge的示例查询：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10 OR </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 20;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（</font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10 OR </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 20）AND </font></font><em class="replaceable"><code>non_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 30;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（t1。IN </font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1,2）OR </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t1。LIKE' </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  和t2。</font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= t1。</font></font><em class="replaceable"><code>some_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t1。</font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND（t2。</font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= t1。</font></font><em class="replaceable"><code>some_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者t2。</font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= t1。</font></font><em class="replaceable"><code>some_col2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre>
						<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

							<div class="admon-title">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										注意
									</font>
								</font>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										索引合并优化算法具有以下已知限制：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果您的查询具有</font>
											</font><code class="literal">WHERE</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													带深度</font>
											</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">/ </font>
											</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													嵌套</font>
												<font style="vertical-align: inherit;">的复杂</font>
												<font style="vertical-align: inherit;">子句
												</font>
												<font style="vertical-align: inherit;">且MySQL未选择最佳计划，请尝试使用以下身份转换来分发术语：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>x</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>y</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）OR </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;（</font></font><em class="replaceable"><code>x</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）AND（</font></font><em class="replaceable"><code>y</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><em class="replaceable"><code>x</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><em class="replaceable"><code>y</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）AND </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;（</font></font><em class="replaceable"><code>x</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）OR（</font></font><em class="replaceable"><code>y</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>z</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													索引合并不适用于全文索引。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">输出中，索引合并方法显示
								</font>
							</font><a class="link" href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在
								</font>
							</font><code class="literal">type</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列中。</font>
								<font style="vertical-align: inherit;">在这种情况下，该
								</font>
							</font><code class="literal">key</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列包含使用的索引列表，并</font>
							</font><code class="literal">key_len</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">包含这些索引的最长关键部分的列表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									Index Merge访问方法有几种算法，它们显示在</font>
								<font style="vertical-align: inherit;">输出</font>
							</font><code class="literal">Extra</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">字段中
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<code class="literal">Using intersect(...)</code>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using union(...)</code>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using sort_union(...)</code>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下部分更详细地描述了这些算法。</font>
								<font style="vertical-align: inherit;">优化器根据各种可用选项的成本估算在不同的可能索引合并算法和其他访问方法之间进行选择。
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p><a class="xref" href="optimization.html#index-merge-intersection" title="索引合并交叉口访问算法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引合并交叉口访问算法</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#index-merge-union" title="索引合并联盟访问算法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引合并联盟访问算法</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#index-merge-sort-union" title="索引合并排序联合访问算法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引合并排序联合访问算法</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#index-merge-influencing" title="影响指数合并优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">影响指数合并优化</font>
											</font>
										</a></p>
								</li>
							</ul>
						</div>

						<div class="simplesect">

							<div class="titlepage">
								<div>

									<div class="simple">
										<h5 class="title"><a name="index-merge-intersection"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引合并交叉口访问算法</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										当</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句在不同的键上组合</font>
									<font style="vertical-align: inherit;">时</font>
									<font style="vertical-align: inherit;">转换为多个范围条件
									</font>
									<font style="vertical-align: inherit;">时，此访问算法适用
									</font>
								</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，并且每个条件都是以下条件之一：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">这个表单的</font>
												<font style="vertical-align: inherit;">
													一个</font>
												<font style="vertical-align: inherit;">-part表达式，其中索引具有完全
												</font>
											</font><em class="replaceable"><code>N</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">部分（即，所有索引部分都被覆盖）：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... AND </font></font><em class="replaceable"><code>key_partN</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font><em class="replaceable"><code>constN</code></em>
</pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;"></font><code class="literal">InnoDB</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">表</font>
												<font style="vertical-align: inherit;">
													的主键上的任何范围条件
												</font>
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										例子：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>innodb_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;10 AND </font></font><em class="replaceable"><code>key_col1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 20;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key1_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>key1_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2 AND </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2;
</font></font></pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										索引合并交集算法对所有使用的索引执行同时扫描，并生成从合并索引扫描接收的行序列的交集。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果查询中使用的所有列都被使用的索引覆盖，则不会检索完整的表行（</font>
									<font style="vertical-align: inherit;">
										在这种情况下</font>
								</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">输出包含
									</font>
								</font><code class="literal">Using index</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">在</font>
								</font><code class="literal">Extra</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">字段中）。</font>
									<font style="vertical-align: inherit;">以下是此类查询的示例：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（*）FROM t1 WHERE key1 = 1 AND key2 = 1;
</font></font></pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果使用的索引未涵盖查询中使用的所有列，则仅在满足所有使用的键的范围条件时才检索完整行。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果其中一个合并条件是</font>
								</font><code class="literal">InnoDB</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表</font>
									<font style="vertical-align: inherit;">的主键上的条件</font>
									<font style="vertical-align: inherit;">，则它不用于行检索，而是用于过滤掉使用其他条件检索的行。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="index-merge-union"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引合并联盟访问算法</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										该算法的标准类似于索引合并交集算法的标准。</font>
									<font style="vertical-align: inherit;">当表的</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句在不同的键上组合时转换为多个范围条件</font>
									<font style="vertical-align: inherit;">时，该算法适用</font>
								</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，并且每个条件都是以下条件之一：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">这个表单的</font>
												<font style="vertical-align: inherit;">
													一个</font>
												<font style="vertical-align: inherit;">-part表达式，其中索引具有完全
												</font>
											</font><em class="replaceable"><code>N</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">部分（即，所有索引部分都被覆盖）：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... AND </font></font><em class="replaceable"><code>key_partN</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font><em class="replaceable"><code>constN</code></em>
</pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;"></font><code class="literal">InnoDB</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">表</font>
												<font style="vertical-align: inherit;">
													的主键上的任何范围条件
												</font>
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													索引合并交集算法适用的条件。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										例子：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 OR </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2 OR </font></font><em class="replaceable"><code>key3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 3;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>innodb_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（</font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     OR（</font></font><em class="replaceable"><code>key3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='foo'AND </font></font><em class="replaceable"><code>key4</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='bar'）AND </font></font><em class="replaceable"><code>key5</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 5;
</font></font></pre>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="index-merge-sort-union"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引合并排序联合访问算法</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										当</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句转换为多个范围条件
									</font>
									<font style="vertical-align: inherit;">时，此访问算法适用
									</font>
								</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，但索引合并并集算法不适用。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										例子：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_col1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;10 OR </font></font><em class="replaceable"><code>key_col2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;20;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（</font></font><em class="replaceable"><code>key_col1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; 10 OR </font></font><em class="replaceable"><code>key_col2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 20）AND </font></font><em class="replaceable"><code>nonkey_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 30;
</font></font></pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										sort-union算法和union算法之间的区别在于sort-union算法必须首先获取所有行的行ID，然后在返回任何行之前对它们进行排序。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="index-merge-influencing"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">影响指数合并优化</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										索引合并的使用是受价值
									</font>
								</font><code class="literal">index_merge</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><code class="literal">index_merge_intersection</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><code class="literal">index_merge_union</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，和
									</font>
								</font><code class="literal">index_merge_sort_union</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">该旗
									</font>
								</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">系统变量。</font>
									<font style="vertical-align: inherit;">请参见</font>
								</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.9.2节“可切换的优化”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">默认情况下，所有这些标志都是</font>
								</font><code class="literal">on</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">要仅启用某些算法，请设置</font>
								</font><code class="literal">index_merge</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">为</font>
								</font><code class="literal">off</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，并仅启用应允许的其他</font>
									<font style="vertical-align: inherit;">算法
									</font>
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										除了使用
									</font>
								</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">系统变量来控制优化程序在会话范围内使用索引合并算法之外，MySQL还支持优化程序提示以基于每个语句影响优化程序。</font>
									<font style="vertical-align: inherit;">请参见
									</font>
								</font><a class="xref" href="optimization.html#optimizer-hints" title="8.9.3优化器提示">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.9.3节“优化程序提示”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="condition-pushdown-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.4发动机状态下推优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这种优化提高了非索引列和常量之间直接比较的效率。</font>
								<font style="vertical-align: inherit;">在这种情况下，将条件</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">下推</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">到存储引擎以进行评估。</font>
								<font style="vertical-align: inherit;">此优化只能由</font>
							</font><a class="link" href="mysql-cluster.html" title="第22章MySQL NDB Cluster 8.0"><code class="literal">NDB</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎使用。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于NDB Cluster，此优化可以消除在群集的数据节点和发出查询的MySQL服务器之间通过网络发送不匹配行的需要，并且可以将查询的使用速度提高5到10倍。条件下推可能但不使用。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									假设NDB Cluster表定义如下：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    一个INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    b INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    KEY（一）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = NDB;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									条件下推可以用于查询，例如此处显示的查询，其中包括非索引列和常量之间的比较：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT a，b FROM t1 WHERE b = 10;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									条件下推的使用可以在输出中看到
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT a,b FROM t1 WHERE b = 10\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：全部</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          key：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用推动条件的地方</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									但是，条件下推</font>
							</font><span class="emphasis"><em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">不能</font>
									</font>
								</em></span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">与这两个查询中的任何一个一起使用：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT a，b FROM t1 WHERE a = 10;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT a，b FROM t1 WHERE b + 1 = 10;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									条件下推不适用于第一个查询，因为列上存在索引</font>
							</font><code class="literal">a</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">（索引访问方法将更有效，因此将优先选择条件下推。）条件下推不能用于第二个查询，因为涉及非索引列的比较
								</font>
							</font><code class="literal">b</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是间接的。</font>
								<font style="vertical-align: inherit;">（但是，如果您</font>
							</font><code class="literal">b + 1 =
								10</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">要</font>
							</font><code class="literal">b = 9</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在
								</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条款中</font>
								<font style="vertical-align: inherit;">减少条件，则可以应用条件下推</font>
								<font style="vertical-align: inherit;">。）
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当索引列与使用</font>
							</font><code class="literal">&gt;</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或
								</font>
							</font><code class="literal">&lt;</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">运算符</font>
								<font style="vertical-align: inherit;">的常量进行比较时，也可以使用条件下推</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT a, b FROM t1 WHERE a &lt; 2\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：范围</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          关键：a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用推动条件的地方</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									其他支持的条件下推比较包括以下内容：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<code class="literal"><em class="replaceable"><code>column</code></em> [NOT] LIKE
											<em class="replaceable"><code>pattern</code></em></code>
									</p>
									<p>
										<em class="replaceable"><code>pattern</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">必须是包含要匹配的模式的字符串文字; </font>
											<font style="vertical-align: inherit;">有关语法，请参见</font>
										</font><a class="xref" href="functions.html#string-comparison-functions" title="12.5.1字符串比较函数">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第12.5.1节“字符串比较函数”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal"><em class="replaceable"><code>column</code></em> IS [NOT]
											NULL</code>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal"><em class="replaceable"><code>column</code></em> IN
											(<em class="replaceable"><code>value_list</code></em>)</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												每个项目</font>
										</font><em class="replaceable"><code>value_list</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												必须是一个常量，字面值。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal"><em class="replaceable"><code>column</code></em> BETWEEN
											<em class="replaceable"><code>constant1</code></em> AND
											<em class="replaceable"><code>constant2</code></em></code>
									</p>
									<p>
										<em class="replaceable"><code>constant1</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">并且
											</font>
										</font><em class="replaceable"><code>constant2</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">每个都必须是一个恒定的字面值。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在前面列表中的所有情况中，条件可以转换为列和常量之间的一个或多个直接比较的形式。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									默认情况下启用发动机状态下推。</font>
								<font style="vertical-align: inherit;">要在服务器启动时禁用它，请设置
								</font>
							</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统变量。</font>
								<font style="vertical-align: inherit;">例如，在</font>
							</font><code class="filename">my.cnf</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">文件中，使用以下行：
								</font>
							</font>
						</p>
						<pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
optimizer_switch = engine_condition_pushdown =关</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在运行时，禁用条件下推，如下所示：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='engine_condition_pushdown = off';
</font></font></pre>
						<p><b>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">限制。&nbsp;</font>
								</font>
							</b>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									发动机状态下推受以下限制：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												条件下推仅由</font>
										</font><a class="link" href="mysql-cluster.html" title="第22章MySQL NDB Cluster 8.0"><code class="literal">NDB</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">存储引擎</font>
											<font style="vertical-align: inherit;">支持
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												列可以仅与常量进行比较; </font>
											<font style="vertical-align: inherit;">但是，这包括评估为常量值的表达式。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												比较中使用的列不能是任何
											</font>
											<font style="vertical-align: inherit;">类型</font>
										</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">类型。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												要与列进行比较的字符串值必须使用与列相同的排序规则。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												不直接支持联接; </font>
											<font style="vertical-align: inherit;">涉及多个表的条件在可能的情况下单独推送。</font>
											<font style="vertical-align: inherit;">使用扩展</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">输出来确定实际按下哪些条件。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="optimization.html#explain-extended" title="8.8.3扩展EXPLAIN输出格式">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.8.3节“扩展EXPLAIN输出格式”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以前，条件下推仅限于引用条件被推送到的同一表中的列值的术语。</font>
								<font style="vertical-align: inherit;">从NDB 8.0.16开始，查询计划中较早的表中的列值也可以从推送条件中引用。</font>
								<font style="vertical-align: inherit;">这减少了在连接处理期间SQL节点必须处理的行数。</font>
								<font style="vertical-align: inherit;">过滤也可以在LDM线程中并行执行，而不是在单个</font>
							</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">mysqld</font>
										</font>
									</strong></span></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									进程中执行。</font>
								<font style="vertical-align: inherit;">这有可能大大提高查询性能。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在以下两种情况下，连接算法不能与先前表中的引用列组合：
								</font>
							</font>
						</p>
						<div class="orderedlist">
							<ol class="orderedlist" type="1">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当任何前面提到的表都在连接缓冲区中时。</font>
											<font style="vertical-align: inherit;">在这种情况下，从扫描过滤表中检索的每一行都与缓冲区中的每一行进行匹配。</font>
											<font style="vertical-align: inherit;">这意味着在生成扫描过滤器时，没有单个特定行可从中获取列值。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当列来自推送连接中的子操作时。</font>
											<font style="vertical-align: inherit;">这是因为在生成扫描过滤器时尚未检索从连接中的祖先操作引用的行。
											</font>
										</font>
									</p>
								</li>
							</ol>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="index-condition-pushdown-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.5指数条件下推优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									索引条件下推（ICP）是对MySQL使用索引从表中检索行的情况的优化。</font>
								<font style="vertical-align: inherit;">如果没有ICP，存储引擎会遍历索引以查找基表中的行，并将它们返回给MySQL服务器，该服务器会评估</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">行</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">条件。</font>
								<font style="vertical-align: inherit;">启用ICP后，如果</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">只使用索引中的列来评估</font>
								<font style="vertical-align: inherit;">部分
								</font>
								<font style="vertical-align: inherit;">条件，MySQL服务器会推送这部分内容。</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件下到存储引擎。</font>
								<font style="vertical-align: inherit;">然后，存储引擎使用索引条目评估推送的索引条件，并且仅当满足该条件时才从表中读取行。</font>
								<font style="vertical-align: inherit;">ICP可以减少存储引擎必须访问基表的次数以及MySQL服务器必须访问存储引擎的次数。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									指数条件下推优化的适用性受以下条件限制：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												ICP用于
											</font>
										</font><a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，和
											</font>
										</font><a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">访问方法时，有必要访问完整的表行。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												ICP可用于</font>
											<font style="vertical-align: inherit;">表</font>
										</font><a class="link" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎"><code class="literal">InnoDB</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												和</font>
										</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表，包括分区</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表，ICP仅用于二级索引。</font>
											<font style="vertical-align: inherit;">ICP的目标是减少全行读取的数量，从而减少I / O操作。</font>
											<font style="vertical-align: inherit;">对于
											</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">聚簇索引，已将完整记录读入</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												缓冲区。</font>
											<font style="vertical-align: inherit;">在这种情况下使用ICP不会降低I / O.
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在虚拟生成列上创建的二级索引不支持ICP。</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												支持虚拟生成列上的二级索引。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												引用子查询的条件无法下推。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												无法推下涉及存储函数的条件。</font>
											<font style="vertical-align: inherit;">存储引擎无法调用存储的函数。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												触发条件无法下推。</font>
											<font style="vertical-align: inherit;">（有关触发条件的信息，请参见
											</font>
										</font><a class="xref" href="optimization.html#subquery-optimization-with-exists" title="8.2.2.3使用EXISTS策略优化子查询">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.2.3节“使用EXISTS策略优化子查询”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。）
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要了解此优化的工作原理，请首先考虑在不使用索引条件下推时索引扫描的进度：
								</font>
							</font>
						</p>
						<div class="orderedlist">
							<ol class="orderedlist" type="1">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												获取下一行，首先读取索引元组，然后使用索引元组找到并读取整个表行。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												测试</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">适用于此表</font>
											<font style="vertical-align: inherit;">的</font>
											<font style="vertical-align: inherit;">条件</font>
											<font style="vertical-align: inherit;">部分</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">根据测试结果接受或拒绝该行。
											</font>
										</font>
									</p>
								</li>
							</ol>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用索引条件下推，扫描会像这样进行：
								</font>
							</font>
						</p>
						<div class="orderedlist">
							<ol class="orderedlist" type="1">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												获取下一行的索引元组（但不是完整的表行）。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												测试</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">适用于此表</font>
											<font style="vertical-align: inherit;">的</font>
											<font style="vertical-align: inherit;">条件</font>
											<font style="vertical-align: inherit;">部分，</font>
											<font style="vertical-align: inherit;">并且只能使用索引列进行检查。</font>
											<font style="vertical-align: inherit;">如果不满足条件，则继续下一行的索引元组。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果满足条件，请使用索引元组来查找并读取整个表行。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												测试</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												适用于此表</font>
											<font style="vertical-align: inherit;">的</font>
											<font style="vertical-align: inherit;">条件</font>
											<font style="vertical-align: inherit;">的剩余部分</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">根据测试结果接受或拒绝该行。
											</font>
										</font>
									</p>
								</li>
							</ol>
						</div>
						<p>
							<a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">使用“索引条件下推”时，</font>
								<font style="vertical-align: inherit;">输出显示
								</font>
							</font><code class="literal">Using index condition</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在
								</font>
							</font><code class="literal">Extra</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列中。</font>
								<font style="vertical-align: inherit;">它没有显示，</font>
							</font><code class="literal">Using index</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									因为当必须读取完整的表行时，这不适用。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									假设一个表包含有关人员及其地址的信息，并且该表的索引定义为
								</font>
							</font><code class="literal">INDEX (zipcode, lastname, firstname)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">如果我们知道一个人的</font>
							</font><code class="literal">zipcode</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">价值但不确定姓氏，我们可以这样搜索：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择*来自人</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE zipcode ='95054'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND lastname LIKE'％etrunia％'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  和地址LIKE'％Main Street％';</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL可以使用索引来扫描人
								</font>
							</font><code class="literal">zipcode='95054'</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">第二部分（</font>
							</font><code class="literal">lastname LIKE '%etrunia%'</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）不能用于限制必须扫描的行数，因此如果没有Index Condition Pushdown，此查询必须为所有拥有的人检索完整的表行
								</font>
							</font><code class="literal">zipcode='95054'</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用索引条件下推，MySQL </font>
							</font><code class="literal">lastname LIKE '%etrunia%'</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在读取整个表行之前</font>
								<font style="vertical-align: inherit;">检查该
								</font>
								<font style="vertical-align: inherit;">部分。</font>
								<font style="vertical-align: inherit;">这样可以避免读取与索引元组相对应的完整行，这些行匹配
								</font>
							</font><code class="literal">zipcode</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件而不是
								</font>
							</font><code class="literal">lastname</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									默认情况下启用索引条件下推。</font>
								<font style="vertical-align: inherit;">可以</font>
							</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">通过设置</font>
							</font><code class="literal">index_condition_pushdown</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">标志</font>
								<font style="vertical-align: inherit;">来控制
								</font>
								<font style="vertical-align: inherit;">系统变量
								</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='index_condition_pushdown = off';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET optimizer_switch ='index_condition_pushdown = on';</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									请参见</font>
							</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.9.2节“可切换的优化”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="nested-loop-joins"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.6嵌套循环连接算法</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091708730960"></a><a class="indexterm" name="idm140091708729904"></a><a class="indexterm"
						 name="idm140091708728416"></a><a class="indexterm" name="idm140091708727328"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL使用嵌套循环算法或其变体在表之间执行连接。
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p><a class="xref" href="optimization.html#nested-loop-join-algorithm" title="嵌套循环连接算法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">嵌套循环连接算法</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#block-nested-loop-join-algorithm" title="块嵌套循环连接算法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">块嵌套循环连接算法</font>
											</font>
										</a></p>
								</li>
							</ul>
						</div>

						<div class="simplesect">

							<div class="titlepage">
								<div>

									<div class="simple">
										<h5 class="title"><a name="nested-loop-join-algorithm"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">嵌套循环连接算法</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										一个简单的嵌套循环连接（NLJ）算法一次一个循环地从第一个表中读取行，将每一行传递给一个嵌套循环，该循环处理连接中的下一个表。</font>
									<font style="vertical-align: inherit;">这个过程重复多次，因为还有待连接的表。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										假设三个表之间的连接
									</font>
								</font><code class="literal">t1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，</font>
								</font><code class="literal">t2</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">以及
									</font>
								</font><code class="literal">t3</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是使用以下类型的连接来执行：
									</font>
								</font>
							</p>
							<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表连接类型</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t1范围</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t2 ref</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t3 ALL</font></font><font></font>
</pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果使用简单的NLJ算法，则连接处理如下：
									</font>
								</font>
							</p>
							<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于t1匹配范围中的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于t2中匹配引用键的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于t3中的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果行满足连接条件，则发送给客户端</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										因为NLJ算法一次一行地从外循环到内循环传递行，所以它通常多次读取在内循环中处理的表。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="block-nested-loop-join-algorithm"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">块嵌套循环连接算法</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										块嵌套循环（BNL）连接算法使用外部循环中读取的行的缓冲来减少必须读取内部循环中的表的次数。</font>
									<font style="vertical-align: inherit;">例如，如果将10行读入缓冲区并将缓冲区传递给下一个内部循环，则可以将内循环中读取的每一行与缓冲区中的所有10行进行比较。</font>
									<font style="vertical-align: inherit;">这将内表必须读取的次数减少一个数量级。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										MySQL join缓存具有以下特征：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													当连接类型为</font>
												<font style="vertical-align: inherit;">（</font>
											</font><a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">或
												</font>
											</font><a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">换句话说，当不能使用任何可能的键，并且分别完成数据或索引行的完全扫描时），或者，
												</font>
												<font style="vertical-align: inherit;">可以使用连接缓冲
												</font>
											</font><a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">缓冲的使用也适用于外连接，如</font>
											</font><a class="xref" href="optimization.html#bnl-bka-optimization" title="8.2.1.11块嵌套循环和批量密钥访问连接">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">第8.2.1.11节“块嵌套循环和批量密钥访问连接”中所述</font>
												</font>
											</a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													永远不会为第一个非常量表分配连接缓冲区，即使它是类型
												</font>
											</font><a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">或
												</font>
											</font><a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													只有连接感兴趣的列存储在其连接缓冲区中，而不是整行。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													的</font>
											</font><a class="link" href="server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													系统变量来确定每个的大小联接缓冲液用于处理查询。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													为可以缓冲的每个连接分配一个缓冲区，因此可以使用多个连接缓冲区处理给定查询。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在执行连接之前分配连接缓冲区，并在查询完成后释放。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										对于之前针对NLJ算法（不使用缓冲）描述的示例连接，使用join buffering进行如下连接：
									</font>
								</font>
							</p>
							<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于t1匹配范围中的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于t2中匹配引用键的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    存储在连接缓冲区中使用t1，t2中的列</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    如果缓冲区已满{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      对于t3中的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        对于连接缓冲区中的每个t1，t2组合{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          如果行满足连接条件，则发送给客户端</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      空连接缓冲区</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果缓冲区不为空{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于t3中的每一行{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于连接缓冲区中的每个t1，t2组合{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      如果行满足连接条件，则发送给客户端</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果</font>
								</font><em class="replaceable"><code>S</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是每一个存储的大小
									</font>
								</font><code class="literal">t1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，</font>
								</font><code class="literal">t2</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">在加入缓冲液组合和</font>
								</font><em class="replaceable"><code>C</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是组合在缓冲器中的数，次表的数量</font>
								</font><code class="literal">t3</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">被扫描的是：
									</font>
								</font>
							</p>
							<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>S</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* </font></font><em class="replaceable"><code>C</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）/ join_buffer_size + 1
</font></font></pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										数</font>
								</font><code class="literal">t3</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">扫描降低为价值</font>
								</font><a class="link" href="server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										时增加，最高可达点
									</font>
								</font><a class="link" href="server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是大到足以容纳所有上一行组合。</font>
									<font style="vertical-align: inherit;">在那时，通过使其变大不会获得速度。
									</font>
								</font>
							</p>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="nested-join-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.7嵌套连接优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表达联接的语法允许嵌套联接。</font>
								<font style="vertical-align: inherit;">以下讨论涉及</font>
							</font><a class="xref" href="sql-syntax.html#join" title="13.2.10.2 JOIN语法">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第13.2.10.2节“JOIN语法”中</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">描述的连接语法
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;"></font><em class="replaceable"><code>table_factor</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">与SQL标准相比，</font>
								<font style="vertical-align: inherit;">
									语法</font>
								<font style="vertical-align: inherit;">扩展了。</font>
								<font style="vertical-align: inherit;">后者只接受</font>
							</font><em class="replaceable"><code>table_reference</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，而不是在一对括号内的列表。</font>
								<font style="vertical-align: inherit;">如果我们将</font>
							</font><em class="replaceable"><code>table_reference</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">项目</font>
								<font style="vertical-align: inherit;">列表中的每个逗号</font>
								<font style="vertical-align: inherit;">视为等同于内部</font>
								<font style="vertical-align: inherit;">联接，则这是保守扩展
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">例如：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN（t2，t3，t4）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 ON（t2.a = t1.a AND t3.b = t1.b AND t4.c = t1.c）</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									相当于：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN（t2 CROSS JOIN t3 CROSS JOIN t4）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 ON（t2.a = t1.a AND t3.b = t1.b AND t4.c = t1.c）</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL中，</font>
							</font><code class="literal">CROSS JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在语法上等同于</font>
							</font><code class="literal">INNER JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">; </font>
								<font style="vertical-align: inherit;">他们可以互相替换。</font>
								<font style="vertical-align: inherit;">在标准SQL中，它们不等效。
								</font>
							</font><code class="literal">INNER JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">与</font>
							</font><code class="literal">ON</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条款</font>
								<font style="vertical-align: inherit;">一起使用
								</font>
								<font style="vertical-align: inherit;">; </font>
							</font><code class="literal">CROSS JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">否则使用。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									通常，在仅包含内部联接操作的联接表达式中可以忽略括号。</font>
								<font style="vertical-align: inherit;">考虑这个连接表达式：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t1 LEFT JOIN（t2 LEFT JOIN t3 ON t2.b = t3.b或t2.b IS NULL）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   ON t1.a = t2.a</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									删除括号并将操作分组到左侧后，该连接表达式将转换为此表达式：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（t1 LEFT JOIN t2 ON t1.a = t2.a）LEFT JOIN t3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ON t2.b = t3.b或t2.b IS NULL</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									然而，这两个表达并不相同。</font>
								<font style="vertical-align: inherit;">看到这一点，假设表</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">以及</font>
							</font><code class="literal">t3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">具有以下状态：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表</font>
										</font><code class="literal">t1</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">包含行
											</font>
										</font><code class="literal">(1)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">(2)</code>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表</font>
										</font><code class="literal">t2</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">包含行
											</font>
										</font><code class="literal">(1,101)</code>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表</font>
										</font><code class="literal">t3</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">包含行
											</font>
										</font><code class="literal">(101)</code>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在这种情况下，第一个表达式返回结果集包括行</font>
							</font><code class="literal">(1,1,101,101)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">(2,NULL,NULL,NULL)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，而第二表达式返回的行</font>
							</font><code class="literal">(1,1,101,101)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">(2,NULL,NULL,101)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM t1</code></strong>
            <strong class="userinput"><code>LEFT JOIN</code></strong>
            <strong class="userinput"><code>(t2 LEFT JOIN t3 ON t2.b=t3.b OR t2.b IS NULL)</code></strong>
            <strong class="userinput"><code>ON t1.a=t2.a;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">b | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">101 | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM (t1 LEFT JOIN t2 ON t1.a=t2.a)</code></strong>
            <strong class="userinput"><code>LEFT JOIN t3</code></strong>
            <strong class="userinput"><code>ON t2.b=t3.b OR t2.b IS NULL;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">b | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">101 | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在以下示例中，外部联接操作与内部联接操作一起使用：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t1 LEFT JOIN（t2，t3）ON t1.a = t2.a
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该表达式无法转换为以下表达式：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t1 LEFT JOIN t2 ON t1.a = t2.a，t3
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于给定的表状态，这两个表达式返回不同的行集：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM t1 LEFT JOIN (t2, t3) ON t1.a=t2.a;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">b | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">101 | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT *</code></strong>
       <strong class="userinput"><code>FROM t1 LEFT JOIN t2 ON t1.a=t2.a, t3;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">a | </font><font style="vertical-align: inherit;">b | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">101 | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">NULL | </font><font style="vertical-align: inherit;">101 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ + ------ + ------ + ------ +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									因此，如果我们在带有外连接运算符的连接表达式中省略括号，我们可能会更改原始表达式的结果集。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									更准确地说，我们不能忽略左外连接操作的右操作数和右连接操作的左操作数中的括号。</font>
								<font style="vertical-align: inherit;">换句话说，我们不能忽略外连接操作的内部表表达式的括号。</font>
								<font style="vertical-align: inherit;">可以忽略其他操作数（外部表的操作数）的括号。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下表达式：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（t1，t2）LEFT JOIN t3 ON P（t2.b，t3.b）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									相当于这个表达式的任何表
								</font>
							</font><code class="literal">t1,t2,t3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和任何条件
								</font>
							</font><code class="literal">P</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在属性</font>
							</font><code class="literal">t2.b</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									和</font>
							</font><code class="literal">t3.b</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t1，t2 LEFT JOIN t3 ON P（t2.b，t3.b）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									每当连接表达式（</font>
							</font><em class="replaceable"><code>joined_table</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）中</font>
								<font style="vertical-align: inherit;">的连接操作的执行顺序</font>
								<font style="vertical-align: inherit;">不是从左到右时，我们就讨论嵌套连接。</font>
								<font style="vertical-align: inherit;">请考虑以下查询：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN（t2 LEFT JOIN t3 ON t2.b = t3.b）ON t1.a = t2.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t1.a&gt; 1</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1 LEFT JOIN（t2，t3）ON t1.a = t2.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（t2.b = t3.b OR t2.b IS NULL）AND t1.a&gt; 1</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这些查询被认为包含这些嵌套连接：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t2 LEFT JOIN t3 ON t2.b = t3.b.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
t2，t3</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在第一个查询中，嵌套连接由左连接操作形成。</font>
								<font style="vertical-align: inherit;">在第二个查询中，它由内部联接操作形成。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在第一个查询中，可以省略括号：连接表达式的语法结构将指示连接操作的相同执行顺序。</font>
								<font style="vertical-align: inherit;">对于第二个查询，不能省略括号，尽管这里的连接表达式可以在没有它们的情况下明确解释。</font>
								<font style="vertical-align: inherit;">在我们的扩展语法中，</font>
							</font><code class="literal">(t2,
								t3)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第二个查询</font>
								<font style="vertical-align: inherit;">的括号</font>
								<font style="vertical-align: inherit;">是必需的，尽管理论上可以在没有它们的情况下解析查询：我们仍然会为查询提供明确的语法结构，因为</font>
							</font><code class="literal">LEFT JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">它</font>
							</font><code class="literal">ON</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									扮演了表达式的左右分隔符的角色</font>
							</font><code class="literal">(t2,t3)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									前面的例子证明了这些要点：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于仅涉及内部联接（而不是外部联接）的联接表达式，可以删除括号并从左到右计算联接。</font>
											<font style="vertical-align: inherit;">实际上，可以按任何顺序评估表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												通常，对于外连接或与内连接混合的外连接，情况也是如此。</font>
											<font style="vertical-align: inherit;">删除括号可能会改变结果。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<a class="indexterm" name="idm140091708625184"></a><a class="indexterm" name="idm140091708623696"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									具有嵌套外连接的查询以与具有内连接的查询相同的管道方式执行。</font>
								<font style="vertical-align: inherit;">更确切地说，利用了嵌套循环连接算法的变体。</font>
								<font style="vertical-align: inherit;">回想一下嵌套循环连接执行查询的算法（参见</font>
							</font><a class="xref" href="optimization.html#nested-loop-joins" title="8.2.1.6嵌套循环连接算法">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.2.1.6节“嵌套循环连接算法”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。</font>
								<font style="vertical-align: inherit;">假设3个表的连接查询</font>
							</font><code class="literal">T1,T2,T3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">具有以下形式：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 INNER JOIN T2 ON P1（T1，T2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 INNER JOIN T3 ON P2（T2，T3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  P（T1，T2，T3）</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这里，</font>
							</font><code class="literal">P1(T1,T2)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">P2(T3,T3)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是一些连接条件（上表达），而</font>
							</font><code class="literal">P(T1,T2,T3)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">超过表中的列的条件</font>
							</font><code class="literal">T1,T2,T3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									嵌套循环连接算法将以下列方式执行此查询：
								</font>
							</font>
						</p>
						<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1 {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2，使得P1（t1，t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T3中的每一行t3，使得P2（t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									符号</font>
							</font><code class="literal">t1||t2||t3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表示通过连接的行的列构成的行
								</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">t3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">在以下某些示例中，
								</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表名称的显示表示一行</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">用于该表的每一列。</font>
								<font style="vertical-align: inherit;">例如，</font>
							</font><code class="literal">t1||t2||NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									指示通过连接的行的列构成的行</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，以及
								</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">对于每一列
								</font>
							</font><code class="literal">t3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">据说这样一行是完成的
								</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p><a class="indexterm" name="idm140091708605280"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									现在考虑使用嵌套外连接的查询：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （T2 LEFT JOIN T3 ON P2（T2，T3））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ON P1（T1，T2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  P（T1，T2，T3）</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于此查询，修改嵌套循环模式以获取：
								</font>
							</font>
						</p>
						<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1 {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BOOL f1：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2，使得P1（t1，t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    BOOL f2：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T3中的每一行t3，使得P2（t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F2 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IF（！f2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，NULL）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 NULL; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IF（！f1）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IF P（t1，NULL，NULL）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      T：= T 1 || || NULL NULL; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									通常，对于外连接操作中第一个内部表的任何嵌套循环，引入一个在循环之前关闭并在循环之后检查的标志。</font>
								<font style="vertical-align: inherit;">当对于来自外部表的当前行，找到与表示内部操作数的表的匹配时，该标志被打开。</font>
								<font style="vertical-align: inherit;">如果在循环周期结束时标志仍然关闭，则找不到外部表的当前行的匹配项。</font>
								<font style="vertical-align: inherit;">在这种情况下，行由</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">内部表的列的值</font>
								<font style="vertical-align: inherit;">补充
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">结果行将传递给输出的最终检查或下一个嵌套循环，但前提是该行满足所有嵌入外连接的连接条件。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在该示例中，嵌入了由以下表达式表示的外连接表：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（T2 LEFT JOIN T3 ON P2（T2，T3））
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于具有内部联接的查询，优化程序可以选择不同的嵌套循环顺序，例如：
								</font>
							</font>
						</p>
						<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T3中的每一行t3 {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2，使得P2（t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T1中的每一行t1，使得P1（t1，t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于具有外连接的查询，优化器只能选择这样的顺序，其中外部表的循环位于内部表的循环之前。</font>
								<font style="vertical-align: inherit;">因此，对于具有外连接的查询，只能有一个嵌套顺序。</font>
								<font style="vertical-align: inherit;">对于以下查询，优化程序将评估两种不同的嵌套。</font>
								<font style="vertical-align: inherit;">在两个嵌套中，
								</font>
							</font><code class="literal">T1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">必须在外部循环中处理，因为它在外部联接中使用。</font>
							</font><code class="literal">T2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">并
								</font>
							</font><code class="literal">T3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在内部联接中使用，因此必须在内部循环中处理联接。</font>
								<font style="vertical-align: inherit;">但是，因为连接是内连接，</font>
							</font><code class="literal">T2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">并且
								</font>
							</font><code class="literal">T3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可以按任何顺序处理。
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * T1 LEFT JOIN（T2，T3）ON P1（T1，T2）和P2（T1，T3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  P（T1，T2，T3）</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									一个嵌套评估</font>
							</font><code class="literal">T2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，然后
								</font>
							</font><code class="literal">T3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1 {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BOOL f1：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2，使得P1（t1，t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T3中的每一行t3，使得P2（t1，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1：= TRUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IF（！f1）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IF P（t1，NULL，NULL）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      T：= T 1 || || NULL NULL; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									另一个嵌套评估</font>
							</font><code class="literal">T3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，然后
								</font>
							</font><code class="literal">T2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1 {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BOOL f1：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T3中的每一行t3，使得P2（t1，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T2中的每一行t2，使得P1（t1，t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1：= TRUE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IF（！f1）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IF P（t1，NULL，NULL）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      T：= T 1 || || NULL NULL; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在讨论内部联接的嵌套循环算法时，我们省略了一些细节，这些细节对查询执行性能的影响可能很大。</font>
								<font style="vertical-align: inherit;">我们没有提到所谓的
								</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">推倒</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件。</font>
								<font style="vertical-align: inherit;">假设我们的
								</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件
								</font>
							</font><code class="literal">P(T1,T2,T3)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可以用一个连接公式表示：
								</font>
							</font>
						</p>
						<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P（T1，T2，T2）= C1（T1）和C2（T2）和C3（T3）。
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在这种情况下，MySQL实际上使用以下嵌套循环算法来执行带有内连接的查询：
								</font>
							</font>
						</p>
						<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1，使得C1（t1）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2，使得P1（t1，t2）和C2（t2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T3中的每一行t3，使得P2（t2，t3）和C3（t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF P（t1，t2，t3）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									你看，每个合取的</font>
							</font><code class="literal">C1(T1)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">C2(T2)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">C3(T3)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是最内环的推到最外环的地方进行评估。</font>
								<font style="vertical-align: inherit;">如果</font>
							</font><code class="literal">C1(T1)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是一个非常严格的条件，这种情况下推可能会大大减少</font>
							</font><code class="literal">T1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									传递给内部循环的</font>
								<font style="vertical-align: inherit;">表中的行数</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">结果，查询的执行时间可能会大大改善。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于具有外部联接的查询，</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									仅在发现外部表中的当前行与内部表中的匹配项之后才检查条件。</font>
								<font style="vertical-align: inherit;">因此，从内嵌套循环中推出条件的优化不能直接应用于具有外连接的查询。</font>
								<font style="vertical-align: inherit;">这里我们必须引入条件下推谓词，这些谓词由遇到匹配时打开的标志保护。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									回想一下外连接的这个例子：
								</font>
							</font>
						</p>
						<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P（T1，T2，T3）= C1（T1）和C（T2）和C3（T3）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于该示例，使用受保护的下推条件的嵌套循环算法如下所示：
								</font>
							</font>
						</p>
						<pre data-lang="clike" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于T1中的每一行t1，使得C1（t1）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  BOOL f1：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对于T2中的每一行t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      这样P1（t1，t2）AND（f1？C2（t2）：TRUE）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    BOOL f2：= FALSE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    对于T3中的每一行t3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        这样P2（t2，t3）AND（f1 &amp;&amp; f2？C3（t3）：TRUE）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF（f1 &amp;&amp; f2？TRUE：（C2（t2）AND C3（t3）））{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 T3; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F2 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    IF（！f2）{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      IF（f1？TRUE：C2（t2）&amp;&amp; P（t1，t2，NULL））{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        T：= T 1 || || T2 NULL; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      F1 = TRUE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IF（！f1 &amp;&amp; P（t1，NULL，NULL））{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      T：= T 1 || || NULL NULL; </font><font style="vertical-align: inherit;">输出t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									通常，可以从诸如</font>
							</font><code class="literal">P1(T1,T2)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和的
								</font>
								<font style="vertical-align: inherit;">连接条件中提取下推谓词</font>
							</font><code class="literal">P(T2,T3)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">在这种情况下，下推谓词也受到一个标志的保护，该标志阻止检查</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">由相应的外连接操作生成</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">- 实现行</font>
								<font style="vertical-align: inherit;">的谓词</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果由</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件中</font>
								<font style="vertical-align: inherit;">的谓词引起，则禁止在同一嵌套连接中通过键从一个内部表访问另一个内部表</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="outer-join-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.8外连接优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091708563504"></a><a class="indexterm" name="idm140091708562016"></a><a class="indexterm"
						 name="idm140091708560528"></a><a class="indexterm" name="idm140091708559456"></a><a class="indexterm" name="idm140091708557968"></a><a
						 class="indexterm" name="idm140091708556896"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									外连接包括</font>
							</font><code class="literal">LEFT JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">RIGHT JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL实现</font>
								<font style="vertical-align: inherit;">如下：
								</font>
							</font><code class="literal"><em class="replaceable"><code>A</code></em> LEFT
								JOIN <em class="replaceable"><code>B</code></em>
								<em class="replaceable"><code>join_specification</code></em></code>
							<font style="vertical-align: inherit;"></font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表</font>
										</font><em class="replaceable"><code>B</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">设置为依赖于表</font>
										</font><em class="replaceable"><code>A</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和所有
											</font>
											<font style="vertical-align: inherit;">依赖的表</font>
										</font><em class="replaceable"><code>A</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表</font>
										</font><em class="replaceable"><code>A</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">设置为依赖于</font>
											<font style="vertical-align: inherit;">条件</font>
										</font><em class="replaceable"><code>B</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">中使用的</font>
											<font style="vertical-align: inherit;">所有表（除外</font>
											<font style="vertical-align: inherit;">）</font>
										</font><code class="literal">LEFT JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">LEFT JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">条件用于决定如何从表中检索行
											</font>
										</font><em class="replaceable"><code>B</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">（换句话说，</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">不使用</font>
											<font style="vertical-align: inherit;">该</font>
											<font style="vertical-align: inherit;">子句中的</font>
											<font style="vertical-align: inherit;">任何条件</font>
											<font style="vertical-align: inherit;">。）
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												执行所有标准连接优化，但始终在所依赖的所有表之后读取表。</font>
											<font style="vertical-align: inherit;">如果存在循环依赖关系，则会发生错误。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;"></font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">执行</font>
											<font style="vertical-align: inherit;">
												所有标准</font>
											<font style="vertical-align: inherit;">优化。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果</font>
										</font><em class="replaceable"><code>A</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">匹配该</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句</font>
											<font style="vertical-align: inherit;">的行中有一行</font>
											<font style="vertical-align: inherit;">，但没有</font>
										</font><em class="replaceable"><code>B</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">匹配
											</font>
										</font><code class="literal">ON</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">条件的</font>
										</font><em class="replaceable"><code>B</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">行，则会生成</font>
											<font style="vertical-align: inherit;">一个额外的
											</font>
											<font style="vertical-align: inherit;">行，并将所有列设置为</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果您用于</font>
										</font><code class="literal">LEFT JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">查找某些表中不存在的行，并且您有以下测试：</font>
										</font><code class="literal"><em class="replaceable"><code>col_name</code></em> IS
											NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">部件中，哪
											</font>
										</font><em class="replaceable"><code>col_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">一个是声明为的列</font>
										</font><code class="literal">NOT NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，MySQL在找到后停止搜索更多行（对于特定的键组合）一行符合</font>
										</font><code class="literal">LEFT
											JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">条件。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><code class="literal">RIGHT JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">实现类似于</font>
							</font><code class="literal">LEFT JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表格角色颠倒的实现。</font>
								<font style="vertical-align: inherit;">右连接转换为等效的左连接，如</font>
							</font><a class="xref" href="optimization.html#outer-join-simplification" title="8.2.1.9外连接简化">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.2.1.9节“外连接简化”中所述</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于a </font>
							</font><code class="literal">LEFT JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，如果</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">生成的</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">行</font>
								<font style="vertical-align: inherit;">的
								</font>
								<font style="vertical-align: inherit;">条件始终为false </font>
								<font style="vertical-align: inherit;">，则将</font>
							</font><code class="literal">LEFT
								JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">其更改为内部联接。</font>
								<font style="vertical-align: inherit;">例如，
								</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">如果条款是在下面的查询错误的</font>
							</font><code class="literal">t2.column1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是
								</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN t2 ON（column1）WHERE t2.column2 = 5;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									因此，将查询转换为内部联接是安全的：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1，t2 WHERE t2.column2 = 5 AND t1.column1 = t2.column1;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL 8.0.14及更高版本中，</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									由常量文字表达式引起的</font>
								<font style="vertical-align: inherit;">微不足道的</font>
								<font style="vertical-align: inherit;">条件在准备期间被移除，而不是在优化的后期阶段被移除，此时连接已经被简化。</font>
								<font style="vertical-align: inherit;">早期删除琐碎的条件允许优化器将外连接转换为内连接; </font>
								<font style="vertical-align: inherit;">这可以改善包含</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									子句中</font>
								<font style="vertical-align: inherit;">包含琐碎条件的外连接的查询计划</font>
								<font style="vertical-align: inherit;">，例如：
								</font>
							</font>
						</p>
						<pre class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN t2 ON </font></font><em class="replaceable"><code>condition_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>condition_2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR 0 = 1
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化器现在在准备期间看到0 = 1始终为false，使得</font>
							</font><code class="literal">OR 0 = 1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">冗余，并将其删除，留下：
								</font>
							</font>
						</p>
						<pre class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN t2 ON </font></font><em class="replaceable"><code>condition_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里</font></font><em class="replaceable"><code>condition_2</code></em>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									现在，优化器可以将查询重写为内部联接，如下所示：
								</font>
							</font>
						</p>
						<pre class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 JOIN t2 WHERE </font></font><em class="replaceable"><code>condition_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND</font></font><em class="replaceable"><code>condition_2</code></em>
</pre><a class="indexterm" name="idm140091708511504"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									现在优化器可以在表</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">之前</font>
								<font style="vertical-align: inherit;">使用表</font>
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">如果这样做会导致更好的查询计划。</font>
								<font style="vertical-align: inherit;">要提供有关表连接顺序的提示，请使用优化程序提示; </font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="optimization.html#optimizer-hints" title="8.9.3优化器提示">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.9.3节“优化程序提示”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">或者，使用
								</font>
							</font><code class="literal">STRAIGHT_JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">; </font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="sql-syntax.html#select" title="13.2.10 SELECT语法">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第13.2.10节“SELECT语法”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">但是，
								</font>
							</font><code class="literal">STRAIGHT_JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可能会阻止使用索引，因为它会禁用半连接转换; </font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="optimization.html#semi-joins" title="8.2.2.1使用半连接转换优化子查询，派生表，视图引用和公用表表达式">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表，视图引用和公用表表达式”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="outer-join-simplification"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.9外连接简化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">FROM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在许多情况下，简化了查询子句中的</font>
								<font style="vertical-align: inherit;">
									表表达式</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在解析器阶段，具有右外连接操作的查询将转换为仅包含左连接操作的等效查询。</font>
								<font style="vertical-align: inherit;">在一般情况下，执行转换以使此右连接：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（T1，...）RIGHT JOIN（T2，...）ON P（T1，...，T2，...）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									成为等效的左连接：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（T2，...）LEFT JOIN（T1，...）ON P（T1，...，T2，...）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表单的所有内连接表达式</font>
							</font><code class="literal">T1 INNER JOIN
								T2 ON P(T1,T2)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">都被列表替换
								</font>
							</font><code class="literal">T1,T2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">P(T1,T2)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">作为</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件的连接（或嵌入连接的连接条件，如果有的话）连接。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当优化器评估外连接操作的计划时，它仅考虑计划，对于每个此类操作，在内部表之前访问外部表。</font>
								<font style="vertical-align: inherit;">优化器选项是有限的，因为只有这样的计划才能使用嵌套循环算法执行外连接。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									考虑一下这个表单的查询，其中</font>
							</font><code class="literal">R(T2)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									大大缩小了表中匹配行的数量
								</font>
							</font><code class="literal">T2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * T1 LEFT JOIN T2 ON P1（T1，T2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  P（T1，T2）和R（T2）</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果查询是按写入的方式执行的，那么优化器别无选择，只能在限制</font>
							</font><code class="literal">T1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">较多的</font>
								<font style="vertical-align: inherit;">表</font>
								<font style="vertical-align: inherit;">之前</font>
								<font style="vertical-align: inherit;">访问限制较少的
								</font>
								<font style="vertical-align: inherit;">表
								</font>
							</font><code class="literal">T2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，这可能会产生效率非常低的执行计划。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									相反，如果</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件为空拒绝</font>
								<font style="vertical-align: inherit;">，MySQL会将查询转换为不带外连接操作的查询</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">（也就是说，它将外连接转换为内连接。）如果一个条件计算为</font>
							</font><code class="literal">FALSE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或</font>
							</font><code class="literal">UNKNOWN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">为任何
								</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">为该操作生成的已完成行，则该</font>
								<font style="vertical-align: inherit;">条件对于外连接操作被称为空拒绝
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p><a class="indexterm" name="idm140091708486688"></a><a class="indexterm" name="idm140091708485616"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									因此，对于此外连接：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T1 LEFT JOIN T2 ON T1.A = T2.A
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									诸如此类的条件被null拒绝，因为对于任何已完成的</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">行（
								</font>
							</font><code class="literal">T2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列设置为</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">），</font>
								<font style="vertical-align: inherit;">它们不能为真</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T2.B不是空的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T2.B&gt; 3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T2.C &lt;= T1.C</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T2.B &lt;2或T2.C&gt; 1</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									诸如此类的条件不会被拒绝，因为它们对于已完成的</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">行</font>
								<font style="vertical-align: inherit;">可能是真的</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T2.B是空的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T1.B &lt;3或T2.B不为空</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T1.B &lt;3或T2.B&gt; 3</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									检查外部联接操作的条件是否为空拒绝的一般规则很简单：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它是形式</font>
										</font><code class="literal">A IS NOT NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，其中
											</font>
										</font><code class="literal">A</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是任何内部表的属性
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它是一个谓词，包含对内部表的引用，该内部表计算</font>
										</font><code class="literal">UNKNOWN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">其参数之一的时间</font>
										</font><code class="literal">NULL</code>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它是一个包含null-rejected条件作为合取的连接
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它是零拒绝条件的分离
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于查询中的一个外部联接操作，条件可以为null，而对于另一个条件，则不为null-rejected。</font>
								<font style="vertical-align: inherit;">在此查询中，</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">对于第二个外部联接操作</font>
								<font style="vertical-align: inherit;">，</font>
								<font style="vertical-align: inherit;">条件为空 - 拒绝，但对于第一个外部联接操作，条件不为空 - 拒绝：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN T2 ON T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 左接点T3接通T3.B = T1.B</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里T3.C&gt; 0</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">查询中的外连接操作</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">条件为空 - 拒绝，则外连接操作将由内连接操作替换。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									例如，在前面的查询中，第二个外部联接是空的拒绝，可以由内部联接替换：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN T2 ON T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 INNER JOIN T3 ON T3.B = T1.B</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里T3.C&gt; 0</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于原始查询，优化程序仅评估与单个表访问顺序兼容的计划
								</font>
							</font><code class="literal">T1,T2,T3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">对于重写的查询，它还考虑访问顺序
								</font>
							</font><code class="literal">T3,T1,T2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									一个外连接操作的转换可以触发另一个外连接操作的转换。</font>
								<font style="vertical-align: inherit;">因此，查询：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN T2 ON T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 LE3 JOIN T3 ON T3.B = T2.B</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里T3.C&gt; 0</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									首先转换为查询：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN T2 ON T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 INNER JOIN T3 ON T3.B = T2.B</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里T3.C&gt; 0</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这相当于查询：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM（T1 LEFT JOIN T2 ON T2.A = T1.A），T3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  T3.C&gt; 0且T3.B = T2.B</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									剩余的外连接操作也可以由内连接替换，因为条件</font>
							</font><code class="literal">T3.B=T2.B</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									为空拒绝。</font>
								<font style="vertical-align: inherit;">这导致查询没有外部联接：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM（T1 INNER JOIN T2 ON T2.A = T1.A），T3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  T3.C&gt; 0且T3.B = T2.B</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									有时，优化器会成功替换嵌入式外连接操作，但无法转换嵌入外连接。</font>
								<font style="vertical-align: inherit;">以下查询：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （T2 LEFT JOIN T3 ON T3.B = T2.B）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里T3.C&gt; 0</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									转换为：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （T2 INNER JOIN T3 ON T3.B = T2.B）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在T2.A = T1.A</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里T3.C&gt; 0</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这只能重写为仍然包含嵌入外连接操作的表单：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （T2，T3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              ON（T2.A = T1.A和T3.B = T2.B）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里T3.C&gt; 0</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在查询中转换嵌入式外连接操作的任何尝试都必须考虑嵌入外连接和</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件的</font>
								<font style="vertical-align: inherit;">连接
								</font>
								<font style="vertical-align: inherit;">条件。</font>
								<font style="vertical-align: inherit;">在此查询中，</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">嵌入式外连接</font>
								<font style="vertical-align: inherit;">的
								</font>
								<font style="vertical-align: inherit;">条件不会被拒绝，但嵌入外连接的连接条件</font>
							</font><code class="literal">T2.A=T1.A AND
								T3.C=T1.C</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">为空拒绝：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （T2 LEFT JOIN T3 ON T3.B = T2.B）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在T2.A = T1.A和T3.C = T1.C</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里T3.D&gt; 0或T1.D&gt; 0</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									因此，查询可以转换为：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 LEFT JOIN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              （T2，T3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              在T2.A = T1.A和T3.C = T1.C和T3.B = T2.B</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里T3.D&gt; 0或T1.D&gt; 0</font></font><font></font>
</pre>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="mrr-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.10多范围读取优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091708443424"></a><a class="indexterm" name="idm140091708441968"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当表很大并且没有存储在存储引擎的缓存中时，使用辅助索引上的范围扫描读取行可能导致对基表的许多随机磁盘访问。</font>
								<font style="vertical-align: inherit;">通过磁盘扫描多范围读取（MRR）优化，MySQL尝试通过首先扫描索引并收集相关行的密钥来减少范围扫描的随机磁盘访问次数。</font>
								<font style="vertical-align: inherit;">然后对键进行排序，最后使用主键的顺序从基表中检索行。</font>
								<font style="vertical-align: inherit;">磁盘扫描MRR的动机是减少随机磁盘访问的数量，而是实现对基表数据的更顺序扫描。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									多范围读取优化提供以下好处：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MRR使数据行能够按顺序而不是按随机顺序访问，具体取决于索引元组。</font>
											<font style="vertical-align: inherit;">服务器获取一组满足查询条件的索引元组，根据数据行ID顺序对它们进行排序，并使用排序的元组按顺序检索数据行。</font>
											<font style="vertical-align: inherit;">这使数据访问更有效，更便宜。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MRR允许批量处理需要通过索引元组访问数据行的操作的密钥访问请求，例如范围索引扫描和使用连接属性索引的等连接。</font>
											<font style="vertical-align: inherit;">MRR迭代一系列索引范围以获得合格的索引元组。</font>
											<font style="vertical-align: inherit;">随着这些结果的累积，它们用于访问相应的数据行。</font>
											<font style="vertical-align: inherit;">在开始读取数据行之前，不必获取所有索引元组。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在虚拟生成列上创建的二级索引不支持MRR优化。
								</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">支持虚拟生成列上的二级索引。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下方案说明了MRR优化何时有利：
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									场景A：MRR可</font>
								<font style="vertical-align: inherit;">用于索引范围扫描和等连接操作的表</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表。
								</font>
							</font>
						</p>
						<div class="orderedlist">
							<ol class="orderedlist" type="1">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												索引元组的一部分累积在缓冲区中。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												缓冲区中的元组按其数据行ID排序。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												根据排序的索引元组序列访问数据行。
											</font>
										</font>
									</p>
								</li>
							</ol>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									场景B：MRR可
								</font>
							</font><a class="link" href="mysql-cluster.html" title="第22章MySQL NDB Cluster 8.0"><code class="literal">NDB</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">用于多范围索引扫描的表或通过属性执行等连接时。
								</font>
							</font>
						</p>
						<div class="orderedlist">
							<ol class="orderedlist" type="1">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												范围的一部分（可能是单键范围）累积在提交查询的中心节点上的缓冲区中。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												范围被发送到访问数据行的执行节点。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												访问的行被打包到包中并发送回中央节点。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												收到的包含数据行的包放在缓冲区中。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												从缓冲区读取数据行。
											</font>
										</font>
									</p>
								</li>
							</ol>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用MRR时</font>
							</font><code class="literal">Extra</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">输出中</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">列
								</font>
								<font style="vertical-align: inherit;">显示
								</font>
							</font><code class="literal">Using MRR</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">如果不需要访问完整的表行来生成查询结果</font>
								<font style="vertical-align: inherit;">，</font>
								<font style="vertical-align: inherit;">则不要使用MRR。</font>
								<font style="vertical-align: inherit;">如果结果可以完全基于索引元组中的信息（通过</font>
							</font><a class="link" href="glossary.html#glos_covering_index" title="覆盖指数">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">覆盖索引</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）生成，则情况就是这样; </font>
								<font style="vertical-align: inherit;">MRR没有任何好处。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									两个</font>
							</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统变量标志提供了使用MRR优化的接口。</font>
								<font style="vertical-align: inherit;">该</font>
							</font><code class="literal">mrr</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">标志控制是否启用MRR。</font>
								<font style="vertical-align: inherit;">如果</font>
							</font><code class="literal">mrr</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是enabled（</font>
							</font><code class="literal">on</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">），则该</font>
							</font><code class="literal">mrr_cost_based</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									标志控制优化器是否尝试在使用和不使用MRR（</font>
							</font><code class="literal">on</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）</font>
								<font style="vertical-align: inherit;">之间进行基于成本的选择，</font>
								<font style="vertical-align: inherit;">或者尽可能使用MRR（</font>
							</font><code class="literal">off</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。</font>
								<font style="vertical-align: inherit;">默认情况下，</font>
							</font><code class="literal">mrr</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									是</font>
							</font><code class="literal">on</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">mrr_cost_based</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									是</font>
							</font><code class="literal">on</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.9.2节“可切换的优化”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于MRR，存储引擎使用</font>
							</font><a class="link" href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统变量</font>
								<font style="vertical-align: inherit;">的值
								</font>
								<font style="vertical-align: inherit;">作为其缓冲区可分配的内存量的指导。</font>
								<font style="vertical-align: inherit;">引擎最多使用
								</font>
							</font><a class="link" href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">字节数，并确定一次传递中要处理的范围数。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="bnl-bka-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.11块嵌套循环和批量密钥访问连接</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091708401184"></a><a class="indexterm" name="idm140091708399728"></a><a class="indexterm"
						 name="idm140091708398240"></a><a class="indexterm" name="idm140091708396752"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL中，可以使用批量密钥访问（BKA）连接算法，该算法使用对连接表的索引访问和连接缓冲区。</font>
								<font style="vertical-align: inherit;">BKA算法支持内连接，外连接和半连接操作，包括嵌套外连接。</font>
								<font style="vertical-align: inherit;">BKA的优点包括提高连接性能，因为更高效的表扫描。</font>
								<font style="vertical-align: inherit;">此外，先前仅用于内连接的块嵌套循环（BNL）连接算法已扩展，可用于外连接和半连接操作，包括嵌套外连接。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下部分讨论了连接缓冲区管理，它是原始BNL算法扩展，扩展BNL算法和BKA算法的基础。</font>
								<font style="vertical-align: inherit;">有关半连接策略的信息，请参见</font>
							</font><a class="xref" href="optimization.html#semi-joins" title="8.2.2.1使用半连接转换优化子查询，派生表，视图引用和公用表表达式">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表，视图引用和公用表表达式”</font>
								</font>
							</a>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p><a class="xref" href="optimization.html#join-buffer-management" title="加入块嵌套循环和批量密钥访问算法的缓冲区管理">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">加入块嵌套循环和批量密钥访问算法的缓冲区管理</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#bnl-optimization" title="用于外连接和半连接的块嵌套循环算法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">用于外连接和半连接的块嵌套循环算法</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#bka-optimization" title="批量密钥访问连接">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">批量密钥访问连接</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#bnl-bka-optimizer-hints" title="块嵌套循环和批量密钥访问算法的优化器提示">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">块嵌套循环和批量密钥访问算法的优化器提示</font>
											</font>
										</a></p>
								</li>
							</ul>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="join-buffer-management"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">加入块嵌套循环和批量密钥访问算法的缓冲区管理</font>
											</font>
										</h5>
									</div>
								</div>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										MySQL可以使用连接缓冲区不仅可以执行内部联接而无需对内部表进行索引访问，还可以执行子查询展平后出现的外部联接和半联接。</font>
									<font style="vertical-align: inherit;">此外，当存在对内部表的索引访问时，可以有效地使用连接缓冲区。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										当存储感兴趣的行列的值时，联接缓冲区管理代码稍微更有效地利用连接缓冲区空间：如果行的值为，则不在缓冲区中为行列分配额外的字节
									</font>
								</font><code class="literal">NULL</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，并且为任何值分配最小字节数该
									</font>
								</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">类型。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										该代码支持两种类型的缓冲区，常规和增量。</font>
									<font style="vertical-align: inherit;">假设使用连接缓冲区</font>
								</font><code class="literal">B1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										来连接表</font>
								</font><code class="literal">t1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><code class="literal">t2</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">并且</font>
								</font><code class="literal">t3</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">使用连接缓冲区</font>
									<font style="vertical-align: inherit;">将此操作的结果与表</font>
									<font style="vertical-align: inherit;">连接
									</font>
								</font><code class="literal">B2</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													常规连接缓冲区包含每个连接操作数的列。</font>
												<font style="vertical-align: inherit;">如果</font>
											</font><code class="literal">B2</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">是一个普通的加入缓冲液，每行</font>
											</font><em class="replaceable"><code>r</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">投入
												</font>
											</font><code class="literal">B2</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">由行的列</font>
											</font><em class="replaceable"><code>r1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">从
												</font>
											</font><code class="literal">B1</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和匹配行的有趣列</font>
											</font><em class="replaceable"><code>r2</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">从表
												</font>
											</font><code class="literal">t3</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													增量连接缓冲区仅包含第二个连接操作数生成的表行中的列。</font>
												<font style="vertical-align: inherit;">也就是说，它是第一个操作数缓冲区中一行的增量。</font>
												<font style="vertical-align: inherit;">如果</font>
											</font><code class="literal">B2</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">是增量加入缓冲液，它包含行的有趣列</font>
											</font><em class="replaceable"><code>r2</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													有链接到一起排
												</font>
											</font><em class="replaceable"><code>r1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">的
												</font>
											</font><code class="literal">B1</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										增量连接缓冲区始终相对于早期连接操作的连接缓冲区是增量的，因此第一个连接操作的缓冲区始终是常规缓冲区。</font>
									<font style="vertical-align: inherit;">在刚刚给出的实例中，缓冲</font>
								</font><code class="literal">B1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										用来连接表</font>
								</font><code class="literal">t1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">和
									</font>
								</font><code class="literal">t2</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">必须是常规缓冲区。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										用于连接操作的增量缓冲区的每一行仅包含要连接的表中一行的有趣列。</font>
									<font style="vertical-align: inherit;">这些列通过引用第一个连接操作数生成的表中匹配行的有趣列进行扩充。</font>
									<font style="vertical-align: inherit;">增量缓冲区中的多行可以引用同一行，</font>
								</font><em class="replaceable"><code>r</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">其</font>
									<font style="vertical-align: inherit;">行
									</font>
									<font style="vertical-align: inherit;">的列存储在先前的连接缓冲区中，只要所有这些行都匹配行
									</font>
								</font><em class="replaceable"><code>r</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										增量缓冲区可以减少从先前连接操作使用的缓冲区中复制列的频率。</font>
									<font style="vertical-align: inherit;">这提供了缓冲空间的节省，因为在一般情况下，由第一连接操作数产生的行可以由第二连接操作数产生的若干行匹配。</font>
									<font style="vertical-align: inherit;">不必从第一个操作数生成一行的多个副本。</font>
									<font style="vertical-align: inherit;">由于复制时间的减少，增量缓冲区还可以节省处理时间。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">系统变量</font>
									<font style="vertical-align: inherit;">
										的</font>
								</font><code class="literal">block_nested_loop</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">和
									</font>
								</font><code class="literal">batched_key_access</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">标志
									</font>
								</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">控制优化器如何使用块嵌套循环和批量密钥访问连接算法。</font>
									<font style="vertical-align: inherit;">默认情况下，</font>
								</font><code class="literal">block_nested_loop</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是
									</font>
								</font><code class="literal">on</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">和
									</font>
								</font><code class="literal">batched_key_access</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是
									</font>
								</font><code class="literal">off</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">请参见
									</font>
								</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.9.2节“可切换的优化”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">也可以应用优化程序提示; </font>
									<font style="vertical-align: inherit;">请参阅
									</font>
								</font><a class="xref" href="optimization.html#bnl-bka-optimizer-hints" title="块嵌套循环和批量密钥访问算法的优化器提示">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">块嵌套循环和批量密钥访问算法的优化程序提示</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										有关半连接策略的信息，请参见
									</font>
								</font><a class="xref" href="optimization.html#semi-joins" title="8.2.2.1使用半连接转换优化子查询，派生表，视图引用和公用表表达式">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表，视图引用和公用表表达式”</font>
									</font>
								</a>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="bnl-optimization"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">用于外连接和半连接的块嵌套循环算法</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<a class="indexterm" name="idm140091708355584"></a><a class="indexterm" name="idm140091708354128"></a>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										MySQL BNL算法的原始实现被扩展为支持外连接和半连接操作。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										当使用连接缓冲区执行这些操作时，为缓冲区中的每一行提供匹配标志。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果使用连接缓冲区执行外连接操作，则检查第二个操作数生成的表的每一行是否与连接缓冲区中的每一行匹配。</font>
									<font style="vertical-align: inherit;">找到匹配项后，将形成一个新的扩展行（原始行加上第二个操作数中的列），并通过其余的连接操作发送以进一步扩展。</font>
									<font style="vertical-align: inherit;">此外，启用缓冲区中匹配行的匹配标志。</font>
									<font style="vertical-align: inherit;">在检查了要连接的表的所有行之后，将扫描连接缓冲区。</font>
									<font style="vertical-align: inherit;">缓冲区中未启用其匹配标志的每一行都由</font>
								</font><code class="literal">NULL</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">补充</font>
									<font style="vertical-align: inherit;">扩展</font>
									<font style="vertical-align: inherit;">（</font>
								</font><code class="literal">NULL</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> 第二个操作数中每列的值），并由剩余的连接操作发送以进一步扩展。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">系统变量</font>
									<font style="vertical-align: inherit;">
										的</font>
								</font><code class="literal">block_nested_loop</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">标志
									</font>
								</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">控制优化器如何使用块嵌套循环算法。</font>
									<font style="vertical-align: inherit;">默认情况下
									</font>
								</font><code class="literal">block_nested_loop</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是
									</font>
								</font><code class="literal">on</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">请参见
									</font>
								</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.9.2节“可切换的优化”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">也可以应用优化程序提示; </font>
									<font style="vertical-align: inherit;">请参阅
									</font>
								</font><a class="xref" href="optimization.html#bnl-bka-optimizer-hints" title="块嵌套循环和批量密钥访问算法的优化器提示">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">块嵌套循环和批量密钥访问算法的优化程序提示</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在</font>
								</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">输出端，为表使用BNL的当被所指</font>
								</font><code class="literal">Extra</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										值包含</font>
								</font><code class="literal">Using join buffer (Block Nested
									Loop)</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">与所述</font>
								</font><code class="literal">type</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">值是
									</font>
								</font><a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，或
									</font>
								</font><a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										有关半连接策略的信息，请参见
									</font>
								</font><a class="xref" href="optimization.html#semi-joins" title="8.2.2.1使用半连接转换优化子查询，派生表，视图引用和公用表表达式">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表，视图引用和公用表表达式”</font>
									</font>
								</a>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="bka-optimization"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">批量密钥访问连接</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<a class="indexterm" name="idm140091708333552"></a><a class="indexterm" name="idm140091708332096"></a>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										MySQL实现了一种连接表的方法，称为批量密钥访问（BKA）连接算法。</font>
									<font style="vertical-align: inherit;">当存在对第二个连接操作数生成的表的索引访问时，可以应用BKA。</font>
									<font style="vertical-align: inherit;">与BNL连接算法一样，BKA连接算法使用连接缓冲区来累积由连接操作的第一个操作数生成的行的有趣列。</font>
									<font style="vertical-align: inherit;">然后，BKA算法构建密钥以访问要为缓冲区中的所有行加入的表，并将这些密钥批量提交到数据库引擎以进行索引查找。</font>
									<font style="vertical-align: inherit;">键通过多量程读取（MRR）接口提交给引擎（参见
									</font>
								</font><a class="xref" href="optimization.html#mrr-optimization" title="8.2.1.10多范围读取优化">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.2.1.10节“多量程读取优化”）</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">）。</font>
									<font style="vertical-align: inherit;">在提交密钥之后，MRR引擎功能以最佳方式在索引中执行查找，获取由这些密钥找到的连接表的行，并开始向匹配行提供BKA连接算法。</font>
									<font style="vertical-align: inherit;">每个匹配行与对连接缓冲区中的行的引用相耦合。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										使用BKA时，值
									</font>
								</font><a class="link" href="server-administration.html#sysvar_join_buffer_size"><code class="literal">join_buffer_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">定义了每个请求到存储引擎的批量密钥的大小。</font>
									<font style="vertical-align: inherit;">缓冲区越大，对连接操作的右侧表的顺序访问就越多，这可以显着提高性能。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要使用BKA，</font>
									<font style="vertical-align: inherit;">必须将系统变量</font>
									<font style="vertical-align: inherit;">的
									</font>
								</font><code class="literal">batched_key_access</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">标志
									</font>
								</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">设置为</font>
								</font><code class="literal">on</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">BKA使用MRR，因此</font>
								</font><code class="literal">mrr</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">标志也必须是
									</font>
								</font><code class="literal">on</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">目前，MRR的成本估算过于悲观。</font>
									<font style="vertical-align: inherit;">因此，也有必要对
									</font>
								</font><code class="literal">mrr_cost_based</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">要
									</font>
								</font><code class="literal">off</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">用于要使用的BKA。</font>
									<font style="vertical-align: inherit;">以下设置启用BKA：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET optimizer_switch='mrr=on,mrr_cost_based=off,batched_key_access=on';</code></strong>
</pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										MRR功能有两种执行方式：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													第一种方案用于传统的基于磁盘的存储引擎，例如
												</font>
											</font><a class="link" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎"><code class="literal">InnoDB</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和
												</font>
											</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">对于这些引擎，通常将来自连接缓冲区的所有行的键一次提交给MRR接口。</font>
												<font style="vertical-align: inherit;">特定于引擎的MRR函数对提交的密钥执行索引查找，从中获取行ID（或主键），然后根据BKA算法的请求逐个获取所有这些选定行ID的行。</font>
												<font style="vertical-align: inherit;">返回的每一行都带有一个关联引用，该引用允许访问连接缓冲区中的匹配行。</font>
												<font style="vertical-align: inherit;">MRR函数以最佳方式获取行：它们以行ID（主键）顺序获取。</font>
												<font style="vertical-align: inherit;">这提高了性能，因为读取是按磁盘顺序而不是随机顺序。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													第二种方案用于远程存储引擎，例如</font>
											</font><a class="link" href="mysql-cluster.html" title="第22章MySQL NDB Cluster 8.0"><code class="literal">NDB</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">来自连接缓冲区的一部分行的密钥包及其关联由MySQL服务器（SQL节点）发送到MySQL Cluster数据节点。</font>
												<font style="vertical-align: inherit;">作为回报，SQL节点接收匹配行的包（或多个包）以及相应的关联。</font>
												<font style="vertical-align: inherit;">BKA连接算法获取这些行并构建新的连接行。</font>
												<font style="vertical-align: inherit;">然后，一组新的密钥被发送到数据节点，并且返回的包中的行用于构建新的连接行。</font>
												<font style="vertical-align: inherit;">该过程将继续，直到将来自联接缓冲区的最后一个密钥发送到数据节点，并且SQL节点已接收并加入与这些密钥匹配的所有行。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										对于第一种情况，保留一部分连接缓冲区以存储由索引查找选择的行ID（主键），并作为参数传递给MRR功能。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										没有特殊的缓冲区来存储为连接缓冲区中的行构建的密钥。</font>
									<font style="vertical-align: inherit;">相反，为缓冲区中的下一行构建键的函数作为参数传递给MRR函数。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在</font>
								</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">输出中，当</font>
								</font><code class="literal">Extra</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										值包含</font>
								</font><code class="literal">Using join buffer (Batched Key
									Access)</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">且</font>
								</font><code class="literal">type</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">值为
									</font>
								</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">或
									</font>
									<font style="vertical-align: inherit;">时，表示将BKA用于表</font>
								</font><a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="bnl-bka-optimizer-hints"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">块嵌套循环和批量密钥访问算法的优化器提示</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										除了使用
									</font>
								</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">系统变量来控制优化程序在会话范围内使用BNL和BKA算法之外，MySQL还支持优化程序提示，以便在每个语句的基础上影​​响优化程序。</font>
									<font style="vertical-align: inherit;">请参见
									</font>
								</font><a class="xref" href="optimization.html#optimizer-hints" title="8.9.3优化器提示">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.9.3节“优化程序提示”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要使用BNL或BKA提示为外部联接的任何内部表启用联接缓冲，必须为外部联接的所有内部表启用联接缓冲。
									</font>
								</font>
							</p>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="condition-filtering"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.12条件过滤</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在连接处理中，前缀行是从连接中的一个表传递到下一个表的那些行。</font>
								<font style="vertical-align: inherit;">通常，优化器尝试在连接顺序的早期放置具有低前缀计数的表，以保持行组合的数量不会快速增加。</font>
								<font style="vertical-align: inherit;">在某种程度上，优化程序可以使用有关从一个表中选择并传递给下一个表的行的条件的信息，它可以更准确地计算行估计并选择最佳执行计划。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果没有条件筛选，则表的前缀行计数基于</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句根据优化程序选择的访问方法选择</font>
								<font style="vertical-align: inherit;">的估计行数
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">条件筛选使优化器能够使用</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">访问方法未考虑</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">子句</font>
								<font style="vertical-align: inherit;">中的其他相关条件
								</font>
								<font style="vertical-align: inherit;">，从而改进其前缀行计数估计。</font>
								<font style="vertical-align: inherit;">例如，即使可能存在可用于从连接中的当前表中选择行的基于索引的访问方法，但在该表中可能还存在其他条件。</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									可以过滤（进一步限制）传递给下一个表的合格行的估计的子句。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									只有在以下情况下，条件才会影响过滤估算：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它指的是当前表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它取决于连接序列中早期表的常量值或值。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												访问方法尚未考虑它。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">输出中，
								</font>
							</font><code class="literal">rows</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列指示所选访问方法的行估计，该</font>
							</font><code class="literal">filtered</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									列反映条件筛选的效果。
								</font>
							</font><code class="literal">filtered</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值以百分比表示。</font>
								<font style="vertical-align: inherit;">最大值为100，这意味着不会对行进行过滤。</font>
								<font style="vertical-align: inherit;">值从100开始减少表示过滤量增加。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									前缀行计数（估计从连接中的当前表传递到下一个的行数）是</font>
							</font><code class="literal">rows</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">filtered</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值</font>
								<font style="vertical-align: inherit;">的乘积</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">也就是说，前缀行计数是估计的行计数，通过估计的过滤效果减少。</font>
								<font style="vertical-align: inherit;">例如，如果</font>
							</font><code class="literal">rows</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是1000并且</font>
							</font><code class="literal">filtered</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是20％，则条件过滤将估计的行计数1000减少到前缀行计数1000×20％= 1000×.2 = 200。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									请考虑以下查询：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  来自员工JOIN部门ON employee.dept_no = department.dept_no</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE employee.first_name ='John'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND employee.hire_date BETWEEN'2018-01-01'EN'2018-06-01';</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									假设数据集具有以下特征：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">employee</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表有1024行。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">department</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表有12行。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												两个表都有一个索引</font>
										</font><code class="literal">dept_no</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">employee</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表有一个索引
											</font>
										</font><code class="literal">first_name</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												8行符合以下条件
											</font>
										</font><code class="literal">employee.first_name</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">employee.first_name ='约翰'
</font></font></pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												150行符合以下条件
											</font>
										</font><code class="literal">employee.hire_date</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">employee.hire_date BETWEEN'2018-01-01'和'2018-06-01'
</font></font></pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												1行满足两个条件：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">employee.first_name ='约翰'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND employee.hire_date BETWEEN'2018-01-01'和'2018-06-01'</font></font><font></font>
</pre>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									没有条件过滤，
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">产生如下输出：
								</font>
							</font>
						</p>
						<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ---- + ------------ + -------- + ------------------ + --- ------ + --------- + ------ + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">表| </font><font style="vertical-align: inherit;">类型| </font><font style="vertical-align: inherit;">possible_keys | </font><font style="vertical-align: inherit;">关键| </font><font style="vertical-align: inherit;">ref | </font><font style="vertical-align: inherit;">行| </font><font style="vertical-align: inherit;">过滤|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------------ + -------- + ------------------ + --- ------ + --------- + ------ + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">员工| </font><font style="vertical-align: inherit;">ref | </font><font style="vertical-align: inherit;">name，h_date，dept | </font><font style="vertical-align: inherit;">名字| </font><font style="vertical-align: inherit;">const | </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">100.00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">部门| </font><font style="vertical-align: inherit;">eq_ref | </font><font style="vertical-align: inherit;">主要| </font><font style="vertical-align: inherit;">主要| </font><font style="vertical-align: inherit;">dept_no | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">100.00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------------ + -------- + ------------------ + --- ------ + --------- + ------ + ---------- +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									因为</font>
							</font><code class="literal">employee</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">name</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">索引</font>
								<font style="vertical-align: inherit;">上的访问方法会
								</font>
								<font style="vertical-align: inherit;">获取与名称匹配的8行</font>
							</font><code class="literal">'John'</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">没有进行过滤（</font>
							</font><code class="literal">filtered</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是100％），因此所有行都是下一个表的前缀行：前缀行计数是
								</font>
							</font><code class="literal">rows</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">× </font>
							</font><code class="literal">filtered</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">= 8×100％= 8。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									通过条件过滤，优化器还考虑</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									了访问方法未考虑</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">子句中的</font>
								<font style="vertical-align: inherit;">条件</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">在这种情况下，优化器使用试探法来估计所述的16.31％的滤波效果</font>
							</font><a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									的条件下</font>
							</font><code class="literal">employee.hire_date</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">结果，</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">产生如下输出：
								</font>
							</font>
						</p>
						<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ---- + ------------ + -------- + ------------------ + --- ------ + --------- + ------ + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">表| </font><font style="vertical-align: inherit;">类型| </font><font style="vertical-align: inherit;">possible_keys | </font><font style="vertical-align: inherit;">关键| </font><font style="vertical-align: inherit;">ref | </font><font style="vertical-align: inherit;">行| </font><font style="vertical-align: inherit;">过滤|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------------ + -------- + ------------------ + --- ------ + --------- + ------ + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">员工| </font><font style="vertical-align: inherit;">ref | </font><font style="vertical-align: inherit;">name，h_date，dept | </font><font style="vertical-align: inherit;">名字| </font><font style="vertical-align: inherit;">const | </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">16.31 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">部门| </font><font style="vertical-align: inherit;">eq_ref | </font><font style="vertical-align: inherit;">主要| </font><font style="vertical-align: inherit;">主要| </font><font style="vertical-align: inherit;">dept_no | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">100.00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ------------ + -------- + ------------------ + --- ------ + --------- + ------ + ---------- +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									现在前缀行计数为</font>
							</font><code class="literal">rows</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">×
								</font>
							</font><code class="literal">filtered</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">= 8×16.31％= 1.3，这更接近地反映了实际数据集。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									通常，优化器不会为最后一个连接表计算条件过滤效果（前缀行数减少），因为没有下一个表要传递行。</font>
								<font style="vertical-align: inherit;">发生异常
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：要提供更多信息，将为所有已连接的表（包括最后一个表）计算过滤效果。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要控制优化程序是否考虑其他过滤条件，请使用</font>
								<font style="vertical-align: inherit;">系统变量</font>
								<font style="vertical-align: inherit;">的
								</font>
							</font><code class="literal">condition_fanout_filter</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">标志
								</font>
							</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">（请参见</font>
							</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.9.2节“可切换的优化”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。</font>
								<font style="vertical-align: inherit;">默认情况下启用此标志，但可以禁用此标志以禁止条件筛选（例如，如果发现特定查询在没有它的情况下产生更好的性能）。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果优化器过高估计条件过滤的影响，则性能可能比不使用条件过滤时更差。</font>
								<font style="vertical-align: inherit;">在这种情况下，这些技术可能有所帮助：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果未对列建立索引，请对其进行索引，以便优化程序具有有关列值分布的一些信息，并可以改进其行估计值。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												同样，如果没有可用的列直方图信息，则生成直方图（请参见
											</font>
										</font><a class="xref" href="optimization.html#optimizer-statistics" title="8.9.6优化器统计">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.9.6节“优化程序统计信息”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												更改连接顺序。</font>
											<font style="vertical-align: inherit;">完成此操作的方法包括连接顺序优化器提示（请参见
											</font>
										</font><a class="xref" href="optimization.html#optimizer-hints" title="8.9.3优化器提示">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.9.3节“优化程序提示”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">），
											</font>
										</font><code class="literal">STRAIGHT_JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">紧跟在
											</font>
										</font><code class="literal">SELECT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><code class="literal">STRAIGHT_JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">连接运算符之后。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												禁用会话的条件筛选：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='condition_fanout_filter = off';
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												或者，对于给定查询，使用优化程序提示：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + SET_VAR（optimizer_switch ='condition_fanout_filter = off'）* / ...
</font></font></pre>
								</li>
							</ul>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="constant-folding-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.13恒定折叠优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									常量值和列值之间的比较，其中常量值超出范围或相对于列类型的错误类型现在在查询优化期间而不是逐行处理而不是在执行期间处理一次。</font>
								<font style="vertical-align: inherit;">可以以这种方式处理的比较是
								</font>
							</font><code class="literal">&gt;</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">&gt;=</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">&lt;</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">&lt;=</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">&lt;&gt;</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">/ </font>
							</font><code class="literal">!=</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">=</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">&lt;=&gt;</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									考虑以下语句创建的表：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t（c TINYINT UNSIGNED NOT NULL）;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									所述</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">查询条件
								</font>
							</font><code class="literal">SELECT * FROM t WHERE c &lt; 256</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">包含积分常数256，其超出范围为
								</font>
							</font><code class="literal">TINYINT UNSIGNED</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">柱。</font>
								<font style="vertical-align: inherit;">以前，这是通过将两个操作数视为较大的类型来处理的，但现在，由于任何允许的值</font>
							</font><code class="literal">c</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">小于常量，</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表达式可以折叠为</font>
							</font><code class="literal">WHERE 1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，以便将查询重写为</font>
							</font><code class="literal">SELECT * FROM t WHERE
								1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这使得优化器可以</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">完全</font>
								<font style="vertical-align: inherit;">删除
								</font>
								<font style="vertical-align: inherit;">表达式。</font>
								<font style="vertical-align: inherit;">如果列可以
								</font>
							</font><code class="literal">c</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">为空（即，仅定义为
								</font>
							</font><code class="literal">TINYINT UNSIGNED</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">），则将重写查询，如下所示：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t WHERE ti not NULL
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									与支持的MySQL列类型相比，对常量执行折叠，如下所示：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p><b>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">整数列类型。&nbsp;</font>
											</font>
										</b>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												将整数类型与以下类型的常量进行比较，如下所述：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p><b>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">整数值。&nbsp;</font>
														</font>
													</b>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															如果常量超出列类型的范围，则比较将折叠为</font>
													</font><code class="literal">1</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">或
														</font>
													</font><code class="literal">IS NOT NULL</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，如已显示。
														</font>
													</font>
												</p>
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															如果常量是范围边界，则比较折叠为</font>
													</font><code class="literal">=</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。</font>
														<font style="vertical-align: inherit;">例如（使用与已定义相同的表）：
														</font>
													</font>
												</p>
												<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM t WHERE c &gt;= 255;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：全部</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          key：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：20.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用在哪里</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1排，1警告（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW WARNINGS;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  等级：注意</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   代码：1003</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消息：/ *从`test``t`中选择＃1 * / select`test``t``ti` AS`ti`，其中（`test``t``ti` = 255）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1排（0.00秒）</font></font><font></font>
</pre>
											</li>
											<li class="listitem">
												<p><b>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">浮点或定点值。&nbsp;</font>
														</font>
													</b>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															如果常数是十进制类型之一（例如
														</font>
													</font><code class="literal">DECIMAL</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，</font>
													</font><code class="literal">REAL</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，
														</font>
													</font><code class="literal">DOUBLE</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，或
														</font>
													</font><code class="literal">FLOAT</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">），并有一个非零小数部分，它可以是不相等的; </font>
														<font style="vertical-align: inherit;">相应地折叠。</font>
														<font style="vertical-align: inherit;">对于其他比较，根据符号向上或向下舍入为整数值，然后执行范围检查和处理，如已经描述的整数 - 整数比较。
														</font>
													</font>
												</p>
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															如果</font>
													</font><code class="literal">REAL</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">值太小而无法表示，</font>
													</font><code class="literal">DECIMAL</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">则根据符号舍入为.01或-.01，然后作为a处理</font>
													</font><code class="literal">DECIMAL</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p><b>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">字符串类型。&nbsp;</font>
														</font>
													</b>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															尝试将字符串值解释为整数类型，然后在整数值之间处理比较。</font>
														<font style="vertical-align: inherit;">如果失败，请尝试将值作为a处理</font>
													</font><code class="literal">REAL</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
								</li>
								<li class="listitem">
									<p><b>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">DECIMAL或REAL列。&nbsp;</font>
											</font>
										</b>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												将十进制类型与以下类型的常量进行比较，如下所述：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p><b>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">整数值。&nbsp;</font>
														</font>
													</b>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															对列值的整数部分执行范围检查。</font>
														<font style="vertical-align: inherit;">如果没有折叠结果，将常量转换</font>
													</font><code class="literal">DECIMAL</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															为与列值相同的小数位数，然后将其检查为a </font>
													</font><code class="literal">DECIMAL</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															（参见下一个）。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p><b>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">DECIMAL或REAL值。&nbsp;</font>
														</font>
													</b>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															检查溢出（即，常量的整数部分中的数字是否多于列的十进制类型所允许的数字）。</font>
														<font style="vertical-align: inherit;">如果是这样，折叠。
														</font>
													</font>
												</p>
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															如果常量具有比列的类型更重要的小数位数，则截断常量。</font>
														<font style="vertical-align: inherit;">如果比较运算符是</font>
													</font><code class="literal">=</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">或
														</font>
													</font><code class="literal">&lt;&gt;</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">折叠。</font>
														<font style="vertical-align: inherit;">如果操作员是
														</font>
													</font><code class="literal">&gt;=</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">或</font>
													</font><code class="literal">&lt;=</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，则由于截断而调整操作员。</font>
														<font style="vertical-align: inherit;">例如，如果列的类型是</font>
													</font><code class="literal">DECIMAL(3,1)</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，则
														</font>
													</font><code class="literal">SELECT * FROM t WHERE f &gt;= 10.13</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															变为</font>
													</font><code class="literal">SELECT * FROM t WHERE f &gt;
														10.1</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															如果常量的十进制数字少于列的类型，则将其转换为具有相同位数的常量。</font>
														<font style="vertical-align: inherit;">对于</font>
													</font><code class="literal">REAL</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">值的</font>
														<font style="vertical-align: inherit;">下溢
														</font>
														<font style="vertical-align: inherit;">（即，表示它的分数位数太少），将常量转换为十进制0。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p><b>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">字符串值。&nbsp;</font>
														</font>
													</b>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															如果该值可以解释为整数类型，则按此处理。</font>
														<font style="vertical-align: inherit;">否则，尝试将其处理为
														</font>
													</font><code class="literal">REAL</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
								</li>
								<li class="listitem">
									<p><b>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">FLOAT或DOUBLE列。&nbsp;</font>
											</font>
										</b>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												或
											</font>
											<font style="vertical-align: inherit;">
												与常量相比较的值处理如下：
											</font>
										</font><code class="literal">FLOAT(<em class="replaceable"><code>m</code></em>,<em class="replaceable"><code>n</code></em>)</code>
										<font style="vertical-align: inherit;"></font><code class="literal">DOUBLE(<em class="replaceable"><code>m</code></em>,<em
											 class="replaceable"><code>n</code></em>)</code>
										<font style="vertical-align: inherit;"></font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果值溢出列的范围，则折叠。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果该值大于</font>
										</font><em class="replaceable"><code>n</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												小数，则截断，在折叠期间进行补偿。</font>
											<font style="vertical-align: inherit;">对于
											</font>
										</font><code class="literal">=</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和</font>
										</font><code class="literal">&lt;&gt;</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												比较，倍至</font>
										</font><code class="literal">TRUE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">FALSE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或</font>
										</font><code class="literal">IS [NOT]
											NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">如前文所述; </font>
											<font style="vertical-align: inherit;">对于其他运营商，调整运营商。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果该值超过</font>
										</font><code class="literal">m</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">整数位数，则折叠。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p><b>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">限制。&nbsp;</font>
								</font>
							</b>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在以下情况下不能使用此优化：
								</font>
							</font>
						</p>
						<div class="orderedlist">
							<ol class="orderedlist" type="1">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												使用</font>
										</font><code class="literal">BETWEEN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
											<font style="vertical-align: inherit;">进行比较</font>
										</font><code class="literal">IN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												随着</font>
										</font><code class="literal">BIT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">使用日期或时间类型的列或列。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在准备语句的准备阶段，尽管可以在优化阶段应用实际执行准备好的语句。</font>
											<font style="vertical-align: inherit;">这是因为在语句准备期间，常数的值尚不清楚。
											</font>
										</font>
									</p>
								</li>
							</ol>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="is-null-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.14 IS NULL优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091708156848"></a><a class="indexterm" name="idm140091708155776"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL能够执行相同的优化
								</font>
								<font style="vertical-align: inherit;">，它可以使用
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">例如，MySQL能使用索引和范围来搜索
								</font>
								<font style="vertical-align: inherit;">与</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font><em class="replaceable"><code>col_name</code></em> <a class="link" href="functions.html#operator_is-null"><code
								 class="literal">IS
									NULL</code></a>
							<font style="vertical-align: inherit;"></font><em class="replaceable"><code>col_name</code></em> <code class="literal">=</code>
							<em class="replaceable"><code>constant_value</code></em>
							<font style="vertical-align: inherit;"></font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_is-null"><code class="literal">IS
									NULL</code></a>
							<font style="vertical-align: inherit;"></font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									例子：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE为</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;=&gt; NULL;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>const2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR为</font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句包含</font>
								<font style="vertical-align: inherit;">声明为的列</font>
								<font style="vertical-align: inherit;">的
								</font>
								<font style="vertical-align: inherit;">条件，则
								</font>
								<font style="vertical-align: inherit;">表达式将被优化掉。</font>
								<font style="vertical-align: inherit;">当列可能</font>
								<font style="vertical-align: inherit;">无论如何</font>
								<font style="vertical-align: inherit;">产生时</font>
								<font style="vertical-align: inherit;">（例如，如果它来自a右侧的表），则
								</font>
								<font style="vertical-align: inherit;">不会发生此优化</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font><em class="replaceable"><code>col_name</code></em> <a class="link" href="functions.html#operator_is-null"><code
								 class="literal">IS
									NULL</code></a>
							<font style="vertical-align: inherit;"></font><code class="literal">NOT NULL</code>
							<font style="vertical-align: inherit;"></font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;"></font><code class="literal">LEFT JOIN</code>
							<font style="vertical-align: inherit;"></font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL还可以优化组合
								</font>
								<font style="vertical-align: inherit;">，这是一种在已解析子查询中很常见的形式。
								</font>
								<font style="vertical-align: inherit;">显示
								</font>
								<font style="vertical-align: inherit;">何时使用此优化。
								</font>
							</font><code class="literal"><em class="replaceable"><code>col_name</code></em> =
								<em class="replaceable"><code>expr</code></em> OR
								<em class="replaceable"><code>col_name</code></em> IS NULL</code>
							<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code
								 class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#jointype_ref_or_null"><code
								 class="literal">ref_or_null</code></a>
							<font style="vertical-align: inherit;"></font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									此优化可以处理</font>
							</font><a class="link" href="functions.html#operator_is-null"><code class="literal">IS
									NULL</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">任何关键部分。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									假设列</font>
							</font><code class="literal">a</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">b</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表</font>
								<font style="vertical-align: inherit;">上有索引，优化的查询的一些示例</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE t1.a = </font></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR t1.a IS NULL;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2 WHERE t1.a = t2.a OR t2.a IS NULL;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（t1.a = t2.a OR t2.a IS NULL）AND t2.b = t1.b;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t1.a = t2.a AND（t2.b = t1.b或t2.b IS NULL）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（t1.a = t2.a AND t2.a IS NULL AND ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  或（t1.a = t2.a AND t2.a IS NULL AND ...）;</font></font><font></font>
</pre>
						<p>
							<a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">首先对引用键执行读操作，然后单独搜索具有</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">键值的</font>
								<font style="vertical-align: inherit;">行</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化只能处理一个</font>
							</font><a class="link" href="functions.html#operator_is-null"><code class="literal">IS
									NULL</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">级别。</font>
								<font style="vertical-align: inherit;">在以下查询中，MySQL仅对表达式使用键查找，</font>
							</font><code class="literal">(t1.a=t2.a AND t2.a IS
								NULL)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">并且无法使用关键部分
								</font>
							</font><code class="literal">b</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE（t1.a = t2.a AND t2.a IS NULL）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  或（t1.b = t2.b AND t2.b IS NULL）;</font></font><font></font>
</pre>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="order-by-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.15按优化顺序</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091708119312"></a><a class="indexterm" name="idm140091708118240"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									本节描述MySQL何时可以使用索引来满足</font>
							</font><code class="literal">ORDER BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句，</font>
								<font style="vertical-align: inherit;">无法使用索引时使用</font>
								<font style="vertical-align: inherit;">的
								</font>
							</font><code class="literal">filesort</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">操作，以及优化器提供的执行计划信息</font>
							</font><code class="literal">ORDER BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									一个</font>
							</font><code class="literal">ORDER BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">有和没有
								</font>
							</font><code class="literal">LIMIT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可能以不同的顺序返回行，在讨论</font>
							</font><a class="xref" href="optimization.html#limit-optimization" title="8.2.1.18 LIMIT查询优化">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.2.1.18，“LIMIT查询优化”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p><a class="xref" href="optimization.html#order-by-index-use" title="使用索引来满足ORDER BY">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">使用索引来满足ORDER BY</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#order-by-filesort" title="使用filesort来满足ORDER BY">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">使用filesort来满足ORDER BY</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#order-by-optimizer-control" title="影响ORDER BY优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">影响ORDER BY优化</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#order-by-diagnostic-information" title="按订单执行计划信息">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">按订单执行计划信息</font>
											</font>
										</a></p>
								</li>
							</ul>
						</div>

						<div class="simplesect">

							<div class="titlepage">
								<div>

									<div class="simple">
										<h5 class="title"><a name="order-by-index-use"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">使用索引来满足ORDER BY</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在某些情况下，MySQL可能会使用索引来满足一个
									</font>
								</font><code class="literal">ORDER BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句，并避免执行</font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										操作时</font>
									<font style="vertical-align: inherit;">涉及的额外排序</font>
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;"></font><code class="literal">ORDER
									BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">只要索引的所有未使用部分和所有额外</font>
								</font><code class="literal">ORDER BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">列都是</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句</font>
									<font style="vertical-align: inherit;">中的常量，
									</font>
									<font style="vertical-align: inherit;">
										即使</font>
									<font style="vertical-align: inherit;">索引与索引不完全匹配，</font>
									<font style="vertical-align: inherit;">也可以使用</font>
									<font style="vertical-align: inherit;">索引
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">如果索引不包含查询访问的所有列，则仅在索引访问比其他访问方法更便宜时才使用索引。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										假设存在索引
									</font>
									<font style="vertical-align: inherit;">，则以下查询可以使用索引来解析该
									</font>
									<font style="vertical-align: inherit;">部分。</font>
									<font style="vertical-align: inherit;">优化程序是否实际执行此操作取决于读取索引是否比表扫描更有效，如果还必须读取索引中不存在的列。
									</font>
								</font><code class="literal">(<em class="replaceable"><code>key_part1</code></em>,
									<em class="replaceable"><code>key_part2</code></em>)</code>
								<font style="vertical-align: inherit;"></font><code class="literal">ORDER BY</code>
								<font style="vertical-align: inherit;"></font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在此查询中，索引on
												</font>
												<font style="vertical-align: inherit;">使优化器能够避免排序：
												</font>
											</font><code class="literal">(<em class="replaceable"><code>key_part1</code></em>,
												<em class="replaceable"><code>key_part2</code></em>)</code>
											<font style="vertical-align: inherit;"></font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													但是，查询使用</font>
											</font><code class="literal">SELECT *</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，可以选择比</font>
											</font><em class="replaceable"><code>key_part1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和
												</font>
												<font style="vertical-align: inherit;">更多的列
												</font>
											</font><em class="replaceable"><code>key_part2</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">在这种情况下，扫描整个索引并查找表行以查找不在索引中的列可能比扫描表并对结果进行排序更昂贵。</font>
												<font style="vertical-align: inherit;">如果是这样，优化器可能不会使用索引。</font>
												<font style="vertical-align: inherit;">如果
												</font>
											</font><code class="literal">SELECT *</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">仅选择索引列，则将使用索引并避免排序。
												</font>
											</font>
										</p>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果</font>
											</font><code class="literal">t1</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">是</font>
											</font><code class="literal">InnoDB</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													表，则表主键隐式地是索引的一部分，并且索引可用于解析
												</font>
											</font><code class="literal">ORDER BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">此查询：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT </font></font><em class="replaceable"><code>pk</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从T1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在此查询中，</font>
											</font><em class="replaceable"><code>key_part1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">是常量，因此通过索引访问的所有行都是
												</font>
											</font><em class="replaceable"><code>key_part2</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">有序的，并且</font>
												<font style="vertical-align: inherit;">如果</font>
												<font style="vertical-align: inherit;">子句具有足够的选择性以使索引范围扫描比表扫描更便宜，</font>
												<font style="vertical-align: inherit;">则</font>
												<font style="vertical-align: inherit;">索引将</font>
												<font style="vertical-align: inherit;">避免排序</font>
												<font style="vertical-align: inherit;">：
												</font>
											</font><code class="literal">(<em class="replaceable"><code>key_part1</code></em>,
												<em class="replaceable"><code>key_part2</code></em>)</code>
											<font style="vertical-align: inherit;"></font><code class="literal">WHERE</code>
											<font style="vertical-align: inherit;"></font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在接下来的两个查询中，是否使用索引类似于</font>
											</font><code class="literal">DESC</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">之前</font>
												<font style="vertical-align: inherit;">未</font>
												<font style="vertical-align: inherit;">显示</font>
												<font style="vertical-align: inherit;">的相同查询
												</font>
												<font style="vertical-align: inherit;">：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font><font style="vertical-align: inherit;">DESC </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  订购</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													a中的两列</font>
											</font><code class="literal">ORDER BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">可以在相同方向（两个</font>
											</font><code class="literal">ASC</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">或两个</font>
											</font><code class="literal">DESC</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">）或相反方向（一个</font>
											</font><code class="literal">ASC</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，一个
												</font>
											</font><code class="literal">DESC</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">）</font>
												<font style="vertical-align: inherit;">排序</font>
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">索引使用的条件是索引必须具有相同的同质性，但不必具有相同的实际方向。
												</font>
											</font>
										</p>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果查询混合</font>
											</font><code class="literal">ASC</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和
												</font>
											</font><code class="literal">DESC</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，优化器可以使用的列的索引;如果该指数还采用了相应的混合升序和降序列：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORC BY </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DESC，</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASC;
</font></font></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													优化器可以在（</font>
											</font><em class="replaceable"><code>key_part1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font><em class="replaceable"><code>key_part2</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">）</font>
												<font style="vertical-align: inherit;">上使用索引</font>
												<font style="vertical-align: inherit;">，
												</font>
												<font style="vertical-align: inherit;">如果
												</font>
											</font><em class="replaceable"><code>key_part1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">是降序并且
												</font>
											</font><em class="replaceable"><code>key_part2</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">正在升序。</font>
												<font style="vertical-align: inherit;">它还可以在这些列上使用索引（使用向后扫描），如果它</font>
											</font><em class="replaceable"><code>key_part1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">是递增的并且</font>
											</font><em class="replaceable"><code>key_part2</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">正在降序。</font>
												<font style="vertical-align: inherit;">请参见</font>
											</font><a class="xref" href="optimization.html#descending-indexes" title="8.3.13降序索引">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">第8.3.13节“降序索引”</font>
												</font>
											</a>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在接下来的两个查询中，
												</font>
											</font><em class="replaceable"><code>key_part1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">将其与常量进行比较。</font>
												<font style="vertical-align: inherit;">如果该</font>
											</font><code class="literal">WHERE</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">子句具有足够的选择性以使索引范围扫描比表扫描更便宜，</font>
												<font style="vertical-align: inherit;">则将使用该索引
												</font>
												<font style="vertical-align: inherit;">：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; </font><font style="vertical-align: inherit;">ASC </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  订购</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;按</font><font style="vertical-align: inherit;">DESC </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  订购</font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在下一个查询中，</font>
											</font><code class="literal">ORDER BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">没有命名</font>
											</font><em class="replaceable"><code>key_part1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，但所有选定的行都有一个常
												</font>
											</font><em class="replaceable"><code>key_part1</code></em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">量值，因此仍然可以使用索引：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; </font></font><em class="replaceable"><code>constant2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ORDER BY </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在某些情况下，MySQL </font>
								</font><span class="emphasis"><em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">无法</font>
										</font>
									</em></span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">使用索引来解析</font>
								</font><code class="literal">ORDER BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，尽管它仍然可以使用索引来查找与该</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句</font>
									<font style="vertical-align: inherit;">匹配的行
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">例子：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													该查询用于</font>
											</font><code class="literal">ORDER BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">不同的索引：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 ORDER BY </font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													该查询用于</font>
											</font><code class="literal">ORDER BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引的非连续部分：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ORDER BY </font></font><em class="replaceable"><code>key1_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><em class="replaceable"><code>key1_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													用于获取行的索引与以下中使用的索引不同</font>
											</font><code class="literal">ORDER BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE </font></font><em class="replaceable"><code>key2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ORDER BY </font></font><em class="replaceable"><code>key1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													该查询使用</font>
											</font><code class="literal">ORDER BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">包含索引列名以外的术语的表达式：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 ORDER BY ABS（</font></font><em class="replaceable"><code>key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1 ORDER BY  - </font></font><em class="replaceable"><code>key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													该查询连接了许多表，并且其中的列
												</font>
											</font><code class="literal">ORDER BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">不是来自用于检索行的第一个非常量表。</font>
												<font style="vertical-align: inherit;">（这是</font>
											</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">输出中没有</font>
											</font><a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">连接类型</font>
												<font style="vertical-align: inherit;">的第一个表
												</font>
												<font style="vertical-align: inherit;">。）
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													查询有不同的</font>
											</font><code class="literal">ORDER BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和
												</font>
											</font><code class="literal">GROUP BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">表情。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													只有该</font>
											</font><code class="literal">ORDER BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">子句中</font>
												<font style="vertical-align: inherit;">指定的列的前缀有一个索引</font>
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">在这种情况下，索引不能用于完全解析排序顺序。</font>
												<font style="vertical-align: inherit;">例如，如果仅</font>
											</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR(20)</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引列</font>
												<font style="vertical-align: inherit;">的前10个字节
												</font>
												<font style="vertical-align: inherit;">，则索引无法区分超过第10个字节的值，并且</font>
											</font><code class="literal">filesort</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">需要a。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													索引不按顺序存储行。</font>
												<font style="vertical-align: inherit;">例如，对于</font>
												<font style="vertical-align: inherit;">表中</font>
												<font style="vertical-align: inherit;">的</font>
											</font><code class="literal">HASH</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">索引
												</font>
												<font style="vertical-align: inherit;">，这是正确的</font>
											</font><code class="literal">MEMORY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										用于排序的索引的可用性可能受到列别名的使用的影响。</font>
									<font style="vertical-align: inherit;">假设列
									</font>
								</font><code class="literal">t1.a</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">已编入索引。</font>
									<font style="vertical-align: inherit;">在此语句中，选择列表中列的名称为
									</font>
								</font><code class="literal">a</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">它指的是</font>
								</font><code class="literal">t1.a</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，引用</font>
								</font><code class="literal">a</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">也是
									</font>
								</font><code class="literal">ORDER BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">如此，因此</font>
								</font><code class="literal">t1.a</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">可以使用</font>
									<font style="vertical-align: inherit;">索引
									</font>
									<font style="vertical-align: inherit;">：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择一个FROM t1 ORDER BY a;
</font></font></pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在此语句中，选择列表中列的名称也是</font>
								</font><code class="literal">a</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，但它是别名。</font>
									<font style="vertical-align: inherit;">它指的是</font>
								</font><code class="literal">ABS(a)</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，在引用</font>
								</font><code class="literal">a</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">中</font>
								</font><code class="literal">ORDER BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，所以</font>
								</font><code class="literal">t1.a</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">不能使用</font>
									<font style="vertical-align: inherit;">索引</font>
									<font style="vertical-align: inherit;">：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ABS（a）作为一个FROM t1 ORDER by a;
</font></font></pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在以下语句中，</font>
								</font><code class="literal">ORDER BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										引用的名称不是选择列表中列的名称。</font>
									<font style="vertical-align: inherit;">但是在</font>
								</font><code class="literal">t1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										命名中</font>
									<font style="vertical-align: inherit;">有一个列</font>
								</font><code class="literal">a</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，所以</font>
									<font style="vertical-align: inherit;">可以使用</font>
								</font><code class="literal">ORDER
									BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">引用</font>
								</font><code class="literal">t1.a</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">和索引</font>
								</font><code class="literal">t1.a</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">（当然，生成的排序顺序可能与顺序完全不同
									</font>
								</font><code class="literal">ABS(a)</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。）
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择ABS（a）AS b FROM t1 ORDER by a;
</font></font></pre><a class="indexterm" name="idm140091708000912"></a><a class="indexterm" name="idm140091707999424"></a><a
							 class="indexterm" name="idm140091707997936"></a><a class="indexterm" name="idm140091707996448"></a>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										以前（MySQL 5.7及更低版本），
									</font>
								</font><code class="literal">GROUP BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">在某些条件下隐式排序。</font>
									<font style="vertical-align: inherit;">在MySQL 8.0中，不再出现这种情况，因此</font>
								</font><code class="literal">ORDER BY NULL</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">不再需要在最后</font>
									<font style="vertical-align: inherit;">指定</font>
									<font style="vertical-align: inherit;">抑制隐式排序（如前所述）。</font>
									<font style="vertical-align: inherit;">但是，查询结果可能与以前的MySQL版本不同。</font>
									<font style="vertical-align: inherit;">要生成给定的排序顺序，请提供一个</font>
								</font><code class="literal">ORDER BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="order-by-filesort"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">使用filesort来满足ORDER BY</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<a class="indexterm" name="idm140091707991120"></a><a class="indexterm" name="idm140091707990080"></a>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果索引不能用于满足</font>
								</font><code class="literal">ORDER
									BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句，则MySQL执行</font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">读取表行并对其进行排序</font>
									<font style="vertical-align: inherit;">的
									</font>
									<font style="vertical-align: inherit;">操作。</font>
									<font style="vertical-align: inherit;">A </font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">构成查询执行中的额外排序阶段。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										为了获得</font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">操作的</font>
									<font style="vertical-align: inherit;">内存</font>
									<font style="vertical-align: inherit;">，从MySQL 8.0.12开始，优化器根据需要逐步分配内存缓冲区，直到</font>
								</font><a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">系统变量</font>
									<font style="vertical-align: inherit;">指示的大小
									</font>
									<font style="vertical-align: inherit;">，而不是</font>
								</font><a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">像MySQL 8.0之前那样预先</font>
									<font style="vertical-align: inherit;">分配固定数量的
									</font>
									<font style="vertical-align: inherit;">字节。 0.12。</font>
									<font style="vertical-align: inherit;">这使用户可以设置</font>
								</font><a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">更大的值来加速更大的排序，而不用担心小排序的过多内存使用。</font>
									<font style="vertical-align: inherit;">（对于Windows上的多个并发排序，可能不会出现此优势，因为它具有较弱的多线程</font>
								</font><code class="literal">malloc</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。）
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										一个</font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">操作使用临时磁盘文件作为必要的，如果结果集是太大，无法在内存中。</font>
									<font style="vertical-align: inherit;">某些类型的查询特别适合于完全内存中的</font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">操作。</font>
									<font style="vertical-align: inherit;">例如，优化器可以
									</font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">用来有效地在内存中处理</font>
								</font><code class="literal">ORDER BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										以下形式的查询（和子查询）</font>
									<font style="vertical-align: inherit;">，而无需临时文件</font>
									<font style="vertical-align: inherit;">：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ... FROM </font></font><em class="replaceable"><code>single_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... ORDER BY </font></font><em class="replaceable"><code>non_index_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DESC] LIMIT [ </font></font><em class="replaceable"><code>M</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，] </font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										此类查询在Web应用程序中很常见，只显示较大结果集中的几行。</font>
									<font style="vertical-align: inherit;">例子：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT col1，... FROM t1 ... ORDER BY name LIMIT 10;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT col1，... FROM t1 ... ORDER BY RAND（）LIMIT 15;</font></font><font></font>
</pre>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="order-by-optimizer-control"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">影响ORDER BY优化</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										对于</font>
									<font style="vertical-align: inherit;">未使用的</font>
									<font style="vertical-align: inherit;">慢</font>
								</font><code class="literal">ORDER BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">查询
									</font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，请尝试将</font>
								</font><a class="link" href="server-administration.html#sysvar_max_length_for_sort_data"><code class="literal">max_length_for_sort_data</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										系统变量</font>
									<font style="vertical-align: inherit;">降低
									</font>
									<font style="vertical-align: inherit;">到适合触发a的值
									</font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">（将此变量的值设置得过高的症状是高磁盘活动和低CPU活动的组合。）
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要提高</font>
								</font><code class="literal">ORDER BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">速度，请检查是否可以让MySQL使用索引而不是额外的排序阶段。</font>
									<font style="vertical-align: inherit;">如果无法做到这一点，请尝试以下策略：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													增加
												</font>
											</font><a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													变量值。</font>
												<font style="vertical-align: inherit;">理想情况下，该值应足够大，以使整个结果集适合排序缓冲区（以避免写入磁盘和合并传递）。
												</font>
											</font>
										</p>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													请考虑存储在排序缓冲区中的列值的大小受
												</font>
											</font><a class="link" href="server-administration.html#sysvar_max_sort_length"><code class="literal">max_sort_length</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">系统变量值的影响。</font>
												<font style="vertical-align: inherit;">例如，如果元组存储长字符串列的值并且您增加了值
												</font>
											</font><a class="link" href="server-administration.html#sysvar_max_sort_length"><code class="literal">max_sort_length</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，则排序缓冲区元组的大小也会增加，并且可能需要您增加
												</font>
											</font><a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													要监视合并传递的数量（合并临时文件），请检查
												</font>
											</font><a class="link" href="server-administration.html#statvar_Sort_merge_passes"><code class="literal">Sort_merge_passes</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													状态变量。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													增加
												</font>
											</font><a class="link" href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													变量值，以便一次读取更多行。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													将</font>
											</font><a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													系统变量</font>
												<font style="vertical-align: inherit;">更改</font>
												<font style="vertical-align: inherit;">为指向具有大量可用空间的专用文件系统。</font>
												<font style="vertical-align: inherit;">变量值可以列出以循环方式使用的几个路径; </font>
												<font style="vertical-align: inherit;">您可以使用此功能将负载分散到多个目录中。</font>
											</font><code class="literal">:</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">在Unix上</font>
												<font style="vertical-align: inherit;">用冒号字符（</font>
												<font style="vertical-align: inherit;">）</font>
												<font style="vertical-align: inherit;">分隔路径，</font>
											</font><code class="literal">;</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">在Windows上用</font>
												<font style="vertical-align: inherit;">分号字符（</font>
												<font style="vertical-align: inherit;">）</font>
												<font style="vertical-align: inherit;">分隔</font>
												<font style="vertical-align: inherit;">路径</font>
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">路径应命名位于不同</font>
											</font><span class="emphasis"><em>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">物理</font>
													</font>
												</em></span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">磁盘</font>
												<font style="vertical-align: inherit;">上的文件系统中的目录
												</font>
												<font style="vertical-align: inherit;">，而不是同一磁盘上的不同分区。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>

						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="order-by-diagnostic-information"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">按订单执行计划信息</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										使用
									</font>
								</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										（参见</font>
								</font><a class="xref" href="optimization.html#using-explain" title="8.8.1使用EXPLAIN优化查询">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.8.1节“使用EXPLAIN优化查询”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">），可以检查MySQL是否可以使用索引来解析</font>
								</font><code class="literal">ORDER
									BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果</font>
												<font style="vertical-align: inherit;">输出</font>
											</font><code class="literal">Extra</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">列
												</font>
											</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">不包含</font>
											</font><code class="literal">Using filesort</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，则使用索引并且</font>
											</font><code class="literal">filesort</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">不执行a。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果</font>
												<font style="vertical-align: inherit;">输出</font>
											</font><code class="literal">Extra</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">列
												</font>
											</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">包含
												</font>
											</font><code class="literal">Using filesort</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，则不使用索引并</font>
											</font><code class="literal">filesort</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">执行a。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										此外，如果</font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">执行a，则优化程序跟踪输出包括
									</font>
								</font><code class="literal">filesort_summary</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">块。</font>
									<font style="vertical-align: inherit;">例如：
									</font>
								</font>
							</p>
							<pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“filesort_summary”：{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “行”：100，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “examine_rows”：100，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “number_of_tmp_files”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “peak_memory_used”：25192，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “sort_mode”：“&lt;sort_key，packed_additional_fields&gt;”</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
							<p>
								<code class="literal">peak_memory_used</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表示排序期间任何时候使用的最大内存。</font>
									<font style="vertical-align: inherit;">这是一个值，但不一定与</font>
								</font><a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">系统变量</font>
									<font style="vertical-align: inherit;">的值一样大
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">在MySQL 8.0.12之前，输出显示
									</font>
								</font><code class="literal">sort_buffer_size</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，表示值</font>
								</font><a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">（在MySQL 8.0.12之前，优化器总是</font>
								</font><a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">为排序缓冲区</font>
									<font style="vertical-align: inherit;">分配
									</font>
									<font style="vertical-align: inherit;">字节。从8.0.12开始，优化器逐步分配排序缓冲区内存，从少量开始并根据需要添加更多，最多为
									</font>
								</font><a class="link" href="server-administration.html#sysvar_sort_buffer_size"><code class="literal">sort_buffer_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">字节。）
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										该</font>
								</font><code class="literal">sort_mode</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">值提供有关排序缓冲区中元组内容的信息：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<code class="literal">&lt;sort_key, rowid&gt;</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">：这表示排序缓冲区元组是包含原始表行的排序键值和行ID的对。</font>
												<font style="vertical-align: inherit;">元组按排序键值排序，行ID用于从表中读取行。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<code class="literal">&lt;sort_key, additional_fields&gt;</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">：这表示排序缓冲区元组包含排序键值和查询引用的列。</font>
												<font style="vertical-align: inherit;">元组按排序键值排序，列值直接从元组中读取。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<code class="literal">&lt;sort_key,
												packed_additional_fields&gt;</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">：与前一个版本类似，但是附加列紧密地打包在一起而不是使用固定长度编码。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">不区分优化器是否执行
									</font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">内存。</font>
								</font><code class="literal">filesort</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">在优化器跟踪输出中可以看到</font>
									<font style="vertical-align: inherit;">内存的使用
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">寻找
									</font>
								</font><code class="literal">filesort_priority_queue_optimization</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">有关优化程序跟踪的信息，请参阅
									</font>
								</font><a class="ulink" href="https://dev.mysql.com/doc/internals/en/optimizer-tracing.html" target="_top">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">MySQL内部：跟踪优化程序</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="group-by-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.16 GROUP BY优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091707912720"></a><a class="indexterm" name="idm140091707911648"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									最满意的一般方式 </font>
							</font><code class="literal">GROUP BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									子句</font>
								<font style="vertical-align: inherit;">是扫描整个表并创建一个新的临时表，其中每个组的所有行都是连续的，然后使用此临时表来发现组并应用聚合函数（如果有的话）。</font>
								<font style="vertical-align: inherit;">在某些情况下，MySQL能够做得更好，并通过使用索引访问来避免创建临时表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用索引的最重要的前提条件
								</font>
							</font><code class="literal">GROUP BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是所有</font>
							</font><code class="literal">GROUP
								BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列都引用来自同一索引的属性，并且索引按顺序存储其键（例如，对于</font>
							</font><code class="literal">BTREE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">索引而不是
								</font>
							</font><code class="literal">HASH</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">索引）。</font>
								<font style="vertical-align: inherit;">是否可以通过索引访问替换临时表的使用还取决于查询中使用索引的哪些部分，为这些部分指定的条件以及所选的聚合函数。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									有两种方法可以</font>
							</font><code class="literal">GROUP BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									通过索引访问</font>
								<font style="vertical-align: inherit;">来执行</font>
								<font style="vertical-align: inherit;">查询，如以下各节所述。</font>
								<font style="vertical-align: inherit;">第一种方法将分组操作与所有范围谓词（如果有）一起应用。</font>
								<font style="vertical-align: inherit;">第二种方法首先执行范围扫描，然后对生成的元组进行分组。
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p><a class="xref" href="optimization.html#loose-index-scan" title="松散的索引扫描">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">松散的索引扫描</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#tight-index-scan" title="紧密索引扫描">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">紧密索引扫描</font>
											</font>
										</a></p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									松散的索引扫描也可以
								</font>
							</font><code class="literal">GROUP BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在某些条件下使用。</font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="optimization.html#range-access-skip-scan" title="跳过扫描范围访问方法">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">跳过扫描范围访问方法</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<div class="simplesect">

							<div class="titlepage">
								<div>

									<div class="simple">
										<h5 class="title"><a name="loose-index-scan"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">松散的索引扫描</font>
											</font>
										</h5>
									</div>
								</div>
							</div>
							<a class="indexterm" name="idm140091707898064"></a>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										最有效的处理方法</font>
								</font><code class="literal">GROUP
									BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是使用索引直接检索分组列。</font>
									<font style="vertical-align: inherit;">使用此访问方法，MySQL使用某些索引类型的属性（例如，键</font>
								</font><code class="literal">BTREE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">）。</font>
									<font style="vertical-align: inherit;">此属性允许在索引中使用查找组，而无需考虑索引中满足所有</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">条件的</font>
									<font style="vertical-align: inherit;">所有键
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">此访问方法仅考虑索引中的一小部分键，因此称为</font>
								</font><span class="firstterm">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">松散索引扫描</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">当没有</font>
									<font style="vertical-align: inherit;">子句包含范围谓词时（参见</font>
									<font style="vertical-align: inherit;">连接类型</font>
									<font style="vertical-align: inherit;">的讨论
									</font>
									<font style="vertical-align: inherit;">）
									</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										子句，则松散索引扫描会读取与组数一样多的密钥，这可能比所有密钥的数量小得多。</font>
									<font style="vertical-align: inherit;">如果</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#jointype_range"><code
									 class="literal">range</code></a>
								<font style="vertical-align: inherit;"></font><a class="xref" href="optimization.html#using-explain" title="8.8.1使用EXPLAIN优化查询">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.8.1节“使用EXPLAIN优化查询”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，松散索引扫描查找满足范围条件的每个组的第一个键，并再次读取尽可能少的键。</font>
									<font style="vertical-align: inherit;">在以下条件下可以这样做：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													查询在一个表上。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													该</font>
											</font><code class="literal">GROUP BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">唯一名称构成的指数，没有其他列的最左边的前缀列。</font>
												<font style="vertical-align: inherit;">（如果</font>
											</font><code class="literal">GROUP BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">查询具有</font>
											</font><code class="literal">DISTINCT</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">子句，则所有不同的属性引用形成索引的最左前缀的列。）例如，如果表
												</font>
											</font><code class="literal">t1</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">具有索引
												</font>
											</font><code class="literal">(c1,c2,c3)</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，则在查询具有的情况下，松散索引扫描适用</font>
											</font><code class="literal">GROUP BY c1,
												c2</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">如果查询具有</font>
											</font><code class="literal">GROUP BY c2, c3</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">（列不是最左边的前缀）或</font>
											</font><code class="literal">GROUP BY c1, c2,
												c4</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">（</font>
											</font><code class="literal">c4</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">不在索引中），</font>
												<font style="vertical-align: inherit;">则不适用
												</font>
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													选择列表中使用的唯一聚合函数（如果有）是</font>
											</font><a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和
												</font>
											</font><a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，并且它们都引用同一列。</font>
												<font style="vertical-align: inherit;">该列必须位于索引中，并且必须紧跟在列中的列之后
												</font>
											</font><code class="literal">GROUP BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													索引的任何其他部分都不是</font>
											</font><code class="literal">GROUP BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">查询中引用的</font>
												<font style="vertical-align: inherit;">那些部分
												</font>
												<font style="vertical-align: inherit;">必须是常量（也就是说，它们必须以与常量相等的方式引用），但参数</font>
											</font><a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">或
												</font>
											</font><a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">函数</font>
												<font style="vertical-align: inherit;">除外
												</font>
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													对于索引中的列，必须为完整列值编制索引，而不仅仅是前缀。</font>
												<font style="vertical-align: inherit;">例如，使用
												</font>
											</font><code class="literal">c1 VARCHAR(20), INDEX (c1(10))</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，索引仅使用</font>
											</font><code class="literal">c1</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">值</font>
												<font style="vertical-align: inherit;">的前缀，</font>
												<font style="vertical-align: inherit;">不能用于松散索引扫描。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果“松散索引扫描”适用于查询，则
									</font>
								</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">输出将显示
									</font>
								</font><code class="literal">Using index for group-by</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">在
									</font>
								</font><code class="literal">Extra</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">列中。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										假设</font>
								</font><code class="literal">idx(c1,c2,c3)</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表上
									</font>
									<font style="vertical-align: inherit;">有索引
									</font>
								</font><code class="literal">t1(c1,c2,c3,c4)</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">松散索引扫描访问方法可用于以下查询：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，c2 FROM t1 GROUP BY c1，c2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT DISTINCT c1，c2 FROM t1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c1，MIN（c2）FROM t1 GROUP BY c1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c1，c2 FROM t1 WHERE c1 &lt; </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GROUP BY c1，c2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT MAX（c3），MIN（c3），c1，c2 FROM t1 WHERE c2&gt; </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GROUP BY c1，c2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c2 FROM t1 WHERE c1 &lt; </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GROUP BY c1，c2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c1，c2 FROM t1 WHERE c3 = </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GROUP BY c1，c2;
</font></font></pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										由于给出的原因，使用此快速选择方法无法执行以下查询：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													除了</font>
											</font><a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">或
												</font>
												<font style="vertical-align: inherit;">之外还有聚合函数
												</font>
											</font><a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，SUM（c2）FROM t1 GROUP BY c1;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													中的列 </font>
											</font><code class="literal">GROUP BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">子句中</font>
												<font style="vertical-align: inherit;">不构成索引的最左前缀：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，c2 FROM t1 GROUP BY c2，c3;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													查询引用了一个密钥的一部分
												</font>
											</font><code class="literal">GROUP BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">一部分，并且与常量不相等：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，c3 FROM t1 GROUP BY c1，c2;
</font></font></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果要包含查询</font>
												<font style="vertical-align: inherit;">，可以使用松散索引扫描。
												</font>
											</font><code class="literal">WHERE c3 =
												<em class="replaceable"><code>const</code></em></code>
											<font style="vertical-align: inherit;"></font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										除了</font>
									<font style="vertical-align: inherit;">已经支持</font>
									<font style="vertical-align: inherit;">的</font>
								</font><a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">和
									</font>
								</font><a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">引用</font>
									<font style="vertical-align: inherit;">之外，松散索引扫描访问方法还可以应用于选择列表中的其他形式的聚合函数引用</font>
									<font style="vertical-align: inherit;">：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<a class="link" href="functions.html#function_avg"><code class="literal">AVG(DISTINCT)</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><a class="link" href="functions.html#function_sum"><code class="literal">SUM(DISTINCT)</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和
												</font>
											</font><a class="link" href="functions.html#function_count"><code class="literal">COUNT(DISTINCT)</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">支持。</font>
											</font><a class="link" href="functions.html#function_avg"><code class="literal">AVG(DISTINCT)</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													并</font>
											</font><a class="link" href="functions.html#function_sum"><code class="literal">SUM(DISTINCT)</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">采取一个论点。
												</font>
											</font><a class="link" href="functions.html#function_count"><code class="literal">COUNT(DISTINCT)</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">可以有多个列参数。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">查询中</font>
												<font style="vertical-align: inherit;">
													必须没有</font>
											</font><code class="literal">GROUP BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">or
												</font>
											</font><code class="literal">DISTINCT</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">子句。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													前面描述的松散索引扫描限制仍然适用。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										假设</font>
								</font><code class="literal">idx(c1,c2,c3)</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表上
									</font>
									<font style="vertical-align: inherit;">有索引
									</font>
								</font><code class="literal">t1(c1,c2,c3,c4)</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">松散索引扫描访问方法可用于以下查询：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT COUNT（DISTINCT c1），SUM（DISTINCT c1）FROM t1;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT COUNT（DISTINCT c1，c2），COUNT（DISTINCT c2，c1）FROM t1;</font></font><font></font>
</pre>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="tight-index-scan"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">紧密索引扫描</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										紧密索引扫描可以是完整索引扫描，也可以是范围索引扫描，具体取决于查询条件。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果不满足松散索引扫描的条件，则仍可以避免为</font>
								</font><code class="literal">GROUP BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">查询</font>
									<font style="vertical-align: inherit;">创建临时表</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">如果</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句中</font>
									<font style="vertical-align: inherit;">有范围条件，则</font>
									<font style="vertical-align: inherit;">此方法仅读取满足这些条件的键。</font>
									<font style="vertical-align: inherit;">否则，它执行索引扫描。</font>
									<font style="vertical-align: inherit;">因为此方法读取</font>
								</font><code class="literal">WHERE</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">子句</font>
									<font style="vertical-align: inherit;">定义的每个范围中的所有键
									</font>
									<font style="vertical-align: inherit;">，或者如果没有范围条件则扫描整个索引，因此称为
									</font>
								</font><span class="firstterm">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">紧密索引扫描</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">使用紧密索引扫描时，仅在找到满足范围条件的所有键之后才执行分组操作。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										为了使这个方法起作用，对于查询中的所有列，存在一个恒定的相等条件就足够了，该条件引用了密钥的部分之前或之间的部分</font>
								</font><code class="literal">GROUP BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">密钥。</font>
									<font style="vertical-align: inherit;">来自等式条件的常量填充</font>
									<font style="vertical-align: inherit;">
										搜索关键字</font>
									<font style="vertical-align: inherit;">中的任何</font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">“ </font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">间隙</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;"> ”</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，以便可以形成索引的完整前缀。</font>
									<font style="vertical-align: inherit;">然后，这些索引前缀可用于索引查找。</font>
									<font style="vertical-align: inherit;">如果</font>
								</font><code class="literal">GROUP BY</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> 结果需要排序，并且可以形成作为索引前缀的搜索键，MySQL也避免了额外的排序操作，因为在有序索引中使用前缀进行搜索已经按顺序检索了所有键。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										假设</font>
								</font><code class="literal">idx(c1,c2,c3)</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表上
									</font>
									<font style="vertical-align: inherit;">有索引
									</font>
								</font><code class="literal">t1(c1,c2,c3,c4)</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">以下查询不适用于前面描述的松散索引扫描访问方法，但仍可使用紧密索引扫描访问方法。
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													它有一个缺口</font>
											</font><code class="literal">GROUP BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，但它被条件覆盖</font>
											</font><code class="literal">c2 =
												'a'</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，c2，c3 FROM t1 WHERE c2 ='a'GROUP BY c1，c3;
</font></font></pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在</font>
											</font><code class="literal">GROUP BY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">不与钥匙的第一部分开始，但它提供了该部分恒定的条件：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c1，c2，c3 FROM t1 WHERE c1 ='a'GROUP BY c2，c3;
</font></font></pre>
									</li>
								</ul>
							</div>

						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="distinct-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.17 DISTINCT优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091707812384"></a><a class="indexterm" name="idm140091707811312"></a>
						<p>
							<code class="literal">DISTINCT</code>
							<font style="vertical-align: inherit;"></font><code class="literal">ORDER
								BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在许多情况下</font>
								<font style="vertical-align: inherit;">结合</font>
								<font style="vertical-align: inherit;">需要临时表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									因为</font>
							</font><code class="literal">DISTINCT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可以使用</font>
							</font><code class="literal">GROUP
								BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，所以了解MySQL如何
								</font>
								<font style="vertical-align: inherit;">使用</font>
								<font style="vertical-align: inherit;">
									不属于所选列的列</font>
							</font><code class="literal">ORDER BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或</font>
							</font><code class="literal">HAVING</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句。</font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="functions.html#group-by-handling" title="12.20.3 GROUP BY的MySQL处理">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第12.20.3节“GROUP BY的MySQL处理”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在大多数情况下，一个</font>
							</font><code class="literal">DISTINCT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条款可以被视为一个特例</font>
							</font><code class="literal">GROUP BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">例如，以下两个查询是等效的：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT DISTINCT c1，c2，c3 FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c1&gt; </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c1，c2，c3 FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c1&gt; </font></font><em class="replaceable"><code>const</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GROUP BY c1，c2，c3;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									由于这种等效性，适用于</font>
							</font><code class="literal">GROUP BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">查询</font>
								<font style="vertical-align: inherit;">的优化
								</font>
								<font style="vertical-align: inherit;">也可以应用于带有</font>
							</font><code class="literal">DISTINCT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句的</font>
								<font style="vertical-align: inherit;">查询</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">因此，有关</font>
							</font><code class="literal">DISTINCT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">查询</font>
								<font style="vertical-align: inherit;">优化可能性的更多详细信息
								</font>
								<font style="vertical-align: inherit;">，请参见
								</font>
							</font><a class="xref" href="optimization.html#group-by-optimization" title="8.2.1.16 GROUP BY优化">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.2.1.16节“GROUP BY优化”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">与之</font>
								<font style="vertical-align: inherit;">
									结合</font>
								<font style="vertical-align: inherit;">使用时
								</font>
								<font style="vertical-align: inherit;">，MySQL会在找到</font>
								<font style="vertical-align: inherit;">唯一行后</font>
								<font style="vertical-align: inherit;">立即停止
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font><code class="literal">LIMIT
								<em class="replaceable"><code>row_count</code></em></code>
							<font style="vertical-align: inherit;"></font><code class="literal">DISTINCT</code>
							<font style="vertical-align: inherit;"></font><em class="replaceable"><code>row_count</code></em>
							<font style="vertical-align: inherit;"></font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果不使用查询中指定的所有表中的列，MySQL会在找到第一个匹配项后立即停止扫描所有未使用的表。</font>
								<font style="vertical-align: inherit;">在下面的例子中，假设
								</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">之前使用过</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									（你可以检查
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">），MySQL </font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">找到第一行时</font>
								<font style="vertical-align: inherit;">停止从</font>
								<font style="vertical-align: inherit;">（对于任何特定行
								</font>
								<font style="vertical-align: inherit;">）
								</font>
								<font style="vertical-align: inherit;">读取</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT DISTINCT t1.a FROM t1，t2其中t1.a = t2.a;
</font></font></pre>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="limit-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.18 LIMIT查询优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091707786240"></a><a class="indexterm" name="idm140091707784784"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果只需要结果集中指定数量的行，请</font>
							</font><code class="literal">LIMIT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在查询中</font>
								<font style="vertical-align: inherit;">使用</font>
								<font style="vertical-align: inherit;">子句，而不是获取整个结果集并丢弃额外数据。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL有时会优化具有</font>
								<font style="vertical-align: inherit;">子句且没有
								</font>
								<font style="vertical-align: inherit;">子句</font>
								<font style="vertical-align: inherit;">的查询</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font><code class="literal">LIMIT
								<em class="replaceable"><code>row_count</code></em></code>
							<font style="vertical-align: inherit;"></font><code class="literal">HAVING</code>
							<font style="vertical-align: inherit;"></font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果您只选择几行
											</font>
										</font><code class="literal">LIMIT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，MySQL在某些情况下使用索引，通常它更喜欢进行全表扫描。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果你结合</font>
											<font style="vertical-align: inherit;">使用
											</font>
											<font style="vertical-align: inherit;">，MySQL会在找到</font>
											<font style="vertical-align: inherit;">排序结果</font>
											<font style="vertical-align: inherit;">的第一</font>
											<font style="vertical-align: inherit;">行后</font>
											<font style="vertical-align: inherit;">立即停止排序
											</font>
											<font style="vertical-align: inherit;">，而不是整理整个结果。</font>
											<font style="vertical-align: inherit;">如果使用索引完成排序，则速度非常快。</font>
											<font style="vertical-align: inherit;">如果必须完成一个</font>
											<font style="vertical-align: inherit;">文件排序，则选择与</font>
											<font style="vertical-align: inherit;">没有该</font>
											<font style="vertical-align: inherit;">子句</font>
											<font style="vertical-align: inherit;">的查询匹配的所有行</font>
											<font style="vertical-align: inherit;">，并在</font>
											<font style="vertical-align: inherit;">找到</font>
											<font style="vertical-align: inherit;">第一个之前对其中的大部分或全部进行排序
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">在找到初始行之后，MySQL不会对结果集的任何剩余部分进行排序。
											</font>
										</font><code class="literal">LIMIT
											<em class="replaceable"><code>row_count</code></em></code>
										<font style="vertical-align: inherit;"></font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;"></font><em class="replaceable"><code>row_count</code></em>
										<font style="vertical-align: inherit;"></font><code class="literal">LIMIT</code>
										<font style="vertical-align: inherit;"></font><em class="replaceable"><code>row_count</code></em>
										<font style="vertical-align: inherit;"></font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												此行为的一种表现形式是，</font>
										</font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">带有和不带</font>
											<font style="vertical-align: inherit;">的
											</font>
											<font style="vertical-align: inherit;">查询
											</font>
										</font><code class="literal">LIMIT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可能会以不同的顺序返回行，如本节后面所述。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果你结合</font>
											<font style="vertical-align: inherit;">使用
											</font>
											<font style="vertical-align: inherit;">，MySQL会在找到</font>
											<font style="vertical-align: inherit;">唯一行后</font>
											<font style="vertical-align: inherit;">立即停止</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">LIMIT
											<em class="replaceable"><code>row_count</code></em></code>
										<font style="vertical-align: inherit;"></font><code class="literal">DISTINCT</code>
										<font style="vertical-align: inherit;"></font><em class="replaceable"><code>row_count</code></em>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在某些情况下，</font>
										</font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可以通过按顺序读取索引（或对索引进行排序），然后计算摘要直到索引值更改来解析a。</font>
											<font style="vertical-align: inherit;">在这种情况下，</font>
											<font style="vertical-align: inherit;">不计算任何不必要的</font>
											<font style="vertical-align: inherit;">
												值。
											</font>
										</font><code class="literal">LIMIT
											<em class="replaceable"><code>row_count</code></em></code>
										<font style="vertical-align: inherit;"></font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												一旦MySQL向客户端发送了所需的行数，它就会中止查询，除非您使用
											</font>
										</font><code class="literal">SQL_CALC_FOUND_ROWS</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">在这种情况下，可以使用检索行数</font>
										</font><code class="literal">SELECT
											FOUND_ROWS()</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="functions.html#information-functions" title="12.15信息功能">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第12.15节“信息功能”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p><a class="indexterm" name="idm140091707761632"></a>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">LIMIT 0</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">快速返回一个空集。</font>
											<font style="vertical-align: inherit;">这对于检查查询的有效性非常有用。</font>
											<font style="vertical-align: inherit;">它还可用于获取使用MySQL API的应用程序中的结果列类型，该API使结果集元数据可用。</font>
											<font style="vertical-align: inherit;">使用
											</font>
										</font><a class="link" href="programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行客户端"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysql</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">客户端程序，您可以使用该
											</font>
										</font><a class="link" href="programs.html#option_mysql_column-type-info"><code class="option">--column-type-info</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">选项显示结果列类型。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果服务器使用临时表来解析查询，则它使用该</font>
											<font style="vertical-align: inherit;">子句计算需要多少空间。
											</font>
										</font><code class="literal">LIMIT
											<em class="replaceable"><code>row_count</code></em></code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果未使用索引</font>
										</font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												但是</font>
										</font><code class="literal">LIMIT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">也存在子句，则优化器可能能够避免使用合并文件并使用内存中</font>
										</font><code class="literal">filesort</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">操作</font>
											<font style="vertical-align: inherit;">对内存中的行进行排序
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果列中的多个行具有相同的值</font>
							</font><code class="literal">ORDER
								BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，则服务器可以按任何顺序自由返回这些行，并且可能根据整体执行计划的不同而不同。</font>
								<font style="vertical-align: inherit;">换句话说，这些行的排序顺序相对于无序列是不确定的。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									影响执行计划的一个因素是
								</font>
							</font><code class="literal">LIMIT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，因此</font>
							</font><code class="literal">ORDER BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用和不</font>
								<font style="vertical-align: inherit;">使用</font>
								<font style="vertical-align: inherit;">查询</font>
							</font><code class="literal">LIMIT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可能会返回不同顺序的行。</font>
								<font style="vertical-align: inherit;">考虑这个查询，它按</font>
							</font><code class="literal">category</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列</font>
								<font style="vertical-align: inherit;">排序，</font>
								<font style="vertical-align: inherit;">但对于</font>
							</font><code class="literal">id</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">rating</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列是</font>
								<font style="vertical-align: inherit;">不确定的</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM ratings ORDER BY category;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">类别| </font><font style="vertical-align: inherit;">评级|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">3.2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">5.0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									包括</font>
							</font><code class="literal">LIMIT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可能影响每个</font>
							</font><code class="literal">category</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值</font>
								<font style="vertical-align: inherit;">内的行的顺序</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">例如，这是一个有效的查询结果：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM ratings ORDER BY category LIMIT 5;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">类别| </font><font style="vertical-align: inherit;">评级|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">3.2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在每种情况下，行都按</font>
							</font><code class="literal">ORDER
								BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列</font>
								<font style="vertical-align: inherit;">排序</font>
								<font style="vertical-align: inherit;">，这是SQL标准所需的全部内容。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果确保使用和不使用相同的行顺序很重要，请</font>
							</font><code class="literal">LIMIT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在</font>
							</font><code class="literal">ORDER BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句中</font>
								<font style="vertical-align: inherit;">包含其他列</font>
								<font style="vertical-align: inherit;">以使订单具有确定性。</font>
								<font style="vertical-align: inherit;">例如，如果</font>
							</font><code class="literal">id</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值是唯一的，则可以</font>
								<font style="vertical-align: inherit;">通过如下排序</font>
							</font><code class="literal">category</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">按</font>
							</font><code class="literal">id</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">顺序</font>
								<font style="vertical-align: inherit;">显示</font>
								<font style="vertical-align: inherit;">给定</font>
								<font style="vertical-align: inherit;">值的
								</font>
								<font style="vertical-align: inherit;">行
								</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM ratings ORDER BY category, id;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">类别| </font><font style="vertical-align: inherit;">评级|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">3.2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">5.0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM ratings ORDER BY category, id LIMIT 5;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">类别| </font><font style="vertical-align: inherit;">评级|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">4.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">3.2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.7 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3.5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---- + ---------- + -------- +</font></font><font></font>
</pre>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="function-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.19函数调用优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091707728688"></a><a class="indexterm" name="idm140091707727216"></a><a class="indexterm"
						 name="idm140091707725712"></a><a class="indexterm" name="idm140091707724208"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL函数在内部标记为确定性或非确定性。</font>
								<font style="vertical-align: inherit;">如果给定参数的固定值，它可以为不同的调用返回不同的结果，那么函数是不确定的。</font>
								<font style="vertical-align: inherit;">非确定性函数的例子：
								</font>
							</font><a class="link" href="functions.html#function_rand"><code class="literal">RAND()</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="functions.html#function_uuid"><code class="literal">UUID()</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果函数被标记为非确定性的，</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">则会为每一行（从一个表中选择时）或行组合（从多表连接中选择时）评估子句中</font>
								<font style="vertical-align: inherit;">对它的引用</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL还根据参数类型，参数是表列还是常量值来确定何时评估函数。</font>
								<font style="vertical-align: inherit;">只要该列更改值，就必须计算将表列作为参数的确定性函数。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									非确定性函数可能会影响查询性能。</font>
								<font style="vertical-align: inherit;">例如，某些优化可能不可用，或者可能需要更多锁定。</font>
								<font style="vertical-align: inherit;">以下讨论使用
								</font>
							</font><a class="link" href="functions.html#function_rand"><code class="literal">RAND()</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">但也适用于其他非确定性函数。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									假设一个表</font>
							</font><code class="literal">t</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">有这个定义：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t（id INT NOT NULL PRIMARY KEY，col_a VARCHAR（100））;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									考虑这两个查询：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t WHERE id = POW（1,2）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t WHERE id = FLOOR（1 + RAND（）* 49）;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									由于与主键的相等性比较，两个查询似乎都使用主键查找，但这仅适用于第一个：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												第一个查询总是产生最多一行，因为</font>
										</font><a class="link" href="functions.html#function_pow"><code class="literal">POW()</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">常量参数是一个常量值，用于索引查找。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												第二个查询包含一个使用非确定性函数的表达式，该函数
											</font>
										</font><a class="link" href="functions.html#function_rand"><code class="literal">RAND()</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在查询中不是常量，但实际上对于表的每一行都有一个新值</font>
										</font><code class="literal">t</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">因此，查询读取表的每一行，计算每行的谓词，并输出主键与随机值匹配的所有行。</font>
											<font style="vertical-align: inherit;">这可能是零行，一行或多行，具体取决于
											</font>
										</font><code class="literal">id</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列值和</font>
										</font><a class="link" href="functions.html#function_rand"><code class="literal">RAND()</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">序列中</font>
											<font style="vertical-align: inherit;">的值
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									不确定性的影响不仅限于
								</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">陈述。</font>
								<font style="vertical-align: inherit;">此
								</font>
							</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句使用非确定性函数来选择要修改的行：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE t SET col_a = </font></font><em class="replaceable"><code>some_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE id = FLOOR（1 + RAND（）* 49）;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									据推测，目的是最多更新主键与表达式匹配的单个行。</font>
								<font style="vertical-align: inherit;">但是，它可能会更新零行，一行或多行，具体取决于
								</font>
							</font><code class="literal">id</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列值和</font>
							</font><a class="link" href="functions.html#function_rand"><code class="literal">RAND()</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">序列中</font>
								<font style="vertical-align: inherit;">的值
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									刚才描述的行为对性能和复制有影响：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												由于非确定性函数不会生成常量值，因此优化程序无法使用可能适用的策略，例如索引查找。</font>
											<font style="vertical-align: inherit;">结果可能是表扫描。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> 可能会升级到范围键锁，而不是对一个匹配的行进行单行锁定。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												不确定执行的更新对于复制是不安全的。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									困难源于这样一个事实，即
								</font>
							</font><a class="link" href="functions.html#function_rand"><code class="literal">RAND()</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">对表格的每一行评估一次函数。</font>
								<font style="vertical-align: inherit;">要避免多项功能评估，请使用以下技术之一：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												将包含非确定性函数的表达式移动到单独的语句中，将值保存在变量中。</font>
											<font style="vertical-align: inherit;">在原始语句中，将表达式替换为对变量的引用，优化程序可将其视为常量值：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @keyval = FLOOR（1 + RAND（）* 49）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE t SET col_a = </font></font><em class="replaceable"><code>some_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE id = @keyval;
</font></font></pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												将随机值分配给派生表中的变量。</font>
											<font style="vertical-align: inherit;">这个技术使变量在用于</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句</font>
											<font style="vertical-align: inherit;">中的比较之前被赋值一次
											</font>
											<font style="vertical-align: inherit;">：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE / * + NO_MERGE（dt）* / t，（SELECT FLOOR（1 + RAND（）* 49）AS r）AS dt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET col_a = </font></font><em class="replaceable"><code>some_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE id = dt.r;
</font></font></pre>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如前所述，</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句中</font>
								<font style="vertical-align: inherit;">的非确定性表达式
								</font>
								<font style="vertical-align: inherit;">可能会阻止优化并导致表扫描。</font>
								<font style="vertical-align: inherit;">但是，</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">如果其他表达式是确定性的</font>
								<font style="vertical-align: inherit;">，则可以部分地优化该</font>
								<font style="vertical-align: inherit;">子句。</font>
								<font style="vertical-align: inherit;">例如：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t WHERE partial_key = 5 AND some_column = RAND（）;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果优化器可以</font>
							</font><code class="literal">partial_key</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">用来减少所选择的行集，
								</font>
							</font><a class="link" href="functions.html#function_rand"><code class="literal">RAND()</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">则执行的次数会减少，这会减少非确定性对优化的影响。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="window-function-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.20窗口函数优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091707677184"></a><a class="indexterm" name="idm140091707675696"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									窗口函数会影响优化程序考虑的策略：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果子查询具有窗口函数，则禁用派生表合并子查询。</font>
											<font style="vertical-align: inherit;">子查询始终具体化。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												半连接不适用于窗口函数优化，因为半连接适用于子查询，
											</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">并且</font>
										</font><code class="literal">JOIN ...
											ON</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">不能包含窗口函数。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												优化器按顺序处理具有相同排序要求的多个窗口，因此可以在第一个窗口之后跳过排序。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												优化器不会尝试合并可在单个步骤中评估的窗口（例如，当多个
											</font>
										</font><code class="literal">OVER</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句包含相同的窗口定义时）。</font>
											<font style="vertical-align: inherit;">解决方法是在</font>
										</font><code class="literal">WINDOW</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句中</font>
											<font style="vertical-align: inherit;">定义窗口
											</font>
											<font style="vertical-align: inherit;">并引用子句中的窗口名称</font>
										</font><code class="literal">OVER</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									未用作窗口函数的聚合函数在最外面的可能查询中聚合。</font>
								<font style="vertical-align: inherit;">例如，在这个查询中，MySQL看到</font>
							</font><code class="literal">COUNT(t1.b)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">外部查询中不存在的东西，因为它放在</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句中：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE t1.a =（SELECT COUNT（t1.b）FROM t2）;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									因此，MySQL在子查询中聚合，
								</font>
							</font><code class="literal">t1.b</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">视为常量并返回行的计数</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">用
								</font>
							</font><code class="literal">HAVING</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">结果</font>
								<font style="vertical-align: inherit;">
									替换</font>
								<font style="vertical-align: inherit;">错误：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM t1 HAVING t1.a = (SELECT COUNT(t1.b) FROM t2);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误1140（42000）：在没有GROUP BY的聚合查询中，表达式为＃1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT列表包含非聚合列'test.t1.a'; </font><font style="vertical-align: inherit;">这是</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与sql_mode = only_full_group_by不兼容</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									发生错误是因为</font>
							</font><code class="literal">COUNT(t1.b)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可以存在</font>
							</font><code class="literal">HAVING</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，因此会使外部查询聚合。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									窗口函数（包括用作窗口函数的聚合函数）没有前面的复杂性。</font>
								<font style="vertical-align: inherit;">它们总是在编写它们的子查询中聚合，而不是在外部查询中聚合。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									窗口函数评估可能受</font>
							</font><a class="link" href="server-administration.html#sysvar_windowing_use_high_precision"><code class="literal">windowing_use_high_precision</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									系统变量</font>
								<font style="vertical-align: inherit;">值的影响，该值
								</font>
								<font style="vertical-align: inherit;">确定是否在不损失精度的情况下计算窗口操作。</font>
								<font style="vertical-align: inherit;">默认情况下，
								</font>
							</font><a class="link" href="server-administration.html#sysvar_windowing_use_high_precision"><code class="literal">windowing_use_high_precision</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									已启用。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于某些移动帧聚合，可以应用反聚合函数来从聚合中移除值。</font>
								<font style="vertical-align: inherit;">这可以提高性能，但可能会降低精度。</font>
								<font style="vertical-align: inherit;">例如，将一个非常小的浮点值添加到一个非常大的值会导致非常小的值被
								</font>
								<font style="vertical-align: inherit;">大值</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">隐藏</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">当稍后反转大值时，小值的效果会丢失。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									由于反向聚合导致的精度损失仅是对浮点（近似值）数据类型的操作的因素。</font>
								<font style="vertical-align: inherit;">对于其他类型，反向聚合是安全的; </font>
								<font style="vertical-align: inherit;">这包括</font>
							</font><a class="link" href="data-types.html#fixed-point-types" title="11.2.2定点类型（精确值） -  DECIMAL，NUMERIC"><code
								 class="literal">DECIMAL</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，允许小数部分，但是精确值类型。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									为了更快地执行，MySQL在安全时始终使用反向聚合：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于浮点值，反向聚合并不总是安全的，可能会导致精度损失。</font>
											<font style="vertical-align: inherit;">默认是避免反向聚合，反向聚合较慢但保留精度。</font>
											<font style="vertical-align: inherit;">如果允许牺牲速度的安全性，
											</font>
										</font><a class="link" href="server-administration.html#sysvar_windowing_use_high_precision"><code class="literal">windowing_use_high_precision</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												可以禁用以允许反向聚合。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于非浮点数据类型，逆聚合始终是安全的，无论</font>
										</font><a class="link" href="server-administration.html#sysvar_windowing_use_high_precision"><code class="literal">windowing_use_high_precision</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												值</font>
											<font style="vertical-align: inherit;">如何都使用
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<a class="link" href="server-administration.html#sysvar_windowing_use_high_precision"><code class="literal">windowing_use_high_precision</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对</font>
										</font><a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
											<font style="vertical-align: inherit;">没有影响</font>
										</font><a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，在任何情况下都不使用反向聚合。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									为的方差函数评价
								</font>
							</font><a class="link" href="functions.html#function_stddev-pop"><code class="literal">STDDEV_POP()</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="functions.html#function_stddev-samp"><code class="literal">STDDEV_SAMP()</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="functions.html#function_var-pop"><code class="literal">VAR_POP()</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="functions.html#function_var-samp"><code class="literal">VAR_SAMP()</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，和它们的同义词，可以发生在优化模式或默认模式的评价。</font>
								<font style="vertical-align: inherit;">优化模式可能会在最后有效数字中产生略微不同的结果。</font>
								<font style="vertical-align: inherit;">如果允许这样的差异，
								</font>
							</font><a class="link" href="server-administration.html#sysvar_windowing_use_high_precision"><code class="literal">windowing_use_high_precision</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									可以禁用以允许优化模式。
								</font>
							</font>
						</p><a class="indexterm" name="idm140091707630240"></a><a class="indexterm" name="idm140091707628752"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									因为</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，窗口执行计划信息过于庞大，无法以传统输出格式显示。</font>
								<font style="vertical-align: inherit;">要查看窗口信息，请使用
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN
									FORMAT=JSON</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">并查找
								</font>
							</font><code class="literal">windowing</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">元素。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="row-constructor-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.21行构造函数表达式优化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091707622208"></a><a class="indexterm" name="idm140091707620720"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									行构造函数允许同时比较多个值。</font>
								<font style="vertical-align: inherit;">例如，这两个语句在语义上是等价的：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE（column1，column2）=（1,1）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1 WHERE column1 = 1 AND column2 = 1;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									此外，优化器以相同的方式处理两个表达式。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果行构造函数列未覆盖索引的前缀，则优化程序不太可能使用可用索引。</font>
								<font style="vertical-align: inherit;">请考虑下表，其中包含一个主键
								</font>
							</font><code class="literal">(c1, c2, c3)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  c1 INT，c2 INT，c3 INT，c4 CHAR（100），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  主键（c1，c2，c3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在此查询中，该</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句使用索引中的所有列。</font>
								<font style="vertical-align: inherit;">但是，行构造函数本身不会覆盖索引前缀，结果是优化程序仅使用</font>
							</font><code class="literal">c1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">（</font>
							</font><code class="literal">key_len=4</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，大小</font>
							</font><code class="literal">c1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM t1</code></strong>
       <strong class="userinput"><code>WHERE c1=1 AND (c2,c3) &gt; (1,1)\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：ref</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：PRIMARY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          关键：主要</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：const</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用在哪里</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在这种情况下，使用等效的非构造函数表达式重写行构造函数表达式可能会导致更完整的索引使用。</font>
								<font style="vertical-align: inherit;">对于给定的查询，行构造函数和等效的非构造函数表达式是：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（c2，c3）&gt;（1,1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c2&gt; 1 OR（（c2 = 1）AND（c3&gt; 1））</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									重写查询以使用非构造函数表达式会导致优化器使用index（</font>
							</font><code class="literal">key_len=12</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）</font>
								<font style="vertical-align: inherit;">中的所有三列</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM t1</code></strong>
       <strong class="userinput"><code>WHERE c1 = 1 AND (c2 &gt; 1 OR ((c2 = 1) AND (c3 &gt; 1)))\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：范围</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：PRIMARY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          关键：主要</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：12</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用在哪里</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									因此，为了获得更好的结果，请避免将行构造函数与</font>
							</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">/ </font>
							</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表达式</font>
								<font style="vertical-align: inherit;">混合
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">使用其中一个。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在某些情况下，优化器可以将范围访问方法应用于</font>
							</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">具有行构造函数参数的表达式。</font>
								<font style="vertical-align: inherit;">请参阅
								</font>
							</font><a class="xref" href="optimization.html#row-constructor-range-optimization" title="行构造函数表达式的范围优化">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">行构造函数表达式的范围优化</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="table-scan-avoidance"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.1.22避免全表扫描</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091707596000"></a><a class="indexterm" name="idm140091707594544"></a><a class="indexterm"
						 name="idm140091707593056"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">当MySQL使用</font><a class="link" href="glossary.html#glos_full_table_scan"
								 title="全表扫描">
									<font style="vertical-align: inherit;">全表扫描</font>
								</a>
								<font style="vertical-align: inherit;">来解析查询</font>
								<font style="vertical-align: inherit;">时</font>
								<font style="vertical-align: inherit;">
									，输出</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">显示
								</font>
							</font><a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在
								</font>
							</font><code class="literal">type</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列中
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">这通常在以下条件下发生：
								</font>
							</font><a class="link" href="glossary.html#glos_full_table_scan" title="全表扫描">
								<font style="vertical-align: inherit;"></font>
							</a>
							<font style="vertical-align: inherit;"></font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该表非常小，执行表扫描比使用键查找更麻烦。</font>
											<font style="vertical-align: inherit;">这对于行少于10行且行长度较短的表来说很常见。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引列</font>
											<font style="vertical-align: inherit;">
												的</font>
										</font><code class="literal">ON</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">or </font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句</font>
											<font style="vertical-align: inherit;">中没有可用的限制
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												您正在将索引列与常量值进行比较，并且MySQL已经计算（基于索引树）常量覆盖了表的一部分，并且表扫描会更快。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="optimization.html#where-optimization" title="8.2.1.1 WHERE子句优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.1节“WHERE子句优化”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												您正在使用具有低基数的键（许多行与键值匹配）通过另一列。</font>
											<font style="vertical-align: inherit;">在这种情况下，MySQL假设通过使用密钥，它可能会执行许多密钥查找，并且表扫描会更快。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于小型表，表扫描通常是合适的，并且性能影响可以忽略不计。</font>
								<font style="vertical-align: inherit;">对于大型表，请尝试以下技术以避免优化程序错误地选择表扫描：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												使用</font>
											<font style="vertical-align: inherit;">更新的扫描表的键分布。</font>
											<font style="vertical-align: inherit;">请参见
											</font><a class="xref" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法">
												<font style="vertical-align: inherit;">第13.7.3.1节“ANALYZE TABLE语法”</font>
											</a>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">ANALYZE TABLE
											<em class="replaceable"><code>tbl_name</code></em></code>
										<font style="vertical-align: inherit;"></font><a class="xref" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法">
											<font style="vertical-align: inherit;"></font>
										</a>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												使用</font>
										</font><code class="literal">FORCE INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">的扫描表告诉MySQL该表扫描是非常昂贵相比，使用给定的指标：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1，t2 FORCE INDEX（</font></font><em class="replaceable"><code>index_for_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t1。</font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= T2。</font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												请参见</font>
										</font><a class="xref" href="optimization.html#index-hints" title="8.9.4索引提示">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.9.4节“索引提示”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												启动</font>
										</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysqld的</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">与
											</font>
										</font><a class="link" href="server-administration.html#sysvar_max_seeks_for_key"><code class="option">--max-seeks-for-key=1000</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												选项或使用</font>
										</font><code class="literal">SET
											max_seeks_for_key=1000</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">告诉优化器：假定任何按键扫描导致1000个以上的键搜索。</font>
											<font style="vertical-align: inherit;">请参见</font>
										</font><a class="xref" href="server-administration.html#server-system-variables" title="5.1.8服务器系统变量">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第5.1.8节“服务器系统变量”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="subquery-optimization"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.2优化子查询，派生表，查看引用和公用表表达式</font>
									</font>
								</h3>
							</div>
						</div>
					</div>
					<div class="toc">
						<dl class="toc"><dt><span class="section"><a href="optimization.html#semi-joins">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.2.1使用半连接转换优化子查询，派生表，视图引用和公用表表达式</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#subquery-materialization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.2.2使用实现优化子查询</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#subquery-optimization-with-exists">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.2.3使用EXISTS策略优化子查询</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#derived-table-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.2.4使用合并或实现优化派生表，视图引用和公用表表达式</font>
										</font>
									</a></span></dt></dl>
					</div>
					<a class="indexterm" name="idm140091707566208"></a><a class="indexterm" name="idm140091707564752"></a><a class="indexterm"
					 name="idm140091707563264"></a><a class="indexterm" name="idm140091707561776"></a><a class="indexterm" name="idm140091707560288"></a><a
					 class="indexterm" name="idm140091707558800"></a><a class="indexterm" name="idm140091707557312"></a><a class="indexterm"
					 name="idm140091707555808"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL查询优化器有不同的策略可用于评估子查询：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于</font>
									</font><code class="literal">IN</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">（或</font>
									</font><code class="literal">=ANY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）子查询，优化器具有以下选项：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														半连接
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														实体化
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">EXISTS</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;"> 战略
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于</font>
									</font><code class="literal">NOT IN</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">（或
										</font>
									</font><code class="literal">&lt;&gt;ALL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）子查询，优化器具有以下选项：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														实体化
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">EXISTS</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;"> 战略
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于派生表，优化器具有以下选项（也适用于视图引用和公用表表达式）：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											将派生表合并到外部查询块中
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											将派生表实现为内部临时表
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下讨论提供了有关上述优化策略的更多信息。
							</font>
						</font>
					</p>
					<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

						<div class="admon-title">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									注意
								</font>
							</font>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">使用子查询修改单个表</font>
								<font style="vertical-align: inherit;">
									的限制</font>
							</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句是优化程序不使用半连接或实现子查询优化。</font>
								<font style="vertical-align: inherit;">作为一种解决方法，尝试将它们重写为</font>
								<font style="vertical-align: inherit;">使用连接而不是子查询的</font>
								<font style="vertical-align: inherit;">多表
								</font>
							</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="semi-joins"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.2.1使用半连接转换优化子查询，派生表，视图引用和公用表表达式</font>
										</font>
									</h4>
								</div>
							</div>
						</div>
						<a class="indexterm" name="idm140091707532160"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									半连接是一种准备时转换，它支持多种执行策略，例如表拉出，重复清除，首次匹配，松散扫描和物化。</font>
								<font style="vertical-align: inherit;">优化程序使用半连接策略来改进子查询执行，如本节所述。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于两个表之间的内部联接，连接从一个表返回一行，与另一个表中的匹配一样多次。</font>
								<font style="vertical-align: inherit;">但是对于一些问题，唯一重要的信息是匹配，而不是匹配的数量。</font>
								<font style="vertical-align: inherit;">假设有一些名为table的表
								</font>
							</font><code class="literal">class</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">roster</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">并且分别列出课程课程和班级名单（每个班级注册的学生）中的班级。</font>
								<font style="vertical-align: inherit;">要列出实际注册学生的课程，您可以使用此连接：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT class.class_num，class.class_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自INNER JOIN名单</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE class.class_num = roster.class_num;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									但是，结果会为每个注册的学生列出每个班级一次。</font>
								<font style="vertical-align: inherit;">对于被问到的问题，这是不必要的重复信息。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									假设这</font>
							</font><code class="literal">class_num</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是</font>
							</font><code class="literal">class</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表中</font>
								<font style="vertical-align: inherit;">的主键，</font>
								<font style="vertical-align: inherit;">可以通过使用重复抑制
								</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT
									DISTINCT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，但是先生成所有匹配的行只是为了稍后消除重复，效率很低。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用子查询可以获得相同的无重复结果：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT class_num，class_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从班级</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE class_num IN（SELECT class_num FROM roster）;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在这里，优化器可以识别该
								</font>
							</font><code class="literal">IN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句要求子查询只从</font>
							</font><code class="literal">roster</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表中</font>
								<font style="vertical-align: inherit;">返回每个类号的一个实例
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">在这种情况下，查询可以使用</font>
							</font><span class="firstterm">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">半连接</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> ; </font>
								<font style="vertical-align: inherit;">也就是说，仅返回一个中的每一行的实例的操作
								</font>
							</font><code class="literal">class</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">由按行匹配
								</font>
							</font><code class="literal">roster</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL 8.0.16及更高版本中，</font>
							</font><code class="literal">EXISTS</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">通过将</font>
							</font><code class="literal">EXISTS</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">属于</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件或连接条件的
								</font>
							</font><code class="literal">IN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子</font>
								<font style="vertical-align: inherit;">查询转换为</font>
								<font style="vertical-align: inherit;">子查询
								</font>
								<font style="vertical-align: inherit;">，此策略也可以与</font>
								<font style="vertical-align: inherit;">子查询
								</font>
								<font style="vertical-align: inherit;">一起使用</font>
								<font style="vertical-align: inherit;">，如下所示：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里... EXISTS（SELECT ... FROM ...）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- &gt; WHERE ... 1 IN（SELECT 1 FROM ...）</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在此之后，子查询操作可以作为半连接处理。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									外部查询规范中允许外部联接和内部联接语法，表引用可以是基表，派生表，视图引用或公用表表达式。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL中，子查询必须满足这些条件才能作为半连接处理：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它必须是</font>
											<font style="vertical-align: inherit;">出现在</font>
											<font style="vertical-align: inherit;">or
											</font>
											<font style="vertical-align: inherit;">子句</font>
											<font style="vertical-align: inherit;">顶层</font>
											<font style="vertical-align: inherit;">的</font>
										</font><code class="literal">IN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（或
											</font>
										</font><code class="literal">=ANY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）子查询</font>
											<font style="vertical-align: inherit;">，可能作为</font>
											<font style="vertical-align: inherit;">表达式中</font>
											<font style="vertical-align: inherit;">的术语
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">例如：
											</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;"></font><code class="literal">ON</code>
										<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
										<font style="vertical-align: inherit;"></font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自ot1，......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE（oe1，...）IN（SELECT ie1，... FROM it1，... WHERE ...）;</font></font><font></font>
</pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这里，</font>
											<font style="vertical-align: inherit;">
												和</font>
											<font style="vertical-align: inherit;">
												表示在该查询的外侧和内侧的部分表，和
											</font>
											<font style="vertical-align: inherit;">与
											</font>
											<font style="vertical-align: inherit;">
												表示参照列中的外和内表中的表达式。
											</font>
										</font><code class="literal">ot_<em class="replaceable"><code>i</code></em></code>
										<font style="vertical-align: inherit;"></font><code class="literal">it_<em class="replaceable"><code>i</code></em></code>
										<font style="vertical-align: inherit;"></font><code class="literal">oe_<em class="replaceable"><code>i</code></em></code>
										<font style="vertical-align: inherit;"></font><code class="literal">ie_<em class="replaceable"><code>i</code></em></code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它必须是</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												没有</font>
										</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">结构</font>
											<font style="vertical-align: inherit;">的单一</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它不能包含</font>
										</font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">or
											</font>
										</font><code class="literal">HAVING</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它不能隐式分组（它必须不包含聚合函数）。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它一定不能</font>
										</font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">用
											</font>
										</font><code class="literal">LIMIT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该语句不得</font>
										</font><code class="literal">STRAIGHT_JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在外部查询中</font>
											<font style="vertical-align: inherit;">使用
											</font>
											<font style="vertical-align: inherit;">连接类型。
											</font>
										</font>
									</p><a class="indexterm" name="idm140091707490288"></a>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">STRAIGHT_JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">修改必须不存在。
											</font>
										</font>
									</p><a class="indexterm" name="idm140091707487232"></a>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												外表和内表的数量必须小于连接中允许的最大表数。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									子查询可以是相关的或不相关的。
								</font>
							</font><code class="literal">DISTINCT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是允许的，
								</font>
							</font><code class="literal">LIMIT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">除非</font>
							</font><code class="literal">ORDER BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">也使用。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果子查询符合上述条件，MySQL会将其转换为半连接，并根据这些策略进行基于成本的选择：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												将子查询转换为连接，或使用表pullout并将查询作为子查询表和外部表之间的内部联接运行。</font>
											<font style="vertical-align: inherit;">表pullout将表从子查询拉出到外部查询。
											</font>
										</font>
									</p><a class="indexterm" name="idm140091707480128"></a>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												重复的Weedout：运行半连接，就好像它是一个连接一样，并使用临时表删除重复的记录。
											</font>
										</font>
									</p><a class="indexterm" name="idm140091707477696"></a>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												FirstMatch：当扫描内部表中的行组合并且存在给定值组的多个实例时，选择一个而不是全部返回它们。</font>
											<font style="vertical-align: inherit;">这种“快捷方式”扫描并消除了不必要的行的产生。
											</font>
										</font>
									</p><a class="indexterm" name="idm140091707475104"></a>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												LooseScan：使用索引扫描子查询表，该索引允许从每个子查询的值组中选择单个值。
											</font>
										</font>
									</p><a class="indexterm" name="idm140091707472656"></a>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												将子查询实现为用于执行连接的索引临时表，其中索引用于删除重复项。</font>
											<font style="vertical-align: inherit;">在将临时表与外部表连接时，索引也可能稍后用于查找; </font>
											<font style="vertical-align: inherit;">如果没有，则扫描表格。</font>
											<font style="vertical-align: inherit;">有关实现的更多信息，请参见
											</font>
										</font><a class="xref" href="optimization.html#subquery-materialization" title="8.2.2.2使用实现优化子查询">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.2.2节“使用实现优化子查询”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p><a class="indexterm" name="idm140091707469088"></a>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									可以使用以下</font>
							</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									系统变量标志</font>
								<font style="vertical-align: inherit;">启用或禁用其中每个策略</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">semijoin</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">标志控制是否使用半连接。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果</font>
										</font><code class="literal">semijoin</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">使能，
											</font>
										</font><code class="literal">firstmatch</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">loosescan</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">duplicateweedout</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，和
											</font>
										</font><code class="literal">materialization</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">旗帜能够在允许的半连接策略更精细的控制。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果</font>
										</font><code class="literal">duplicateweedout</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">禁用半连接策略，则除非还禁用所有其他适用策略，否则不会使用该策略。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果</font>
										</font><code class="literal">duplicateweedout</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">禁用，有时优化程序可能会生成远非最佳的查询计划。</font>
											<font style="vertical-align: inherit;">这是由于在贪婪搜索期间进行启发式修剪，这可以通过设置来避免
											</font>
										</font><a class="link" href="server-administration.html#sysvar_optimizer_prune_level"><code class="literal">optimizer_prune_level=0</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									默认情况下启用这些标志。</font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.9.2节“可切换的优化”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化程序最大限度地减少了视图和派生表的处理差异。</font>
								<font style="vertical-align: inherit;">这会影响使用
								</font>
							</font><code class="literal">STRAIGHT_JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">修饰符的</font>
							</font><code class="literal">IN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">查询</font>
								<font style="vertical-align: inherit;">和带有</font>
								<font style="vertical-align: inherit;">可以转换为半连接</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">子查询</font>
								<font style="vertical-align: inherit;">的视图
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">以下查询说明了这一点，因为处理中的更改会导致转换发生更改，从而导致执行策略不同：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建视图与AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IN（选择b</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           来自t2）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT STRAIGHT_JOIN *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM t3 JOIN v ON t3.x = va;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化器首先查看视图并将
								</font>
							</font><code class="literal">IN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子查询转换为半连接，然后检查是否可以将视图合并到外部查询中。</font>
								<font style="vertical-align: inherit;">由于</font>
							</font><code class="literal">STRAIGHT_JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">外部查询中</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">修饰符会阻止半连接，因此优化程序会拒绝合并，从而导致使用实现表进行派生表评估。
								</font>
							</font>
						</p>
						<p>
							<a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> output表示使用半连接策略如下：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于扩展</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												输出，以下</font>
										</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
												WARNINGS</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">显示</font>
											<font style="vertical-align: inherit;">的文本显示
											</font>
											<font style="vertical-align: inherit;">重写的查询，该查询显示半连接结构。</font>
											<font style="vertical-align: inherit;">（参见</font>
										</font><a class="xref" href="optimization.html#explain-extended" title="8.8.3扩展EXPLAIN输出格式">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.8.3节“扩展EXPLAIN输出格式”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。）从中可以了解哪些表从半连接中拉出。</font>
											<font style="vertical-align: inherit;">如果子查询转换为半连接，您将看到子查询谓词已消失，其表和</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句已合并到外部查询连接列表和
											</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句中。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于重复Weedout临时表的使用是由指示
											</font>
										</font><code class="literal">Start temporary</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和</font>
										</font><code class="literal">End
											temporary</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在</font>
										</font><code class="literal">Extra</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												列。</font>
											<font style="vertical-align: inherit;">未被拉出并且在</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">输出行</font>
											<font style="vertical-align: inherit;">范围内的</font>
											<font style="vertical-align: inherit;">表</font>
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">Start temporary</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">并将
											</font>
										</font><code class="literal">End temporary</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">它们
											</font>
										</font><code class="literal">rowid</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">放在临时表中。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">FirstMatch(<em class="replaceable"><code>tbl_name</code></em>)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在</font>
										</font><code class="literal">Extra</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列中表示连接快捷方式。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">LooseScan(<em class="replaceable"><code>m</code></em>..<em class="replaceable"><code>n</code></em>)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在</font>
										</font><code class="literal">Extra</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列中表示使用LooseScan策略。</font>
										</font><em class="replaceable"><code>m</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">并且
											</font>
										</font><em class="replaceable"><code>n</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是关键部件号。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												用于实现的临时表用于</font>
										</font><code class="literal">select_type</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">值为的
											</font>
										</font><code class="literal">MATERIALIZED</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">行和</font>
										</font><code class="literal">table</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">值为的
											</font>
											<font style="vertical-align: inherit;">行
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">&lt;subquery<em class="replaceable"><code>N</code></em>&gt;</code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="subquery-materialization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.2.2使用实现优化子查询</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091707421360"></a><a class="indexterm" name="idm140091707420320"></a><a class="indexterm"
						 name="idm140091707418832"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化程序使用实现来实现更有效的子查询处理。</font>
								<font style="vertical-align: inherit;">实现通过生成子查询结果作为临时表（通常在内存中）来加速查询执行。</font>
								<font style="vertical-align: inherit;">MySQL第一次需要子查询结果时，它会将结果实现为临时表。</font>
								<font style="vertical-align: inherit;">在任何后续需要结果的时候，MySQL再次引用临时表。</font>
								<font style="vertical-align: inherit;">优化器可以使用哈希索引对表进行索引，以使查找快速且廉价。</font>
								<font style="vertical-align: inherit;">索引包含唯一值以消除重复项并使表更小。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									子查询实现在可能的情况下使用内存中的临时表，如果表变得太大，则会回退到磁盘上的存储。</font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="optimization.html#internal-temporary-tables" title="8.4.4 MySQL中的内部临时表使用">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.4.4节“MySQL中的内部临时表使用”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果未使用实现，则优化程序有时会将非相关子查询重写为相关子查询。</font>
								<font style="vertical-align: inherit;">例如，以下</font>
							</font><code class="literal">IN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子查询是不相关的（</font>
							</font><em class="replaceable"><code>where_condition</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									仅涉及列</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和不
								</font>
								<font style="vertical-align: inherit;">包括列</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里t1.a IN（SELECT t2.b FROM t2 WHERE </font></font><em class="replaceable"><code>where_condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化器可能会将其重写为
								</font>
							</font><code class="literal">EXISTS</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">相关子查询：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE EXISTS（从t2 WHERE </font></font><em class="replaceable"><code>where_condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和t1.a = t2.b中</font><font style="vertical-align: inherit;">选择</font><font style="vertical-align: inherit;">t2.b）;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用临时表的子查询实现避免了这种重写，并且可以仅执行一次子查询，而不是每次执行外部查询一次。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于要在MySQL中使用的子查询实现，
								</font>
								<font style="vertical-align: inherit;">必须启用</font>
							</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统变量</font>
							</font><code class="literal">materialization</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">标志。</font>
								<font style="vertical-align: inherit;">（参见</font>
							</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.9.2节，“切换优化”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。随着</font>
							</font><code class="literal">materialization</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">启用的标志，物化适用于子查询任何地方出现谓词（在选择列表中，</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">ON</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">GROUP BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">HAVING</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，或</font>
							</font><code class="literal">ORDER BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">），对于属于任何这些用例谓词：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当没有外部表达式</font>
										</font><em class="replaceable"><code>oe_i</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或内部表达式
											</font>
										</font><em class="replaceable"><code>ie_i</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可为空</font>
											<font style="vertical-align: inherit;">时，谓词具有此形式
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font><em class="replaceable"><code>N</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是1或更大。
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>oe_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>oe_2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...，</font></font><em class="replaceable"><code>oe_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）[NOT] IN（SELECT </font></font><em class="replaceable"><code>ie_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>i_2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>ie_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...）
</font></font></pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当存在单个外部表达式</font>
										</font><em class="replaceable"><code>oe</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和内部表达式</font>
											<font style="vertical-align: inherit;">时，谓词具有此形式</font>
										</font><em class="replaceable"><code>ie</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">表达式可以为空。
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>oe</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[NOT] IN（选择</font></font><em class="replaceable"><code>ie</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...）
</font></font></pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												谓词是</font>
										</font><code class="literal">IN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或者</font>
											<font style="vertical-align: inherit;">
												（</font>
											<font style="vertical-align: inherit;">）</font>
										</font><code class="literal">NOT
											IN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">的结果</font>
											<font style="vertical-align: inherit;">具有与结果相同的含义</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">UNKNOWN</code>
										<font style="vertical-align: inherit;"></font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;"></font><code class="literal">FALSE</code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下示例说明了等效性</font>
							</font><code class="literal">UNKNOWN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">FALSE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">谓词式评估</font>
								<font style="vertical-align: inherit;">的要求如何</font>
								<font style="vertical-align: inherit;">影响是否可以使用子查询实现。</font>
								<font style="vertical-align: inherit;">假设
								</font>
							</font><em class="replaceable"><code>where_condition</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">只涉及列</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">而不是</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									子查询是不相关的。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									此查询取决于具体化：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里t1.a IN（SELECT t2.b FROM t2 WHERE </font></font><em class="replaceable"><code>where_condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在这里，没有关系是否</font>
							</font><code class="literal">IN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									断言返回</font>
							</font><code class="literal">UNKNOWN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或
								</font>
							</font><code class="literal">FALSE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">无论哪种方式，</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">查询结果中都不包含</font>
								<font style="vertical-align: inherit;">行
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									不使用子查询实现的示例是以下查询，其中</font>
							</font><code class="literal">t2.b</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是可为空的列：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE（t1.a，t1.b）NOT IN（SELECT t2.a，t2.b FROM t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          在哪里</font></font><em class="replaceable"><code>where_condition</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下限制适用于子查询实现的使用：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												内表达式和外表达式的类型必须匹配。</font>
											<font style="vertical-align: inherit;">例如，如果两个表达式都是整数或两者都是十进制，则优化器可能能够使用实现，但如果一个表达式是整数而另一个表达式是十进制则不能。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												内在表达不能是一个
											</font>
										</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">with查询可以指示优化程序是否使用子查询实现：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												与不使用实现的查询执行相比，</font>
										</font><code class="literal">select_type</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可能会更改</font>
										</font><code class="literal">DEPENDENT SUBQUERY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">为
											</font>
										</font><code class="literal">SUBQUERY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">这表明，对于每个外行将执行一次的子查询，实现使子查询只执行一次。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于扩展</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												输出，以下显示的文本
											</font>
										</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
												WARNINGS</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">包括
											</font>
										</font><code class="literal">materialize</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><code class="literal">materialized-subquery</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="subquery-optimization-with-exists"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.2.3使用EXISTS策略优化子查询</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091707358176"></a><a class="indexterm" name="idm140091707356688"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									某些优化适用于使用</font>
							</font><code class="literal">IN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">（或</font>
							</font><code class="literal">=ANY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）运算符测试子查询结果的比较。</font>
								<font style="vertical-align: inherit;">本节讨论这些优化，特别是关于</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">价值所带来</font>
								<font style="vertical-align: inherit;">的挑战</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">讨论的最后部分建议您如何帮助优化器。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									考虑以下子查询比较：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从...中</font><font style="vertical-align: inherit;">选择</font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL的评估查询</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">从外到内。</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									也就是说，它首先获取外部表达式的值
								</font>
							</font><em class="replaceable"><code>outer_expr</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，然后运行子查询并捕获它生成的行。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									一个非常有用的优化是</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">通知</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子查询，只有感兴趣的行是内部表达式</font>
							</font><em class="replaceable"><code>inner_expr</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">相等的行</font>
							</font><em class="replaceable"><code>outer_expr</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">这是通过将适当的相等性下推到子查询的
								</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句中来实现的，以使其更具限制性。</font>
								<font style="vertical-align: inherit;">转换后的比较如下所示：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（选择1来自...在哪里</font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									转换后，MySQL可以使用下推的相等性来限制它必须检查以评估子查询的行数。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									更一般地，</font>
							</font><em class="replaceable"><code>N</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									值与返回</font>
							</font><em class="replaceable"><code>N</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">-value行</font>
								<font style="vertical-align: inherit;">的子查询
								</font>
								<font style="vertical-align: inherit;">的比较</font>
								<font style="vertical-align: inherit;">受到相同的转换。</font>
								<font style="vertical-align: inherit;">如果</font>
							</font><em class="replaceable"><code>oe_i</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">并
								</font>
							</font><em class="replaceable"><code>ie_i</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表示相应的外部和内部表达式值，则此子查询比较：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>oe_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>oe_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）IN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （SELECT </font></font><em class="replaceable"><code>ie_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>ie_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									变为：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（选择1来自...在哪里</font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          和</font></font><em class="replaceable"><code>oe_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font><em class="replaceable"><code>ie_1</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          和......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          AND </font></font><em class="replaceable"><code>oe_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>ie_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									为简单起见，以下讨论假设一对外部和内部表达值。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									刚刚描述的转换有其局限性。</font>
								<font style="vertical-align: inherit;">仅当我们忽略可能的</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值时</font>
								<font style="vertical-align: inherit;">它才有效</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">也就是说，</font>
								<font style="vertical-align: inherit;">只要这两个条件都成立</font>
								<font style="vertical-align: inherit;">，</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">下推</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">策略就会起作用：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<em class="replaceable"><code>outer_expr</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">而且
											</font>
										</font><em class="replaceable"><code>inner_expr</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">不可能
											</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												你不必区分</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">从
											</font>
										</font><code class="literal">FALSE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子查询结果。</font>
											<font style="vertical-align: inherit;">如果子查询是</font>
											<font style="vertical-align: inherit;">子句中的</font>
											<font style="vertical-align: inherit;">表达式</font>
										</font><a class="link" href="functions.html#operator_or"><code class="literal">OR</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表达式
											</font>
											<font style="vertical-align: inherit;">的一部分</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，则MySQL假定您不关心。</font>
											<font style="vertical-align: inherit;">优化器注意到</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">并且</font>
										</font><code class="literal">FALSE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												子查询结果无需区分的</font>
											<font style="vertical-align: inherit;">另一个实例</font>
											<font style="vertical-align: inherit;">是此构造：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">......在哪里</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>subquery</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在这种情况下，该</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">条款拒绝该行是否</font>
											<font style="vertical-align: inherit;">回报
											</font>
											<font style="vertical-align: inherit;">或</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">IN
											(<em class="replaceable"><code>subquery</code></em>)</code>
										<font style="vertical-align: inherit;"></font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;"></font><code class="literal">FALSE</code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当这些条件中的任何一个或两个都不成立时，优化就更复杂了。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									假设</font>
							</font><em class="replaceable"><code>outer_expr</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">已知它是非</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值，但子查询不会产生一个行
								</font>
							</font><em class="replaceable"><code>outer_expr</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">=
								</font>
							</font><em class="replaceable"><code>inner_expr</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">然后
								</font>
							</font><code class="literal"><em class="replaceable"><code>outer_expr</code></em> IN (SELECT
								...)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">评估如下：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">中，如果
											</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">产生任何行，其中</font>
										</font><em class="replaceable"><code>inner_expr</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是
											</font>
										</font><code class="literal">NULL</code>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">FALSE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，如果
											</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">只产生非</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">值或什么都不产生
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在这种情况下，查找行的方法
								</font>
								<font style="vertical-align: inherit;">不再有效。</font>
								<font style="vertical-align: inherit;">有必要找这样的行，但如果没有找到，还找行，其中
								</font>
								<font style="vertical-align: inherit;">是
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">粗略地说，子查询可以转换为这样的东西：
								</font>
							</font><code class="literal"><em class="replaceable"><code>outer_expr</code></em> =
								<em class="replaceable"><code>inner_expr</code></em></code>
							<font style="vertical-align: inherit;"></font><em class="replaceable"><code>inner_expr</code></em>
							<font style="vertical-align: inherit;"></font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;"></font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（选择1来自...在哪里</font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR为</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空））
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									需要评估额外</font>
							</font><a class="link" href="functions.html#operator_is-null"><code class="literal">IS
									NULL</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件是MySQL具有
								</font>
							</font><a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">访问方法的原因：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN</code></strong>
       <strong class="userinput"><code>SELECT <em class="replaceable"><code>outer_expr</code></em> IN (SELECT t2.maybe_null_key</code></strong>
                             <strong class="userinput"><code>FROM t2, t3 WHERE ...)</code></strong>
       <strong class="userinput"><code>FROM t1;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：PRIMARY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2.排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：DEPENDENT SUBQUERY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         type：ref_or_null</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：maybe_null_key</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          key：maybe_null_key</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：func</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用在哪里; </font><font style="vertical-align: inherit;">使用索引</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在</font>
							</font><a class="link" href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="optimization.html#jointype_index_subquery"><code class="literal">index_subquery</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									子查询，具体的访问方法也有</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或
										</font>
									</font><code class="literal">NULL</code>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">变体。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									附加</font>
							</font><code class="literal">OR ... IS NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条件使得查询执行稍微复杂一些（并且子查询中的一些优化变得不适用），但通常这是可以容忍的。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									的情况更糟糕的时候
								</font>
							</font><em class="replaceable"><code>outer_expr</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可能
								</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">根据SQL解释</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">为</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">未知值</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”，</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">应评估为：
								</font>
							</font><code class="literal">NULL IN (SELECT <em class="replaceable"><code>inner_expr</code></em>
								...)</code>
							<font style="vertical-align: inherit;"></font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，如果
											</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">产生任何行
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">FALSE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，如果
											</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">没有产生任何行
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									为了进行适当的评估，必须能够检查是否</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">产生了任何行，因此
								</font>
								<font style="vertical-align: inherit;">不能将其下推到子查询中。</font>
								<font style="vertical-align: inherit;">这是一个问题，因为除非可以推迟相等，否则许多真实世界的子查询变得非常慢。
								</font>
							</font><code class="literal"><em class="replaceable"><code>outer_expr</code></em> =
								<em class="replaceable"><code>inner_expr</code></em></code>
							<font style="vertical-align: inherit;"></font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									从本质上讲，必须有不同的方法来执行子查询，具体取决于
								</font>
							</font><em class="replaceable"><code>outer_expr</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化选择超速SQL合规性，所以它占的可能性
								</font>
							</font><em class="replaceable"><code>outer_expr</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可能是
								</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果</font>
										</font><em class="replaceable"><code>outer_expr</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是
											</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，要评估以下表达式，有必要执行
											</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">以确定它是否产生任何行：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL IN（SELECT </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												有必要在</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">这里</font>
											<font style="vertical-align: inherit;">执行原件
											</font>
											<font style="vertical-align: inherit;">，没有任何前面提到的那种下推等式。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												另一方面，当</font>
										</font><em class="replaceable"><code>outer_expr</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">不是
											</font>
											<font style="vertical-align: inherit;">时
											</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，这个比较是绝对必要的：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从...中</font><font style="vertical-align: inherit;">选择</font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												转换为使用下推条件的表达式：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（选择1来自...在哪里</font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果没有这种转换，子查询将会很慢。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									为了解决是否将条件压入子查询的困境，条件包含在
								</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">触发器</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">函数中。</font>
								<font style="vertical-align: inherit;">因此，表达式如下：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从...中</font><font style="vertical-align: inherit;">选择</font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									被转换成：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（SELECT 1 FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          和trigcond（</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">））
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									更一般地说，如果子查询比较基于几对外部和内部表达式，则转换采用此比较：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>oe_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>oe_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）IN（SELECT </font></font><em class="replaceable"><code>ie_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，...，</font></font><em class="replaceable"><code>ie_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									并将其转换为此表达式：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（SELECT 1 FROM ... WHERE </font></font><em class="replaceable"><code>subquery_where</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          和trigcond（</font></font><em class="replaceable"><code>oe_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>ie_1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          和......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          AND trigcond（</font></font><em class="replaceable"><code>oe_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>ie_N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       ）</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									每个</font>
								<font style="vertical-align: inherit;">
									都是一个特殊函数，其值为：
								</font>
							</font><code class="literal">trigcond(<em class="replaceable"><code>X</code></em>)</code>
							<font style="vertical-align: inherit;"></font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<em class="replaceable"><code>X</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">当
											</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">“ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">链接</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;"> ”的</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">外表达
											</font>
										</font><em class="replaceable"><code>oe_i</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">不是
											</font>
										</font><code class="literal">NULL</code>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">TRUE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">当</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">“ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">链接</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;"> ”的</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												外表达</font>
										</font><em class="replaceable"><code>oe_i</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是
											</font>
										</font><code class="literal">NULL</code>
									</p>
								</li>
							</ul>
						</div>
						<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
							<div class="admon-title">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										注意
									</font>
								</font>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										触发器函数</font>
								</font><span class="emphasis"><em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">不是</font>
										</font>
									</em></span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">您创建的类型的触发器</font>
								</font><a class="link" href="sql-syntax.html#create-trigger" title="13.1.22 CREATE TRIGGER语法"><code class="literal">CREATE
										TRIGGER</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									包含在</font>
							</font><code class="literal">trigcond()</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">函数</font>
								<font style="vertical-align: inherit;">内的等式
								</font>
								<font style="vertical-align: inherit;">不是查询优化器的第一类谓词。</font>
								<font style="vertical-align: inherit;">大多数优化都无法处理可能在查询执行时打开和关闭的谓词，因此他们认为任何
								</font>
								<font style="vertical-align: inherit;">未知函数都会被忽略。</font>
								<font style="vertical-align: inherit;">这些优化可以使用触发的等式：
								</font>
							</font><code class="literal">trigcond(<em class="replaceable"><code>X</code></em>)</code>
							<font style="vertical-align: inherit;"></font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												参考优化：
											</font>
											<font style="vertical-align: inherit;">可用于构建
											</font>
											<font style="vertical-align: inherit;">，
											</font>
											<font style="vertical-align: inherit;">或
											</font>
											<font style="vertical-align: inherit;">表访问。
											</font>
										</font><code class="literal">trigcond(<em class="replaceable"><code>X</code></em>=<em class="replaceable"><code>Y</code></em>
											[OR <em class="replaceable"><code>Y</code></em> IS NULL])</code>
										<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#jointype_ref"><code
											 class="literal">ref</code></a>
										<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#jointype_eq_ref"><code
											 class="literal">eq_ref</code></a>
										<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#jointype_ref_or_null"><code
											 class="literal">ref_or_null</code></a>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												基于索引查找的子查询执行引擎：
											</font>
											<font style="vertical-align: inherit;">
												可用于构造
											</font>
											<font style="vertical-align: inherit;">或
											</font>
											<font style="vertical-align: inherit;">
												访问。
											</font>
										</font><code class="literal">trigcond(<em class="replaceable"><code>X</code></em>=<em class="replaceable"><code>Y</code></em>)</code>
										<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#jointype_unique_subquery"><code
											 class="literal">unique_subquery</code></a>
										<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#jointype_index_subquery"><code
											 class="literal">index_subquery</code></a>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表条件生成器：如果子查询是多个表的连接，则会尽快检查触发条件。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当优化器使用触发条件创建某种基于索引查找的访问时（如前面列表的前两项），它必须具有关闭条件时的情况的回退策略。</font>
								<font style="vertical-align: inherit;">此回退策略始终相同：执行全表扫描。</font>
								<font style="vertical-align: inherit;">在
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">输出中，回退显示</font>
							</font><code class="literal">Full scan on NULL key</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在
								</font>
							</font><code class="literal">Extra</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列中：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT t1.col1,</code></strong>
       <strong class="userinput"><code>t1.col1 IN (SELECT t2.key1 FROM t2 WHERE t2.col2=t1.col2) FROM t1\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：PRIMARY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2.排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：DEPENDENT SUBQUERY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         type：index_subquery</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：key1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          key：key1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：func</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用在哪里; </font><font style="vertical-align: inherit;">全键扫描NULL键</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果您运行</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">后跟
								</font>
							</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
									WARNINGS</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，则可以看到触发条件：
								</font>
							</font>
						</p>
						<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  等级：注意</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   代码：1003</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消息：选择`test` .t1` .col1` AS`col1`，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         &lt;in_optimizer&gt;（`test`.`t1`.`col1`，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         t2中的&lt;exists&gt;（&lt;index_lookup&gt;（&lt;cache&gt;（`test` .t1` .col1`）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         在key1上检查NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         其中（`test`.`t2`.`col2` =`test`.`t1`.`col2`），其具有</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         trigcond（&lt;is_not_null_test&gt;（`test` .t2` .key1`）））））AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         `t1.col1 IN（从t2选择t2.key1，其中t2.col2 = t1.col2）`</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         来自`test``t1`</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									触发条件的使用具有一些性能影响。</font>
								<font style="vertical-align: inherit;">甲</font>
							</font><code class="literal">NULL IN (SELECT ...)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									现在表达可能会导致全表扫描（这是慢）时，它以前没有。</font>
								<font style="vertical-align: inherit;">这是为正确结果支付的价格（触发条件策略的目标是提高合规性，而不是速度）。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于多表子查询，执行</font>
							</font><code class="literal">NULL IN
								(SELECT ...)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">速度特别慢，因为连接优化器不会针对外部表达式进行优化</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">它假设</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">左侧的</font>
								<font style="vertical-align: inherit;">子查询评估</font>
								<font style="vertical-align: inherit;">非常罕见，即使有统计数据表明不是这样。</font>
								<font style="vertical-align: inherit;">另一方面，如果外部表达式可能
								</font>
							</font><code class="literal">NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">但实际上从未实际存在，则不存在性能损失。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									为了帮助查询优化器更好地执行查询，请使用以下建议：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												声明一个列就像</font>
										</font><code class="literal">NOT NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">它确实一样。</font>
											<font style="vertical-align: inherit;">通过简化列的条件测试，这也有助于优化器的其他方面。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果您不需要区分</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">来自
											</font>
										</font><code class="literal">FALSE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子查询的结果，你可以很容易地避免慢的执行路径。</font>
											<font style="vertical-align: inherit;">替换看起来像这样的比较：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从...中</font><font style="vertical-align: inherit;">选择</font><font style="vertical-align: inherit;">）
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												用这个表达式：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IS NOT NULL）AND（</font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（SELECT </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM ...））
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												然后</font>
										</font><code class="literal">NULL IN (SELECT ...)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">永远不会被评估，因为</font>
										</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">一旦表达式结果清楚，</font>
											<font style="vertical-align: inherit;">MySQL就会停止评估
											</font>
											<font style="vertical-align: inherit;">部分。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												另一种可能的重写：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXISTS（</font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从...中</font><font style="vertical-align: inherit;">选择）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        WHERE </font></font><em class="replaceable"><code>inner_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>outer_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当你需要分不清这将适用于
											</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">从</font>
										</font><code class="literal">FALSE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												子查询结果，在这种情况下，你可能真的想
											</font>
										</font><code class="literal">EXISTS</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在</font>
							</font><code class="literal">subquery_materialization_cost_based</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									所述的标志</font>
							</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									系统变量使得能够在子查询物化和之间的选择控制
								</font>
							</font><code class="literal">IN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">-到- </font>
							</font><code class="literal">EXISTS</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子查询变换。</font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.9.2节“可切换的优化”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="derived-table-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.2.4使用合并或实现优化派生表，视图引用和公用表表达式</font>
										</font>
									</h4>
								</div>
							</div>
						</div>
						<a class="indexterm" name="idm140091707175872"></a><a class="indexterm" name="idm140091707174384"></a><a class="indexterm"
						 name="idm140091707172896"></a><a class="indexterm" name="idm140091707171440"></a><a class="indexterm" name="idm140091707169952"></a><a
						 class="indexterm" name="idm140091707168464"></a><a class="indexterm" name="idm140091707166960"></a><a class="indexterm"
						 name="idm140091707165472"></a><a class="indexterm" name="idm140091707163984"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化器可以使用两种策略（也适用于视图引用和公用表表达式）处理派生表引用：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												将派生表合并到外部查询块中
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												将派生表实现为内部临时表
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									例1：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM（SELECT * FROM t1）AS derived_t1;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									通过合并派生表
								</font>
							</font><code class="literal">derived_t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，该查询的执行类似于：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									例2：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM t1 JOIN（SELECT t2.f1 FROM t2）AS derived_t2 ON t1.f2 = derived_t2.f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t1.f1&gt; 0;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									通过合并派生表
								</font>
							</font><code class="literal">derived_t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，该查询的执行类似于：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT t1。*，t2.f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM t1 JOIN t2 ON t1.f2 = t2.f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t1.f1&gt; 0;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									具有实现，</font>
							</font><code class="literal">derived_t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">并
								</font>
							</font><code class="literal">derived_t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在每个查询中被视为单独的表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化器以相同的方式处理派生表，视图引用和公用表表达式：它尽可能避免不必要的实现，这样可以将条件从外部查询推送到派生表，并生成更高效的执行计划。</font>
								<font style="vertical-align: inherit;">（有关示例，请参见
								</font>
							</font><a class="xref" href="optimization.html#subquery-materialization" title="8.2.2.2使用实现优化子查询">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.2.2.2节“使用实现优化子查询”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。）
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果合并将导致外部查询块引用超过61个基表，则优化程序将选择实现。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">ORDER BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">如果这些条件都为真</font>
								<font style="vertical-align: inherit;">
									，则优化器将</font>
								<font style="vertical-align: inherit;">派生表或视图引用中</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">子句</font>
								<font style="vertical-align: inherit;">传播</font>
								<font style="vertical-align: inherit;">到外部查询块：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												外部查询未分组或聚合。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												外部查询不指定
											</font>
										</font><code class="literal">DISTINCT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">HAVING</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												外部查询将此派生表或视图引用作为</font>
										</font><code class="literal">FROM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句中</font>
											<font style="vertical-align: inherit;">的唯一源</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									否则，优化器会忽略该</font>
							</font><code class="literal">ORDER
								BY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下方法可用于影响优化程序是否尝试将派生表，视图引用和公用表表达式合并到外部查询块中：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">MERGE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">NO_MERGE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">优化器提示可以使用。</font>
											<font style="vertical-align: inherit;">假设没有其他规则阻止合并，它们适用。</font>
											<font style="vertical-align: inherit;">请参见</font>
										</font><a class="xref" href="optimization.html#optimizer-hints" title="8.9.3优化器提示">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.9.3节“优化程序提示”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												同样，您可以使用</font>
											<font style="vertical-align: inherit;">系统变量</font>
											<font style="vertical-align: inherit;">的
											</font>
										</font><code class="literal">derived_merge</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">标志
											</font>
										</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">请参见</font>
										</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.9.2节“可切换的优化”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">默认情况下，启用该标志以允许合并。</font>
											<font style="vertical-align: inherit;">禁用该标志可防止合并并避免
											</font>
										</font><a class="link" href="error-handling.html#error_er_update_table_used"><code class="literal">ER_UPDATE_TABLE_USED</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												错误。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">derived_merge</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">标志也适用于不包含</font>
										</font><code class="literal">ALGORITHM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句的</font>
											<font style="vertical-align: inherit;">视图</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">因此，如果
											</font>
										</font><a class="link" href="error-handling.html#error_er_update_table_used"><code class="literal">ER_UPDATE_TABLE_USED</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">使用等效于子查询的表达式的视图引用发生错误，则添加
											</font>
										</font><code class="literal">ALGORITHM=TEMPTABLE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">到视图定义会阻止合并并优先于该
											</font>
										</font><code class="literal">derived_merge</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">值。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												可以通过在子查询中使用任何阻止合并的构造来禁用合并，尽管这些构造对实现的影响并不明确。</font>
											<font style="vertical-align: inherit;">对于派生表，公用表表达式和视图引用，阻止合并的构造是相同的：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<a class="indexterm" name="idm140091707123744"></a><a class="indexterm" name="idm140091707122288"></a>
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															聚集函数或窗函数（</font>
													</font><a class="link" href="functions.html#function_sum"><code class="literal">SUM()</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，
														</font>
													</font><a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，
														</font>
													</font><a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，
														</font>
													</font><a class="link" href="functions.html#function_count"><code class="literal">COUNT()</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，等等）
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<code class="literal">DISTINCT</code>
												</p>
											</li>
											<li class="listitem">
												<p>
													<code class="literal">GROUP BY</code>
												</p>
											</li>
											<li class="listitem">
												<p>
													<code class="literal">HAVING</code>
												</p>
											</li>
											<li class="listitem">
												<p>
													<code class="literal">LIMIT</code>
												</p>
											</li>
											<li class="listitem">
												<p>
													<a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;"> 要么
														</font>
													</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION
															ALL</code></a>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															选择列表中的子查询
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															分配给用户变量
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															仅引用文字值（在这种情况下，没有基础表）
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果优化器选择实现策略而不是合并派生表，它将按如下方式处理查询：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												优化器推迟派生表实现，直到在查询执行期间需要其内容。</font>
											<font style="vertical-align: inherit;">这提高了性能，因为延迟实现可能导致根本不必执行此操作。</font>
											<font style="vertical-align: inherit;">考虑将派生表的结果连接到另一个表的查询：如果优化器首先处理该另一个表并发现它不返回任何行，则不需要进一步执行连接，并且优化器可以完全跳过实现派生表的实现。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在查询执行期间，优化器可以向派生表添加索引以加速从中检索行。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code
								 class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">包含派生表</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">查询，</font>
								<font style="vertical-align: inherit;">
									请考虑以下</font>
								<font style="vertical-align: inherit;">语句</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN SELECT * FROM（SELECT * FROM t1）AS derived_t1;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化程序通过延迟派生表来避免实现派生表，直到</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">执行</font>
								<font style="vertical-align: inherit;">期间需要结果为止
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">在这种情况下，不执行查询（因为它出现在
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句中），因此永远不需要结果。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									即使对于执行的查询，派生表实现的延迟也可能使优化器完全避免实现。</font>
								<font style="vertical-align: inherit;">发生这种情况时，执行实现所需的时间会更快地执行查询。</font>
								<font style="vertical-align: inherit;">请考虑以下查询，该查询将派生表的结果连接到另一个表：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM t1 JOIN（SELECT t2.f1 FROM t2）AS derived_t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ON t1.f2 = derived_t2.f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t1.f1&gt; 0;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果优化进程</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">首先并且</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句产生空结果，则连接必须为空并且不需要实现派生表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于派生表需要实现的情况，优化器可以向实现表添加索引以加速对其的访问。</font>
								<font style="vertical-align: inherit;">如果这样的索引允许
								</font>
							</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">访问表，则可以大大减少查询执行期间读取的数据量。</font>
								<font style="vertical-align: inherit;">请考虑以下查询：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 *</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 FROM t1 JOIN（SELECT DISTINCT f1 FROM t2）AS derived_t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         ON t1.f1 = derived_t2.f1;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化器在列上构造索引
								</font>
							</font><code class="literal">f1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">derived_t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">如果这样做将允许使用</font>
							</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">最低成本执行计划</font>
								<font style="vertical-align: inherit;">的
								</font>
								<font style="vertical-align: inherit;">访问。</font>
								<font style="vertical-align: inherit;">添加索引后，优化程序可以将具体化派生表视为具有索引的常规表，并且与生成的索引类似。</font>
								<font style="vertical-align: inherit;">与没有索引的查询执行成本相比，索引创建的开销可以忽略不计。</font>
								<font style="vertical-align: inherit;">如果
								</font>
							</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">访问会导致比其他访问方法更高的成本，则优化程序不会创建任何索引并且不会丢失任何内容。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于优化程序跟踪输出，合并的派生表或视图引用不会显示为节点。</font>
								<font style="vertical-align: inherit;">只有其基础表出现在顶部查询的计划中。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于公用表表达式（CTE），派生表的具体化也是如此。</font>
								<font style="vertical-align: inherit;">此外，以下考虑因素特别适用于CTE。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果CTE由查询实现，则查询将实现一次，即使查询多次引用它。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									递归CTE始终具体化。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果CTE具体化，优化器会自动添加相关索引，如果它估计索引将加速顶级语句对CTE的访问。</font>
								<font style="vertical-align: inherit;">这类似于派生表的自动索引，除了如果多次引用CTE，优化器可以创建多个索引，以最合适的方式加速每个引用的访问。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									的</font>
							</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">MERGE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">NO_MERGE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">优化器提示可以应用到的CTE。</font>
								<font style="vertical-align: inherit;">顶级语句中的每个CTE引用都可以有自己的提示，允许选择性地合并或实现CTE引用。</font>
								<font style="vertical-align: inherit;">以下语句使用提示来指示</font>
							</font><code class="literal">cte1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">应合并并</font>
							</font><code class="literal">cte2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">应实现：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WITH</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  cte1 AS（SELECT a，b FROM table1），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  cte2 AS（SELECT c，d FROM table2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + MERGE（cte1）NO_MERGE（cte2）* / cte1.b，cte2.d</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从cte1加入cte2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE cte1.a = cte2.c;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在</font>
							</font><code class="literal">ALGORITHM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">对条款
								</font>
							</font><a class="link" href="sql-syntax.html#create-view" title="13.1.23创建视图语法"><code class="literal">CREATE
									VIEW</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">没有任何影响物化</font>
							</font><a class="link" href="sql-syntax.html#with" title="13.2.13 WITH语法（公用表表达式）"><code class="literal">WITH</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									前款</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									视图定义语句。</font>
								<font style="vertical-align: inherit;">请考虑以下声明：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE ALGORITHM = {TEMPTABLE | MERGE}查看v1 AS ... ...选择...
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><code class="literal">ALGORITHM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值仅影响而</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">不是
								</font>
							</font><a class="link" href="sql-syntax.html#with" title="13.2.13 WITH语法（公用表表达式）"><code class="literal">WITH</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句的实现。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL 8.0.16之前，如果
								</font>
							</font><a class="link" href="server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine=MYISAM</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">使用磁盘上临时表实现CTE的任何尝试都发生错误，因为对于CTE，用于磁盘内部临时表的存储引擎不可能
								</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">从MySQL 8.0.16开始，这不再是一个问题，因为</font>
							</font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">现在总是</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">用于磁盘内部临时表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如前所述，CTE如果具体化，即使多次引用，也会实现一次。</font>
								<font style="vertical-align: inherit;">要指示一次性实现，优化程序跟踪输出包含
								</font>
							</font><code class="literal">creating_tmp_table</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">一次或多次出现的事件</font>
							</font><code class="literal">reusing_tmp_table</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									CTE与派生表类似，
								</font>
							</font><code class="literal">materialized_from_subquery</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">节点遵循引用。</font>
								<font style="vertical-align: inherit;">这对于多次引用的CTE来说是正确的，因此不存在重复的
								</font>
							</font><code class="literal">materialized_from_subquery</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">节点（这会给人一种子查询多次执行的印象，并产生不必要的详细输出）。</font>
								<font style="vertical-align: inherit;">只有一个对CTE的引用有一个完整的
								</font>
							</font><code class="literal">materialized_from_subquery</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">节点，其中包含子查询计划的描述。</font>
								<font style="vertical-align: inherit;">其他引用具有减少的</font>
							</font><code class="literal">materialized_from_subquery</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">节点。</font>
								<font style="vertical-align: inherit;">同样的想法适用
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">于</font>
							</font><code class="literal">TRADITIONAL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">格式</font>
								<font style="vertical-align: inherit;">输出
								</font>
								<font style="vertical-align: inherit;">：未显示其他引用的子查询。
								</font>
							</font>
						</p>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="information-schema-optimization"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.3优化INFORMATION_SCHEMA查询</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091707048624"></a><a class="indexterm" name="idm140091707047120"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								监视数据库的应用程序可能会频繁使用
							</font>
						</font><code class="literal">INFORMATION_SCHEMA</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表。</font>
							<font style="vertical-align: inherit;">要最有效地为这些表编写查询，请使用以下一般准则：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											尝试仅查询</font>
									</font><code class="literal">INFORMATION_SCHEMA</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											作为数据字典表的视图的表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											尝试仅查询静态元数据。</font>
										<font style="vertical-align: inherit;">选择列或使用动态元数据的检索条件以及静态元数据会增加处理动态元数据的开销。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
						<div class="admon-title">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									注意
								</font>
							</font>
						</div>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">INFORMATION_SCHEMA</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">查询中</font>
								<font style="vertical-align: inherit;">
									数据库和表名的比较行为
								</font>
								<font style="vertical-align: inherit;">可能与您的预期不同。</font>
								<font style="vertical-align: inherit;">有关详细信息，请参见
								</font>
							</font><a class="xref" href="charset.html#charset-collation-information-schema" title="10.8.7在INFORMATION_SCHEMA搜索中使用排序规则">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第10.8.7节“在INFORMATION_SCHEMA搜索中使用排序规则”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								这些</font>
						</font><code class="literal">INFORMATION_SCHEMA</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表实现为数据字典表的视图，因此对它们的查询从数据字典中检索信息：
							</font>
						</font>
					</p>
					<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHARACTER_SETS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CHECK_CONSTRAINTS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
COLLATIONS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
COLLATION_CHARACTER_SET_APPLICABILITY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
列</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
活动</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FILES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INNODB_COLUMNS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INNODB_DATAFILES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INNODB_FIELDS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INNODB_FOREIGN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INNODB_FOREIGN_COLS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INNODB_INDEXES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INNODB_TABLES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INNODB_TABLESPACES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INNODB_TABLESPACES_BRIEF</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INNODB_TABLESTATS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KEY_COLUMN_USAGE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
参数</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PARTITIONS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
REFERENTIAL_CONSTRAINTS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RESOURCE_GROUPS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例程</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SCHEMATA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
统计</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLE_CONSTRAINTS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TRIGGERS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VIEWS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VIEW_ROUTINE_USAGE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VIEW_TABLE_USAGE</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								某些类型的值（即使对于非视图
							</font>
						</font><code class="literal">INFORMATION_SCHEMA</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表）也可以通过数据字典中的查找来检索。</font>
							<font style="vertical-align: inherit;">这包括诸如数据库和表名，表类型和存储引擎之类的值。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								某些</font>
						</font><code class="literal">INFORMATION_SCHEMA</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表包含提供表统计信息的列：
							</font>
						</font>
					</p>
					<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STATISTICS.CARDINALITY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES.AUTO_INCREMENT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES.AVG_ROW_LENGTH</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES.CHECKSUM</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES.CHECK_TIME</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES.CREATE_TIME</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES.DATA_FREE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES.DATA_LENGTH</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES.INDEX_LENGTH</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES.MAX_DATA_LENGTH</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES.TABLE_ROWS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TABLES.UPDATE_TIME</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								这些列表示动态表元数据; </font>
							<font style="vertical-align: inherit;">也就是说，随着表格内容的变化而变化的信息。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								默认情况下，MySQL的检索从这些列的缓存值</font>
						</font><code class="literal">mysql.index_stats</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><code class="literal">mysql.table_stats</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">这比直接从存储引擎检索统计数据更有效，当列查询字典表。</font>
							<font style="vertical-align: inherit;">如果缓存的统计信息不可用或已过期，MySQL将从存储引擎中检索最新的统计信息，并将它们缓存在</font>
						</font><code class="literal">mysql.index_stats</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><code class="literal">mysql.table_stats</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">字典表中。</font>
							<font style="vertical-align: inherit;">后续查询将检索缓存的统计信息，直到缓存的统计信息过期。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该
							</font>
						</font><a class="link" href="server-administration.html#sysvar_information_schema_stats_expiry"><code class="literal">information_schema_stats_expiry</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								会话变量定义的时间段之前缓存统计到期。</font>
							<font style="vertical-align: inherit;">默认值为86400秒（24小时），但时间段可以延长至一年。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要随时更新给定表的缓存值，请使用
							</font>
						</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在这些情况下，</font>
							<font style="vertical-align: inherit;">
								查询统计信息列不会在</font>
						</font><code class="literal">mysql.index_stats</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><code class="literal">mysql.table_stats</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">字典表中</font>
							<font style="vertical-align: inherit;">存储或更新统计信息</font>
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											缓存的统计信息尚未过期。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											何时
										</font>
									</font><a class="link" href="server-administration.html#sysvar_information_schema_stats_expiry"><code class="literal">information_schema_stats_expiry</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											设置为0。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当服务器开始
										</font>
									</font><a class="link" href="server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="server-administration.html#sysvar_super_read_only"><code class="literal">super_read_only</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="server-administration.html#sysvar_transaction_read_only"><code class="literal">transaction_read_only</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，或
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">innodb_read_only</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">模式。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当查询还提取性能架构数据时。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<a class="link" href="server-administration.html#sysvar_information_schema_stats_expiry"><code class="literal">information_schema_stats_expiry</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								是一个会话变量，每个客户端会话可以定义自己的到期值。</font>
							<font style="vertical-align: inherit;">从存储引擎检索并由一个会话缓存的统计信息可供其他会话使用。
							</font>
						</font>
					</p>
					<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

						<div class="admon-title">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									注意
								</font>
							</font>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果</font>
							</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_only"><code class="literal">innodb_read_only</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									启用</font>
								<font style="vertical-align: inherit;">了</font>
								<font style="vertical-align: inherit;">系统变量，则</font>
							</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
									TABLE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可能会失败，因为它无法更新数据字典中使用的统计表
								</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">对于</font>
							</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
									TABLE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">更新密钥分发的操作，即使操作更新表本身（例如，如果它是</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表）</font>
								<font style="vertical-align: inherit;">，也可能发生故障</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">要获取更新的分布统计信息，请设置
								</font>
							</font><a class="link" href="server-administration.html#sysvar_information_schema_stats_expiry"><code class="literal">information_schema_stats_expiry=0</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于</font>
						</font><code class="literal">INFORMATION_SCHEMA</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">作为数据字典表视图实现的表，基础数据字典表上的索引允许优化器构建有效的查询执行计划。</font>
							<font style="vertical-align: inherit;">要查看优化程序所做的选择，请使用</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">要同时查看服务器用于执行
							</font>
						</font><code class="literal">INFORMATION_SCHEMA</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">查询的查询，请</font>
						</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
								WARNINGS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">立即</font>
							<font style="vertical-align: inherit;">使用
							</font>
							<font style="vertical-align: inherit;">以下内容</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								请考虑此语句，该语句标识</font>
						</font><code class="literal">utf8mb4</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">字符集的</font>
							<font style="vertical-align: inherit;">排序规则
							</font>
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT COLLATION_NAME</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.COLLATION_CHARACTER_SET_APPLICABILITY</code></strong>
       <strong class="userinput"><code>WHERE CHARACTER_SET_NAME = 'utf8mb4';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">COLLATION_NAME |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ---------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">utf8mb4_general_ci |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">utf8mb4_bin |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">utf8mb4_unicode_ci |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">utf8mb4_icelandic_ci |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">utf8mb4_latvian_ci |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">utf8mb4_romanian_ci |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">utf8mb4_slovenian_ci |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								服务器如何处理该语句？</font>
							<font style="vertical-align: inherit;">要了解，请使用
							</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT COLLATION_NAME</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.COLLATION_CHARACTER_SET_APPLICABILITY</code></strong>
       <strong class="userinput"><code>WHERE CHARACTER_SET_NAME = 'utf8mb4'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：cs</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：const</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：PRIMARY，名字</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          关键：名称</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：194</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：const</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用索引</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2.排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：col</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：ref</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：character_set_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          key：character_set_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：const</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：68</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2行，1个警告（0.01秒）</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要查看用于满足该语句的查询，请使用
							</font>
						</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
								WARNINGS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW WARNINGS\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  等级：注意</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   代码：1003</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消息：/ *选择＃1 * /选择`mysql` .col` .name` AS`COLLATION_NAME`</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         来自`mysql``character_sets``cs`</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         加入`mysql``collat​​ions``col`</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         where（（``mysql` .col``character_set_id` ='45'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         和（'utf8mb4'='utf8mb4'））</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如所指示</font>
						</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
								WARNINGS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，该服务器处理该查询上
							</font>
						</font><a class="link" href="information-schema.html#collation-character-set-applicability-table" title="25.5 INFORMATION_SCHEMA COLLATION_CHARACTER_SET_APPLICABILITY表"><code
							 class="literal">COLLATION_CHARACTER_SET_APPLICABILITY</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								为对查询</font>
						</font><code class="literal">character_sets</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><code class="literal">collations</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在数据字典表
							</font>
						</font><code class="literal">mysql</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统数据库。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="performance-schema-optimization"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.4优化性能模式查询</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706976720"></a><a class="indexterm" name="idm140091706975216"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								监视数据库的应用程序可能会频繁使用性能架构表。</font>
							<font style="vertical-align: inherit;">要最有效地为这些表编写查询，请利用它们的索引。</font>
							<font style="vertical-align: inherit;">例如，包含一个</font>
						</font><code class="literal">WHERE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">子句，</font>
							<font style="vertical-align: inherit;">该</font>
							<font style="vertical-align: inherit;">子句根据与索引列中特定值的比较来限制检索到的行。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								大多数性能架构表都有索引。</font>
							<font style="vertical-align: inherit;">不包含通常包含很少行或不太可能经常查询的表的表。</font>
							<font style="vertical-align: inherit;">性能模式索引使优化器可以访问除全表扫描之外的执行计划。</font>
							<font style="vertical-align: inherit;">这些索引还可以提高相关对象的性能，例如</font>
						</font><a class="link" href="sys-schema.html" title="第27章MySQL sys Schema"><code class="literal">sys</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">使用这些表的架构视图。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要查看给定的Performance Schema表是否具有索引及其含义，请使用</font>
						</font><a class="link" href="sql-syntax.html#show-index" title="13.7.6.22 SHOW INDEX语法"><code class="literal">SHOW
								INDEX</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">或
							</font>
						</font><a class="link" href="sql-syntax.html#show-create-table" title="13.7.6.10 SHOW CREATE TABLE语法"><code class="literal">SHOW
								CREATE TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW INDEX FROM performance_schema.accounts\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   非独特：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Key_name：ACCOUNT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Seq_in_index：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Column_name：USER</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    排序规则：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  基数：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Sub_part：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       打包：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         空：是的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   Index_type：HASH</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      评论：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Index_comment：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      可见：是的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2.排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   非独特：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Key_name：ACCOUNT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Seq_in_index：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Column_name：HOST</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    排序规则：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  基数：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Sub_part：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       打包：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         空：是的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   Index_type：HASH</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      评论：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Index_comment：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      可见：是的</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW CREATE TABLE performance_schema.rwlock_instances\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       表：rwlock_instances</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建表：CREATE TABLE`rwlock_instances`（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `NAME` varchar（128）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `OBJECT_INSTANCE_BEGIN` bigint（20）unsigned NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `WRITE_LOCKED_BY_THREAD_ID` bigint（20）unsigned DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  `READ_LOCKED_BY_COUNT` int（10）unsigned NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PRIMARY KEY（`OBJECT_INSTANCE_BEGIN`），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  KEY`NAME`（`NAME`），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  KEY`WRITE_LOCKED_BY_THREAD_ID`（`WRITE_LOCKED_BY_THREAD_ID`）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = PERFORMANCE_SCHEMA DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要查看Performance Schema查询的执行计划以及它是否使用任何索引，请使用
							</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM performance_schema.accounts</code></strong>
       <strong class="userinput"><code>WHERE (USER,HOST) = ('root','localhost')\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：帐户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：const</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：ACCOUNT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          key：ACCOUNT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：278</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：const，const</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：NULL</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">输出表明优化器使用</font>
						</font><a class="link" href="performance-schema.html#accounts-table" title="26.12.8.1账户表"><code class="literal">accounts</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								表</font>
						</font><code class="literal">ACCOUNT</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">包括索引
							</font>
						</font><code class="literal">USER</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和</font>
						</font><code class="literal">HOST</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">列。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								性能模式索引是虚拟的：它们是性能模式存储引擎的构造，不使用内存或磁盘存储。</font>
							<font style="vertical-align: inherit;">性能模式将索引信息报告给优化器，以便它可以构建有效的执行计划。</font>
							<font style="vertical-align: inherit;">性能模式反过来使用有关要查找内容的优化器信息（例如，特定键值），以便它可以执行有效的查找而无需构建实际的索引结构。</font>
							<font style="vertical-align: inherit;">此实现提供了两个重要的好处：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											它完全避免了经常更新的表通常会产生的维护成本。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											它在查询执行的早期阶段减少了检索的数据量。</font>
										<font style="vertical-align: inherit;">对于索引列的条件，性能模式仅有效地返回满足查询条件的表行。</font>
										<font style="vertical-align: inherit;">如果没有索引，性能模式将返回表中的所有行，要求优化程序稍后针对每一行评估条件以生成最终结果。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								性能模式索引是预定义的，不能删除，添加或更改。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								性能模式索引与哈希索引类似。</font>
							<font style="vertical-align: inherit;">例如：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											它们仅用于使用</font>
									</font><code class="literal">=</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或</font>
									</font><code class="literal">&lt;=&gt;</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											运算符的</font>
										<font style="vertical-align: inherit;">相等比较
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											它们是无序的。</font>
										<font style="vertical-align: inherit;">如果查询结果必须具有特定的行排序特征，请包含</font>
									</font><code class="literal">ORDER
										BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">子句。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								有关哈希索引的其他信息，请参见
							</font>
						</font><a class="xref" href="optimization.html#index-btree-hash" title="8.3.9 B树和哈希索引的比较">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.3.9节“B树和哈希索引的比较”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="data-change-optimization"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.5优化数据变更声明</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<div class="toc">
						<dl class="toc"><dt><span class="section"><a href="optimization.html#insert-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.5.1优化INSERT语句</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#update-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.5.2优化UPDATE语句</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#delete-optimization">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.5.3优化DELETE语句</font>
										</font>
									</a></span></dt></dl>
					</div>
					<a class="indexterm" name="idm140091706941904"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								这部分解释了如何加快数据更改语句：
							</font>
						</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，和
							</font>
						</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">传统的OLTP应用程序和现代Web应用程序通常会执行许多小数据更改操作，其中并发性至关重要。</font>
							<font style="vertical-align: inherit;">数据分析和报告应用程序通常会同时运行影响多行的数据更改操作，其中主要考虑因素是写入大量数据并使索引保持最新的I / O. </font>
							<font style="vertical-align: inherit;">对于插入和更新大量数据（在行业中称为
							</font>
						</font><span class="quote">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">“ </font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">提取 - 转换 - 加载</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> ”</font>
							</font>
						</span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">），有时您使用模仿其效果的其他SQL语句或外部命令
							</font>
						</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">陈述。
							</font>
						</font>
					</p>
					<div class="section">

						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="insert-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.5.1优化INSERT语句</font>
										</font>
									</h4>
								</div>
							</div>
						</div>
						<a class="indexterm" name="idm140091706930368"></a><a class="indexterm" name="idm140091706929328"></a><a class="indexterm"
						 name="idm140091706927840"></a><a class="indexterm" name="idm140091706926352"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要优化插入速度，请将许多小型操作组合到一个大型操作中。</font>
								<font style="vertical-align: inherit;">理想情况下，您进行单个连接，一次发送许多新行的数据，并将所有索引更新和一致性检查延迟到最后。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									插入行所需的时间由以下因素决定，其中数字表示大致比例：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												连接：（3）
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												向服务器发送查询：（2）
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												解析查询：（2）
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												插入行：（1×行的大小）
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												插入索引：（1×索引数）
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												结束：（1）
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这没有考虑打开表的初始开销，每个并发运行的查询都会执行一次。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">假设B树索引，</font>
								<font style="vertical-align: inherit;">
									表的大小会减慢日志插入索引的速度</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									您可以使用以下方法来加速插入：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果要同时从同一客户端插入多行，请使用</font>
										</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												包含多个</font>
										</font><code class="literal">VALUES</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列表的</font>
											<font style="vertical-align: inherit;">语句</font>
											<font style="vertical-align: inherit;">一次</font>
											<font style="vertical-align: inherit;">插入多行。</font>
											<font style="vertical-align: inherit;">与使用单独的单行</font>
										</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												语句</font>
											<font style="vertical-align: inherit;">相比，这要快得多（在某些情况下要快很多倍）</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">如果要将数据添加到非空表中，则可以调整
											</font>
										</font><a class="link" href="server-administration.html#sysvar_bulk_insert_buffer_size"><code class="literal">bulk_insert_buffer_size</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												变量以使数据插入更快。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="server-administration.html#server-system-variables" title="5.1.8服务器系统变量">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第5.1.8节“服务器系统变量”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												从文本文件加载表时，请使用
											</font>
										</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
												DATA</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">这通常比使用</font>
										</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句</font>
											<font style="vertical-align: inherit;">快20倍
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.2.7节“LOAD DATA语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												利用列具有默认值的事实。</font>
											<font style="vertical-align: inherit;">仅在要插入的值与默认值不同时才显式插入值。</font>
											<font style="vertical-align: inherit;">这减少了MySQL必须执行的解析并提高了插入速度。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												有关</font>
										</font><a class="xref" href="optimization.html#optimizing-innodb-bulk-data-loading" title="8.5.5 InnoDB表的批量数据加载">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">表的</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												特定提示</font><a class="xref" href="optimization.html#optimizing-innodb-bulk-data-loading" title="8.5.5 InnoDB表的批量数据加载">
												<font style="vertical-align: inherit;">，</font>
											</a>
											<font style="vertical-align: inherit;">请参见</font><a class="xref" href="optimization.html#optimizing-innodb-bulk-data-loading"
											 title="8.5.5 InnoDB表的批量数据加载">
												<font style="vertical-align: inherit;">第8.5.5节“InnoDB表的批量数据加载”</font>
											</a>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												有关</font>
										</font><a class="xref" href="optimization.html#optimizing-myisam-bulk-data-loading" title="8.6.2 MyISAM表的批量数据加载">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">表的</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												特定提示</font><a class="xref" href="optimization.html#optimizing-myisam-bulk-data-loading" title="8.6.2 MyISAM表的批量数据加载">
												<font style="vertical-align: inherit;">，</font>
											</a>
											<font style="vertical-align: inherit;">请参见</font><a class="xref" href="optimization.html#optimizing-myisam-bulk-data-loading"
											 title="8.6.2 MyISAM表的批量数据加载">
												<font style="vertical-align: inherit;">第8.6.2节“MyISAM表的批量数据加载”</font>
											</a>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="update-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.5.2优化UPDATE语句</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091706898016"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									更新语句优化为类似于
								</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">具有写入的额外开销的查询。</font>
								<font style="vertical-align: inherit;">写入速度取决于要更新的​​数据量和更新的索引数。</font>
								<font style="vertical-align: inherit;">未更改的索引不会更新。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									获得快速更新的另一种方法是延迟更新，然后在以后连续执行许多更新。</font>
								<font style="vertical-align: inherit;">如果锁定表，一次执行多个更新比一次执行多个更新要快得多。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">使用动态行格式</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">表，将行更新为更长的总长度可能会拆分该行。</font>
								<font style="vertical-align: inherit;">如果经常这样做，</font>
							</font><a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE
									TABLE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">偶尔</font>
								<font style="vertical-align: inherit;">使用非常重要
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">请参见</font>
							</font><a class="xref" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE语法">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第13.7.3.4节“OPTIMIZE TABLE语法”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="delete-optimization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.2.5.3优化DELETE语句</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091706889440"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									删除</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表中</font>
								<font style="vertical-align: inherit;">各行所需的时间
								</font>
								<font style="vertical-align: inherit;">与索引数完全成比例。</font>
								<font style="vertical-align: inherit;">要更快地删除行，可以通过增加</font>
							</font><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统变量</font>
								<font style="vertical-align: inherit;">来增加密钥缓存的大小
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">请参见</font>
							</font><a class="xref" href="server-administration.html#server-configuration" title="5.1.1配置服务器">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第5.1.1节“配置服务器”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要删除</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表中的</font>
								<font style="vertical-align: inherit;">所有行</font>
								<font style="vertical-align: inherit;">，
								</font>
								<font style="vertical-align: inherit;">要快于
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">截断操作不是事务安全的; </font>
								<font style="vertical-align: inherit;">在活动事务或活动表锁定过程中尝试一个错误时发生错误。</font>
								<font style="vertical-align: inherit;">请参见</font><a class="xref" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE语法">
									<font style="vertical-align: inherit;">第13.1.37节“TRUNCATE TABLE语法”</font>
								</a>
								<font style="vertical-align: inherit;">。
								</font>
							</font><code class="literal">TRUNCATE TABLE
								<em class="replaceable"><code>tbl_name</code></em></code>
							<font style="vertical-align: inherit;"></font><code class="literal">DELETE FROM
								<em class="replaceable"><code>tbl_name</code></em></code>
							<font style="vertical-align: inherit;"></font><a class="xref" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE语法">
								<font style="vertical-align: inherit;"></font>
							</a>
							<font style="vertical-align: inherit;"></font>
						</p>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="permission-optimization"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.6优化数据库权限</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706879296"></a><a class="indexterm" name="idm140091706877840"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								您的权限设置越复杂，所有SQL语句的开销就越大。</font>
							<font style="vertical-align: inherit;">简化</font>
						</font><a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT语法"><code class="literal">GRANT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句</font>
							<font style="vertical-align: inherit;">建立的特权
							</font>
							<font style="vertical-align: inherit;">使MySQL能够在客户端执行语句时减少权限检查开销。</font>
							<font style="vertical-align: inherit;">例如，如果您不授予任何表级或列级权限，则服务器无需检查</font>
						</font><code class="literal">tables_priv</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><code class="literal">columns_priv</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表</font>
							<font style="vertical-align: inherit;">的内容</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">同样，如果您对任何帐户都没有资源限制，则服务器不必执行资源计数。</font>
							<font style="vertical-align: inherit;">如果您的语句处理负载非常高，请考虑使用简化的授权结构来减少权限检查开销。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="miscellaneous-optimization-tips"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.2.7其他优化技巧</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706871232"></a><a class="indexterm" name="idm140091706869744"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								本节列出了一些用于提高查询处理速度的其他技巧：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果您的应用程序发出多个数据库请求以执行相关更新，则将语句组合到存储例程中可以帮助提高性能。</font>
										<font style="vertical-align: inherit;">同样，如果您的应用程序基于多个列值或大量数据计算单个结果，则将计算组合到UDF（用户定义的函数）可以帮助提高性能。</font>
										<font style="vertical-align: inherit;">然后，由此产生的快速数据库操作可供其他查询，应用程序甚至用不同编程语言编写的代码重用。</font>
										<font style="vertical-align: inherit;">有关更多信息</font>
									</font><a class="xref" href="stored-objects.html#stored-routines" title="24.2使用存储的例程">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">请参见
										</font><a class="xref" href="stored-objects.html#stored-routines" title="24.2使用存储的例程">
											<font style="vertical-align: inherit;">第24.2节“使用存储的例程”</font>
										</a>
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="xref" href="extending-mysql.html#adding-functions" title="29.4向MySQL添加新功能">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第29.4节“向MySQL添加新函数”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											要解决</font>
									</font><code class="literal">ARCHIVE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表</font>
										<font style="vertical-align: inherit;">中发生的任何压缩问题
										</font>
										<font style="vertical-align: inherit;">，请使用
										</font>
									</font><a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="storage-engines.html#archive-storage-engine" title="16.5 ARCHIVE存储引擎">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第16.5节“ARCHIVE存储引擎”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果可能，将报告分类为</font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">“ </font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">实时</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> ”</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或
										</font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">“ </font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">统计</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> ”</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，其中统计报告所需的数据仅从定期从实时数据生成的汇总表中创建。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果您的数据不符合行列表结构，则可以将数据打包并存储到</font>
									</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">列中。</font>
										<font style="vertical-align: inherit;">在这种情况下，您必须在应用程序中提供打包和解压缩信息的代码，但这可能会节省I / O操作以读取和写入相关值集。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用Web服务器，将图像和其他二进制资产存储为文件，路径名存储在数据库中而不是文件本身。</font>
										<font style="vertical-align: inherit;">大多数Web服务器在缓存文件方面比数据库内容更好，因此使用文件通常更快。</font>
										<font style="vertical-align: inherit;">（尽管在这种情况下您必须自己处理备份和存储问题。）
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果您需要非常高的速度，请查看低级MySQL接口。</font>
										<font style="vertical-align: inherit;">例如，通过</font>
										<font style="vertical-align: inherit;">
											直接</font>
										<font style="vertical-align: inherit;">访问MySQL
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">存储引擎，与使用SQL接口相比，可以大幅提高速度。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											复制可以为某些操作提供性能优势。</font>
										<font style="vertical-align: inherit;">您可以在复制服务器之间分发客户端检索以分割负载。</font>
										<font style="vertical-align: inherit;">为避免在进行备份时减慢主服务器的速度，可以使用从服务器进行备份。</font>
										<font style="vertical-align: inherit;">请参见</font>
									</font><a class="xref" href="replication.html" title="第17章复制">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第17章，</font>
										</font><i>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">复制</font>
											</font>
										</i>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="optimization-indexes"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.3优化和索引</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#mysql-indexes">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.1 MySQL如何使用索引</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#primary-key-optimization">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.2主键优化</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#spatial-index-optimization">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.3空间索引优化</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#foreign-key-optimization">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.4外键优化</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#column-indexes">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.5列索引</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#multiple-column-indexes">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.6多列索引</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#verifying-index-usage">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.7验证索引使用情况</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#index-statistics">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.8 InnoDB和MyISAM索引统计信息收集</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#index-btree-hash">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.9 B树和哈希索引的比较</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#index-extensions">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.10索引扩展的使用</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#generated-column-index-optimizations">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.11生成列索引的优化程序使用</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#invisible-indexes">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.12隐形指数</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#descending-indexes">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.13降序索引</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#timestamp-lookups">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.14 TIMESTAMP列的索引查找</font>
									</font>
								</a></span></dt></dl>
				</div>
				<a class="indexterm" name="idm140091706849280"></a>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							提高操作性能的最佳方法
						</font>
					</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">是在查询中测试的一个或多个列上创建索引。</font>
						<font style="vertical-align: inherit;">索引条目的作用类似于表行的指针，允许查询快速确定哪些行与</font>
					</font><code class="literal">WHERE</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">子句</font>
						<font style="vertical-align: inherit;">中的条件匹配</font>
						<font style="vertical-align: inherit;">，并检索这些行的其他列值。</font>
						<font style="vertical-align: inherit;">可以索引所有MySQL数据类型。
						</font>
					</font>
				</p>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							尽管为查询中使用的每个可能列创建索引很有诱惑力，但不必要的索引会浪费空间并浪费时间让MySQL确定要使用哪些索引。</font>
						<font style="vertical-align: inherit;">索引还会增加插入，更新和删除的成本，因为必须更新每个索引。</font>
						<font style="vertical-align: inherit;">您必须找到适当的平衡，以使用最佳索引集实现快速查询。
						</font>
					</font>
				</p>
				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="mysql-indexes"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.1 MySQL如何使用索引</font>
									</font>
								</h3>
							</div>
						</div>
					</div>
					<a class="indexterm" name="idm140091706843152"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								索引用于快速查找具有特定列值的行。</font>
							<font style="vertical-align: inherit;">如果没有索引，MySQL必须从第一行开始，然后读取整个表以查找相关行。</font>
							<font style="vertical-align: inherit;">表越大，成本越高。</font>
							<font style="vertical-align: inherit;">如果表中有相关​​列的索引，MySQL可以快速确定要在数据文件中间寻找的位置，而无需查看所有数据。</font>
							<font style="vertical-align: inherit;">这比按顺序读取每一行要快得多。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								大多数MySQL索引（</font>
						</font><code class="literal">PRIMARY KEY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><code class="literal">UNIQUE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，</font>
						</font><code class="literal">INDEX</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><code class="literal">FULLTEXT</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）存储在
							</font>
						</font><a class="link" href="glossary.html#glos_b_tree" title="B树">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">B树</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">例外：空间数据类型的索引使用R树; </font>
						</font><code class="literal">MEMORY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								表也​​支持</font>
						</font><a class="link" href="glossary.html#glos_hash_index" title="哈希索引">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">哈希索引</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;"> ; </font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">使用反向列表作为</font>
						</font><code class="literal">FULLTEXT</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">索引。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								通常，使用索引，如以下讨论中所述。</font><a class="xref" href="optimization.html#index-btree-hash" title="8.3.9 B树和哈希索引的比较">
								<font style="vertical-align: inherit;">第8.3.9节“B树和哈希索引的比较”</font>
							</a>
						</font><code class="literal">MEMORY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">中描述了</font>
							<font style="vertical-align: inherit;">哈希索引特有的特性（如</font>
							<font style="vertical-align: inherit;">表中所</font>
							<font style="vertical-align: inherit;">用
							</font>
							<font style="vertical-align: inherit;">）
							</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font><a class="xref" href="optimization.html#index-btree-hash" title="8.3.9 B树和哈希索引的比较">
							<font style="vertical-align: inherit;"></font>
						</a>
						<font style="vertical-align: inherit;"></font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL使用索引进行这些操作：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;"></font><code class="literal">WHERE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">快速</font>
										<font style="vertical-align: inherit;">
											查找与</font>
										<font style="vertical-align: inherit;">子句</font>
										<font style="vertical-align: inherit;">匹配的行</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											消除行的考虑。</font>
										<font style="vertical-align: inherit;">如果在多个索引之间有选择，MySQL通常使用找到最小行数（最具
										</font>
									</font><a class="link" href="glossary.html#glos_selectivity" title="选择性">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">选择性的</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">索引）的索引。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091706826464"></a>

									<a class="indexterm" name="idm140091706824976"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">

											如果表具有多列索引，则优化程序可以使用索引的任何最左前缀来查找行。</font>
										<font style="vertical-align: inherit;">例如，如果你有一个三列索引上
										</font>
									</font><code class="literal">(col1, col2, col3)</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，你有索引的搜索功能</font>
									</font><code class="literal">(col1)</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><code class="literal">(col1, col2)</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">以及</font>
									</font><code class="literal">(col1, col2,
										col3)</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#multiple-column-indexes" title="8.3.6多列索引">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.3.6节“多列索引”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在执行连接时从其他表中检索行。</font>
										<font style="vertical-align: inherit;">如果声明它们的类型和大小相同，MySQL可以更有效地使用列上的索引。</font>
										<font style="vertical-align: inherit;">在这种情况下，
										</font>
									</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">与
										</font>
									</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">被认为是相同的，如果它们被声明为相同的大小。</font>
										<font style="vertical-align: inherit;">例如，
										</font>
									</font><code class="literal">VARCHAR(10)</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><code class="literal">CHAR(10)</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">大小相同，但
										</font>
									</font><code class="literal">VARCHAR(10)</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">与
										</font>
									</font><code class="literal">CHAR(15)</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">不是。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于非二进制字符串列之间的比较，两列应使用相同的字符集。</font>
										<font style="vertical-align: inherit;">例如，将</font>
									</font><code class="literal">utf8</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">列与
										</font>
									</font><code class="literal">latin1</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">列</font>
										<font style="vertical-align: inherit;">进行比较会</font>
										<font style="vertical-align: inherit;">排除使用索引。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											不相似列的比较（例如，将字符串列与时间或数字列进行比较）可能会在没有转换的情况下无法直接比较值时阻止使用索引。</font>
										<font style="vertical-align: inherit;">对于给定的值，如</font>
									</font><code class="literal">1</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在数值列，它可能比较等于在字符串列，例如任何数量的值
										</font>
									</font><code class="literal">'1'</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，</font>
									</font><code class="literal">'&nbsp;1'</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><code class="literal">'00001'</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，或</font>
									</font><code class="literal">'01.e1'</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">这排除了对字符串列的任何索引的使用。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											查找</font>
										<font style="vertical-align: inherit;">特定索引列的值</font>
									</font><a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或
										</font>
									</font><a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值</font>
									</font><em class="replaceable"><code>key_col</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">这是由预处理器优化的，该预处理器检查您是否正在使用</font>
										<font style="vertical-align: inherit;">
											索引</font>
										<font style="vertical-align: inherit;">之前出现的所有关键部分</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">在这种情况下，MySQL对每个</font>
										<font style="vertical-align: inherit;">或
										</font>
										<font style="vertical-align: inherit;">表达式</font>
										<font style="vertical-align: inherit;">执行单个键查找，</font>
										<font style="vertical-align: inherit;">并用常量替换它。</font>
										<font style="vertical-align: inherit;">如果所有表达式都替换为常量，则查询立即返回。</font>
										<font style="vertical-align: inherit;">例如：
										</font>
									</font><code class="literal">WHERE <em class="replaceable"><code>key_part_N</code></em> =
										<em class="replaceable"><code>constant</code></em></code>
									<font style="vertical-align: inherit;"></font><em class="replaceable"><code>key_col</code></em>
									<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>
									<font style="vertical-align: inherit;"></font><a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>
									<font style="vertical-align: inherit;"></font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT MIN（</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），MAX（</font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10;
</font></font></pre>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果对可用索引的最左前缀（例如，</font>
										<font style="vertical-align: inherit;">）</font>
										<font style="vertical-align: inherit;">进行排序或分组，则对表进行排序或分组
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">如果后面跟着所有关键部分</font>
										<font style="vertical-align: inherit;">，则按相反顺序读取密钥。</font>
										<font style="vertical-align: inherit;">（或者，如果索引是降序索引，</font><a class="xref" href="optimization.html#order-by-optimization"
										 title="8.2.1.15按优化顺序">
											<font style="vertical-align: inherit;">则按</font>
										</a>
										<font style="vertical-align: inherit;">正向顺序读取密钥。）请参见
										</font><a class="xref" href="optimization.html#order-by-optimization" title="8.2.1.15按优化顺序">
											<font style="vertical-align: inherit;">第8.2.1.15节“ORDER BY优化”</font>
										</a>
										<font style="vertical-align: inherit;">，
										</font><a class="xref" href="optimization.html#group-by-optimization" title="8.2.1.16&nbsp;GROUP BY Optimization">
											<font style="vertical-align: inherit;">第8.2.1.16节“GROUP BY优化”</font>
										</a>
										<font style="vertical-align: inherit;">和
										</font><a class="xref" href="optimization.html#descending-indexes" title="8.3.13&nbsp;Descending Indexes">
											<font style="vertical-align: inherit;">第8.3.13节“降序指数“</font>
										</a>
										<font style="vertical-align: inherit;">。
										</font>
									</font><code class="literal">ORDER BY <em class="replaceable"><code>key_part1</code></em>,
										<em class="replaceable"><code>key_part2</code></em></code>
									<font style="vertical-align: inherit;"></font><code class="literal">DESC</code>
									<font style="vertical-align: inherit;"></font><a class="xref" href="optimization.html#order-by-optimization"
									 title="8.2.1.15按优化顺序">
										<font style="vertical-align: inherit;"></font>
									</a>
									<font style="vertical-align: inherit;"></font><a class="xref" href="optimization.html#group-by-optimization"
									 title="8.2.1.16 GROUP BY优化">
										<font style="vertical-align: inherit;"></font>
									</a>
									<font style="vertical-align: inherit;"></font><a class="xref" href="optimization.html#descending-indexes"
									 title="8.3.13降序索引">
										<font style="vertical-align: inherit;"></font>
									</a>
									<font style="vertical-align: inherit;"></font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在某些情况下，可以优化查询以在不咨询数据行的情况下检索值。</font>
										<font style="vertical-align: inherit;">（为查询提供所有必要结果的</font>
									</font><a class="link" href="glossary.html#glos_covering_index" title="覆盖指数">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">称为
										</font><a class="link" href="glossary.html#glos_covering_index" title="覆盖指数">
											<font style="vertical-align: inherit;">覆盖索引</font>
										</a>
										<font style="vertical-align: inherit;">。）如果查询仅使用表中包含某些索引的列，则可以从索引树中检索所选值以获得更快的速度：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT </font></font><em class="replaceable"><code>key_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1
</font></font></pre>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于小型表或报表查询处理大多数或所有行的大型表的查询，索引不太重要。</font>
							<font style="vertical-align: inherit;">当查询需要访问大多数行时，顺序读取比通过索引更快。</font>
							<font style="vertical-align: inherit;">顺序读取可以最大限度地减少磁盘搜索，即使查询不需要所有行也是如此。</font>
							<font style="vertical-align: inherit;">有关</font>
							<font style="vertical-align: inherit;">详细信息</font>
						</font><a class="xref" href="optimization.html#table-scan-avoidance" title="8.2.1.22避免全表扫描">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">请参见</font><a class="xref" href="optimization.html#table-scan-avoidance"
							 title="8.2.1.22&nbsp;Avoiding Full Table Scans">
								<font style="vertical-align: inherit;">第8.2.1.22节“避免全表扫描”</font>
							</a>
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="primary-key-optimization"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.2主键优化</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706782960"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								表的主键表示您在最重要的查询中使用的列或列集。</font>
							<font style="vertical-align: inherit;">它具有关联的索引，以实现快速查询性能。</font>
							<font style="vertical-align: inherit;">查询性能受益于</font>
						</font><code class="literal">NOT NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">优化，因为它不能包含任何</font>
						</font><code class="literal">NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值。</font>
							<font style="vertical-align: inherit;">使用</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">存储引擎，表数据在物理上进行组织，以根据主键或列进行超快速查找和排序。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果您的表很大且很重要，但没有明显的列或列集用作主键，则可以创建一个单独的列，其中包含自动增量值以用作主键。</font>
							<font style="vertical-align: inherit;">使用外键连接表时，这些唯一ID可用作指向其他表中相应行的指针。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="spatial-index-optimization"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.3空间索引优化</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706776512"></a><a class="indexterm" name="idm140091706775024"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL允许</font>
						</font><code class="literal">SPATIAL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在</font>
						</font><code class="literal">NOT NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">几何值列</font>
							<font style="vertical-align: inherit;">上</font>
							<font style="vertical-align: inherit;">创建</font>
							<font style="vertical-align: inherit;">索引
							</font>
							<font style="vertical-align: inherit;">（请参见
							</font>
						</font><a class="xref" href="data-types.html#creating-spatial-indexes" title="11.5.10创建空间索引">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第11.5.10节“创建空间索引”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）。</font>
							<font style="vertical-align: inherit;">优化程序检查</font>
						</font><code class="literal">SRID</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">索引列</font>
							<font style="vertical-align: inherit;">的</font>
							<font style="vertical-align: inherit;">属性，以确定要用于比较的空间参考系统（SRS），并使用适合SRS的计算。</font>
							<font style="vertical-align: inherit;">（在MySQL 8.0之前，优化器</font>
						</font><code class="literal">SPATIAL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">使用笛卡尔计算</font>
							<font style="vertical-align: inherit;">执行</font>
							<font style="vertical-align: inherit;">索引值的</font>
							<font style="vertical-align: inherit;">比较</font>
							<font style="vertical-align: inherit;">;如果列包含具有非笛卡尔SRID的值，则此类操作的结果是未定义的。）
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要使比较正常工作，</font>
						</font><code class="literal">SPATIAL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">索引中的</font>
							<font style="vertical-align: inherit;">每个列都
							</font>
							<font style="vertical-align: inherit;">必须受SRID限制。</font>
							<font style="vertical-align: inherit;">也就是说，列定义必须包含显式
							</font>
						</font><code class="literal">SRID</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">属性，并且所有列值必须具有相同的SRID。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化程序</font>
						</font><code class="literal">SPATIAL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">仅</font>
							<font style="vertical-align: inherit;">考虑</font>
							<font style="vertical-align: inherit;">SRID限制列的索引：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											限制为笛卡尔SRID的列的索引启用笛卡尔边界框计算。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											限制为地理SRID的列的索引启用地理边界框计算。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化程序忽略</font>
						</font><code class="literal">SPATIAL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">没有</font>
						</font><code class="literal">SRID</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">属性的</font>
							<font style="vertical-align: inherit;">列上的索引</font>
							<font style="vertical-align: inherit;">（因此不受SRID限制）。</font>
							<font style="vertical-align: inherit;">MySQL仍然维护着这样的索引，如下所示：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											他们对表的修改（更新</font>
									</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，等等）。</font>
										<font style="vertical-align: inherit;">更新发生就像索引是笛卡尔坐标一样，即使该列可能包含笛卡尔和地理值的混合。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											它们仅用于向后兼容（例如，在MySQL 5.7中执行转储和在MySQL 8.0中恢复的能力）。</font>
										<font style="vertical-align: inherit;">由于</font>
									</font><code class="literal">SPATIAL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">非SRID限制的列上的索引对优化器没用，因此应修改每个此类列：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														验证列中的所有值是否具有相同的SRID。</font>
													<font style="vertical-align: inherit;">要确定几何列中包含的SRID </font>
												</font><em class="replaceable"><code>col_name</code></em>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">，请使用以下查询：
													</font>
												</font>
											</p>
											<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT DISTINCT ST_SRID（</font></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														如果查询返回多行，则该列包含多个SRID。</font>
													<font style="vertical-align: inherit;">在这种情况下，请修改其内容，以使所有值具有相同的SRID。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														重新定义列以具有显式
													</font>
												</font><code class="literal">SRID</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">属性。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														重新创建</font>
												</font><code class="literal">SPATIAL</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">索引。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="foreign-key-optimization"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.4外键优化</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706745824"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果一个表有很多列，并且您查询了许多不同的列组合，那么将频率较低的数据拆分为每个都有几列的单独表可能会很有效，并通过复制数字ID将它们与主表关联起来。主表中的列。</font>
							<font style="vertical-align: inherit;">这样，每个小表都可以有一个主键来快速查找其数据，您可以使用连接操作查询所需的列集。</font>
							<font style="vertical-align: inherit;">根据数据的分布方式，查询可能会执行较少的I / O并占用较少的高速缓存，因为相关列在磁盘上打包在一起。</font>
							<font style="vertical-align: inherit;">（为了最大限度地提高性能，查询尝试从磁盘中读取尽可能少的数据块;
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="column-indexes"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.5列索引</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706741776"></a><a class="indexterm" name="idm140091706740288"></a><a class="indexterm"
					 name="idm140091706738800"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								最常见的索引类型涉及单个列，在数据结构中存储该列的值的副本，允许快速查找具有相应列值的行。</font>
							<font style="vertical-align: inherit;">B树数据结构可以让索引快速查找特定值，一组值，或值的范围，对应于运营商，如</font>
						</font><code class="literal">=</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><code class="literal">&gt;</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，</font>
						</font><code class="literal">≤</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><code class="literal">BETWEEN</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，</font>
						</font><code class="literal">IN</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，等等，一在</font>
						</font><code class="literal">WHERE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">子句。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								每个存储引擎定义每个表的最大索引数和最大索引长度。</font>
							<font style="vertical-align: inherit;">请参见
							</font>
						</font><a class="xref" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第15章，</font>
							</font><i>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">InnoDB存储引擎</font>
								</font>
							</i>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><a class="xref" href="storage-engines.html" title="第16章备用存储引擎">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第16章，</font>
							</font><i>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">备用存储引擎</font>
								</font>
							</i>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">所有存储引擎每个表至少支持16个索引，总索引长度至少为256个字节。</font>
							<font style="vertical-align: inherit;">大多数存储引擎都有更高的限制
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								有关列索引的其他信息，请参见
							</font>
						</font><a class="xref" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX语法">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第13.1.15节“CREATE INDEX语法”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p><a class="xref" href="optimization.html#column-indexes-prefix" title="索引前缀">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引前缀</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#column-indexes-fulltext" title="FULLTEXT索引">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">FULLTEXT索引</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#column-indexes-spatial" title="空间索引">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">空间索引</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#column-indexes-memory-storage-engine" title="MEMORY存储引擎中的索引">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">MEMORY存储引擎中的索引</font>
										</font>
									</a></p>
							</li>
						</ul>
					</div>

					<div class="simplesect">

						<div class="titlepage">
							<div>

								<div class="simple">
									<h4 class="title"><a name="column-indexes-prefix"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引前缀</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091706723504"></a><a class="indexterm" name="idm140091706722016"></a><a class="indexterm"
						 name="idm140091706720528"></a><a class="indexterm" name="idm140091706719040"></a><a class="indexterm" name="idm140091706717552"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用
								</font>
								<font style="vertical-align: inherit;">
									字符串列的索引规范中的语法，可以创建仅使用</font>
								<font style="vertical-align: inherit;">列</font>
								<font style="vertical-align: inherit;">的前</font>
								<font style="vertical-align: inherit;">几个字符</font>
								<font style="vertical-align: inherit;">的索引
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">以这种方式仅索引列值的前缀可以使索引文件更小。</font>
								<font style="vertical-align: inherit;">索引
								</font>
								<font style="vertical-align: inherit;">或
								</font>
								<font style="vertical-align: inherit;">列时，
								</font><span class="emphasis"><em>
										<font style="vertical-align: inherit;">必须</font>
									</em></span>
								<font style="vertical-align: inherit;">为索引指定前缀长度。</font>
								<font style="vertical-align: inherit;">例如：
								</font>
							</font><code class="literal"><em class="replaceable"><code>col_name</code></em>(<em class="replaceable"><code>N</code></em>)</code>
							<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
							<font style="vertical-align: inherit;"></font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code
								 class="literal">BLOB</code></a>
							<font style="vertical-align: inherit;"></font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code
								 class="literal">TEXT</code></a>
							<font style="vertical-align: inherit;"></font><span class="emphasis"><em>
									<font style="vertical-align: inherit;"></font>
								</em></span>
							<font style="vertical-align: inherit;"></font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE test（blob_col BLOB，INDEX（blob_col（10）））;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">使用</font>
							</font><code class="literal"><a class="link" href="glossary.html#glos_redundant_row_format" title="redundant row format">REDUNDANT</a></code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									或
								</font>
							</font><code class="literal"><a class="link" href="glossary.html#glos_compact_row_format" title="compact row format">COMPACT</a></code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									行格式的</font>
								<font style="vertical-align: inherit;">表，
								</font>
								<font style="vertical-align: inherit;">前缀最长可达767个字节
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">对于</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">使用</font>
							</font><code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a></code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									或
								</font>
							</font><code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a></code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									行格式的</font>
								<font style="vertical-align: inherit;">表，
								</font>
								<font style="vertical-align: inherit;">前缀长度限制为3072字节
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">对于MyISAM表，前缀长度限制为1000个字节。
								</font>
							</font>
						</p>
						<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

							<div class="admon-title">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										注意
									</font>
								</font>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										前缀限制以字节为单位，而在前缀长度</font>
								</font><a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE语法"><code class="literal">CREATE
										TABLE</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
										TABLE</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">和
									</font>
								</font><a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX语法"><code class="literal">CREATE
										INDEX</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">语句被解释为非二进制串类型的字符数（</font>
								</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">二进制串类型（）和字节数</font>
								</font><a class="link" href="data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">BINARY</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><a class="link" href="data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">VARBINARY</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">）。</font>
									<font style="vertical-align: inherit;">在为使用多字节字符集的非二进制字符串列指定前缀长度时，请考虑这一点。
									</font>
								</font>
							</p>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果搜索项超过索引前缀长度，则索引用于排除不匹配的行，并检查剩余的行以查找可能的匹配项。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									有关索引前缀的其他信息，请参见
								</font>
							</font><a class="xref" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX语法">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第13.1.15节“CREATE INDEX语法”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="column-indexes-fulltext"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">FULLTEXT索引</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091706686800"></a><a class="indexterm" name="idm140091706685312"></a>
						<p>
							<code class="literal">FULLTEXT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">索引用于全文搜索。</font>
								<font style="vertical-align: inherit;">只有</font>
							</font><a class="link" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎"><code class="literal">InnoDB</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎支持
								</font>
							</font><code class="literal">FULLTEXT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">索引和仅适用于
								</font>
							</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列。</font>
								<font style="vertical-align: inherit;">索引始终发生在整个列上，并且不支持列前缀索引。</font>
								<font style="vertical-align: inherit;">有关详细信息，请参见
								</font>
							</font><a class="xref" href="functions.html#fulltext-search" title="12.9全文搜索功能">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第12.9节“全文搜索功能”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化适用于</font>
							</font><code class="literal">FULLTEXT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">针对单个</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表的</font>
								<font style="vertical-align: inherit;">某些类型的
								</font>
								<font style="vertical-align: inherit;">查询
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">具有这些特征的查询特别有效：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<code class="literal">FULLTEXT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> 仅返回文档ID或文档ID和搜索排名的查询。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">FULLTEXT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">查询按分数的降序对匹配的行进行排序，并应用
											</font>
										</font><code class="literal">LIMIT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句来获取前N个匹配的行。</font>
											<font style="vertical-align: inherit;">要应用此优化，必须没有
											</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句，只有一个
											</font>
										</font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句按降序排列。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">FULLTEXT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">只检索</font>
										</font><code class="literal">COUNT(*)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">与搜索词匹配的行</font>
											<font style="vertical-align: inherit;">的
											</font>
											<font style="vertical-align: inherit;">值的查询，没有其他</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												子句。</font>
											<font style="vertical-align: inherit;">编码</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句</font>
											<font style="vertical-align: inherit;">为
											</font>
											<font style="vertical-align: inherit;">，没有任何</font>
											<font style="vertical-align: inherit;">比较运算符。
											</font>
										</font><code class="literal">WHERE MATCH(<em class="replaceable"><code>text</code></em>)
											AGAINST
											('<em class="replaceable"><code>other_text</code></em>')</code><code class="literal">&gt; 0</code>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于包含全文表达式的查询，MySQL在查询执行的优化阶段评估这些表达式。</font>
								<font style="vertical-align: inherit;">优化器不只是查看全文表达式并进行估计，它实际上是在开发执行计划的过程中对它们进行评估。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这种行为的含义就是这样
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">对于全文查询通常比在全局阶段没有进行表达式评估的非全文查询慢。
								</font>
							</font>
						</p>
						<p>
							<a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">由于优化期间发生匹配，</font>
								<font style="vertical-align: inherit;">可能会</font>
							</font><code class="literal">Select tables optimized away</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在</font>
							</font><code class="literal">Extra</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列中</font>
								<font style="vertical-align: inherit;">显示全文查询</font>
								<font style="vertical-align: inherit;">; </font>
								<font style="vertical-align: inherit;">在这种情况下，在以后的执行期间不需要访问表。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="column-indexes-spatial"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">空间索引</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091706653744"></a><a class="indexterm" name="idm140091706652256"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									您可以在空间数据类型上创建索引。
								</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">并</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									支持空间类型的R树索引。</font>
								<font style="vertical-align: inherit;">其他存储引擎使用B树来索引空间类型（除了
								</font>
							</font><code class="literal">ARCHIVE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，它不支持空间类型索引）。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="column-indexes-memory-storage-engine"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">MEMORY存储引擎中的索引</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091706646688"></a><a class="indexterm" name="idm140091706645200"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><code class="literal">MEMORY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎使用
								</font>
							</font><code class="literal">HASH</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">默认的索引，而且还支持
								</font>
							</font><code class="literal">BTREE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">索引。
								</font>
							</font>
						</p>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="multiple-column-indexes"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.6多列索引</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706639728"></a><a class="indexterm" name="idm140091706638656"></a><a class="indexterm"
					 name="idm140091706637168"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL可以创建复合索引（即多列索引）。</font>
							<font style="vertical-align: inherit;">索引最多可包含16列。</font>
							<font style="vertical-align: inherit;">对于某些数据类型，您可以索引列的前缀（请参见
							</font>
						</font><a class="xref" href="optimization.html#column-indexes" title="8.3.5列索引">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.3.5节“列索引”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL可以对测试索引中所有列的查询使用多列索引，或者只测试第一列，前两列，前三列等的查询。</font>
							<font style="vertical-align: inherit;">如果在索引定义中以正确的顺序指定列，则单个复合索引可以加速同一表上的多种查询。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								多列索引可以视为排序数组，其行包含通过连接索引列的值创建的值。
							</font>
						</font>
					</p>
					<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

						<div class="admon-title">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									注意
								</font>
							</font>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									作为复合索引的替代方法，您可以</font>
								<font style="vertical-align: inherit;">根据其他列的信息</font>
								<font style="vertical-align: inherit;">引入</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">散列</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列。</font>
								<font style="vertical-align: inherit;">如果此列很短，相当独特且已编制索引，则它可能比</font>
								<font style="vertical-align: inherit;">许多列上</font>
								<font style="vertical-align: inherit;">的</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">宽</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">索引</font>
								<font style="vertical-align: inherit;">更快</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">在MySQL中，使用这个额外的列很容易：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>hash_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= MD5（CONCAT（</font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND </font></font><em class="replaceable"><code>col1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND </font></font><em class="replaceable"><code>col2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								假设一个表具有以下规范：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE测试（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    id INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    last_name CHAR（30）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    first_name CHAR（30）NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PRIMARY KEY（id），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    INDEX名称（last_name，first_name）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><code class="literal">name</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">指数是在一个索引
							</font>
						</font><code class="literal">last_name</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和</font>
						</font><code class="literal">first_name</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								列。</font>
							<font style="vertical-align: inherit;">该索引可用于查询中的查找，这些查询指定已知范围内的</font>
							<font style="vertical-align: inherit;">
								值</font>
						</font><code class="literal">last_name</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和</font>
						</font><code class="literal">first_name</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值</font>
							<font style="vertical-align: inherit;">组合的
							</font>
							<font style="vertical-align: inherit;">值。</font>
							<font style="vertical-align: inherit;">它也可以用于仅指定</font>
						</font><code class="literal">last_name</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值的</font>
							<font style="vertical-align: inherit;">查询，
							</font>
							<font style="vertical-align: inherit;">因为该列是索引的最左前缀（如本节后面所述）。</font>
							<font style="vertical-align: inherit;">因此，</font>
						</font><code class="literal">name</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">索引用于以下查询中的查找：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM test WHERE last_name ='Widenius';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM test</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE last_name ='Widenius'AND first_name ='Michael';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM test</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE last_name ='Widenius'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND（first_name ='Michael'OR / first_name ='Monty'）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM test</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE last_name ='Widenius'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND first_name&gt; ='M'AND first_name &lt;'N';</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								但是，</font>
						</font><code class="literal">name</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">指数
							</font>
						</font><span class="emphasis"><em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">不是</font>
								</font>
							</em></span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">用于以下查询中的查找：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM test WHERE first_name ='Michael';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM test</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE last_name ='Widenius'或first_name ='Michael';</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								假设您发出以下内容
							</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE col1 = </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND col2 =</font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果</font>
						</font><code class="literal">col1</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和上
							</font>
							<font style="vertical-align: inherit;">存在多列索引</font>
						</font><code class="literal">col2</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，则可以直接获取相应的行。</font>
							<font style="vertical-align: inherit;">如果</font>
						</font><code class="literal">col1</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和上</font>
							<font style="vertical-align: inherit;">存在单独的单列索引
							</font>
						</font><code class="literal">col2</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，则优化程序会尝试使用索引合并优化（请参见
							</font>
						</font><a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.3索引合并优化">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.2.1.3节“索引合并优化”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">），或尝试通过确定哪个索引排除更多行并使用它来查找限制性最强的索引获取行的索引。
							</font>
						</font>
					</p><a class="indexterm" name="idm140091706606272"></a><a class="indexterm" name="idm140091706604784"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果表具有多列索引，则优化程序可以使用索引的任何最左前缀来查找行。</font>
							<font style="vertical-align: inherit;">例如，如果你有一个三列索引上</font>
						</font><code class="literal">(col1,
							col2, col3)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，你有索引的搜索功能
							</font>
						</font><code class="literal">(col1)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，</font>
						</font><code class="literal">(col1, col2)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">以及
							</font>
						</font><code class="literal">(col1, col2, col3)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果列不形成索引的最左前缀，则MySQL无法使用索引执行查找。</font>
							<font style="vertical-align: inherit;">假设您有以下</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">所示</font>
							<font style="vertical-align: inherit;">的</font>
							<font style="vertical-align: inherit;">语句：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE col1 = </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE col1 = </font></font><em class="replaceable"><code>val1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND col2 = </font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE col2 = </font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE col2 = </font></font><em class="replaceable"><code>val2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND col3 = </font></font><em class="replaceable"><code>val3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果存在索引</font>
						</font><code class="literal">(col1, col2, col3)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，则只有前两个查询使用索引。</font>
							<font style="vertical-align: inherit;">第三和第四个查询确实包括索引的列，但不使用索引来进行查找，因为</font>
						</font><code class="literal">(col2)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><code class="literal">(col2, col3)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">不是的最左边的前缀
							</font>
						</font><code class="literal">(col1, col2, col3)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="verifying-index-usage"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.7验证索引使用情况</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								始终检查所有查询是否确实使用了您在表中创建的索引。</font>
							<font style="vertical-align: inherit;">使用该
							</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句，如</font>
						</font><a class="xref" href="optimization.html#using-explain" title="8.8.1使用EXPLAIN优化查询">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.8.1节“使用EXPLAIN优化查询”中所述</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="index-statistics"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.8 InnoDB和MyISAM索引统计信息收集</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								存储引擎收集有关表的统计信息以供优化程序使用。</font>
							<font style="vertical-align: inherit;">表统计信息基于值组，其中值组是具有相同键前缀值的一组行。</font>
							<font style="vertical-align: inherit;">出于优化程序的目的，一个重要的统计数据是平均值组大小。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL使用以下方式的平均值组大小：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											估计每次</font>
									</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">访问
										</font>
										<font style="vertical-align: inherit;">必须读取的行数
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											估计部分连接将产生多少行; </font>
										<font style="vertical-align: inherit;">也就是说，此表单的操作将产生的行数：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（...）JOIN </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ON </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font><em class="replaceable"><code>expr</code></em>
</pre>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								随着索引的平均值组大小增加，索引对于这两个目的不太有用，因为每个查找的平均行数增加：为了使索引有利于优化目的，最好每个索引值都以小为目标表中的行数。</font>
							<font style="vertical-align: inherit;">当给定的索引值产生大量行时，索引不太有用，MySQL不太可能使用它。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								平均值组大小与表基数相关，表基数是值组的数量。</font>
							<font style="vertical-align: inherit;">该
							</font>
						</font><a class="link" href="sql-syntax.html#show-index" title="13.7.6.22 SHOW INDEX语法"><code class="literal">SHOW
								INDEX</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句显示基于的基数值</font>
						</font><em class="replaceable"><code>N/S</code></em>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，其中
							</font>
						</font><em class="replaceable"><code>N</code></em>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">是表中的行数，</font>
						</font><em class="replaceable"><code>S</code></em>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">是平均值组大小。</font>
							<font style="vertical-align: inherit;">该比率产生表中的近似值组数。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								为联接基础上，</font>
						</font><code class="literal">&lt;=&gt;</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">比较运营商，</font>
						</font><code class="literal">NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">没有从任何其它值区别对待：</font>
						</font><code class="literal">NULL &lt;=&gt; NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，就像</font>
							<font style="vertical-align: inherit;">任何其他
							</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font><code class="literal"><em class="replaceable"><code>N</code></em> &lt;=&gt;
							<em class="replaceable"><code>N</code></em></code>
						<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
						<font style="vertical-align: inherit;"></font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								但是，对于基于</font>
						</font><code class="literal">=</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">运算符的连接，
							</font>
						</font><code class="literal">NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">与非</font>
						</font><code class="literal">NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值</font>
							<font style="vertical-align: inherit;">不同</font>
							<font style="vertical-align: inherit;">：
							</font>
							<font style="vertical-align: inherit;">当</font>
							<font style="vertical-align: inherit;">或
							</font>
							<font style="vertical-align: inherit;">（或两者）
							</font>
							<font style="vertical-align: inherit;">时不成立
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">这会影响
							</font>
							<font style="vertical-align: inherit;">对表单比较的访问</font>
							<font style="vertical-align: inherit;">：如果当前值为，</font>
							<font style="vertical-align: inherit;">则</font>
							<font style="vertical-align: inherit;">MySQL不会访问该表
							</font>
						</font><code class="literal"><em class="replaceable"><code>expr1</code></em> =
							<em class="replaceable"><code>expr2</code></em></code>
						<font style="vertical-align: inherit;"></font><em class="replaceable"><code>expr1</code></em>
						<font style="vertical-align: inherit;"></font><em class="replaceable"><code>expr2</code></em>
						<font style="vertical-align: inherit;"></font><code class="literal">NULL</code>
						<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
						<font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>tbl_name.key</code></em>
							=
							<em class="replaceable"><code>expr</code></em></code>
						<font style="vertical-align: inherit;"></font><em class="replaceable"><code>expr</code></em>
						<font style="vertical-align: inherit;"></font><code class="literal">NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，因为比较不能为真。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于</font>
						</font><code class="literal">=</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">比较，</font>
						</font><code class="literal">NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表格中有</font>
							<font style="vertical-align: inherit;">多少</font>
							<font style="vertical-align: inherit;">值</font>
							<font style="vertical-align: inherit;">无关紧要</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">出于优化目的，相关值是非平均大小</font>
						</font><code class="literal">NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值组</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">但是，MySQL目前不支持收集或使用该平均大小。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								表，您可以</font>
							<font style="vertical-align: inherit;">分别</font>
							<font style="vertical-align: inherit;">通过</font>
						</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量</font>
							<font style="vertical-align: inherit;">控制表统计信息的收集
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">这些变量有三个可能的值，它们的不同之处如下：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当变量设置为</font>
									</font><code class="literal">nulls_equal</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">all时</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值都被视为相同（即，它们都形成单个值组）。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值组大小远远高于平均非</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值组大小，则此方法会向上倾斜平均值组大小。</font>
										<font style="vertical-align: inherit;">这使得优化器中的索引对于查找非</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值的</font>
										<font style="vertical-align: inherit;">连接的实际效果不如它</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">因此，该
										</font>
									</font><code class="literal">nulls_equal</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">方法可能导致优化器</font>
									</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在应该的时候</font>
										<font style="vertical-align: inherit;">不使用索引进行
										</font>
										<font style="vertical-align: inherit;">访问。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当变量设置为时
										</font>
									</font><code class="literal">nulls_unequal</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											值不被视为相同。</font>
										<font style="vertical-align: inherit;">相反，每个
										</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值形成一个大小为1的单独值组。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果您有许多</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值，则此方法会向下倾斜平均值组大小。</font>
										<font style="vertical-align: inherit;">如果平均非</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值组大小很大，</font>
										<font style="vertical-align: inherit;">则将</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">每个</font>
										<font style="vertical-align: inherit;">计</font>
										<font style="vertical-align: inherit;">数值作为大小为1的组会导致优化器高估查找非</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											值的</font>
										<font style="vertical-align: inherit;">联接的索引</font>
										<font style="vertical-align: inherit;">值。</font>
										<font style="vertical-align: inherit;">因此，</font>
										<font style="vertical-align: inherit;">当其他方法可能更好时</font>
										<font style="vertical-align: inherit;">，该</font>
									</font><code class="literal">nulls_unequal</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											方法可能导致优化器使用此索引进行
										</font>
									</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">查找。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当变量设置为时
										</font>
									</font><code class="literal">nulls_ignored</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											将忽略值。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果您倾向于使用许多使用</font>
						</font><code class="literal">&lt;=&gt;</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">而不是</font>
							<font style="vertical-align: inherit;">使用的连接
							</font>
						</font><code class="literal">=</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，则
							</font>
						</font><code class="literal">NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值在比较中并不特殊，而且一个</font>
						</font><code class="literal">NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">等于另一个。</font>
							<font style="vertical-align: inherit;">在这种情况下，</font>
						</font><code class="literal">nulls_equal</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">是适当的统计方法。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量具有全局值; </font>
							<font style="vertical-align: inherit;">该
							</font>
						</font><a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量有全局和会话值。</font>
							<font style="vertical-align: inherit;">设置全局值会影响相应存储引擎中表的统计信息收集。</font>
							<font style="vertical-align: inherit;">设置会话值仅影响当前客户端连接的统计信息收集。</font>
							<font style="vertical-align: inherit;">这意味着您可以通过设置会话值来强制使用给定方法重新生成表的统计信息，而不会影响其他客户端
							</font>
						</font><a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要重新生成</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表统计信息，可以使用以下任一方法：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											执行</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk --stats_method = </font>
												</font><em class="replaceable"><code>method_name</code></em>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														--analyze</font>
												</font>
											</strong></span></a>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											更改表以使其统计信息过期（例如，插入行然后将其删除），然后设置
										</font>
									</font><a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">并发出</font>
									</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											语句
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								关于使用</font>
						</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和的
							</font>
							<font style="vertical-align: inherit;">一些警告
							</font>
						</font><a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您可以强制显式收集表统计信息，如上所述。</font>
										<font style="vertical-align: inherit;">但是，MySQL也可能会自动收集统计信息。</font>
										<font style="vertical-align: inherit;">例如，如果在执行表的语句过程中，其中一些语句修改了表，MySQL可能会收集统计信息。</font>
										<font style="vertical-align: inherit;">（例如，对于批量插入或删除，或某些</font>
									</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句，</font>
										<font style="vertical-align: inherit;">可能会发生
										</font>
										<font style="vertical-align: inherit;">这种情况。）如果发生这种情况，则使用任何值收集统计信息
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_method"><code class="literal">innodb_stats_method</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或
										</font>
									</font><a class="link" href="server-administration.html#sysvar_myisam_stats_method"><code class="literal">myisam_stats_method</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">当时有。</font>
										<font style="vertical-align: inherit;">因此，如果使用一种方法收集统计信息，但在稍后自动收集表的统计信息时将系统变量设置为另一种方法，则将使用另一种方法。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											无法确定使用哪种方法为给定表生成统计信息。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											这些变量仅适用于</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表。</font>
										<font style="vertical-align: inherit;">其他存储引擎只有一种收集表统计信息的方法。</font>
										<font style="vertical-align: inherit;">通常它更接近</font>
									</font><code class="literal">nulls_equal</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">方法。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="index-btree-hash"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.9 B树和哈希索引的比较</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706503488"></a><a class="indexterm" name="idm140091706502448"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								了解B树和哈希数据结构有助于预测不同查询在索引中使用这些数据结构的不同存储引擎上的执行情况，特别是对于</font>
						</font><code class="literal">MEMORY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">允许您选择B树或哈希索引</font>
							<font style="vertical-align: inherit;">的</font>
							<font style="vertical-align: inherit;">存储引擎。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p><a class="xref" href="optimization.html#btree-index-characteristics" title="B树指数特征">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">B树指数特征</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#hash-index-characteristics" title="哈希指数特征">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">哈希指数特征</font>
										</font>
									</a></p>
							</li>
						</ul>
					</div>

					<div class="simplesect">

						<div class="titlepage">
							<div>

								<div class="simple">
									<h4 class="title"><a name="btree-index-characteristics"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">B树指数特征</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091706496400"></a><a class="indexterm" name="idm140091706494912"></a><a class="indexterm"
						 name="idm140091706493424"></a><a class="indexterm" name="idm140091706491936"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									A B树索引可以在使用表达式中使用的对列的比较
								</font>
							</font><a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，或</font>
							</font><a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">运营商。</font>
							</font><a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果参数to </font>
							</font><a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是一个不以通配符开头的常量字符串，则</font>
								<font style="vertical-align: inherit;">索引也可用于</font>
								<font style="vertical-align: inherit;">比较
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">例如，以下</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句使用索引：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIKE'Patrick％';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIKE'Pat％_ck％';
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在第一个语句中，仅</font>
								<font style="vertical-align: inherit;">考虑</font>
								<font style="vertical-align: inherit;">具有行的行</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">在第二个语句中，仅</font>
								<font style="vertical-align: inherit;">考虑</font>
								<font style="vertical-align: inherit;">具有行的行</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font><code class="literal">'Patrick'
								&lt;= <em class="replaceable"><code>key_col</code></em> &lt;
								'Patricl'</code>
							<font style="vertical-align: inherit;"></font><code class="literal">'Pat' &lt;=
								<em class="replaceable"><code>key_col</code></em> &lt; 'Pau'</code>
							<font style="vertical-align: inherit;"></font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句不使用索引：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIKE'％Patrick％';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIKE </font></font><em class="replaceable"><code>other_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在第一个语句中，</font>
							</font><a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									值以通配符开头。</font>
								<font style="vertical-align: inherit;">在第二个语句中，该</font>
							</font><a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值不是常量。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果您使用</font>
								<font style="vertical-align: inherit;">且
								</font>
								<font style="vertical-align: inherit;">超过三个字符，MySQL使用</font><span class="firstterm">
									<font style="vertical-align: inherit;">Turbo Boyer-Moore算法</font>
								</span>
								<font style="vertical-align: inherit;">初始化字符串的模式，然后使用此模式更快地执行搜索。
								</font>
							</font><code class="literal">... LIKE
								'%<em class="replaceable"><code>string</code></em>%'</code>
							<font style="vertical-align: inherit;"></font><em class="replaceable"><code>string</code></em>
							<font style="vertical-align: inherit;"></font><span class="firstterm">
								<font style="vertical-align: inherit;"></font>
							</span>
							<font style="vertical-align: inherit;"></font>
						</p><a class="indexterm" name="idm140091706462144"></a><a class="indexterm" name="idm140091706460656"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用</font>
							</font><code class="literal"><em class="replaceable"><code>col_name</code></em> IS
								NULL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">雇用索引</font>
								<font style="vertical-align: inherit;">的搜索</font>
								<font style="vertical-align: inherit;">是否
								</font>
							</font><em class="replaceable"><code>col_name</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">已编制索引。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									不跨越</font>
								<font style="vertical-align: inherit;">子句中</font>
								<font style="vertical-align: inherit;">所有</font>
							</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">级别的
								</font>
								<font style="vertical-align: inherit;">任何索引
								</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">不用于优化查询。</font>
								<font style="vertical-align: inherit;">换句话说，为了能够使用索引，必须在每个</font>
							</font><a class="link" href="functions.html#operator_and"><code class="literal">AND</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">组中</font>
								<font style="vertical-align: inherit;">使用索引的前缀
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句使用索引：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...... WHERE </font></font><em class="replaceable"><code>index_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>index_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2 AND </font></font><em class="replaceable"><code>other_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 3</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    / * </font></font><em class="replaceable"><code>index</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 OR </font></font><em class="replaceable"><code>index</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2 * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...... WHERE </font></font><em class="replaceable"><code>index</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1或A = 10 AND </font></font><em class="replaceable"><code>index</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    / *优化如“ </font></font><em class="replaceable"><code>index_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='hello'”* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...... WHERE </font></font><em class="replaceable"><code>index_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">='你好'AND </font></font><em class="replaceable"><code>index_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 5</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    / *可以使用索引</font></font><em class="replaceable"><code>index1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但不能使用</font></font><em class="replaceable"><code>index2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><em class="replaceable"><code>index3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...... WHERE </font></font><em class="replaceable"><code>index1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>index2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2 OR </font></font><em class="replaceable"><code>index1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 3 AND </font></font><em class="replaceable"><code>index3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 3;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这些</font>
							</font><code class="literal">WHERE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句
								</font>
							</font><span class="emphasis"><em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">不</font>
									</font>
								</em></span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">使用索引：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    / * </font></font><em class="replaceable"><code>index_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未使用* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...... WHERE </font></font><em class="replaceable"><code>index_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>index_part3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    / *在WHERE子句的两个部分中都没有使用索引* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...... WHERE </font></font><em class="replaceable"><code>index</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1或A = 10</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    / *没有索引跨越所有行* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...... WHERE </font></font><em class="replaceable"><code>index_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 OR </font></font><em class="replaceable"><code>index_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									有时MySQL不使用索引，即使有索引也是如此。</font>
								<font style="vertical-align: inherit;">发生这种情况的一种情况是，优化器估计使用索引将需要MySQL访问表中非常大比例的行。</font>
								<font style="vertical-align: inherit;">（在这种情况下，表扫描可能会快得多，因为它需要较少的搜索。）但是，如果这样的查询</font>
							</font><code class="literal">LIMIT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">只用于检索某些行，MySQL无论如何都会使用索引，因为它可以更快地找到在结果中返回几行。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="hash-index-characteristics"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">哈希指数特征</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091706435504"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									哈希索引与刚才讨论的有些不同：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它们仅用于使用</font>
										</font><code class="literal">=</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或</font>
										</font><code class="literal">&lt;=&gt;</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												运算符的</font>
											<font style="vertical-align: inherit;">相等比较
											</font>
											<font style="vertical-align: inherit;">（但</font>
											<font style="vertical-align: inherit;">速度</font>
										</font><span class="emphasis"><em>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">非常</font>
												</font>
											</em></span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">快）。</font>
											<font style="vertical-align: inherit;">它们不用于比较运算符，例如
											</font>
										</font><code class="literal">&lt;</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">找到一系列值。</font>
											<font style="vertical-align: inherit;">依赖于这种类型的单值查找的系统被称为</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">“ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">键值存储</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;"> ”</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> ; </font>
											<font style="vertical-align: inherit;">要将MySQL用于此类应用程序，请尽可能使用哈希索引。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												优化器无法使用哈希索引来加速
											</font>
										</font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">操作。</font>
											<font style="vertical-align: inherit;">（此类索引不能用于按顺序搜索下一个条目。）
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MySQL无法确定两个值之间大约有多少行（范围优化器使用它来决定使用哪个索引）。</font>
											<font style="vertical-align: inherit;">如果将a </font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表更改为哈希索引
											</font>
										</font><code class="literal">MEMORY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表，</font>
											<font style="vertical-align: inherit;">则可能会影响某些查询</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												只有整个键可用于搜索行。</font>
											<font style="vertical-align: inherit;">（使用B树索引，键的任何最左边的前缀都可用于查找行。）
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="index-extensions"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.10索引扩展的使用</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706422144"></a>
					<p>
						<a class="link" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎"><code class="literal">InnoDB</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">通过将主键列附加到每个辅助索引来自动扩展它们。</font>
							<font style="vertical-align: inherit;">考虑这个表定义：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  i1 INT NOT NULL DEFAULT 0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  i2 INT NOT NULL DEFAULT 0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  d DATE DEFAULT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PRIMARY KEY（i1，i2），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  INDEX k_d（d）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = InnoDB;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								此表定义列上的主键</font>
						</font><code class="literal">(i1,
							i2)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">它还</font>
						</font><code class="literal">k_d</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在列上</font>
							<font style="vertical-align: inherit;">定义了二级索引
							</font>
						</font><code class="literal">(d)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，但在内部</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">扩展了此索引并将其视为列</font>
						</font><code class="literal">(d, i1, i2)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								在确定如何以及是否使用该索引时，优化程序会考虑扩展二级索引的主键列。</font>
							<font style="vertical-align: inherit;">这可以带来更高效的查询执行计划和更好的性能。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化器可以使用扩展二级索引
							</font>
						</font><code class="literal">ref</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，</font>
						</font><code class="literal">range</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><code class="literal">index_merge</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">索引访问，松散索引扫描访问，参加和排序优化，以及
							</font>
						</font><a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">/ </font>
						</font><a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下示例显示优化程序是否使用扩展二级索引如何影响执行计划。</font>
							<font style="vertical-align: inherit;">假设</font>
						</font><code class="literal">t1</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">填充了这些行：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入t1值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（1,1，'1998-01-01'），（1,2，'1999-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（1,3，'2000-01-01'），（1,4，'2001-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（1,5，'2002-01-01'），（2,1，'1998-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（2,2，'1999-01-01'），（2,3，'2000-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（2,4，'2001-01-01'），（2,5，'2002-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（3,1，'1998-01-01'），（3,2，'1999-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（3,3，'2000-01-01'），（3,4，'2001-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（3,5，'2002-01-01'），（4,1，'1998-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（4,2，'1999-01-01'），（4,3，'2000-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（4,4，'2001-01-01'），（4,5，'2002-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（5,1，'1998-01-01'），（5,2，'1999-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（5,3，'2000-01-01'），（5,4，'2001-01-01'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（5,5，'2002-01-01'）;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								现在考虑这个查询：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN SELECT COUNT（*）FROM t1 WHERE i1 = 3 AND d ='2000-01-01'
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								执行计划取决于是否使用扩展索引。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								当优化器不考虑索引扩展时，它</font>
						</font><code class="literal">k_d</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">仅</font>
							<font style="vertical-align: inherit;">将索引</font>
							<font style="vertical-align: inherit;">视为</font>
							<font style="vertical-align: inherit;">索引</font>
						</font><code class="literal">(d)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">对于查询产生此结果：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT COUNT(*) FROM t1 WHERE i1 = 3 AND d = '2000-01-01'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：ref</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：PRIMARY，k_d</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          key：k_d</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：const</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用在哪里; </font><font style="vertical-align: inherit;">使用索引</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								当优化需要索引扩展到帐户，它把</font>
						</font><code class="literal">k_d</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">作为</font>
						</font><code class="literal">(d, i1, i2)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">在这种情况下，它可以使用最左边的索引前缀</font>
						</font><code class="literal">(d,
							i1)</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">来生成更好的执行计划：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT COUNT(*) FROM t1 WHERE i1 = 3 AND d = '2000-01-01'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：ref</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：PRIMARY，k_d</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          key：k_d</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：const，const</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用索引</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								在这两种情况下，都</font>
						</font><code class="literal">key</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表示优化器将使用二级索引，</font>
						</font><code class="literal">k_d</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">但</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">输出显示使用扩展索引的这些改进：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<code class="literal">key_len</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">从4个字节到8个字节去，表明键查找中使用的列</font>
									</font><code class="literal">d</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											和</font>
									</font><code class="literal">i1</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，而不仅仅是</font>
									</font><code class="literal">d</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该</font>
									</font><code class="literal">ref</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">从价值变动
										</font>
									</font><code class="literal">const</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">到</font>
									</font><code class="literal">const,const</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											，因为键查找使用两个关键部分，没有之一。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											的</font>
									</font><code class="literal">rows</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">计数降低从5到1，表明</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">应该需要检查更少的行，以产生结果。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该</font>
									</font><code class="literal">Extra</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值从变化
										</font>
									</font><code class="literal">Using where; Using index</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">到
										</font>
									</font><code class="literal">Using index</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">这意味着只能使用索引读取行，而无需查询数据行中的列。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								使用扩展索引的优化器行为的差异也可以通过以下方式看出</font>
						</font><a class="link" href="sql-syntax.html#show-status" title="13.7.6.35 SHOW STATUS语法"><code class="literal">SHOW
								STATUS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FLUSH TABLE t1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
冲洗状态;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT COUNT（*）FROM t1 WHERE i1 = 3 AND d ='2000-01-01';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHOW STATUS LIKE'handler_read％'</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								前面的语句包括</font>
						</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH
								TABLES</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">并</font>
						</font><a class="link" href="sql-syntax.html#flush-status"><code class="literal">FLUSH STATUS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								刷新表缓存并清除状态计数器。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								没有索引扩展，</font>
						</font><a class="link" href="sql-syntax.html#show-status" title="13.7.6.35 SHOW STATUS语法"><code class="literal">SHOW
								STATUS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">产生以下结果：
							</font>
						</font>
					</p>
					<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ----------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Variable_name | </font><font style="vertical-align: inherit;">价值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_first | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_key | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_last | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_next | </font><font style="vertical-align: inherit;">5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_prev | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_rnd | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_rnd_next | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + ------- +</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								使用索引扩展，</font>
						</font><a class="link" href="sql-syntax.html#show-status" title="13.7.6.35 SHOW STATUS语法"><code class="literal">SHOW
								STATUS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">生成此结果。</font>
							<font style="vertical-align: inherit;">该
							</font>
						</font><a class="link" href="server-administration.html#statvar_Handler_read_next"><code class="literal">Handler_read_next</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值从5减少到1，表明更有效地使用索引：
							</font>
						</font>
					</p>
					<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ----------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Variable_name | </font><font style="vertical-align: inherit;">价值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_first | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_key | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_last | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_next | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_prev | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_rnd | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Handler_read_rnd_next | </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + ------- +</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量</font>
							<font style="vertical-align: inherit;">
								的</font>
						</font><code class="literal">use_index_extensions</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">标志
							</font>
						</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">允许在确定如何使用</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表的二级索引</font>
							<font style="vertical-align: inherit;">时控制优化程序是否将主键列考虑在内
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">默认情况下，
							</font>
						</font><code class="literal">use_index_extensions</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">已启用。</font>
							<font style="vertical-align: inherit;">要检查禁用索引扩展是否会提高性能，请使用以下语句：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='use_index_extensions = off';
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化程序对索引扩展的使用受索引（16）中关键部分数量和最大密钥长度（3072字节）的通常限制。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="generated-column-index-optimizations"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.11生成列索引的优化程序使用</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL支持生成列的索引。</font>
							<font style="vertical-align: inherit;">例如：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（f1 INT，gc INT AS（f1 + 1）STORED，INDEX（gc））;
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								生成的列</font>
						</font><code class="literal">gc</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">被定义为表达式</font>
						</font><code class="literal">f1 + 1</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">该列也被编入索引，优化器可以在执行计划构建期间考虑该索引。</font>
							<font style="vertical-align: inherit;">在以下查询中，该
							</font>
						</font><code class="literal">WHERE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">子句引用</font>
						</font><code class="literal">gc</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								并且优化器会考虑该列上的索引是否产生更有效的计划：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE gc&gt; 9;
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化器可以使用生成列上的索引来生成执行计划，即使在没有按名称查询这些列的情况下也没有直接引用。</font>
							<font style="vertical-align: inherit;">会发生此如果
							</font>
						</font><code class="literal">WHERE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，</font>
						</font><code class="literal">ORDER BY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">或
							</font>
						</font><code class="literal">GROUP BY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">条款是指一些索引生成列的定义相匹配的表达式。</font>
							<font style="vertical-align: inherit;">以下查询不直接引用</font>
						</font><code class="literal">gc</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								但使用与以下定义匹配的表达式
							</font>
						</font><code class="literal">gc</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE f1 + 1&gt; 9;
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化器识别出表达</font>
						</font><code class="literal">f1 +
							1</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">的定义相匹配</font>
						</font><code class="literal">gc</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，并且</font>
						</font><code class="literal">gc</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">被索引，因此它认为执行计划在施工期间的索引。</font>
							<font style="vertical-align: inherit;">你可以看到这个
							</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN SELECT * FROM t1 WHERE f1 + 1 &gt; 9\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SIMPLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：范围</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：gc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          关键：gc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用索引条件</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								实际上，优化器已将表达式替换为与表达式</font>
						</font><code class="literal">f1
							+ 1</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">匹配的生成列的名称。</font>
							<font style="vertical-align: inherit;">在</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								显示</font>
							<font style="vertical-align: inherit;">的扩展</font>
							<font style="vertical-align: inherit;">信息中</font>
							<font style="vertical-align: inherit;">可用的重写查询中也很明显</font>
						</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
								WARNINGS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW WARNINGS\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  等级：注意</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   代码：1003</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消息：/ * select＃1 * / select`test` .t1` .f1` AS`f1`，`test` .t1``gc`</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         AS`gc`来自`test` .t1` where（`test` .t1``gc`&gt; 9）</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下限制和条件适用于优化程序使用生成的列索引：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于与生成的列定义匹配的查询表达式，表达式必须相同且必须具有相同的结果类型。</font>
										<font style="vertical-align: inherit;">例如，如果生成的列表达式是</font>
									</font><code class="literal">f1 + 1</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，则优化程序将在查询使用时识别匹配
										</font>
									</font><code class="literal">1 + f1</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，或者将</font>
									</font><code class="literal">f1 + 1</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											（整数表达式）与字符串进行比较。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											优化适用于这些操作符：
										</font>
									</font><a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，和
										</font>
									</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于除</font>
									</font><a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
										<font style="vertical-align: inherit;">之外的运算符
										</font>
									</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，任一操作数都可以由匹配的生成列替换。</font>
										<font style="vertical-align: inherit;">对于
										</font>
									</font><a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，只有第一个参数可以由匹配的生成列替换，其他参数必须具有相同的结果类型。
										</font>
									</font><a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">并且
										</font>
									</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">尚不支持涉及JSON值的比较。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											必须将生成的列定义为至少包含函数调用或前一项中提到的运算符之一的表达式。</font>
										<font style="vertical-align: inherit;">表达式不能包含对另一列的简单引用。</font>
										<font style="vertical-align: inherit;">例如，</font>
									</font><code class="literal">gc INT AS (f1) STORED</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">仅包含列引用，因此</font>
									</font><code class="literal">gc</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">不考虑</font>
										<font style="vertical-align: inherit;">索引
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											为了将字符串与索引生成的列进行比较，这些列从返回带引号的字符串的JSON函数计算值，</font>
									</font><a class="link" href="functions.html#function_json-unquote"><code class="literal">JSON_UNQUOTE()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在列定义中需要从函数值中删除额外的引号。</font>
										<font style="vertical-align: inherit;">（为了直接比较字符串和函数结果，JSON比较器处理引号删除，但索引查找不会发生这种情况。）例如，不要像这样编写列定义：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doc_name TEXT AS（JSON_EXTRACT（jdoc，'$ .name'））已存储
</font></font></pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											写这样：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doc_name TEXT AS（JSON_UNQUOTE（JSON_EXTRACT（jdoc，'$ .name'）））STORED
</font></font></pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用后一个定义，优化器可以检测这两个比较的匹配：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... WHERE JSON_EXTRACT（jdoc，'$ .name'）=' </font></font><em class="replaceable"><code>some_string</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... WHERE JSON_UNQUOTE（JSON_EXTRACT（jdoc，'$。name'））=' </font></font><em class="replaceable"><code>some_string</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'...
</font></font></pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果没有</font>
									</font><a class="link" href="functions.html#function_json-unquote"><code class="literal">JSON_UNQUOTE()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">列定义，优化程序仅会检测到第一个比较的匹配项。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果优化器选择了错误的索引，则可以使用索引提示来禁用它，并强制优化器进行不同的选择。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="invisible-indexes"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.12隐形指数</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706299376"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL支持隐形索引; </font>
							<font style="vertical-align: inherit;">也就是说，优化器未使用的索引。</font>
							<font style="vertical-align: inherit;">该功能适用​​于主键以外的索引（显式或隐式）。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								默认情况下，索引是可见的。</font>
							<font style="vertical-align: inherit;">要明确控制指标能见度新的索引，使用一个</font>
						</font><code class="literal">VISIBLE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">或
							</font>
						</font><code class="literal">INVISIBLE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">关键字作为指标定义的一部分</font>
						</font><a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE语法"><code class="literal">CREATE
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX语法"><code class="literal">CREATE
								INDEX</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">或者
							</font>
						</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  我是INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  j INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  k INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  INDEX i_idx（i）INVISIBLE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = InnoDB;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE INDEX j_idx ON t1（j）INVISIBLE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE t1 ADD INDEX k_idx（k）INVISIBLE;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要更改现有索引的可见性，请</font>
							<font style="vertical-align: inherit;">
								在</font>
							<font style="vertical-align: inherit;">
								操作中</font>
							<font style="vertical-align: inherit;">使用
							</font>
						</font><code class="literal">VISIBLE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">或</font>
						</font><code class="literal">INVISIBLE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">关键字</font>
						</font><code class="literal">ALTER TABLE ... ALTER INDEX</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE t1 ALTER INDEX i_idx INVISIBLE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE t1 ALTER INDEX i_idx VISIBLE;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								可以从</font>
						</font><a class="link" href="information-schema.html#statistics-table" title="25.26 INFORMATION_SCHEMA统计表"><code
							 class="literal">INFORMATION_SCHEMA.STATISTICS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表或</font>
						</font><a class="link" href="sql-syntax.html#show-index" title="13.7.6.22 SHOW INDEX语法"><code class="literal">SHOW
								INDEX</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">输出中</font>
							<font style="vertical-align: inherit;">获得有关索引是可见还是不可见的信息
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">例如：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT INDEX_NAME, IS_VISIBLE</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.STATISTICS</code></strong>
       <strong class="userinput"><code>WHERE TABLE_SCHEMA = 'db1' AND TABLE_NAME = 't1';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">INDEX_NAME | </font><font style="vertical-align: inherit;">IS_VISIBLE |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">i_idx | </font><font style="vertical-align: inherit;">是的|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">j_idx | </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">k_idx | </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------ + ------------ +</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								不可见索引可以测试删除索引对查询性能的影响，而不会进行破坏性更改，如果索引需要，则必须撤消。</font>
							<font style="vertical-align: inherit;">对于大型表而言，删除和重新添加索引可能是昂贵的，而使其不可见且可见是快速的就地操作。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果优化器需要或使用实际上不可见的索引，有几种方法可以注意其缺席对表的查询的影响：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											包含引用不可见索引的索引提示的查询会发生错误。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											性能架构数据显示受影响查询的工作负载增加。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											查询具有不同的
										</font>
									</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">执行计划。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											查询显示在以前未出现的慢查询日志中。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<a class="indexterm" name="idm140091706274448"></a><a class="indexterm" name="idm140091706272928"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量</font>
							<font style="vertical-align: inherit;">
								的</font>
						</font><code class="literal">use_invisible_indexes</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">标志
							</font>
						</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">控制优化程序是否使用不可见索引来构建查询执行计划。</font>
							<font style="vertical-align: inherit;">如果该标志是
							</font>
						</font><code class="literal">off</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">（缺省值），则优化器会忽略不可见的索引（与引入此标志之前的行为相同）。</font>
							<font style="vertical-align: inherit;">如果该标志是
							</font>
						</font><code class="literal">on</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，则不可见索引保持不可见，但优化程序会将它们考虑在内以执行计划构建。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								索引可见性不会影响索引维护。</font>
							<font style="vertical-align: inherit;">例如，每次对表行的更改都会继续更新索引，并且唯一索引可防止将重复项插入到列中，无论索引是可见还是不可见。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								没有显式主键的表可能仍然具有有效的隐式主键，如果</font>
							<font style="vertical-align: inherit;">列</font>
						</font><code class="literal">UNIQUE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								上</font>
							<font style="vertical-align: inherit;">有任何</font>
							<font style="vertical-align: inherit;">索引</font>
						</font><code class="literal">NOT NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">在这种情况下，第一个这样的索引将相同的约束放在表行上作为显式主键，并且该索引不能变为不可见。</font>
							<font style="vertical-align: inherit;">请考虑以下表定义：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建表t2（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  我没有，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  j INT NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  独特的j_idx（j）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = InnoDB;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该定义不包含显式主键，但</font>
						</font><code class="literal">NOT NULL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">列</font>
							<font style="vertical-align: inherit;">上的索引</font>
						</font><code class="literal">j</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								将相同的约束放在行上作为主键，并且不能使其不可见：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE t2 ALTER INDEX j_idx INVISIBLE;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
错误3522（HY000）：主键索引不能是不可见的。</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								现在假设将一个显式主键添加到表中：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改表t2添加主要密钥（i）;
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								显式主键不能隐藏。</font>
							<font style="vertical-align: inherit;">此外，唯一索引</font>
						</font><code class="literal">j</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">不再充当隐式主键，因此可以使其不可见：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE t2 ALTER INDEX j_idx INVISIBLE;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询正常，0行受影响（0.03秒）</font></font><font></font>
</pre>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="descending-indexes"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.13降序索引</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706254096"></a><a class="indexterm" name="idm140091706253024"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL支持降序索引：</font>
						</font><code class="literal">DESC</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在索引定义中不再被忽略，但会导致按键降序存储键值。</font>
							<font style="vertical-align: inherit;">以前，索引可能会以相反的顺序扫描，但性能会受到影响。</font>
							<font style="vertical-align: inherit;">可以按正向顺序扫描降序索引，这样更有效。</font>
							<font style="vertical-align: inherit;">当最有效的扫描顺序混合某些列的升序和其他列的降序时，降序索引还使优化器可以使用多列索引。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								请考虑以下表定义，其中包含两列和四列两列索引定义，用于列上升序和降序索引的各种组合：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  c1 INT，c2 INT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  INDEX idx1（c1 ASC，c2 ASC），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  INDEX idx2（c1 ASC，c2 DESC），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  INDEX idx3（c1 DESC，c2 ASC），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  INDEX idx4（c1 DESC，c2 DESC）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								表定义产生四个不同的索引。</font>
							<font style="vertical-align: inherit;">优化器可以为每个</font>
						</font><code class="literal">ORDER BY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">子句</font>
							<font style="vertical-align: inherit;">执行正向索引扫描
							</font>
							<font style="vertical-align: inherit;">，无需使用
							</font>
						</font><code class="literal">filesort</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">操作：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ORDER BY c1 ASC，c2 ASC  - 优化器可以使用idx1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ORDER BY c1 DESC，c2 DESC  - 优化器可以使用idx4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ORDER BY c1 ASC，c2 DESC  - 优化器可以使用idx2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ORDER BY c1 DESC，c2 ASC  - 优化器可以使用idx3</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								降序索引的使用受以下条件限制：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											只有</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">存储引擎</font>
										<font style="vertical-align: inherit;">支持降序索引
										</font>
										<font style="vertical-align: inherit;">，具有以下限制：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														如果索引包含降序索引键列或主键包含降序索引列，则不支持对辅助索引进行更改缓冲。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														该</font>
												</font><code class="literal">InnoDB</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">SQL解析器不使用降序索引。</font>
													<font style="vertical-align: inherit;">对于</font>
												</font><code class="literal">InnoDB</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														全文搜索，这意味着</font>
												</font><code class="literal">FTS_DOC_ID</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">索引表</font>
													<font style="vertical-align: inherit;">的</font>
													<font style="vertical-align: inherit;">列</font>
													<font style="vertical-align: inherit;">所需</font>
													<font style="vertical-align: inherit;">的索引不能定义为降序索引。</font>
													<font style="vertical-align: inherit;">有关更多信息，请参见
													</font>
												</font><a class="xref" href="innodb-storage-engine.html#innodb-fulltext-index" title="15.6.2.4 InnoDB FULLTEXT索引">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">第15.6.2.4节“InnoDB FULLTEXT索引”</font>
													</font>
												</a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											升序索引可用的所有数据类型都支持降序索引。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											降序索引支持普通（nongenerated）和生成的列（包括</font>
									</font><code class="literal">VIRTUAL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><code class="literal">STORED</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">DISTINCT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;"> 可以使用包含匹配列的任何索引，包括降序键部分。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											具有降序关键部分的索引不用于
										</font>
									</font><a class="link" href="functions.html#function_min"><code class="literal">MIN()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">/ </font>
									</font><a class="link" href="functions.html#function_max"><code class="literal">MAX()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											优化调用聚合函数但没有</font>
									</font><code class="literal">GROUP BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">子句的查询。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											支持降序索引</font>
									</font><code class="literal">BTREE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">但不</font>
										<font style="vertical-align: inherit;">支持
										</font>
									</font><code class="literal">HASH</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											索引。</font>
										<font style="vertical-align: inherit;">索引</font>
									</font><code class="literal">FULLTEXT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或</font>
									</font><code class="literal">SPATIAL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											索引</font>
										<font style="vertical-align: inherit;">不支持降序
										</font>
										<font style="vertical-align: inherit;">索引。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											明确指定</font>
									</font><code class="literal">ASC</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">并
										</font>
									</font><code class="literal">DESC</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">为代号
										</font>
									</font><code class="literal">HASH</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，</font>
									</font><code class="literal">FULLTEXT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><code class="literal">SPATIAL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">一个错误的索引结果。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="timestamp-lookups"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.3.14 TIMESTAMP列的索引查找</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091706219104"></a><a class="indexterm" name="idm140091706217648"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								时间值</font>
						</font><a class="link" href="data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">TIMESTAMP</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">作为UTC值</font>
							<font style="vertical-align: inherit;">存储在
							</font>
							<font style="vertical-align: inherit;">列中，插入到</font>
						</font><a class="link" href="data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">TIMESTAMP</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">列中</font>
							<font style="vertical-align: inherit;">和从</font>
							<font style="vertical-align: inherit;">列中</font>
							<font style="vertical-align: inherit;">检索的值
							</font>
							<font style="vertical-align: inherit;">在会话时区和UTC之间转换。</font>
							<font style="vertical-align: inherit;">（这与</font>
						</font><a class="link" href="functions.html#function_convert-tz"><code class="literal">CONVERT_TZ()</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">函数</font>
							<font style="vertical-align: inherit;">执行的转换类型相同
							</font>
							<font style="vertical-align: inherit;">。如果会话时区为UTC，则实际上没有时区转换。）
							</font>
						</font>
					</p><a class="indexterm" name="idm140091706211728"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								由于夏令时（DST）等本地时区更改的约定，UTC和非UTC时区之间的转换在两个方向上都不是一对一的。</font>
							<font style="vertical-align: inherit;">不同的UTC值在另一个时区可能不同。</font>
							<font style="vertical-align: inherit;">以下示例显示了在非UTC时区中变为相同的不同UTC值：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>CREATE TABLE tstable (ts TIMESTAMP);</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SET time_zone = 'UTC'; -- insert UTC values</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>INSERT INTO tstable VALUES</code></strong>
       <strong class="userinput"><code>('2018-10-28 00:30:00'),</code></strong>
       <strong class="userinput"><code>('2018-10-28 01:30:00');</code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>SELECT ts FROM tstable;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ts |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-10-28 00:30:00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-10-28 01:30:00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>SET time_zone = 'MET'; -- retrieve non-UTC values</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>SELECT ts FROM tstable;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ts |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-10-28 02:30:00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-10-28 02:30:00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font>
</pre>
					<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

						<div class="admon-title">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									注意
								</font>
							</font>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要使用诸如</font>
							</font><code class="literal">'MET'</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或的
								</font>
								<font style="vertical-align: inherit;">命名时区</font>
							</font><code class="literal">'Europe/Amsterdam'</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，必须正确设置时区表。</font>
								<font style="vertical-align: inherit;">有关说明，请参见
								</font>
							</font><a class="xref" href="server-administration.html#time-zone-support" title="5.1.13 MySQL服务器时区支持">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第5.1.13节“MySQL服务器时区支持”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								转换到</font>
						</font><code class="literal">'MET'</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">时区</font>
							<font style="vertical-align: inherit;">时，您可以看到两个不同的UTC值相同</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">这种现象可能导致给定</font>
						</font><a class="link" href="data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code class="literal">TIMESTAMP</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">列查询的</font>
							<font style="vertical-align: inherit;">结果不同
							</font>
							<font style="vertical-align: inherit;">，具体取决于优化程序是否使用索引来执行查询。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								假设查询使用</font>
						</font><code class="literal">WHERE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">子句</font>
							<font style="vertical-align: inherit;">从前面显示的表中选择值，</font>
							<font style="vertical-align: inherit;">以在</font>
						</font><code class="literal">ts</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">列中</font>
							<font style="vertical-align: inherit;">搜索
							</font>
							<font style="vertical-align: inherit;">单个特定值，例如用户提供的时间戳文字：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT ts FROM tstable</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里ts =' </font></font><em class="replaceable"><code>literal</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								进一步假设查询在以下条件下执行：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											会话时区不是UTC并且具有DST转换。</font>
										<font style="vertical-align: inherit;">例如：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET time_zone ='MET';
</font></font></pre>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;"></font><a class="link" href="data-types.html#datetime" title="11.3.1 DATE，DATETIME和TIMESTAMP类型"><code
										 class="literal">TIMESTAMP</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">由于DST转换，</font>
										<font style="vertical-align: inherit;">
											存储在</font>
										<font style="vertical-align: inherit;">列中的</font>
										<font style="vertical-align: inherit;">唯一UTC值在
										</font>
										<font style="vertical-align: inherit;">会话时区中不是唯一的。</font>
										<font style="vertical-align: inherit;">（前面显示的示例说明了如何发生这种情况。）
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该查询指定在会话时区中进入DST的小时内的搜索值。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								在这些条件下，</font>
						</font><code class="literal">WHERE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">对于非索引和索引查找，子句中</font>
							<font style="vertical-align: inherit;">的比较以
							</font>
							<font style="vertical-align: inherit;">不同的方式发生，并导致不同的结果：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果没有索引或优化程序无法使用它，则会话时区中会进行比较。</font>
										<font style="vertical-align: inherit;">优化器执行表扫描，在其中检索每个
										</font>
									</font><code class="literal">ts</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">列值，将其从UTC转换为会话时区，并将其与搜索值（也在会话时区中解释）进行比较：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT ts FROM tstable</code></strong>
       <strong class="userinput"><code>WHERE ts = '2018-10-28 02:30:00';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ts |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-10-28 02:30:00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-10-28 02:30:00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font>
</pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											因为存储的</font>
									</font><code class="literal">ts</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值被转换为会话时区，所以查询可以返回两个时间戳值，这两个时间戳值与UTC值不同但在会话时区中相等：在时钟更改时DST转换之前发生的一个值，和DST转换后发生的一个值。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果存在可用索引，则以UTC格式进行比较。</font>
										<font style="vertical-align: inherit;">优化器执行索引扫描，首先将搜索值从会话时区转换为UTC，然后将结果与UTC索引条目进行比较：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>ALTER TABLE tstable ADD INDEX (ts);</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>SELECT ts FROM tstable</code></strong>
       <strong class="userinput"><code>WHERE ts = '2018-10-28 02:30:00';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ts |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-10-28 02:30:00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font>
</pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在这种情况下，（转换的）搜索值仅与索引条目匹配，并且因为不同存储的UTC值的索引条目也是不同的，所以搜索值只能匹配其中一个。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								由于非索引和索引查找的优化器操作不同，查询在每种情况下都会产生不同的结果。</font>
							<font style="vertical-align: inherit;">非索引查找的结果将返回在会话时区中匹配的所有值。</font>
							<font style="vertical-align: inherit;">索引查找不能这样做：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											它在存储引擎中执行，该引擎仅知道UTC值。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于映射到相同UTC值的两个不同会话时区值，索引查找仅匹配相应的UTC索引条目并仅返回单个行。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								在前面的讨论中，存储的数据集
							</font>
						</font><code class="literal">tstable</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">恰好由不同的UTC值组成。</font>
							<font style="vertical-align: inherit;">在这种情况下，所显示的表单的所有使用索引的查询最多匹配一个索引条目。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果索引不是</font>
						</font><code class="literal">UNIQUE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，则表（和索引）可以存储给定UTC值的多个实例。</font>
							<font style="vertical-align: inherit;">例如，该</font>
						</font><code class="literal">ts</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">列可能包含UTC值的多个实例
							</font>
						</font><code class="literal">'2018-10-28 00:30:00'</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">在这种情况下，使用索引的查询将返回它们中的每一个（转换为</font>
						</font><code class="literal">'2018-10-28 02:30:00'</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">结果集中</font>
							<font style="vertical-align: inherit;">的MET值</font>
							<font style="vertical-align: inherit;">）。</font>
							<font style="vertical-align: inherit;">使用索引的查询仍然可以将转换后的搜索值与UTC索引条目中的单个值匹配，而不是匹配转换为会话时区中搜索值的多个UTC值。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果返回</font>
						</font><code class="literal">ts</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在会话时区中匹配的</font>
							<font style="vertical-align: inherit;">所有</font>
							<font style="vertical-align: inherit;">值</font>
							<font style="vertical-align: inherit;">很重要</font>
							<font style="vertical-align: inherit;">，则解决方法是禁止使用带有</font>
						</font><code class="literal">IGNORE
							INDEX</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">提示</font>
							<font style="vertical-align: inherit;">的索引</font>
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT ts FROM tstable</code></strong>
       <strong class="userinput"><code>IGNORE INDEX (ts)</code></strong>
       <strong class="userinput"><code>WHERE ts = '2018-10-28 02:30:00';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">ts |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-10-28 02:30:00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-10-28 02:30:00 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------- +</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于两个方向上的时区转换，同样缺乏一对一映射也发生在其他上下文中，例如使用</font>
						</font><a class="link" href="functions.html#function_from-unixtime"><code class="literal">FROM_UNIXTIME()</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><a class="link" href="functions.html#function_unix-timestamp"><code class="literal">UNIX_TIMESTAMP()</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">函数</font>
							<font style="vertical-align: inherit;">执行的转换
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">请参见
							</font>
						</font><a class="xref" href="functions.html#date-and-time-functions" title="12。7日期和时间函数">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第12.7节“日期和时间函数”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="optimizing-database-structure"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.4优化数据库结构</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#data-size">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.4.1优化数据大小</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-data-types">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.4.2优化MySQL数据类型</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-multi-tables">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.4.3优化许多表格</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#internal-temporary-tables">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.4.4 MySQL中的内部临时表使用</font>
									</font>
								</a></span></dt></dl>
				</div>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							在您作为数据库设计者的角色中，寻找组织模式，表和列的最有效方法。</font>
						<font style="vertical-align: inherit;">在调整应用程序代码时，您可以最小化I / O，将相关项目保持在一起，并提前计划，以便在数据量增加时性能保持高水平。</font>
						<font style="vertical-align: inherit;">从高效的数据库设计开始，团队成员可以更轻松地编写高性能的应用程序代码，并使数据库可以随着应用程序的发展和重写而持久。
						</font>
					</font>
				</p>
				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="data-size"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.4.1优化数据大小</font>
									</font>
								</h3>
							</div>
						</div>
					</div>
					<a class="indexterm" name="idm140091706155008"></a><a class="indexterm" name="idm140091706153520"></a><a class="indexterm"
					 name="idm140091706152032"></a><a class="indexterm" name="idm140091706150544"></a><a class="indexterm" name="idm140091706149056"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								设计表以最小化磁盘空间。</font>
							<font style="vertical-align: inherit;">这可以通过减少写入磁盘和从磁盘读取的数据量来实现巨大的改进。</font>
							<font style="vertical-align: inherit;">较小的表通常需要较少的主内存，而其内容在查询执行期间被主动处理。</font>
							<font style="vertical-align: inherit;">表数据的任何空间缩减也会导致较小的索引可以更快地处理。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL支持许多不同的存储引擎（表类型）和行格式。</font>
							<font style="vertical-align: inherit;">对于每个表，您可以决定使用哪种存储和索引方法。</font>
							<font style="vertical-align: inherit;">为您的应用选择合适的表格格式可以为您带来巨大的性能提升。</font>
							<font style="vertical-align: inherit;">请参见
							</font>
						</font><a class="xref" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第15章，</font>
							</font><i>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">InnoDB存储引擎</font>
								</font>
							</i>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><a class="xref" href="storage-engines.html" title="第16章备用存储引擎">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第16章，</font>
							</font><i>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">备用存储引擎</font>
								</font>
							</i>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								通过使用此处列出的技术，您可以获得更好的表性能并最大限度地减少存储空间：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p><a class="xref" href="optimization.html#data-size-table-columns" title="表列">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表列</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#data-size-row-format" title="行格式">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">行格式</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#data-size-indexes" title="索引">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#data-size-joins" title="加盟">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">加盟</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#data-size-normalization" title="正常化">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">正常化</font>
										</font>
									</a></p>
							</li>
						</ul>
					</div>

					<div class="simplesect">

						<div class="titlepage">
							<div>

								<div class="simple">
									<h4 class="title"><a name="data-size-table-columns"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表列</font>
										</font>
									</h4>

								</div>

							</div>

						</div>

						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												尽可能使用最有效（最小）的数据类型。</font>
											<font style="vertical-align: inherit;">MySQL有许多专门的类型可以节省磁盘空间和内存。</font>
											<font style="vertical-align: inherit;">例如，如果可能，请使用较小的整数类型来获取较小的表。
											</font>
										</font><a class="link" href="data-types.html#integer-types" title="11.2.1整数类型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code
											 class="literal">MEDIUMINT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">通常是一个更好的选择，</font>
										</font><a class="link" href="data-types.html#integer-types" title="11.2.1整数类型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code
											 class="literal">INT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">因为一
											</font>
										</font><a class="link" href="data-types.html#integer-types" title="11.2.1整数类型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code
											 class="literal">MEDIUMINT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列使用的空间减少了25％。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;"></font><code class="literal">NOT NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">如果可能，</font>
											<font style="vertical-align: inherit;">
												声明列</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">它通过更好地使用索引并消除测试每个值是否的开销来使SQL操作更快</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">您还可以节省一些存储空间，每列一位。</font>
											<font style="vertical-align: inherit;">如果您确实需要</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表中的值，请使用它们。</font>
											<font style="vertical-align: inherit;">只需避免允许</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">每列中的值</font>
											<font style="vertical-align: inherit;">的默认设置
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="data-size-row-format"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">行格式</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;"></font><code class="literal">DYNAMIC</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">默认情况下，</font>
											<font style="vertical-align: inherit;">使用</font>
											<font style="vertical-align: inherit;">行格式</font>
											<font style="vertical-align: inherit;">创建表
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">要使用行格式</font>
										</font><code class="literal">DYNAMIC</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，请</font>
											<font style="vertical-align: inherit;">在</font>
											<font style="vertical-align: inherit;">或</font>
											<font style="vertical-align: inherit;">语句中</font>
											<font style="vertical-align: inherit;">显式</font>
											<font style="vertical-align: inherit;">配置
											</font>
										</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_default_row_format"><code class="literal">innodb_default_row_format</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或指定</font>
										</font><code class="literal">ROW_FORMAT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">选项</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font><a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE语法"><code class="literal">CREATE
												TABLE</code></a>
										<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code
											 class="literal">ALTER
												TABLE</code></a>
										<font style="vertical-align: inherit;"></font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												紧凑的行格式系列，包括
											</font>
										</font><code class="literal">COMPACT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">DYNAMIC</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和</font>
										</font><code class="literal">COMPRESSED</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，减少行存储空间，代价是增加某些操作的CPU使用。</font>
											<font style="vertical-align: inherit;">如果您的工作负载是受缓存命中率和磁盘速度限制的典型工作负载，则可能会更快。</font>
											<font style="vertical-align: inherit;">如果这是一种受CPU速度限制的罕见情况，则可能会更慢。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												紧凑的行格式系列还可以</font>
										</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在使用可变长度字符集（如</font>
										</font><code class="literal">utf8mb3</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或）</font>
											<font style="vertical-align: inherit;">时</font>
											<font style="vertical-align: inherit;">优化
											</font>
											<font style="vertical-align: inherit;">列存储
											</font>
										</font><code class="literal">utf8mb4</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">用</font>
										</font><code class="literal">ROW_FORMAT=REDUNDANT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
											<font style="vertical-align: inherit;">
												占用</font>
											<font style="vertical-align: inherit;">×字符集的最大字节长度。</font>
											<font style="vertical-align: inherit;">许多语言可以主要使用单字节</font>
											<font style="vertical-align: inherit;">字符</font>
											<font style="vertical-align: inherit;">编写
											</font>
											<font style="vertical-align: inherit;">，因此固定的存储长度通常会浪费空间。</font>
											<font style="vertical-align: inherit;">使用紧凑的行格式</font>
											<font style="vertical-align: inherit;">系列，</font>
											<font style="vertical-align: inherit;">在to
											</font>
											<font style="vertical-align: inherit;">的范围内分配可变数量的存储空间
											</font>
										</font><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code>
										<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
										<font style="vertical-align: inherit;"></font><code class="literal">utf8</code>
										<font style="vertical-align: inherit;"></font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
										<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">×通过去除尾随空格，这些列的字符集的最大字节长度。</font>
											<font style="vertical-align: inherit;">最小存储长度是
											</font>
										</font><em class="replaceable"><code>N</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">字节，以便在典型情况下进行就地更新。</font>
											<font style="vertical-align: inherit;">有关更多信息，请参见
											</font>
										</font><a class="xref" href="innodb-storage-engine.html#innodb-row-format" title="15.10 InnoDB行格式">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第15.10节“InnoDB行格式”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												要通过以压缩格式存储表数据来进一步减小空间，请指定
											</font>
										</font><code class="literal">ROW_FORMAT=COMPRESSED</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">何时创建
											</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表，或</font>
											<font style="vertical-align: inherit;">在现有</font>
											<font style="vertical-align: inherit;">表</font>
											<font style="vertical-align: inherit;">上</font>
											<font style="vertical-align: inherit;">运行
											</font>
										</font><a class="link" href="programs.html#myisampack" title="4.6.6 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">myisampack</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">命令
											</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">（</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">压缩表是可读写的，而</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">压缩表是只读的。）
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表中，如果没有任何可变长度列（</font>
										</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，或
											</font>
										</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列），一个固定大小的行格式被使用。</font>
											<font style="vertical-align: inherit;">这更快但可能浪费一些空间。</font>
											<font style="vertical-align: inherit;">请参见</font>
										</font><a class="xref" href="storage-engines.html#myisam-table-formats" title="16.2.3 MyISAM表存储格式">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第16.2.3节“MyISAM表存储格式”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">即使您有</font>
										</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">包含该</font>
										</font><a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE语法"><code class="literal">CREATE
												TABLE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">选项的
											</font>
											<font style="vertical-align: inherit;">列，</font>
											<font style="vertical-align: inherit;">也可以提示您希望具有固定长度的行</font>
										</font><code class="literal">ROW_FORMAT=FIXED</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="data-size-indexes"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表的主索引应尽可能短。</font>
											<font style="vertical-align: inherit;">这使得每行的识别变得简单而有效。</font>
											<font style="vertical-align: inherit;">对于</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表，主键列在每个辅助索引条目中都是重复的，因此如果您有许多辅助索引，则短主键可以节省大量空间。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												仅创建提高查询性能所需的索引。</font>
											<font style="vertical-align: inherit;">索引适用于检索，但会降低插入和更新操作的速度。</font>
											<font style="vertical-align: inherit;">如果您主要通过搜索列的组合来访问表，请在它们上创建单个复合索引，而不是为每列创建单独的索引。</font>
											<font style="vertical-align: inherit;">索引的第一部分应该是最常用的列。</font>
											<font style="vertical-align: inherit;">如果</font>
											<font style="vertical-align: inherit;">从表中选择时</font>
										</font><span class="emphasis"><em>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">总是</font>
												</font>
											</em></span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">使用多列，则索引中的第一列应该是具有最多重复的列，以获得更好的索引压缩。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果长字符串列很可能在第一个字符数上有唯一的前缀，那么最好只使用MySQL支持在列的最左边部分创建索引来索引此前缀（参见</font>
										</font><a class="xref" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.1.15节） ，“CREATE INDEX语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）。</font>
											<font style="vertical-align: inherit;">较短的索引更快，不仅因为它们需要更少的磁盘空间，而且因为它们还会在索引缓存中为您提供更多的命中，从而减少磁盘搜索次数。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="server-administration.html#server-configuration" title="5.1.1配置服务器">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第5.1.1节“配置服务器”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="data-size-joins"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">加盟</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在某些情况下，分成两个经常扫描的表可能是有益的。</font>
											<font style="vertical-align: inherit;">如果它是动态格式表，则尤其如此，并且可以使用较小的静态格式表，该表可用于在扫描表时查找相关行。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在具有相同数据类型的不同表中声明具有相同信息的列，以基于相应列加速连接。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												保持列名简单，以便您可以在不同的表中使用相同的名称并简化连接查询。</font>
											<font style="vertical-align: inherit;">例如，在名为的表中</font>
										</font><code class="literal">customer</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，使用列名</font>
										</font><code class="literal">name</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">而不是
											</font>
										</font><code class="literal">customer_name</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">要使您的名称可移植到其他SQL服务器，请考虑将它们保持为短于18个字符。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="data-size-normalization"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">正常化</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												通常，尽量保持所有数据不冗余（观察数据库理论中称为
											</font>
										</font><span class="firstterm">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第三范式的数据</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）。</font>
											<font style="vertical-align: inherit;">不是重复名称和地址等冗长的值，而是为它们分配唯一的ID，在多个较小的表中根据需要重复这些ID，并通过引用join子句中的ID来连接查询中的表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果速度比磁盘空间更重要，并且保留多个数据副本的维护成本，例如在您分析大型表中的所有数据的商业智能场景中，您可以放宽规范化规则，复制信息或创建汇总表到获得更快的速度。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>

				</div>

				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimize-data-types"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.4.2优化MySQL数据类型</font>
									</font>
								</h3>

							</div>

						</div>

					</div>

					<div class="toc">
						<dl class="toc"><dt><span class="section"><a href="optimization.html#optimize-numeric">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.2.1优化数值数据</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-character">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.2.2优化字符和字符串类型</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#optimize-blob">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.2.3优化BLOB类型</font>
										</font>
									</a></span></dt></dl>
					</div>

					<div class="section">

						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="optimize-numeric"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.2.1优化数值数据</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091706068384"></a>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于唯一ID或可以表示为字符串或数字的其他值，首选数字列以字符串列。</font>
											<font style="vertical-align: inherit;">由于较大的数值可以存储在比相应字符串更少的字节中，因此传输和比较它们的速度更快，占用的内存更少。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果使用数字数据，则在许多情况下从数据库访问信息（使用实时连接）比访问文本文件更快。</font>
											<font style="vertical-align: inherit;">数据库中的信息可能以比文本文件更紧凑的格式存储，因此访问它涉及更少的磁盘访问。</font>
											<font style="vertical-align: inherit;">您还可以在应用程序中保存代码，因为您可以避免解析文本文件以查找行和列边界。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="optimize-character"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.2.2优化字符和字符串类型</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091706062720"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于字符和字符串列，请遵循以下准则：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当您不需要特定于语言的排序规则功能时，请使用二进制排序顺序进行快速比较和排序操作。</font>
											<font style="vertical-align: inherit;">您可以使用
											</font>
										</font><a class="link" href="functions.html#operator_binary"><code class="literal">BINARY</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">运算符在特定查询中使用二进制排序规则。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												比较来自不同列的值时，请尽可能声明具有相同字符集和排序规则的列，以避免在运行查询时进行字符串转换。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于小于8KB的列值，请使用binary
											</font>
										</font><code class="literal">VARCHAR</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">而不是
											</font>
										</font><code class="literal">BLOB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">该</font>
										</font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												和</font>
										</font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">条款可以生成临时表，这些临时表可以使用的
											</font>
										</font><code class="literal">MEMORY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">存储引擎，如果原来的表不包含任何</font>
										</font><code class="literal">BLOB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												列。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果表包含字符串列（如名称和地址），但许多查询不检索这些列，请考虑将字符串列拆分为单独的表，并在必要时使用带有外键的连接查询。</font>
											<font style="vertical-align: inherit;">当MySQL从一行中检索任何值时，它会读取包含该行的所有列（以及可能的其他相邻行）的数据块。</font>
											<font style="vertical-align: inherit;">仅使用最常用的列保持每行较小，允许更多行适合每个数据块。</font>
											<font style="vertical-align: inherit;">这种紧凑的表减少了常见查询的磁盘I / O和内存使用。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当您使用随机生成的值作为</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表中</font>
											<font style="vertical-align: inherit;">的主键时，请在其</font>
											<font style="vertical-align: inherit;">前面加上一个升序值，如可能的当前日期和时间。</font>
											<font style="vertical-align: inherit;">当连续的主值物理存储在彼此附近时，</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可以更快地插入和检索它们。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												有关</font>
											<font style="vertical-align: inherit;">数字列通常优于等效字符串列的原因</font>
										</font><a class="xref" href="optimization.html#optimize-numeric" title="8.4.2.1优化数值数据">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">请参见</font><a class="xref" href="optimization.html#optimize-numeric"
											 title="8.4.2.1优化数值数据">
												<font style="vertical-align: inherit;">第8.4.2.1节“优化数值数据”</font>
											</a>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>

					<div class="section">

						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="optimize-blob"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.2.3优化BLOB类型</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091706044592"></a>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												存储包含文本数据的大blob时，请考虑先压缩它。</font>
											<font style="vertical-align: inherit;">当整个表格被</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或</font>
											<font style="vertical-align: inherit;">压缩时，请勿使用此技术
											</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于具有多个列的表，要减少不使用BLOB列的查询的内存要求，请考虑将BLOB列拆分为单独的表，并在需要时使用连接查询引用它。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												由于检索和显示BLOB值的性能要求可能与其他数据类型非常不同，因此您可以将BLOB特定的表放在不同的存储设备上，甚至是单独的数据库实例上。</font>
											<font style="vertical-align: inherit;">例如，要检索BLOB，可能需要大型顺序磁盘读取，这种读取更适合传统硬盘驱动器而不是
											</font>
										</font><a class="link" href="glossary.html#glos_ssd" title="SSD">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">SSD设备</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												有关</font>
											<font style="vertical-align: inherit;">二进制</font>
											<font style="vertical-align: inherit;">列有时优于等效BLOB列的</font>
											<font style="vertical-align: inherit;">原因</font>
										</font><a class="xref" href="optimization.html#optimize-character" title="8.4.2.2优化字符和字符串类型">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">请参见</font><a class="xref" href="optimization.html#optimize-character"
											 title="8.4.2.2优化字符和字符串类型">
												<font style="vertical-align: inherit;">第8.4.2.2节“优化字符和字符串类型”</font>
											</a>
										</font><code class="literal">VARCHAR</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												您可以将列值的哈希值存储在单独的列中，索引该列，并在查询中测试哈希值，而不是针对非常长的文本字符串测试相等性。</font>
											<font style="vertical-align: inherit;">（使用</font>
										</font><code class="literal">MD5()</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">or
											</font>
										</font><code class="literal">CRC32()</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">函数生成哈希值。）由于哈希函数可以为不同的输入生成重复的结果，因此您仍然</font>
											<font style="vertical-align: inherit;">在查询中</font>
											<font style="vertical-align: inherit;">包含一个子句
											</font>
											<font style="vertical-align: inherit;">以防止错误匹配; </font>
											<font style="vertical-align: inherit;">性能优势来自较小的，易于扫描的散列值索引。
											</font>
										</font><code class="literal">AND <em class="replaceable"><code>blob_column</code></em> =
											<em class="replaceable"><code>long_string_value</code></em></code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
							</ul>
						</div>

					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimize-multi-tables"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.4.3优化许多表格</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<div class="toc">
						<dl class="toc"><dt><span class="section"><a href="optimization.html#table-cache">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.3.1 MySQL如何打开和关闭表</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#creating-many-tables">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.3.2在同一数据库中创建多个表的缺点</font>
										</font>
									</a></span></dt></dl>
					</div>
					<a class="indexterm" name="idm140091706028816"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								用于快速保持个别查询的一些技术涉及在多个表之间拆分数据。</font>
							<font style="vertical-align: inherit;">当表的数量达到数千甚至数百万时，处理所有这些表的开销成为新的性能考虑因素。
							</font>
						</font>
					</p>
					<div class="section">

						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="table-cache"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.3.1 MySQL如何打开和关闭表</font>
										</font>
									</h4>
								</div>
							</div>
						</div>
						<a class="indexterm" name="idm140091706025504"></a><a class="indexterm" name="idm140091706024464"></a><a class="indexterm"
						 name="idm140091706022976"></a><a class="indexterm" name="idm140091706021488"></a><a class="indexterm" name="idm140091706020000"></a><a
						 class="indexterm" name="idm140091706018512"></a><a class="indexterm" name="idm140091706017440"></a><a class="indexterm"
						 name="idm140091706015952"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									执行</font>
							</font><a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin  - 管理MySQL服务器的客户端"><span class="command"><strong>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">mysqladmin status</font>
										</font>
									</strong></span></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									命令时，您应该看到如下内容：
								</font>
							</font>
						</p>
						<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常运行时间：426运行线程：1个问题：11082</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重新加载：1张桌子：12</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">Open tables</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">如果您的表少于12个，那么12 </font>
								<font style="vertical-align: inherit;">
									的</font>
								<font style="vertical-align: inherit;">值可能有点令人费解。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL是多线程的，因此可能有许多客户端同时为给定的表发出查询。</font>
								<font style="vertical-align: inherit;">为了最大限度地减少同一个表上具有不同状态的多个客户端会话的问题，该表由每个并发会话独立打开。</font>
								<font style="vertical-align: inherit;">这使用额外的内存但通常会提高性能。</font>
								<font style="vertical-align: inherit;">对于</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表，每个打开表的客户端的数据文件都需要一个额外的文件描述符。</font>
								<font style="vertical-align: inherit;">（相比之下，索引文件描述符在所有会话之间共享。）
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统变量影响服务器保持打开的文件的最大数量。</font>
								<font style="vertical-align: inherit;">如果增加这些值中的一个或两个，则可能会遇到操作系统对每个进程的打开文件描述符数量施加的限制。</font>
								<font style="vertical-align: inherit;">许多操作系统允许您增加开放文件限制，尽管该方法因系统而异。</font>
								<font style="vertical-align: inherit;">请参阅操作系统文档以确定是否可以增加限制以及如何增加限制。
								</font>
							</font>
						</p>
						<p>
							<a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">与...有关</font>
							</font><a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">例如，对于200个并发运行的连接，请指定至少一个表缓存大小</font>
								<font style="vertical-align: inherit;">，其中
								</font>
								<font style="vertical-align: inherit;">是您执行的任何查询中每个连接的最大表数。</font>
								<font style="vertical-align: inherit;">您还必须为临时表和文件保留一些额外的文件描述符。
								</font>
							</font><code class="literal">200 *
								<em class="replaceable"><code>N</code></em></code>
							<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
							<font style="vertical-align: inherit;"></font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									确保您的操作系统可以处理该</font>
							</font><a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">设置</font>
								<font style="vertical-align: inherit;">隐含的打开文件描述符的数量
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">如果
								</font>
							</font><a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">设置得太高，MySQL可能会用完文件描述符并出现诸如拒绝连接或无法执行查询等症状。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									还要考虑到</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									存储引擎需要为每个唯一的打开表提供两个文件描述符。</font>
								<font style="vertical-align: inherit;">要增加MySQL可用的文件描述符数，请设置
								</font>
							</font><a class="link" href="server-administration.html#sysvar_open_files_limit"><code class="literal">open_files_limit</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统变量。</font>
								<font style="vertical-align: inherit;">请参见</font>
							</font><a class="xref" href="error-handling.html#not-enough-file-handles" title="B.4.2.17找不到文件和类似错误">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第B.4.2.17节“找不到文件和类似错误”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									打开表的缓存保持在</font>
							</font><a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">条目</font>
								<font style="vertical-align: inherit;">级别
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">服务器在启动时自动调整缓存大小。</font>
								<font style="vertical-align: inherit;">要显式设置大小，请</font>
							</font><a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在启动时</font>
								<font style="vertical-align: inherit;">设置
								</font>
								<font style="vertical-align: inherit;">系统变量。</font>
								<font style="vertical-align: inherit;">MySQL可以临时打开比这更多的表来执行查询，如本节后面所述。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在以下情况下，MySQL会关闭一个未使用的表并将其从表缓存中删除：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当缓存已满并且线程尝试打开不在缓存中的表时。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当缓存包含多个</font>
										</font><a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">条目并且</font>
											<font style="vertical-align: inherit;">缓存中
											</font>
											<font style="vertical-align: inherit;">的表不再被任何线程使用时。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												发生表格冲洗操作时。</font>
											<font style="vertical-align: inherit;">当有人发出</font>
										</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH
												TABLES</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">声明或执行
											</font>
										</font><a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin  - 管理MySQL服务器的客户端"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysqladmin flush-tables</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin  - 管理MySQL服务器的客户端"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysqladmin refresh</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">命令</font>
											<font style="vertical-align: inherit;">时会发生这种情况</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当表缓存填满时，服务器使用以下过程来查找要使用的缓存条目：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												从最近最少使用的表开始，发布当前未使用的表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果必须打开新表，但缓存已满且无法释放表，则会根据需要临时扩展缓存。</font>
											<font style="vertical-align: inherit;">当缓存处于临时扩展状态并且表从已使用状态变为未使用状态时，表将关闭并从缓存中释放。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">为每个并发访问打开</font>
								<font style="vertical-align: inherit;">
									一个</font>
								<font style="vertical-align: inherit;">表。</font>
								<font style="vertical-align: inherit;">这意味着如果两个线程访问同一个表，或者一个线程在同一个查询中两次访问该表（例如，通过将表连接到自身），则需要打开两次表。</font>
								<font style="vertical-align: inherit;">每个并发打开都需要表缓存中的条目。</font>
								<font style="vertical-align: inherit;">任何</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表</font>
								<font style="vertical-align: inherit;">的第一次打开都
								</font>
								<font style="vertical-align: inherit;">需要两个文件描述符：一个用于数据文件，另一个用于索引文件。</font>
								<font style="vertical-align: inherit;">表的每次额外使用仅为数据文件提供一个文件描述符。</font>
								<font style="vertical-align: inherit;">索引文件描述符在所有线程之间共享。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果要使用该</font>
								<font style="vertical-align: inherit;">语句</font>
								<font style="vertical-align: inherit;">打开表，</font>
								<font style="vertical-align: inherit;">则会为该线程分配专用的表对象。</font>
								<font style="vertical-align: inherit;">此表对象不由其他线程共享，并且在线程调用</font>
								<font style="vertical-align: inherit;">或线程终止</font>
								<font style="vertical-align: inherit;">之前不会关闭</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">发生这种情况时，表将被放回表缓存中（如果缓存未满）。</font>
								<font style="vertical-align: inherit;">请参见
								</font><a class="xref" href="sql-syntax.html#handler" title="13.2.4 HANDLER语法">
									<font style="vertical-align: inherit;">第13.2.4节“HANDLER语法”</font>
								</a>
								<font style="vertical-align: inherit;">。
								</font>
							</font><code class="literal">HANDLER
								<em class="replaceable"><code>tbl_name</code></em> OPEN</code>
							<font style="vertical-align: inherit;"></font><code class="literal">HANDLER
								<em class="replaceable"><code>tbl_name</code></em> CLOSE</code>
							<font style="vertical-align: inherit;"></font><a class="xref" href="sql-syntax.html#handler" title="13.2.4 HANDLER语法">
								<font style="vertical-align: inherit;"></font>
							</a>
							<font style="vertical-align: inherit;"></font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要确定表缓存是否太小，请检查
								</font>
							</font><a class="link" href="server-administration.html#statvar_Opened_tables"><code class="literal">Opened_tables</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">状态变量，该变量指示自服务器启动以来的表打开操作数：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW GLOBAL STATUS LIKE 'Opened_tables';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Variable_name | </font><font style="vertical-align: inherit;">价值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Opened_tables | </font><font style="vertical-align: inherit;">2741 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------- + ------- +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果值非常大或快速增加，即使您没有发出多个</font>
							</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH
									TABLES</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句，也请</font>
							</font><a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在服务器启动时</font>
								<font style="vertical-align: inherit;">增加该
								</font>
								<font style="vertical-align: inherit;">值。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="creating-many-tables"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.4.3.2在同一数据库中创建多个表的缺点</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091705965792"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">同一数据库目录中</font>
								<font style="vertical-align: inherit;">有许多</font>
								<font style="vertical-align: inherit;">表，则打开，关闭和创建操作很慢。</font>
								<font style="vertical-align: inherit;">如果</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在许多不同的表上</font>
								<font style="vertical-align: inherit;">执行</font>
								<font style="vertical-align: inherit;">语句，则表缓存已满时会产生一些开销，因为对于每个必须打开的表，必须关闭另一个表。</font>
								<font style="vertical-align: inherit;">您可以通过增加表缓存中允许的条目数来减少此开销。
								</font>
							</font>
						</p>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="internal-temporary-tables"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.4.4 MySQL中的内部临时表使用</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091705960128"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								在某些情况下，服务器在处理语句时创建内部临时表。</font>
							<font style="vertical-align: inherit;">用户无法直接控制何时发生这种情况。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								服务器在以下条件下创建临时表：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											评估</font>
									</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											陈述，稍后描述一些例外。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											评估某些视图，例如使用</font>
									</font><code class="literal">TEMPTABLE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">算法的
										</font>
										<font style="vertical-align: inherit;">视图
										</font>
									</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，或聚合。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对派生表的评估（参见
										</font>
									</font><a class="xref" href="sql-syntax.html#derived-tables" title="13.2.11.8派生表">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第13.2.11.8节“派生表”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											评估公用表表达式（请参见
										</font>
									</font><a class="xref" href="sql-syntax.html#with" title="13.2.13 WITH语法（公用表表达式）">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第13.2.13节“WITH语法（公用表表达式）”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											为子查询或半连接实现创建的表（请参见</font>
									</font><a class="xref" href="optimization.html#subquery-optimization" title="8.2.2优化子查询，派生表，查看引用和公用表表达式">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.2节“优化子查询，派生表，视图引用和公用表表达式”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											评估包含</font>
									</font><code class="literal">ORDER
										BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">子句和不同</font>
									</font><code class="literal">GROUP
										BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">子句的语句，</font>
									</font><code class="literal">ORDER
										BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或者</font>
									</font><code class="literal">GROUP BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">包含连接队列中第一个表以外的表中的列</font>
										<font style="vertical-align: inherit;">的语句</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;"></font><code class="literal">DISTINCT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">结合
										</font>
										<font style="vertical-align: inherit;">
											评估</font>
									</font><code class="literal">ORDER BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">可能需要临时表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于使用</font>
									</font><code class="literal">SQL_SMALL_RESULT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											修饰符的</font>
										<font style="vertical-align: inherit;">查询</font>
										<font style="vertical-align: inherit;">，MySQL使用内存中的临时表，除非查询还包含需要磁盘存储的元素（稍后描述）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											为了评估
										</font>
									</font><a class="link" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT语法"><code class="literal">INSERT
											...
											SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">从同一个表中选择和插入的语句，MySQL创建了一个内部临时表来保存行中的行
										</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，然后将这些行插入到目标表中。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT语法">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第13.2.6.1节“INSERT ... SELECT语法”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											评估多表
										</font>
									</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											评价</font>
									</font><a class="link" href="functions.html#function_group-concat"><code class="literal">GROUP_CONCAT()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											或</font>
									</font><a class="link" href="functions.html#function_count"><code class="literal">COUNT(DISTINCT)</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											表达。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											窗口函数的评估（参见
										</font>
									</font><a class="xref" href="functions.html#window-functions" title="12.21窗口函数">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第12.21节“窗口函数”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）根据需要使用临时表。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要确定语句是否需要临时表，请使用
							</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">并检查该
							</font>
						</font><code class="literal">Extra</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">列是否显示
							</font>
						</font><code class="literal">Using temporary</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">（请参见
							</font>
						</font><a class="xref" href="optimization.html#using-explain" title="8.8.1使用EXPLAIN优化查询">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.8.1节“使用EXPLAIN优化查询”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）。</font>
							<font style="vertical-align: inherit;">对于派生或具体化的临时表，</font>
						</font><code class="literal">EXPLAIN</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								不一定会说</font>
						</font><code class="literal">Using temporary</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">对于使用窗口功能，陈述</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								与</font>
						</font><code class="literal">FORMAT=JSON</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">总是提供有关窗口步骤的信息。</font>
							<font style="vertical-align: inherit;">如果窗口函数使用临时表，则为每个步骤指示。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								当服务器创建内部临时表（在内存或磁盘上）时，它会递增
							</font>
						</font><a class="link" href="server-administration.html#statvar_Created_tmp_tables"><code class="literal">Created_tmp_tables</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">状态变量。</font>
							<font style="vertical-align: inherit;">如果服务器在磁盘上创建表（最初或通过转换内存表），它会递增
							</font>
						</font><a class="link" href="server-administration.html#statvar_Created_tmp_disk_tables"><code class="literal">Created_tmp_disk_tables</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">状态变量。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								某些查询条件会阻止使用内存中的临时表，在这种情况下，服务器会使用磁盘上的表：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											表中存在a </font>
									</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或
										</font>
									</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">列。</font>
										<font style="vertical-align: inherit;">但是，</font>
									</font><code class="literal">TempTable</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">存储引擎是MySQL 8.0中内存内部临时表的默认存储引擎，从MySQL 8.0.13开始支持二进制大对象类型。</font>
										<font style="vertical-align: inherit;">请参阅
										</font>
									</font><a class="xref" href="optimization.html#internal-temporary-tables-engines" title="内部临时表存储引擎">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">内部临时表存储引擎</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code
										 class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">如果</font>
									</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或
										</font>
									</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION ALL</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用的</font>
										<font style="vertical-align: inherit;">话</font>
										<font style="vertical-align: inherit;">
											，</font>
										<font style="vertical-align: inherit;">列表中</font>
										<font style="vertical-align: inherit;">最大长度大于512的字符串列（二进制字符串的字节数，非二进制字符串的字符数）</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											的</font>
									</font><a class="link" href="sql-syntax.html#show-columns" title="13.7.6.5 SHOW COLUMNS语法"><code class="literal">SHOW
											COLUMNS</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="link" href="sql-syntax.html#describe" title="13.8.1 DESCRIBE语法"><code class="literal">DESCRIBE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句中使用
										</font>
									</font><code class="literal">BLOB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">作为用于某些列的类型，从而用于结果的临时表是磁盘上的表。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于</font>
						</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">满足特定</font>
							<font style="vertical-align: inherit;">条件的</font>
							<font style="vertical-align: inherit;">语句，</font>
							<font style="vertical-align: inherit;">服务器不使用临时表
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">相反，它仅从临时表创建中保留执行结果列类型转换所必需的数据结构。</font>
							<font style="vertical-align: inherit;">该表未完全实例化，并且没有写入或读取行; </font>
							<font style="vertical-align: inherit;">行直接发送到客户端。</font>
							<font style="vertical-align: inherit;">结果是减少了内存和磁盘要求，并且在第一行发送到客户端之前的延迟较小，因为服务器不需要等到最后一个查询块执行。</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和优化器跟踪输出反映了这个执行策略：
							</font>
						</font><code class="literal">UNION RESULT</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;"> 查询块不存在，因为该块对应于从临时表中读取的部分。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								这些条件在</font>
						</font><code class="literal">UNION</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">没有临时表的</font>
							<font style="vertical-align: inherit;">情况下有资格</font>
							<font style="vertical-align: inherit;">进行评估：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											工会是</font>
									</font><code class="literal">UNION ALL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，不是
										</font>
									</font><code class="literal">UNION</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或</font>
									</font><code class="literal">UNION
										DISTINCT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											没有全球</font>
									</font><code class="literal">ORDER BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">条款。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											联合不是</font>
									</font><code class="literal">{INSERT | REPLACE} ... SELECT ...</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											语句</font>
										<font style="vertical-align: inherit;">的顶级查询块
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="internal-temporary-tables-engines"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">内部临时表存储引擎</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									内部临时表可以在内存中保持并且通过被处理</font>
							</font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或
								</font>
							</font><code class="literal">MEMORY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎，或者由存储在磁盘上</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎。
								</font>
							</font>
						</p>
						<h5><a name="idm140091705887104"></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">用于内存内部临时表的存储引擎</font>
							</font>
						</h5>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									的
								</font>
							</font><a class="link" href="server-administration.html#sysvar_internal_tmp_mem_storage_engine"><code class="literal">internal_tmp_mem_storage_engine</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									会话变量定义了用于在存储器内的临时表的存储引擎。</font>
								<font style="vertical-align: inherit;">允许的值是
								</font>
							</font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">（默认值）和
								</font>
							</font><code class="literal">MEMORY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎提供了有效的存储</font>
							</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									和</font>
							</font><a class="link" href="data-types.html#binary-varbinary" title="11.4.2 BINARY和VARBINARY类型"><code class="literal">VARBINARY</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列。</font>
								<font style="vertical-align: inherit;">从MySQL 8.0.13开始支持存储其他二进制大对象类型。</font>
								<font style="vertical-align: inherit;">的</font>
							</font><a class="link" href="server-administration.html#sysvar_temptable_max_ram"><code class="literal">temptable_max_ram</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									配置选项定义了可以由占据的RAM的最大数量</font>
							</font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎启动的形式内存映射临时文件分配从磁盘空间（默认值）或之前
								</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">的磁盘上的内部临时表。</font>
								<font style="vertical-align: inherit;">默认</font>
							</font><a class="link" href="server-administration.html#sysvar_temptable_max_ram"><code class="literal">temptable_max_ram</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									设置为1GiB。</font>
								<font style="vertical-align: inherit;">该
								</font>
							</font><a class="link" href="server-administration.html#sysvar_temptable_use_mmap"><code class="literal">temptable_use_mmap</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">变量（在MySQL 8.0.16中引入）控制TempTable存储引擎是否使用内存映射文件或
								</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;"></font><a class="link" href="server-administration.html#sysvar_temptable_max_ram"><code
								 class="literal">temptable_max_ram</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									超出限制</font>
								<font style="vertical-align: inherit;">时的磁盘内部临时表</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">默认设置为
								</font>
							</font><a class="link" href="server-administration.html#sysvar_temptable_use_mmap"><code class="literal">temptable_use_mmap=ON</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎</font>
								<font style="vertical-align: inherit;">
									使用内存映射的临时文件
								</font>
								<font style="vertical-align: inherit;">作为内存临时表的溢出机制受以下规则的约束：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												临时文件在</font>
										</font><a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">变量</font>
											<font style="vertical-align: inherit;">定义的目录中创建</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												临时文件在创建和打开后立即删除，因此不会在</font>
										</font><a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">tmpdir</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">目录中</font>
											<font style="vertical-align: inherit;">保持可见</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">临时文件占用的空间由临时文件打开时由操作系统保存。</font>
											<font style="vertical-align: inherit;">当</font>
										</font><code class="literal">TempTable</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">存储引擎</font>
											<font style="vertical-align: inherit;">关闭临时文件</font>
											<font style="vertical-align: inherit;">或</font>
										</font><code class="literal">mysqld</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">关闭进程</font>
											<font style="vertical-align: inherit;">时，将
											</font>
											<font style="vertical-align: inherit;">回收该空间
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												数据永远不会在RAM和临时文件之间，RAM内或临时文件之间移动。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果空间在定义的限制范围内可用，则新数据将存储在RAM中
											</font>
										</font><a class="link" href="server-administration.html#sysvar_temptable_max_ram"><code class="literal">temptable_max_ram</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">否则，新数据将存储在临时文件中。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果在将表的某些数据写入临时文件后RAM中的空间可用，则可以将剩余的表数据存储在RAM中。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果</font>
							</font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎配置为使用</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">磁盘内部临时表作为溢出机制（</font>
							</font><a class="link" href="server-administration.html#sysvar_temptable_use_mmap"><code class="literal">temptable_use_mmap=OFF</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">），则超出</font>
							</font><a class="link" href="server-administration.html#sysvar_temptable_max_ram"><code class="literal">temptable_max_ram</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">限制</font>
								<font style="vertical-align: inherit;">的内存表将
								</font>
								<font style="vertical-align: inherit;">转换为</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">磁盘内部临时表，并且属于该表的所有行都将被移动从内存到</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">磁盘内部临时表。</font>
								<font style="vertical-align: inherit;">的
								</font>
							</font><a class="link" href="server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									（在MySQL 8.0.16移除）变量设置已经在没有影响</font>
							</font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎溢出机制。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">如果TempTable存储引擎经常超出</font>
								<font style="vertical-align: inherit;">变量</font>
								<font style="vertical-align: inherit;">定义的内存限制</font>
								<font style="vertical-align: inherit;">并在临时目录中为内存映射文件使用过多空间，</font>
								<font style="vertical-align: inherit;">
									请考虑使用</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">磁盘内部临时表作为</font>
							</font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">溢出机制
								</font>
							</font><code class="literal">temptable_max_ram</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">这可能是由于使用大型内部临时表或大量使用内部临时表而发生的。
								</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">磁盘内部临时表在会话临时表空间中创建，默认情况下驻留在数据目录中。</font>
								<font style="vertical-align: inherit;">有关更多信息，请参见
								</font>
							</font><a class="xref" href="innodb-storage-engine.html#innodb-temporary-tablespace" title="15.6.3.5临时表空间">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第15.6.3.5节“临时表空间”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									的</font>
							</font><code class="literal">memory/temptable/physical_ram</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">memory/temptable/physical_disk</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">性能架构器械可以用于监测
								</font>
							</font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">从内存和磁盘空间分配。</font>
							</font><code class="literal">memory/temptable/physical_ram</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">报告分配的RAM量。
								</font>
							</font><code class="literal">memory/temptable/physical_disk</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">报告当内存映射文件用作TempTable溢出机制（</font>
							</font><code class="literal">temptable_use_mmap=ON</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）</font>
								<font style="vertical-align: inherit;">时从磁盘分配的空间量</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">如果
								</font>
							</font><code class="literal">physical_disk</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">仪器报告的值不是0且内存映射文件用作TempTable溢出机制，则
								</font>
							</font><a class="link" href="server-administration.html#sysvar_temptable_max_ram"><code class="literal">temptable_max_ram</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在某个时刻达到阈值。</font>
								<font style="vertical-align: inherit;">可以在性能模式内存汇总表中查询数据，例如
								</font>
							</font><a class="link" href="performance-schema.html#memory-summary-tables" title="26.12.16.10内存摘要表"><code class="literal">memory_summary_global_by_event_name</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">看到</font>
							</font><a class="xref" href="performance-schema.html#memory-summary-tables" title="26.12.16.10内存摘要表">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第26.12.16.10节“内存汇总表”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									将</font>
							</font><code class="literal">MEMORY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎用于内存临时表时，如果内存临时表变得太大，它会自动将内存临时表转换为磁盘表。</font>
								<font style="vertical-align: inherit;">内存临时表的最大大小由</font>
							</font><a class="link" href="server-administration.html#sysvar_tmp_table_size"><code class="literal">tmp_table_size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									或</font>
							</font><a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值</font>
								<font style="vertical-align: inherit;">定义</font>
								<font style="vertical-align: inherit;">，以较小者为准。</font>
								<font style="vertical-align: inherit;">这与使用</font>
							</font><code class="literal">MEMORY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">显式创建的表
								</font>
								<font style="vertical-align: inherit;">不同
								</font>
							</font><a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE语法"><code class="literal">CREATE
									TABLE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">对于此类表，只有</font>
							</font><a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									变量决定了表的增长程度，并且没有转换为磁盘格式。
								</font>
							</font>
						</p>
						<h5><a name="internal-temporary-tables-engines-disk"></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">用于磁盘内部临时表的存储引擎</font>
							</font>
						</h5>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									从MySQL 8.0.16开始，服务器始终使用
								</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎来管理磁盘上的内部临时表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL 8.0.15及更早版本中，该
								</font>
							</font><a class="link" href="server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									变量用于定义用于磁盘内部临时表的存储引擎。</font>
								<font style="vertical-align: inherit;">在MySQL 8.0.16中删除了此变量，用于此目的的存储引擎不再是用户可配置的。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL 8.0.15及更早版本中：对于公用表表达式（CTE），用于磁盘内部临时表的存储引擎不能</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">如果
								</font>
							</font><a class="link" href="server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine=MYISAM</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，使用磁盘临时表实现CTE的任何尝试都会发生错误。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL 8.0.15及更早版本中：使用时
								</font>
							</font><a class="link" href="server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine=INNODB</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，生成超出</font>
							</font><a class="link" href="innodb-storage-engine.html#innodb-restrictions" title="15.6.1.6 InnoDB表的限制"><code
								 class="literal">InnoDB</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										行或列限制</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">的磁盘内部临时表的查询会
								</font>
								<font style="vertical-align: inherit;">返回</font>
							</font><span class="errortext">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">行大小太大</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或</font>
							</font><span class="errortext">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">列</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									错误</font><span class="errortext">
									<font style="vertical-align: inherit;">太多</font>
								</span>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">解决方法是设置
								</font>
							</font><a class="link" href="server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									为</font>
							</font><code class="literal">MYISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="internal-temporary-tables-storage"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">内部临时表存储格式</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当内存内部临时表由</font>
							</font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎</font>
								<font style="vertical-align: inherit;">管理时
								</font>
								<font style="vertical-align: inherit;">，包含
								</font>
							</font><code class="literal">VARCHAR</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列，
								</font>
							</font><code class="literal">VARBINARY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列或其他二进制大对象类型列的行（从MySQL 8.0.13开始支持）在内存中由一组单元格表示，每个单元格包含NULL标志，数据长度和数据指针。</font>
								<font style="vertical-align: inherit;">列值在数组之后以连续顺序放置在单个内存区域中，没有填充。</font>
								<font style="vertical-align: inherit;">阵列中的每个单元使用16个字节的存储空间。</font>
								<font style="vertical-align: inherit;">当</font>
							</font><code class="literal">TempTable</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎超出</font>
							</font><a class="link" href="server-administration.html#sysvar_temptable_max_ram"><code class="literal">temptable_max_ram</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									限制并开始从磁盘分配空间作为内存映射文件</font>
								<font style="vertical-align: inherit;">时，应用相同的存储格式</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> 磁盘内部临时表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当存储器内部临时表由</font>
							</font><code class="literal">MEMORY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎</font>
								<font style="vertical-align: inherit;">管理时
								</font>
								<font style="vertical-align: inherit;">，使用固定长度的行格式。</font>
							</font><code class="literal">VARCHAR</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">VARBINARY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列值填充到最大列长度，实际上将它们存储为
								</font>
								<font style="vertical-align: inherit;">列</font>
							</font><code class="literal">CHAR</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">BINARY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL 8.0.16之前，磁盘内部临时表由</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或
								</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎</font>
								<font style="vertical-align: inherit;">管理</font>
								<font style="vertical-align: inherit;">（取决于
								</font>
							</font><a class="link" href="server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									设置）。</font>
								<font style="vertical-align: inherit;">两个引擎都使用动态宽度行格式存储内部临时表。</font>
								<font style="vertical-align: inherit;">与使用固定长度行的磁盘表相比，列只占用所需的存储空间，从而减少了磁盘I / O，空间要求和处理时间。</font>
								<font style="vertical-align: inherit;">从MySQL 8.0.16开始，
								</font>
							</font><code class="literal">internal_tmp_disk_storage_engine</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">不受支持，磁盘上的内部临时表总是由处理</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用</font>
							</font><code class="literal">MEMORY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎时，语句最初可以创建内存中的内部临时表，然后在表变得太大时将其转换为磁盘上的表。</font>
								<font style="vertical-align: inherit;">在这种情况下，可以通过跳过转换并在磁盘上创建内部临时表来实现更好的性能。</font>
								<font style="vertical-align: inherit;">该
								</font>
							</font><a class="link" href="server-administration.html#sysvar_big_tables"><code class="literal">big_tables</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">变量可用于强制内部临时表的磁盘存储。
								</font>
							</font>
						</p>
					</div>

				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="optimizing-innodb"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.5优化InnoDB表</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#optimizing-innodb-storage-layout">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.1优化InnoDB表的存储布局</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-transaction-management">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.2优化InnoDB事务管理</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#innodb-performance-ro-txn">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.3优化InnoDB只读事务</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-logging">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.4优化InnoDB重做日志</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-bulk-data-loading">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.5 InnoDB表的批量数据加载</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-queries">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.6优化InnoDB查询</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-ddl-operations">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.7优化InnoDB DDL操作</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-diskio">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.8优化InnoDB磁盘I / O.</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-configuration-variables">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.9优化InnoDB配置变量</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-innodb-many-tables">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.10为具有多个表的系统优化InnoDB</font>
									</font>
								</a></span></dt></dl>
				</div>
				<a class="indexterm" name="idm140091705794752"></a><a class="indexterm" name="idm140091705792880"></a>
				<p>
					<a class="link" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎"><code class="literal">InnoDB</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">是MySQL客户通常在生产数据库中使用的存储引擎，其中可靠性和并发性很重要。
						</font>
					</font><code class="literal">InnoDB</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">是MySQL中的默认存储引擎。</font>
						<font style="vertical-align: inherit;">本节介绍如何优化</font>
					</font><code class="literal">InnoDB</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">表的</font>
						<font style="vertical-align: inherit;">数据库操作
						</font>
						<font style="vertical-align: inherit;">。
						</font>
					</font>
				</p>
				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-innodb-storage-layout"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.1优化InnoDB表的存储布局</font>
									</font>
								</h3>
							</div>
						</div>
					</div>

					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											一旦您的数据达到稳定的大小，或者增长的表增加了数十或几百兆字节，请考虑使用该</font>
									</font><code class="literal">OPTIMIZE TABLE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句重新组织表并压缩任何浪费的空间。</font>
										<font style="vertical-align: inherit;">重组的表需要较少的磁盘I / O来执行全表扫描。</font>
										<font style="vertical-align: inherit;">这是一种简单的技术，可以在其他技术（如改进索引使用或调整应用程序代码）不切实际时提高性能。
										</font>
									</font>
								</p>
								<p>
									<code class="literal">OPTIMIZE TABLE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">复制表的数据部分并重建索引。</font>
										<font style="vertical-align: inherit;">其好处来自于改进了索引中数据的打包，减少了表空间和磁盘上的碎片。</font>
										<font style="vertical-align: inherit;">好处取决于每个表中的数据。</font>
										<font style="vertical-align: inherit;">您可能会发现某些人而不是其他人获得了显着的收益，或者在您下次优化表之前，收益会随着时间的推移而降低。</font>
										<font style="vertical-align: inherit;">如果表很大或者正在重建的索引不适合缓冲池，则此操作可能很慢。</font>
										<font style="vertical-align: inherit;">向表中添加大量数据后的第一次运行通常比以后的运行慢得多。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，长</font>
									</font><code class="literal">PRIMARY
										KEY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">（具有冗长值的单个列，或形成长复合值的多个列）浪费了大量磁盘空间。</font>
										<font style="vertical-align: inherit;">在指向同一行的所有辅助索引记录中，行的主键值重复。</font>
										<font style="vertical-align: inherit;">（请参见</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-index-types" title="15.6.2.1集群和二级索引">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.6.2.1节“聚簇和辅助索引”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。）</font>
									</font><code class="literal">AUTO_INCREMENT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">如果主键很长，则</font>
										<font style="vertical-align: inherit;">创建一</font>
										<font style="vertical-align: inherit;">列作为主键，或者索引长</font>
									</font><code class="literal">VARCHAR</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">列</font>
										<font style="vertical-align: inherit;">的前缀</font>
										<font style="vertical-align: inherit;">而不是整列。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用</font>
									</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">数据类型而不是</font>
									</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">存储可变长度字符串或具有多个</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值的</font>
										<font style="vertical-align: inherit;">列
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">甲
										</font>
										<font style="vertical-align: inherit;">
											列总是占据</font>
										<font style="vertical-align: inherit;">字符来存储数据，即使该字符串是较短，或者其值
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">较小的表更适合缓冲池并减少磁盘I / O.
										</font>
									</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR(<em
											 class="replaceable"><code>N</code></em>)</code></a>
									<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
									<font style="vertical-align: inherit;"></font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;"></font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当使用</font>
									</font><code class="literal">COMPACT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">行格式（默认</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">格式）和可变长度字符集（如
										</font>
									</font><code class="literal">utf8</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或）时</font>
									</font><code class="literal">sjis</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
										<font style="vertical-align: inherit;">
											列占用可变的空间量，但仍至少为</font>
										<font style="vertical-align: inherit;">字节。
										</font>
									</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR(<em
											 class="replaceable"><code>N</code></em>)</code></a>
									<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
									<font style="vertical-align: inherit;"></font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于较大的表或包含大量重复文本或数字数据的表，请考虑使用
										</font>
									</font><code class="literal">COMPRESSED</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">行格式。</font>
										<font style="vertical-align: inherit;">将数据放入缓冲池或执行全表扫描需要较少的磁盘I / O. </font>
										<font style="vertical-align: inherit;">在做出永久性决策之前，请使用</font>
									</font><code class="literal">COMPRESSED</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">与</font>
									</font><code class="literal">COMPACT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">行格式</font>
										<font style="vertical-align: inherit;">相比较
										</font>
										<font style="vertical-align: inherit;">来衡量可以实现的压缩量
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-innodb-transaction-management"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.2优化InnoDB事务管理</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要优化</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">事务处理，请在事务功能的性能开销和服务器的工作负载之间找到理想的平衡点。</font>
							<font style="vertical-align: inherit;">例如，如果应用程序每秒提交数千次，则可能会遇到性能问题，如果仅每2-3小时提交一次，则会遇到性能问题。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											默认的MySQL设置</font>
									</font><code class="literal">AUTOCOMMIT=1</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											可能会对繁忙的数据库服务器施加性能限制。</font>
										<font style="vertical-align: inherit;">在可行的情况下，通过发出</font>
									</font><code class="literal">SET AUTOCOMMIT=0</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或</font>
									</font><code class="literal">START
										TRANSACTION</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">声明</font>
										<font style="vertical-align: inherit;">将几个相关的数据更改操作包装到单个事务中
										</font>
										<font style="vertical-align: inherit;">，然后
										</font>
									</font><code class="literal">COMMIT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在进行所有更改之后进行声明。
										</font>
									</font>
								</p>
								<p>
									<code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">如果该事务对数据库进行了修改，则必须在每次事务提交时将日志刷新到磁盘。</font>
										<font style="vertical-align: inherit;">当每次更改后都提交时（与默认的自动提交设置一样），存储设备的I / O吞吐量会限制每秒潜在操作的数量。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											或者，对于仅包含单个</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句的</font>
										<font style="vertical-align: inherit;">事务，</font>
										<font style="vertical-align: inherit;">启用此选项</font>
									</font><code class="literal">AUTOCOMMIT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">有助于
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">识别只读事务并对其进行优化。</font>
										<font style="vertical-align: inherit;">有关要求</font>
									</font><a class="xref" href="optimization.html#innodb-performance-ro-txn" title="8.5.3优化InnoDB只读事务">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">请参见
										</font><a class="xref" href="optimization.html#innodb-performance-ro-txn" title="8.5.3优化InnoDB只读事务">
											<font style="vertical-align: inherit;">第8.5.3节“优化InnoDB只读事务”</font>
										</a>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											插入，更新或删除大量行后，避免执行回滚。</font>
										<font style="vertical-align: inherit;">如果大型事务正在降低服务器性能，则将其回滚可能会使问题变得更糟，可能需要花费几倍的时间来执行原始数据更改操作。</font>
										<font style="vertical-align: inherit;">杀死数据库进程没有帮助，因为在服务器启动时会再次启动回滚。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											为了尽量减少此问题发生的可能性：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														增加</font>
												</font><a class="link" href="glossary.html#glos_buffer_pool" title="缓冲池">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">缓冲池</font>
													</font>
												</a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">的大小，
													</font>
													<font style="vertical-align: inherit;">以便可以缓存所有数据更改更改，而不是立即写入磁盘。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														进行设置，
													</font>
												</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=all</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														以便除插入外还缓冲更新和删除操作。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														考虑</font>
												</font><code class="literal">COMMIT</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">在大数据更改操作期间定期</font>
													<font style="vertical-align: inherit;">发出</font>
													<font style="vertical-align: inherit;">语句，可能会破坏单个删除或更新为对较少行进行操作的多个语句。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											要在发生失控回滚后摆脱它，请增加缓冲池，使回滚变为CPU限制并快速运行，或者</font><a class="xref" href="innodb-storage-engine.html#innodb-recovery"
										 title="15.17.2 InnoDB恢复">
											<font style="vertical-align: inherit;">终止</font>
										</a>
										<font style="vertical-align: inherit;">服务器并重新启动
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery=3</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，如</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-recovery" title="15.17.2 InnoDB恢复">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.17.2节“InnoDB恢复”中所述</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											预计此问题很少会出现在默认设置中</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering=all</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，该</font>
										<font style="vertical-align: inherit;">设置
										</font>
										<font style="vertical-align: inherit;">允许将更新和删除操作缓存在内存中，从而使它们在第一时间更快地执行，并且如果需要还可以更快地回滚。</font>
										<font style="vertical-align: inherit;">确保在处理具有许多插入，更新或删除的长时间运行事务的服务器上使用此参数设置。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果发生崩溃，您可以承受丢失一些最新提交的事务，则可以将</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											参数</font>
										<font style="vertical-align: inherit;">设置
										</font>
										<font style="vertical-align: inherit;">为0. </font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">尝试每秒刷新一次日志，尽管无法保证刷新。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											修改或删除行时，</font>
										<font style="vertical-align: inherit;">不会立即或甚至在事务提交后立即</font>
										<font style="vertical-align: inherit;">删除行和关联的
										</font>
									</font><a class="link" href="glossary.html#glos_undo_log" title="撤消日志">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">撤消日志</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">旧数据将保留，直到先前或同时启动的事务完成，以便这些事务可以访问已修改或已删除行的先前状态。</font>
										<font style="vertical-align: inherit;">因此，长时间运行的事务可以防止</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">清除由不同事务更改的数据。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在长时间运行的事务中修改或删除行时，</font>
										<font style="vertical-align: inherit;">如果读取相同的行，则</font>
										<font style="vertical-align: inherit;">使用</font>
									</font><a class="link" href="innodb-storage-engine.html#isolevel_read-committed"><code class="literal">READ
											COMMITTED</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="link" href="innodb-storage-engine.html#isolevel_repeatable-read"><code class="literal">REPEATABLE
											READ</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">隔离级别的</font>
										<font style="vertical-align: inherit;">其他事务
										</font>
										<font style="vertical-align: inherit;">必须执行更多工作来重建旧数据。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当长时间运行的事务修改表时，从其他事务对该表的查询不会使用</font>
									</font><a class="link" href="glossary.html#glos_covering_index" title="覆盖指数">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">覆盖索引</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">技术。</font>
										<font style="vertical-align: inherit;">通常可以从辅助索引检索所有结果列的查询，而不是从表数据中查找适当的值。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果发现二级索引页面
										</font>
									</font><code class="literal">PAGE_MAX_TRX_ID</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">太新，或者二级索引中的记录被删除标记，则
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">可能需要使用聚簇索引查找记录。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="innodb-performance-ro-txn"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.3优化InnoDB只读事务</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">可以避免与</font>
							<font style="vertical-align: inherit;">已知为只读</font>
							<font style="vertical-align: inherit;">的</font>
						</font><a class="link" href="glossary.html#glos_transaction_id" title="交易ID">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">事务</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">设置</font><a class="link" href="glossary.html#glos_transaction_id" title="交易ID">
								<font style="vertical-align: inherit;">事务ID</font>
							</a>
							<font style="vertical-align: inherit;">（</font>
						</font><code class="literal">TRX_ID</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">字段）</font>
							<font style="vertical-align: inherit;">相关的开销</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">仅需要一个事务ID </font>
						</font><a class="link" href="glossary.html#glos_transaction" title="交易">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">的事务</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，可能执行写操作或
							</font>
						</font><a class="link" href="glossary.html#glos_locking_read" title="锁定读取">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">锁定读取</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">诸如
							</font>
						</font><code class="literal">SELECT ... FOR UPDATE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">消除不必要的事务ID会减少每次查询或数据更改语句构造</font>
						</font><a class="link" href="glossary.html#glos_read_view" title="阅读视图">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">读取视图</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">时所咨询的内部数据结构的大小</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;"> 在以下情况下检测只读事务：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该事务以该</font>
									</font><a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code
										 class="literal">START TRANSACTION
											READ ONLY</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句</font>
										<font style="vertical-align: inherit;">启动
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">在这种情况下，尝试更改数据库（for </font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或其他类型的表）会导致错误，并且事务将继续处于只读状态：
										</font>
									</font>
								</p>
								<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ERROR 1792（25006）：无法在READ ONLY事务中执行语句。
</font></font></pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您仍然可以在只读事务中更改特定于会话的临时表，或者为它们发出锁定查询，因为这些更改和锁对任何其他事务都不可见。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该</font>
									</font><a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">设置后，使交易保证是一条语句，而单个语句组成的事务是</font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">“ </font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">非锁定</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> ”</font>
										</font>
									</span>
									<a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">的语句。</font>
										<font style="vertical-align: inherit;">也就是说，
										</font>
									</font><code class="literal">SELECT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">不使用</font>
									</font><code class="literal">FOR
										UPDATE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或</font>
									</font><code class="literal">LOCK IN SHARED MODE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											子句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该事务在没有该</font>
									</font><code class="literal">READ
										ONLY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">选项的</font>
										<font style="vertical-align: inherit;">情况下启动</font>
										<font style="vertical-align: inherit;">，但是尚未执行明确锁定行的更新或语句。</font>
										<font style="vertical-align: inherit;">在需要更新或显式锁定之前，事务将保持只读模式。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								因此，对于读取密集型应用，如报表生成器，您可以调整的序列，</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								由内而外将它们分组查询
							</font>
						</font><a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code
							 class="literal">START TRANSACTION READ
								ONLY</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code
							 class="literal">COMMIT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，或通过打开</font>
						</font><a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								运行之前设置</font>
						</font><code class="literal">SELECT</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句，或简单地避免与查询穿插任何数据更改语句。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								有关信息
							</font>
						</font><a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code
							 class="literal">START
								TRANSACTION</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，并
							</font>
						</font><a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">请参见
							</font>
						</font><a class="xref" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">13.3.1节，“START TRANSACTION，COMMIT和ROLLBACK语法”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

						<div class="admon-title">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									注意
								</font>
							</font>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									符合自动提交，非锁定和只读（AC-NL-RO）的事务不在某些内部
								</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">数据结构之外，因此不在</font>
							</font><a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE语法"><code class="literal">SHOW
									ENGINE
									INNODB STATUS</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">输出中</font>
								<font style="vertical-align: inherit;">列出
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-innodb-logging"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.4优化InnoDB重做日志</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								请考虑以下有关优化重做日志记录的准则：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使重做日志文件变大，甚至与</font>
									</font><a class="link" href="glossary.html#glos_buffer_pool" title="缓冲池">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">缓冲池</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">一样大
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">何时
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">将重做日志文件写满，它必须将修改后的缓冲池内容写入</font>
									</font><a class="link" href="glossary.html#glos_checkpoint" title="检查站">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">检查点的</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">磁盘
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">小的重做日志文件会导致许多不必要的磁盘写入。</font>
										<font style="vertical-align: inherit;">虽然历史上大的重做日志文件导致冗长的恢复时间，但现在恢复速度更快，您可以放心地使用大型重做日志文件。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											和
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											配置选项</font>
										<font style="vertical-align: inherit;">配置重做日志文件的大小和数量</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">有关修改现有重做日志文件配置的信息，请参阅</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-redo-log-file-reconfigure" title="更改重做日志文件的数量或大小">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">更改</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">重做日志文件
										</font><a class="xref" href="innodb-storage-engine.html#innodb-redo-log-file-reconfigure" title="更改重做日志文件的数量或大小">
											<font style="vertical-align: inherit;">的数量或大小</font>
										</a>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											考虑增加</font>
									</font><a class="link" href="glossary.html#glos_log_buffer" title="日志缓冲区">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">日志缓冲区</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">的大小
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">大型日志缓冲区使大型
										</font>
									</font><a class="link" href="glossary.html#glos_transaction" title="交易">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">事务</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">能够运行，而无需在事务</font>
									</font><a class="link" href="glossary.html#glos_commit" title="承诺">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">提交</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">之前将日志写入磁盘</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">因此，如果您有更新，插入或删除许多行的事务，则使日志缓冲区更大可以节省磁盘I / O. </font>
										<font style="vertical-align: inherit;">使用</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size"><code class="literal">innodb_log_buffer_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											配置选项</font>
										<font style="vertical-align: inherit;">配置日志缓冲区大小
										</font>
										<font style="vertical-align: inherit;">，可以在MySQL 8.0中动态配置。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											配置
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size"><code class="literal">innodb_log_write_ahead_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											配置选项以避免</font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">“ </font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">read-on-write</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> ”</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">此选项定义重做日志的预写块大小。</font>
										<font style="vertical-align: inherit;">设置
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size"><code class="literal">innodb_log_write_ahead_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											为匹配操作系统或文件系统缓存块大小。</font>
										<font style="vertical-align: inherit;">由于重做日志的预写块大小与操作系统或文件系统高速缓存块大小不匹配，重做日志块未完全高速缓存到操作系统或文件系统时会发生写入时写入。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有效值
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size"><code class="literal">innodb_log_write_ahead_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											是</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">日志文件块大小的</font>
										<font style="vertical-align: inherit;">倍数</font>
										<font style="vertical-align: inherit;">（2 </font>
									</font><sup>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">n</font>
										</font>
									</sup>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）。</font>
										<font style="vertical-align: inherit;">最小值是</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">日志文件块大小（512）。</font>
										<font style="vertical-align: inherit;">指定最小值时不会发生预写。</font>
										<font style="vertical-align: inherit;">最大值等于该
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值。</font>
										<font style="vertical-align: inherit;">如果为该值指定的值
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size"><code class="literal">innodb_log_write_ahead_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											大于该
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值，则该
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size"><code class="literal">innodb_log_write_ahead_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											设置将截断为该
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;"></font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_write_ahead_size"><code
										 class="literal">innodb_log_write_ahead_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											相对于操作系统或文件系统高速缓存块大小</font>
										<font style="vertical-align: inherit;">
											设置该
										</font>
										<font style="vertical-align: inherit;">值太低会导致写入时读取。</font>
									</font><code class="literal">fsync</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">由于一次写入多个块，因此</font>
										<font style="vertical-align: inherit;">将值设置得过高可能会对</font>
										<font style="vertical-align: inherit;">日志文件写入的性能</font>
										<font style="vertical-align: inherit;">产生轻微影响
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											通过等待刷新重做的用户线程优化旋转延迟的使用。</font>
										<font style="vertical-align: inherit;">旋转延迟有助于减少延迟。</font>
										<font style="vertical-align: inherit;">在低并发期间，减少延迟可能不是优先级，并且避免在这些时段期间使用自旋延迟可以减少能量消耗。</font>
										<font style="vertical-align: inherit;">在高并发期间，您可能希望避免在旋转延迟上消耗处理能力，以便可以将其用于其他工作。</font>
										<font style="vertical-align: inherit;">以下系统变量允许设置高水位值和低水位值，这些值定义了使用自旋延迟的边界。
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_wait_for_flush_spin_hwm"><code class="literal">innodb_log_wait_for_flush_spin_hwm</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">：定义最大平均日志刷新时间，超过该时间，用户线程在等待刷新的重做时不再旋转。</font>
													<font style="vertical-align: inherit;">默认值为400微秒。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_spin_cpu_abs_lwm"><code class="literal">innodb_log_spin_cpu_abs_lwm</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">：定义在等待刷新重做时用户线程不再旋转的最小CPU使用量。</font>
													<font style="vertical-align: inherit;">该值表示为CPU核心使用量的总和。</font>
													<font style="vertical-align: inherit;">例如，默认值80是单个CPU核心的80％。</font>
													<font style="vertical-align: inherit;">在具有多核处理器的系统上，值150表示100％使用一个CPU核心加50％使用第二个CPU核心。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_spin_cpu_pct_hwm"><code class="literal">innodb_log_spin_cpu_pct_hwm</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">：定义在等待刷新的重做时用户线程不再旋转的最大CPU使用量。</font>
													<font style="vertical-align: inherit;">该值表示为所有CPU核心的总处理能力的百分比。</font>
													<font style="vertical-align: inherit;">默认值为50％。</font>
													<font style="vertical-align: inherit;">例如，两个CPU核心的100％使用率是具有四个CPU核心的服务器上组合CPU处理能力的50％。
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														的
													</font>
												</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_spin_cpu_pct_hwm"><code class="literal">innodb_log_spin_cpu_pct_hwm</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														配置选项方面处理器的亲和性。</font>
													<font style="vertical-align: inherit;">例如，如果服务器有48个内核但
													</font>
												</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">mysqld</font>
															</font>
														</strong></span></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">进程仅固定为4个CPU内核，则忽略其他44个CPU内核。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-innodb-bulk-data-loading"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.5 InnoDB表的批量数据加载</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091705641136"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								这些性能提示补充了</font>
						</font><a class="xref" href="optimization.html#insert-optimization" title="8.2.5.1优化INSERT语句">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.2.5.1节“优化INSERT语句”中</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">快速插入的一般准则</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											导入数据时</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，请关闭自动提交模式，因为它会为每个插入执行磁盘日志刷新。</font>
										<font style="vertical-align: inherit;">要在导入操作期间禁用自动提交，请使用</font>
									</font><a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code
										 class="literal">SET
											autocommit</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code
										 class="literal">COMMIT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句将</font>
										<font style="vertical-align: inherit;">其
										</font>
										<font style="vertical-align: inherit;">括起来：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET autocommit = 0;
</font></font><em class="replaceable"><code>... SQL import statements ...</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
承诺;</font></font><font></font>
</pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该</font>
									</font><a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump  - 数据库备份程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">mysqldump的</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">选项
										</font>
									</font><a class="link" href="programs.html#option_mysqldump_opt"><code class="option">--opt</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">创建这样的快速导入到转储文件</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											表，即使没有与他们包装
										</font>
									</font><a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code
										 class="literal">SET
											autocommit</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION，COMMIT和ROLLBACK语法"><code
										 class="literal">COMMIT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">报表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果您</font>
									</font><code class="literal">UNIQUE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">对辅助密钥</font>
										<font style="vertical-align: inherit;">有</font>
										<font style="vertical-align: inherit;">约束，则可以通过在导入会话期间临时关闭唯一性检查来加速表导入：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET unique_checks = 0;
</font></font><em class="replaceable"><code>... SQL import statements ...</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET unique_checks = 1;</font></font><font></font>
</pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于大表，这会节省大量磁盘I / O，因为
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">可以使用其更改缓冲区批量写入二级索引记录。</font>
										<font style="vertical-align: inherit;">确保数据不包含重复键。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果</font>
									</font><code class="literal">FOREIGN KEY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表中</font>
										<font style="vertical-align: inherit;">有</font>
										<font style="vertical-align: inherit;">约束，则可以通过在导入会话期间关闭外键检查来加速表导入：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET foreign_key_checks = 0;
</font></font><em class="replaceable"><code>... SQL import statements ...</code></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET foreign_key_checks = 1;</font></font><font></font>
</pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于大表，这可以节省大量磁盘I / O.
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code
										 class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果需要插入多行，</font>
										<font style="vertical-align: inherit;">
											请使用多行</font>
										<font style="vertical-align: inherit;">语法来减少客户端和服务器之间的通信开销：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入可用的值（1,2），（5,5），......;
</font></font></pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											此提示适用于插入任何表，而不仅仅是
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在使用自动增量列进行批量插入时，设置
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">为2（交错）而不是1（连续）。</font>
										<font style="vertical-align: inherit;">有关</font>
										<font style="vertical-align: inherit;">详细信息</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-handling" title="15.6.1.4 InnoDB中的AUTO_INCREMENT处理">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">请参见
										</font><a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-handling" title="15.6.1.4 InnoDB中的AUTO_INCREMENT处理">
											<font style="vertical-align: inherit;">第15.6.1.4节“InnoDB中的AUTO_INCREMENT处理”</font>
										</a>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											执行批量插入时，按</font>
									</font><code class="literal">PRIMARY KEY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">顺序</font>
										<font style="vertical-align: inherit;">插入行会更快
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表使用
										</font>
									</font><a class="link" href="glossary.html#glos_clustered_index" title="聚集索引">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">聚簇索引</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，这使得按顺序使用数据相对较快</font>
									</font><code class="literal">PRIMARY KEY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">按</font>
									</font><code class="literal">PRIMARY KEY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">顺序</font>
										<font style="vertical-align: inherit;">执行批量插入</font>
										<font style="vertical-align: inherit;">对于不完全适合缓冲池的表尤为重要。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											要在将数据加载到</font>
									</font><code class="literal">InnoDB</code> <code class="literal">FULLTEXT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">索引</font>
										<font style="vertical-align: inherit;">时获得最佳性能
										</font>
										<font style="vertical-align: inherit;">，请执行以下步骤：
										</font>
									</font>
								</p>
								<div class="orderedlist">
									<ol class="orderedlist" type="1">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;"></font><code class="literal">FTS_DOC_ID</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">在表创建时</font>
													<font style="vertical-align: inherit;">
														定义一个</font>
													<font style="vertical-align: inherit;">类</font>
												</font><code class="literal">BIGINT UNSIGNED NOT
													NULL</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">，其中包含一个名为的唯一索引
													</font>
												</font><code class="literal">FTS_DOC_ID_INDEX</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">。</font>
													<font style="vertical-align: inherit;">例如：
													</font>
												</font>
											</p>
											<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE t1（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FTS_DOC_ID BIGINT无符号NOT NULL AUTO_INCREMENT，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
title varchar（255）NOT NULL DEFAULT''，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
text mediumtext NOT NULL，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PRIMARY KEY（`FTS_DOC_ID`）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）ENGINE = InnoDB DEFAULT CHARSET = utf8mb4;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在t1上创建UNIQUE INDEX FTS_DOC_ID_INDEX（FTS_DOC_ID）;</font></font><font></font>
</pre>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														将数据加载到表中。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;"></font><code class="literal">FULLTEXT</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">加载数据后</font>
													<font style="vertical-align: inherit;">
														创建</font>
													<font style="vertical-align: inherit;">索引。
													</font>
												</font>
											</p>
										</li>
									</ol>
								</div>
								<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
									<div class="admon-title">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												注意
											</font>
										</font>
									</div>
									<p>
										<font style="vertical-align: inherit;"></font><code class="literal">FTS_DOC_ID</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在创建表</font>
											<font style="vertical-align: inherit;">
												时添加</font>
											<font style="vertical-align: inherit;">列时，请确保在
											</font>
										</font><code class="literal">FTS_DOC_ID</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">更新
											</font>
										</font><code class="literal">FULLTEXT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引列时更新列，因为</font>
										</font><code class="literal">FTS_DOC_ID</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">必须随每个</font>
										</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
											<font style="vertical-align: inherit;">每个单调增加
											</font>
										</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">如果您选择不添加</font>
										</font><code class="literal">FTS_DOC_ID</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">at table创建时间并</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">为您管理DOC ID，</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">则会</font>
										</font><code class="literal">FTS_DOC_ID</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在下一次</font>
										</font><a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX语法"><code class="literal">CREATE
												FULLTEXT INDEX</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">调用时</font>
											<font style="vertical-align: inherit;">将其添加
											</font>
											<font style="vertical-align: inherit;">为隐藏列</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">但是，这种方法需要进行表重建，这会影响性能。
											</font>
										</font>
									</p>
								</div>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-innodb-queries"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.6优化InnoDB查询</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要调整</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表的</font>
							<font style="vertical-align: inherit;">查询，请</font>
							<font style="vertical-align: inherit;">在每个表上创建一组适当的索引。</font>
							<font style="vertical-align: inherit;">有关</font>
							<font style="vertical-align: inherit;">详细信息</font>
						</font><a class="xref" href="optimization.html#mysql-indexes" title="8.3.1 MySQL如何使用索引">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">请参见
							</font><a class="xref" href="optimization.html#mysql-indexes" title="8.3.1&nbsp;How MySQL Uses Indexes">
								<font style="vertical-align: inherit;">第8.3.1节“MySQL如何使用索引”</font>
							</a>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">请遵循以下</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">索引</font>
							<font style="vertical-align: inherit;">指南</font>
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											因为每个</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表都有一个
										</font>
									</font><a class="link" href="glossary.html#glos_primary_key" title="首要的关键">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">主键</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">（无论您是否请求一个</font><a class="link" href="glossary.html#glos_primary_key"
										 title="primary key">
											<font style="vertical-align: inherit;">主键</font>
										</a>
										<font style="vertical-align: inherit;">），请为每个表指定一组主键列，这些列用于最重要和时间关键的查询。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											不要在主键中指定太多或太长的列，因为这些列值在每个辅助索引中都是重复的。</font>
										<font style="vertical-align: inherit;">当索引包含不必要的数据时，读取此数据的I / O和用于缓存它的内存会降低服务器的性能和可伸缩性。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											不要</font>
										<font style="vertical-align: inherit;">
											为每列</font>
										<font style="vertical-align: inherit;">创建单独的
										</font>
									</font><a class="link" href="glossary.html#glos_secondary_index" title="二级指数">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">二级索引</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，因为每个查询只能使用一个索引。</font>
										<font style="vertical-align: inherit;">很少测试的列或具有少量不同值的列的索引可能对任何查询都没有帮助。</font>
										<font style="vertical-align: inherit;">如果对同一个表有很多查询，测试不同的列组合，请尝试创建少量
										</font>
									</font><a class="link" href="glossary.html#glos_concatenated_index" title="连锁索引">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">连接索引</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">而不是大量单列索引。</font>
										<font style="vertical-align: inherit;">如果索引包含结果集所需的所有列（称为
										</font>
									</font><a class="link" href="glossary.html#glos_covering_index" title="覆盖指数">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">覆盖索引</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">），则查询可能会完全避免读取表数据。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果索引列不能包含任何
										</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值，请</font>
									</font><code class="literal">NOT
										NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在创建表时将</font>
										<font style="vertical-align: inherit;">其声明为</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">当知道每个列是否包含</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值</font>
										<font style="vertical-align: inherit;">时，优化器可以更好地确定哪个索引最有效地用于查询
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您可以</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">使用</font>
									</font><a class="xref" href="optimization.html#innodb-performance-ro-txn" title="8.5.3优化InnoDB只读事务">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.5.3节“优化InnoDB只读事务”中</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">的技术</font><a class="xref" href="optimization.html#innodb-performance-ro-txn"
										 title="8.5.3优化InnoDB只读事务">
											<font style="vertical-align: inherit;">优化</font>
										</a>
										<font style="vertical-align: inherit;">表的
										</font>
										<font style="vertical-align: inherit;">单查询事务
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-innodb-ddl-operations"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.7优化InnoDB DDL操作</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对表和索引（很多DDL操作</font>
									</font><code class="literal">CREATE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，</font>
									</font><code class="literal">ALTER</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><code class="literal">DROP</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句）可以在网上进行。</font>
										<font style="vertical-align: inherit;">有关</font>
										<font style="vertical-align: inherit;">详细信息</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-online-ddl" title="15.12 InnoDB和在线DDL">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">请参见</font><a class="xref" href="innodb-storage-engine.html#innodb-online-ddl"
										 title="15.12 InnoDB和在线DDL">
											<font style="vertical-align: inherit;">第15.12节“InnoDB和在线DDL”</font>
										</a>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在线DDL支持添加二级索引意味着您通常可以通过创建没有二级索引的表来加快创建和加载表及相关索引的过程，然后在加载数据后添加二级索引。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用</font>
									</font><a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE语法"><code class="literal">TRUNCATE
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">空表，不</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">外键约束，可以使一个</font>
										<font style="vertical-align: inherit;">语句的工作像一个普通的</font>
										<font style="vertical-align: inherit;">声明，在这种情况下，命令序列喜欢
										</font>
										<font style="vertical-align: inherit;">和
										</font>
										<font style="vertical-align: inherit;">可能是最快的。
										</font>
									</font><code class="literal">DELETE FROM
										<em class="replaceable"><code>tbl_name</code></em></code>
									<font style="vertical-align: inherit;"></font><code class="literal">TRUNCATE</code>
									<font style="vertical-align: inherit;"></font><code class="literal">DELETE</code>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#drop-table" title="13.1.32 DROP TABLE语法"><code
										 class="literal">DROP TABLE</code></a>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE语法"><code
										 class="literal">CREATE TABLE</code></a>
									<font style="vertical-align: inherit;"></font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											因为主键是每个</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表</font>
										<font style="vertical-align: inherit;">的存储布局的组成部分</font>
										<font style="vertical-align: inherit;">，并且更改主键的定义涉及重新组织整个表，所以始终将主键设置为</font>
									</font><a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE语法"><code class="literal">CREATE
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句的</font>
										<font style="vertical-align: inherit;">一部分
										</font>
										<font style="vertical-align: inherit;">，并提前计划以便您不需要
										</font>
									</font><code class="literal">ALTER</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或</font>
									</font><code class="literal">DROP</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">之后的主键。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-innodb-diskio"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.8优化InnoDB磁盘I / O.</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091705548304"></a><a class="indexterm" name="idm140091705546816"></a><a class="indexterm"
					 name="idm140091705545744"></a><a class="indexterm" name="idm140091705544672"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果您遵循SQL操作的数据库设计和调优技术的最佳实践，但由于磁盘I / O活动繁重，您的数据库仍然很慢，请考虑这些磁盘I / O优化。</font>
							<font style="vertical-align: inherit;">如果Unix </font>
						</font><code class="filename">top</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">工具或Windows任务管理器显示您的工作负载的CPU使用百分比低于70％，则您的工作负载可能是磁盘绑定的。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											增加缓冲池大小
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当表数据缓存在</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											缓冲池中时，可以通过查询重复访问它，而无需任何磁盘I / O. </font>
										<font style="vertical-align: inherit;">使用</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											选项</font>
										<font style="vertical-align: inherit;">指定缓冲池的大小
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">此内存区域非常重要，通常建议将
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">其配置为系统内存的50％到75％。</font>
										<font style="vertical-align: inherit;">有关更多信息，请参见</font>
									</font><a class="xref" href="optimization.html#memory-use" title="8.12.3.1 MySQL如何使用内存">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.12.3.1节“MySQL如何使用内存”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											调整冲洗方法
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在某些版本的GNU / Linux和Unix中，使用Unix </font>
									</font><code class="literal">fsync()</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">调用（
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">默认情况下使用）和类似方法将</font>
										<font style="vertical-align: inherit;">文件刷新到磁盘的</font>
										<font style="vertical-align: inherit;">速度非常慢。</font>
										<font style="vertical-align: inherit;">如果数据库写入性能存在问题，请使用</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											参数设置为</font>
										<font style="vertical-align: inherit;">on进行基准测试
										</font>
									</font><code class="literal">O_DSYNC</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											配置写缓冲区的阈值大小
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											默认情况下，在</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">创建新数据文件（例如新日志文件或表空间文件）时，只有在完全写入文件后才会将写入缓冲区的内容刷新到磁盘，这可能导致发生大量磁盘写入活动立刻。</font>
										<font style="vertical-align: inherit;">要强制进行较小的定期刷新，请使用
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fsync_threshold"><code class="literal">innodb_fsync_threshold</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											（在MySQL 8.0.13中引入）为写缓冲区定义阈值大小（以字节为单位）。</font>
										<font style="vertical-align: inherit;">达到阈值大小时，写缓冲区的内容将刷新到磁盘。</font>
										<font style="vertical-align: inherit;">默认值0强制使用默认行为。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在多个MySQL实例使用相同的存储设备的情况下，指定写入缓冲区阈值大小以强制较小的定期刷新可能是有益的。</font>
										<font style="vertical-align: inherit;">例如，创建新的MySQL实例及其关联的数据文件可能会导致磁盘写入活动大量涌现，从而影响使用相同存储设备的其他MySQL实例的性能。</font>
										<font style="vertical-align: inherit;">配置写入缓冲区阈值大小有助于避免磁盘写入活动中出现此类浪涌。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在Linux上使用带有本机AIO的noop或截止时间I / O调度程序
										</font>
									</font>
								</p>
								<p>
									<code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">使用Linux上的异步I / O子系统（本机AIO）来执行数据文件页面的预读和写入请求。</font>
										<font style="vertical-align: inherit;">此行为由</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											配置选项</font>
										<font style="vertical-align: inherit;">控制，该
										</font>
										<font style="vertical-align: inherit;">选项默认启用。</font>
										<font style="vertical-align: inherit;">对于本机AIO，I / O调度程序的类型对I / O性能的影响更大。</font>
										<font style="vertical-align: inherit;">通常，建议使用noop和deadline I / O调度程序。</font>
										<font style="vertical-align: inherit;">执行基准测试以确定哪个I / O调度程序为您的工作负载和环境提供最佳结果。</font>
										<font style="vertical-align: inherit;">有关更多信息，请参见
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-linux-native-aio" title="15.8.6在Linux上使用异步I / O.">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.6节“在Linux上使用异步I / O”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在Solaris 10 for x86_64体系结构上使用直接I / O.
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;"></font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在Solaris 10 for x86_64体系结构（AMD Opteron）上</font>
										<font style="vertical-align: inherit;">
											使用</font>
										<font style="vertical-align: inherit;">存储引擎时，请使用直接I / O </font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">相关文件以避免性能下降</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">要将直接I / O用于存储</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">相关文件</font>
										<font style="vertical-align: inherit;">的整个UFS文件系统，请使用
										</font>
										<font style="vertical-align: inherit;">该</font>
									</font><code class="literal">forcedirectio</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">选项</font>
										<font style="vertical-align: inherit;">安装它
										</font>
										<font style="vertical-align: inherit;">; </font>
										<font style="vertical-align: inherit;">看
										</font>
									</font><code class="literal">mount_ufs(1M)</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">（Solaris 10 / x86_64上的缺省值</font>
									</font><span class="emphasis"><em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">不</font>
											</font>
										</em></span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">使用此选项。）要仅将直接I / O应用于</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">文件操作而不是整个文件系统，请进行设置
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method
											=
											O_DIRECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">使用此设置，
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">调用
										</font>
									</font><code class="literal">directio()</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">而不是
										</font>
									</font><code class="literal">fcntl()</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;"> 用于数据文件的I / O（不用于日志文件的I / O）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对Solaris 2.6或更高版本的数据和日志文件使用原始存储
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在任何版本的Solaris 2.6及更高版本和任何平台（sparc / x86 / x64 / amd64）上</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">使用具有较大</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值</font>
										<font style="vertical-align: inherit;">
											的</font>
										<font style="vertical-align: inherit;">存储引擎时，请
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在原始设备或单独的直接I / O UFS上</font>
										<font style="vertical-align: inherit;">使用</font>
										<font style="vertical-align: inherit;">数据文件和日志文件</font>
										<font style="vertical-align: inherit;">进行基准测试
										</font>
										<font style="vertical-align: inherit;">文件系统，使用</font>
									</font><code class="literal">forcedirectio</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">如前所述</font>
										<font style="vertical-align: inherit;">的</font>
										<font style="vertical-align: inherit;">mount选项。</font>
										<font style="vertical-align: inherit;">（</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">如果希望对日志文件执行直接I / O </font>
										<font style="vertical-align: inherit;">，则必须使用mount选项而不是设置
										</font>
										<font style="vertical-align: inherit;">。）Veritas文件系统VxFS的用户应使用
										</font>
									</font><code class="literal">convosync=direct</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">mount选项。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											不要</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在直接I / O文件系统上</font>
										<font style="vertical-align: inherit;">放置其他MySQL数据文件，例如
										</font>
										<font style="vertical-align: inherit;">表格。</font>
									</font><span class="emphasis"><em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">不得</font>
											</font>
										</em></span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">将</font>
										<font style="vertical-align: inherit;">可执行文件或库</font>
										<font style="vertical-align: inherit;">放在直接I / O文件系统上。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用其他存储设备
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											可以使用其他存储设备来设置RAID配置。</font>
										<font style="vertical-align: inherit;">有关相关信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#disk-issues" title="8.12.1优化磁盘I / O.">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.12.1节“优化磁盘I / O”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											或者，</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表空间数据文件和日志文件可以放在不同的物理磁盘上。</font>
										<font style="vertical-align: inherit;">有关更多信息，请参阅以下部分：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<a class="xref" href="innodb-storage-engine.html#innodb-init-startup-configuration" title="15.8.1 InnoDB启动配置">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">第15.8.1节“InnoDB启动配置”</font>
													</font>
												</a>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="xref" href="innodb-storage-engine.html#tablespace-placing" title="15.6.3.6在数据目录之外创建表空间">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">第15.6.3.6节“在数据目录之外创建表空间”</font>
													</font>
												</a>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="xref" href="innodb-storage-engine.html#general-tablespaces-creating" title="创建常规表空间">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">创建常规表空间</font>
													</font>
												</a>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="xref" href="innodb-storage-engine.html#innodb-migration" title="15.6.1.2移动或复制InnoDB表">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">第15.6.1.2节“移动或复制InnoDB表”</font>
													</font>
												</a>
											</p>
										</li>
									</ul>
								</div>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											考虑非旋转存储
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											非旋转存储通常为随机I / O操作提供更好的性能; </font>
										<font style="vertical-align: inherit;">和用于顺序I / O操作的旋转存储。</font>
										<font style="vertical-align: inherit;">在旋转和非旋转存储设备之间分发数据和日志文件时，请考虑主要在每个文件上执行的I / O操作的类型。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											面向随机I / O的文件通常包括
										</font>
									</font><a class="link" href="glossary.html#glos_file_per_table" title="文件的每个表">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">每表文件</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											和</font>
									</font><a class="link" href="glossary.html#glos_general_tablespace" title="一般表空间">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">一般表空间</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">数据文件，
										</font>
									</font><a class="link" href="glossary.html#glos_undo_tablespace" title="撤消表空间">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">撤消表空间</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											文件和
										</font>
									</font><a class="link" href="glossary.html#glos_temporary_tablespace" title="临时表空间">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">临时表空间</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">文件。</font>
										<font style="vertical-align: inherit;">顺序面向I / O的文件包括</font>
									</font><code class="literal">InnoDB</code>
									<a class="link" href="glossary.html#glos_system_tablespace" title="系统表空间">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">系统表空间</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">文件（由于
										</font>
									</font><a class="link" href="glossary.html#glos_doublewrite_buffer" title="双写缓冲区">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">doublewrite缓冲</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="link" href="glossary.html#glos_change_buffer" title="改变缓冲区">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">更改缓冲</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）和日志文件，如</font>
									</font><a class="link" href="glossary.html#glos_binary_log" title="二进制日志">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">二进制日志</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">文件和</font>
									</font><a class="link" href="glossary.html#glos_redo_log" title="重做日志">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">重做日志</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">文件。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用非旋转存储时，请查看以下配置选项的设置：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksum_algorithm"><code class="literal">innodb_checksum_algorithm</code></a>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														该</font>
												</font><code class="literal">crc32</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">选项使用更快的校验和算法，建议用于快速存储系统。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_neighbors"><code class="literal">innodb_flush_neighbors</code></a>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														此选项可优化旋转存储设备的I / O. </font>
													<font style="vertical-align: inherit;">禁用它用于非旋转存储或混合旋转和非旋转存储。</font>
													<font style="vertical-align: inherit;">默认情况下禁用它。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														默认设置200通常足以用于低端非旋转存储设备。</font>
													<font style="vertical-align: inherit;">对于更高端的总线连接设备，请考虑更高的设置，例如1000。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity_max"><code class="literal">innodb_io_capacity_max</code></a>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														默认值2000适用于使用非旋转存储的工作负载。</font>
													<font style="vertical-align: inherit;">对于高端，总线连接的非旋转存储设备，请考虑更高的设置，例如2500。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_compressed_pages"><code class="literal">innodb_log_compressed_pages</code></a>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														如果重做日志位于非旋转存储上，请考虑禁用此选项以减少日志记录。</font>
													<font style="vertical-align: inherit;">请参阅
													</font>
												</font><a class="link" href="optimization.html#innodb-disable-log-compressed-pages">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">禁用压缩页面的记录</font>
													</font>
												</a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														如果重做日志位于非旋转存储上，请配置此选项以最大化缓存和写入组合。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="link" href="innodb-storage-engine.html#sysvar_innodb_page_size"><code class="literal">innodb_page_size</code></a>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														请考虑使用与磁盘内部扇区大小匹配的页面大小。</font>
													<font style="vertical-align: inherit;">早期的SSD设备通常具有4KB的扇区大小。</font>
													<font style="vertical-align: inherit;">一些较新的设备具有16KB的扇区大小。</font>
													<font style="vertical-align: inherit;">默认</font>
												</font><code class="literal">InnoDB</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														页面大小为16KB。</font>
													<font style="vertical-align: inherit;">保持页面大小接近存储设备块大小可以最大限度地减少重写到磁盘的未更改数据量。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="link" href="replication.html#sysvar_binlog_row_image"><code class="literal">binlog_row_image</code></a>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														如果二进制日志位于非旋转存储上且所有表都具有主键，请考虑将此选项设置</font>
												</font><code class="literal">minimal</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">为减少日志记录。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											确保为您的操作系统启用了TRIM支持。</font>
										<font style="vertical-align: inherit;">它通常默认启用。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											增加I / O容量以避免积压
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果由于</font>
									</font><code class="literal">InnoDB</code>
									<a class="link" href="glossary.html#glos_checkpoint" title="检查站">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">检查点</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											操作</font>
										<font style="vertical-align: inherit;">导致吞吐量周期性下降
										</font>
										<font style="vertical-align: inherit;">，请考虑增加</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											配置选项</font>
										<font style="vertical-align: inherit;">的值
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">较高的值会导致更频繁的
										</font>
									</font><a class="link" href="glossary.html#glos_flush" title="红晕">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">刷新</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，从而避免可能导致吞吐量下降的积压工作。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果冲洗不落后，则I / O容量会降低
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果系统没有落后于
										</font>
									</font><code class="literal">InnoDB</code>
									<a class="link" href="glossary.html#glos_flush" title="红晕">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">刷新</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">操作，请考虑降低</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											配置选项</font>
										<font style="vertical-align: inherit;">的值
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">通常，您将此选项值保持尽可能低，但不要低到导致吞吐量周期性下降，如前面的项目中所述。</font>
										<font style="vertical-align: inherit;">在您可以降低选项值的典型情况下，您可能会在以下输出中看到如下组合
										</font>
									</font><a class="link" href="sql-syntax.html#show-engine" title="13.7.6.15 SHOW ENGINE语法"><code class="literal">SHOW
											ENGINE
											INNODB STATUS</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														历史清单长度低，低于几千。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														插入缓冲区合并靠近插入的行。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														缓冲池中的已修改页面始终远低于
													</font>
												</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														缓冲池。</font>
													<font style="vertical-align: inherit;">（在服务器未进行批量插入时进行测量;在批量插入期间，修改后的页面百分比显着上升是正常的。）
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">Log sequence number - Last checkpoint</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														小于7/8或理想情况下小于</font>
												</font><code class="literal">InnoDB</code>
												<a class="link" href="glossary.html#glos_log_file" title="日志文件">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">日志文件</font>
													</font>
												</a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">总大小的6/8 </font>
													<font style="vertical-align: inherit;">。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在Fusion-io设备上存储系统表空间文件
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您可以通过</font>
										<font style="vertical-align: inherit;">在支持原子写入的Fusion-io设备上</font>
										<font style="vertical-align: inherit;">存储系统表空间文件（</font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">“ </font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">ibdata files</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> ”</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）</font>
										<font style="vertical-align: inherit;">来利用与双写缓冲区相关的I / O优化</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">在这种情况下，doublewrite buffering（</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）会自动禁用，Fusion-io原子写入将用于所有数据文件。</font>
										<font style="vertical-align: inherit;">此功能仅在Fusion-io硬件上受支持，仅适用于Linux上的Fusion-io NVMFS。</font>
										<font style="vertical-align: inherit;">要充分利用此功能，</font>
										<font style="vertical-align: inherit;">建议</font>
										<font style="vertical-align: inherit;">进行
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">设置</font>
									</font><code class="literal">O_DIRECT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
								<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

									<div class="admon-title">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												注意
											</font>
										</font>
									</div>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												由于双写缓冲区设置是全局的，因此对于驻留在非Fusion-io硬件上的数据文件也禁用双写缓冲。
											</font>
										</font>
									</p>
								</div>
							</li>
							<li class="listitem">
								<p><a name="innodb-disable-log-compressed-pages"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											禁用压缩页面的记录
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表
										</font>
									</font><a class="link" href="glossary.html#glos_compression" title="压缩">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">压缩</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">功能时，</font>
										<font style="vertical-align: inherit;">在对压缩数据进行更改时，会将</font>
										<font style="vertical-align: inherit;">重新压缩</font>
									</font><a class="link" href="glossary.html#glos_page" title="页">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">页面的</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">图像
										</font>
										<font style="vertical-align: inherit;">写入
										</font>
									</font><a class="link" href="glossary.html#glos_redo_log" title="重做日志">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">重做日志</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">此行为由
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_compressed_pages"><code class="literal">innodb_log_compressed_pages</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，默认情况下启用，以防止</font>
									</font><code class="literal">zlib</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在恢复期间使用</font>
										<font style="vertical-align: inherit;">不同版本的</font>
										<font style="vertical-align: inherit;">压缩算法时</font>
										<font style="vertical-align: inherit;">可能发生的损坏</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">如果您确定</font>
									</font><code class="literal">zlib</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">版本不会更改，请禁用
										</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_compressed_pages"><code class="literal">innodb_log_compressed_pages</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											以减少修改压缩数据的工作负载的重做日志生成。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-innodb-configuration-variables"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.9优化InnoDB配置变量</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于具有轻量，可预测负载的服务器而言，不同的设置最适用于始终满负荷运行的服务器，或者遇到高活动高峰的服务器。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								由于</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">存储引擎会自动执行许多优化，因此许多性能调整任务涉及监视以确保数据库运行良好，并在性能下降时更改配置选项。</font>
							<font style="vertical-align: inherit;">有关详细</font>
							<font style="vertical-align: inherit;">性能监视的</font>
							<font style="vertical-align: inherit;">信息</font>
						</font><a class="xref" href="innodb-storage-engine.html#innodb-performance-schema" title="15.15 InnoDB与MySQL性能模式的集成">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">请参见
							</font><a class="xref" href="innodb-storage-engine.html#innodb-performance-schema" title="15.15 InnoDB与MySQL性能模式的集成">
								<font style="vertical-align: inherit;">第15.15节“InnoDB与MySQL性能模式的集成”</font>
							</a>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								您可以执行的主要配置步骤包括：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											控制</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">缓冲更改数据</font>
										<font style="vertical-align: inherit;">的数据更改操作类型
										</font>
										<font style="vertical-align: inherit;">，以避免频繁的小磁盘写入。</font>
										<font style="vertical-align: inherit;">请参阅
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-change-buffer-configuration" title="配置更改缓冲">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">配置更改缓冲</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">因为默认是缓冲所有类型的数据更改操作，所以只有在需要减少缓冲量时才更改此设置。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用该</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											选项</font>
										<font style="vertical-align: inherit;">打开和关闭自适应哈希索引功能
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">有关</font>
										<font style="vertical-align: inherit;">更多信息</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-adaptive-hash" title="15.5.3自适应哈希索引">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">请参见</font><a class="xref" href="innodb-storage-engine.html#innodb-adaptive-hash"
										 title="15.5.3自适应哈希索引">
											<font style="vertical-align: inherit;">第15.5.3节“自适应哈希索引”</font>
										</a>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">您可以在异常活动期间更改此设置，然后将其恢复为原始设置。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;"></font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">如果上下文切换是瓶颈，则</font>
										<font style="vertical-align: inherit;">
											对</font>
										<font style="vertical-align: inherit;">处理</font>
										<font style="vertical-align: inherit;">的并发线程数设置限制
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="15.8.4配置InnoDB的线程并发">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.4节“为InnoDB配置线程并发”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											控制预</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">读操作</font>
										<font style="vertical-align: inherit;">所需的预取量
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">当系统具有未使用的I / O容量时，更多预读可以提高查询性能。</font>
										<font style="vertical-align: inherit;">过多的预读会导致负载很重的系统性能周期性下降。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="15.8.3.4配置InnoDB缓冲池预取（预读）">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.3.4节“配置InnoDB缓冲池预取（预读）”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果您有一个未被默认值充分利用的高端I / O子系统，则增加读取或写入操作的后台线程数。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-performance-multiple_io_threads" title="15.8.5配置后台InnoDB I / O线程数">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.5节“配置后台InnoDB I / O线程的数量”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											控制I / O </font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在后台执行的程度。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_io_rate" title="15.8.7配置InnoDB主线程I / O速率">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.7节“配置InnoDB主线程I / O速率”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">如果您观察到性能的周期性下降，则可以缩减此设置。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											控制确定何时</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">执行某些类型的后台写入</font>
										<font style="vertical-align: inherit;">的算法
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="15.8.3.5配置InnoDB缓冲池刷新">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.3.5节“配置InnoDB缓冲池刷新”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">该算法适用于某些类型的工作负载，但不适用于其他工作负载，因此如果您观察到性能周期性下降，可能会关闭此设置。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											利用多核处理器及其高速缓存配置，最大限度地减少上下文切换的延迟。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-performance-spin_lock_polling" title="15.8.8配置自旋锁轮询">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.8节“配置自旋锁轮询”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											防止诸如表扫描之类的一次性操作干扰存储在</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">缓冲区高速缓存中</font>
										<font style="vertical-align: inherit;">的频繁访问的数据
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="15.8.3.3使缓冲池抗扫描">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.3.3节“使缓冲池抗扫描”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											将日志文件调整为对可靠性和崩溃恢复有意义的大小。</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											日志文件通常保持较小，以避免崩溃后的长启动时间。</font>
										<font style="vertical-align: inherit;">MySQL 5.5中引入的优化加速了崩溃</font>
									</font><a class="link" href="glossary.html#glos_crash_recovery" title="崩溃恢复">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">恢复</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">过程的</font>
										<font style="vertical-align: inherit;">某些步骤
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">特别是，</font>
										<font style="vertical-align: inherit;">由于改进了内存管理算法</font>
										<font style="vertical-align: inherit;">，扫描
										</font>
									</font><a class="link" href="glossary.html#glos_redo_log" title="重做日志">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">重做日志</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和应用重做日志的速度更快。</font>
										<font style="vertical-align: inherit;">如果您将日志文件人为地缩小以避免长启动时间，则现在可以考虑增加日志文件大小以减少由于重做日志记录的回收而发生的I / O.
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											配置</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">缓冲池</font>
										<font style="vertical-align: inherit;">的实例大小和数量，
										</font>
										<font style="vertical-align: inherit;">对于具有多千兆字节缓冲池的系统尤其重要。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-multiple-buffer-pools" title="15.8.3.2配置多个缓冲池实例">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.3.2节“配置多个缓冲池实例”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											增加最大并发事务数，从而显着提高最繁忙数据库的可伸缩性。</font>
										<font style="vertical-align: inherit;">请参见</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-undo-logs" title="15.6.6撤消日志">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.6.6节“撤消日志”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											将清除操作（一种垃圾收集）移动到后台线程中。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-improved-purge-scheduling" title="15.8.9配置InnoDB清除调度">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.9节“配置InnoDB清除调度”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">要有效地测量此设置的结果，请首先调整其他与I / O相关的配置和与线程相关的配置设置。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											减少</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">并发线程之间</font>
										<font style="vertical-align: inherit;">的切换量
										</font>
										<font style="vertical-align: inherit;">，以便繁忙服务器上的SQL操作不会排队并形成</font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">“ </font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">交通堵塞</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> ”</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">为</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											选项</font>
										<font style="vertical-align: inherit;">设置一个值，
										</font>
										<font style="vertical-align: inherit;">对于高功率的现代系统，最多约为32。</font>
										<font style="vertical-align: inherit;">增加</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											选项</font>
										<font style="vertical-align: inherit;">的值
										</font>
										<font style="vertical-align: inherit;">，通常为5000左右。</font>
										<font style="vertical-align: inherit;">这种选项组合设置了线程数量的上限
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;"> 任何时候进程，并允许每个线程在被换出之前做大量的工作，这样等待线程的数量保持很低，操作可以在没有过多上下文切换的情况下完成。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-innodb-many-tables"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.5.10为具有多个表的系统优化InnoDB</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果您已配置
										</font>
									</font><a class="link" href="innodb-storage-engine.html#innodb-statistics-estimation" title="15.8.10.2配置非持久优化器统计参数">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">的非持久性优化统计</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">（非默认配置），
										</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">计算指标
										</font>
									</font><a class="link" href="glossary.html#glos_cardinality" title="基数">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">基数</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值表中的第一次表，启动后访问，而不是在表中存储这些值。</font>
										<font style="vertical-align: inherit;">对于将数据分区为多个表的系统，此步骤可能会花费大量时间。</font>
										<font style="vertical-align: inherit;">由于此开销仅适用于初始表打开操作，要</font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">“ </font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">预热</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> ”</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											表以供以后使用，请在启动后立即通过发出诸如的语句来访问它</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font><code class="literal">SELECT 1 FROM
										<em class="replaceable"><code>tbl_name</code></em> LIMIT 1</code>
									<font style="vertical-align: inherit;"></font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											默认情况下，优化程序统计信息将持久保存到磁盘，并由</font>
									</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_persistent"><code class="literal">innodb_stats_persistent</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											配置选项</font>
										<font style="vertical-align: inherit;">启用
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">有关持久优化器统计信息的信息，请参见
										</font>
									</font><a class="xref" href="innodb-storage-engine.html#innodb-persistent-stats" title="15.8.10.1配置持久优化器统计参数">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.10.1节“配置持久优化器统计信息参数”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="optimizing-myisam"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.6优化MyISAM表</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#optimizing-queries-myisam">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.6.1优化MyISAM查询</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-myisam-bulk-data-loading">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.6.2 MyISAM表的批量数据加载</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#repair-table-optimization">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.6.3优化REPAIR TABLE语句</font>
									</font>
								</a></span></dt></dl>
				</div>
				<a class="indexterm" name="idm140091705364464"></a>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							该</font>
					</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">存储引擎与读数据或低并发操作的性能最佳，因为表锁限制进行同步更新的能力。</font>
						<font style="vertical-align: inherit;">在MySQL中，</font>
					</font><a class="link" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎"><code class="literal">InnoDB</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">是默认的存储引擎而不是</font>
					</font><code class="literal">MyISAM</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">。
						</font>
					</font>
				</p>
				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-queries-myisam"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.6.1优化MyISAM查询</font>
									</font>
								</h3>
							</div>
						</div>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								加速查询</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表的</font>
							<font style="vertical-align: inherit;">一些常规技巧
							</font>
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											为了帮助MySQL更好地优化查询，</font>
										<font style="vertical-align: inherit;">在加载数据后在表上</font>
										<font style="vertical-align: inherit;">使用
										</font>
									</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或运行
										</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk --analyze</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">这会更新每个索引部分的值，以指示具有相同值的平均行数。</font>
										<font style="vertical-align: inherit;">（对于唯一索引，这始终是1.）MySQL使用它来决定在基于非常量表达式连接两个表时选择哪个索引。</font>
										<font style="vertical-align: inherit;">您可以通过使用</font>
										<font style="vertical-align: inherit;">和检查</font>
										<font style="vertical-align: inherit;">值</font>
										<font style="vertical-align: inherit;">来</font>
										<font style="vertical-align: inherit;">检查</font>
										<font style="vertical-align: inherit;">表分析的结果
										</font>
										<font style="vertical-align: inherit;">。</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span
											 class="command"><strong>
													<font style="vertical-align: inherit;">myisamchk --description --verbose</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">显示索引分发信息。
										</font>
									</font><code class="literal">SHOW INDEX FROM
										<em class="replaceable"><code>tbl_name</code></em></code>
									<font style="vertical-align: inherit;"></font><code class="literal">Cardinality</code>
									<font style="vertical-align: inherit;"></font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span
										 class="command"><strong>
												<font style="vertical-align: inherit;"></font>
											</strong></span></a>
									<font style="vertical-align: inherit;"></font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											要根据索引对索引和数据进行排序，请使用
										</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk --sort-index --sort-records = 1</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											（假设您要对索引1进行排序）。</font>
										<font style="vertical-align: inherit;">如果您有一个唯一索引，您希望根据索引按顺序读取所有行，这是一种提高查询速度的好方法。</font>
										<font style="vertical-align: inherit;">第一次以这种方式对大表进行排序时，可能需要很长时间。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											尽量避免</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">经常更新的表</font>
										<font style="vertical-align: inherit;">进行复杂</font>
										<font style="vertical-align: inherit;">查询</font>
										<font style="vertical-align: inherit;">，以避免由于读者和编写者之间的争用而导致的表锁定问题。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">支持并发插入：如果表在数据文件的中间没有空闲块，则可以</font>
									</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在其他线程从表中读取的同时</font>
										<font style="vertical-align: inherit;">将</font>
										<font style="vertical-align: inherit;">新行放入其中。</font>
										<font style="vertical-align: inherit;">如果能够执行此操作很重要，请考虑以避免删除行的方式使用该表。</font>
										<font style="vertical-align: inherit;">另一种可能性是在</font>
									</font><a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">从表中删除大量行后</font>
										<font style="vertical-align: inherit;">运行</font>
										<font style="vertical-align: inherit;">对表进行碎片整理。</font>
										<font style="vertical-align: inherit;">通过设置</font>
									</font><a class="link" href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">变量</font>
										<font style="vertical-align: inherit;">可以更改此行为
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">您可以强制追加新行（因此允许并发插入），即使在已删除行的表中也是如此。</font>
										<font style="vertical-align: inherit;">请参见</font>
									</font><a class="xref" href="optimization.html#concurrent-inserts" title="8.11.3并发插入">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.11.3节“并发插入”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">频繁更改的表，尽量避免所有变长列（</font>
									</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，和
										</font>
									</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">TEXT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）。</font>
										<font style="vertical-align: inherit;">如果表包含单个可变长度列，则表使用动态行格式。</font>
										<font style="vertical-align: inherit;">请参见</font>
									</font><a class="xref" href="storage-engines.html" title="第16章备用存储引擎">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第16章，</font>
										</font><i>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">备用存储引擎</font>
											</font>
										</i>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											将表拆分成不同的表通常没有用，因为行变大。</font>
										<font style="vertical-align: inherit;">在访问行时，最大的性能影响是找到行的第一个字节所需的磁盘搜索。</font>
										<font style="vertical-align: inherit;">查找数据后，大多数现代磁盘可以足够快地读取整行，以满足大多数应用程序的需要。</font>
										<font style="vertical-align: inherit;">拆分表的唯一情况是，如果它是</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">使用动态行格式</font>
										<font style="vertical-align: inherit;">的
										</font>
										<font style="vertical-align: inherit;">表，您可以更改为固定的行大小，或者如果您经常需要扫描表但不需要大多数列。</font>
										<font style="vertical-align: inherit;">请参见</font>
									</font><a class="xref" href="storage-engines.html" title="第16章备用存储引擎">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第16章，</font>
										</font><i>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">备用存储引擎</font>
											</font>
										</i>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">如果您通常按</font>
										<font style="vertical-align: inherit;">顺序</font>
										<font style="vertical-align: inherit;">检索行，
										</font>
										<font style="vertical-align: inherit;">
											请使用</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">通过对表进行大量更改后使用此选项，您可以获得更高的性能。
										</font>
									</font><code class="literal">ALTER TABLE ... ORDER BY
										<em class="replaceable"><code>expr1</code></em>,
										<em class="replaceable"><code>expr2</code></em>, ...</code>
									<font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>expr1</code></em>,
										<em class="replaceable"><code>expr2</code></em>, ...</code>
									<font style="vertical-align: inherit;"></font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果您经常需要根据来自大量行的信息计算结果，例如计数，则最好引入新表并实时更新计数器。</font>
										<font style="vertical-align: inherit;">以下表单的更新非常快：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET </font></font><em class="replaceable"><code>count_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>count_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+1 WHERE </font></font><em class="replaceable"><code>key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当您使用MySQL存储引擎时，这非常重要，例如</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">只有表级锁定（多个读取器与单个编写器）。</font>
										<font style="vertical-align: inherit;">这也为大多数数据库系统提供了更好的性能，因为在这种情况下行锁定管理器做的事情较少。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE语法"><code
										 class="literal">OPTIMIZE TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											定期</font>
										<font style="vertical-align: inherit;">
											使用</font>
										<font style="vertical-align: inherit;">以避免使用动态格式</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表进行</font>
										<font style="vertical-align: inherit;">碎片
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="storage-engines.html#myisam-table-formats" title="16.2.3 MyISAM表存储格式">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第16.2.3节“MyISAM表存储格式”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">使用</font>
									</font><code class="literal">DELAY_KEY_WRITE=1</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">table选项</font>
										<font style="vertical-align: inherit;">
											声明</font>
										<font style="vertical-align: inherit;">表
										</font>
										<font style="vertical-align: inherit;">会使索引更新更快，因为在关闭表之前它们不会刷新到磁盘。</font>
										<font style="vertical-align: inherit;">缺点是，如果在打开这样的表时某些东西会杀死服务器，则必须通过运行带有该</font>
									</font><a class="link" href="server-administration.html#option_mysqld_myisam-recover-options"><code class="option">--myisam-recover-options</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											选项</font>
										<font style="vertical-align: inherit;">的服务器</font>
										<font style="vertical-align: inherit;">或</font>
										<font style="vertical-align: inherit;">在重新启动服务器之前</font>
										<font style="vertical-align: inherit;">运行</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">来确保表可以正常运行
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">（但是，即使在这种情况下，您也不应该因使用而丢失任何内容
										</font>
									</font><code class="literal">DELAY_KEY_WRITE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，因为始终可以从数据行生成密钥信息。）
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											字符串在</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">索引</font>
										<font style="vertical-align: inherit;">中自动压缩前缀和结束空间</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX语法">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第13.1.15节“CREATE INDEX语法”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您可以通过在应用程序中缓存查询或答案，然后一起执行许多插入或更新来提高性能。</font>
										<font style="vertical-align: inherit;">在此操作期间锁定表可确保仅在所有更新后刷新索引缓存一次。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-myisam-bulk-data-loading"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.6.2 MyISAM表的批量数据加载</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091705305296"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								这些性能提示补充了</font>
						</font><a class="xref" href="optimization.html#insert-optimization" title="8.2.5.1优化INSERT语句">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.2.5.1节“优化INSERT语句”中</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">快速插入的一般准则</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表，</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">如果数据文件中间没有已删除的行，则</font>
										<font style="vertical-align: inherit;">可以使用并发插入来在</font>
										<font style="vertical-align: inherit;">语句运行</font>
										<font style="vertical-align: inherit;">的同时添加行
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">请参见</font>
									</font><a class="xref" href="optimization.html#concurrent-inserts" title="8.11.3并发插入">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.11.3节“并发插入”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											通过一些额外的工作，</font>
										<font style="vertical-align: inherit;">当表具有许多索引时，可以使表</font>
									</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
											DATA</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">更快</font>
										<font style="vertical-align: inherit;">地
										</font>
										<font style="vertical-align: inherit;">运行</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">使用以下过程：
										</font>
									</font>
								</p>
								<div class="orderedlist">
									<ol class="orderedlist" type="1">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														执行</font>
												</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														语句或</font>
												</font><a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin  - 管理MySQL服务器的客户端"><span
													 class="command"><strong>
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">mysqladmin flush-tables</font>
															</font>
														</strong></span></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">命令。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														使用</font>
												</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">myisamchk --keys-used = 0 -rq
																</font>
															</font><em class="replaceable"><code>/path/to/db/tbl_name</code></em>
														</strong></span></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														删除表的所有索引使用。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														用数据将数据插入表中
													</font>
												</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
														DATA</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">。</font>
													<font style="vertical-align: inherit;">这不会更新任何索引，因此非常快。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														如果您打算将来只读取该表，请使用</font>
												</font><a class="link" href="programs.html#myisampack" title="4.6.6 myisampack  - 生成压缩的只读MyISAM表"><span
													 class="command"><strong>
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">myisampack</font>
															</font>
														</strong></span></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">进行压缩。</font>
													<font style="vertical-align: inherit;">请参见
													</font>
												</font><a class="xref" href="storage-engines.html#compressed-format" title="16.2.3.3压缩表特性">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">第16.2.3.3节“压缩表特性”</font>
													</font>
												</a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														使用</font>
												</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">myisamchk -rq
																</font>
															</font><em class="replaceable"><code>/path/to/db/tbl_name</code></em>
														</strong></span></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">重新创建索引</font>
													<font style="vertical-align: inherit;">。</font>
													<font style="vertical-align: inherit;">这会在将内容写入磁盘之前在内存中创建索引树，这比更新索引要快得多，</font>
												</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
														DATA</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">因为它避免了大量的磁盘搜索。</font>
													<font style="vertical-align: inherit;">生成的索引树也完美平衡。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														执行</font>
												</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														语句或</font>
												</font><a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin  - 管理MySQL服务器的客户端"><span
													 class="command"><strong>
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">mysqladmin flush-tables</font>
															</font>
														</strong></span></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">命令。
													</font>
												</font>
											</p>
										</li>
									</ol>
								</div>
								<p>
									<a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD DATA</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">如果</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">插入数据</font>
										<font style="vertical-align: inherit;">的</font>
										<font style="vertical-align: inherit;">表为空，</font>
										<font style="vertical-align: inherit;">则自动执行上述优化
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">自动优化和显式使用过程之间的主要区别在于，您可以让
										</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">为索引创建分配更多的临时内存，而不是您希望服务器在执行</font>
									</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
											DATA</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句</font>
										<font style="vertical-align: inherit;">时为索引重新创建分配的内存
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您还可以</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">使用以下语句而不是</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">禁用或启用</font>
										<font style="vertical-align: inherit;">表</font>
										<font style="vertical-align: inherit;">的非唯一索引
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">如果您使用这些语句，则可以跳过
										</font>
									</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">操作：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DISABLE KEYS;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ENABLE KEYS;
</font></font></pre>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											要加快</font>
									</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">使用非事务表的多个语句执行的操作，请锁定表：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LOCK TABLES a WRITE;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插入值（1,23），（2,34），（4,33）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
插入价值观（8,26），（6,29）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解锁表;</font></font><font></font>
</pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											这有利于提高性能，因为在</font>
									</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">完成</font>
										<font style="vertical-align: inherit;">所有</font>
										<font style="vertical-align: inherit;">语句</font>
										<font style="vertical-align: inherit;">之后，索引缓冲区仅刷新到磁盘一次
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">通常，存在与</font>
									</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											语句</font>
										<font style="vertical-align: inherit;">一样多的索引缓冲区刷新</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">如果可以使用单个行插入所有行，则不需要显式锁定语句
										</font>
									</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											锁定还可以降低多连接测试的总时间，尽管单个连接的最长等待时间可能会因为等待锁定而上升。</font>
										<font style="vertical-align: inherit;">假设五个客户端尝试同时执行插入，如下所示：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														连接1执行1000次插入
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														连接2,3和4进行1次插入
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														连接5执行1000次插入
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果不使用锁定，则连接2,3和4在1和5之前完成。如果使用锁定，则连接2,3和4可能在1或5之前未完成，但总时间应为约40％快点。
										</font>
									</font>
								</p>
								<p>
									<a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">操作都非常快，MySQL，但是你可以通过添加周围的一切，做超过约五个连续的插入或更新锁获得更好的整体性能。</font>
										<font style="vertical-align: inherit;">如果你做了很多连续的插入，你可以做一次，</font>
									</font><a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES和UNLOCK TABLES语法"><code
										 class="literal">LOCK
											TABLES</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">然后
										</font>
									</font><a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES和UNLOCK TABLES语法"><code
										 class="literal">UNLOCK
											TABLES</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">偶尔（每1000行左右）允许其他线程访问表。</font>
										<font style="vertical-align: inherit;">这仍然会带来不错的性能提升。
										</font>
									</font>
								</p>
								<p>
									<a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code
										 class="literal">LOAD
											DATA</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">即使使用刚刚概述的策略</font>
										<font style="vertical-align: inherit;">，加载数据的速度仍然要慢得多</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											为了提高性能</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											表，对于</font>
									</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
											DATA</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											和</font>
									</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，通过增加放大键缓存
										</font>
									</font><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">系统变量。</font>
										<font style="vertical-align: inherit;">请参见</font>
									</font><a class="xref" href="server-administration.html#server-configuration" title="5.1.1配置服务器">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第5.1.1节“配置服务器”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="repair-table-optimization"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.6.3优化REPAIR TABLE语句</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091705236704"></a>
					<p>
						<a class="link" href="sql-syntax.html#repair-table" title="13.7.3.5 REPAIR TABLE语法"><code class="literal">REPAIR
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">对于
							</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表类似于使用
							</font>
						</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">myisamchk</font>
									</font>
								</strong></span></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">进行修复操作，并且一些相同的性能优化适用：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">具有控制内存分配的变量。</font>
										<font style="vertical-align: inherit;">您可以通过设置这些变量来提高性能，如
										</font>
									</font><a class="xref" href="programs.html#myisamchk-memory" title="4.6.4.6 myisamchk内存使用情况">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第4.6.4.6节“myisamchk内存使用”中所述</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											因为</font>
									</font><a class="link" href="sql-syntax.html#repair-table" title="13.7.3.5 REPAIR TABLE语法"><code class="literal">REPAIR
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，同样的原则适用，但由于修复是由服务器完成的，因此您需要设置服务器系统变量而不是
										</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">变量。</font>
										<font style="vertical-align: inherit;">此外，除了设置内存分配变量之外，增加
										</font>
									</font><a class="link" href="server-administration.html#sysvar_myisam_max_sort_file_size"><code class="literal">myisam_max_sort_file_size</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											系统变量还增加了修复将使用更快的filesort方法并避免密钥缓存方法更慢修复的可能性。</font>
										<font style="vertical-align: inherit;">在检查以确保有足够的可用空间来容纳表文件的副本之后，将变量设置为系统的最大文件大小。</font>
										<font style="vertical-align: inherit;">必须在包含原始表文件的文件系统中提供可用空间。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								假设</font>
							<font style="vertical-align: inherit;">使用以下选项完成</font>
						</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">myisamchk</font>
									</font>
								</strong></span></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表修复操作以设置其内存分配变量：
							</font>
						</font>
					</p>
					<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--key_buffer_size = 128M --myisam_sort_buffer_size = 256M</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
--read_buffer_size = 64M --write_buffer_size = 64M</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								其中一些</font>
						</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">myisamchk</font>
									</font>
								</strong></span></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">变量对应于服务器系统变量：
							</font>
						</font>
					</p>
					<div class="informaltable">
						<table summary="myisamchk variables and corresponding server system variables.">
							<colgroup>
								<col width="50%">
								<col width="50%">
							</colgroup>
							<thead>
								<tr>
									<th scope="col"><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span
											 class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">myisamchk</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">变量</font>
										</font>
									</th>
									<th scope="col">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">系统变量</font>
										</font>
									</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td scope="row"><code class="literal">key_buffer_size</code></td>
									<td><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a></td>
								</tr>
								<tr>
									<td scope="row"><code class="literal">myisam_sort_buffer_size</code></td>
									<td><a class="link" href="server-administration.html#sysvar_myisam_sort_buffer_size"><code class="literal">myisam_sort_buffer_size</code></a></td>
								</tr>
								<tr>
									<td scope="row"><code class="literal">read_buffer_size</code></td>
									<td><a class="link" href="server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a></td>
								</tr>
								<tr>
									<td scope="row"><code class="literal">write_buffer_size</code></td>
									<td>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">没有</font>
										</font>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								每个服务器系统变量都可以在运行时设置，其中一些（</font>
						</font><a class="link" href="server-administration.html#sysvar_myisam_sort_buffer_size"><code class="literal">myisam_sort_buffer_size</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）除了全局值之外还有会话值。</font>
							<font style="vertical-align: inherit;">设置会话值会限制更改对当前会话的影响，并且不会影响其他用户。</font>
							<font style="vertical-align: inherit;">更改仅全局变量（</font>
						</font><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="server-administration.html#sysvar_myisam_max_sort_file_size"><code class="literal">myisam_max_sort_file_size</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）也会影响其他用户。</font>
							<font style="vertical-align: inherit;">因为
							</font>
						</font><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，您必须考虑缓冲区与这些用户共享。</font>
							<font style="vertical-align: inherit;">例如，如果将</font>
						</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">myisamchk</font>
									</font>
								</strong></span></a>
						<code class="literal">key_buffer_size</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">变量</font>
							<font style="vertical-align: inherit;">设置</font>
							<font style="vertical-align: inherit;">为128MB，则可以设置相应的变量
							</font>
						</font><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量大于该值（如果尚未设置更大），以允许其他会话中的活动使用密钥缓冲区。</font>
							<font style="vertical-align: inherit;">但是，更改全局键缓冲区大小会使缓冲区无效，从而导致磁盘I / O增加并导致其他会话减速。</font>
							<font style="vertical-align: inherit;">避免此问题的另一种方法是使用单独的密钥缓存，为其分配要修复的表中的索引，并在修复完成时取消分配。</font>
							<font style="vertical-align: inherit;">请参见
							</font>
						</font><a class="xref" href="optimization.html#multiple-key-caches" title="8.10.2.2多个密钥缓存">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.10.2.2节“多个密钥缓存”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								根据前面的说明，</font>
						</font><a class="link" href="sql-syntax.html#repair-table" title="13.7.3.5 REPAIR TABLE语法"><code class="literal">REPAIR
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">可以按如下方式进行操作，以使用类似于</font>
						</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">myisamchk</font>
									</font>
								</strong></span></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">命令的</font>
							<font style="vertical-align: inherit;">设置</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">这里分配了一个单独的128MB密钥缓冲区，假定文件系统允许文件大小至少为100GB。
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET SESSION myisam_sort_buffer_size = 256 * 1024 * 1024;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET SESSION read_buffer_size = 64 * 1024 * 1024;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL myisam_max_sort_file_size = 100 * 1024 * 1024 * 1024;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL repair_cache.key_buffer_size = 128 * 1024 * 1024;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CACHE INDEX </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN repair_cache;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
负荷指数进入CACHE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
修理表</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL repair_cache.key_buffer_size = 0;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果您打算更改全局变量但希望仅在</font>
						</font><a class="link" href="sql-syntax.html#repair-table" title="13.7.3.5 REPAIR TABLE语法"><code class="literal">REPAIR
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">操作</font>
							<font style="vertical-align: inherit;">期间执行此</font>
							<font style="vertical-align: inherit;">操作以最小程度地影响其他用户，请将其值保存在用户变量中，然后将其还原。</font>
							<font style="vertical-align: inherit;">例如：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @old_myisam_sort_buffer_size = @@ GLOBAL.myisam_max_sort_file_size;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL myisam_max_sort_file_size = 100 * 1024 * 1024 * 1024;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
REPAIR TABLE tbl_name;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET GLOBAL myisam_max_sort_file_size = @old_myisam_max_sort_file_size;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#repair-table" title="13.7.3.5 REPAIR TABLE语法"><code
							 class="literal">REPAIR
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">如果您希望默认情况下值有效，则可以在服务器启动时全局设置</font>
							<font style="vertical-align: inherit;">
								影响的系统变量</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">例如，将这些行添加到服务器</font>
						</font><code class="filename">my.cnf</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">文件中：
							</font>
						</font>
					</p>
					<pre data-lang="init" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
myisam_sort_buffer_size = 256M</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
的key_buffer_size = 1G</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
myisam_max_sort_file_size = 100G</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								这些设置不包括
							</font>
						</font><a class="link" href="server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">将</font>
						</font><a class="link" href="server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">全局</font>
							<font style="vertical-align: inherit;">设置
							</font>
							<font style="vertical-align: inherit;">为较大的值会对所有会话执行此操作，并且可能会因为具有多个同时会话的服务器的过多内存分配而导致性能受损。
							</font>
						</font>
					</p>
				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="optimizing-memory-tables"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.7优化MEMORY表</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<a class="indexterm" name="idm140091705168992"></a>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							考虑将</font>
					</font><code class="literal">MEMORY</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">表用于经常访问的非关键数据，并且是只读的或很少更新。</font>
						<font style="vertical-align: inherit;">在实际工作负载下</font>
						<font style="vertical-align: inherit;">针对等效</font>
					</font><code class="literal">InnoDB</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">或</font>
					</font><code class="literal">MyISAM</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">表格</font>
						<font style="vertical-align: inherit;">对应用程序进行基准测试
						</font>
						<font style="vertical-align: inherit;">，以确认任何其他性能值得丢失数据的风险，或者在应用程序启动时从基于磁盘的表复制数据的开销。
						</font>
					</font>
				</p>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							为了获得</font>
					</font><code class="literal">MEMORY</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">表的</font>
						<font style="vertical-align: inherit;">最佳性能</font>
						<font style="vertical-align: inherit;">，请检查针对每个表的查询类型，并指定要用于每个关联索引的类型，B树索引或哈希索引。</font>
						<font style="vertical-align: inherit;">在</font>
					</font><a class="link" href="sql-syntax.html#create-index" title="13.1.15 CREATE INDEX语法"><code class="literal">CREATE
							INDEX</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							声明中，使用</font>
					</font><code class="literal">USING BTREE</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">或
						</font>
					</font><code class="literal">USING HASH</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">。</font>
						<font style="vertical-align: inherit;">对于通过诸如</font>
					</font><code class="literal">&gt;</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">或</font>
						<font style="vertical-align: inherit;">等运算符进行大于或小于比较的查询，B树索引很快</font>
					</font><code class="literal">BETWEEN</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">。</font>
						<font style="vertical-align: inherit;">散列索引仅对通过</font>
					</font><code class="literal">=</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">运算符</font>
						<font style="vertical-align: inherit;">查找单个值的查询</font>
						<font style="vertical-align: inherit;">或</font>
						<font style="vertical-align: inherit;">通过</font>
						<font style="vertical-align: inherit;">运算符的一组受限</font>
						<font style="vertical-align: inherit;">值的查询很快</font>
					</font><code class="literal">IN</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">。</font>
						<font style="vertical-align: inherit;">为什么
						</font>
					</font><code class="literal">USING BTREE</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">通常是比默认值更好的选择</font>
					</font><code class="literal">USING HASH</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">，请参见
						</font>
					</font><a class="xref" href="optimization.html#table-scan-avoidance" title="8.2.1.22避免全表扫描">
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">第8.2.1.22节“避免全表扫描”</font>
						</font>
					</a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">。</font>
						<font style="vertical-align: inherit;">有关不同类型</font>
					</font><code class="literal">MEMORY</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">索引的</font>
						<font style="vertical-align: inherit;">实现细节</font>
						<font style="vertical-align: inherit;">，请参见
						</font>
					</font><a class="xref" href="optimization.html#index-btree-hash" title="8.3.9 B树和哈希索引的比较">
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">第8.3.9节“B树和散列索引的比较”</font>
						</font>
					</a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">。
						</font>
					</font>
				</p>
			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="execution-plan-information"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.8了解查询执行计划</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#using-explain">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.8.1使用EXPLAIN优化查询</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#explain-output">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.8.2 EXPLAIN输出格式</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#explain-extended">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.8.3扩展EXPLAIN输出格式</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#explain-for-connection">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.8.4获取命名连接的执行计划信息</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#estimating-performance">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.8.5估计查询性能</font>
									</font>
								</a></span></dt></dl>
				</div>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							根据表，列，索引和</font>
					</font><code class="literal">WHERE</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">子句中</font>
						<font style="vertical-align: inherit;">的条件的详细信息</font>
						<font style="vertical-align: inherit;">，MySQL优化器会考虑许多技术来有效地执行SQ​​L查询中涉及的查找。</font>
						<font style="vertical-align: inherit;">可以在不读取所有行的情况下执行对大表的查询; </font>
						<font style="vertical-align: inherit;">可以在不比较每个行组合的情况下执行涉及多个表的连接。</font>
						<font style="vertical-align: inherit;">优化程序选择执行最有效查询的操作集称为</font>
					</font><span class="quote">
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">“ </font>
						</font><span class="quote">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">查询执行计划</font>
							</font>
						</span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;"> ”</font>
						</font>
					</span>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">，也称为
						</font>
					</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">计划。</font>
						<font style="vertical-align: inherit;">你的目标是认识到的方方面面
						</font>
					</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;"> 计划表明查询已经过优化，并且如果您看到一些低效的操作，请学习SQL语法和索引技术以改进计划。
						</font>
					</font>
				</p>
				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="using-explain"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.8.1使用EXPLAIN优化查询</font>
									</font>
								</h3>
							</div>
						</div>
					</div>
					<a class="indexterm" name="idm140091705146688"></a><a class="indexterm" name="idm140091705145648"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句提供有关MySQL如何执行语句的信息：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">作品有
										</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE语法"><code class="literal">REPLACE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，和
										</font>
									</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当</font>
									</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">与可解释语句一起使用时，MySQL会显示优化程序中有关语句执行计划的信息。</font>
										<font style="vertical-align: inherit;">也就是说，MySQL解释了它将如何处理语句，包括有关如何连接表以及以何种顺序连接的信息。</font>
										<font style="vertical-align: inherit;">有关使用
										</font>
									</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">获取执行计划信息的信息，请参见</font>
									</font><a class="xref" href="optimization.html#explain-output" title="8.8.2 EXPLAIN输出格式">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.8.2节“EXPLAIN输出格式”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当</font>
									</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">使用with
										</font>
										<font style="vertical-align: inherit;">而不是可解释的语句时，它显示在命名连接中执行的语句的执行计划。</font>
										<font style="vertical-align: inherit;">请参见</font><a class="xref" href="optimization.html#explain-for-connection"
										 title="8.8.4获取命名连接的执行计划信息">
											<font style="vertical-align: inherit;">第8.8.4节“获取命名连接的执行计划信息”</font>
										</a>
										<font style="vertical-align: inherit;">。
										</font>
									</font><code class="literal">FOR CONNECTION
										<em class="replaceable"><code>connection_id</code></em></code>
									<font style="vertical-align: inherit;"></font><a class="xref" href="optimization.html#explain-for-connection"
									 title="8.8.4获取命名连接的执行计划信息">
										<font style="vertical-align: inherit;"></font>
									</a>
									<font style="vertical-align: inherit;"></font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句，
										</font>
									</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">生成可以使用的其他执行计划信息
										</font>
									</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
											WARNINGS</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="optimization.html#explain-extended" title="8.8.3扩展EXPLAIN输出格式">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.8.3节“扩展EXPLAIN输出格式”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">用于检查涉及分区表的查询。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="partitioning.html#partitioning-info" title="23.3.5获取分区信息">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第23.3.5节“获取有关分区的信息”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该</font>
									</font><code class="literal">FORMAT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">选项可用于选择输出格式。</font>
									</font><code class="literal">TRADITIONAL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">以表格格式显示输出。</font>
										<font style="vertical-align: inherit;">如果没有</font>
									</font><code class="literal">FORMAT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">选项，则</font>
										<font style="vertical-align: inherit;">这是默认值
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font><code class="literal">JSON</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">format以JSON格式显示信息。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<a class="indexterm" name="idm140091705112432"></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">

								借助于</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，您可以看到应该向表添加索引的位置，以便通过使用索引查找行来更快地执行语句。</font>
							<font style="vertical-align: inherit;">您还可以使用
							</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">检查优化程序是否以最佳顺序连接表。</font>
							<font style="vertical-align: inherit;">要给优化器提供一个提示，以使用与</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句</font>
							<font style="vertical-align: inherit;">中命名表的顺序相对应的连接顺序
							</font>
							<font style="vertical-align: inherit;">，请使用</font>
						</font><code class="literal">SELECT STRAIGHT_JOIN</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">而不是仅仅</font>
							<font style="vertical-align: inherit;">开始语句</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">（请参见
							</font>
						</font><a class="xref" href="sql-syntax.html#select" title="13.2.10 SELECT语法">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第13.2.10节“SELECT语法”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。）但是，
							</font>
						</font><code class="literal">STRAIGHT_JOIN</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">可能会阻止使用索引，因为它会禁用半连接转换。</font>
							<font style="vertical-align: inherit;">看到
							</font>
						</font><a class="xref" href="optimization.html#semi-joins" title="8.2.2.1使用半连接转换优化子查询，派生表，视图引用和公用表表达式">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表，视图引用和公用表表达式”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化器跟踪有时可以提供与其相辅相成的信息</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">但是，优化程序跟踪格式和内容可能会在不同版本之间发生变化。</font>
							<font style="vertical-align: inherit;">有关详细信息，请参阅
							</font>
						</font><a class="ulink" href="https://dev.mysql.com/doc/internals/en/optimizer-tracing.html" target="_top">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">MySQL内部：跟踪优化程序</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果您在认为应该使用索引时遇到问题，请运行</font>
						</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">以更新表统计信息，例如密钥的基数，这可能会影响优化程序所做的选择。</font>
							<font style="vertical-align: inherit;">请参见
							</font>
						</font><a class="xref" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第13.7.3.1节“ANALYZE TABLE语法”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

						<div class="admon-title">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									注意
								</font>
							</font>
						</div>
						<p>
							<a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">也可用于获取有关表中列的信息。
								</font>
								<font style="vertical-align: inherit;">是</font>
								<font style="vertical-align: inherit;">和的
								</font>
								<font style="vertical-align: inherit;">同义词</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">有关更多信息，请参见</font><a class="xref" href="sql-syntax.html#describe" title="13.8.1 DESCRIBE语法">
									<font style="vertical-align: inherit;">第13.8.1节“DESCRIBE语法”</font>
								</a>
								<font style="vertical-align: inherit;">和
								</font><a class="xref" href="sql-syntax.html#show-columns" title="13.7.6.5 SHOW COLUMNS语法">
									<font style="vertical-align: inherit;">第13.7.6.5节“显示列语法”</font>
								</a>
								<font style="vertical-align: inherit;">。
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN
									<em class="replaceable"><code>tbl_name</code></em></code></a>
							<font style="vertical-align: inherit;"></font><code class="literal">DESCRIBE
								<em class="replaceable"><code>tbl_name</code></em></code>
							<font style="vertical-align: inherit;"></font><code class="literal">SHOW COLUMNS FROM
								<em class="replaceable"><code>tbl_name</code></em></code>
							<font style="vertical-align: inherit;"></font><a class="xref" href="sql-syntax.html#describe" title="13.8.1 DESCRIBE语法">
								<font style="vertical-align: inherit;"></font>
							</a>
							<font style="vertical-align: inherit;"></font><a class="xref" href="sql-syntax.html#show-columns" title="13.7.6.5 SHOW COLUMNS语法">
								<font style="vertical-align: inherit;"></font>
							</a>
							<font style="vertical-align: inherit;"></font>
						</p>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="explain-output"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.8.2 EXPLAIN输出格式</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句提供有关MySQL如何执行语句的信息。
							</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">作品有
							</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE语法"><code class="literal">REPLACE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，和
							</font>
						</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句。
							</font>
						</font>
					</p>
					<p>
						<a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">返回</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句</font>
							<font style="vertical-align: inherit;">中使用的每个表的一行信息
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">它按照MySQL在处理语句时读取它们的顺序列出输出中的表。</font>
							<font style="vertical-align: inherit;">MySQL使用嵌套循环连接方法解析所有连接。</font>
							<font style="vertical-align: inherit;">这意味着MySQL从第一个表中读取一行，然后在第二个表，第三个表中找到匹配的行，依此类推。</font>
							<font style="vertical-align: inherit;">处理完所有表后，MySQL将通过表列表输出所选列和回溯，直到找到有更多匹配行的表。</font>
							<font style="vertical-align: inherit;">从该表中读取下一行，并继续下一个表。
							</font>
						</font>
					</p>
					<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

						<div class="admon-title">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									注意
								</font>
							</font>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL Workbench具有Visual Explain功能，可以直观地显示
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">输出。</font>
								<font style="vertical-align: inherit;">请参阅
								</font>
							</font><a class="ulink" href="https://dev.mysql.com/doc/workbench/en/wb-tutorial-visual-explain-dbt3.html"
							 target="_top">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">教程：使用说明来提高查询性能</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p><a class="xref" href="optimization.html#explain-output-columns" title="EXPLAIN输出列">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">EXPLAIN输出列</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#explain-join-types" title="EXPLAIN加入类型">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">EXPLAIN加入类型</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#explain-extra-information" title="解释额外信息">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">解释额外信息</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#explain-output-interpretation" title="EXPLAIN输出解释">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">EXPLAIN输出解释</font>
										</font>
									</a></p>
							</li>
						</ul>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="explain-output-columns"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">EXPLAIN输出列</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									本节介绍生成的输出列
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">后面的部分提供有关</font>
							</font><a class="link" href="optimization.html#explain-join-types" title="EXPLAIN加入类型"><code class="literal">type</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									和
								</font>
							</font><a class="link" href="optimization.html#explain-extra-information" title="解释额外信息"><code class="literal">Extra</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									列的</font>
								<font style="vertical-align: inherit;">其他信息
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									每个输出行</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									提供有关一个表的信息。</font>
								<font style="vertical-align: inherit;">每行包含</font>
							</font><a class="xref" href="optimization.html#explain-output-column-table" title="表8.1 EXPLAIN输出列">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表8.1“EXPLAIN输出列”中</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">汇总的值
								</font>
								<font style="vertical-align: inherit;">，并在表后面进行了更详细的描述。</font>
								<font style="vertical-align: inherit;">列名显示在表的第一列中; </font>
								<font style="vertical-align: inherit;">第二列提供了</font>
							</font><code class="literal">FORMAT=JSON</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">使用</font>
								<font style="vertical-align: inherit;">时输出中显示的等效属性名称
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<div class="table">
							<a name="explain-output-column-table"></a>
							<p class="title"><b>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表8.1 EXPLAIN输出列</font>
									</font>
								</b></p>
							<div class="table-contents">
								<table summary="Output columns produced by the EXPLAIN statement.">
									<colgroup>
										<col width="25%">
										<col width="25%">
										<col width="50%">
									</colgroup>
									<thead>
										<tr>
											<th scope="col">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">柱</font>
												</font>
											</th>
											<th scope="col">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">JSON名称</font>
												</font>
											</th>
											<th scope="col">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">含义</font>
												</font>
											</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_id"><code class="literal">id</code></a></td>
											<td><code class="literal">select_id</code></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">该</font>
												</font><code class="literal">SELECT</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">标识符</font>
												</font>
											</td>
										</tr>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_select_type"><code class="literal">select_type</code></a></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">没有</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">该</font>
												</font><code class="literal">SELECT</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">类型</font>
												</font>
											</td>
										</tr>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_table"><code class="literal">table</code></a></td>
											<td><code class="literal">table_name</code></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">输出行的表</font>
												</font>
											</td>
										</tr>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_partitions"><code class="literal">partitions</code></a></td>
											<td><code class="literal">partitions</code></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">匹配的分区</font>
												</font>
											</td>
										</tr>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_type"><code class="literal">type</code></a></td>
											<td><code class="literal">access_type</code></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">连接类型</font>
												</font>
											</td>
										</tr>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_possible_keys"><code class="literal">possible_keys</code></a></td>
											<td><code class="literal">possible_keys</code></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">可供选择的索引</font>
												</font>
											</td>
										</tr>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_key"><code class="literal">key</code></a></td>
											<td><code class="literal">key</code></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">实际选择的指数</font>
												</font>
											</td>
										</tr>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_key_len"><code class="literal">key_len</code></a></td>
											<td><code class="literal">key_length</code></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">所选键的长度</font>
												</font>
											</td>
										</tr>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_ref"><code class="literal">ref</code></a></td>
											<td><code class="literal">ref</code></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">列与索引进行比较</font>
												</font>
											</td>
										</tr>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_rows"><code class="literal">rows</code></a></td>
											<td><code class="literal">rows</code></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">估计要检查的行</font>
												</font>
											</td>
										</tr>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_filtered"><code class="literal">filtered</code></a></td>
											<td><code class="literal">filtered</code></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">按表条件过滤的行的百分比</font>
												</font>
											</td>
										</tr>
										<tr>
											<td scope="row"><a class="link" href="optimization.html#explain_extra"><code class="literal">Extra</code></a></td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">没有</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">附加信息</font>
												</font>
											</td>
										</tr>
									</tbody>
								</table>
							</div>

						</div>
						<br class="table-break">
						<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

							<div class="admon-title">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										注意
									</font>
								</font>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										JSON属性</font>
								</font><code class="literal">NULL</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">未显示在JSON格式的</font>
								</font><code class="literal">EXPLAIN</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										输出中。
									</font>
								</font>
							</p>
						</div>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p><a name="explain_id"></a>
										<code class="literal">id</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON名：
											</font>
										</font><code class="literal">select_id</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												的</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">标识符。</font>
											<font style="vertical-align: inherit;">这是</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">查询中的</font>
											<font style="vertical-align: inherit;">序号
											</font>
											<font style="vertical-align: inherit;">。</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">如果行引用其他行的联合结果，则</font>
											<font style="vertical-align: inherit;">该值可以是</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">在这种情况下，该
											</font>
										</font><code class="literal">table</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列显示一个值
											</font>
											<font style="vertical-align: inherit;">
												，表示该行引用</font>
											<font style="vertical-align: inherit;">值为</font>
											<font style="vertical-align: inherit;">和</font>
											<font style="vertical-align: inherit;">的行</font>
											<font style="vertical-align: inherit;">的
											</font>
											<font style="vertical-align: inherit;">并集
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">&lt;union<em class="replaceable"><code>M</code></em>,<em class="replaceable"><code>N</code></em>&gt;</code>
										<font style="vertical-align: inherit;"></font><code class="literal">id</code>
										<font style="vertical-align: inherit;"></font><em class="replaceable"><code>M</code></em>
										<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="explain_select_type"></a>
										<code class="literal">select_type</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> （JSON名称：无）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												类型</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，可以是下表中显示的任何</font>
											<font style="vertical-align: inherit;">类型</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">JSON格式化</font>
										</font><code class="literal">EXPLAIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">将</font>
										</font><code class="literal">SELECT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">类型</font>
											<font style="vertical-align: inherit;">公开
											</font>
											<font style="vertical-align: inherit;">为a的属性
											</font>
										</font><code class="literal">query_block</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，除非它是
											</font>
										</font><code class="literal">SIMPLE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或</font>
										</font><code class="literal">PRIMARY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">JSON名称（如果适用）也显示在表中。
											</font>
										</font>
									</p>
									<div class="informaltable">
										<table summary="select_type values and the meaning of each value.">
											<colgroup>
												<col width="25%">
												<col width="25%">
												<col width="50%">
											</colgroup>
											<thead>
												<tr>
													<th scope="col"><code class="literal">select_type</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;"> 值</font>
														</font>
													</th>
													<th scope="col">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">JSON名称</font>
														</font>
													</th>
													<th scope="col">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">含义</font>
														</font>
													</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td scope="row"><code class="literal">SIMPLE</code></td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">没有</font>
														</font>
													</td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">简单</font>
														</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">（不使用
															</font>
														</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">或子查询）</font>
														</font>
													</td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">PRIMARY</code></td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">没有</font>
														</font>
													</td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">最 </font>
														</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
													</td>
												</tr>
												<tr>
													<td scope="row"><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a></td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">没有</font>
														</font>
													</td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">第二次或以后的</font>
														</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">陈述
															</font>
														</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a>
													</td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">DEPENDENT UNION</code></td>
													<td><code class="literal">dependent</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">（</font>
														</font><code class="literal">true</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">）</font>
														</font>
													</td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">a中的第二个或更晚的</font>
														</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">语句
															</font>
														</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">，取决于外部查询</font>
														</font>
													</td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">UNION RESULT</code></td>
													<td><code class="literal">union_result</code></td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">的结果</font>
														</font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code class="literal">UNION</code></a>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">。</font>
														</font>
													</td>
												</tr>
												<tr>
													<td scope="row"><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code
															 class="literal">SUBQUERY</code></a></td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">没有</font>
														</font>
													</td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">首先</font>
														</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">是子查询</font>
														</font>
													</td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">DEPENDENT SUBQUERY</code></td>
													<td><code class="literal">dependent</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">（</font>
														</font><code class="literal">true</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">）</font>
														</font>
													</td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">首先</font>
														</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">在子查询中，依赖于外部查询</font>
														</font>
													</td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">DERIVED</code></td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">没有</font>
														</font>
													</td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">派生表</font>
														</font>
													</td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">DEPENDENT DERIVED</code></td>
													<td><code class="literal">dependent</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">（</font>
														</font><code class="literal">true</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">）</font>
														</font>
													</td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">派生表依赖于另一个表</font>
														</font>
													</td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">MATERIALIZED</code></td>
													<td><code class="literal">materialized_from_subquery</code></td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">物化子查询</font>
														</font>
													</td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">UNCACHEABLE SUBQUERY</code></td>
													<td><code class="literal">cacheable</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">（</font>
														</font><code class="literal">false</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">）</font>
														</font>
													</td>
													<td>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">无法缓存结果的子查询，必须为外部查询的每一行重新计算</font>
														</font>
													</td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">UNCACHEABLE UNION</code></td>
													<td><code class="literal">cacheable</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">（</font>
														</font><code class="literal">false</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">）</font>
														</font>
													</td>
													<td>
														<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#union" title="13.2.10.3 UNION语法"><code
															 class="literal">UNION</code></a>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">
																属于不可缓存的子查询</font>
															<font style="vertical-align: inherit;">的第二个或后一个选择</font>
															<font style="vertical-align: inherit;">（请参阅参考资料
															</font>
														</font><code class="literal">UNCACHEABLE SUBQUERY</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">）</font>
														</font>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
									<p>
										<code class="literal">DEPENDENT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">通常表示使用相关子查询。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#correlated-subqueries" title="13.2.11.7相关子查询">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.2.11.7节“相关子查询”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<code class="literal">DEPENDENT SUBQUERY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">评估与评估不同</font>
										</font><code class="literal">UNCACHEABLE SUBQUERY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">因为</font>
										</font><code class="literal">DEPENDENT SUBQUERY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，子查询仅针对来自其外部上下文的变量的每组不同值重新评估一次。</font>
											<font style="vertical-align: inherit;">对于
											</font>
										</font><code class="literal">UNCACHEABLE SUBQUERY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，子查询将针对外部上下文的每一行重新进行评估。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当您指定</font>
										</font><code class="literal">FORMAT=JSON</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">时
											</font>
										</font><code class="literal">EXPLAIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，输出没有直接等效的单个属性
											</font>
										</font><code class="literal">select_type</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">; </font>
											<font style="vertical-align: inherit;">该
											</font>
										</font><code class="literal">query_block</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">属性对应于给定的</font>
										</font><code class="literal">SELECT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">可以使用与</font>
										</font><code class="literal">SELECT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">刚显示的</font>
											<font style="vertical-align: inherit;">大多数</font>
											<font style="vertical-align: inherit;">子查询类型</font>
											<font style="vertical-align: inherit;">等效的属性</font>
											<font style="vertical-align: inherit;">（示例
											</font>
										</font><code class="literal">materialized_from_subquery</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">为
											</font>
										</font><code class="literal">MATERIALIZED</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">），并在适当时显示。</font>
											<font style="vertical-align: inherit;">没有JSON等价物
											</font>
										</font><code class="literal">SIMPLE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或</font>
										</font><code class="literal">PRIMARY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;"></font><code class="literal">select_type</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">非</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句</font>
											<font style="vertical-align: inherit;">
												的</font>
											<font style="vertical-align: inherit;">值</font>
											<font style="vertical-align: inherit;">显示受影响表的语句类型。</font>
											<font style="vertical-align: inherit;">例如，</font>
										</font><code class="literal">select_type</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是
											</font>
										</font><code class="literal">DELETE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">用于
											</font>
										</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">陈述。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="explain_table"></a>
										<code class="literal">table</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON名：
											</font>
										</font><code class="literal">table_name</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												输出行引用的表的名称。</font>
											<font style="vertical-align: inherit;">这也可以是以下值之一：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<code class="literal">&lt;union<em class="replaceable"><code>M</code></em>,<em class="replaceable"><code>N</code></em>&gt;</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：行指的是</font>
													</font><code class="literal">id</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">值为</font>
													</font><em class="replaceable"><code>M</code></em>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">和</font>
														<font style="vertical-align: inherit;">的行
														</font>
														<font style="vertical-align: inherit;">的
														</font>
														<font style="vertical-align: inherit;">并集
														</font>
													</font><em class="replaceable"><code>N</code></em>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<code class="literal">&lt;derived<em class="replaceable"><code>N</code></em>&gt;</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：该行是指用于与该行的派生表结果</font>
													</font><code class="literal">id</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">的值
														</font>
													</font><em class="replaceable"><code>N</code></em>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。</font>
														<font style="vertical-align: inherit;">例如，派生表可能来自</font>
													</font><code class="literal">FROM</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">子句中</font>
														<font style="vertical-align: inherit;">的子查询
														</font>
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<code class="literal">&lt;subquery<em class="replaceable"><code>N</code></em>&gt;</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：行引用</font>
													</font><code class="literal">id</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															值为</font>
														<font style="vertical-align: inherit;">的行的具体化子查询的结果</font>
													</font><em class="replaceable"><code>N</code></em>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。</font>
														<font style="vertical-align: inherit;">请参见
														</font>
													</font><a class="xref" href="optimization.html#subquery-materialization" title="8.2.2.2使用实现优化子查询">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">第8.2.2.2节“使用实现优化子查询”</font>
														</font>
													</a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
								</li>
								<li class="listitem">
									<p><a name="explain_partitions"></a>
										<code class="literal">partitions</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON名：
											</font>
										</font><code class="literal">partitions</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												查询将匹配记录的分区。</font>
											<font style="vertical-align: inherit;">该值适用</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">于非分区表。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="partitioning.html#partitioning-info" title="23.3.5获取分区信息">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第23.3.5节“获取有关分区的信息”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="explain_type"></a>
										<code class="literal">type</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON名：
											</font>
										</font><code class="literal">access_type</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												连接类型。</font>
											<font style="vertical-align: inherit;">有关不同类型的说明，请参阅
											</font>
										</font><a class="link" href="optimization.html#explain-join-types" title="EXPLAIN加入类型"><code class="literal">EXPLAIN</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													连接类型</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="explain_possible_keys"></a>
										<code class="literal">possible_keys</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON名：
											</font>
										</font><code class="literal">possible_keys</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">possible_keys</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列指示MySQL可以从中选择查找此表中的行的索引。</font>
											<font style="vertical-align: inherit;">请注意，此列完全独立于输出中显示的表的顺序
											</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">这意味着某些键</font>
										</font><code class="literal">possible_keys</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可能无法在生成中使用生成的表顺序。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果此列是</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（或在JSON格式的输出中未定义），则没有相关索引。</font>
											<font style="vertical-align: inherit;">在这种情况下，您可以通过检查</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												子句以检查它是否引用适合索引的某些列或列</font>
											<font style="vertical-align: inherit;">来提高查询性能</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">如果是，请创建适当的索引并</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">再次</font>
											<font style="vertical-align: inherit;">检查查询
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.1.9节“ALTER TABLE语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												要查看表有哪些索引，请使用</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">SHOW INDEX
											FROM <em class="replaceable"><code>tbl_name</code></em></code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="explain_key"></a>
										<code class="literal">key</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON名：</font>
										</font><code class="literal">key</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">key</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列指示MySQL实际决定使用的密钥（索引）。</font>
											<font style="vertical-align: inherit;">如果MySQL决定使用其中一个</font>
										</font><code class="literal">possible_keys</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												索引来查找行，那么该索引将被列为键值。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												可能</font>
										</font><code class="literal">key</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">会命名值中不存在的索引
											</font>
										</font><code class="literal">possible_keys</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">如果没有</font>
										</font><code class="literal">possible_keys</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引适合查找行，</font>
											<font style="vertical-align: inherit;">则会发生这种情况</font>
											<font style="vertical-align: inherit;">，但查询选择的所有列都是其他索引的列。</font>
											<font style="vertical-align: inherit;">也就是说，命名索引覆盖了所选列，因此虽然它不用于确定要检索的行，但索引扫描比数据行扫描更有效。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												因为</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，即使查询还选择主键，辅助索引也可能覆盖所选列，因为</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">主键值与每个辅助索引一起存储。</font>
											<font style="vertical-align: inherit;">如果
											</font>
										</font><code class="literal">key</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，MySQL没有找到用于更有效地执行查询的索引。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												要强制MySQL使用或忽略列出的索引
											</font>
										</font><code class="literal">possible_keys</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列，使用
											</font>
										</font><code class="literal">FORCE INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">USE
											INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或</font>
										</font><code class="literal">IGNORE INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在您的查询。</font>
											<font style="vertical-align: inherit;">请参见</font>
										</font><a class="xref" href="optimization.html#index-hints" title="8.9.4索引提示">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.9.4节“索引提示”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表，运行
											</font>
										</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
												TABLE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">有助于优化器选择更好的索引。</font>
											<font style="vertical-align: inherit;">对于
											</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表格，</font>
										</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">myisamchk --analyze也是</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">如此。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.7.3.1节“ANALYZE TABLE语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="xref" href="backup-and-recovery.html#myisam-table-maintenance" title="7.6 MyISAM表维护和崩溃恢复">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第7.6节“MyISAM表维护和崩溃恢复”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="explain_key_len"></a>
										<code class="literal">key_len</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON名：
											</font>
										</font><code class="literal">key_length</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">key_len</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列指示MySQL决定使用的密钥的长度。</font>
											<font style="vertical-align: inherit;">该值
											</font>
										</font><code class="literal">key_len</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">使您可以确定MySQL实际使用的多部分密钥的多少部分。</font>
											<font style="vertical-align: inherit;">如果</font>
										</font><code class="literal">key</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列说
											</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，该</font>
										</font><code class="literal">len_len</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												列也说</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												由于密钥存储格式，对于可能</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												比</font>
											<font style="vertical-align: inherit;">列的列，密钥长度更大</font>
										</font><code class="literal">NOT NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="explain_ref"></a>
										<code class="literal">ref</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON名：</font>
										</font><code class="literal">ref</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">ref</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列显示将哪些列或常量与列中指定的索引进行比较，以
											</font>
										</font><code class="literal">key</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">从表中选择行。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果值为</font>
										</font><code class="literal">func</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，则使用的值是某个函数的结果。</font>
											<font style="vertical-align: inherit;">要查看哪个函数，请使用
											</font>
										</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
												WARNINGS</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">以下内容
											</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">查看扩展
											</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">输出。</font>
											<font style="vertical-align: inherit;">该函数实际上可能是算术运算符等运算符。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="explain_rows"></a>
										<code class="literal">rows</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON名：
											</font>
										</font><code class="literal">rows</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">rows</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列指示MySQL认为必须检查以执行查询的行数。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于</font>
										</font><a class="link" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎"><code class="literal">InnoDB</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表格，此数字是估算值，可能并不总是准确的。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="explain_filtered"></a>
										<code class="literal">filtered</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON名：
											</font>
										</font><code class="literal">filtered</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">filtered</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列指示将按表条件过滤的表行的估计百分比。</font>
											<font style="vertical-align: inherit;">最大值为100，这意味着不会对行进行过滤。</font>
											<font style="vertical-align: inherit;">值从100开始减少表示过滤量增加。
											</font>
										</font><code class="literal">rows</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">显示检查的估计行数，</font>
										</font><code class="literal">rows</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">×
											</font>
										</font><code class="literal">filtered</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表示将与下表连接的行数。</font>
											<font style="vertical-align: inherit;">例如，如果
											</font>
										</font><code class="literal">rows</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是1000并且
											</font>
										</font><code class="literal">filtered</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是50.00（50％），则使用下表连接的行数是1000×50％= 500。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="explain_extra"></a>
										<code class="literal">Extra</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> （JSON名称：无）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												此列包含有关MySQL如何解析查询的其他信息。</font>
											<font style="vertical-align: inherit;">有关不同值的说明，请参阅
											</font>
										</font><a class="link" href="optimization.html#explain-extra-information" title="解释额外信息"><code class="literal">EXPLAIN</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													附加信息</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												没有与该</font>
										</font><code class="literal">Extra</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列</font>
											<font style="vertical-align: inherit;">对应的单个JSON属性
											</font>
											<font style="vertical-align: inherit;">; </font>
											<font style="vertical-align: inherit;">但是，此列中可能出现的值将作为JSON属性公开，或作为属性的文本公开</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="explain-join-types"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">EXPLAIN加入类型</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><code class="literal">type</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">输出介绍如何联接表。</font>
								<font style="vertical-align: inherit;">在JSON格式的输出中，这些是作为</font>
							</font><code class="literal">access_type</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">属性的</font>
								<font style="vertical-align: inherit;">值找到的</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">以下列表描述了从最佳类型到最差类型的连接类型：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p><a name="jointype_system"></a>
										<a class="indexterm" name="idm140091704777600"></a>

										<a class="indexterm" name="idm140091704776144"></a>

										<a class="indexterm" name="idm140091704774656"></a>

										<a class="link" href="optimization.html#jointype_system"><code class="literal">system</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该表只有一行（=系统表）。</font>
											<font style="vertical-align: inherit;">这是</font>
										</font><a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">连接类型</font>
											<font style="vertical-align: inherit;">的特例
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="jointype_const"></a>
										<a class="indexterm" name="idm140091704768976"></a>

										<a class="indexterm" name="idm140091704767520"></a>

										<a class="indexterm" name="idm140091704766032"></a>

										<a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该表最多只有一个匹配行，在查询开头读取。</font>
											<font style="vertical-align: inherit;">因为只有一行，所以优化器的其余部分可以将此行中列的值视为常量。
											</font>
										</font><a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表非常快，因为它们只读一次。
											</font>
										</font>
									</p>
									<p>
										<a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">将a </font>
										</font><code class="literal">PRIMARY KEY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><code class="literal">UNIQUE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引的</font>
											<font style="vertical-align: inherit;">所有部分</font>
											<font style="vertical-align: inherit;">与常量值</font>
											<font style="vertical-align: inherit;">进行比较时使用</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">在以下查询中，</font>
										</font><em class="replaceable"><code>tbl_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可以用作</font>
										</font><a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>primary_key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1 AND </font></font><em class="replaceable"><code>primary_key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 2;
</font></font></pre>
								</li>
								<li class="listitem">
									<p><a name="jointype_eq_ref"></a>
										<a class="indexterm" name="idm140091704752128"></a>

										<a class="indexterm" name="idm140091704750672"></a>

										<a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于前面表格中的每个行组合，从该表中读取一行。</font>
											<font style="vertical-align: inherit;">除了
											</font>
										</font><a class="link" href="optimization.html#jointype_system"><code class="literal">system</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">类型之外，这是最好的连接类型。</font>
											<font style="vertical-align: inherit;">当连接使用索引的所有部分且索引是
											</font>
											<font style="vertical-align: inherit;">索引</font>
										</font><code class="literal">PRIMARY KEY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或</font>
										</font><code class="literal">UNIQUE NOT
											NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引时使用它。
											</font>
										</font>
									</p>
									<p>
										<a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可用于使用</font>
										</font><code class="literal">=</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">运算符</font>
											<font style="vertical-align: inherit;">进行比较的索引列
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">比较值可以是常量，也可以是使用在此表之前读取的表中的列的表达式。</font>
											<font style="vertical-align: inherit;">在以下示例中，MySQL可以使用
											</font>
										</font><a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">联接来处理
											</font>
										</font><em class="replaceable"><code>ref_table</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1;
</font></font></pre>
								</li>
								<li class="listitem">
									<p><a name="jointype_ref"></a>
										<a class="indexterm" name="idm140091704731008"></a>

										<a class="indexterm" name="idm140091704729584"></a>

										<a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于前面表中的每个行组合，将从此表中读取具有匹配索引值的所有行。</font>
										</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">如果连接仅使用键的最左前缀或者键不是a </font>
										</font><code class="literal">PRIMARY KEY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><code class="literal">UNIQUE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引（换句话说，如果连接不能基于键值选择单行），则使用此方法。</font>
											<font style="vertical-align: inherit;">如果使用的密钥只匹配几行，这是一个很好的连接类型。
											</font>
										</font>
									</p>
									<p>
										<a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可以用于使用</font>
										</font><code class="literal">=</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">or </font>
										</font><code class="literal">&lt;=&gt;</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												运算符</font>
											<font style="vertical-align: inherit;">进行比较的索引列
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">在以下示例中，MySQL可以使用
											</font>
										</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">联接来处理
											</font>
										</font><em class="replaceable"><code>ref_table</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>other_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em class="replaceable"><code>key_column_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 1;
</font></font></pre>
								</li>
								<li class="listitem">
									<p><a name="jointype_fulltext"></a>
										<a class="indexterm" name="idm140091704708256"></a>

										<a class="indexterm" name="idm140091704706800"></a>

										<a class="link" href="optimization.html#jointype_fulltext"><code class="literal">fulltext</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												使用</font>
										</font><code class="literal">FULLTEXT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												索引</font>
											<font style="vertical-align: inherit;">执行连接</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="jointype_ref_or_null"></a>
										<a class="indexterm" name="idm140091704701568"></a>

										<a class="indexterm" name="idm140091704700112"></a>

										<a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这种连接类型是这样的
											</font>
										</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，但除此之外，MySQL还会对包含</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">值的</font>
											<font style="vertical-align: inherit;">行进行额外搜索</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">此连接类型优化最常用于解析子查询。</font>
											<font style="vertical-align: inherit;">在以下示例中，MySQL可以使用
											</font>
										</font><a class="link" href="optimization.html#jointype_ref_or_null"><code class="literal">ref_or_null</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">联接来处理</font>
										</font><em class="replaceable"><code>ref_table</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>ref_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR为</font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NULL;
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												请参见</font>
										</font><a class="xref" href="optimization.html#is-null-optimization" title="8.2.1.14 IS NULL优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.14节“IS NULL优化”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="jointype_index_merge"></a>
										<a class="indexterm" name="idm140091704687984"></a>

										<a class="indexterm" name="idm140091704686528"></a>

										<a class="link" href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												此连接类型表示使用了索引合并优化。</font>
											<font style="vertical-align: inherit;">在这种情况下，</font>
										</font><code class="literal">key</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">输出行中的列包含使用的索引列表，并</font>
										</font><code class="literal">key_len</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">包含所用</font>
											<font style="vertical-align: inherit;">索引
											</font>
											<font style="vertical-align: inherit;">的最长关键部分的列表。</font>
											<font style="vertical-align: inherit;">有关更多信息，请参见
											</font>
										</font><a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.3索引合并优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.3节“索引合并优化”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="jointype_unique_subquery"></a>
										<a class="indexterm" name="idm140091704679760"></a>

										<a class="indexterm" name="idm140091704678272"></a>

										<a class="link" href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												此类型替换
											</font>
											<font style="vertical-align: inherit;">以下形式的</font>
										</font><a class="link" href="optimization.html#jointype_eq_ref"><code class="literal">eq_ref</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">某些
											</font>
										</font><code class="literal">IN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子查询：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>primary_key</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><em class="replaceable"><code>single_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哪里</font><font style="vertical-align: inherit;">选择</font></font><em class="replaceable"><code>some_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
									<p>
										<a class="link" href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> 只是一个索引查找功能，它可以完全替换子查询以提高效率。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="jointype_index_subquery"></a>
										<a class="indexterm" name="idm140091704667536"></a>

										<a class="indexterm" name="idm140091704666080"></a>

										<a class="link" href="optimization.html#jointype_index_subquery"><code class="literal">index_subquery</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												此连接类型类似于
											</font>
										</font><a class="link" href="optimization.html#jointype_unique_subquery"><code class="literal">unique_subquery</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">它替换</font>
										</font><code class="literal">IN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子查询，但它适用于以下形式的子查询中的非唯一索引：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（</font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><em class="replaceable"><code>single_table</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哪里</font><font style="vertical-align: inherit;">选择</font></font><em class="replaceable"><code>some_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
								</li>
								<li class="listitem">
									<p><a name="jointype_range"></a>
										<a class="indexterm" name="idm140091704657008"></a>

										<a class="indexterm" name="idm140091704655552"></a>

										<a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												仅检索给定范围内的行，使用索引选择行。</font>
											<font style="vertical-align: inherit;">的</font>
										</font><code class="literal">key</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												输出行中的列指示使用哪个索引。</font>
											<font style="vertical-align: inherit;">将</font>
										</font><code class="literal">key_len</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">包含已使用的时间最长的关键部分。</font>
											<font style="vertical-align: inherit;">该</font>
										</font><code class="literal">ref</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列
											</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">适用于此类型。
											</font>
										</font>
									</p>
									<p>
										<a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">当一个键柱使用任何的相比于恒定可使用
											</font>
										</font><a class="link" href="functions.html#operator_equal"><code class="literal">=</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="functions.html#operator_not-equal"><code class="literal">&lt;&gt;</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="functions.html#operator_greater-than"><code class="literal">&gt;</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="functions.html#operator_greater-than-or-equal"><code class="literal">&gt;=</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="functions.html#operator_less-than"><code class="literal">&lt;</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="functions.html#operator_less-than-or-equal"><code class="literal">&lt;=</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="functions.html#operator_is-null"><code class="literal">IS NULL</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="functions.html#operator_equal-to"><code class="literal">&lt;=&gt;</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="functions.html#operator_between"><code class="literal">BETWEEN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="functions.html#operator_like"><code class="literal">LIKE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，或
											</font>
										</font><a class="link" href="functions.html#operator_in"><code class="literal">IN()</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">运营商：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10和20之间;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（10,20,30）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE </font></font><em class="replaceable"><code>key_part1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 10 AND </font></font><em class="replaceable"><code>key_part2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IN（10,20,30）;
</font></font></pre>
								</li>
								<li class="listitem">
									<p><a name="jointype_index"></a>
										<a class="indexterm" name="idm140091704627856"></a>

										<a class="indexterm" name="idm140091704626400"></a>

										<a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">index</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">联接类型是一样的
											</font>
										</font><a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，只是索引树被扫描。</font>
											<font style="vertical-align: inherit;">这有两种方式：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															如果索引是查询的覆盖索引，并且可用于满足表中所需的所有数据，则仅扫描索引树。</font>
														<font style="vertical-align: inherit;">在这种情况下，</font>
													</font><code class="literal">Extra</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">专栏说
														</font>
													</font><code class="literal">Using index</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。</font>
														<font style="vertical-align: inherit;">仅索引扫描通常比</font>
													</font><a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">索引的大小通常小于表数据</font>
														<font style="vertical-align: inherit;">更快
														</font>
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															使用索引中的读取执行全表扫描，以按索引顺序查找数据行。
														</font>
													</font><code class="literal">Uses index</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">没有出现在
														</font>
													</font><code class="literal">Extra</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">列中。
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当查询仅使用属于单个索引的列时，MySQL可以使用此连接类型。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p><a name="jointype_all"></a>
										<a class="indexterm" name="idm140091704612832"></a>

										<a class="indexterm" name="idm140091704611408"></a>

										<a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对前面表格中的每个行组合进行全表扫描。</font>
											<font style="vertical-align: inherit;">如果表是第一个未标记的表
											</font>
										</font><a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，这通常</font>
										</font><span class="emphasis"><em>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">是</font>
												</font>
											</em></span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">不好的</font>
											<font style="vertical-align: inherit;">，并且</font>
											<font style="vertical-align: inherit;">在所有其他情况下</font>
											<font style="vertical-align: inherit;">通常
											</font><span class="emphasis"><em>
													<font style="vertical-align: inherit;">非常</font>
												</em></span>
											<font style="vertical-align: inherit;">糟糕。</font>
											<font style="vertical-align: inherit;">通常，您可以</font>
										</font><a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">通过添加索引</font>
											<font style="vertical-align: inherit;">来避免
											</font>
											<font style="vertical-align: inherit;">，这些索引根据以前表中的常量值或列值从表中启用行检索。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="explain-extra-information"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">解释额外信息</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><code class="literal">Extra</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">输出包含MySQL解决查询的额外信息。</font>
								<font style="vertical-align: inherit;">以下列表说明了此列中可能出现的值。</font>
								<font style="vertical-align: inherit;">每个项目还指示JSON格式的输出哪个属性显示</font>
							</font><code class="literal">Extra</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值。</font>
								<font style="vertical-align: inherit;">对于其中一些，有一个特定的属性。</font>
								<font style="vertical-align: inherit;">其他显示为</font>
							</font><code class="literal">message</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									属性</font>
								<font style="vertical-align: inherit;">的文本</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果你想使你的查询尽可能快，看出来</font>
							</font><code class="literal">Extra</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">的列值</font>
							</font><code class="literal">Using
								filesort</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">Using temporary</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，或在JSON格式的</font>
							</font><code class="literal">EXPLAIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">输出，用于
								</font>
							</font><code class="literal">using_filesort</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">using_temporary_table</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">等于性能
								</font>
							</font><code class="literal">true</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<code class="literal">Child of '<em class="replaceable"><code>table</code></em>'
											pushed join@1</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON：</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												文字）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												此表被引用为</font>
										</font><em class="replaceable"><code>table</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可以下推到NDB内核的联接中</font>
											<font style="vertical-align: inherit;">的子代
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">仅当启用了下推式联接时，才适用于NDB群集。</font>
											<font style="vertical-align: inherit;">有关</font>
										</font><a class="link" href="mysql-cluster.html#sysvar_ndb_join_pushdown"><code class="literal">ndb_join_pushdown</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">更多信息和示例，</font>
											<font style="vertical-align: inherit;">请参阅
											</font>
											<font style="vertical-align: inherit;">服务器系统变量的说明。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">const row not found</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">const_row_not_found</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于诸如此类的查询</font>
											<font style="vertical-align: inherit;">，该表为空。
											</font>
										</font><code class="literal">SELECT ... FROM
											<em class="replaceable"><code>tbl_name</code></em></code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Deleting all rows</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												因为</font>
										</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，某些存储引擎（例如</font>
										</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）支持一种处理程序方法，该方法以简单快捷的方式删除所有表行。</font>
										</font><code class="literal">Extra</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">如果引擎使用此优化，则会显示</font>
											<font style="vertical-align: inherit;">此</font>
											<font style="vertical-align: inherit;">值。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Distinct</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">distinct</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MySQL正在寻找不同的值，因此它在找到第一个匹配行后停止为当前行组合搜索更多行。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">FirstMatch(<em class="replaceable"><code>tbl_name</code></em>)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												（JSON属性：</font>
										</font><code class="literal">first_match</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												半连接FirstMatch连接快捷方式策略用于</font>
										</font><em class="replaceable"><code>tbl_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Full scan on NULL key</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当优化程序无法使用索引查找访问方法时，子查询优化会作为回退策略发生这种情况。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Impossible HAVING</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">HAVING</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句始终为false，不能选择任何行。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Impossible WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句始终为false，不能选择任何行。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Impossible WHERE noticed after reading const
											tables</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MySQL已经读取了所有
											</font>
										</font><a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（和
											</font>
										</font><a class="link" href="optimization.html#jointype_system"><code class="literal">system</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）表，并注意到该</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句始终为false。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">LooseScan(<em class="replaceable"><code>m</code></em>..<em class="replaceable"><code>n</code></em>)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												（JSON属性：</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												使用半连接LooseScan策略。
											</font>
										</font><em class="replaceable"><code>m</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">并且
											</font>
										</font><em class="replaceable"><code>n</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是关键部件号。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">No matching min/max row</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												没有行满足查询的条件，例如
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">SELECT MIN(...) FROM ... WHERE
											<em class="replaceable"><code>condition</code></em></code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">no matching row in const table</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于具有连接的查询，有一个空表或没有满足唯一索引条件的行的表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">No matching rows after partition
											pruning</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于</font>
										</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，优化器在分区修剪后没有发现任何删除或更新的内容。</font>
											<font style="vertical-align: inherit;">这是在意义上类似</font>
										</font><code class="literal">Impossible WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												的</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">声明。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">No tables used</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												查询没有</font>
										</font><code class="literal">FROM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句，或者有
											</font>
										</font><code class="literal">FROM DUAL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于</font>
										</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE语法"><code class="literal">REPLACE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句，
											</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在没有</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												部分</font>
											<font style="vertical-align: inherit;">时显示该值</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">例如，它似乎</font>
										</font><code class="literal">EXPLAIN INSERT
											INTO t VALUES(10)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">因为相当于
											</font>
										</font><code class="literal">EXPLAIN INSERT INTO t SELECT 10 FROM
											DUAL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Not exists</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MySQL能够对</font>
										</font><code class="literal">LEFT JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												查询</font>
											<font style="vertical-align: inherit;">进行</font>
											<font style="vertical-align: inherit;">优化，并且在找到与</font>
										</font><code class="literal">LEFT
											JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">标准</font>
											<font style="vertical-align: inherit;">匹配的行之后，不会检查此表中更多行以用于上一行组合</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">以下是可以通过以下方式优化的查询类型的示例：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 LEFT JOIN t2 ON t1.id = t2.id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE22.id IS NULL;</font></font><font></font>
</pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												假设</font>
										</font><code class="literal">t2.id</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">定义为
											</font>
										</font><code class="literal">NOT NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">在这种情况下，MySQL </font>
											<font style="vertical-align: inherit;">使用的值
											</font>
											<font style="vertical-align: inherit;">扫描
											</font>
										</font><code class="literal">t1</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">并查找行
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">如果MySQL找到匹配的行
											</font>
											<font style="vertical-align: inherit;">，则它知道
											</font>
											<font style="vertical-align: inherit;">永远不会
											</font>
											<font style="vertical-align: inherit;">，并且不会扫描</font>
											<font style="vertical-align: inherit;">具有相同</font>
											<font style="vertical-align: inherit;">值</font>
											<font style="vertical-align: inherit;">的其余行</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">换句话说，对于每一行</font>
											<font style="vertical-align: inherit;">，MySQL只需要进行一次查找</font>
											<font style="vertical-align: inherit;">，而不管实际匹配的行数</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">t2</code>
										<font style="vertical-align: inherit;"></font><code class="literal">t1.id</code>
										<font style="vertical-align: inherit;"></font><code class="literal">t2</code>
										<font style="vertical-align: inherit;"></font><code class="literal">t2.id</code>
										<font style="vertical-align: inherit;"></font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;"></font><code class="literal">t2</code>
										<font style="vertical-align: inherit;"></font><code class="literal">id</code>
										<font style="vertical-align: inherit;"></font><code class="literal">t1</code>
										<font style="vertical-align: inherit;"></font><code class="literal">t2</code>
										<font style="vertical-align: inherit;"></font><code class="literal">t2</code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Plan isn't ready yet</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> （JSON属性：无）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#explain-for-connection"
										 title="8.8.4获取命名连接的执行计划信息"><code class="literal">EXPLAIN FOR
												CONNECTION</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">当优化程序尚未完成为在命名连接中执行的语句创建执行计划时，</font>
											<font style="vertical-align: inherit;">
												会出现此值</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">如果执行计划输出包含多行，则它们中的任何一个或全部都可以具有此
											</font>
										</font><code class="literal">Extra</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">值，具体取决于优化程序在确定完整执行计划时的进度。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Range checked for each record (index map:
											<em class="replaceable"><code>N</code></em>)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MySQL发现没有好的索引可以使用，但发现在前面的表的列值已知之后可能会使用某些索引。</font>
											<font style="vertical-align: inherit;">对于上表中的每个行组合，MySQL检查是否可以使用</font>
										</font><a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><a class="link" href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">访问方法来检索行。</font>
											<font style="vertical-align: inherit;">这不是很快，但比执行没有索引的连接更快。</font>
											<font style="vertical-align: inherit;">适用性标准如
											</font>
										</font><a class="xref" href="optimization.html#range-optimization" title="8.2.1.2范围优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.2节“范围优化”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.3索引合并优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.3节“索引合并优化”中所述</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，除了前面的表的所有列值都是已知的并被认为是常量。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												索引从1开始编号，顺序</font>
										</font><a class="link" href="sql-syntax.html#show-index" title="13.7.6.22 SHOW INDEX语法"><code class="literal">SHOW
												INDEX</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">与表中</font>
											<font style="vertical-align: inherit;">显示的顺序相同</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">索引映射值
											</font>
										</font><em class="replaceable"><code>N</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是一个位掩码值，指示哪些索引是候选。</font>
											<font style="vertical-align: inherit;">例如，值</font>
										</font><code class="literal">0x19</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（二进制11001）表示将考虑索引1,4和5。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Recursive</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">recursive</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这表明该行适用于</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">递归公用表表达式</font>
											<font style="vertical-align: inherit;">的递归
											</font>
											<font style="vertical-align: inherit;">部分。</font>
											<font style="vertical-align: inherit;">请参见</font>
										</font><a class="xref" href="sql-syntax.html#with" title="13.2.13 WITH语法（公用表表达式）">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.2.13节“WITH语法（公用表表达式）”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Rematerialize</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">rematerialize</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p><a class="indexterm" name="idm140091704490416"></a><a class="indexterm" name="idm140091704488928"></a>
									<p>
										<code class="literal">Rematerialize (X,...)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">显示在</font>
										</font><code class="literal">EXPLAIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表</font>
											<font style="vertical-align: inherit;">的</font>
											<font style="vertical-align: inherit;">行中
											</font>
										</font><code class="literal">T</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，其中</font>
										</font><code class="literal">X</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是任何横向派生表，当</font>
										</font><code class="literal">T</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">读取</font>
											<font style="vertical-align: inherit;">新行时触发重新实现</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">例如：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  T，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  LATERAL（</font></font><em class="replaceable"><code>derived table that refers to t</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）AS dt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												重新实现派生表的内容，以便每次</font>
										</font><code class="literal">t</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">顶部查询处理</font>
											<font style="vertical-align: inherit;">新行时使其更新
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Scanned <em class="replaceable"><code>N</code></em>
											databases</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这表示服务器在处理</font>
										</font><code class="literal">INFORMATION_SCHEMA</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表</font>
											<font style="vertical-align: inherit;">查询时执行的目录扫描次数
											</font>
											<font style="vertical-align: inherit;">，如</font>
										</font><a class="xref" href="optimization.html#information-schema-optimization" title="8.2.3优化INFORMATION_SCHEMA查询">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.3节“优化INFORMATION_SCHEMA查询”中所述</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">值</font>
										</font><em class="replaceable"><code>N</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可以是0,1或
											</font>
										</font><code class="literal">all</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Select tables optimized away</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												优化器确定1）应该返回最多一行，以及2）为了产生该行，必须读取确定的行集。</font>
											<font style="vertical-align: inherit;">当在优化阶段（例如，通过读取索引行）读取要读取的行时，在查询执行期间不需要读取任何表。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当查询被隐式分组时（包含聚合函数但没有</font>
										</font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句），</font>
											<font style="vertical-align: inherit;">满足第一个条件
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">当每个使用的索引执行一行查找时，满足第二个条件。</font>
											<font style="vertical-align: inherit;">读取的索引数决定了要读取的行数。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												请考虑以下隐式分组查询：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT MIN（c1），MIN（c2）FROM t1;
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												假设</font>
										</font><code class="literal">MIN(c1)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可以通过读取一个索引行</font>
										</font><code class="literal">MIN(c2)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												来检索，</font>
											<font style="vertical-align: inherit;">并且</font>
											<font style="vertical-align: inherit;">可以通过从不同的索引读取一行来检索。</font>
											<font style="vertical-align: inherit;">即，对于每一列</font>
										</font><code class="literal">c1</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><code class="literal">c2</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，存在其中列是索引的第一列的索引。</font>
											<font style="vertical-align: inherit;">在这种情况下，返回一行，通过读取两个确定行来生成。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;"></font><code class="literal">Extra</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">如果要读取的行不是确定性的，则不会出现</font>
											<font style="vertical-align: inherit;">
												此</font>
											<font style="vertical-align: inherit;">值。</font>
											<font style="vertical-align: inherit;">考虑这个查询：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT MIN（c2）FROM t1 WHERE c1 &lt;= 10;
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												假设这</font>
										</font><code class="literal">(c1, c2)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是一个覆盖索引。</font>
											<font style="vertical-align: inherit;">使用此索引，</font>
										</font><code class="literal">c1 &lt;=
											10</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">必须扫描</font>
											<font style="vertical-align: inherit;">所有行</font>
											<font style="vertical-align: inherit;">以查找最小值
											</font>
										</font><code class="literal">c2</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">相比之下，请考虑以下查询：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT MIN（c2）FROM t1 WHERE c1 = 10;
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在这种情况下，第一个索引行</font>
										</font><code class="literal">c1 =
											10</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">包含最小值</font>
										</font><code class="literal">c2</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												。</font>
											<font style="vertical-align: inherit;">必须只读取一行才能生成返回的行。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于保持每个表的精确行数（例如</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">但不是
											</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）的</font>
											<font style="vertical-align: inherit;">存储引擎，对于</font>
											<font style="vertical-align: inherit;">缺少</font>
											<font style="vertical-align: inherit;">该</font>
											<font style="vertical-align: inherit;">子句或始终为true且没有</font>
											<font style="vertical-align: inherit;">
												子句的</font>
											<font style="vertical-align: inherit;">查询，</font>
										</font><code class="literal">Extra</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												可能会出现</font>
											<font style="vertical-align: inherit;">此</font>
											<font style="vertical-align: inherit;">值</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">（这是隐式分组查询的实例，其中存储引擎会影响是否可以读取确定数量的行。）
											</font>
										</font><code class="literal">COUNT(*)</code>
										<font style="vertical-align: inherit;"></font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;"></font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Skip_open_table</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">Open_frm_only</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">Open_full_table</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这些值表示适用于</font>
										</font><code class="literal">INFORMATION_SCHEMA</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表</font>
											<font style="vertical-align: inherit;">查询的文件打开优化</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<code class="literal">Skip_open_table</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：表文件不需要打开。</font>
														<font style="vertical-align: inherit;">该信息已从数据字典中获得。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<code class="literal">Open_frm_only</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：只需要读取表信息的数据字典。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<code class="literal">Open_full_table</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：未优化的信息查找。</font>
														<font style="vertical-align: inherit;">必须从数据字典中读取表信息并读取表文件。
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Start temporary</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">End
											temporary</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这表示临时表用于半连接Duplicate Weedout策略。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">unique row not found</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于诸如的查询</font>
											<font style="vertical-align: inherit;">，没有行满足</font>
											<font style="vertical-align: inherit;">
												索引或</font>
											<font style="vertical-align: inherit;">表的条件。
											</font>
										</font><code class="literal">SELECT ... FROM
											<em class="replaceable"><code>tbl_name</code></em></code>
										<font style="vertical-align: inherit;"></font><code class="literal">UNIQUE</code>
										<font style="vertical-align: inherit;"></font><code class="literal">PRIMARY KEY</code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using filesort</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">using_filesort</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MySQL必须执行额外的传递以找出如何按排序顺序检索行。</font>
											<font style="vertical-align: inherit;">排序是通过根据连接类型遍历所有行并将排序键和指针存储到与该</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句</font>
											<font style="vertical-align: inherit;">匹配的所有行的行来完成的</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">然后对键进行排序，并按排序顺序检索行。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="optimization.html#order-by-optimization" title="8.2.1.15按优化顺序">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.15节“ORDER BY Optimization”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using index</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">using_index</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												仅使用索引树中的信息从表中检索列信息，而不必执行额外的搜索以读取实际行。</font>
											<font style="vertical-align: inherit;">当查询仅使用属于单个索引的列时，可以使用此策略。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">具有用户定义的聚簇索引的表，即使</font>
											<font style="vertical-align: inherit;">列中</font>
										</font><code class="literal">Using index</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">不存在
											</font>
											<font style="vertical-align: inherit;">该索引，也可以使用该索引</font>
										</font><code class="literal">Extra</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">这样的话，如果
											</font>
										</font><code class="literal">type</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是
											</font>
										</font><a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><code class="literal">key</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是</font>
										</font><code class="literal">PRIMARY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using index condition</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">using_index_condition</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												通过访问索引元组并首先测试它们以确定是否读取完整的表行来读取表。</font>
											<font style="vertical-align: inherit;">以这种方式，索引信息用于推迟（</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">“ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">下推</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;"> ”</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）读取全表行，除非有必要。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="optimization.html#index-condition-pushdown-optimization" title="8.2.1.5指数条件下推优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.5节“索引条件下推优化”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using index for group-by</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：</font>
										</font><code class="literal">using_index_for_group_by</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												与</font>
										</font><code class="literal">Using index</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表访问方法</font>
											<font style="vertical-align: inherit;">类似</font>
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">Using index for group-by</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表示MySQL找到了一个索引，可用于检索</font>
										</font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><code class="literal">DISTINCT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">查询的</font>
											<font style="vertical-align: inherit;">所有列，</font>
											<font style="vertical-align: inherit;">而无需对实际表进行任何额外的磁盘访问。</font>
											<font style="vertical-align: inherit;">此外，索引以最有效的方式使用，因此对于每个组，只读取少数索引条目。</font>
											<font style="vertical-align: inherit;">有关详细信息，请参见
											</font>
										</font><a class="xref" href="optimization.html#group-by-optimization" title="8.2.1.16 GROUP BY优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.16节“GROUP BY优化”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using index for skip scan</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：</font>
										</font><code class="literal">using_index_for_skip_scan</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表示使用了Skip Scan访问方法。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="optimization.html#range-access-skip-scan" title="跳过扫描范围访问方法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">跳过扫描范围访问方法</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using join buffer (Block Nested Loop)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">Using join buffer (Batched Key Access)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												（JSON属性：</font>
										</font><code class="literal">using_join_buffer</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												将早期联接中的表分成几部分读入连接缓冲区，然后从缓冲区中使用它们的行来执行与当前表的连接。
											</font>
										</font><code class="literal">(Block Nested Loop)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表示使用块嵌套循环算法并</font>
										</font><code class="literal">(Batched Key
											Access)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">指示使用批量密钥访问算法。</font>
											<font style="vertical-align: inherit;">也就是说，来自</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">输出</font>
											<font style="vertical-align: inherit;">前一行的表中的键
											</font>
											<font style="vertical-align: inherit;">将被缓冲，匹配的行将从</font>
										</font><code class="literal">Using join buffer</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">出现</font>
											<font style="vertical-align: inherit;">的行所代表的表中批量获取
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在JSON格式的输出，值
											</font>
										</font><code class="literal">using_join_buffer</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">始终是中的任一个</font>
										</font><code class="literal">Block Nested Loop</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><code class="literal">Batched Key Access</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using MRR</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												使用多范围读取优化策略读取表。</font>
											<font style="vertical-align: inherit;">请参见</font>
										</font><a class="xref" href="optimization.html#mrr-optimization" title="8.2.1.10多范围读取优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.10节“多范围读取优化”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using sort_union(...)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">Using
											union(...)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">Using
											intersect(...)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这些指示特定算法显示如何为</font>
										</font><a class="link" href="optimization.html#jointype_index_merge"><code class="literal">index_merge</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">连接类型</font>
											<font style="vertical-align: inherit;">合并索引扫描
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">请参见</font>
										</font><a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.3索引合并优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.3节“索引合并优化”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using temporary</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">using_temporary_table</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												要解析查询，MySQL需要创建一个临时表来保存结果。</font>
											<font style="vertical-align: inherit;">如果查询包含以</font>
											<font style="vertical-align: inherit;">不同方式列出列的</font>
										</font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><code class="literal">ORDER BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句，</font>
											<font style="vertical-align: inherit;">则通常会发生这种情况</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using where</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">attached_condition</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												甲</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句用于限制匹配哪些行针对下一个表或发送到客户端。</font>
											<font style="vertical-align: inherit;">除非您特意打算从表中获取或检查所有行，否则如果</font>
										</font><code class="literal">Extra</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">值不是
											</font>
										</font><code class="literal">Using where</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">并且表连接类型为</font>
										</font><a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或者
											</font>
											<font style="vertical-align: inherit;">，则
											</font>
											<font style="vertical-align: inherit;">查询中可能出现错误</font>
										</font><a class="link" href="optimization.html#jointype_index"><code class="literal">index</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<code class="literal">Using where</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在JSON格式的输出中没有直接的对应物; </font>
											<font style="vertical-align: inherit;">该
											</font>
										</font><code class="literal">attached_condition</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">属性包含任何</font>
										</font><code class="literal">WHERE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">使用的条件。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Using where with pushed condition</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												此产品适用于</font>
										</font><a class="link" href="mysql-cluster.html" title="第22章MySQL NDB Cluster 8.0"><code class="literal">NDB</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表</font>
										</font><span class="emphasis"><em>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">只</font>
												</font>
											</em></span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">这意味着NDB Cluster正在使用条件下推优化来提高非索引列和常量之间直接比较的效率。</font>
											<font style="vertical-align: inherit;">在这种情况下，条件被</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">“ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">下推</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;"> ”</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">到集群的数据节点，并在所有数据节点上同时进行评估。</font>
											<font style="vertical-align: inherit;">这消除了通过网络发送不匹配行的需要，并且可以在可以但不使用条件下推的情况下将这种查询加速5到10倍。</font>
											<font style="vertical-align: inherit;">有关更多信息，请参阅
											</font>
										</font><a class="xref" href="optimization.html#condition-pushdown-optimization" title="8.2.1.4发动机状态下推优化">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.4节“发动机状态下推优化”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">Zero limit</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（JSON属性：
											</font>
										</font><code class="literal">message</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												查询有一个</font>
										</font><code class="literal">LIMIT 0</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子句，不能选择任何行。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="explain-output-interpretation"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">EXPLAIN输出解释</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									通过获取</font>
								<font style="vertical-align: inherit;">输出</font>
							</font><code class="literal">rows</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									列中</font>
								<font style="vertical-align: inherit;">值的乘积，可以很好地指示连接的好坏程度</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">这应该大致告诉你MySQL必须检查多少行才能执行查询。</font>
								<font style="vertical-align: inherit;">如果使用</font>
							</font><a class="link" href="server-administration.html#sysvar_max_join_size"><code class="literal">max_join_size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统变量</font>
								<font style="vertical-align: inherit;">限制查询，则
								</font>
								<font style="vertical-align: inherit;">此行产品还用于确定</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要执行的</font>
								<font style="vertical-align: inherit;">多表</font>
								<font style="vertical-align: inherit;">语句和要中止的</font>
								<font style="vertical-align: inherit;">多个表</font>
								<font style="vertical-align: inherit;">语句。</font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="server-administration.html#server-configuration" title="5.1.1配置服务器">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第5.1.1节“配置服务器”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下示例显示如何根据提供的信息逐步优化多表连接
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									假设您有</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">此处显示</font>
								<font style="vertical-align: inherit;">的
								</font>
								<font style="vertical-align: inherit;">语句，并且您计划使用</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">以下方法</font>
								<font style="vertical-align: inherit;">检查它
								</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN SELECT tt.TicketNumber，tt.TimeIn，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               tt.ProjectReference，tt.EstimatedShipDate，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               tt.ActualShipDate，tt.ClientID，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               tt.ServiceCodes，tt.RepetitiveID，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               tt.CurrentProcess，tt.CurrentDPPerson，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               tt.RecordVolume，tt.DPPrinted，et.COUNTRY，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               et_1.COUNTRY，do.CUSTNAME</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        FROM tt，et，et AS et_1，do</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        WHt tt.SubmitTime为NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          AND tt.ActualPC = et.EMPLOYID</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          AND tt.AssignedPC = et_1.EMPLOYID</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          AND tt.ClientID = do.CUSTNMBR;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于此示例，请进行以下假设：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												被比较的列已声明如下。
											</font>
										</font>
									</p>
									<div class="informaltable">
										<table summary="Table names, column names, and data types for the columns being compared in the EXPLAIN example described in the preceding text.">
											<colgroup>
												<col width="10%">
												<col width="25%">
												<col width="25%">
											</colgroup>
											<thead>
												<tr>
													<th scope="col">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">表</font>
														</font>
													</th>
													<th scope="col">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">柱</font>
														</font>
													</th>
													<th scope="col">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">数据类型</font>
														</font>
													</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td scope="row"><code class="literal">tt</code></td>
													<td><code class="literal">ActualPC</code></td>
													<td><code class="literal">CHAR(10)</code></td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">tt</code></td>
													<td><code class="literal">AssignedPC</code></td>
													<td><code class="literal">CHAR(10)</code></td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">tt</code></td>
													<td><code class="literal">ClientID</code></td>
													<td><code class="literal">CHAR(10)</code></td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">et</code></td>
													<td><code class="literal">EMPLOYID</code></td>
													<td><code class="literal">CHAR(15)</code></td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">do</code></td>
													<td><code class="literal">CUSTNMBR</code></td>
													<td><code class="literal">CHAR(15)</code></td>
												</tr>
											</tbody>
										</table>
									</div>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表格具有以下索引。
											</font>
										</font>
									</p>
									<div class="informaltable">
										<table summary="Indexes for each of the tables that are part of the EXPLAIN example described in the preceding text.">
											<colgroup>
												<col width="10%">
												<col width="40%">
											</colgroup>
											<thead>
												<tr>
													<th scope="col">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">表</font>
														</font>
													</th>
													<th scope="col">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">指数</font>
														</font>
													</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td scope="row"><code class="literal">tt</code></td>
													<td><code class="literal">ActualPC</code></td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">tt</code></td>
													<td><code class="literal">AssignedPC</code></td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">tt</code></td>
													<td><code class="literal">ClientID</code></td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">et</code></td>
													<td><code class="literal">EMPLOYID</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;"> （首要的关键）</font>
														</font>
													</td>
												</tr>
												<tr>
													<td scope="row"><code class="literal">do</code></td>
													<td><code class="literal">CUSTNMBR</code>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;"> （首要的关键）</font>
														</font>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><code class="literal">tt.ActualPC</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">值不是均匀分布的。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									最初，在执行任何优化之前，该
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句将生成以下信息：
								</font>
							</font>
						</p>
						<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表类型possible_keys键key_len ref rows Extra</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et ALL PRIMARY NULL NULL NULL 74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
do ALL PRIMARY NULL NULL NULL 2135</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et_1 ALL PRIMARY NULL NULL NULL 74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tt ALL AssignedPC，NULL NULL NULL 3872</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           客户端ID，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           ActualPC的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      检查每条记录的范围（索引图：0x23）</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									因为</font>
							</font><code class="literal">type</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是
								</font>
							</font><a class="link" href="optimization.html#jointype_all"><code class="literal">ALL</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">针对每个表，所以此输出表明MySQL正在生成所有表的笛卡尔积; </font>
								<font style="vertical-align: inherit;">也就是说，每一行的组合。</font>
								<font style="vertical-align: inherit;">这需要相当长的时间，因为必须检查每个表中行数的乘积。</font>
								<font style="vertical-align: inherit;">对于手头的情况，该产品为74×2135×74×3872 = 45,268,558,720行。</font>
								<font style="vertical-align: inherit;">如果表格更大，你只能想象需要多长时间。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这里的一个问题是MySQL可以更有效地使用列上的索引，如果它们被声明为相同的类型和大小。</font>
								<font style="vertical-align: inherit;">在这种情况下，</font>
							</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">VARCHAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">与
								</font>
							</font><a class="link" href="data-types.html#char" title="11.4.1 CHAR和VARCHAR类型"><code class="literal">CHAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">被认为是相同的，如果它们被声明为相同的大小。
								</font>
							</font><code class="literal">tt.ActualPC</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">被声明为
								</font>
							</font><code class="literal">CHAR(10)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">et.EMPLOYID</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									是</font>
							</font><code class="literal">CHAR(15)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，所以有一个长度不匹配。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要修复列长度之间的这种差异，请使用
								</font>
								<font style="vertical-align: inherit;">从10个字符</font>
							</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
									TABLE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">延长
								</font>
							</font><code class="literal">ActualPC</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">到15个字符：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE tt MODIFY ActualPC VARCHAR(15);</code></strong>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									现在</font>
							</font><code class="literal">tt.ActualPC</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">et.EMPLOYID</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">都是
								</font>
							</font><code class="literal">VARCHAR(15)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">再次</font>
								<font style="vertical-align: inherit;">执行该
								</font>
								<font style="vertical-align: inherit;">语句会产生以下结果：
								</font>
							</font>
						</p>
						<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表类型possible_keys键key_len ref rows Extra</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tt ALL AssignedPC，NULL NULL NULL 3872使用</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ClientID，在哪里</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ActualPC的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
do ALL PRIMARY NULL NULL NULL 2135</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      检查每条记录的范围（索引图：0x1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et_1 ALL PRIMARY NULL NULL NULL 74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      检查每条记录的范围（索引图：0x1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et eq_ref PRIMARY PRIMARY 15 tt.ActualPC 1</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这并不完美，但要好得多：</font>
							</font><code class="literal">rows</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值</font>
								<font style="vertical-align: inherit;">的乘积
								</font>
								<font style="vertical-align: inherit;">减少了74倍。这个版本在几秒钟内执行。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									可以进行第二次更改以消除</font>
							</font><code class="literal">tt.AssignedPC =
								et_1.EMPLOYID</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">tt.ClientID =
								do.CUSTNMBR</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">比较</font>
								<font style="vertical-align: inherit;">的列长度不匹配</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER TABLE tt MODIFY AssignedPC VARCHAR(15),</code></strong>
                      <strong class="userinput"><code>MODIFY ClientID   VARCHAR(15);</code></strong>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在修改之后，
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">生成此处显示的输出：
								</font>
							</font>
						</p>
						<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表类型possible_keys键key_len ref rows Extra</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et ALL PRIMARY NULL NULL NULL 74</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tt ref AssignedPC，ActualPC 15 et.EMPLOYID 52使用</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ClientID，在哪里</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ActualPC的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et_1 eq_ref PRIMARY PRIMARY 15 tt.AssignedPC 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
do eq_ref PRIMARY PRIMARY 15 tt.ClientID 1</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									此时，查询几乎尽可能地优化。</font>
								<font style="vertical-align: inherit;">剩下的问题是，默认情况下，MySQL假定</font>
							</font><code class="literal">tt.ActualPC</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									列中的</font>
								<font style="vertical-align: inherit;">值</font>
								<font style="vertical-align: inherit;">均匀分布，而</font>
							</font><code class="literal">tt</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表</font>
								<font style="vertical-align: inherit;">不是这种情况</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">幸运的是，很容易告诉MySQL分析密钥分发：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ANALYZE TABLE tt;</code></strong>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用附加索引信息，连接是完美的并
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">产生以下结果：
								</font>
							</font>
						</p>
						<pre data-lang="none" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表类型possible_keys键key_len ref rows Extra</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tt ALL AssignedPC NULL NULL NULL 3872使用</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ClientID，在哪里</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             ActualPC的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et eq_ref PRIMARY PRIMARY 15 tt.ActualPC 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et_1 eq_ref PRIMARY PRIMARY 15 tt.AssignedPC 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
do eq_ref PRIMARY PRIMARY 15 tt.ClientID 1</font></font><font></font>
</pre>
						<p>
							<a class="indexterm" name="idm140091704255408"></a>
							<font style="vertical-align: inherit;"></font><code class="literal">rows</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">输出中</font>
								<font style="vertical-align: inherit;">

									的</font>
								<font style="vertical-align: inherit;">列
								</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是来自MySQL连接优化器的有根据的猜测。</font>
								<font style="vertical-align: inherit;">通过将</font>
							</font><code class="literal">rows</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">产品与查询返回的实际行数</font>
								<font style="vertical-align: inherit;">进行比较，检查数字是否与事实
								</font>
								<font style="vertical-align: inherit;">相符。</font>
								<font style="vertical-align: inherit;">如果数字完全不同，则可以通过</font>
							</font><code class="literal">STRAIGHT_JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在
								</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句中使用并尝试在</font>
							</font><code class="literal">FROM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">子句</font>
								<font style="vertical-align: inherit;">中以不同顺序列出表来
								</font>
								<font style="vertical-align: inherit;">获得更好的性能
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">（但是，
								</font>
							</font><code class="literal">STRAIGHT_JOIN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可能会阻止使用索引，因为它会禁用半连接转换。请参阅
								</font>
							</font><a class="xref" href="optimization.html#semi-joins" title="8.2.2.1使用半连接转换优化子查询，派生表，视图引用和公用表表达式">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表，视图引用和公用表表达式”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。）
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在某些情况下，可以执行在</font>
							</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN
									SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">与子查询一起使用</font>
								<font style="vertical-align: inherit;">时修改数据的语句</font>
								<font style="vertical-align: inherit;">; </font>
								<font style="vertical-align: inherit;">有关更多信息，请参见</font>
							</font><a class="xref" href="sql-syntax.html#derived-tables" title="13.2.11.8派生表">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第13.2.11.8节“派生表”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="explain-extended"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.8.3扩展EXPLAIN输出格式</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句产生额外（</font>
						</font><span class="quote">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">“ </font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">扩展</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> ”</font>
							</font>
						</span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）信息，该信息不是</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">输出的</font>
							<font style="vertical-align: inherit;">一部分，
							</font>
							<font style="vertical-align: inherit;">但可以通过发出</font>
						</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
								WARNINGS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下语句</font>
							<font style="vertical-align: inherit;">来查看</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">在MySQL 8.0.12的，扩展的信息可用于
							</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE语法"><code class="literal">REPLACE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，和
							</font>
						</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句。</font>
							<font style="vertical-align: inherit;">在8.0.12之前，扩展信息仅适用于
							</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">输出中</font>
							<font style="vertical-align: inherit;">
								的</font>
						</font><code class="literal">Message</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值
							</font>
						</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
								WARNINGS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">显示优化程序如何限定</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句
							</font>
							<font style="vertical-align: inherit;">中的表名和列名，
							</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">应用重写和优化规则后的外观，以及可能有关优化过程的其他说明。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								可通过</font>
						</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
								WARNINGS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">以下语句
							</font>
							<font style="vertical-align: inherit;">显示的扩展信息
							</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">仅针对
							</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句生成。
							</font>
						</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
								WARNINGS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">显示其他可解释语句（一个空的结果</font>
						</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE语法"><code class="literal">REPLACE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，和
							</font>
						</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下是扩展</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">输出</font>
							<font style="vertical-align: inherit;">的示例
							</font>
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN</code></strong>
       <strong class="userinput"><code>SELECT t1.a, t1.a IN (SELECT t2.a FROM t2) FROM t1\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：PRIMARY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：索引</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          关键：主要</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用索引</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2.排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           id：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  select_type：SUBQUERY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        表：t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         类型：索引</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
possible_keys：a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          关键：a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      key_len：5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          ref：NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         行：3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     过滤：100.00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        额外：使用索引</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2行，1个警告（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW WARNINGS\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  等级：注意</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   代码：1003</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消息：/ * select＃1 * / select`test` .t1``a` AS`a`，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         &lt;in_optimizer&gt;（`test` .t1` .a`，`test` .t1` .a` in</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         （&lt;materialize&gt;（/ * select＃2 * / select`test` .t2` .a`</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         来自`test``t2`其中1有1），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         &lt;primary_index_lookup&gt;（`test` .t1` .a` in</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         &lt;auto_key&gt;上的&lt;临时表&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         where（（`test` .t1``a` =`materialized-subquery``a`）））））AS`t1.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         IN（SELECT t2.a FROM t2）`from`test``t1`</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1排（0.00秒）</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								由于显示的语句</font>
						</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
								WARNINGS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">可能包含特殊标记以提供有关查询重写或优化程序操作的信息，因此该语句不一定是有效的SQL，也不打算执行。</font>
							<font style="vertical-align: inherit;">输出还可以包含具有</font>
						</font><code class="literal">Message</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值的</font>
							<font style="vertical-align: inherit;">行，这些
							</font>
							<font style="vertical-align: inherit;">值提供有关优化程序采取的操作的其他非SQL解释性说明。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下列表描述了可显示在扩展输出中的特殊标记</font>
						</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
								WARNINGS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<code class="literal">&lt;auto_key&gt;</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											自动生成的临时表密钥。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">&lt;cache&gt;(<em class="replaceable"><code>expr</code></em>)</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											表达式（例如标量子查询）执行一次，结果值保存在内存中供以后使用。</font>
										<font style="vertical-align: inherit;">对于由多个值组成的结果，可能会创建一个临时表，您将看到</font>
									</font><code class="literal">&lt;temporary
										table&gt;</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">&lt;exists&gt;(<em class="replaceable"><code>query
												fragment</code></em>)</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											子查询谓词被转换为
										</font>
									</font><code class="literal">EXISTS</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">谓词，子查询被转换，以便它可以与</font>
									</font><code class="literal">EXISTS</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">谓词</font>
										<font style="vertical-align: inherit;">一起使用
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">&lt;in_optimizer&gt;(<em class="replaceable"><code>query
												fragment</code></em>)</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											这是一个没有用户意义的内部优化器对象。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">&lt;index_lookup&gt;(<em class="replaceable"><code>query
												fragment</code></em>)</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用索引查找处理查询片段以查找符合条件的行。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">&lt;if&gt;(<em class="replaceable"><code>condition</code></em>,
										<em class="replaceable"><code>expr1</code></em>,
										<em class="replaceable"><code>expr2</code></em>)</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果条件为真，则评估为
										</font>
									</font><em class="replaceable"><code>expr1</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，否则
										</font>
									</font><em class="replaceable"><code>expr2</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">&lt;is_not_null_test&gt;(<em class="replaceable"><code>expr</code></em>)</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											用于验证表达式未评估的测试
										</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">&lt;materialize&gt;(<em class="replaceable"><code>query
												fragment</code></em>)</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用子查询实现。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">`materialized-subquery`.<em class="replaceable"><code>col_name</code></em></code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对</font>
									</font><em class="replaceable"><code>col_name</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">内部临时表中</font>
										<font style="vertical-align: inherit;">的列的引用，该
										</font>
										<font style="vertical-align: inherit;">表用于保存评估子查询的结果。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">&lt;primary_index_lookup&gt;(<em class="replaceable"><code>query
												fragment</code></em>)</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用主键查找处理查询片段以查找符合条件的行。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">&lt;ref_null_helper&gt;(<em class="replaceable"><code>expr</code></em>)</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											这是一个没有用户意义的内部优化器对象。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">/* select#<em class="replaceable"><code>N</code></em> */
										<em class="replaceable"><code>select_stmt</code></em></code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											它</font>
									</font><code class="literal">SELECT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">与非扩展</font>
									</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">输出中</font>
										<font style="vertical-align: inherit;">的行相关联，其</font>
									</font><code class="literal">id</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值为
										</font>
									</font><em class="replaceable"><code>N</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal"><em class="replaceable"><code>outer_tables</code></em> semi join
										(<em class="replaceable"><code>inner_tables</code></em>)</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											半连接操作。
										</font>
									</font><em class="replaceable"><code>inner_tables</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">显示未拉出的表格。</font>
										<font style="vertical-align: inherit;">请参见</font>
									</font><a class="xref" href="optimization.html#semi-joins" title="8.2.2.1使用半连接转换优化子查询，派生表，视图引用和公用表表达式">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表，视图引用和公用表表达式”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">&lt;temporary table&gt;</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											这表示为缓存中间结果而创建的内部临时表。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								当某些表是</font>
						</font><a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								或者</font>
							<font style="vertical-align: inherit;">是某些表时，</font>
						</font><a class="link" href="optimization.html#jointype_system"><code class="literal">system</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">优化程序会尽早评估涉及这些表中列的表达式，而这些表达式不是显示语句的一部分。</font>
							<font style="vertical-align: inherit;">但是，</font>
						</font><code class="literal">FORMAT=JSON</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">有些
							</font>
						</font><a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表访问显示为</font>
						</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">使用const值</font>
							<font style="vertical-align: inherit;">的</font>
							<font style="vertical-align: inherit;">访问。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="explain-for-connection"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.8.4获取命名连接的执行计划信息</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要获取在命名连接中执行的可解释语句的执行计划，请使用以下语句：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解释[ </font></font><em class="replaceable"><code>options</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]连接</font></font><em class="replaceable"><code>connection_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
					<p>
						<a class="link" href="optimization.html#explain-for-connection" title="8.8.4获取命名连接的执行计划信息"><code class="literal">EXPLAIN
								FOR CONNECTION</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">返回</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">当前用于在给定连接中执行查询</font>
							<font style="vertical-align: inherit;">的</font>
							<font style="vertical-align: inherit;">信息。</font>
							<font style="vertical-align: inherit;">由于数据（和支持统计信息）的更改，它可能会产生与运行</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">等效查询文本</font>
							<font style="vertical-align: inherit;">不同的结果
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">这种行为差异可用于诊断更多瞬态性能问题。</font>
							<font style="vertical-align: inherit;">例如，如果您在一个会话中运行语句需要很长时间才能完成，则</font>
						</font><a class="link" href="optimization.html#explain-for-connection" title="8.8.4获取命名连接的执行计划信息"><code class="literal">EXPLAIN
								FOR
								CONNECTION</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在另一个会话中使用可能会产生有关延迟原因的有用信息。
							</font>
						</font>
					</p>
					<p>
						<em class="replaceable"><code>connection_id</code></em>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">是从</font>
						</font><code class="literal">INFORMATION_SCHEMA</code>
						<a class="link" href="information-schema.html#processlist-table" title="25.19 INFORMATION_SCHEMA PROCESSLIST表"><code
							 class="literal">PROCESSLIST</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表或
							</font>
						</font><a class="link" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
								PROCESSLIST</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句中</font>
							<font style="vertical-align: inherit;">获取的连接标识符
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">如果您具有该</font>
						</font><a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">权限，则可以指定任何连接的标识符。</font>
							<font style="vertical-align: inherit;">否则，您只能为自己的连接指定标识符。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果指定的连接未执行语句，则结果为空。</font>
							<font style="vertical-align: inherit;">否则，</font>
						</font><code class="literal">EXPLAIN FOR CONNECTION</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								仅在可以解释在命名连接中执行的语句时才适用。</font>
							<font style="vertical-align: inherit;">这包括
							</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE语法"><code class="literal">REPLACE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，和
							</font>
						</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">（但是，
							</font>
						</font><code class="literal">EXPLAIN FOR CONNECTION</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">对于准备好的语句，甚至是那些类型的预备语句都不起作用。）
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果命名连接正在执行可解释语句，那么输出就是您</font>
						</font><code class="literal">EXPLAIN</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在语句本身上</font>
							<font style="vertical-align: inherit;">使用的输出
							</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果命名连接正在执行不可解释的语句，则会发生错误。</font>
							<font style="vertical-align: inherit;">例如，您无法为当前会话命名连接标识符，因为
							</font>
						</font><code class="literal">EXPLAIN</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">无法解释：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT CONNECTION_ID();</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">CONNECTION_ID（）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">373 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1排（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>EXPLAIN FOR CONNECTION 373;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ERROR 1889（HY000）：支持EXPLAIN FOR CONNECTION命令</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仅适用于SELECT / UPDATE / INSERT / DELETE / REPLACE</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><code class="literal">Com_explain_other</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">状态变量表示的数
							</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN FOR
								CONNECTION</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">执行的语句。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="estimating-performance"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.8.5估计查询性能</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091704121408"></a><a class="indexterm" name="idm140091704119952"></a><a class="indexterm"
					 name="idm140091704118464"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								在大多数情况下，您可以通过计算磁盘搜索来估计查询性能。</font>
							<font style="vertical-align: inherit;">对于小型表，通常可以在一个磁盘查找中找到一行（因为索引可能已缓存）。</font>
							<font style="vertical-align: inherit;">对于更大的表，你可以估计，使用B树索引，你需要这么多寻找一行：
							</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font><code class="literal">log(<em class="replaceable"><code>row_count</code></em>) /
							log(<em class="replaceable"><code>index_block_length</code></em> / 3 * 2 /
							(<em class="replaceable"><code>index_length</code></em> +
							<em class="replaceable"><code>data_pointer_length</code></em>)) + 1</code>
						<font style="vertical-align: inherit;"></font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								在MySQL中，索引块通常为1,024字节，数据指针通常为4字节。</font>
							<font style="vertical-align: inherit;">对于密钥值长度为3个字节（大小</font>
						</font><a class="link" href="data-types.html#integer-types" title="11.2.1整数类型（精确值） -  INTEGER，INT，SMALLINT，TINYINT，MEDIUMINT，BIGINT"><code
							 class="literal">MEDIUMINT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）</font>
							<font style="vertical-align: inherit;">的500,000行表
							</font>
							<font style="vertical-align: inherit;">，公式表示
							</font>
						</font><code class="literal">log(500,000)/log(1024/3*2/(3+4)) + 1</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">=
							</font>
						</font><code class="literal">4</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">seek。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该索引需要存储大约500,000 * 7 * 3/2 = 5.2MB（假设典型的索引缓冲区填充率为2/3），因此您可能在内存中有很多索引，因此只需要一次或两次调用读取数据以查找行。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								但是，对于写入，您需要四个搜索请求来查找放置新索引值的位置，通常两个寻求更新索引并写入行。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								前面的讨论并不意味着您的应用程序性能会慢慢退化
							</font>
						</font><em class="replaceable"><code>N</code></em>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">只要操作系统或MySQL服务器缓存了所有内容，随着表变大，事情就会变得稍微慢一点。</font>
							<font style="vertical-align: inherit;">在数据太大而无法缓存之后，事情开始变得慢得多，直到您的应用程序仅受磁盘搜索限制（按日志增加
							</font>
						</font><em class="replaceable"><code>N</code></em>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）。</font>
							<font style="vertical-align: inherit;">为避免这种情况，请在数据增长时增加密钥缓存大小。</font>
							<font style="vertical-align: inherit;">对于</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								表，密钥缓存大小由</font>
						</font><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量</font>
							<font style="vertical-align: inherit;">控制
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">请参见</font>
						</font><a class="xref" href="server-administration.html#server-configuration" title="5.1.1配置服务器">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第5.1.1节“配置服务器”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="controlling-optimizer"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.9控制查询优化器</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#controlling-query-plan-evaluation">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.1控制查询计划评估</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#switchable-optimizations">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.2可切换的优化</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizer-hints">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.3优化器提示</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#index-hints">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.4索引提示</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#cost-model">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.5优化器成本模型</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizer-statistics">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.6优化器统计</font>
									</font>
								</a></span></dt></dl>
				</div>
				<a class="indexterm" name="idm140091704103376"></a>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							MySQL通过影响查询计划评估方式的系统变量，可切换优化，优化器和索引提示以及优化器成本模型来提供优化器控制。
						</font>
					</font>
				</p>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							尽管优化器尚未使用此信息，但服务器还会维护有关列值的统计信息。
						</font>
					</font>
				</p>
				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="controlling-query-plan-evaluation"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.1控制查询计划评估</font>
									</font>
								</h3>
							</div>
						</div>
					</div>
					<a class="indexterm" name="idm140091704099648"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								查询优化器的任务是找到执行SQL查询的最佳计划。</font>
							<font style="vertical-align: inherit;">因为</font>
						</font><span class="quote">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">“ </font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">好</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> ”</font>
							</font>
						</span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和</font><span class="quote">
								<font style="vertical-align: inherit;">“ </font>
							</span><span class="quote"><span class="quote">
									<font style="vertical-align: inherit;">坏</font>
								</span></span><span class="quote">
								<font style="vertical-align: inherit;"> ”</font>
							</span>
							<font style="vertical-align: inherit;">之间的表现差异</font>
						</font><span class="quote">
							<font style="vertical-align: inherit;"></font><span class="quote">
								<font style="vertical-align: inherit;"></font>
							</span>
							<font style="vertical-align: inherit;"></font>
						</span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">计划可以是数量级（即秒与小时甚至数天），大多数查询优化器（包括MySQL的查询优化器）在所有可能的查询评估计划中执行或多或少的详尽搜索以获得最佳计划。</font>
							<font style="vertical-align: inherit;">对于连接查询，MySQL优化器调查的可能计划数量随着查询中引用的表的数量呈指数增长。</font>
							<font style="vertical-align: inherit;">对于少量表（通常小于7到10），这不是问题。</font>
							<font style="vertical-align: inherit;">但是，当提交较大的查询时，在查询优化中花费的时间可能很容易成为服务器性能的主要瓶颈。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								更灵活的查询优化方法使用户能够控制优化器在搜索最佳查询评估计划时的详尽程度。</font>
							<font style="vertical-align: inherit;">一般的想法是，优化器调查的计划越少，编译查询所花费的时间就越少。</font>
							<font style="vertical-align: inherit;">另一方面，由于优化器会跳过某些计划，因此可能无法找到最佳计划。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								可以使用两个系统变量来控制优化程序相对于其计算的计划数量的行为：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该</font>
									</font><a class="link" href="server-administration.html#sysvar_optimizer_prune_level"><code class="literal">optimizer_prune_level</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											变量告诉优化器根据对每个表访问的行数的估计跳过某些计划。</font>
										<font style="vertical-align: inherit;">我们的经验表明，这种</font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">“有</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">根据的猜测</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> ”</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">很少会错过最佳计划，并且可能会大大缩短查询编译时间。</font>
										<font style="vertical-align: inherit;">这就是</font>
									</font><code class="literal">optimizer_prune_level=1</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">默认情况下</font>
										<font style="vertical-align: inherit;">此选项为on（</font>
										<font style="vertical-align: inherit;">）的原因。</font>
										<font style="vertical-align: inherit;">但是，如果您认为优化程序错过了更好的查询计划，则可以关闭此选项（</font>
									</font><code class="literal">optimizer_prune_level=0</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）查询编译可能需要更长时间的风险。</font>
										<font style="vertical-align: inherit;">请注意，即使使用此启发式算法，优化程序仍会探索大致指数的计划。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该</font>
									</font><a class="link" href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											变量告诉</font>
										<font style="vertical-align: inherit;">优化器应该查看每个不完整计划</font>
										<font style="vertical-align: inherit;">的</font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">“ </font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">未来</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> ”</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">的距离，以评估是否应该进一步扩展。</font>
										<font style="vertical-align: inherit;">较小的值
										</font>
									</font><a class="link" href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">可能导致查询编译时间的数量级减少。</font>
										<font style="vertical-align: inherit;">例如，如果</font>
									</font><a class="link" href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">接近查询中的表数，</font>
										<font style="vertical-align: inherit;">则使用12,13或更多表的查询可能很容易需要数小时甚至数天才能编译
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">同时，如果编译
										</font>
									</font><a class="link" href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											等于3或4，优化器可以在不到一分钟的时间内为同一查询编译。</font>
										<font style="vertical-align: inherit;">如果您不确定合理值是什么
										</font>
									</font><a class="link" href="server-administration.html#sysvar_optimizer_search_depth"><code class="literal">optimizer_search_depth</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，可以将此变量设置为0以告知优化器自动确定该值。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="switchable-optimizations"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.2可切换的优化</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091704079984"></a><a class="indexterm" name="idm140091704078896"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量能够在优化行为的控制。</font>
							<font style="vertical-align: inherit;">它的值是一组标志，每个标志的值为</font>
						</font><code class="literal">on</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								或</font>
						</font><code class="literal">off</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表示是否启用或禁用了相应的优化器行为。</font>
							<font style="vertical-align: inherit;">此变量具有全局值和会话值，可以在运行时更改。</font>
							<font style="vertical-align: inherit;">可以在服务器启动时设置全局默认值。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要查看当前的优化程序标志集，请选择变量值：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
@@ optimizer_switch：index_merge = on，index_merge_union = on，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_sort_union =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_intersection =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    engine_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    MRR =开，上mrr_cost_based =，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    block_nested_loop =开，batched_key_access =关，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    物化=开，半连接=上，loosescan =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    firstmatch =开，duplicateweedout =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    subquery_materialization_cost_based =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    use_index_extensions =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    condition_fanout_filter =开，derived_merge =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    use_invisible_indexes =关，skip_scan =上</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要更改值
							</font>
						</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，请指定一个由逗号分隔的一个或多个命令列表组成的值：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET [GLOBAL | SESSION] optimizer_switch =' </font></font><em class="replaceable"><code>command</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>command</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ......';
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								每个</font>
						</font><em class="replaceable"><code>command</code></em>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值都应具有下表中显示的其中一种形式。
							</font>
						</font>
					</p>
					<div class="informaltable">
						<table summary="The syntax of the command value for SET optimizer_switch commands.">
							<colgroup>
								<col width="25%">
								<col width="75%">
							</colgroup>
							<thead>
								<tr>
									<th scope="col">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">命令语法</font>
										</font>
									</th>
									<th scope="col">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">含义</font>
										</font>
									</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td scope="row"><code class="literal">default</code></td>
									<td>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">将每个优化重置为其默认值</font>
										</font>
									</td>
								</tr>
								<tr>
									<td scope="row"><code class="literal"><em class="replaceable"><code>opt_name</code></em>=default</code></td>
									<td>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">将命名优化设置为其默认值</font>
										</font>
									</td>
								</tr>
								<tr>
									<td scope="row"><code class="literal"><em class="replaceable"><code>opt_name</code></em>=off</code></td>
									<td>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">禁用命名优化</font>
										</font>
									</td>
								</tr>
								<tr>
									<td scope="row"><code class="literal"><em class="replaceable"><code>opt_name</code></em>=on</code></td>
									<td>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">启用命名优化</font>
										</font>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								值中的命令顺序无关紧要，尽管</font>
						</font><code class="literal">default</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">如果存在则首先执行命令。</font>
							<font style="vertical-align: inherit;">一个设置</font>
						</font><em class="replaceable"><code>opt_name</code></em>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">标志
							</font>
						</font><code class="literal">default</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">设置它取的
							</font>
						</font><code class="literal">on</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">或者</font>
						</font><code class="literal">off</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">是它的默认值。</font>
						</font><em class="replaceable"><code>opt_name</code></em>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								不允许在值中</font>
							<font style="vertical-align: inherit;">指定任何给定的</font>
							<font style="vertical-align: inherit;">多次，并导致错误。</font>
							<font style="vertical-align: inherit;">值中的任何错误都会导致赋值失败并显示错误，并保持值
							</font>
						</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">不变。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下列表描述了</font>
						</font><em class="replaceable"><code>opt_name</code></em>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">按优化策略分组</font>
							<font style="vertical-align: inherit;">的允许
							</font>
							<font style="vertical-align: inherit;">标志名称：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											批量密钥访问标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">batched_key_access</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">off</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制BKA连接算法的使用。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											为了</font>
									</font><code class="literal">batched_key_access</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在设置时有任何效果</font>
									</font><code class="literal">on</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><code class="literal">mrr</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">标志也必须是
										</font>
									</font><code class="literal">on</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">目前，MRR的成本估算过于悲观。</font>
										<font style="vertical-align: inherit;">因此，也有必要对
										</font>
									</font><code class="literal">mrr_cost_based</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">要
										</font>
									</font><code class="literal">off</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">用于要使用的BKA。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#bnl-bka-optimization" title="8.2.1.11块嵌套循环和批量密钥访问连接">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.1.11节“阻止嵌套循环和批量密钥访问连接”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											阻止嵌套循环标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">block_nested_loop</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制BNL连接算法的使用。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#bnl-bka-optimization" title="8.2.1.11块嵌套循环和批量密钥访问连接">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.1.11节“阻止嵌套循环和批量密钥访问连接”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											条件过滤标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">condition_fanout_filter</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制条件过滤的使用。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#condition-filtering" title="8.2.1.12条件过滤">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.1.12节“条件过滤”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											派生表合并标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">derived_merge</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制将派生表和视图合并到外部查询块中。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该</font>
									</font><code class="literal">derived_merge</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">标志控制优化器是否尝试将派生表，视图引用和公用表表达式合并到外部查询块中，假设没有其他规则阻止合并; </font>
										<font style="vertical-align: inherit;">例如，</font>
									</font><code class="literal">ALGORITHM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">视图</font>
										<font style="vertical-align: inherit;">的</font>
										<font style="vertical-align: inherit;">指令优先于
										</font>
									</font><code class="literal">derived_merge</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">设置。</font>
										<font style="vertical-align: inherit;">默认情况下，该标志</font>
									</font><code class="literal">on</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">用于启用合并。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#derived-table-optimization" title="8.2.2.4使用合并或实现优化派生表，视图引用和公用表表达式">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.2.4节“使用合并或实现优化派生表，视图引用和公用表表达式”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											发动机状态下推标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">engine_condition_pushdown</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制发动机状态下推。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#condition-pushdown-optimization" title="8.2.1.4发动机状态下推优化">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.1.4节“发动机状态下推优化”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											指数条件下推标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">index_condition_pushdown</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制索引条件下推。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#index-condition-pushdown-optimization" title="8.2.1.5指数条件下推优化">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.1.5节“索引条件下推优化”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											索引扩展标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">use_index_extensions</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制索引扩展的使用。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#index-extensions" title="8.3.10索引扩展的使用">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.3.10节“索引扩展的使用”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											索引合并标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">index_merge</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制所有索引合并优化。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">index_merge_intersection</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制索引合并交叉点访问优化。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">index_merge_sort_union</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制索引合并排序 - 联合访问优化。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">index_merge_union</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制索引合并联盟访问优化。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.3索引合并优化">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.1.3节“索引合并优化”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											索引可见性标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">use_invisible_indexes</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">off</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制不可见索引的使用。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#invisible-indexes" title="8.3.12隐形指数">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.3.12节“不可见索引”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											多范围读取标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">mrr</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制多范围读取策略。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">mrr_cost_based</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														如果控制使用基于成本的MRR
													</font>
												</font><code class="literal">mrr=on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#mrr-optimization" title="8.2.1.10多范围读取优化">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.1.10节“多范围读取优化”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											跳过扫描标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">skip_scan</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制使用Skip Scan访问方法。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参阅
										</font>
									</font><a class="xref" href="optimization.html#range-access-skip-scan" title="跳过扫描范围访问方法">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">跳过扫描范围访问方法</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											半连接标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">semijoin</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制所有半连接策略。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">duplicateweedout</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制半连接重复Weedout策略。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">firstmatch</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制半连接FirstMatch策略。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">loosescan</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制半连接LooseScan策略（不要与松散索引扫描混淆</font>
												</font><code class="literal">GROUP
													BY</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在</font>
									</font><code class="literal">semijoin</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><code class="literal">firstmatch</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，</font>
									</font><code class="literal">loosescan</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，和</font>
									</font><code class="literal">duplicateweedout</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">超过半连接策略的标志使能控制。</font>
										<font style="vertical-align: inherit;">该</font>
									</font><code class="literal">semijoin</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											标志控制是否使用半连接。</font>
										<font style="vertical-align: inherit;">如果设置为
										</font>
									</font><code class="literal">on</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，则</font>
									</font><code class="literal">firstmatch</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><code class="literal">loosescan</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">标志可以更好地控制允许的半连接策略。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果</font>
									</font><code class="literal">duplicateweedout</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">禁用半连接策略，则除非还禁用所有其他适用策略，否则不会使用该策略。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果</font>
									</font><code class="literal">semijoin</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><code class="literal">materialization</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">是两个
										</font>
									</font><code class="literal">on</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，半连接也适用使用物化。</font>
										<font style="vertical-align: inherit;">这些标志是</font>
									</font><code class="literal">on</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">默认的。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见</font>
									</font><a class="xref" href="optimization.html#semi-joins" title="8.2.2.1使用半连接转换优化子查询，派生表，视图引用和公用表表达式">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.2.1节“使用半连接转换优化子查询，派生表，视图引用和公用表表达式”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											子查询物化标志
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">materialization</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">（默认
													</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														控制物化（包括半连接物化）。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">subquery_materialization_cost_based</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														（默认</font>
												</font><code class="literal">on</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">）
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														使用基于成本的物化选择。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该</font>
									</font><code class="literal">materialization</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">标志控制是否使用子查询实现。</font>
										<font style="vertical-align: inherit;">如果
										</font>
									</font><code class="literal">semijoin</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><code class="literal">materialization</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">是两个
										</font>
									</font><code class="literal">on</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，半连接也适用使用物化。</font>
										<font style="vertical-align: inherit;">这些标志是</font>
									</font><code class="literal">on</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">默认的。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该</font>
									</font><code class="literal">subquery_materialization_cost_based</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											标志使得能够在子查询物化和之间的选择控制
										</font>
									</font><code class="literal">IN</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">-到- </font>
									</font><code class="literal">EXISTS</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">子查询变换。</font>
										<font style="vertical-align: inherit;">如果该标志为</font>
									</font><code class="literal">on</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">（默认值），优化器进行子查询物化和之间的基于成本的选择
										</font>
									</font><code class="literal">IN</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">-到- </font>
									</font><code class="literal">EXISTS</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">子查询变换如果可以使用任一方法。</font>
										<font style="vertical-align: inherit;">如果标志是</font>
									</font><code class="literal">off</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，优化器选择了子查询物化
										</font>
									</font><code class="literal">IN</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">至- </font>
									</font><code class="literal">EXISTS</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">子查询的转变。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关更多信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#subquery-optimization" title="8.2.2优化子查询，派生表，查看引用和公用表表达式">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.2.2节“优化子查询，派生表，视图引用和公用表表达式”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								为其分配值时
							</font>
						</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，未提及的标志会保留其当前值。</font>
							<font style="vertical-align: inherit;">这使得可以在单个语句中启用或禁用特定的优化器行为，而不会影响其他行为。</font>
							<font style="vertical-align: inherit;">该语句不依赖于存在的其他优化器标志以及它们的值。</font>
							<font style="vertical-align: inherit;">假设已启用所有索引合并优化：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
@@ optimizer_switch：index_merge = on，index_merge_union = on，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_sort_union =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_intersection =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    engine_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    MRR =开，上mrr_cost_based =，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    block_nested_loop =开，batched_key_access =关，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    物化=开，半连接=上，loosescan =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    firstmatch =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    subquery_materialization_cost_based =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    use_index_extensions =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    condition_fanout_filter =上</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果服务器对某些查询使用索引合并联合或索引合并排序联合访问方法，并且您想要检查优化程序在没有它们的情况下是否会表现更好，请设置变量值，如下所示：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET optimizer_switch='index_merge_union=off,index_merge_sort_union=off';</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@optimizer_switch\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
@@ optimizer_switch：index_merge = on，index_merge_union = off，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_sort_union =关，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_merge_intersection =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    engine_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    index_condition_pushdown =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    MRR =开，上mrr_cost_based =，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    block_nested_loop =开，batched_key_access =关，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    物化=开，半连接=上，loosescan =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    firstmatch =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    subquery_materialization_cost_based =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    use_index_extensions =开，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    condition_fanout_filter =上</font></font><font></font>
</pre>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizer-hints"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.3优化器提示</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091703913424"></a><a class="indexterm" name="idm140091703912352"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								控制优化器策略的一种方法是设置
							</font>
						</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量（参见</font>
						</font><a class="xref" href="optimization.html#switchable-optimizations" title="8.9.2可切换的优化">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.9.2节“可切换的优化”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）。</font>
							<font style="vertical-align: inherit;">对此变量的更改会影响所有后续查询的执行; </font>
							<font style="vertical-align: inherit;">为了使一个查询与另一个查询不同，需要</font>
						</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在每个</font>
							<font style="vertical-align: inherit;">查询</font>
							<font style="vertical-align: inherit;">之前</font>
							<font style="vertical-align: inherit;">进行更改
							</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								控制优化器的另一种方法是使用优化器提示，可以在各个语句中指定。</font>
							<font style="vertical-align: inherit;">由于优化程序提示适用于每个语句，因此它们可以更好地控制语句执行计划，而不是使用
							</font>
						</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">例如，您可以为语句中的一个表启用优化，并禁用其他表的优化。</font>
							<font style="vertical-align: inherit;">语句中的提示优先于
							</font>
						</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">标志。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								例子：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + NO_RANGE_OPTIMIZATION（t3 PRIMARY，f2_idx）* / f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  从t3，其中f1&gt; 30且f1 &lt;33;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + BKA（t1）NO_BKA（t2）* / * FROM t1 INNER JOIN t2 WHERE ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + NO_ICP（t1，t2）* / * FROM t1 INNER JOIN t2 WHERE ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + SEMIJOIN（FIRSTMATCH，LOOSESCAN）* / * FROM t1 ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EXPLAIN SELECT / * + NO_ICP（t1）* / * FROM t1 WHERE ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + MERGE（dt）* / * FROM（SELECT * FROM t1）AS dt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT / * + SET_VAR（foreign_key_checks = OFF）* / INTO t2 VALUES（2）;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								此处描述的优化程序提示与索引提示不同，如</font>
						</font><a class="xref" href="optimization.html#index-hints" title="8.9.4索引提示">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.9.4节“索引提示”中所述</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">优化程序和索引提示可以单独使用或一起使用。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p><a class="xref" href="optimization.html#optimizer-hints-overview" title="优化程序提示概述">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">优化程序提示概述</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#optimizer-hints-syntax" title="优化程序提示语法">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">优化程序提示语法</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">加入订单优化器提示</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表级优化器提示</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引级优化器提示</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子查询优化器提示</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#optimizer-hints-execution-time" title="语句执行时间优化器提示">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句执行时间优化器提示</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">变量设置提示语法</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#optimizer-hints-resource-group" title="资源组提示语法">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组提示语法</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">用于命名查询块的优化器提示</font>
										</font>
									</a></p>
							</li>
						</ul>
					</div>

					<div class="simplesect">

						<div class="titlepage">
							<div>

								<div class="simple">
									<h4 class="title"><a name="optimizer-hints-overview"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">优化程序提示概述</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化程序提示适用于不同的范围级别：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												全局：提示会影响整个语句
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												查询块：提示会影响语句中的特定查询块
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表级：提示会影响查询块中的特定表
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												索引级别：提示会影响表中的特定索引
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									下表总结了可用的优化程序提示，它们影响的优化程序策略以及它们应用的范围或范围。</font>
								<font style="vertical-align: inherit;">稍后将给出更多细节。
								</font>
							</font>
						</p>
						<div class="table">
							<a name="optimizer-hints-table"></a>
							<p class="title"><b>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表8.2可用的优化程序提示</font>
									</font>
								</b></p>
							<div class="table-contents">
								<table summary="Optimizer hint names, descriptions, and contexts in which they apply.">
									<colgroup>
										<col width="30%">
										<col width="40%">
										<col width="30%">
									</colgroup>
									<thead>
										<tr>
											<th scope="col">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">提示名称</font>
												</font>
											</th>
											<th scope="col">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">描述</font>
												</font>
											</th>
											<th scope="col">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">适用范围</font>
												</font>
											</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code
													 class="literal">BKA</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">，
													</font>
												</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">NO_BKA</code></a>
											</td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">影响批量密钥访问联接处理</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">查询块，表</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code
													 class="literal">BNL</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">，
													</font>
												</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">NO_BNL</code></a>
											</td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">影响块嵌套循环连接处理</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">查询块，表</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code
													 class="literal">INDEX_MERGE</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">，
													</font>
												</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_INDEX_MERGE</code></a>
											</td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">影响索引合并优化</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">表，索引</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code
													 class="literal">JOIN_FIXED_ORDER</code></a></td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">使用</font>
												</font><code class="literal">FROM</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">子句中</font>
													<font style="vertical-align: inherit;">指定的表顺序</font>
													<font style="vertical-align: inherit;">进行连接顺序</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">查询块</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code
													 class="literal">JOIN_ORDER</code></a></td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">使用提示中指定的表顺序进行连接顺序</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">查询块</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code
													 class="literal">JOIN_PREFIX</code></a></td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">使用提示中指定的表顺序作为连接顺序的第一个表</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">查询块</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code
													 class="literal">JOIN_SUFFIX</code></a></td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">使用提示中指定的表顺序来获取连接顺序的最后一个表</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">查询块</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-execution-time" title="语句执行时间优化器提示"><code
													 class="literal">MAX_EXECUTION_TIME</code></a></td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">限制语句执行时间</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">全球</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code
													 class="literal">MERGE</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">，
													</font>
												</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">NO_MERGE</code></a>
											</td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">影响派生表/视图合并到外部查询块中</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">表</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code
													 class="literal">MRR</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">，
													</font>
												</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_MRR</code></a>
											</td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">影响多范围读取优化</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">表，索引</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code
													 class="literal">NO_ICP</code></a></td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">影响指数条件下推优化</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">表，索引</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code
													 class="literal">NO_RANGE_OPTIMIZATION</code></a></td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">影响范围优化</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">表，索引</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-query-block-naming"
												 title="用于命名查询块的优化器提示"><code class="literal">QB_NAME</code></a></td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">为查询块分配名称</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">查询块</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-resource-group" title="资源组提示语法"><code
													 class="literal">RESOURCE_GROUP</code></a></td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">在语句执行期间设置资源组</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">全球</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code
													 class="literal">SEMIJOIN</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">，
													</font>
												</font><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">NO_SEMIJOIN</code></a>
											</td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">影响半连接策略</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">查询块</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code
													 class="literal">SKIP_SCAN</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">，
													</font>
												</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_SKIP_SCAN</code></a>
											</td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">影响Skip Scan优化</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">表，索引</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code
													 class="literal">SET_VAR</code></a></td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">在语句执行期间设置变量</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">全球</font>
												</font>
											</td>
										</tr>
										<tr>
											<td align="left" scope="row"><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code
													 class="literal">SUBQUERY</code></a></td>
											<td align="left">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">影响物化，
													</font>
												</font><code class="literal">IN</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">到</font>
												</font><code class="literal">EXISTS</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														子查询的策略</font>
												</font>
											</td>
											<td>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">查询块</font>
												</font>
											</td>
										</tr>
									</tbody>
								</table>
							</div>

						</div>
						<br class="table-break">
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									禁用优化会阻止优化程序使用它。</font>
								<font style="vertical-align: inherit;">启用优化意味着优化器可以自由地使用策略（如果它适用于语句执行，而不是优化器必然会使用它）。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="optimizer-hints-syntax"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">优化程序提示语法</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL支持SQL语句中的注释，如
								</font>
							</font><a class="xref" href="language-structure.html#comments" title="9.6注释语法">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第9.6节“注释语法”中所述</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">必须在</font>
							</font><code class="literal">/*+ ... */</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">注释中</font>
								<font style="vertical-align: inherit;">指定优化程序提示</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">也就是说，优化器提示使用</font>
							</font><code class="literal">/* ... */</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									C样式注释语法</font>
								<font style="vertical-align: inherit;">的变体，</font>
							</font><code class="literal">+</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在</font>
							</font><code class="literal">/*</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">注释开始序列</font>
								<font style="vertical-align: inherit;">后面</font>
								<font style="vertical-align: inherit;">有一个</font>
								<font style="vertical-align: inherit;">字符</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">例子：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * + BKA（t1）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ * + BNL（t1，t2）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ * + NO_RANGE_OPTIMIZATION（t4 PRIMARY）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ * + QB_NAME（qb2）* /</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">+</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									字符</font>
								<font style="vertical-align: inherit;">
									后允许空格</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									分析器的初始关键字后承认优化提示意见</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><a class="link" href="sql-syntax.html#replace" title="13.2.9 REPLACE语法"><code class="literal">REPLACE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，和
								</font>
							</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句。</font>
								<font style="vertical-align: inherit;">在这些情况下允许提示：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在查询和数据更改语句的开头：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + ... * / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT / * + ... * / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
REPLACE / * + ... * / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE / * + ... * / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DELETE / * + ... * / ...</font></font><font></font>
</pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在查询块的开头：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（SELECT / * + ... * / ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（SELECT ...）UNION（SELECT / * + ... * / ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（SELECT / * + ... * / ...）UNION（SELECT / * + ... * / ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPDATE ... WHERE x IN（SELECT / * + ... * / ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT ... SELECT / * + ... * / ...</font></font><font></font>
</pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在前面提到的可疑陈述中
											</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">例如：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN SELECT / * + ... * / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EXPLAIN UPDATE ... WHERE x IN（SELECT / * + ... * / ...）</font></font><font></font>
</pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这意味着您可以使用
											</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">查看优化程序提示如何影响执行计划。</font>
										</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
												WARNINGS</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">之后立即</font>
											<font style="vertical-align: inherit;">使用
											</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">以查看提示的使用方式。</font>
										</font><code class="literal">EXPLAIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												以下</font>
										</font><a class="link" href="sql-syntax.html#show-warnings" title="13.7.6.40 SHOW WARNINGS语法"><code class="literal">SHOW
												WARNINGS</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">显示</font>
											<font style="vertical-align: inherit;">的扩展</font>
											<font style="vertical-align: inherit;">输出</font>
											<font style="vertical-align: inherit;">表示使用了哪些提示。</font>
											<font style="vertical-align: inherit;">忽略的提示不会显示。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									提示注释可能包含多个提示，但查询块不能包含多个提示注释。</font>
								<font style="vertical-align: inherit;">这是有效的：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + BNL（t1）BKA（t2）* / ...
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									但这是无效的：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + BNL（t1）* / / * BKA（t2）* / ...
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当提示注释包含多个提示时，存在重复和冲突的可能性。</font>
								<font style="vertical-align: inherit;">以下一般准则适用。</font>
								<font style="vertical-align: inherit;">对于特定提示类型，可能会应用其他规则，如提示说明中所示。
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												重复提示：对于提示，例如</font>
										</font><code class="literal">/*+ MRR(idx1)
											MRR(idx1) */</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，MySQL使用第一个提示并发出有关重复提示的警告。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												冲突提示：对于提示，例如</font>
										</font><code class="literal">/*+
											MRR(idx1) NO_MRR(idx1) */</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，MySQL使用第一个提示并发出有关第二个冲突提示的警告。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									查询块名称是标识符，并遵循有关哪些名称有效以及如何引用它们的常规规则（请参见
								</font>
							</font><a class="xref" href="language-structure.html#identifiers" title="9.2模式对象名称">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第9.2节“模式对象名称”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									提示名称，查询块名称和策略名称不区分大小写。</font>
								<font style="vertical-align: inherit;">对表和索引名称的引用遵循通常的标识符区分大小写规则（请参见
								</font>
							</font><a class="xref" href="language-structure.html#identifier-case-sensitivity" title="9.2.2标识符区分大小写">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第9.2.2节“标识符区分大小写”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="optimizer-hints-join-order"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">加入订单优化器提示</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									连接顺序提示会影响优化程序连接表的顺序。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#optimizer-hints-join-order"
							 title="加入订单优化器提示"><code class="literal">JOIN_FIXED_ORDER</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示</font>
								<font style="vertical-align: inherit;">
									语法
								</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（[@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									其他连接顺序提示的语法：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（[@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ......）
 </font></font><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] [，</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]] ......）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									语法指的是这些术语：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<em class="replaceable"><code>hint_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：允许使用以下提示名称：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_FIXED_ORDER</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：强制优化器使用它们在</font>
													</font><code class="literal">FROM</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															子句中</font>
														<font style="vertical-align: inherit;">出现的顺序来连接表</font>
														<font style="vertical-align: inherit;">。</font>
														<font style="vertical-align: inherit;">这与指定相同</font>
													</font><code class="literal">SELECT
														STRAIGHT_JOIN</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_ORDER</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：指示优化器使用指定的表顺序连接表。</font>
														<font style="vertical-align: inherit;">提示适用于命名表。</font>
														<font style="vertical-align: inherit;">优化程序可能会在连接顺序中的任何位置放置未命名的表，包括指定表之间的表。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_PREFIX</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：指示优化器使用指定的表顺序连接表，以用于连接执行计划的第一个表。</font>
														<font style="vertical-align: inherit;">提示适用于命名表。</font>
														<font style="vertical-align: inherit;">优化器将所有其他表放在命名表之后。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_SUFFIX</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：指示优化器使用指定的表顺序连接表，以用于连接执行计划的最后一个表。</font>
														<font style="vertical-align: inherit;">提示适用于命名表。</font>
														<font style="vertical-align: inherit;">优化器将所有其他表放在命名表之前。
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
								</li>
								<li class="listitem">
									<p>
										<em class="replaceable"><code>tbl_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：语句中使用的表的名称。</font>
											<font style="vertical-align: inherit;">名称表的提示适用于它命名的所有表。</font>
											<font style="vertical-align: inherit;">该
											</font>
										</font><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_FIXED_ORDER</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">提示名称没有表，并适用于所有的表
											</font>
										</font><code class="literal">FROM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在其发生的查询块的条款。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果表具有别名，则提示必须引用别名，而不是表名。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												提示中的表名不能使用模式名限定。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<em class="replaceable"><code>query_block_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：提示适用的查询块。</font>
											<font style="vertical-align: inherit;">如果提示不包含前导
											</font>
											<font style="vertical-align: inherit;">，则提示将应用于发生它的查询块。</font>
											<font style="vertical-align: inherit;">对于
											</font>
											<font style="vertical-align: inherit;">
												语法，提示适用于命名查询块中的命名表。</font>
											<font style="vertical-align: inherit;">要为查询块指定名称，请参阅
											</font><a class="xref" href="optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示">
												<font style="vertical-align: inherit;">命名查询块的优化程序提示</font>
											</a>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">@<em class="replaceable"><code>query_block_name</code></em></code>
										<font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>tbl_name</code></em>@<em
											 class="replaceable"><code>query_block_name</code></em></code>
										<font style="vertical-align: inherit;"></font><a class="xref" href="optimization.html#optimizer-hints-query-block-naming"
										 title="用于命名查询块的优化器提示">
											<font style="vertical-align: inherit;"></font>
										</a>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									例：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ * + JOIN_PREFIX（t2，t5 @ subq2，t4 @ subq1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    JOIN_ORDER（t4 @ subq1，t3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    JOIN_SUFFIX（t1）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
COUNT（*）FROM t1 JOIN t2 JOIN t3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           在哪里t1.f1 IN（SELECT / * + QB_NAME（subq1）* / f1 FROM t4）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             AND t2.f1 IN（SELECT / * + QB_NAME（subq2）* / f1 FROM t5）;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									提示控制合并到外部查询块的半连接表的行为。</font>
								<font style="vertical-align: inherit;">如果子查询
								</font>
							</font><code class="literal">subq1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">subq2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">转换为半连接，则表</font>
							</font><code class="literal">t4@subq1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									并</font>
							</font><code class="literal">t5@subq2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">合并到外部查询块。</font>
								<font style="vertical-align: inherit;">在这种情况下，外部查询块中指定的提示控制行为</font>
							</font><code class="literal">t4@subq1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">t5@subq2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化器根据以下原则解析连接顺序提示：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												多个提示实例
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">每种类型只应用</font>
											<font style="vertical-align: inherit;">
												一种</font>
										</font><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_PREFIX</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_SUFFIX</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">提示。</font>
											<font style="vertical-align: inherit;">任何后来的相同类型的提示都会被警告忽略。
											</font>
										</font><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_ORDER</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可以多次指定。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												例子：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * + JOIN_PREFIX（t1）JOIN_PREFIX（t2）* /
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#optimizer-hints-join-order"
										 title="加入订单优化器提示"><code class="literal">JOIN_PREFIX</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												警告会忽略</font>
											<font style="vertical-align: inherit;">
												第二个</font>
											<font style="vertical-align: inherit;">提示。
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * + JOIN_PREFIX（t1）JOIN_SUFFIX（t2）* /
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这两个提示都适用。</font>
											<font style="vertical-align: inherit;">没有警告发生。
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * + JOIN_ORDER（t1，t2）JOIN_ORDER（t2，t3）* /
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这两个提示都适用。</font>
											<font style="vertical-align: inherit;">没有警告发生。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												矛盾的提示
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在某些情况下，提示可能会发生冲突，例如何时
											</font>
										</font><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_ORDER</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_PREFIX</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表订单无法同时应用：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + JOIN_ORDER（t1，t2）JOIN_PREFIX（t2，t1）* / ... FROM t1，t2;
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在这种情况下，将应用第一个指定的提示，并忽略后续冲突提示而不显示警告。</font>
											<font style="vertical-align: inherit;">无法应用的有效提示会在没有警告的情况下默默忽略。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												忽略了提示
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果提示中指定的表具有循环依赖关系，则忽略提示。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												例：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * + JOIN_ORDER（t1，t2）JOIN_PREFIX（t2，t1）* /
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_ORDER</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">提示套表</font>
										</font><code class="literal">t2</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">依赖
											</font>
										</font><code class="literal">t1</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">该
											</font>
										</font><a class="link" href="optimization.html#optimizer-hints-join-order" title="加入订单优化器提示"><code class="literal">JOIN_PREFIX</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">提示将被忽略，因为表</font>
										</font><code class="literal">t1</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">不能依赖</font>
										</font><code class="literal">t2</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">忽略的提示不会显示在扩展
											</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">输出中。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												与</font>
										</font><a class="link" href="optimization.html#jointype_const"><code class="literal">const</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表的
											</font>
											<font style="vertical-align: inherit;">交互</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MySQL优化器</font>
										</font><code class="literal">const</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">首先</font>
											<font style="vertical-align: inherit;">将</font>
											<font style="vertical-align: inherit;">表放在连接顺序中，并且</font>
										</font><code class="literal">const</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表</font>
											<font style="vertical-align: inherit;">的位置
											</font>
											<font style="vertical-align: inherit;">不受提示的影响。</font>
										</font><code class="literal">const</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">虽然提示仍然适用，但忽略对连接顺序提示中的表的</font>
											<font style="vertical-align: inherit;">引用</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">例如，这些是等价的：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JOIN_ORDER（T1， </font></font><em class="replaceable"><code>const_tbl</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，t2）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JOIN_ORDER（t1，t2）</font></font><font></font>
</pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												扩展</font>
										</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">输出中</font>
											<font style="vertical-align: inherit;">显示的接受提示
											</font>
											<font style="vertical-align: inherit;">包括
											</font>
										</font><code class="literal">const</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">指定的表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												与连接操作类型的交互
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MySQL支持多种类型的连接：
											</font>
										</font><code class="literal">LEFT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">RIGHT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">INNER</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">CROSS</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">STRAIGHT_JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">将忽略与指定类型的连接冲突的提示，不会发出警告。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												例：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + JOIN_PREFIX（t1，t2）* / FROM t2 LEFT JOIN t1;
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这里在提示中请求的连接顺序和所需的顺序之间发生冲突</font>
										</font><code class="literal">LEFT
											JOIN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">忽略提示，没有任何警告。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="optimizer-hints-table-level"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表级优化器提示</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表级提示会影响：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												使用块嵌套循环（BNL）和批量密钥访问（BKA）连接处理算法（请参见
											</font>
										</font><a class="xref" href="optimization.html#bnl-bka-optimization" title="8.2.1.11块嵌套循环和批量密钥访问连接">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.2.1.11节“块嵌套循环和批量密钥访问连接”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												派生表，视图引用或公用表表达式是否应合并到外部查询块中，或使用内部临时表实现。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这些提示类型适用于特定表或查询块中的所有表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表级提示的语法：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（[@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] [ </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...]）
 </font></font><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（[ </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...]）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									语法指的是这些术语：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<em class="replaceable"><code>hint_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：允许使用以下提示名称：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">BKA</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，
														</font>
													</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">NO_BKA</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：为指定的表启用或禁用BKA。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">BNL</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，
														</font>
													</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">NO_BNL</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：为指定的表启用或禁用BNL。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">MERGE</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，
														</font>
													</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">NO_MERGE</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：为指定的表，视图引用或公用表表达式启用合并; </font>
														<font style="vertical-align: inherit;">或者禁用合并并使用实现。
														</font>
													</font>
												</p><a class="indexterm" name="idm140091703633136"></a><a class="indexterm" name="idm140091703631648"></a><a
												 class="indexterm" name="idm140091703630160"></a>
											</li>
										</ul>
									</div>
									<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
										<div class="admon-title">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													注意
												</font>
											</font>
										</div>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													要使用BNL或BKA提示为外部联接的任何内部表启用联接缓冲，必须为外部联接的所有内部表启用联接缓冲。
												</font>
											</font>
										</p>
									</div>
								</li>
								<li class="listitem">
									<p>
										<em class="replaceable"><code>tbl_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：语句中使用的表的名称。</font>
											<font style="vertical-align: inherit;">提示适用于它命名的所有表。</font>
											<font style="vertical-align: inherit;">如果提示没有命名表，则它适用于发生它的查询块的所有表。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果表具有别名，则提示必须引用别名，而不是表名。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												提示中的表名不能使用模式名限定。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<em class="replaceable"><code>query_block_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：提示适用的查询块。</font>
											<font style="vertical-align: inherit;">如果提示不包含前导
											</font>
											<font style="vertical-align: inherit;">，则提示将应用于发生它的查询块。</font>
											<font style="vertical-align: inherit;">对于
											</font>
											<font style="vertical-align: inherit;">
												语法，提示适用于命名查询块中的命名表。</font>
											<font style="vertical-align: inherit;">要为查询块指定名称，请参阅
											</font><a class="xref" href="optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示">
												<font style="vertical-align: inherit;">命名查询块的优化程序提示</font>
											</a>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">@<em class="replaceable"><code>query_block_name</code></em></code>
										<font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>tbl_name</code></em>@<em
											 class="replaceable"><code>query_block_name</code></em></code>
										<font style="vertical-align: inherit;"></font><a class="xref" href="optimization.html#optimizer-hints-query-block-naming"
										 title="用于命名查询块的优化器提示">
											<font style="vertical-align: inherit;"></font>
										</a>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									例子：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + NO_BKA（t1，t2）* / t1。* FROM t1 INNER JOIN t2 INNER JOIN t3;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + NO_BNL（）BKA（t1）* / t1。* FROM t1 INNER JOIN t2 INNER JOIN t3;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + NO_MERGE（dt）* / * FROM（SELECT * FROM t1）AS dt;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表级提示适用于从先前表而不是发件人表接收记录的表。</font>
								<font style="vertical-align: inherit;">请考虑以下声明：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + BNL（t2）* / FROM t1，t2;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果优化器选择首先处理</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									，则</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">通过</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在开始读取之前
								</font>
								<font style="vertical-align: inherit;">缓冲行来
								</font>
								<font style="vertical-align: inherit;">应用块嵌套循环连接
								</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">如果优化器选择首先处理</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，则提示无效，因为</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">它是发送方表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于</font>
							</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">MERGE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">NO_MERGE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示，这些优先规则适用：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												提示优先于任何不是技术约束的优化程序启发式。</font>
											<font style="vertical-align: inherit;">（如果提供提示作为建议没有效果，优化器有理由忽略它。）
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												提示优先于</font>
											<font style="vertical-align: inherit;">系统变量</font>
											<font style="vertical-align: inherit;">的
											</font>
										</font><code class="literal">derived_merge</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">标志
											</font>
										</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于视图引用，</font>
										</font><code class="literal">ALGORITHM={MERGE|TEMPTABLE}</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">视图定义中</font>
											<font style="vertical-align: inherit;">的
											</font>
											<font style="vertical-align: inherit;">子句优先于引用视图的查询中指定的提示。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="optimizer-hints-index-level"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引级优化器提示</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									索引级提示会影响优化程序用于特定表或索引的索引处理策略。</font>
								<font style="vertical-align: inherit;">这些提示类型会影响索引条件下推（ICP），多范围读取（MRR），索引合并和范围优化的使用（请参见</font>
							</font><a class="xref" href="optimization.html#select-optimization" title="8.2.1优化SELECT语句">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.2.1节“优化SELECT语句”）</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									索引级提示的语法：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（[@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...]）
 </font></font><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...]）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									语法指的是这些术语：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<em class="replaceable"><code>hint_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：允许使用以下提示名称：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">INDEX_MERGE</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，
														</font>
													</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_INDEX_MERGE</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：为指定的表或索引启用或禁用索引合并访问方法。</font>
														<font style="vertical-align: inherit;">有关此访问方法的信息，请参见
														</font>
													</font><a class="xref" href="optimization.html#index-merge-optimization" title="8.2.1.3索引合并优化">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">第8.2.1.3节“索引合并优化”</font>
														</font>
													</a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。</font>
														<font style="vertical-align: inherit;">这些提示适用于所有三种索引合并算法。
														</font>
													</font>
												</p>
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															该 </font>
													</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">INDEX_MERGE</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">提示强制使用索引合并使用指定的索引集指定表的优化。</font>
														<font style="vertical-align: inherit;">如果未指定索引，优化程序将考虑所有可能的索引组合并选择最便宜的索引组合。</font>
														<font style="vertical-align: inherit;">如果索引组合不适用于给定语句，则可以忽略提示。
														</font>
													</font>
												</p>
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															该</font>
													</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_INDEX_MERGE</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															提示禁用索引合并涉及任何特定指标的组合。</font>
														<font style="vertical-align: inherit;">如果提示未指定索引，则表不允许使用索引合并。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">MRR</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，
														</font>
													</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_MRR</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：为指定的表或索引启用或禁用MRR。</font>
														<font style="vertical-align: inherit;">MRR提示仅适用于</font>
													</font><code class="literal">InnoDB</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">和
														</font>
													</font><code class="literal">MyISAM</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">表格。</font>
														<font style="vertical-align: inherit;">有关此访问方法的信息，请参见
														</font>
													</font><a class="xref" href="optimization.html#mrr-optimization" title="8.2.1.10多范围读取优化">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">第8.2.1.10节“多范围读取优化”</font>
														</font>
													</a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_ICP</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：禁用指定表或索引的ICP。</font>
														<font style="vertical-align: inherit;">默认情况下，ICP是候选优化策略，因此没有提示启用它。</font>
														<font style="vertical-align: inherit;">有关此访问方法的信息，请参见
														</font>
													</font><a class="xref" href="optimization.html#index-condition-pushdown-optimization" title="8.2.1.5指数条件下推优化">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">第8.2.1.5节“索引条件下推优化”</font>
														</font>
													</a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_RANGE_OPTIMIZATION</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：禁用指定表或索引的索引范围访问。</font>
														<font style="vertical-align: inherit;">此提示还会禁用表或索引的索引合并和松散索引扫描。</font>
														<font style="vertical-align: inherit;">默认情况下，范围访问是候选优化策略，因此没有提示启用它。
														</font>
													</font>
												</p>
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															当范围的数量可能很高并且范围优化需要许多资源时，该提示可能是有用的。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">SKIP_SCAN</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，
														</font>
													</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_SKIP_SCAN</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：为指定的表或索引启用或禁用Skip Scan访问方法。</font>
														<font style="vertical-align: inherit;">有关此访问方法的信息，请参阅
														</font>
													</font><a class="xref" href="optimization.html#range-access-skip-scan" title="跳过扫描范围访问方法">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">跳过扫描范围访问方法</font>
														</font>
													</a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。</font>
														<font style="vertical-align: inherit;">从MySQL 8.0.13开始提供这些提示。
														</font>
													</font>
												</p>
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															该</font>
													</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">SKIP_SCAN</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">提示强制使用跳跃扫描使用指定的索引集指定表的优化。</font>
														<font style="vertical-align: inherit;">如果未指定索引，优化程序将考虑所有可能的索引并选择最便宜的索引。</font>
														<font style="vertical-align: inherit;">如果索引不适用于给定语句，则可以忽略提示。
														</font>
													</font>
												</p>
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															该</font>
													</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_SKIP_SCAN</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															提示禁用跳过扫描指定索引。</font>
														<font style="vertical-align: inherit;">如果提示未指定索引，则表不允许跳过扫描。
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
								</li>
								<li class="listitem">
									<p>
										<em class="replaceable"><code>tbl_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：提示适用的表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<em class="replaceable"><code>index_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：指定表中索引的名称。</font>
											<font style="vertical-align: inherit;">提示适用于它命名的所有索引。</font>
											<font style="vertical-align: inherit;">如果提示不指定索引，则它适用于表中的所有索引。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												要引用主键，请使用名称
											</font>
										</font><code class="literal">PRIMARY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">要查看表的索引名称，请使用</font>
										</font><a class="link" href="sql-syntax.html#show-index" title="13.7.6.22 SHOW INDEX语法"><code class="literal">SHOW
												INDEX</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<em class="replaceable"><code>query_block_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：提示适用的查询块。</font>
											<font style="vertical-align: inherit;">如果提示不包含前导
											</font>
											<font style="vertical-align: inherit;">，则提示将应用于发生它的查询块。</font>
											<font style="vertical-align: inherit;">对于
											</font>
											<font style="vertical-align: inherit;">
												语法，提示适用于命名查询块中的命名表。</font>
											<font style="vertical-align: inherit;">要为查询块指定名称，请参阅
											</font><a class="xref" href="optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示">
												<font style="vertical-align: inherit;">命名查询块的优化程序提示</font>
											</a>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">@<em class="replaceable"><code>query_block_name</code></em></code>
										<font style="vertical-align: inherit;"></font><code class="literal"><em class="replaceable"><code>tbl_name</code></em>@<em
											 class="replaceable"><code>query_block_name</code></em></code>
										<font style="vertical-align: inherit;"></font><a class="xref" href="optimization.html#optimizer-hints-query-block-naming"
										 title="用于命名查询块的优化器提示">
											<font style="vertical-align: inherit;"></font>
										</a>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									例子：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + INDEX_MERGE（t1 f3，PRIMARY）* / f2 FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里f1 ='o'和f2 = f3 AND f3 &lt;= 4;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + MRR（t1）* / * FROM t1 WHERE f2 &lt;= 3 AND 3 &lt;= f3;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + NO_RANGE_OPTIMIZATION（t3 PRIMARY，f2_idx）* / f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  从t3，其中f1&gt; 30且f1 &lt;33;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT INTO t3（f1，f2，f3）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （SELECT / * + NO_ICP（t2）* / t2.f1，t2.f2，t2.f3 FROM t1，t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   其中t1.f1 = t2.f1和t2.f2 BETWEEN t1.f1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   AND t1.f2 AND t2.f2 + 1&gt; = t1.f1 + 1）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + SKIP_SCAN（t1 PRIMARY）* / f1，f2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  从t1 WHERE f2&gt; 40;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下示例使用索引合并提示，但其他索引级提示遵循与提示忽略和优化程序提示相对于</font>
							</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统变量或索引提示的</font>
								<font style="vertical-align: inherit;">优先级相同的原则
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									假设表</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">中的列
								</font>
							</font><code class="literal">a</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">b</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">c</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，和</font>
							</font><code class="literal">d</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">; </font>
								<font style="vertical-align: inherit;">和索引命名</font>
							</font><code class="literal">i_a</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">i_b</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">以及</font>
							</font><code class="literal">i_c</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存在于</font>
							</font><code class="literal">a</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">b</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">c</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，分别为：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + INDEX_MERGE（t1 i_a，i_b，i_c）* / * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中a = 1 AND b = 2 AND c = 3 AND d = 4;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">(i_a, i_b, i_c)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在这种情况下，</font>
								<font style="vertical-align: inherit;">
									索引合并用于</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + INDEX_MERGE（t1 i_a，i_b，i_c）* / * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  其中b = 1且c = 2且d = 3;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">(i_b, i_c)</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在这种情况下，</font>
								<font style="vertical-align: inherit;">
									索引合并用于</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * + INDEX_MERGE（t1 i_a，i_b）NO_INDEX_MERGE（t1 i_b）* /
</font></font></pre>
						<p>
							<a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_INDEX_MERGE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> 被忽略，因为同一个表有一个先前的提示。
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * + NO_INDEX_MERGE（t1 i_a，i_b）INDEX_MERGE（t1 i_b）* /
</font></font></pre>
						<p>
							<a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">INDEX_MERGE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> 被忽略，因为同一个表有一个先前的提示。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于</font>
							</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">INDEX_MERGE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_INDEX_MERGE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">优化程序提示，这些优先级规则适用：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果指定了优化程序提示并且适用，则它优先于</font>
										</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">系统变量</font>
											<font style="vertical-align: inherit;">的与索引合并相关的标志
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='index_merge_intersection = off';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + INDEX_MERGE（t1 i_b，i_c）* / * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中b = 1且c = 2且d = 3;</font></font><font></font>
</pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												提示优先于
											</font>
										</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
										</font><code class="literal">(i_b, i_c)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在这种情况下，</font>
											<font style="vertical-align: inherit;">索引合并用于</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='index_merge_intersection = on';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + INDEX_MERGE（t1 i_b）* / * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中b = 1且c = 2且d = 3;</font></font><font></font>
</pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												提示仅指定一个索引，因此它不适用，并且</font>
										</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												flag（</font>
										</font><code class="literal">on</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）适用。</font>
											<font style="vertical-align: inherit;">如果优化程序评估它是成本有效的，则使用索引合并。
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='index_merge_intersection = off';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + INDEX_MERGE（t1 i_b）* / * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中b = 1且c = 2且d = 3;</font></font><font></font>
</pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												提示仅指定一个索引，因此它不适用，并且</font>
										</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												flag（</font>
										</font><code class="literal">off</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）适用。</font>
											<font style="vertical-align: inherit;">未使用索引合并。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												的</font>
										</font><code class="literal">USE INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">FORCE
											INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和</font>
										</font><code class="literal">IGNORE INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">索引提示具有比更高的优先级
											</font>
										</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">INDEX_MERGE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_INDEX_MERGE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">优化提示。
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * + INDEX_MERGE（t1 i_a，i_b，i_c）* / ... IGNORE INDEX i_a
</font></font></pre>
									<p>
										<code class="literal">IGNORE INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">优先于
											</font>
										</font><a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">INDEX_MERGE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，因此索引
											</font>
										</font><code class="literal">i_a</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">从索引合并的可能范围中排除。
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * + NO_INDEX_MERGE（t1 i_a，i_b）* / ... FORCE INDEX i_a，i_b
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												索引合并是不允许的</font>
										</font><code class="literal">i_a, i_b</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												，因为</font>
										</font><code class="literal">FORCE INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，但优化被迫使用两种</font>
										</font><code class="literal">i_a</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												或</font>
										</font><code class="literal">i_b</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">对
											</font>
										</font><a class="link" href="optimization.html#jointype_range"><code class="literal">range</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><a class="link" href="optimization.html#jointype_ref"><code class="literal">ref</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">访问。</font>
											<font style="vertical-align: inherit;">没有冲突; </font>
											<font style="vertical-align: inherit;">这两个提示都适用。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果</font>
										</font><code class="literal">IGNORE INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">提示命名多个索引，则这些索引不可用于索引合并。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在</font>
										</font><code class="literal">FORCE INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和</font>
										</font><code class="literal">USE
											INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">提示使只有指定索引可用于索引合并。
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + INDEX_MERGE（t1 i_a，i_b，i_c）* / a FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FORCE INDEX（i_a，i_b）WHERE c ='h'和a = 2 AND b ='b';</font></font><font></font>
</pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												索引合并交集访问算法用于
											</font>
										</font><code class="literal">(i_a, i_b)</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">如果</font>
										</font><code class="literal">FORCE INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">改为，</font>
											<font style="vertical-align: inherit;">也是如此
											</font>
										</font><code class="literal">USE
											INDEX</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="optimizer-hints-subquery"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">子查询优化器提示</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									子查询提示影响是否使用半连接的转换和半连接策略允许，而当半联接未使用，是否使用子查询物化或
								</font>
							</font><code class="literal">IN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">至- </font>
							</font><code class="literal">EXISTS</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									变换。</font>
								<font style="vertical-align: inherit;">有关这些优化的更多信息，请参见</font>
							</font><a class="xref" href="optimization.html#subquery-optimization" title="8.2.2优化子查询，派生表，查看引用和公用表表达式">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.2.2节“优化子查询，派生表，视图引用和公用表表达式”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									影响半连接策略的提示语法：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>hint_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（[@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] [ </font></font><em class="replaceable"><code>strategy</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>strategy</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ...]）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									语法指的是这些术语：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<em class="replaceable"><code>hint_name</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：允许使用以下提示名称：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">SEMIJOIN</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">，
														</font>
													</font><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">NO_SEMIJOIN</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">：启用或禁用指定的半连接策略。
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
								</li>
								<li class="listitem">
									<p>
										<em class="replaceable"><code>strategy</code></em>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：要启用或禁用的半连接策略。</font>
											<font style="vertical-align: inherit;">这些策略名允许：</font>
										</font><code class="literal">DUPSWEEDOUT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">FIRSTMATCH</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">LOOSESCAN</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">MATERIALIZATION</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于</font>
										</font><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">SEMIJOIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">提示，如果未命名策略，则根据</font>
										</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">系统变量</font>
											<font style="vertical-align: inherit;">启用的策略，如果可能，将使用半连接
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">如果策略被命名但不适用于该语句，</font>
										</font><code class="literal">DUPSWEEDOUT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">则使用。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于</font>
										</font><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">NO_SEMIJOIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">提示，如果未命名策略，则不使用半连接。</font>
											<font style="vertical-align: inherit;">如果使用策略来排除声明的所有适用策略，
											</font>
										</font><code class="literal">DUPSWEEDOUT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">则使用策略。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果一个子查询嵌套在另一个子查询中并且两者都合并为外部查询的半连接，则忽略最内层查询的任何半连接策略规范。
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">SEMIJOIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">NO_SEMIJOIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示仍可用于启用或禁用此类嵌套子查询的半连接转换。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果</font>
							</font><code class="literal">DUPSWEEDOUT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">禁用，有时优化程序可能会生成远非最佳的查询计划。</font>
								<font style="vertical-align: inherit;">这是由于在贪婪搜索期间进行启发式修剪，这可以通过设置来避免
								</font>
							</font><a class="link" href="server-administration.html#sysvar_optimizer_prune_level"><code class="literal">optimizer_prune_level=0</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									例子：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + NO_SEMIJOIN（@ subq1 FIRSTMATCH，LOOSESCAN）* / * FROM t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t2.a IN（SELECT / * + QB_NAME（subq1）* / a FROM t3）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + SEMIJOIN（@ subq1 MATERIALIZATION，DUPSWEEDOUT）* / * FROM t2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里t2.a IN（SELECT / * + QB_NAME（subq1）* / a FROM t3）;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									影响是否使用子查询物化或暗示的语法
								</font>
							</font><code class="literal">IN</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">-到- </font>
							</font><code class="literal">EXISTS</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									转换：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SUBQUERY（[@ </font></font><em class="replaceable"><code>query_block_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font><em class="replaceable"><code>strategy</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									提示名称始终为
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">SUBQUERY</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于</font>
							</font><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">SUBQUERY</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示，</font>
							</font><em class="replaceable"><code>strategy</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">允许使用</font>
								<font style="vertical-align: inherit;">以下
								</font>
								<font style="vertical-align: inherit;">值：
								</font>
							</font><code class="literal">INTOEXISTS</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">MATERIALIZATION</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									例子：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT id，IN（SELECT / * + SUBQUERY（MATERIALIZATION）* / a FROM t1）FROM t2;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t2 WHERE t2.a IN（SELECT / * + SUBQUERY（INTOEXISTS）* / a FROM t1）;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于半连接和</font>
							</font><a class="link" href="optimization.html#optimizer-hints-subquery" title="子查询优化器提示"><code class="literal">SUBQUERY</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									提示，前导
								</font>
								<font style="vertical-align: inherit;">
									指定提示适用的查询块。</font>
								<font style="vertical-align: inherit;">如果提示不包含前导
								</font>
								<font style="vertical-align: inherit;">，则提示将应用于发生它的查询块。</font>
								<font style="vertical-align: inherit;">要为查询块指定名称，请参阅
								</font><a class="xref" href="optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示">
									<font style="vertical-align: inherit;">命名查询块的优化程序提示</font>
								</a>
								<font style="vertical-align: inherit;">。
								</font>
							</font><code class="literal">@<em class="replaceable"><code>query_block_name</code></em></code>
							<font style="vertical-align: inherit;"></font><code class="literal">@<em class="replaceable"><code>query_block_name</code></em></code>
							<font style="vertical-align: inherit;"></font><a class="xref" href="optimization.html#optimizer-hints-query-block-naming"
							 title="用于命名查询块的优化器提示">
								<font style="vertical-align: inherit;"></font>
							</a>
							<font style="vertical-align: inherit;"></font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果提示注释包含多个子查询提示，则使用第一个。</font>
								<font style="vertical-align: inherit;">如果还有其他类型的提示，则会产生警告。</font>
								<font style="vertical-align: inherit;">以下隐藏的其他类型的提示被忽略。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="optimizer-hints-execution-time"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句执行时间优化器提示</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><a class="link" href="optimization.html#optimizer-hints-execution-time" title="语句执行时间优化器提示"><code class="literal">MAX_EXECUTION_TIME</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示仅允许用于</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									语句。</font>
								<font style="vertical-align: inherit;">它</font>
							</font><em class="replaceable"><code>N</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在服务器终止语句之前允许执行语句的时间</font>
								<font style="vertical-align: inherit;">限制</font>
								<font style="vertical-align: inherit;">（超时值，以毫秒为单位）：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_EXECUTION_TIME（</font></font><em class="replaceable"><code>N</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									超时为1秒（1000毫秒）的示例：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + MAX_EXECUTION_TIME（1000）* / * FROM t1 INNER JOIN t2 WHERE ...
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该
								</font>
								<font style="vertical-align: inherit;">
									提示设置的语句执行超时
								</font>
								<font style="vertical-align: inherit;">毫秒。</font>
								<font style="vertical-align: inherit;">如果此选项不存在或</font>
								<font style="vertical-align: inherit;">为0，则</font>
								<font style="vertical-align: inherit;">系统变量</font>
								<font style="vertical-align: inherit;">建立的语句超时
								</font>
								<font style="vertical-align: inherit;">适用。
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-execution-time" title="语句执行时间优化器提示"><code class="literal">MAX_EXECUTION_TIME(<em
									 class="replaceable"><code>N</code></em>)</code></a>
							<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
							<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
							<font style="vertical-align: inherit;"></font><a class="link" href="server-administration.html#sysvar_max_execution_time"><code
								 class="literal">max_execution_time</code></a>
							<font style="vertical-align: inherit;"></font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><a class="link" href="optimization.html#optimizer-hints-execution-time" title="语句执行时间优化器提示"><code class="literal">MAX_EXECUTION_TIME</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示适用如下：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于具有多个</font>
										</font><code class="literal">SELECT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												关键字的</font>
											<font style="vertical-align: inherit;">语句</font>
											<font style="vertical-align: inherit;">，例如联合或带有子查询的语句，
											</font>
										</font><a class="link" href="optimization.html#optimizer-hints-execution-time" title="语句执行时间优化器提示"><code
											 class="literal">MAX_EXECUTION_TIME</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												适用于整个语句，并且必须出现在第一个语句之后</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它适用于只读
											</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句。</font>
											<font style="vertical-align: inherit;">不是只读的语句是那些调用存储函数的语句，该函数将数据修改为副作用。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												它不适用于</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												存储程序中的语句而被忽略。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="optimizer-hints-set-var"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">变量设置提示语法</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091703422656"></a><a class="indexterm" name="idm140091703421616"></a><a class="indexterm"
						 name="idm140091703420128"></a><a class="indexterm" name="idm140091703418640"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									所述</font>
							</font><a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示暂时设定的系统变量的会话值（用于单个语句的持续时间）。</font>
								<font style="vertical-align: inherit;">例子：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + SET_VAR（sort_buffer_size = 16M）* / name FROM people ORDER BY name;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT / * + SET_VAR（foreign_key_checks = OFF）* / INTO t2 VALUES（2）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + SET_VAR（optimizer_switch ='mrr_cost_based = off'）* / 1;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#optimizer-hints-set-var"
							 title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示</font>
								<font style="vertical-align: inherit;">
									语法</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET_VAR（</font></font><em class="replaceable"><code>var_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
						<p>
							<em class="replaceable"><code>var_name</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">命名一个具有会话值的系统变量（尽管并非所有这些变量都可以命名，如后面所述）。
								</font>
							</font><em class="replaceable"><code>value</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是赋给变量的值; </font>
								<font style="vertical-align: inherit;">值必须是标量。
								</font>
							</font>
						</p>
						<p>
							<a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> 进行临时变量更改，如以下语句所示：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@unique_checks;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ unique_checks |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT /*+ SET_VAR(unique_checks=OFF) */ @@unique_checks;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ unique_checks |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT @@unique_checks;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">@@ unique_checks |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用时</font>
							</font><a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，无需保存和恢复变量值。</font>
								<font style="vertical-align: inherit;">这使您可以通过单个语句替换多个语句。</font>
								<font style="vertical-align: inherit;">考虑这一系列陈述：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET @saved_val = @@ SESSION。</font></font><em class="replaceable"><code>var_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET @@ SESSION。</font></font><em class="replaceable"><code>var_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET @@ SESSION。</font></font><em class="replaceable"><code>var_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= @saved_val;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该序列可以由以下单个语句替换：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + SET_VAR（</font></font><em class="replaceable"><code>var_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）...
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									独立
								</font>
							</font><a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1变量赋值的SET语法"><code class="literal">SET</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									语句允许使用以下任何语法来命名会话变量：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET SESSION </font></font><em class="replaceable"><code>var_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET @@ SESSION。</font></font><em class="replaceable"><code>var_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET @@。</font></font><em class="replaceable"><code>var_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									由于该</font>
							</font><a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示仅适用于会话变量，会话范围是隐含的，和</font>
							</font><code class="literal">SESSION</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">@@SESSION.</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">以及</font>
							</font><code class="literal">@@</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">既不需要也不允许。</font>
								<font style="vertical-align: inherit;">包括显式会话指示符语法会导致
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示被忽略并带有警告。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									并非所有会话变量都允许使用
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">各个系统变量描述表明每个变量是否可以生成; </font>
								<font style="vertical-align: inherit;">请参见</font>
							</font><a class="xref" href="server-administration.html#server-system-variables" title="5.1.8服务器系统变量">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第5.1.8节“服务器系统变量”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">您还可以通过尝试使用它来在运行时检查系统变量</font>
							</font><a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">如果变量不可用，则会发出警告：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT /*+ SET_VAR(collation_server = 'utf8') */ 1;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1排，1警告（0.00秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW WARNINGS\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  等级：警告</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   代码：4537</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消息：无法使用SET_VAR提示设置变量'collat​​ion_server'。</font></font><font></font>
</pre>
						<p>
							<a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> 语法允许只设置一个变量，但可以给出多个提示来设置多个变量：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + SET_VAR（optimizer_switch ='mrr_cost_based = off'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           SET_VAR（max_heap_table_size = 1G）* / 1;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果在同一语句中出​​现多个具有相同变量名称的提示，则应用第一个提示，并忽略其他提示并显示警告：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + SET_VAR（max_heap_table_size = 1G）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           SET_VAR（max_heap_table_size = 3G）* / 1;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在这种情况下，将忽略第二个提示，并显示它是冲突的警告。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									一个</font>
							</font><a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示与警告忽略，如果没有系统变量指定名称或变量值不正确：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + SET_VAR（max_size = 1G）* / 1;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT / * + SET_VAR（optimizer_switch ='mrr_cost_based = yes'）* / 1;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于第一个陈述，没有
								</font>
							</font><code class="literal">max_size</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">变量。</font>
								<font style="vertical-align: inherit;">对于第二个语句，</font>
							</font><code class="literal">mrr_cost_flag</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">取值为
								</font>
							</font><code class="literal">on</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或</font>
							</font><code class="literal">off</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，因此尝试将其设置</font>
							</font><code class="literal">yes</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">为不正确。</font>
								<font style="vertical-align: inherit;">在每种情况下，都会忽略提示并发出警告。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示仅在语句级别是允许的。</font>
								<font style="vertical-align: inherit;">如果在子查询中使用，则会忽略提示并显示警告。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									从属服务器忽略</font>
							</font><a class="link" href="optimization.html#optimizer-hints-set-var" title="变量设置提示语法"><code class="literal">SET_VAR</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									复制语句中的提示，以避免出现安全问题。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="optimizer-hints-resource-group"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组提示语法</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><a class="link" href="optimization.html#optimizer-hints-resource-group" title="资源组提示语法"><code class="literal">RESOURCE_GROUP</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">优化程序提示用于资源组管理（见
								</font>
							</font><a class="xref" href="optimization.html#resource-groups" title="8.12.5资源组">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.12.5，“资源组”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。</font>
								<font style="vertical-align: inherit;">此提示将临时执行语句的线程（在语句的持续时间内）分配给命名资源组。</font>
								<font style="vertical-align: inherit;">它需要</font>
							</font><a class="link" href="security.html#priv_resource-group-admin"><code class="literal">RESOURCE_GROUP_ADMIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或
								</font>
							</font><a class="link" href="security.html#priv_resource-group-user"><code class="literal">RESOURCE_GROUP_USER</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">特权。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									例子：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + RESOURCE_GROUP（USR_default）* / name FROM people ORDER BY name;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INSERT / * + RESOURCE_GROUP（批量）* / INTO t2 VALUES（2）;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;"></font><a class="link" href="optimization.html#optimizer-hints-resource-group"
							 title="资源组提示语法"><code class="literal">RESOURCE_GROUP</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									提示</font>
								<font style="vertical-align: inherit;">
									语法</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RESOURCE_GROUP（</font></font><em class="replaceable"><code>group_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
						<p>
							<em class="replaceable"><code>group_name</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表示在语句执行期间应为其分配线程的资源组。</font>
								<font style="vertical-align: inherit;">如果该组不存在，则会发出警告并忽略提示。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><a class="link" href="optimization.html#optimizer-hints-resource-group" title="资源组提示语法"><code class="literal">RESOURCE_GROUP</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示必须在初始声明关键字（后出现</font>
							</font><code class="literal">SELECT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">INSERT</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">REPLACE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">UPDATE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，或
								</font>
							</font><code class="literal">DELETE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									另一种方法
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-resource-group" title="资源组提示语法"><code class="literal">RESOURCE_GROUP</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是
								</font>
							</font><a class="link" href="sql-syntax.html#set-resource-group" title="13.7.2.4 SET RESOURCE GROUP语法"><code
								 class="literal">SET RESOURCE GROUP</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句，它非线性地将线程分配给资源组。</font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="sql-syntax.html#set-resource-group" title="13.7.2.4 SET RESOURCE GROUP语法">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第13.7.2.4节“SET RESOURCE GROUP语法”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="optimizer-hints-query-block-naming"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">用于命名查询块的优化器提示</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表级，索引级和子查询优化器提示允许将特定查询块命名为其参数语法的一部分。</font>
								<font style="vertical-align: inherit;">要创建这些名称，请使用
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示"><code
								 class="literal">QB_NAME</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示，该提示为发生它的查询块指定名称：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QB_NAME（</font></font><em class="replaceable"><code>name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）
</font></font></pre>
						<p>
							<a class="link" href="optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示"><code class="literal">QB_NAME</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">提示可用于以明确的方式明确显示其他提示适用于哪些查询块。</font>
								<font style="vertical-align: inherit;">它们还允许在单个提示注释中指定所有非查询块名称提示，以便于理解复杂语句。</font>
								<font style="vertical-align: inherit;">请考虑以下声明：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（选择......）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT ... FROM ...））...</font></font><font></font>
</pre>
						<p>
							<a class="link" href="optimization.html#optimizer-hints-query-block-naming" title="用于命名查询块的优化器提示"><code class="literal">QB_NAME</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> 提示为语句中的查询块指定名称：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + QB_NAME（qb1）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（qb2）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（qb3）* / ... FROM ...））...</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									然后其他提示可以使用这些名称来引用相应的查询块：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + QB_NAME（qb1）MRR（@ qb1 t1）BKA（@ qb2）NO_MRR（@ qb3t1 idx1，id2）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（qb2）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（qb3）* / ... FROM ...））...</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									由此产生的效果如下：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">MRR(@qb1
												t1)</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">适用</font>
										</font><code class="literal">t1</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">于查询块中的
											</font>
											<font style="vertical-align: inherit;">表</font>
										</font><code class="literal">qb1</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<a class="link" href="optimization.html#optimizer-hints-table-level" title="表级优化器提示"><code class="literal">BKA(@qb2)</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">适用于查询块</font>
										</font><code class="literal">qb2</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<a class="link" href="optimization.html#optimizer-hints-index-level" title="索引级优化器提示"><code class="literal">NO_MRR(@qb3
												t1 idx1,
												id2)</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">适用于索引</font>
										</font><code class="literal">idx1</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												和</font>
											<font style="vertical-align: inherit;">
												查询块</font>
										</font><code class="literal">idx2</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">中的表</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font><code class="literal">t1</code>
										<font style="vertical-align: inherit;"></font><code class="literal">qb3</code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									查询块名称是标识符，并遵循有关哪些名称有效以及如何引用它们的常规规则（请参见
								</font>
							</font><a class="xref" href="language-structure.html#identifiers" title="9.2模式对象名称">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第9.2节“模式对象名称”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。</font>
								<font style="vertical-align: inherit;">例如，必须引用包含空格的查询块名称，这可以使用反引号来完成：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + BKA（@`我的提示名称`）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（`我的提示名称）* / ...）...</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果</font>
							</font><a class="link" href="server-administration.html#sqlmode_ansi_quotes"><code class="literal">ANSI_QUOTES</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">启用</font>
								<font style="vertical-align: inherit;">了</font>
								<font style="vertical-align: inherit;">SQL模式，则还可以在双引号内引用查询块名称：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + BKA（@“我的提示名称”）* / ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM（SELECT / * + QB_NAME（“我的提示名称”）* / ...）...</font></font><font></font>
</pre>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="index-hints"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.4索引提示</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091703313824"></a><a class="indexterm" name="idm140091703312752"></a><a class="indexterm"
					 name="idm140091703311264"></a><a class="indexterm" name="idm140091703310192"></a><a class="indexterm" name="idm140091703309120"></a><a
					 class="indexterm" name="idm140091703308048"></a><a class="indexterm" name="idm140091703306976"></a><a class="indexterm"
					 name="idm140091703305904"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								索引提示为优化程序提供有关如何在查询处理期间选择索引的信息。</font>
							<font style="vertical-align: inherit;">此处描述的索引提示与优化程序提示不同，如
							</font>
						</font><a class="xref" href="optimization.html#optimizer-hints" title="8.9.3优化器提示">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.9.3节“优化程序提示”中所述</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">索引和优化器提示可以单独使用，也可以一起使用。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								索引提示仅适用于</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								语句。</font>
							<font style="vertical-align: inherit;">（它们被解析器接受，
							</font>
						</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">但是被忽略并且没有效果。）
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								索引提示在表名后面指定。</font>
							<font style="vertical-align: inherit;">（有关在语句中指定表的一般语法
							</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，请参见
							</font>
						</font><a class="xref" href="sql-syntax.html#join" title="13.2.10.2 JOIN语法">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第13.2.10.2节“JOIN语法”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。）引用单个表的语法（包括索引提示）如下所示：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[[AS] </font></font><em class="replaceable"><code>alias</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] [ </font></font><em class="replaceable"><code>index_hint_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font><font></font>
<font></font>
<em class="replaceable"><code>index_hint_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
     </font></font><em class="replaceable"><code>index_hint</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><em class="replaceable"><code>index_hint</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ......</font></font><font></font>
<font></font>
<em class="replaceable"><code>index_hint</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    使用{INDEX | KEY}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      [FOR {JOIN | ORDER BY | GROUP BY}]（[ </font></font><em class="replaceable"><code>index_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  | </font><font style="vertical-align: inherit;">{IGNORE | FORCE} {INDEX | KEY}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      [FOR {JOIN | ORDER BY | GROUP BY}]（</font></font><em class="replaceable"><code>index_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><font></font>
<font></font>
<em class="replaceable"><code>index_list</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：
     </font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[，</font></font><em class="replaceable"><code>index_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] ......
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
							<font style="vertical-align: inherit;">提示告诉MySQL只使用其中一个命名索引来查找表中的行。</font>
							<font style="vertical-align: inherit;">替代语法</font>
							<font style="vertical-align: inherit;">告诉MySQL不使用某些特定的索引或索引。</font>
							<font style="vertical-align: inherit;">如果</font>
							<font style="vertical-align: inherit;">显示MySQL正在使用可能索引列表中的错误索引，则</font>
							<font style="vertical-align: inherit;">这些提示很有</font>
							<font style="vertical-align: inherit;">用。
							</font>
						</font><code class="literal">USE INDEX
							(<em class="replaceable"><code>index_list</code></em>)</code>
						<font style="vertical-align: inherit;"></font><code class="literal">IGNORE INDEX
							(<em class="replaceable"><code>index_list</code></em>)</code>
						<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code
							 class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;"></font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><code class="literal">FORCE INDEX</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">提示的作用就像</font>
							<font style="vertical-align: inherit;">，增加表扫描被认为是
							</font><span class="emphasis"><em>
									<font style="vertical-align: inherit;">非常</font>
								</em></span>
							<font style="vertical-align: inherit;">昂贵的。</font>
							<font style="vertical-align: inherit;">换句话说，仅当无法使用其中一个命名索引查找表中的行时，才使用表扫描。
							</font>
						</font><code class="literal">USE
							INDEX (<em class="replaceable"><code>index_list</code></em>)</code>
						<font style="vertical-align: inherit;"></font><span class="emphasis"><em>
								<font style="vertical-align: inherit;"></font>
							</em></span>
						<font style="vertical-align: inherit;"></font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								每个提示都需要索引名称，而不是列名。</font>
							<font style="vertical-align: inherit;">要引用主键，请使用名称</font>
						</font><code class="literal">PRIMARY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">要查看表的索引名称，请使用</font>
						</font><a class="link" href="sql-syntax.html#show-index" title="13.7.6.22 SHOW INDEX语法"><code class="literal">SHOW
								INDEX</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句或
							</font>
						</font><a class="link" href="information-schema.html#statistics-table" title="25.26 INFORMATION_SCHEMA统计表"><code
							 class="literal">INFORMATION_SCHEMA.STATISTICS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								表。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								的</font>
						</font><em class="replaceable"><code>index_name</code></em>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">价值不一定是完整的索引名。</font>
							<font style="vertical-align: inherit;">它可以是索引名称的明确前缀。</font>
							<font style="vertical-align: inherit;">如果前缀不明确，则会发生错误。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								例子：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM table1 USE INDEX（col1_index，col2_index）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里col1 = 1 AND col2 = 2 AND col3 = 3;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM table1 IGNORE INDEX（col3_index）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里col1 = 1 AND col2 = 2 AND col3 = 3;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								索引提示的语法具有以下特征：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											省略</font>
									</font><em class="replaceable"><code>index_list</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">for </font>
										<font style="vertical-align: inherit;">在语法上是有效
										</font>
										<font style="vertical-align: inherit;">的</font>
									</font><code class="literal">USE
										INDEX</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，这意味着</font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">“不</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">使用索引。</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">”</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											省略</font>
									</font><em class="replaceable"><code>index_list</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">的
										</font>
									</font><code class="literal">FORCE INDEX</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或者</font>
									</font><code class="literal">IGNORE
										INDEX</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">是一个语法错误。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您可以通过向提示添加</font>
									</font><code class="literal">FOR</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">子句来</font>
										<font style="vertical-align: inherit;">指定索引提示的范围
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">这为查询处理的各个阶段的执行计划的优化器选择提供了更细粒度的控制。</font>
										<font style="vertical-align: inherit;">要仅影响MySQL决定如何在表中查找行以及如何处理联接时使用的索引，请使用</font>
									</font><code class="literal">FOR
										JOIN</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">要影响对行进行排序或分组的索引用法，请使用</font>
									</font><code class="literal">FOR ORDER BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或
										</font>
									</font><code class="literal">FOR GROUP BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您可以指定多个索引提示：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 USE INDEX（i1）IGNORE INDEX for ORDER BY（i2）ORDER by a;
</font></font></pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在几个提示中命名相同的索引（即使在相同的提示中）也不是错误：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 USE INDEX（i1）USE INDEX（i1，i1）;
</font></font></pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											但是，混合</font>
									</font><code class="literal">USE INDEX</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											和</font>
									</font><code class="literal">FORCE INDEX</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">同一个表</font>
										<font style="vertical-align: inherit;">是一个错误</font>
										<font style="vertical-align: inherit;">：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 USE INDEX FOR JOIN（i1）FORCE INDEX FOR JOIN（i2）;
</font></font></pre>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果索引提示不包含</font>
						</font><code class="literal">FOR</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">子句，则提示的范围将应用于语句的所有部分。</font>
							<font style="vertical-align: inherit;">例如，这个提示：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IGNORE INDEX（i1）
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								等同于这种提示组合：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IGNORE INDEX FOR JOIN（i1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
订购的IGNORE索引（i1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IGNORE INDEX FOR GROUP BY（i1）</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								在MySQL 5.0中，没有</font>
						</font><code class="literal">FOR</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">子句的</font>
							<font style="vertical-align: inherit;">提示范围</font>
							<font style="vertical-align: inherit;">仅适用于行检索。</font>
							<font style="vertical-align: inherit;">要在没有</font>
						</font><code class="literal">FOR</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">子句</font>
							<font style="vertical-align: inherit;">时使服务器使用此旧行为</font>
							<font style="vertical-align: inherit;">，请</font>
						</font><a class="link" href="server-administration.html#sysvar_old"><code class="literal">old</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在服务器启动时</font>
							<font style="vertical-align: inherit;">启用</font>
							<font style="vertical-align: inherit;">系统变量。</font>
							<font style="vertical-align: inherit;">请注意在复制设置中启用此变量。</font>
							<font style="vertical-align: inherit;">使用基于语句的二进制日志记录，为主服务器和从服务器设置不同的模式可能会导致复制错误。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								当索引提示进行处理，它们是由式（收集在一个单一的列表</font>
						</font><code class="literal">USE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，</font>
						</font><code class="literal">FORCE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><code class="literal">IGNORE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）和范围（</font>
						</font><code class="literal">FOR
							JOIN</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，</font>
						</font><code class="literal">FOR ORDER BY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，</font>
						</font><code class="literal">FOR
							GROUP BY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）。</font>
							<font style="vertical-align: inherit;">例如：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  使用指数（）IGNORE指数（i2）使用指数（i1）使用指数（i2）;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								相当于：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   使用指数（i1，i2）IGNORE INDEX（i2）;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								然后按以下顺序为每个范围应用索引提示：
							</font>
						</font>
					</p>
					<div class="orderedlist">
						<ol class="orderedlist" type="1">
							<li class="listitem">
								<p>
									<code class="literal">{USE|FORCE} INDEX</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">如果存在则适用。</font>
										<font style="vertical-align: inherit;">（如果不是，则使用优化程序确定的索引集。）
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">IGNORE INDEX</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">应用于上一步的结果。</font>
										<font style="vertical-align: inherit;">例如，以下两个查询是等效的：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 USE INDEX（i1）IGNORE INDEX（i2）USE INDEX（i2）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t1 USE INDEX（i1）;</font></font><font></font>
</pre>
							</li>
						</ol>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于</font>
						</font><code class="literal">FULLTEXT</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">搜索，索引提示的工作方式如下：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于自然语言模式搜索，将默默忽略索引提示。</font>
										<font style="vertical-align: inherit;">例如，</font>
									</font><code class="literal">IGNORE INDEX(i1)</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">忽略没有警告，仍然使用索引。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于布尔模式搜索，使用</font>
									</font><code class="literal">FOR
										ORDER BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或</font>
									</font><code class="literal">FOR GROUP BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">静默忽略</font>
										<font style="vertical-align: inherit;">索引提示</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">使用</font>
									</font><code class="literal">FOR
										JOIN</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或不使用</font>
									</font><code class="literal">FOR</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">修饰符的</font>
										<font style="vertical-align: inherit;">索引提示</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">与提示如何应用于非</font>
									</font><code class="literal">FULLTEXT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">搜索</font>
										<font style="vertical-align: inherit;">相反</font>
										<font style="vertical-align: inherit;">，提示用于查询执行的所有阶段（查找行和检索，分组和排序）。</font>
										<font style="vertical-align: inherit;">即使为非</font>
									</font><code class="literal">FULLTEXT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">索引</font>
										<font style="vertical-align: inherit;">提供了提示，也是如此</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											例如，以下两个查询是等效的：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  使用指数（index1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IGNORE INDEX（index1）FOR ORDER BY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  IGNORE INDEX（index1）FOR GROUP BY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在......布尔模式......;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  使用指数（index1）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在......布尔模式......;</font></font><font></font>
</pre>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="cost-model"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.5优化器成本模型</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091703231488"></a><a class="indexterm" name="idm140091703230032"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								为了生成执行计划，优化程序使用基于对查询执行期间发生的各种操作的成本的估计的成本模型。</font>
							<font style="vertical-align: inherit;">优化器有一组可编译的默认</font>
						</font><span class="quote">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">“ </font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">成本常量</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> ”，</font>
							</font>
						</span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">可用于制定有关执行计划的决策。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化器还具有在执行计划构建期间使用的成本估算数据库。</font>
							<font style="vertical-align: inherit;">这些估计值存储在</font>
							<font style="vertical-align: inherit;">系统数据库</font>
							<font style="vertical-align: inherit;">的</font>
						</font><code class="literal">server_cost</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><code class="literal">engine_cost</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表中，
							</font>
						</font><code class="literal">mysql</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">并且可以随时进行配置。</font>
							<font style="vertical-align: inherit;">这些表的目的是使得可以轻松调整优化程序在尝试获取查询执行计划时使用的成本估算。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p><a class="xref" href="optimization.html#cost-model-operation" title="成本模型一般操作">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">成本模型一般操作</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#cost-model-database" title="成本模型数据库">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">成本模型数据库</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#cost-model-database-modifications" title="对成本模型数据库进行更改">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">对成本模型数据库进行更改</font>
										</font>
									</a></p>
							</li>
						</ul>
					</div>

					<div class="simplesect">

						<div class="titlepage">
							<div>

								<div class="simple">
									<h4 class="title"><a name="cost-model-operation"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">成本模型一般操作</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									可配置的优化器成本模型的工作方式如下：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												服务器在启动时将成本模型表读入内存，并在运行时使用内存中的值。</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表中指定的</font>
											<font style="vertical-align: inherit;">任何非</font>
											<font style="vertical-align: inherit;">成本估算优先于相应的已编译默认成本常量。</font>
											<font style="vertical-align: inherit;">任何</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												估计都表明优化器使用编译的默认值。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在运行时，服务器可能会重新读取成本表。</font>
											<font style="vertical-align: inherit;">当动态加载存储引擎或</font>
										</font><a class="link" href="sql-syntax.html#flush-optimizer-costs"><code class="literal">FLUSH
												OPTIMIZER_COSTS</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												执行语句</font>
											<font style="vertical-align: inherit;">时会发生这种情况</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												成本表使服务器管理员可以通过更改表中的条目轻松调整成本估算。</font>
											<font style="vertical-align: inherit;">通过将条目的成本设置为，也可以轻松恢复为默认值</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">优化程序使用内存中的成本值，因此应该对表进行更改才能</font>
										</font><a class="link" href="sql-syntax.html#flush-optimizer-costs"><code class="literal">FLUSH
												OPTIMIZER_COSTS</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">生效。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												客户端会话开始时的当前内存成本估算在整个会话期间应用，直到结束。</font>
											<font style="vertical-align: inherit;">特别是，如果服务器重新读取成本表，则任何更改的估计值仅适用于随后启动的会话。</font>
											<font style="vertical-align: inherit;">现有会话不受影响。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												成本表特定于给定的服务器实例。</font>
											<font style="vertical-align: inherit;">服务器不会将成本表更改复制到复制从属服务器。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="cost-model-database"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">成本模型数据库</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									优化程序成本模型数据库由</font>
							</font><code class="literal">mysql</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统数据库中</font>
								<font style="vertical-align: inherit;">的两个表组成，这两个表</font>
								<font style="vertical-align: inherit;">包含查询执行期间发生的操作的成本估算信息：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<a class="indexterm" name="idm140091703205488"></a>

										<a class="indexterm" name="idm140091703204000"></a>

										<code class="literal">server_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：一般服务器操作的优化程序成本估算
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<a class="indexterm" name="idm140091703200960"></a>

										<a class="indexterm" name="idm140091703199472"></a>

										<code class="literal">engine_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：特定于特定存储引擎的操作的优化程序成本估算
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><code class="literal">server_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表包含以下列：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<code class="literal">cost_name</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												成本模型中使用的成本估算的名称。</font>
											<font style="vertical-align: inherit;">该名称不区分大小写。</font>
											<font style="vertical-align: inherit;">如果服务器在读取此表时无法识别成本名称，则会向错误日志写入警告。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">cost_value</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												成本估算值。</font>
											<font style="vertical-align: inherit;">如果值为非</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，则服务器将其用作成本。</font>
											<font style="vertical-align: inherit;">否则，它使用默认估计值（已编译的值）。</font>
											<font style="vertical-align: inherit;">DBA可以通过更新此列来更改成本估算。</font>
											<font style="vertical-align: inherit;">如果服务器在读取此表时发现成本值无效（非正数），则会向错误日志写入警告。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												要覆盖默认成本估算（对于指定的条目</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">），请将成本设置为非</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">值。</font>
											<font style="vertical-align: inherit;">要恢复为默认值，请将值设置为</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">然后执行</font>
										</font><a class="link" href="sql-syntax.html#flush-optimizer-costs"><code class="literal">FLUSH
												OPTIMIZER_COSTS</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">以告诉服务器重新读取成本表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">last_update</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												最后一行更新的时间。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">comment</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												与成本估算相关的描述性评论。</font>
											<font style="vertical-align: inherit;">DBA可以使用此列提供有关成本估算行存储特定值的原因的信息。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">default_value</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												成本估算的默认值（已编译）。</font>
											<font style="vertical-align: inherit;">此列是只读生成的列，即使关联的成本估算值发生更改，也会保留其值。</font>
											<font style="vertical-align: inherit;">对于在运行时添加到表中的行，此列的值为</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">server_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表</font>
								<font style="vertical-align: inherit;">
									的主键</font>
								<font style="vertical-align: inherit;">是</font>
							</font><code class="literal">cost_name</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">列，因此无法为任何成本估算创建多个条目。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									服务器识别</font>
								<font style="vertical-align: inherit;">表的</font>
								<font style="vertical-align: inherit;">这些</font>
							</font><code class="literal">cost_name</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									值</font>
							</font><code class="literal">server_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<code class="literal">disk_temptable_create_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">disk_temptable_row_cost</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												用于将存储在基于磁盘的存储引擎内部创建的临时表的费用估计（或者
											</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）。</font>
											<font style="vertical-align: inherit;">增加这些值会增加使用内部临时表的成本估算，并使优化程序更喜欢使用查询计划。</font>
											<font style="vertical-align: inherit;">有关此类表的信息，请参阅
											</font>
										</font><a class="xref" href="optimization.html#internal-temporary-tables" title="8.4.4 MySQL中的内部临时表使用">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.4.4节“MySQL中的内部临时表使用”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												与相应内存参数（</font>
										</font><code class="literal">memory_temptable_create_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">memory_temptable_row_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）</font>
											<font style="vertical-align: inherit;">的默认值相比，这些磁盘参数的较大默认值</font>
											<font style="vertical-align: inherit;">反映了处理基于磁盘的表的更高成本。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">key_compare_cost</code>
									</p><a class="indexterm" name="idm140091703166480"></a><a class="indexterm" name="idm140091703165408"></a>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												比较记录键的成本。</font>
											<font style="vertical-align: inherit;">增加此值会导致比较许多键的查询计划变得更加昂贵。</font>
											<font style="vertical-align: inherit;">例如，</font>
										</font><code class="literal">filesort</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">与避免使用索引进行排序的查询计划相比</font>
											<font style="vertical-align: inherit;">，执行a的查询计划
											</font>
											<font style="vertical-align: inherit;">变得相对更昂贵。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">memory_temptable_create_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">memory_temptable_row_cost</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												存储在</font>
										</font><code class="literal">MEMORY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">存储引擎</font>
											<font style="vertical-align: inherit;">中的内部创建的临时表的成本估算</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">增加这些值会增加使用内部临时表的成本估算，并使优化程序更喜欢使用查询计划。</font>
											<font style="vertical-align: inherit;">有关此类表的信息，请参见
											</font>
										</font><a class="xref" href="optimization.html#internal-temporary-tables" title="8.4.4 MySQL中的内部临时表使用">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.4.4节“MySQL中的内部临时表使用”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												与相应磁盘参数（</font>
										</font><code class="literal">disk_temptable_create_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">disk_temptable_row_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）</font>
											<font style="vertical-align: inherit;">的默认值相比，这些内存参数的较小默认值</font>
											<font style="vertical-align: inherit;">反映了处理基于内存的表的较低成本。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">row_evaluate_cost</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												评估记录条件的成本。</font>
											<font style="vertical-align: inherit;">与检查较少行的查询计划相比，增加此值会导致检查许多行的查询计划变得更加昂贵。</font>
											<font style="vertical-align: inherit;">例如，与读取较少行的范围扫描相比，表扫描变得相对更昂贵。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><code class="literal">engine_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表包含以下列：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<code class="literal">engine_name</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												此成本估算适用的存储引擎的名称。</font>
											<font style="vertical-align: inherit;">该名称不区分大小写。</font>
											<font style="vertical-align: inherit;">如果值为
											</font>
										</font><code class="literal">default</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，则它适用于没有自己的命名条目的所有存储引擎。</font>
											<font style="vertical-align: inherit;">如果服务器在读取此表时无法识别引擎名称，则会向错误日志写入警告。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">device_type</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												此成本估算适用的设备类型。</font>
											<font style="vertical-align: inherit;">该列旨在为不同的存储设备类型指定不同的成本估算，例如硬盘驱动器与固态驱动器。</font>
											<font style="vertical-align: inherit;">目前，不使用此信息，0是唯一允许的值。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">cost_name</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												与</font>
										</font><code class="literal">server_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表中</font>
											<font style="vertical-align: inherit;">相同</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">cost_value</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												与</font>
										</font><code class="literal">server_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表中</font>
											<font style="vertical-align: inherit;">相同</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">last_update</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												与</font>
										</font><code class="literal">server_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表中</font>
											<font style="vertical-align: inherit;">相同</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">comment</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												与</font>
										</font><code class="literal">server_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表中</font>
											<font style="vertical-align: inherit;">相同</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">default_value</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												成本估算的默认值（已编译）。</font>
											<font style="vertical-align: inherit;">此列是只读生成的列，即使关联的成本估算值发生更改，也会保留其值。</font>
											<font style="vertical-align: inherit;">对于在运行时添加到表中的行，此列的值为</font>
										</font><code class="literal">NULL</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，但如果该行</font>
										</font><code class="literal">cost_name</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">与原始行之一</font>
											<font style="vertical-align: inherit;">具有相同的</font>
											<font style="vertical-align: inherit;">值，则该
											</font>
										</font><code class="literal">default_value</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列将具有与该行相同的值。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于主键</font>
							</font><code class="literal">engine_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表是包含（一个元组</font>
							</font><code class="literal">cost_name</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">engine_name</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">device_type</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）个列，所以它不可能在这些列中的值的任意组合来创建多个条目。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									服务器识别</font>
								<font style="vertical-align: inherit;">表的</font>
								<font style="vertical-align: inherit;">这些</font>
							</font><code class="literal">cost_name</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									值</font>
							</font><code class="literal">engine_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<code class="literal">io_block_read_cost</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												从磁盘读取索引或数据块的成本。</font>
											<font style="vertical-align: inherit;">与读取较少磁盘块的查询计划相比，增加此值会导致读取许多磁盘块的查询计划变得更加昂贵。</font>
											<font style="vertical-align: inherit;">例如，与读取较少块的范围扫描相比，表扫描变得相对更昂贵。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<code class="literal">memory_block_read_cost</code>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												类似于</font>
										</font><code class="literal">io_block_read_cost</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，但表示从内存数据库缓冲区读取索引或数据块的成本。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果</font>
							</font><code class="literal">io_block_read_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">memory_block_read_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值不同，则执行计划可能会在同一查询的两次运行之间更改。</font>
								<font style="vertical-align: inherit;">假设内存访问的成本低于磁盘访问的成本。</font>
								<font style="vertical-align: inherit;">在这种情况下，在数据被读入缓冲池之前的服务器启动时，您可能会获得与运行查询之后不同的计划，因为这样数据将在内存中。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="cost-model-database-modifications"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">对成本模型数据库进行更改</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于希望从默认值更改成本模型参数的DBA，请尝试将值加倍或减半并测量效果。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对</font>
								<font style="vertical-align: inherit;">参数</font>
							</font><code class="literal">io_block_read_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">memory_block_read_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">参数的</font>
								<font style="vertical-align: inherit;">更改</font>
								<font style="vertical-align: inherit;">最有可能产生有价值的结果。</font>
								<font style="vertical-align: inherit;">这些参数值使数据访问方法的成本模型能够考虑从不同来源读取信息的成本; </font>
								<font style="vertical-align: inherit;">也就是说，从磁盘读取信息与读取内存缓冲区中已有信息的成本。</font>
								<font style="vertical-align: inherit;">例如，所有其他条件相同，设置
								</font>
							</font><code class="literal">io_block_read_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">为大于的值
								</font>
							</font><code class="literal">memory_block_read_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">会使优化器更喜欢将已经保存在内存中的信息的查询计划更新为必须从磁盘读取的计划。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									此示例显示如何更改默认值
								</font>
							</font><code class="literal">io_block_read_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新mysql.engine_cost</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SET cost_value = 2.0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE cost_name ='io_block_read_cost';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FLUSH OPTIMIZER_COSTS;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									此示例显示如何</font>
							</font><code class="literal">io_block_read_cost</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">仅
								</font>
								<font style="vertical-align: inherit;">更改</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎</font>
								<font style="vertical-align: inherit;">的值
								</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSERT INTO mysql.engine_cost</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  VALUES（'InnoDB'，0，'io_block_read_cost'，3.0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  CURRENT_TIMESTAMP，'为InnoDB使用较慢的磁盘'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FLUSH OPTIMIZER_COSTS;</font></font><font></font>
</pre>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizer-statistics"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.9.6优化器统计</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091703106464"></a><a class="indexterm" name="idm140091703104976"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><code class="literal">column_statistics</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">数据字典表存储直方图统计有关列值，以供在构建查询执行计划的优化。</font>
							<font style="vertical-align: inherit;">要执行直方图管理，请使用该</font>
						</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句; </font>
							<font style="vertical-align: inherit;">请参见</font>
						</font><a class="xref" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第13.7.3.1节“ANALYZE TABLE语法”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><code class="literal">column_statistics</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表具有以下特征：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该表包含除几何类型（空间数据）和之外的所有数据类型的列的统计信息
										</font>
									</font><a class="link" href="data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该表是持久的，因此每次服务器启动时都不需要创建列统计信息。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器对表执行更新; </font>
										<font style="vertical-align: inherit;">用户没有。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;"></font><code class="literal">column_statistics</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">用户无法直接访问</font>
							<font style="vertical-align: inherit;">
								该</font>
							<font style="vertical-align: inherit;">表，因为它是数据字典的一部分。</font>
							<font style="vertical-align: inherit;">可以使用直方图信息
							</font>
						</font><a class="link" href="information-schema.html#column-statistics-table" title="25.8 INFORMATION_SCHEMA COLUMN_STATISTICS表"><code
							 class="literal">INFORMATION_SCHEMA.COLUMN_STATISTICS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，其作为数据字典表上的视图实现。
							</font>
						</font><a class="link" href="information-schema.html#column-statistics-table" title="25.8 INFORMATION_SCHEMA COLUMN_STATISTICS表"><code
							 class="literal">COLUMN_STATISTICS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">有这些列：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<code class="literal">SCHEMA_NAME</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><code class="literal">TABLE_NAME</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><code class="literal">COLUMN_NAME</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：架构，表和列其统计应用的名称。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">HISTOGRAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：
										</font>
									</font><a class="link" href="data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">描述列统计信息的值，存储为直方图。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								列直方图包含存储在列中的值范围部分的存储桶。</font>
							<font style="vertical-align: inherit;">直方图是
							</font>
						</font><a class="link" href="data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">允许灵活地表示列统计信息的对象。</font>
							<font style="vertical-align: inherit;">这是一个示例直方图对象：
							</font>
						</font>
					</p>
					<pre data-lang="json" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “水桶”：[</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    [</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      1，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      0.3333333333333333</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    [</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      2，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      0.6666666666666666</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    [</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      3，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “null-values”：0，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “最后更新”：“2017-03-24 13：32：40.000000”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “采样率”：1，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “histogram-type”：“singleton”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “指定桶数”：128，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “data-type”：“int”，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  “collat​​ion-id”：8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								直方图对象具有以下键：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<code class="literal">buckets</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：直方图桶。</font>
										<font style="vertical-align: inherit;">桶结构取决于直方图类型。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于</font>
									</font><code class="literal">singleton</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">直方图，存储桶包含两个值：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														值1：桶的值。</font>
													<font style="vertical-align: inherit;">类型取决于列数据类型。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														值2：表示值的累积频率的double。</font>
													<font style="vertical-align: inherit;">例如，.25和.75表示列中25％和75％的值小于或等于桶值。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于</font>
									</font><code class="literal">equi-height</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">直方图，存储桶包含四个值：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														值1,2：桶的下限和上限值。</font>
													<font style="vertical-align: inherit;">类型取决于列数据类型。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														值3：表示值的累积频率的double。</font>
													<font style="vertical-align: inherit;">例如，.25和.75表示列中25％和75％的值小于或等于桶上限值。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														值4：从桶较低值到其较高值的范围内的不同值的数量。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">null-values</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：介于0.0和1.0之间的数字，表示作为SQL </font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值</font>
										<font style="vertical-align: inherit;">的列值的分数
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">如果为0，则列不包含任何
										</font>
									</font><code class="literal">NULL</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">last-updated</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：生成直方图时，</font>
									</font><em class="replaceable"><code>YYYY-MM-DD
											hh:mm:ss.uuuuuu</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">格式</font>
										<font style="vertical-align: inherit;">为UTC值</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">sampling-rate</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：介于0.0和1.0之间的数字，表示为创建直方图而采样的数据部分。</font>
										<font style="vertical-align: inherit;">值为1表示已读取所有数据（无采样）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">histogram-type</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：直方图类型：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">singleton</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">：一个存储桶表示列中的一个值。</font>
													<font style="vertical-align: inherit;">当列中的不同值的数量小于或等于</font>
												</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
														TABLE</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														生成直方图</font>
													<font style="vertical-align: inherit;">的</font>
													<font style="vertical-align: inherit;">语句中</font>
													<font style="vertical-align: inherit;">指定的桶的数量时，将创建此直方图类型</font>
													<font style="vertical-align: inherit;">。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">equi-height</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">：一个桶代表一系列值。</font>
													<font style="vertical-align: inherit;">当列中的不同值的数量大于</font>
												</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
														TABLE</code></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">生成直方图</font>
													<font style="vertical-align: inherit;">的</font>
													<font style="vertical-align: inherit;">语句中</font>
													<font style="vertical-align: inherit;">指定的桶的数量时，将创建此直方图类型
													</font>
													<font style="vertical-align: inherit;">。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">number-of-buckets-specified</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：</font>
									</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">生成直方图</font>
										<font style="vertical-align: inherit;">的</font>
										<font style="vertical-align: inherit;">语句中</font>
										<font style="vertical-align: inherit;">指定的存储桶数</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">data-type</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：此直方图包含的数据类型。</font>
										<font style="vertical-align: inherit;">在将持久存储中的直方图读取和解析到内存中时，需要这样做。</font>
										<font style="vertical-align: inherit;">值之一</font>
									</font><code class="literal">int</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，</font>
									</font><code class="literal">uint</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											（无符号整数）， ，</font>
									</font><code class="literal">double</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><code class="literal">decimal</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，</font>
									</font><code class="literal">datetime</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或
										</font>
									</font><code class="literal">string</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">（包括字符和二进制串）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">collation-id</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：直方图数据的排序规则ID。</font>
										<font style="vertical-align: inherit;">当</font>
									</font><code class="literal">data-type</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">值为
										</font>
										<font style="vertical-align: inherit;">时，它最有意义
										</font>
									</font><code class="literal">string</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">值对应
										</font>
									</font><code class="literal">ID</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">于</font>
									</font><a class="link" href="information-schema.html#collations-table" title="25.4 INFORMATION_SCHEMA COLLATIONS表"><code
										 class="literal">INFORMATION_SCHEMA.COLLATIONS</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											表中的</font>
										<font style="vertical-align: inherit;">列值
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要从直方图对象中提取特定值，可以使用</font>
						</font><a class="link" href="data-types.html#json" title="11.6 JSON数据类型"><code class="literal">JSON</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">操作。</font>
							<font style="vertical-align: inherit;">例如：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT</code></strong>
         <strong class="userinput"><code>TABLE_NAME, COLUMN_NAME,</code></strong>
         <strong class="userinput"><code>HISTOGRAM-&gt;&gt;'$."data-type"' AS 'data-type',</code></strong>
         <strong class="userinput"><code>JSON_LENGTH(HISTOGRAM-&gt;&gt;'$."buckets"') AS 'bucket-count'</code></strong>
       <strong class="userinput"><code>FROM INFORMATION_SCHEMA.COLUMN_STATISTICS;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ------------- ----------- + ----- + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">TABLE_NAME | </font><font style="vertical-align: inherit;">COLUMN_NAME | </font><font style="vertical-align: inherit;">数据类型| </font><font style="vertical-align: inherit;">桶数|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ------------- ----------- + ----- + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">国家| </font><font style="vertical-align: inherit;">人口| </font><font style="vertical-align: inherit;">int | </font><font style="vertical-align: inherit;">226 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">城市| </font><font style="vertical-align: inherit;">人口| </font><font style="vertical-align: inherit;">int | </font><font style="vertical-align: inherit;">1024 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">countrylanguage | </font><font style="vertical-align: inherit;">语言| </font><font style="vertical-align: inherit;">字符串| </font><font style="vertical-align: inherit;">457 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + ------------- ----------- + ----- + --------- +</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化程序使用直方图统计信息（如果适用），用于收集统计信息的任何数据类型的列。</font>
							<font style="vertical-align: inherit;">优化程序应用直方图统计信息，以根据列值与常量值的比较的选择性（过滤效果）确定行估计值。</font>
							<font style="vertical-align: inherit;">这些形式的谓词符合直方图使用的条件：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font><font style="vertical-align: inherit;">&lt;&gt; </font><font style="vertical-align: inherit;">！= </font><font style="vertical-align: inherit;">&gt; </font><font style="vertical-align: inherit;">&lt; </font><font style="vertical-align: inherit;">&gt; = </font><font style="vertical-align: inherit;">&lt;= </font><font style="vertical-align: inherit;">IS NULL
 </font><font style="vertical-align: inherit;">IS NOT NULL
 </font><font style="vertical-align: inherit;">BETWEEN </font><font style="vertical-align: inherit;">AND </font><font style="vertical-align: inherit;">NOT BETWEEN </font><font style="vertical-align: inherit;">AND </font><font style="vertical-align: inherit;">IN（</font><font style="vertical-align: inherit;">[，</font><font style="vertical-align: inherit;">] ...）
 </font><font style="vertical-align: inherit;">NOT IN（</font><font style="vertical-align: inherit;">[，</font><font style="vertical-align: inherit;">] ...）
</font></font><em class="replaceable"><code>constant</code></em>
<em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em>
<em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em>
<em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em>
<em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em>
<em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em>
<em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em>
<em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em>
<em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em>
<em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>col_name</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"></font><em class="replaceable"><code>constant</code></em><font style="vertical-align: inherit;"></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								例如，这些语句包含符合直方图使用条件的谓词：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM orders WHERE amount BETWEEN 100.0 AND 300.0;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM tbl WHERE col1 = 15 AND col2&gt; 100;</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								与常量值进行比较的要求包括常量函数，例如
							</font>
						</font><a class="link" href="functions.html#function_abs"><code class="literal">ABS()</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><a class="link" href="functions.html#function_floor"><code class="literal">FLOOR()</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM tbl WHERE col1 &lt;ABS（-34）;
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								直方图统计信息主要用于非索引列。</font>
							<font style="vertical-align: inherit;">向可应用直方图统计信息的列添加索引也可能有助于优化程序进行行估计。</font>
							<font style="vertical-align: inherit;">权衡是：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											修改表数据时必须更新索引。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											直方图仅在需要时创建或更新，因此在修改表数据时不会增加任何开销。</font>
										<font style="vertical-align: inherit;">另一方面，当表修改发生时，统计信息逐渐变得过时，直到下次更新为止。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								优化器优选范围优化器行估计与从直方图统计获得的估计。</font>
							<font style="vertical-align: inherit;">如果优化程序确定范围优化程序适用，则不使用直方图统计信息。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于索引的列，可以使用索引潜水获得行估计以进行相等比较（请参见
							</font>
						</font><a class="xref" href="optimization.html#range-optimization" title="8.2.1.2范围优化">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.2.1.2节“范围优化”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）。</font>
							<font style="vertical-align: inherit;">在这种情况下，直方图统计不一定有用，因为索引潜水可以产生更好的估计。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								在某些情况下，使用直方图统计信息可能无法改善查询执行（例如，如果统计信息已过期）。</font>
							<font style="vertical-align: inherit;">要检查是否是这种情况，请使用</font>
						</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">重新生成直方图统计信息，然后再次运行查询。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								或者，要禁用直方图统计信息，请使用
							</font>
						</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">删除它们。</font>
							<font style="vertical-align: inherit;">禁用直方图统计信息的另一种方法是关闭</font>
							<font style="vertical-align: inherit;">系统变量</font>
							<font style="vertical-align: inherit;">的</font>
						</font><code class="literal">condition_fanout_filter</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">标志
							</font>
						</font><a class="link" href="server-administration.html#sysvar_optimizer_switch"><code class="literal">optimizer_switch</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">（尽管这可能会禁用其他优化）：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET optimizer_switch ='condition_fanout_filter = off';
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果使用直方图统计，则使用可以看到生成的效果</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">请考虑以下查询，其中没有可用于列的索引
							</font>
						</font><code class="literal">col1</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM t1 WHERE col1 &lt;24;
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果直方图统计信息表明57％的行
							</font>
						</font><code class="literal">t1</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">满足</font>
						</font><code class="literal">col1 &lt;
							24</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">谓词，即使没有索引也可以进行过滤，并且</font>
						</font><a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN语法"><code class="literal">EXPLAIN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在</font>
						</font><code class="literal">filtered</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">列中</font>
							<font style="vertical-align: inherit;">显示57.00 </font>
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="buffering-caching"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.10缓冲和缓存</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#innodb-buffer-pool-optimization">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.10.1 InnoDB缓冲池优化</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#myisam-key-cache">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.10.2 MyISAM密钥缓存</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#statement-caching">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.10.3准备好的声明和存储程序的缓存</font>
									</font>
								</a></span></dt></dl>
				</div>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							MySQL使用几种策略来缓存内存缓冲区中的信息以提高性能。
						</font>
					</font>
				</p>
				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="innodb-buffer-pool-optimization"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.10.1 InnoDB缓冲池优化</font>
									</font>
								</h3>
							</div>
						</div>
					</div>
					<a class="indexterm" name="idm140091702993776"></a><a class="indexterm" name="idm140091702992704"></a><a class="indexterm"
					 name="idm140091702991632"></a>
					<p>
						<a class="link" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎"><code class="literal">InnoDB</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">维护一个称为</font>
						</font><a class="link" href="glossary.html#glos_buffer_pool" title="缓冲池">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">缓冲池</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">的存储区域，</font>
							<font style="vertical-align: inherit;">
								用于缓存内存中的数据和索引。</font>
							<font style="vertical-align: inherit;">知道</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">缓冲池</font>
							<font style="vertical-align: inherit;">如何
							</font>
							<font style="vertical-align: inherit;">工作，并利用它来将频繁访问的数据保存在内存中，是MySQL调优的一个重要方面。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								有关</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">缓冲池</font>
							<font style="vertical-align: inherit;">内部工作原理的说明，
							</font>
							<font style="vertical-align: inherit;">LRU替换算法的概述以及常规配置信息，请参见</font>
						</font><a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool" title="15.5.1缓冲池">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第15.5.1节“缓冲池”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								有关其他</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">缓冲池配置和调整信息，请参阅以下部分：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="15.8.3.4配置InnoDB缓冲池预取（预读）">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.3.4节“配置InnoDB缓冲池预取（预读）”</font>
										</font>
									</a>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="15.8.3.5配置InnoDB缓冲池刷新">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.3.5节“配置InnoDB缓冲池刷新”</font>
										</font>
									</a>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="xref" href="innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="15.8.3.3使缓冲池抗扫描">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.3.3节“使缓冲池扫描抗性”</font>
										</font>
									</a>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="xref" href="innodb-storage-engine.html#innodb-multiple-buffer-pools" title="15.8.3.2配置多个缓冲池实例">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.3.2节“配置多个缓冲池实例”</font>
										</font>
									</a>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="xref" href="innodb-storage-engine.html#innodb-preload-buffer-pool" title="15.8.3.7保存和恢复缓冲池状态">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.3.7节“保存和恢复缓冲池状态”</font>
										</font>
									</a>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="xref" href="innodb-storage-engine.html#innodb-lru-background-flushing" title="15.8.3.6微调InnoDB缓冲池刷新">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.3.6节“微调InnoDB缓冲池刷新”</font>
										</font>
									</a>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-resize" title="15.8.3.1配置InnoDB缓冲池大小">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第15.8.3.1节“配置InnoDB缓冲池大小”</font>
										</font>
									</a>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="myisam-key-cache"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.10.2 MyISAM密钥缓存</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<div class="toc">
						<dl class="toc"><dt><span class="section"><a href="optimization.html#shared-key-cache">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.1共享密钥缓存访问</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#multiple-key-caches">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.2多个密钥缓存</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#midpoint-insertion">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.3中点插入策略</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#index-preloading">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.4索引预加载</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#key-cache-block-size">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.5密钥缓存块大小</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#key-cache-restructuring">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.6重构密钥缓存</font>
										</font>
									</a></span></dt></dl>
					</div>
					<a class="indexterm" name="idm140091702971760"></a><a class="indexterm" name="idm140091702970688"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								为了最小化磁盘I / O，</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">存储引擎利用许多数据库管理系统使用的策略。</font>
							<font style="vertical-align: inherit;">它采用缓存机制将最常访问的表块保存在内存中：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于索引块，</font>
										<font style="vertical-align: inherit;">维护</font>
										<font style="vertical-align: inherit;">称为</font>
									</font><span class="firstterm">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">密钥缓存</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">（或
										</font>
									</font><span class="firstterm">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">密钥缓冲区</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）</font>
										<font style="vertical-align: inherit;">的特殊结构
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">该结构包含许多块缓冲区，其中放置了最常用的索引块。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于数据块，MySQL不使用特殊缓存。</font>
										<font style="vertical-align: inherit;">相反，它依赖于本机操作系统文件系统缓存。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								本节首先介绍</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">密钥缓存</font>
							<font style="vertical-align: inherit;">的基本操作
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">然后讨论了可以提高密钥缓存性能并使您能够更好地控制缓存操作的功能：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											多个会话可以同时访问缓存。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您可以设置多个密​​钥缓存并将表索引分配给特定缓存。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要控制密钥缓存的大小，请使用
							</font>
						</font><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量。</font>
							<font style="vertical-align: inherit;">如果此变量设置为零，则不使用密钥缓存。</font>
							<font style="vertical-align: inherit;">如果</font>
						</font><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值太小而不能分配最小数量的块缓冲区，</font>
							<font style="vertical-align: inherit;">则不使用密钥缓存
							</font>
							<font style="vertical-align: inherit;">（8）。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								当密钥缓存不可操作时，仅使用操作系统提供的本机文件系统缓冲来访问索引文件。</font>
							<font style="vertical-align: inherit;">（换句话说，使用与表数据块相同的策略访问表索引块。）
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								索引块是对</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">索引文件</font>
							<font style="vertical-align: inherit;">的连续访问单元
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">通常，索引块的大小等于索引B树的节点大小。</font>
							<font style="vertical-align: inherit;">（索引在磁盘上使用B树数据结构表示。树底部的节点是叶节点。叶节点上方的节点是非叶节点。）
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								密钥缓存结构中的所有块缓冲区大小相同。</font>
							<font style="vertical-align: inherit;">该大小可以等于，大于或小于表索引块的大小。</font>
							<font style="vertical-align: inherit;">通常这两个值中的一个是另一个的倍数。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								当必须访问来自任何表索引块的数据时，服务器首先检查它是否在密钥缓存的某个块缓冲区中可用。</font>
							<font style="vertical-align: inherit;">如果是，则服务器访问密钥缓存中的数据而不是磁盘上的数据。</font>
							<font style="vertical-align: inherit;">也就是说，它从缓存读取或写入其中而不是读取或写入磁盘。</font>
							<font style="vertical-align: inherit;">否则，服务器选择包含不同表索引块（或块）的高速缓存块缓冲区，并用必需的表索引块的副本替换那里的数据。</font>
							<font style="vertical-align: inherit;">只要新索引块位于缓存中，就可以访问索引数据。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果发生了选择替换的块已被修改，则该块被认为是</font>
						</font><span class="quote">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">“ </font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">脏的”。</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">“</font>
							</font>
						</span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在这种情况下，在被替换之前，其内容被刷新到它所来自的表索引。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								通常服务器遵循</font>
						</font><span class="firstterm">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">LRU（最近最少使用）</font>
							</font>
						</span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">策略：当选择要替换的块时，它选择最近最少使用的索引块。</font>
							<font style="vertical-align: inherit;">为了使这个选择更容易，密钥缓存模块将所有使用的块维护在</font>
							<font style="vertical-align: inherit;">按使用时间排序</font>
							<font style="vertical-align: inherit;">的特殊列表（</font>
						</font><span class="firstterm">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">LRU链</font>
							</font>
						</span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）中。</font>
							<font style="vertical-align: inherit;">访问块时，它是最近使用的块，位于列表的末尾。</font>
							<font style="vertical-align: inherit;">当需要替换块时，列表开头的块是最近最少使用的块，并成为第一个驱逐的候选块。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">存储引擎还采用LRU算法来管理它的缓冲池。</font>
							<font style="vertical-align: inherit;">请参见
							</font>
						</font><a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool" title="15.5.1缓冲池">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第15.5.1节“缓冲池”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<div class="section">

						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="shared-key-cache"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.1共享密钥缓存访问</font>
										</font>
									</h4>
								</div>
							</div>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									线程可以同时访问密钥缓存缓冲区，但要符合以下条件：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												多个会话可以访问未更新的缓冲区。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												正在更新的缓冲区会导致需要使用它的会话等待更新完成。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												多个会话可以发起导致高速缓存块替换的请求，只要它们不相互干扰（即，只要它们需要不同的索引块，从而导致不同的高速缓存块被替换）。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对密钥缓存的共享访问使服务器能够显着提高吞吐量。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="multiple-key-caches"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.2多个密钥缓存</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
							<div class="admon-title">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										注意
									</font>
								</font>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										从MySQL 8.0开始，这里讨论的用于引用多个</font>
								</font><code class="literal">MyISAM</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">密钥缓存</font>
									<font style="vertical-align: inherit;">的复合部分结构变量语法</font>
									<font style="vertical-align: inherit;">已被弃用。
									</font>
								</font>
							</p>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对密钥缓存的共享访问可提高性能，但不会完全消除会话之间的争用。</font>
								<font style="vertical-align: inherit;">他们仍在竞争管理密钥缓存缓冲区访问的控制结构。</font>
								<font style="vertical-align: inherit;">为了进一步减少密钥缓存访问争用，MySQL还提供了多个密钥缓存。</font>
								<font style="vertical-align: inherit;">此功能使您可以将不同的表索引分配给不同的密钥缓存。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在存在多个密钥缓存的情况下，服务器必须知道在处理给定</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表的</font>
								<font style="vertical-align: inherit;">查询时要使用哪个缓存
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">默认情况下，所有
								</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表索引都缓存在默认密钥缓存中。</font>
								<font style="vertical-align: inherit;">要将表索引分配给特定的密钥缓存，请使用该</font>
							</font><a class="link" href="sql-syntax.html#cache-index" title="13.7.7.2 CACHE INDEX语法"><code class="literal">CACHE
									INDEX</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									语句（请参见</font>
							</font><a class="xref" href="sql-syntax.html#cache-index" title="13.7.7.2 CACHE INDEX语法">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第13.7.7.2节“CACHE INDEX语法”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。</font>
								<font style="vertical-align: inherit;">例如，下面的语句从表中分配指标
								</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">以及
								</font>
							</font><code class="literal">t3</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">名为键缓存
								</font>
							</font><code class="literal">hot_cache</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>CACHE INDEX t1, t2, t3 IN hot_cache;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------------- + ---------- + ------- --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">表| </font><font style="vertical-align: inherit;">Op | </font><font style="vertical-align: inherit;">Msg_type | </font><font style="vertical-align: inherit;">Msg_text |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------------- + ---------- + ------- --- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.t1 | </font><font style="vertical-align: inherit;">assign_to_keycache | </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.t2 | </font><font style="vertical-align: inherit;">assign_to_keycache | </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.t3 | </font><font style="vertical-align: inherit;">assign_to_keycache | </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------------- + ---------- + ------- --- +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#cache-index" title="13.7.7.2 CACHE INDEX语法"><code
								 class="literal">CACHE
									INDEX</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">可以</font>
							</font><a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1变量赋值的SET语法"><code class="literal">SET
									GLOBAL</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">通过使用参数设置语句或使用服务器启动选项</font>
								<font style="vertical-align: inherit;">设置其大小来创建语句中</font>
								<font style="vertical-align: inherit;">
									引用的键高速缓存</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">例如：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET GLOBAL keycache1.key_buffer_size=128*1024;</code></strong>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要销毁密钥缓存，请将其大小设置为零：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET GLOBAL keycache1.key_buffer_size=0;</code></strong>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									您无法销毁默认密钥缓存。</font>
								<font style="vertical-align: inherit;">任何尝试这样做都会被忽略：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET GLOBAL key_buffer_size = 0;</code></strong><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW VARIABLES LIKE 'key_buffer_size';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Variable_name | </font><font style="vertical-align: inherit;">价值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">key_buffer_size | </font><font style="vertical-align: inherit;">8384512 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------- + --------- +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									密钥缓存变量是具有名称和组件的结构化系统变量。</font>
								<font style="vertical-align: inherit;">For
								</font>
							</font><code class="literal">keycache1.key_buffer_size</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">keycache1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是缓存变量名称，
								</font>
							</font><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是缓存组件。</font>
								<font style="vertical-align: inherit;">有关</font>
								<font style="vertical-align: inherit;">用于引用结构化密钥缓存系统变量的语法的说明，</font>
								<font style="vertical-align: inherit;">请参见</font>
							</font><a class="xref" href="server-administration.html#structured-system-variables" title="5.1.9.5结构化系统变量">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第5.1.9.5节“结构化系统变量”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									默认情况下，表索引分配给在服务器启动时创建的主（默认）密钥缓存。</font>
								<font style="vertical-align: inherit;">销毁密钥缓存时，分配给它的所有索引都将重新分配给默认密钥缓存。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于繁忙的服务器，您可以使用涉及三个密钥缓存的策略：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												一个</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">“ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">热</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;"> ”</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">键高速占用分配给所有键高速缓冲空间的20％。</font>
											<font style="vertical-align: inherit;">对于大量用于搜索但未更新的表使用此选项。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												一个</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">“ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">冷</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;"> ”</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">键高速占用分配给所有键高速缓冲空间的20％。</font>
											<font style="vertical-align: inherit;">将此缓存用于中型，密集修改的表，例如临时表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												一个</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">“ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">温暖</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;"> ”</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">键高速占用键高速缓冲空间的60％。</font>
											<font style="vertical-align: inherit;">将此作为默认密钥缓存，默认情况下用于所有其他表。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用三个密钥高速缓存有益的一个原因是对一个密钥高速缓存结构的访问不会阻止对其他密钥高速缓存的访问。</font>
								<font style="vertical-align: inherit;">访问分配给一个缓存的表的语句不会与访问分配给另一个缓存的表的语句竞争。</font>
								<font style="vertical-align: inherit;">性能提升也出于其他原因：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												热缓存仅用于检索查询，因此永远不会修改其内容。</font>
											<font style="vertical-align: inherit;">因此，每当需要从磁盘引入索引块时，不需要首先刷新选择用于替换的高速缓存块的内容。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于分配给热缓存的索引，如果不存在需要索引扫描的查询，则对应于索引B树的非叶节点的索引块很可能保留在缓存中。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当更新的节点在高速缓存中并且不需要首先从磁盘读取时，对于临时表最频繁执行的更新操作执行得更快。</font>
											<font style="vertical-align: inherit;">如果临时表的索引的大小与冷键高速缓存的大小相当，则更新的节点在高速缓存中的概率非常高。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><a class="link" href="sql-syntax.html#cache-index" title="13.7.7.2 CACHE INDEX语法"><code class="literal">CACHE
									INDEX</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句在表和密钥缓存之间建立关联，但每次服务器重新启动时关联都会丢失。</font>
								<font style="vertical-align: inherit;">如果希望关联在每次服务器启动时生效，则实现此目的的一种方法是使用选项文件：包括配置密钥缓存的变量设置，以及</font>
							</font><code class="literal">init-file</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">命名包含</font>
							</font><a class="link" href="sql-syntax.html#cache-index" title="13.7.7.2 CACHE INDEX语法"><code class="literal">CACHE
									INDEX</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要执行的语句</font>
								<font style="vertical-align: inherit;">的文件</font>
								<font style="vertical-align: inherit;">的
								</font>
								<font style="vertical-align: inherit;">选项</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">例如：
								</font>
							</font>
						</p>
						<pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">key_buffer_size = 4G</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
hot_cache.key_buffer_size = 2G</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cold_cache.key_buffer_size = 2G</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
init_file = / </font></font><em class="replaceable"><code>path</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><em class="replaceable"><code>to</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><em class="replaceable"><code>data-directory</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld_init.sql
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;"></font><code class="filename">mysqld_init.sql</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">每次服务器启动时都会执行</font>
								<font style="vertical-align: inherit;">
									语句</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">该文件每行应包含一个SQL语句。</font>
								<font style="vertical-align: inherit;">以下示例分别为</font>
							</font><code class="literal">hot_cache</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
								<font style="vertical-align: inherit;">分配了几个表</font>
							</font><code class="literal">cold_cache</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CACHE INDEX db1.t1，db1.t2，db2.t3在hot_cache中</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CACHE INDEX db1.t4，db2.t5，db2.t6在cold_cache中</font></font><font></font>
</pre>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="midpoint-insertion"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.3中点插入策略</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									默认情况下，密钥缓存管理系统使用简单的LRU策略来选择要驱逐的密钥缓存块，但它还支持称为</font><span class="firstterm">
									<font style="vertical-align: inherit;">中点插入策略</font>
								</span>
								<font style="vertical-align: inherit;">的更复杂的方法
								</font>
							</font><span class="firstterm">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
								</font>
							</span>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用中点插入策略时，LRU链分为两部分：热子列表和暖子列表。</font>
								<font style="vertical-align: inherit;">两部分之间的分割点并不固定，但是密钥缓存管理系统注意到热部分不是
								</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">太短</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”，</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">总是包含至少
								</font>
							</font><a class="link" href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									百分比的密钥缓存块。
								</font>
							</font><a class="link" href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是结构化键缓存变量的一个组件，因此它的值是可以为每个缓存设置的参数。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当索引块从表中读入密钥缓存时，它将放在暖子列表的末尾。</font>
								<font style="vertical-align: inherit;">在一定数量的命中（访问块）之后，它被提升到热子列表。</font>
								<font style="vertical-align: inherit;">目前，促进块（3）所需的命中数对于所有索引块是相同的。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									升级到热子列表的块放在列表的末尾。</font>
								<font style="vertical-align: inherit;">然后该块在该子列表中循环。</font>
								<font style="vertical-align: inherit;">如果块在子列表的开头停留足够长的时间，则将其降级为暖子列表。</font>
								<font style="vertical-align: inherit;">此时间由</font>
							</font><a class="link" href="server-administration.html#sysvar_key_cache_age_threshold"><code class="literal">key_cache_age_threshold</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									密钥缓存</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">组件</font>
								<font style="vertical-align: inherit;">的值确定
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									阈值规定，对于包含</font>
							</font><em class="replaceable"><code>N</code></em>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">块</font>
								<font style="vertical-align: inherit;">的密钥缓存</font>
								<font style="vertical-align: inherit;">，在最后一次</font>
							</font><code class="literal"><em class="replaceable"><code>N</code></em> *
								key_cache_age_threshold / 100</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">命中</font>
								<font style="vertical-align: inherit;">内未访问的热子列表开头的块
								</font>
								<font style="vertical-align: inherit;">将被移动到暖子列表的开头。</font>
								<font style="vertical-align: inherit;">然后它成为第一个被驱逐的候选者，因为替换的块总是从暖子列表的开头获取。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									中点插入策略使您可以将更多值的块始终保留在缓存中。</font>
								<font style="vertical-align: inherit;">如果您更喜欢使用普通LRU策略，请将
								</font>
							</font><a class="link" href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									值设置为默认值100。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当需要索引扫描的查询的执行有效地将对应于有价值的高级B树节点的所有索引块推出缓存时，中点插入策略有助于提高性能。</font>
								<font style="vertical-align: inherit;">为避免这种情况，您必须使用中点插入策略，其
								</font>
							</font><a class="link" href="server-administration.html#sysvar_key_cache_division_limit"><code class="literal">key_cache_division_limit</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">设置远小于100.然后，在索引扫描操作期间，有价值的频繁命中节点也会保留在热子列表中。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="index-preloading"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.4索引预加载</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果密钥缓存中有足够的块来保存整个索引的块，或者至少是与其非叶节点对应的块，则在开始使用之前使用索引块预加载密钥缓存是有意义的。</font>
								<font style="vertical-align: inherit;">预加载使您能够以最有效的方式将表索引块放入密钥缓存缓冲区：通过顺序从磁盘读取索引块。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在没有预加载的情况下，块仍然根据查询的需要放入密钥缓存中。</font>
								<font style="vertical-align: inherit;">虽然这些块将保留在缓存中，因为所有缓冲区都有足够的缓冲区，它们是以随机顺序从磁盘中提取的，而不是按顺序提取的。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要将索引预加载到缓存中，请使用该
								</font>
							</font><a class="link" href="sql-syntax.html#load-index" title="13.7.7.5 LOAD INDEX INTO CACHE语法"><code class="literal">LOAD
									INDEX INTO
									CACHE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句。</font>
								<font style="vertical-align: inherit;">例如，以下语句预加载表的索引的节点（索引块），</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">并且</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>LOAD INDEX INTO CACHE t1, t2 IGNORE LEAVES;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">表| </font><font style="vertical-align: inherit;">Op | </font><font style="vertical-align: inherit;">Msg_type | </font><font style="vertical-align: inherit;">Msg_text |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------- + ---------- + ---------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.t1 | </font><font style="vertical-align: inherit;">preload_keys | </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">test.t2 | </font><font style="vertical-align: inherit;">preload_keys | </font><font style="vertical-align: inherit;">状态| </font><font style="vertical-align: inherit;">好的</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + -------------- + ---------- + ---------- +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									所述</font>
							</font><code class="literal">IGNORE LEAVES</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">改性剂导致要预装只为索引的非叶结点的块。</font>
								<font style="vertical-align: inherit;">因此，显示的语句预加载所有索引块</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，但仅从非叶节点</font>
								<font style="vertical-align: inherit;">预加载
								</font>
							</font><code class="literal">t2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果已使用</font>
							</font><a class="link" href="sql-syntax.html#cache-index" title="13.7.7.2 CACHE INDEX语法"><code class="literal">CACHE
									INDEX</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句将索引</font>
								<font style="vertical-align: inherit;">分配给键高速缓存
								</font>
								<font style="vertical-align: inherit;">，则预加载会将索引块放入该高速缓存中。</font>
								<font style="vertical-align: inherit;">否则，索引将加载到默认密钥缓存中。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="key-cache-block-size"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.5密钥缓存块大小</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									可以使用</font>
							</font><a class="link" href="server-administration.html#sysvar_key_cache_block_size"><code class="literal">key_cache_block_size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									变量</font>
								<font style="vertical-align: inherit;">为单个密钥缓存指定块缓冲区的大小
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">这允许调整索引文件的I / O操作的性能。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当读取缓冲区的大小等于本机操作系统I / O缓冲区的大小时，可以实现I / O操作的最佳性能。</font>
								<font style="vertical-align: inherit;">但是，将关键节点的大小设置为等于I / O缓冲区的大小并不总能确保最佳的整体性能。</font>
								<font style="vertical-align: inherit;">在读取大叶子节点时，服务器会吸入大量不必要的数据，有效地阻止了读取其他叶子节点。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要控制</font>
								<font style="vertical-align: inherit;">表</font>
								<font style="vertical-align: inherit;">的</font>
							</font><code class="filename">.MYI</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									索引文件</font>
								<font style="vertical-align: inherit;">中块的大小</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，请使用</font>
							</font><a class="link" href="server-administration.html#option_mysqld_myisam-block-size"><code class="option">--myisam-block-size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">服务器启动时</font>
								<font style="vertical-align: inherit;">的
								</font>
								<font style="vertical-align: inherit;">选项。
								</font>
							</font>
						</p>
					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="key-cache-restructuring"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.10.2.6重构密钥缓存</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									可以通过更新其参数值随时重新构建密钥缓存。</font>
								<font style="vertical-align: inherit;">例如：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SET GLOBAL cold_cache.key_buffer_size=4*1024*1024;</code></strong>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果为</font>
							</font><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或
								</font>
							</font><a class="link" href="server-administration.html#sysvar_key_cache_block_size"><code class="literal">key_cache_block_size</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">缓存组件</font>
								<font style="vertical-align: inherit;">分配
								</font>
								<font style="vertical-align: inherit;">的值与组件的当前值不同，则服务器会销毁缓存的旧结构，并根据新值创建新结构。</font>
								<font style="vertical-align: inherit;">如果缓存包含任何脏块，则服务器会在销毁和重新创建缓存之前将它们保存到磁盘。</font>
								<font style="vertical-align: inherit;">如果更改其他键缓存参数，则不会进行重组。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									重构密钥缓存时，服务器首先将任何脏缓冲区的内容刷新到磁盘。</font>
								<font style="vertical-align: inherit;">之后，缓存内容变得不可用。</font>
								<font style="vertical-align: inherit;">但是，重组不会阻止需要使用分配给缓存的索引的查询。</font>
								<font style="vertical-align: inherit;">相反，服务器使用本机文件系统缓存直接访问表索引。</font>
								<font style="vertical-align: inherit;">文件系统缓存不如使用密钥缓存有效，因此尽管执行查询，但可以预期减速。</font>
								<font style="vertical-align: inherit;">重新构建缓存后，它再次可用于缓存分配给它的索引，并且停止使用索引的文件系统缓存。
								</font>
							</font>
						</p>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="statement-caching"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.10.3准备好的声明和存储程序的缓存</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091702851008"></a><a class="indexterm" name="idm140091702849552"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于客户端可能在会话期间多次执行的某些语句，服务器会将语句转换为内部结构并缓存要在执行期间使用的结构。</font>
							<font style="vertical-align: inherit;">缓存使服务器能够更有效地执行，因为它可以避免在会话期间再次需要时重新转换语句的开销。</font>
							<font style="vertical-align: inherit;">这些语句发生转换和缓存：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											准备好的语句，包括在SQL级别（使用</font>
									</font><a class="link" href="sql-syntax.html#prepare" title="13.5.1 PREPARE语法"><code class="literal">PREPARE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句）处理</font>
										<font style="vertical-align: inherit;">的</font>
										<font style="vertical-align: inherit;">语句和使用二进制客户端/服务器协议（使用</font>
									</font><a class="link" href="connectors-apis.html#mysql-stmt-prepare" title="28.7.11.21 mysql_stmt_prepare（）"><code
										 class="literal">mysql_stmt_prepare()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">C API函数）</font>
										<font style="vertical-align: inherit;">处理</font>
										<font style="vertical-align: inherit;">的</font>
										<font style="vertical-align: inherit;">语句
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">所述
										</font>
									</font><a class="link" href="server-administration.html#sysvar_max_prepared_stmt_count"><code class="literal">max_prepared_stmt_count</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											系统变量控制语句的服务器高速缓存的总数量。</font>
										<font style="vertical-align: inherit;">（所有会话中准备好的语句总数。）
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											存储的程序（存储过程和函数，触发器和事件）。</font>
										<font style="vertical-align: inherit;">在这种情况下，服务器转换并缓存整个程序体。</font>
										<font style="vertical-align: inherit;">该
										</font>
									</font><a class="link" href="server-administration.html#sysvar_stored_program_cache"><code class="literal">stored_program_cache</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">系统变量指示存储的程序每个会话的服务器缓存的大致数量。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								服务器基于每个会话维护预准备语句和存储程序的高速缓存。</font>
							<font style="vertical-align: inherit;">其他会话无法访问为一个会话缓存的语句。</font>
							<font style="vertical-align: inherit;">会话结束时，服务器会丢弃为其缓存的任何语句。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								当服务器使用缓存的内部语句结构时，必须注意结构不会过时。</font>
							<font style="vertical-align: inherit;">对于语句使用的对象，可能会发生元数据更改，从而导致当前对象定义与内部语句结构中表示的定义不匹配。</font>
							<font style="vertical-align: inherit;">DDL语句（例如创建，删除，更改，重命名或截断表，或分析，优化或修复表）的元数据发生更改。</font>
							<font style="vertical-align: inherit;">表内容更改（例如，使用</font>
						</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">或
							</font>
						</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">）不更改元数据，也不更改</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下是该问题的说明。</font>
							<font style="vertical-align: inherit;">假设客户准备此声明：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PREPARE s1 FROM'SELECT * FROM t1';
</font></font></pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								将</font>
						</font><code class="literal">SELECT *</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">内部结构扩展为表中列的列表。</font>
							<font style="vertical-align: inherit;">如果修改了表中的列集，则</font>
						</font><code class="literal">ALTER
							TABLE</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">预准备语句将过期。</font>
							<font style="vertical-align: inherit;">如果服务器在下次客户端执行时未检测到此更改</font>
						</font><code class="literal">s1</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，则预准备语句将返回不正确的结果。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								为避免由预准备语句引用的表或视图的元数据更改导致的问题，服务器会检测这些更改并在下次执行时自动重新表示该语句。</font>
							<font style="vertical-align: inherit;">也就是说，服务器重新声明语句并重建内部结构。</font>
							<font style="vertical-align: inherit;">在从表定义高速缓存中刷新引用的表或视图之后，也会发生重新分析，或者隐式地为缓存中的新条目腾出空间，或者显式由于</font>
						</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH
								TABLES</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								同样，如果存储程序使用的对象发生更改，则服务器会重新编译程序中受影响的语句。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								服务器还检测表达式中对象的元数据更改。</font>
							<font style="vertical-align: inherit;">这些可能会在特定的存储方案，如语句中使用</font>
						</font><code class="literal">DECLARE CURSOR</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">或流量控制语句，如
							</font>
						</font><a class="link" href="sql-syntax.html#if" title="13.6.5.2 IF语法"><code class="literal">IF</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，
							</font>
						</font><a class="link" href="sql-syntax.html#case" title="13.6.5.1 CASE语法"><code class="literal">CASE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">和
							</font>
						</font><a class="link" href="sql-syntax.html#return" title="13.6.5.7 RETURN语法"><code class="literal">RETURN</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								为了避免重新解析整个存储的程序，服务器仅在需要时对程序中的受影响的语句或表达式进行重新分析。</font>
							<font style="vertical-align: inherit;">例子：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											假设更改了表或视图的元数据。</font>
										<font style="vertical-align: inherit;">重新解析为一个发生</font>
									</font><code class="literal">SELECT *</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">访问的表或视图的程序中，但不是一个
										</font>
									</font><code class="literal">SELECT *</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">不访问该表或视图。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当语句受到影响时，如果可能，服务器仅对其进行部分重新分析。</font>
										<font style="vertical-align: inherit;">请考虑以下
										</font>
									</font><a class="link" href="sql-syntax.html#case" title="13.6.5.1 CASE语法"><code class="literal">CASE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">声明：
										</font>
									</font>
								</p>
								<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情况</font></font><em class="replaceable"><code>case_expr</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  什么时候</font></font><em class="replaceable"><code>when_expr1</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  什么时候</font></font><em class="replaceable"><code>when_expr2</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  什么时候</font></font><em class="replaceable"><code>when_expr3</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结束案例</font></font><font></font>
</pre>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果元数据更改仅影响</font>
										<font style="vertical-align: inherit;">，则会重新解析该表达式。</font>
										<font style="vertical-align: inherit;">
											并且其他</font>
										<font style="vertical-align: inherit;">表达式没有被重新解析。
										</font>
									</font><code class="literal">WHEN
										<em class="replaceable"><code>when_expr3</code></em></code>
									<font style="vertical-align: inherit;"></font><em class="replaceable"><code>case_expr</code></em>
									<font style="vertical-align: inherit;"></font><code class="literal">WHEN</code>
									<font style="vertical-align: inherit;"></font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								重新分析使用对原始转换为内部表单有效的默认数据库和SQL模式。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								服务器尝试最多重新解析三次。</font>
							<font style="vertical-align: inherit;">如果所有尝试都失败，则会发生错误
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								重新分析是自动的，但在发生这种情况时，会减少准备好的语句和存储的程序性能。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于</font>
						</font><a class="link" href="server-administration.html#statvar_Com_xxx"><code class="literal">Com_stmt_reprepare</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								预</font>
							<font style="vertical-align: inherit;">准备语句，
							</font>
							<font style="vertical-align: inherit;">状态变量跟踪重新表示的数量。
							</font>
						</font>
					</p>
				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="locking-issues"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.11优化锁定操作</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#internal-locking">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.11.1内部锁定方法</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#table-locking">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.11.2表锁定问题</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#concurrent-inserts">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.11.3并发插入</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#metadata-locking">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.11.4元数据锁定</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#external-locking">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.11.5外部锁定</font>
									</font>
								</a></span></dt></dl>
				</div>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							MySQL使用</font>
					</font><a class="link" href="glossary.html#glos_locking" title="锁定">
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">锁定来</font>
						</font>
					</a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">管理对表内容的争用
						</font>
						<font style="vertical-align: inherit;">：
						</font>
					</font>
				</p>
				<div class="itemizedlist">
					<ul class="itemizedlist" style="list-style-type: disc; ">
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										内部锁定在MySQL服务器本身内执行，以管理多个线程对表内容的争用。</font>
									<font style="vertical-align: inherit;">这种类型的锁定是内部的，因为它完全由服务器执行，不涉及其他程序。</font>
									<font style="vertical-align: inherit;">请参见
									</font>
								</font><a class="xref" href="optimization.html#internal-locking" title="8.11.1内部锁定方法">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.11.1节“内部锁定方法”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</li>
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										当服务器和其他程序锁定</font>
								</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表文件以在它们之间进行协调</font>
									<font style="vertical-align: inherit;">时，会发生外部锁定</font>
									<font style="vertical-align: inherit;">，哪个程序可以访问这些表。</font>
									<font style="vertical-align: inherit;">请参见</font>
								</font><a class="xref" href="optimization.html#external-locking" title="8.11.5外部锁定">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.11.5节“外部锁定”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</li>
					</ul>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="internal-locking"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.11.1内部锁定方法</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091702798112"></a><a class="indexterm" name="idm140091702797072"></a><a class="indexterm"
					 name="idm140091702795584"></a><a class="indexterm" name="idm140091702794512"></a><a class="indexterm" name="idm140091702793024"></a><a
					 class="indexterm" name="idm140091702791952"></a><a class="indexterm" name="idm140091702790880"></a><a class="indexterm"
					 name="idm140091702789392"></a><a class="indexterm" name="idm140091702787904"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								本节讨论内部锁定; </font>
							<font style="vertical-align: inherit;">也就是说，在MySQL服务器本身内执行锁定以管理多个会话对表内容的争用。</font>
							<font style="vertical-align: inherit;">这种类型的锁定是内部的，因为它完全由服务器执行，不涉及其他程序。</font>
							<font style="vertical-align: inherit;">有关其他程序对MySQL文件执行的锁定，请参见</font>
						</font><a class="xref" href="optimization.html#external-locking" title="8.11.5外部锁定">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第8.11.5节“外部锁定”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p><a class="xref" href="optimization.html#internal-row-level-locking" title="行级锁定">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">行级锁定</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#internal-table-level-locking" title="表级锁定">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表级锁定</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#internal-locking-choices" title="选择锁定类型">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">选择锁定类型</font>
										</font>
									</a></p>
							</li>
						</ul>
					</div>

					<div class="simplesect">

						<div class="titlepage">
							<div>

								<div class="simple">
									<h4 class="title"><a name="internal-row-level-locking"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">行级锁定</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL </font>
								<font style="vertical-align: inherit;">对</font>
								<font style="vertical-align: inherit;">表</font>
								<font style="vertical-align: inherit;">使用</font>
							</font><a class="link" href="glossary.html#glos_row_lock" title="行锁">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">行级锁定</font>
								</font>
							</a>
							<font style="vertical-align: inherit;"></font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">以支持多个会话的同时写访问，使其适用于多用户，高度并发和OLTP应用程序。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									为了避免</font>
								<font style="vertical-align: inherit;">在单个</font>
								<font style="vertical-align: inherit;">表</font>
								<font style="vertical-align: inherit;">上执行多个并发写操作时出现</font>
							</font><a class="link" href="glossary.html#glos_deadlock" title="僵局">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">死锁</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">通过</font>
							</font><code class="literal">SELECT ...
								FOR UPDATE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">为每个预期要修改的行组</font>
								<font style="vertical-align: inherit;">发出一个</font>
								<font style="vertical-align: inherit;">语句</font>
								<font style="vertical-align: inherit;">，在事务开始时获取必要的锁</font>
								<font style="vertical-align: inherit;">，即使数据更改语句在事务中稍后出现。</font>
								<font style="vertical-align: inherit;">如果事务修改或锁定多个表，则在每个事务中以相同的顺序发出适用的语句。</font>
								<font style="vertical-align: inherit;">死锁会影响性能而不是表示严重错误，因为
								</font>
								<font style="vertical-align: inherit;">
									默认情况下会</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">自动
								</font>
							</font><a class="link" href="glossary.html#glos_deadlock_detection" title="死锁检测">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">检测</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">死锁条件并回滚其中一个受影响的事务。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在高并发系统上，当许多线程等待同一个锁时，死锁检测会导致速度减慢。</font>
								<font style="vertical-align: inherit;">有时，禁用死锁检测可能更有效，并且在</font>
							</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									发生死锁时</font>
								<font style="vertical-align: inherit;">依赖于</font>
								<font style="vertical-align: inherit;">事务回滚</font>
								<font style="vertical-align: inherit;">的
								</font>
								<font style="vertical-align: inherit;">设置。</font>
								<font style="vertical-align: inherit;">可以使用</font>
							</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_deadlock_detect"><code class="literal">innodb_deadlock_detect</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									配置选项</font>
								<font style="vertical-align: inherit;">禁用死锁检测
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									行级锁定的优点：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当不同的会话访问不同的行时，更少的锁冲突。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												回滚的变化较少。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												可以长时间锁定单行。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="internal-table-level-locking"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表级锁定</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL使用</font>
							</font><a class="link" href="glossary.html#glos_table_lock" title="桌锁">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表级锁</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">的</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，
								</font>
							</font><code class="literal">MEMORY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">MERGE</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表，只允许一个会话更新一次这些表。</font>
								<font style="vertical-align: inherit;">此锁定级别使这些存储引擎更适合于只读，大多数读取或单用户应用程序。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这些存储引擎</font>
								<font style="vertical-align: inherit;">通过始终在查询开始时立即请求所有需要的锁并始终以相同的顺序锁定表来</font>
								<font style="vertical-align: inherit;">避免
								</font>
							</font><a class="link" href="glossary.html#glos_deadlock" title="僵局">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">死锁</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">权衡是这种策略降低了并发性; </font>
								<font style="vertical-align: inherit;">其他想要修改表的会话必须等到当前数据更改语句完成。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表级锁定的优点：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												需要相对较少的内存（行锁定需要每行或锁定行组的内存）
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在大部分表上使用时速度很快，因为只涉及一个锁。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果您经常</font>
										</font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对大部分数据</font>
											<font style="vertical-align: inherit;">进行</font>
											<font style="vertical-align: inherit;">操作，或者必须经常扫描整个表，请快速。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL授予表写锁定如下：
								</font>
							</font>
						</p>
						<div class="orderedlist">
							<ol class="orderedlist" type="1">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果表上没有锁，则在其上放置一个写锁。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												否则，将锁定请求放入写锁定队列。
											</font>
										</font>
									</p>
								</li>
							</ol>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL授予表读锁定如下：
								</font>
							</font>
						</p>
						<div class="orderedlist">
							<ol class="orderedlist" type="1">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果表上没有写锁定，则对其进行读锁定。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												否则，将锁定请求放入读锁定队列中。
											</font>
										</font>
									</p>
								</li>
							</ol>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表更新的优先级高于表检索。</font>
								<font style="vertical-align: inherit;">因此，当释放锁定时，锁定对写入锁定队列中的请求可用，然后对读取锁定队列中的请求可用。</font>
								<font style="vertical-align: inherit;">这可确保</font>
								<font style="vertical-align: inherit;">即使</font>
								<font style="vertical-align: inherit;">表格活动</font>
								<font style="vertical-align: inherit;">繁重</font>
								<font style="vertical-align: inherit;">，对表格的</font>
								<font style="vertical-align: inherit;">更新也不会</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">缺乏</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code
								 class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">但是，如果表有很多更新，则
								</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句会等到没有更新更新。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									有关更改读写优先级的信息，请参见</font>
							</font><a class="xref" href="optimization.html#table-locking" title="8.11.2表锁定问题">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.11.2节“表锁定问题”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									您可以通过检查</font>
							</font><a class="link" href="server-administration.html#statvar_Table_locks_immediate"><code class="literal">Table_locks_immediate</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="server-administration.html#statvar_Table_locks_waited"><code class="literal">Table_locks_waited</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">状态变量</font>
								<font style="vertical-align: inherit;">来分析系统上的表锁争用
								</font>
								<font style="vertical-align: inherit;">，这些变量分别指示可以立即授予对表锁的请求的次数和必须等待的次数：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SHOW STATUS LIKE 'Table%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Variable_name | </font><font style="vertical-align: inherit;">价值|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + --------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Table_locks_immediate | </font><font style="vertical-align: inherit;">1151552 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Table_locks_waited | </font><font style="vertical-align: inherit;">15324 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ----------------------- + --------- +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									性能模式锁定表还提供锁定信息。</font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="performance-schema.html#performance-schema-lock-tables" title="26.12.12性能模式锁表">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第26.12.12节“性能模式锁定表”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p><a class="indexterm" name="idm140091702737888"></a><a class="indexterm" name="idm140091702736816"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">存储引擎支持并发插入，减少读者和作者之间的竞争给定表：如果一个</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表有数据文件的中间没有空闲块，行总是在数据文件的末尾插入。</font>
								<font style="vertical-align: inherit;">在这种情况下，您可以自由地混合</font>
								<font style="vertical-align: inherit;">没有锁</font>
								<font style="vertical-align: inherit;">的</font>
								<font style="vertical-align: inherit;">表的</font>
								<font style="vertical-align: inherit;">并发
								</font>
							</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句
								</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">也就是说，您可以将行插入到</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">其他客户正在从中读取表格。</font>
								<font style="vertical-align: inherit;">在表格中间删除或更新的行可能会导致漏洞。</font>
								<font style="vertical-align: inherit;">如果存在漏洞，则会禁用并发插入，但在所有漏洞都填充新数据后会自动再次启用。</font>
								<font style="vertical-align: inherit;">要控制此行为，请使用
								</font>
							</font><a class="link" href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统变量。</font>
								<font style="vertical-align: inherit;">请参见</font>
							</font><a class="xref" href="optimization.html#concurrent-inserts" title="8.11.3并发插入">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.11.3节“并发插入”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果显式获取表锁
								</font>
							</font><a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES和UNLOCK TABLES语法"><code class="literal">LOCK
									TABLES</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，则可以请求
								</font>
							</font><code class="literal">READ LOCAL</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">锁而不是
								</font>
							</font><code class="literal">READ</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">锁，以使其他会话在锁定表时执行并发插入。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									执行许多</font>
							</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">操作上的表
								</font>
							</font><code class="literal">t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">时并发的插入是不可能的，你可以插入行到一个临时表
								</font>
							</font><code class="literal">temp_t1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，并从临时表中的行更新真正的表：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; </font></font><strong class="userinput"><code>LOCK TABLES t1 WRITE, temp_t1 WRITE;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>INSERT INTO t1 SELECT * FROM temp_t1;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt; </font></font><strong class="userinput"><code>DELETE FROM temp_t1;</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mysql&gt;</font></font><strong class="userinput"><code>UNLOCK TABLES;</code></strong>
</pre>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="internal-locking-choices"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">选择锁定类型</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									通常，在以下情况下，表锁优于行级锁：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该表的大多数陈述都是读数。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表的语句是读写的混合，其中写入是单行的更新或删除，可以使用一个键读取：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPDATE </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET </font></font><em class="replaceable"><code>column</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>unique_key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>key_value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DELETE FROM </font></font><em class="replaceable"><code>tbl_name</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE </font></font><em class="replaceable"><code>unique_key_col</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font><em class="replaceable"><code>key_value</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
								</li>
								<li class="listitem">
									<p>
										<a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">结合并发</font>
										</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												语句，很少
											</font>
										</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;"></font><code class="literal">GROUP BY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在没有任何编写器的情况下对整个表进行</font>
											<font style="vertical-align: inherit;">
												多次扫描或</font>
											<font style="vertical-align: inherit;">操作。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用更高级别的锁，您可以通过支持不同类型的锁来更轻松地调整应用程序，因为锁开销小于行级锁。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									行级锁定以外的选项：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												版本控制（例如MySQL中用于并发插入的版本控制），其中可以与许多读者同时拥有一个编写器。</font>
											<font style="vertical-align: inherit;">这意味着数据库或表支持数据的不同视图，具体取决于访问何时开始。</font>
											<font style="vertical-align: inherit;">这个其他常见的术语是
											</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">“ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">时间旅行</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font>
										</span> <span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">” “ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">上写副本</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">， ”</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												或</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">“ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">按需复制。</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">”</font>
											</font>
										</span>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在许多情况下，按需复制优于行级锁定。</font>
											<font style="vertical-align: inherit;">但是，在最坏的情况下，它可以使用比使用普通锁更多的内存。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												而不是使用行级锁，你可以使用应用程序级锁，如提供的
											</font>
										</font><a class="link" href="functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="link" href="functions.html#function_release-lock"><code class="literal">RELEASE_LOCK()</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在MySQL。</font>
											<font style="vertical-align: inherit;">这些是咨询锁，因此它们仅适用于彼此协作的应用程序。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="functions.html#locking-functions" title="12.14锁定功能">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第12.14节“锁定功能”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="table-locking"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.11.2表锁定问题</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091702688720"></a>
					<p>
						<code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表使用行级锁定，以便多个会话和应用程序可以同时读取和写入同一个表，而不会使彼此等待或产生不一致的结果。</font>
							<font style="vertical-align: inherit;">对于此存储引擎，请避免使用该</font>
						</font><a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES和UNLOCK TABLES语法"><code class="literal">LOCK
								TABLES</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句，因为它不提供任何额外保护，而是降低并发性。</font>
							<font style="vertical-align: inherit;">自动行级锁定使这些表适用于最繁忙的数据库，包含最重要的数据，同时还简化了应用程序逻辑，因为您不需要锁定和解锁表。</font>
							<font style="vertical-align: inherit;">因此，
							</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">存储引擎是MySQL中的默认引擎。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL对所有存储引擎使用表锁定（而不是页锁，行锁或列锁）
							</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">锁定操作本身没有太多开销。</font>
							<font style="vertical-align: inherit;">但是因为在任何时候只有一个会话可以写入表，为了获得这些其他存储引擎的最佳性能，主要将它们用于经常查询但很少插入或更新的表。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p><a class="xref" href="optimization.html#table-locking-innodb" title="性能考虑因素支持InnoDB">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">性能考虑因素支持InnoDB</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#table-locking-workarounds" title="锁定性能问题的变通方法">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">锁定性能问题的变通方法</font>
										</font>
									</a></p>
							</li>
						</ul>
					</div>

					<div class="simplesect">

						<div class="titlepage">
							<div>

								<div class="simple">
									<h4 class="title"><a name="table-locking-innodb"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">性能考虑因素支持InnoDB</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在选择是使用</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">还是使用其他存储引擎</font>
								<font style="vertical-align: inherit;">创建表时
								</font>
								<font style="vertical-align: inherit;">，请记住表锁定的以下缺点：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表锁定允许多个会话同时从表中读取，但如果会话想要写入表，则必须首先获得独占访问权，这意味着它可能必须等待其他会话首先完成表。</font>
											<font style="vertical-align: inherit;">在更新期间，要访问此特定表的所有其他会话必须等到更新完成。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在会话等待时，表锁定会导致问题，因为磁盘已满并且在会话可以继续之前需要可用空间。</font>
											<font style="vertical-align: inherit;">在这种情况下，所有想要访问问题表的会话也会处于等待状态，直到有更多磁盘空间可用。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												一个</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是需要长时间运行的语句防止其他会话更新表的同时，使其他场次出现缓慢或无响应。</font>
											<font style="vertical-align: inherit;">当会话等待获得对表的独占访问以进行更新时，发出</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句的</font>
											<font style="vertical-align: inherit;">其他会话
											</font>
											<font style="vertical-align: inherit;">将在其后排队，即使对于只读会话也会降低并发性。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="table-locking-workarounds"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">锁定性能问题的变通方法</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下各项描述了避免或减少表锁定引起的争用的一些方法：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												考虑将表切换到
											</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">存储引擎，可以</font>
										</font><code class="literal">CREATE TABLE ... ENGINE=INNODB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在安装期间</font>
											<font style="vertical-align: inherit;">使用，也可以使用
											</font>
										</font><code class="literal">ALTER TABLE ...
											ENGINE=INNODB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">现有表。</font>
											<font style="vertical-align: inherit;">有关</font><a class="xref" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎"><i>
													<font style="vertical-align: inherit;">此存储引擎</font>
												</i></a>
											<font style="vertical-align: inherit;">的更多详细信息</font>
										</font><a class="xref" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font><i>
												<font style="vertical-align: inherit;"></font>
											</i>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">请参见
											</font><a class="xref" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎">
												<font style="vertical-align: inherit;">第15章，</font>
											</a><a class="xref" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎"><i>
													<font style="vertical-align: inherit;">InnoDB</font>
												</i></a>
											<font style="vertical-align: inherit;">存储引擎。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												优化</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句以更快地运行，以便在更短的时间内锁定表。</font>
											<font style="vertical-align: inherit;">您可能必须创建一些汇总表来执行此操作。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												启动</font>
										</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysqld的</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">使用
											</font>
										</font><a class="link" href="server-administration.html#option_mysqld_low-priority-updates"><code class="option">--low-priority-updates</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">对于仅使用表级锁（如存储引擎
											</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">MEMORY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><code class="literal">MERGE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">），这给所有的语句更新（修改），比表低优先级
											</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">的语句。</font>
											<font style="vertical-align: inherit;">在这种情况下，</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												前一个场景中</font>
											<font style="vertical-align: inherit;">的第二个</font>
											<font style="vertical-align: inherit;">语句将在</font>
										</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句</font>
											<font style="vertical-align: inherit;">之前执行</font>
											<font style="vertical-align: inherit;">，并且不会等待第一个语句
											</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">完成。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												要指定在特定连接中发出的所有更新都应以低优先级完成，请将</font>
										</font><a class="link" href="server-administration.html#sysvar_low_priority_updates"><code class="literal">low_priority_updates</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												服务器系统变量</font>
											<font style="vertical-align: inherit;">设置
											</font>
											<font style="vertical-align: inherit;">为1。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												要使特定的</font>
										</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或
											</font>
										</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句具有较低的优先级，请使用该</font>
										</font><code class="literal">LOW_PRIORITY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												属性。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												要为特定</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												语句</font>
											<font style="vertical-align: inherit;">赋予</font>
											<font style="vertical-align: inherit;">更高的优先级，请使用该
											</font>
										</font><code class="literal">HIGH_PRIORITY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">属性。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#select" title="13.2.10 SELECT语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.2.10节“SELECT语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">使用</font>
											<font style="vertical-align: inherit;">
												系统变量</font>
											<font style="vertical-align: inherit;">的低值</font>
											<font style="vertical-align: inherit;">
												启动</font>
										</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysqld</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="server-administration.html#sysvar_max_write_lock_count"><code class="literal">max_write_lock_count</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">以强制MySQL临时提升在</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对表进行特定数量的插入后等待表</font>
											<font style="vertical-align: inherit;">的所有</font>
											<font style="vertical-align: inherit;">语句</font>
											<font style="vertical-align: inherit;">的优先级</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">这允许
											</font>
										</font><code class="literal">READ</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在一定数量的锁之后
											</font>
										</font><code class="literal">WRITE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">锁定。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">


												如果你有问题
											</font>
										</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">联合
											</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，可考虑改用</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表，它支持并发</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">报表。</font>
											<font style="vertical-align: inherit;">（参见
											</font>
										</font><a class="xref" href="optimization.html#concurrent-inserts" title="8.11.3并发插入">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.11.3节“并发插入”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。）
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果你有混合</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句的</font>
											<font style="vertical-align: inherit;">问题
											</font>
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">LIMIT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">选项
											</font>
										</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可能会有所帮助。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#delete" title="13.2.2 DELETE语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.2.2节“删除语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												使用</font>
										</font><code class="literal">SQL_BUFFER_RESULT</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">with
											</font>
										</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句有助于缩短表锁的持续时间。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#select" title="13.2.10 SELECT语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.2.10节“SELECT语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												通过允许查询针对一个表中的列运行，将表内容拆分为单独的表可能会有所帮助，而更新仅限于不同表中的列。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												您可以更改锁定代码
											</font>
										</font><code class="filename">mysys/thr_lock.c</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">以使用单个队列。</font>
											<font style="vertical-align: inherit;">在这种情况下，写锁和读锁具有相同的优先级，这可能有助于某些应用程序。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="concurrent-inserts"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.11.3并发插入</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091702612816"></a><a class="indexterm" name="idm140091702611744"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">存储引擎支持并发插入，减少读者和作者之间的竞争给定表：如果一个</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表已经在数据文件中没有孔（中删除的行），一个
							</font>
						</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句可以执行行添加到表的末尾同时
							</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句正在从表中读取行。</font>
							<font style="vertical-align: inherit;">如果有多个
							</font>
						</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句，它们将按顺序排队并与</font>
						</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句</font>
							<font style="vertical-align: inherit;">同时执行
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">并发的结果</font>
						</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">可能不会立即显示。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								所述</font>
						</font><a class="link" href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量可以被设置为修改并发插入处理。</font>
							<font style="vertical-align: inherit;">默认情况下，变量设置为</font>
						</font><code class="literal">AUTO</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">（或1），并且如前所述处理并发插入。</font>
							<font style="vertical-align: inherit;">如果
							</font>
						</font><a class="link" href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">设置为
							</font>
						</font><code class="literal">NEVER</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">（或0），则禁用并发插入。</font>
							<font style="vertical-align: inherit;">如果变量设置为</font>
						</font><code class="literal">ALWAYS</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								（或2），则即使对于已删除行的表，也允许在表末尾进行并发插入。</font>
							<font style="vertical-align: inherit;">另请参见</font>
						</font><a class="link" href="server-administration.html#sysvar_concurrent_insert"><code class="literal">concurrent_insert</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量</font>
							<font style="vertical-align: inherit;">的说明</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果使用二进制日志，则并发插入将转换为</font>
						</font><code class="literal">CREATE ...
							SELECT</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">或
							</font>
						</font><a class="link" href="sql-syntax.html#insert-select" title="13.2.6.1 INSERT ... SELECT语法"><code class="literal">INSERT
								...
								SELECT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句的</font>
							<font style="vertical-align: inherit;">正常插入</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">这样做是为了确保您可以通过在备份操作期间应用日志来重新创建表的精确副本。</font>
							<font style="vertical-align: inherit;">请参见</font>
						</font><a class="xref" href="server-administration.html#binary-log" title="5.4.4二进制日志">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第5.4.4节“二进制日志”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">此外，对于这些语句，读取锁定放置在selected-from表中，以便阻止对该表的插入。</font>
							<font style="vertical-align: inherit;">结果是该表的并发插入也必须等待。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								使用</font>
						</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
								DATA</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，如果使用</font>
							<font style="vertical-align: inherit;">
								满足并发插入条件</font>
						</font><code class="literal">CONCURRENT</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">的</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表</font>
							<font style="vertical-align: inherit;">指定
							</font>
							<font style="vertical-align: inherit;">（即，中间不包含空闲块），则其他会话可以在</font>
						</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
								DATA</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">执行时</font>
							<font style="vertical-align: inherit;">从表中检索数据</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">即使没有其他会话同时使用该表，</font>
							<font style="vertical-align: inherit;">使用该
							</font>
						</font><code class="literal">CONCURRENT</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">选项</font>
						</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
								DATA</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">也会</font>
							<font style="vertical-align: inherit;">影响</font>
							<font style="vertical-align: inherit;">某个位</font>
							<font style="vertical-align: inherit;">的性能
							</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果指定</font>
						</font><code class="literal">HIGH_PRIORITY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，则在</font>
						</font><a class="link" href="server-administration.html#option_mysqld_low-priority-updates"><code class="option">--low-priority-updates</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">使用该选项启动服务器时</font>
							<font style="vertical-align: inherit;">，它将覆盖该</font>
							<font style="vertical-align: inherit;">选项</font>
							<font style="vertical-align: inherit;">的效果
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">它还会导致不使用并发插入。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								为</font>
						</font><a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES和UNLOCK TABLES语法"><code class="literal">LOCK
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，之间的差</font>
						</font><code class="literal">READ
							LOCAL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">并且</font>
						</font><code class="literal">READ</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">是
							</font>
						</font><code class="literal">READ LOCAL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">允许非冲突性的
							</font>
						</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句（并发插入），而锁被保持来执行。</font>
							<font style="vertical-align: inherit;">但是，如果要在保持锁定时使用服务器外部的进程操作数据库，则无法使用此功能。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="metadata-locking"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.11.4元数据锁定</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091702576032"></a><a class="indexterm" name="idm140091702574960"></a><a class="indexterm"
					 name="idm140091702573472"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL使用元数据锁定来管理对数据库对象的并发访问并确保数据一致性。</font>
							<font style="vertical-align: inherit;">元数据锁定不仅适用于表，还适用于模式，存储程序（过程，函数，触发器和预定事件）和表空间。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								性能模式
							</font>
						</font><a class="link" href="performance-schema.html#metadata-locks-table" title="26.12.12.3 metadata_locks表"><code
							 class="literal">metadata_locks</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表公开了元数据锁定信息，这对于查看哪些会话持有锁定，被阻塞等待锁定等非常有用。</font>
							<font style="vertical-align: inherit;">有关详细信息，请参见</font>
						</font><a class="xref" href="performance-schema.html#metadata-locks-table" title="26.12.12.3 metadata_locks表">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第26.12.12.3节“metadata_locks表”</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								元数据锁定确实涉及一些开销，随着查询量的增加而增加。</font>
							<font style="vertical-align: inherit;">元数据争用会增加多个查询尝试访问相同对象的次数。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								元数据锁定不是表定义高速缓存的替代，其互斥锁和锁与互斥锁不同
							</font>
						</font><code class="literal">LOCK_open</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">以下讨论提供了有关元数据锁定如何工作的一些信息。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p><a class="xref" href="optimization.html#metadata-lock-acquisition" title="元数据锁定获取">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">元数据锁定获取</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#metadata-lock-release" title="元数据锁定版本">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">元数据锁定版本</font>
										</font>
									</a></p>
							</li>
						</ul>
					</div>

					<div class="simplesect">

						<div class="titlepage">
							<div>

								<div class="simple">
									<h4 class="title"><a name="metadata-lock-acquisition"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">元数据锁定获取</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果给定锁定有多个服务员，则首先满足优先级最高的锁定请求，并且与
								</font>
							</font><a class="link" href="server-administration.html#sysvar_max_write_lock_count"><code class="literal">max_write_lock_count</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统变量有关。</font>
								<font style="vertical-align: inherit;">写锁定请求的优先级高于读取锁定请求。</font>
								<font style="vertical-align: inherit;">但是，如果
								</font>
							</font><a class="link" href="server-administration.html#sysvar_max_write_lock_count"><code class="literal">max_write_lock_count</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">设置为某个低值（例如10），则如果已经传递了读取锁定请求以支持10个写入锁定请求，则读取锁定请求可能优先于挂起的写入锁定请求。</font>
								<font style="vertical-align: inherit;">通常不会发生此行为，因为
								</font>
							</font><a class="link" href="server-administration.html#sysvar_max_write_lock_count"><code class="literal">max_write_lock_count</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">默认情况下具有非常大的值。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									语句逐个获取元数据锁，而不是同时获取，并在此过程中执行死锁检测。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									DML语句通常按照语句中提到的表的顺序获取锁。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									DDL语句</font>
							</font><a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES和UNLOCK TABLES语法"><code class="literal">LOCK
									TABLES</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和其他类似语句尝试通过按名称顺序获取显式命名表上的锁来减少并发DDL语句之间可能出现的死锁数。</font>
								<font style="vertical-align: inherit;">对于隐式使用的表（例如也必须锁定的外键关系中的表），可以以不同的顺序获取锁。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									例如，</font>
							</font><a class="link" href="sql-syntax.html#rename-table" title="13.1.36 RENAME TABLE语法"><code class="literal">RENAME
									TABLE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是一个按名称顺序获取锁的DDL语句：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												此</font>
										</font><a class="link" href="sql-syntax.html#rename-table" title="13.1.36 RENAME TABLE语法"><code class="literal">RENAME
												TABLE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句重命名</font>
										</font><code class="literal">tbla</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">为其他内容，并重命名</font>
										</font><code class="literal">tblc</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">为
											</font>
										</font><code class="literal">tbla</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RENAME TABLE tbla TO tbld，tblc TO tbla;
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												声明获取元数据锁，按顺序上
											</font>
										</font><code class="literal">tbla</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，</font>
										</font><code class="literal">tblc</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><code class="literal">tbld</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（因为</font>
										</font><code class="literal">tbld</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如下</font>
										</font><code class="literal">tblc</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">的名称顺序排列）：
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												这个稍微不同的语句也会重命名</font>
										</font><code class="literal">tbla</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">为其他</font>
											<font style="vertical-align: inherit;">语句
											</font>
											<font style="vertical-align: inherit;">，并重命名
											</font>
										</font><code class="literal">tblc</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">为</font>
										</font><code class="literal">tbla</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RENAME TABLE tbla TO tblb，tblc TO tbla;
</font></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在这种情况下，该语句获取元数据锁，按顺序上</font>
										</font><code class="literal">tbla</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><code class="literal">tblb</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和</font>
										</font><code class="literal">tblc</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												（因为</font>
										</font><code class="literal">tblb</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">先于
											</font>
										</font><code class="literal">tblc</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在名称顺序排列）：
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这两个语句获取锁上</font>
							</font><code class="literal">tbla</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">并
								</font>
							</font><code class="literal">tblc</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">按此顺序，但在剩下的表名的锁是否之前或之后获得的不同</font>
							</font><code class="literal">tblc</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									当多个事务同时执行时，元数据锁获取顺序可以在操作结果上产生差异，如下例所示。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									与两个表开始</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">x_new</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">具有相同的结构。</font>
								<font style="vertical-align: inherit;">三个客户端发出涉及这些表的语句：
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									客户1：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LOCK TABLE x WRITE，x_new WRITE;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									声明请求并获得写名字顺序锁在</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">x_new</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									客户2：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入x值（1）;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									语句请求并阻塞等待写锁定
								</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									客户3：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RENAME TABLE x TO x_old，x_new TO x;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									声明要求独占锁在名字顺序
								</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">x_new</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">x_old</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，而是块等待上了锁
								</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									客户1：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解锁表;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该语句释放写锁</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									和</font>
							</font><code class="literal">x_new</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">客户端3 </font>
								<font style="vertical-align: inherit;">的独占锁定请求
								</font>
								<font style="vertical-align: inherit;">具有比客户端2的写入锁定请求更高的优先级，因此客户端3获取其锁定</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，然后还打开</font>
							</font><code class="literal">x_new</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									并</font>
							</font><code class="literal">x_old</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">执行重命名，并释放其锁定。</font>
								<font style="vertical-align: inherit;">然后，客户端2获取其锁定
								</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，执行插入并释放其锁定。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									锁定获取顺序导致
								</font>
							</font><a class="link" href="sql-syntax.html#rename-table" title="13.1.36 RENAME TABLE语法"><code class="literal">RENAME
									TABLE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">执行之前的执行</font>
							</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">将
								</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">其插入到发生的是，被命名表</font>
							</font><code class="literal">x_new</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">时，客户端2日插入，并更名为</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">通过客户端3：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM x;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">我|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM x_old;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空集（0.01秒）</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									现在开始使用已命名</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">且
								</font>
							</font><code class="literal">new_x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">具有相同结构的表。</font>
								<font style="vertical-align: inherit;">同样，三个客户端发出涉及这些表的语句：
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									客户1：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LOCK TABLE x WRITE，new_x WRITE;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									声明请求并获得写名字顺序锁在</font>
							</font><code class="literal">new_x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									客户2：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入x值（1）;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									语句请求并阻塞等待写锁定
								</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									客户3：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RENAME TABLE x TO old_x，new_x TO x;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									声明要求独占锁在名字顺序
								</font>
							</font><code class="literal">new_x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><code class="literal">old_x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，而是块等待上了锁
								</font>
							</font><code class="literal">new_x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									客户1：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解锁表;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该语句释放写锁</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									和</font>
							</font><code class="literal">new_x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">对于</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，唯一的待处理请求是客户端2，因此客户端2获取其锁定，执行插入并释放锁定。</font>
								<font style="vertical-align: inherit;">因为
								</font>
							</font><code class="literal">new_x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，唯一的待处理请求是客户端3，允许获取该锁（以及锁定</font>
							</font><code class="literal">old_x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。</font>
								<font style="vertical-align: inherit;">重命名操作仍会阻止锁定，</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">直到客户端2插入完成并释放其锁定。</font>
								<font style="vertical-align: inherit;">然后，客户端3获取锁定</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，执行重命名并释放其锁定。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在这种情况下，锁定获取顺序导致在
								</font>
							</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">执行之前执行
								</font>
							</font><a class="link" href="sql-syntax.html#rename-table" title="13.1.36 RENAME TABLE语法"><code class="literal">RENAME
									TABLE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">在
								</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">进入时发生的插入是原来的</font>
							</font><code class="literal">x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，现在改名为
								</font>
							</font><code class="literal">old_x</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">通过重命名操作：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM x;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
空集（0.01秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM old_x;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">我|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------ +</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果并发语句中的锁获取顺序对操作结果中的应用程序产生影响，如前面的示例所示，您可以调整表名以影响锁获取的顺序。
								</font>
							</font>
						</p><a class="indexterm" name="idm140091702477376"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									必要时，元数据锁扩展到由外键约束相关的表，以防止冲突的DML和DDL操作在相关表上并发执行。</font>
								<font style="vertical-align: inherit;">更新父表时，在更新外键元数据时对子表执行元数据锁定。</font>
								<font style="vertical-align: inherit;">外键元数据由子表拥有。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="metadata-lock-release"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">元数据锁定版本</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									为确保事务可序列化，服务器不得允许一个会话在另一个会话中未完成的显式或隐式启动的事务中使用的表上执行数据定义语言（DDL）语句。</font>
								<font style="vertical-align: inherit;">服务器通过获取事务中使用的表的元数据锁并延迟释放这些锁直到事务结束来实现此目的。</font>
								<font style="vertical-align: inherit;">表上的元数据锁可防止更改表的结构。</font>
								<font style="vertical-align: inherit;">这种锁定方法的含义是，在事务结束之前，其他会话不能在DDL语句中使用一个会话中的事务正在使用的表。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									该原则不仅适用于事务表，也适用于非事务表。</font>
								<font style="vertical-align: inherit;">假设会话开始使用事务表</font>
							</font><code class="literal">t</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和非</font>
								<font style="vertical-align: inherit;">事务表的
								</font>
								<font style="vertical-align: inherit;">事务
								</font>
							</font><code class="literal">nt</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，如下所示：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始交易;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT * FROM nt;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									服务器在两者上都保持元数据锁</font>
							</font><code class="literal">t</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									，</font>
							</font><code class="literal">nt</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">直到事务结束。</font>
								<font style="vertical-align: inherit;">如果另一个会话在任一个表上尝试DDL或写入锁定操作，它将阻塞，直到事务结束时元数据锁定释放。</font>
								<font style="vertical-align: inherit;">例如，第二个会话阻止它是否尝试以下任何操作：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DROP TABLE t;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE t ...;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP TABLE nt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE nt ......;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LOCK TABLE t ... WRITE;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									同样的行为适用于The
								</font>
							</font><a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES和UNLOCK TABLES语法"><code class="literal">LOCK
									TABLES ...
									READ</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">也就是说，更新任何表（事务性或非事务性）的显式或隐式启动事务将阻塞并被</font>
							</font><code class="literal">LOCK
								TABLES ... READ</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">该表</font>
								<font style="vertical-align: inherit;">阻止</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果服务器获取语法有效但在执行期间失败的语句的元数据锁，则它不会提前释放锁。</font>
								<font style="vertical-align: inherit;">锁定释放仍然延迟到事务结束，因为失败的语句被写入二进制日志，并且锁定保护日志一致性。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在自动提交模式下，每个语句实际上都是一个完整的事务，因此为语句获取的元数据锁只保留在语句的末尾。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#prepare" title="13.5.1 PREPARE语法"><code
								 class="literal">PREPARE</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">即使在多语句事务中进行了准备，也会在语句准备好后释放语句中</font>
								<font style="vertical-align: inherit;">
									获取的元数据锁
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									从MySQL 8.0.13开始，对于</font>
							</font><code class="literal">PREPARED</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">状态中的</font>
								<font style="vertical-align: inherit;">XA事务，
								</font>
								<font style="vertical-align: inherit;">在客户端断开连接和服务器重新启动之间维护元数据锁，直到</font>
								<font style="vertical-align: inherit;">执行</font>
							</font><a class="link" href="sql-syntax.html#xa" title="13.3.8 XA交易"><code class="literal">XA
									COMMIT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或</font>
							</font><a class="link" href="sql-syntax.html#xa" title="13.3.8 XA交易"><code class="literal">XA
									ROLLBACK</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">执行。
								</font>
							</font>
						</p>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="external-locking"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.11.5外部锁定</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091702454976"></a><a class="indexterm" name="idm140091702453904"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								外部锁定是使用文件系统锁定来管理</font>
						</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">多个进程</font>
							<font style="vertical-align: inherit;">对</font>
							<font style="vertical-align: inherit;">数据库表的</font>
							<font style="vertical-align: inherit;">争用</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">外部锁定用于不能假定单个进程（如MySQL服务器）是唯一需要访问表的进程的情况。</font>
							<font style="vertical-align: inherit;">这里有些例子：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果运行多个使用相同数据库目录的服务器（不推荐），则每个服务器都必须启用外部锁定。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果使用</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">对表执行表维护操作
										</font>
									</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，则必须确保服务器未运行，或者服务器已启用外部锁定，以便根据需要锁定表文件以与</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">协调以</font>
										<font style="vertical-align: inherit;">
											访问表。</font>
										<font style="vertical-align: inherit;">使用</font>
									</font><a class="link" href="programs.html#myisampack" title="4.6.6 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisampack</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">打包
										</font>
									</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表</font>
										<font style="vertical-align: inherit;">也是如此
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果服务器在启用外部锁定的情况下运行，则可以随时使用</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">进行读取操作，例如检查表。</font>
										<font style="vertical-align: inherit;">在这种情况下，如果服务器尝试更新</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">正在使用</font>
										<font style="vertical-align: inherit;">的表，
										</font>
										<font style="vertical-align: inherit;">服务器将等待</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">完成后再继续。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果使用</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisamchk</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">进行写操作（例如修复或优化表），或者使用
										</font>
									</font><a class="link" href="programs.html#myisampack" title="4.6.6 myisampack  - 生成压缩的只读MyISAM表"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">myisampack</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">打包表，则
										</font>
									</font><span class="emphasis"><em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">必须</font>
											</font>
										</em></span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">始终确保
										</font>
									</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">mysqld</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">服务器不使用该表。</font>
										<font style="vertical-align: inherit;">如果你没有停止</font>
									</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">mysqld</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，至少</font>
										<font style="vertical-align: inherit;">在你运行</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span
											 class="command"><strong>
													<font style="vertical-align: inherit;">myisamchk</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">之前
										</font>
										<font style="vertical-align: inherit;">做一个
										</font>
									</font><a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin  - 管理MySQL服务器的客户端"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">mysqladmin flush-tables</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">如果服务器和
										</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
													<font style="vertical-align: inherit;">myisamchk</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">同时访问表，</font>
										<font style="vertical-align: inherit;">您的表</font><span class="emphasis"><em>
												<font style="vertical-align: inherit;">可能会损坏</font>
											</em></span>
										<font style="vertical-align: inherit;">。
										</font>
									</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
												<font style="vertical-align: inherit;"></font>
											</strong></span></a>
									<font style="vertical-align: inherit;"></font><span class="emphasis"><em>
											<font style="vertical-align: inherit;"></font>
										</em></span>
									<font style="vertical-align: inherit;"></font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span
										 class="command"><strong>
												<font style="vertical-align: inherit;"></font>
											</strong></span></a>
									<font style="vertical-align: inherit;"></font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								在外部锁定生效的情况下，需要访问表的每个进程都会在继续访问表之前获取表文件的文件系统锁。</font>
							<font style="vertical-align: inherit;">如果无法获取所有必需的锁，则阻止进程访问表，直到可以获取锁（在当前持有锁的进程释放它们之后）。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								外部锁定会影响服务器性能，因为服务器有时必须等待其他进程才能访问表。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果运行单个服务器来访问给定的数据目录（通常情况下），</font>
							<font style="vertical-align: inherit;">并且在服务器运行</font>
							<font style="vertical-align: inherit;">时没有其他程序（如</font>
						</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">myisamchk）</font>
									</font>
								</strong></span></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">需要修改表，</font>
							<font style="vertical-align: inherit;">则不需要外部锁定</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">如果您只
							</font>
						</font><span class="emphasis"><em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">读取</font>
								</font>
							</em></span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">其他程序的表，则不需要外部锁定，尽管</font>
							<font style="vertical-align: inherit;">
								如果服务器在</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span
								 class="command"><strong>
										<font style="vertical-align: inherit;">myisamchk</font>
									</strong></span></a>
							<font style="vertical-align: inherit;">读取时</font>
							<font style="vertical-align: inherit;">更改了表</font>
							<font style="vertical-align: inherit;">，</font>
						</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">myisamchk</font>
									</font>
								</strong></span></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">可能会报告警告
							</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
									<font style="vertical-align: inherit;"></font>
								</strong></span></a>
						<font style="vertical-align: inherit;"></font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								禁用外部锁定后，要使用
							</font>
						</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">myisamchk</font>
									</font>
								</strong></span></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，必须在</font>
							<font style="vertical-align: inherit;">执行</font>
						</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">myisamchk时</font>
									</font>
								</strong></span></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">停止服务器，</font>
							<font style="vertical-align: inherit;">或者在运行</font>
						</font><a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">myisamchk</font>
									</font>
								</strong></span></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">之前锁定并刷新表</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">（请参阅</font>
						</font><a class="ulink" href="https://dev.mysql.com/doc/refman/5.7/en/system-optimization.html" target="_top">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统因素</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。）要避免此要求，请使用</font>
						</font><a class="link" href="sql-syntax.html#check-table" title="13.7.3.2检查表语法"><code class="literal">CHECK TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								和</font>
						</font><a class="link" href="sql-syntax.html#repair-table" title="13.7.3.5 REPAIR TABLE语法"><code class="literal">REPAIR
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句检查和修复</font>
						</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于</font>
						</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">mysqld</font>
									</font>
								</strong></span></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，外部锁定由</font>
						</font><a class="link" href="server-administration.html#sysvar_skip_external_locking"><code class="literal">skip_external_locking</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量</font>
							<font style="vertical-align: inherit;">的值控制
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">启用此变量时，将禁用外部锁定，反之亦然。</font>
							<font style="vertical-align: inherit;">默认情况下禁用外部锁定。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								可以使用</font>
						</font><a class="link" href="server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">或
							</font>
						</font><a class="link" href="server-administration.html#option_mysqld_external-locking"><code class="option">--skip-external-locking</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								选项</font>
							<font style="vertical-align: inherit;">在服务器启动时控制外部锁定的使用</font>
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								如果使用外部锁定选项来启用</font>
						</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">来自许多MySQL进程的表的</font>
							<font style="vertical-align: inherit;">更新
							</font>
							<font style="vertical-align: inherit;">，请不要在</font>
						</font><a class="link" href="server-administration.html#sysvar_delay_key_write"><code class="literal">delay_key_write</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">系统变量设置为的情况下</font>
							<font style="vertical-align: inherit;">启动服务器，
							</font>
						</font><code class="literal">ALL</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">或者</font>
						</font><code class="literal">DELAY_KEY_WRITE=1</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">对任何共享表</font>
							<font style="vertical-align: inherit;">使用
							</font>
							<font style="vertical-align: inherit;">表选项。</font>
							<font style="vertical-align: inherit;">否则，可能会发生索引损坏。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								满足这种条件的最简单方法是始终
							</font>
						</font><a class="link" href="server-administration.html#option_mysqld_external-locking"><code class="option">--external-locking</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">与...一起使用
							</font>
						</font><a class="link" href="server-administration.html#sysvar_delay_key_write"><code class="option">--delay-key-write=OFF</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">（默认情况下不会这样做，因为在许多设置中，混合使用前面的选项很有用。）
							</font>
						</font>
					</p>
				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="optimizing-server"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.12优化MySQL服务器</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#disk-issues">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.12.1优化磁盘I / O.</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#symbolic-links">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.12.2使用符号链接</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-memory">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.12.3优化内存使用</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#optimizing-network">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.12.4优化网络使用</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#resource-groups">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.12.5资源组</font>
									</font>
								</a></span></dt></dl>
				</div>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							本节讨论数据库服务器的优化技术，主要处理系统配置而不是调优SQL语句。</font>
						<font style="vertical-align: inherit;">本节中的信息适用于希望确保所管理服务器的性能和可伸缩性的DBA; </font>
						<font style="vertical-align: inherit;">用于构建包括设置数据库的安装脚本的开发人员; </font>
						<font style="vertical-align: inherit;">和人们自己运行MySQL进行开发，测试等等，他们希望最大限度地提高自己的工作效率。
						</font>
					</font>
				</p>
				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="disk-issues"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.12.1优化磁盘I / O.</font>
									</font>
								</h3>
							</div>
						</div>
					</div>
					<a class="indexterm" name="idm140091702396032"></a><a class="indexterm" name="idm140091702394960"></a><a class="indexterm"
					 name="idm140091702393472"></a>
					<div class="itemizedlist">
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									本节介绍在将更多，更快的存储硬件投入数据库服务器时配置存储设备的方法。</font>
								<font style="vertical-align: inherit;">有关优化
								</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">配置以提高I / O性能的信息，请参见</font>
							</font><a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8优化InnoDB磁盘I / O.">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第8.5.8节“优化InnoDB磁盘I / O”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											磁盘搜索是一个巨大的性能瓶颈。</font>
										<font style="vertical-align: inherit;">当数据量开始增长到无法实现有效缓存时，这个问题就变得更加明显了。</font>
										<font style="vertical-align: inherit;">对于您或多或少随机访问数据的大型数据库，您可以确保至少需要一个磁盘读取和一些磁盘寻求写入内容。</font>
										<font style="vertical-align: inherit;">要最小化此问题，请使用寻道时间较短的磁盘。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											通过将文件符号链接到不同磁盘或条带化磁盘来增加可用磁盘轴数（从而减少搜索开销）：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														使用符号链接
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														这意味着，对于</font>
												</font><code class="literal">MyISAM</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">表，您将索引文件和数据文件从它们在数据目录中的通常位置符号链接到另一个磁盘（也可能是条带化的）。</font>
													<font style="vertical-align: inherit;">这使得搜索和读取时间都更好，假设磁盘也不用于其他目的。</font>
													<font style="vertical-align: inherit;">请参见
													</font>
												</font><a class="xref" href="optimization.html#symbolic-links" title="8.12.2使用符号链接">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">第8.12.2节“使用符号链接”</font>
													</font>
												</a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">。
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;"></font><code class="literal">InnoDB</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">表格</font>
													<font style="vertical-align: inherit;">
														不支持符号链接
													</font>
													<font style="vertical-align: inherit;">。</font>
													<font style="vertical-align: inherit;">但是，可以将</font>
												</font><code class="literal">InnoDB</code>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">数据和日志文件放在不同的物理磁盘上。</font>
													<font style="vertical-align: inherit;">有关更多信息，请参见</font>
												</font><a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.8优化InnoDB磁盘I / O.">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">第8.5.8节“优化InnoDB磁盘I / O”</font>
													</font>
												</a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">。
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<a class="indexterm" name="idm140091702380624"></a>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">

														条带化
													</font>
												</font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														条带化意味着您有许多磁盘并将第一个块放在第一个磁盘上，第二个块放在第二个磁盘上，第二</font>
												</font><em class="replaceable"><code>N</code></em>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">个块放在（</font>
													<font style="vertical-align: inherit;">）磁盘上，依此类推。</font>
													<font style="vertical-align: inherit;">这意味着如果您的正常数据大小小于条带大小（或完全对齐），您将获得更好的性能。</font>
													<font style="vertical-align: inherit;">条带化非常依赖于操作系统和条带大小，因此使用不同的条带大小对应用程序进行基准测试。</font>
													<font style="vertical-align: inherit;">请参见</font><a class="xref" href="optimization.html#custom-benchmarks"
													 title="8.13.2使用您自己的基准">
														<font style="vertical-align: inherit;">第8.13.2节“使用您自己的基准”</font>
													</a>
													<font style="vertical-align: inherit;">。
													</font>
												</font><code class="literal"><em class="replaceable"><code>N</code></em> MOD
													<em class="replaceable"><code>number_of_disks</code></em></code>
												<font style="vertical-align: inherit;"></font><a class="xref" href="optimization.html#custom-benchmarks"
												 title="8.13.2使用您自己的基准">
													<font style="vertical-align: inherit;"></font>
												</a>
												<font style="vertical-align: inherit;"></font>
											</p>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														对于分拆的速度差是
													</font>
												</font><span class="emphasis"><em>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">非常</font>
														</font>
													</em></span>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">依赖的参数。</font>
													<font style="vertical-align: inherit;">根据您设置条带化参数和磁盘数量的方式，您可能会获得以数量级计量的差异。</font>
													<font style="vertical-align: inherit;">您必须选择优化随机或顺序访问。
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											为了提高可靠性，您可能需要使用RAID 0 + 1（条带加镜像），但在这种情况下，您需要2个
										</font>
									</font><em class="replaceable"><code>N</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">驱动器来保存
										</font>
									</font><em class="replaceable"><code>N</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">数据驱动器。</font>
										<font style="vertical-align: inherit;">如果你有钱的话，这可能是最好的选择。</font>
										<font style="vertical-align: inherit;">但是，您可能还需要投资一些卷管理软件才能有效地处理它。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											一个好的选择是根据数据类型的重要程度来改变RAID级别。</font>
										<font style="vertical-align: inherit;">例如，存储可在RAID 0磁盘上重新生成的半重要数据，但将非常重要的数据（如主机信息和日志）存储在RAID 0 + 1或RAID
										</font>
									</font><em class="replaceable"><code>N</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">磁盘上。</font>
									</font><em class="replaceable"><code>N</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">由于更新奇偶校验位所需的时间，如果您有多次写入，</font>
										<font style="vertical-align: inherit;">RAID
										</font>
										<font style="vertical-align: inherit;">可能会出现问题。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您还可以设置数据库使用的文件系统的参数：
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果您不需要知道上次访问文件的时间（这在数据库服务器上确实没用），您可以使用该</font>
									</font><code class="option">-o noatime</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											选项</font>
										<font style="vertical-align: inherit;">安装文件系统</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">这会跳过文件系统上inode中最后一次访问时间的更新，从而避免了一些磁盘搜索。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在许多操作系统上，您可以通过使用该</font>
									</font><code class="option">-o
										async</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">选项</font>
										<font style="vertical-align: inherit;">挂载来设置要异步更新的文件系统</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">如果您的计算机相当稳定，这应该可以在不牺牲太多可靠性的情况下提供更好的性能。</font>
										<font style="vertical-align: inherit;">（默认情况下，此标志在Linux上处于启用状态。）
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="disk-issues-nfs"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">使用NFS与MySQL</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在考虑将NFS与MySQL一起使用时，建议小心。</font>
								<font style="vertical-align: inherit;">潜在问题因操作系统和NFS版本而异，包括：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												放置在NFS卷上的MySQL数据和日志文件将被锁定且无法使用。</font>
											<font style="vertical-align: inherit;">例如，由于断电导致MySQL的多个实例访问同一数据目录或MySQL被不正确地关闭的情况，可能会发生锁定问题。</font>
											<font style="vertical-align: inherit;">NFS版本4通过引入咨询和基于租约的锁定解决了潜在的锁定问题。</font>
											<font style="vertical-align: inherit;">但是，不建议在MySQL实例之间共享数据目录。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												由于无序收到的消息或网络流量丢失而​​引入的数据不一致。</font>
											<font style="vertical-align: inherit;">要避免此问题，请使用TCP with </font>
										</font><code class="literal">hard</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><code class="literal">intr</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">mount选项。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												最大文件大小限制。</font>
											<font style="vertical-align: inherit;">NFS版本2客户端只能访问文件的最低2GB（带符号的32位偏移）。</font>
											<font style="vertical-align: inherit;">NFS版本3客户端支持更大的文件（最多64位偏移）。</font>
											<font style="vertical-align: inherit;">支持的最大文件大小还取决于NFS服务器的本地文件系统。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在专业SAN环境或其他存储系统中使用NFS往往比在此类环境之外使用NFS提供更高的可靠性。</font>
								<font style="vertical-align: inherit;">但是，SAN环境中的NFS可能比直接连接或总线连接的非旋转存储更慢。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果选择使用NFS，则建议使用NFS版本4或更高版本，以及在部署到生产环境之前彻底测试NFS设置。
								</font>
							</font>
						</p>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="symbolic-links"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.12.2使用符号链接</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<div class="toc">
						<dl class="toc"><dt><span class="section"><a href="optimization.html#symbolic-links-to-databases">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.2.1在Unix上使用数据库的符号链接</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#symbolic-links-to-tables">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.2.2在Unix上使用MyISAM表的符号链接</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#windows-symbolic-links">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.2.3在Windows上使用数据库的符号链接</font>
										</font>
									</a></span></dt></dl>
					</div>
					<a class="indexterm" name="idm140091702356784"></a><a class="indexterm" name="idm140091702355712"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								您可以将数据库或表从数据库目录移动到其他位置，并使用指向新位置的符号链接替换它们。</font>
							<font style="vertical-align: inherit;">您可能希望这样做，例如，将数据库移动到具有更多可用空间的文件系统，或者通过将表扩展到不同的磁盘来提高系统的速度。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对于</font>
						</font><code class="literal">InnoDB</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">表，请使用</font>
						</font><code class="literal">DATA
							DIRECTORY</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">语句上</font>
							<font style="vertical-align: inherit;">的</font>
							<font style="vertical-align: inherit;">子句</font>
						</font><a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE语法"><code class="literal">CREATE
								TABLE</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">而不是符号链接，如</font>
						</font><a class="xref" href="innodb-storage-engine.html#tablespace-placing" title="15.6.3.6在数据目录之外创建表空间">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第15.6.3.6节“在数据目录外创建表空间”中所述</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">此新功能是一种受支持的跨平台技术。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								建议的方法是将整个数据库目录符号链接到其他磁盘。</font>
							<font style="vertical-align: inherit;">符号链表
							</font>
						</font><code class="literal">MyISAM</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">仅作为最后的手段。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要确定数据目录的位置，请使用以下语句：
							</font>
						</font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示变量像'datadir';
</font></font></pre>
					<div class="section">

						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="symbolic-links-to-databases"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.2.1在Unix上使用数据库的符号链接</font>
										</font>
									</h4>
								</div>
							</div>
						</div>
						<a class="indexterm" name="idm140091702345616"></a><a class="indexterm" name="idm140091702344128"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在Unix上，符号链接数据库的方法是首先在某个磁盘上创建一个目录，在该磁盘上有可用空间，然后从MySQL数据目录创建一个到它的软链接。
								</font>
							</font>
						</p>
						<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font></font><strong class="userinput"><code>mkdir /dr1/databases/test</code></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>ln -s /dr1/databases/test <em class="replaceable"><code>/path/to/datadir</code></em></code></strong>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL不支持将一个目录链接到多个数据库。</font>
								<font style="vertical-align: inherit;">只要不在数据库之间建立符号链接，就可以使用符号链接替换数据库目录。</font>
								<font style="vertical-align: inherit;">假设您</font>
							</font><code class="literal">db1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在MySQL数据目录下</font>
								<font style="vertical-align: inherit;">有一个数据库
								</font>
								<font style="vertical-align: inherit;">，然后创建一个</font>
							</font><code class="literal">db2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">指向以下内容
								</font>
								<font style="vertical-align: inherit;">的符号链接</font>
							</font><code class="literal">db1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>cd <em class="replaceable"><code>/path/to/datadir</code></em></code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>ln -s db1 db2</code></strong>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									其结果是，对于任何表</font>
							</font><code class="literal">tbl_a</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">中
								</font>
							</font><code class="literal">db1</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，也似乎是一个表
								</font>
							</font><code class="literal">tbl_a</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">中</font>
							</font><code class="literal">db2</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">如果一个客户端更新</font>
							</font><code class="literal">db1.tbl_a</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">而另一个客户端更新</font>
							</font><code class="literal">db2.tbl_a</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，则可能会出现问题。
								</font>
							</font>
						</p>
					</div>

					<div class="section">

						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="symbolic-links-to-tables"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.2.2在Unix上使用MyISAM表的符号链接</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091702327872"></a><a class="indexterm" name="idm140091702326384"></a>
						<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

							<div class="admon-title">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										注意
									</font>
								</font>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										此处描述的符号链接支持以及</font>
								</font><a class="link" href="server-administration.html#option_mysqld_symbolic-links"><code class="option">--symbolic-links</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">控制它</font>
									<font style="vertical-align: inherit;">的
									</font>
									<font style="vertical-align: inherit;">选项已弃用，将在未来的MySQL版本中删除。</font>
									<font style="vertical-align: inherit;">此外，默认情况下禁用该选项。
									</font>
								</font>
							</p>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									仅对</font>
							</font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表格</font>
								<font style="vertical-align: inherit;">完全支持符号链接
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">对于表用于其他存储引擎的文件，如果尝试使用符号链接，可能会遇到奇怪的问题。</font>
								<font style="vertical-align: inherit;">对于</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表，请使用</font>
							</font><a class="xref" href="innodb-storage-engine.html#tablespace-placing" title="15.6.3.6在数据目录之外创建表空间">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第15.6.3.6节“在数据目录外创建表空间”中</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">说明的替代技术
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									不要在没有完全可操作</font>
							</font><code class="literal">realpath()</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">调用的</font>
								<font style="vertical-align: inherit;">系统上进行符号链接表</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">（Linux和Solaris支持</font>
							</font><code class="literal">realpath()</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">）。</font>
								<font style="vertical-align: inherit;">要确定您的系统是否支持符号链接，请</font>
							</font><a class="link" href="server-administration.html#sysvar_have_symlink"><code class="literal">have_symlink</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">使用以下语句</font>
								<font style="vertical-align: inherit;">检查</font>
								<font style="vertical-align: inherit;">系统变量</font>
								<font style="vertical-align: inherit;">的值</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW VARIABLES喜欢'have_symlink';
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表</font>
								<font style="vertical-align: inherit;">
									的符号链接的处理</font>
								<font style="vertical-align: inherit;">如下：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在数据目录中，始终具有data（</font>
										</font><code class="filename">.MYD</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）文件和index（</font>
										</font><code class="filename">.MYI</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">）文件。</font>
											<font style="vertical-align: inherit;">数据文件和索引文件可以移动到其他位置，并通过符号链接在数据目录中替换。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												您可以将数据文件和索引文件独立地符号链接到不同的目录。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												要指示正在运行的MySQL服务器执行符号链接，请使用</font>
										</font><code class="literal">DATA DIRECTORY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><code class="literal">INDEX DIRECTORY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">选项
											</font>
										</font><a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE语法"><code class="literal">CREATE
												TABLE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.1.20节“CREATE TABLE语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">或者，如果
											</font>
										</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysqld</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">未运行，则可以使用</font>
											<font style="vertical-align: inherit;">
												命令行中的</font>
										</font><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">ln -s</font>
												</font>
											</strong></span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">手动完成符号链接</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

										<div class="admon-title">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													注意
												</font>
											</font>
										</div>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													用的一方或双方使用的路径</font>
											</font><code class="literal">DATA
												DIRECTORY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">和</font>
											</font><code class="literal">INDEX
												DIRECTORY</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">选项可能不包括MySQL的
												</font>
											</font><code class="literal">data</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">目录。</font>
												<font style="vertical-align: inherit;">（缺陷号32167）
												</font>
											</font>
										</p>
									</div>
								</li>
								<li class="listitem">
									<p>
										<a class="link" href="programs.html#myisamchk" title="4.6.4 myisamchk  -  MyISAM表维护实用程序"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">myisamchk</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">不会用数据文件或索引文件替换符号链接。</font>
											<font style="vertical-align: inherit;">它直接在符号链接指向的文件上工作。</font>
											<font style="vertical-align: inherit;">在数据文件或索引文件所在的目录中创建任何临时文件。</font>
											<font style="vertical-align: inherit;">同样是真实的
											</font>
										</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
												TABLE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE语法"><code class="literal">OPTIMIZE
												TABLE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="link" href="sql-syntax.html#repair-table" title="13.7.3.5 REPAIR TABLE语法"><code class="literal">REPAIR
												TABLE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

										<div class="admon-title">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													注意
												</font>
											</font>
										</div>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													删除使用符号链接的表时，符号
												</font>
											</font><span class="emphasis"><em>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">链接和符号链接指向的文件都将被删除</font>
													</font>
												</em></span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">这是一个非常好的理由</font>
											</font><span class="emphasis"><em>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">不</font>
													</font>
												</em></span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">将
												</font>
											</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">mysqld</font>
														</font>
													</strong></span></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">作为</font>
											</font><code class="literal">root</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													操作系统用户运行或允许操作系统用户具有对MySQL数据库目录的写访问权。
												</font>
											</font>
										</p>
									</div>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果使用</font>
										</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
												TABLE
												... RENAME</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">or </font>
											<font style="vertical-align: inherit;">重命名表，
											</font>
										</font><a class="link" href="sql-syntax.html#rename-table" title="13.1.36 RENAME TABLE语法"><code class="literal">RENAME
												TABLE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">并且不将表移动到另一个数据库，则数据库目录中的符号链接将重命名为新名称，并相应地重命名数据文件和索引文件。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果使用
											</font>
										</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
												TABLE
												... RENAME</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或</font>
										</font><a class="link" href="sql-syntax.html#rename-table" title="13.1.36 RENAME TABLE语法"><code class="literal">RENAME
												TABLE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">将表移动到另一个数据库，则表将移动到另一个数据库目录。</font>
											<font style="vertical-align: inherit;">如果表名更改，则新数据库目录中的符号链接将重命名为新名称，并相应地重命名数据文件和索引文件。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果您没有使用符号链接，请使用</font>
											<font style="vertical-align: inherit;">
												选项</font>
											<font style="vertical-align: inherit;">启动
											</font>
										</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysqld</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="server-administration.html#option_mysqld_symbolic-links"><code class="option">--skip-symbolic-links</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">以确保没有人可以使用
											</font>
										</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysqld</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">删除或重命名数据目录之外的文件。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									不支持这些表符号链接操作：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
												TABLE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">忽略
											</font>
										</font><code class="literal">DATA DIRECTORY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和</font>
										</font><code class="literal">INDEX
											DIRECTORY</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表选项。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="windows-symbolic-links"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.2.3在Windows上使用数据库的符号链接</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091702273952"></a><a class="indexterm" name="idm140091702272912"></a><a class="indexterm"
						 name="idm140091702271424"></a><a class="indexterm" name="idm140091702270336"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在Windows上，符号链接可用于数据库目录。</font>
								<font style="vertical-align: inherit;">这使您可以通过设置指向它的符号链接将数据库目录放在不同的位置（例如，在不同的磁盘上）。</font>
								<font style="vertical-align: inherit;">在Windows上使用数据库符号链接类似于在Unix上使用数据库符号链接，尽管设置链接的过程有所不同。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									假设你要放置数据库目录中指定的数据库</font>
							</font><code class="literal">mydb</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">的
								</font>
							</font><code class="filename">D:\data\mydb</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">为此，请在MySQL数据目录中创建指向的符号链接
								</font>
							</font><code class="filename">D:\data\mydb</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">但是，在创建符号链接之前，请确保</font>
							</font><code class="filename">D:\data\mydb</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在必要时通过创建目录来存在</font>
								<font style="vertical-align: inherit;">该
								</font>
								<font style="vertical-align: inherit;">目录。</font>
								<font style="vertical-align: inherit;">如果已</font>
							</font><code class="filename">mydb</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在数据目录中</font>
								<font style="vertical-align: inherit;">指定了数据库</font>
								<font style="vertical-align: inherit;">目录，请将其移至</font>
							</font><code class="filename">D:\data</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">否则，符号链接将无效。</font>
								<font style="vertical-align: inherit;">为避免出现问题，请确保在移动数据库目录时服务器未运行。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在Windows上，您可以使用</font>
							</font><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">mklink</font>
									</font>
								</strong></span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">命令</font>
								<font style="vertical-align: inherit;">创建符号链接
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">此命令需要管理权限。
								</font>
							</font>
						</p>
						<div class="orderedlist">
							<ol class="orderedlist" type="1">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												将位置更改为数据目录：
											</font>
										</font>
									</p>
									<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C：\&gt; </font></font><strong class="userinput"><code>cd <em class="replaceable"><code>\path\to\datadir</code></em></code></strong>
</pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在数据目录中，创建一个</font>
										</font><code class="filename">mydb</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">指向数据库目录位置的</font>
											<font style="vertical-align: inherit;">符号链接
											</font>
											<font style="vertical-align: inherit;">：
											</font>
										</font>
									</p>
									<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C：\&gt; </font></font><strong class="userinput"><code>mklink /d mydb D:\data\mydb</code></strong>
</pre>
								</li>
							</ol>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在此之后，将在中创建在数据库</font>
							</font><code class="literal">mydb</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">中创建的
								</font>
								<font style="vertical-align: inherit;">所有表
								</font>
							</font><code class="filename">D:\data\mydb</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>

				</div>

				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-memory"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.12.3优化内存使用</font>
									</font>
								</h3>

							</div>

						</div>

					</div>

					<div class="toc">
						<dl class="toc"><dt><span class="section"><a href="optimization.html#memory-use">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.3.1 MySQL如何使用内存</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#large-page-support">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.3.2启用大页面支持</font>
										</font>
									</a></span></dt></dl>
					</div>
					<a class="indexterm" name="idm140091702251232"></a>
					<div class="section">

						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="memory-use"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.3.1 MySQL如何使用内存</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091702248704"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL分配缓冲区和缓存以提高数据库操作的性能。</font>
								<font style="vertical-align: inherit;">默认配置旨在允许MySQL服务器在具有大约512MB RAM的虚拟机上启动。</font>
								<font style="vertical-align: inherit;">您可以通过增加某些缓存和缓冲区相关系统变量的值来提高MySQL性能。</font>
								<font style="vertical-align: inherit;">您还可以修改默认配置以在内存有限的系统上运行MySQL。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									以下列表描述了MySQL使用内存的一些方法。</font>
								<font style="vertical-align: inherit;">适用时，引用相关的系统变量。</font>
								<font style="vertical-align: inherit;">某些项目是存储引擎或特定功能。
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												所述</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">缓冲器池是保持缓存的存储区</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表，索引，及其它辅助缓冲器中的数据。</font>
											<font style="vertical-align: inherit;">为了提高大容量读取操作的效率，缓冲池被分成</font>
											<font style="vertical-align: inherit;">
												可以容纳多行的</font>
										</font><a class="link" href="glossary.html#glos_page" title="页">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">页面</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">为了提高缓存管理的效率，缓冲池被实现为链接的页面列表; </font>
											<font style="vertical-align: inherit;">使用</font>
										</font><a class="link" href="glossary.html#glos_lru" title="LRU">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">LRU</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">算法</font>
											<font style="vertical-align: inherit;">的变体，很少使用的数据在缓存中老化
											</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">有关更多信息，请参见</font>
										</font><a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool" title="15.5.1缓冲池">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第15.5.1节“缓冲池”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												缓冲池的大小对系统性能很重要：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<code class="literal">InnoDB</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">使用</font>
													</font><code class="literal">malloc()</code>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">操作</font>
														<font style="vertical-align: inherit;">在服务器启动时为整个缓冲池分配内存
														</font>
														<font style="vertical-align: inherit;">。</font>
														<font style="vertical-align: inherit;">所述
														</font>
													</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															系统变量定义缓冲池大小。</font>
														<font style="vertical-align: inherit;">通常，建议
														</font>
													</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															值为系统内存的50％到75％。
														</font>
													</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															可以在服务器运行时动态配置。</font>
														<font style="vertical-align: inherit;">有关更多信息，请参见
														</font>
													</font><a class="xref" href="innodb-storage-engine.html#innodb-buffer-pool-resize" title="15.8.3.1配置InnoDB缓冲池大小">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">第15.8.3.1节“配置InnoDB缓冲池大小”</font>
														</font>
													</a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															在具有大量内存的系统上，可以通过将缓冲池划分为多个</font>
													</font><a class="link" href="glossary.html#glos_buffer_pool_instance" title="缓冲池实例">
														<font style="vertical-align: inherit;">
															<font style="vertical-align: inherit;">缓冲池实例</font>
														</font>
													</a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">来提高并发性
														</font>
														<font style="vertical-align: inherit;">。</font>
														<font style="vertical-align: inherit;">所述
														</font>
													</font><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															系统变量定义缓冲池实例的数量。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															太小的缓冲池可能会导致过多的搅动，因为页面从缓冲池中刷新，仅在短时间内再次需要。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															过大的缓冲池可能会因内存竞争而导致交换。
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												存储引擎接口使优化器能够提供有关用于扫描的记录缓冲区大小的信息，优化程序估计这些扫描将读取多行。</font>
											<font style="vertical-align: inherit;">缓冲区大小可以根据估计的大小而变化。</font>
										</font><code class="literal">InnoDB</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">使用这种可变大小的缓冲功能来利用行预取，并减少锁存和B树导航的开销。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												所有线程共享</font>
										</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												密钥缓冲区。</font>
											<font style="vertical-align: inherit;">的
											</font>
										</font><a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">系统变量决定其大小。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">服务器打开的</font>
											<font style="vertical-align: inherit;">每个</font>
											<font style="vertical-align: inherit;">表，索引文件打开一次; </font>
											<font style="vertical-align: inherit;">为访问该表的每个并发运行的线程打开一次数据文件。</font>
											<font style="vertical-align: inherit;">对于每个并发线程，</font>
											<font style="vertical-align: inherit;">分配</font>
											<font style="vertical-align: inherit;">表结构，每列的列结构和大小的缓冲区
											</font>
											<font style="vertical-align: inherit;">（其中</font>
											<font style="vertical-align: inherit;">，最大行长度，不计算
											</font>
											<font style="vertical-align: inherit;">列）。</font>
											<font style="vertical-align: inherit;">甲
											</font>
											<font style="vertical-align: inherit;">列需要五到八字节加上的长度
											</font>
											<font style="vertical-align: inherit;">的数据。</font>
											<font style="vertical-align: inherit;">该
											</font>
											<font style="vertical-align: inherit;">存储引擎维护用于内部使用一个额外的行缓冲。
											</font>
										</font><code class="literal">3 * <em class="replaceable"><code>N</code></em></code>
										<font style="vertical-align: inherit;"></font><em class="replaceable"><code>N</code></em>
										<font style="vertical-align: inherit;"></font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code
											 class="literal">BLOB</code></a>
										<font style="vertical-align: inherit;"></font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code
											 class="literal">BLOB</code></a>
										<font style="vertical-align: inherit;"></font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code
											 class="literal">BLOB</code></a>
										<font style="vertical-align: inherit;"></font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;"></font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												所述</font>
										</font><a class="link" href="server-administration.html#sysvar_myisam_use_mmap"><code class="literal">myisam_use_mmap</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												系统变量可以被设置为1，使能对所有内存映射</font>
										</font><code class="literal">MyISAM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果内部内存临时表变得太大（使用</font>
										</font><a class="link" href="server-administration.html#sysvar_tmp_table_size"><code class="literal">tmp_table_size</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">和
											</font>
										</font><a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												系统变量</font>
											<font style="vertical-align: inherit;">确定
											</font>
											<font style="vertical-align: inherit;">），MySQL会自动将表从内存转换为磁盘格式。</font>
											<font style="vertical-align: inherit;">从MySQL 8.0.16开始，磁盘上的临时表总是使用InnoDB存储引擎。</font>
											<font style="vertical-align: inherit;">（以前，用于此目的的存储引擎由</font>
										</font><a class="link" href="server-administration.html#sysvar_internal_tmp_disk_storage_engine"><code class="literal">internal_tmp_disk_storage_engine</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												系统变量</font>
											<font style="vertical-align: inherit;">确定，</font>
											<font style="vertical-align: inherit;">不再支持</font>
											<font style="vertical-align: inherit;">该
											</font>
											<font style="vertical-align: inherit;">系统变量。）您可以按</font>
										</font><a class="xref" href="optimization.html#internal-temporary-tables" title="8.4.4 MySQL中的内部临时表使用">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.4.4节“MySQL中的内部临时表使用”中</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">所述增加允许的临时表大小</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于使用</font>
										</font><a class="link" href="storage-engines.html#memory-storage-engine" title="16.3 MEMORY存储引擎"><code class="literal">MEMORY</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">显式创建的表</font>
										</font><a class="link" href="sql-syntax.html#create-table" title="13.1.20 CREATE TABLE语法"><code class="literal">CREATE
												TABLE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，只有
											</font>
										</font><a class="link" href="server-administration.html#sysvar_max_heap_table_size"><code class="literal">max_heap_table_size</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												系统变量决定了表的增长程度，并且没有转换为磁盘格式。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在</font>
										</font><a class="link" href="performance-schema.html" title="第26章MySQL性能架构">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">MySQL性能模式</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">是在低级别监控MySQL服务器执行的功能。</font>
											<font style="vertical-align: inherit;">性能模式以递增方式动态分配内存，将其内存使用量扩展到实际服务器负载，而不是在服务器启动期间分配所需的内存。</font>
											<font style="vertical-align: inherit;">分配内存后，在重新启动服务器之前不会释放内存。</font>
											<font style="vertical-align: inherit;">有关更多信息，请参见
											</font>
										</font><a class="xref" href="performance-schema.html#performance-schema-memory-model" title="26.17性能模式内存分配模型">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第26.17节“性能模式内存分配模型”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												服务器用于管理客户端连接的每个线程都需要一些特定于线程的空间。</font>
											<font style="vertical-align: inherit;">以下列表指出了这些以及哪些系统变量控制它们的大小：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															堆栈（</font>
													</font><a class="link" href="server-administration.html#sysvar_thread_stack"><code class="literal">thread_stack</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">）
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															连接缓冲区（</font>
													</font><a class="link" href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">）
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															结果缓冲区（</font>
													</font><a class="link" href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">）
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												连接缓冲区和结果缓冲区的大小都等于</font>
										</font><a class="link" href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">字节</font>
											<font style="vertical-align: inherit;">大小
											</font>
											<font style="vertical-align: inherit;">，但</font>
										</font><a class="link" href="server-administration.html#sysvar_max_allowed_packet"><code class="literal">max_allowed_packet</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">根据需要</font>
											<font style="vertical-align: inherit;">动态放大到
											</font>
											<font style="vertical-align: inherit;">字节。</font>
											<font style="vertical-align: inherit;">结果缓冲区</font>
										</font><a class="link" href="server-administration.html#sysvar_net_buffer_length"><code class="literal">net_buffer_length</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在每个SQL语句后</font>
											<font style="vertical-align: inherit;">缩小为
											</font>
											<font style="vertical-align: inherit;">字节。</font>
											<font style="vertical-align: inherit;">在语句运行时，还会分配当前语句字符串的副本。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												每个连接线程使用内存来计算语句摘要。</font>
											<font style="vertical-align: inherit;">服务器</font>
										</font><a class="link" href="server-administration.html#sysvar_max_digest_length"><code class="literal">max_digest_length</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">为每个会话</font>
											<font style="vertical-align: inherit;">分配
											</font>
											<font style="vertical-align: inherit;">字节。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="performance-schema.html#performance-schema-statement-digests" title="26.10性能模式语句摘要和抽样">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第26.10节“性能模式语句摘要和采样”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												所有线程共享相同的基本内存。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当不再需要线程时，分配给它的内存被释放并返回给系统，除非线程返回到线程缓存中。</font>
											<font style="vertical-align: inherit;">在这种情况下，内存仍然是分配的。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												执行表的顺序扫描的每个请求都分配一个</font>
										</font><span class="firstterm">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">读缓冲区</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">的
											</font>
										</font><a class="link" href="server-administration.html#sysvar_read_buffer_size"><code class="literal">read_buffer_size</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">系统变量决定缓冲器大小。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												当以任意顺序读取行时（例如，在排序之后），
											</font>
											<font style="vertical-align: inherit;">
												可以分配</font>
										</font><span class="firstterm">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">随机读取缓冲器</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">以避免磁盘搜索。</font>
											<font style="vertical-align: inherit;">的
											</font>
										</font><a class="link" href="server-administration.html#sysvar_read_rnd_buffer_size"><code class="literal">read_rnd_buffer_size</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												系统变量决定缓冲器大小。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												所有连接都是一次执行，大多数连接都可以在不使用临时表的情况下完成。</font>
											<font style="vertical-align: inherit;">大多数临时表都是基于内存的哈希表。</font>
											<font style="vertical-align: inherit;">具有大行长度（计算为所有列长度的总和）或包含</font>
										</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">列的</font>
											<font style="vertical-align: inherit;">临时表
											</font>
											<font style="vertical-align: inherit;">存储在磁盘上。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												执行排序的大多数请求根据结果集大小分配排序缓冲区和零到两个临时文件。</font>
											<font style="vertical-align: inherit;">请参见</font>
										</font><a class="xref" href="error-handling.html#temporary-files" title="B.4.3.5 MySQL存储临时文件的位置">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第B.4.3.5节“MySQL存储临时文件的位置”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												几乎所有的解析和计算都是在线程本地和可重用的内存池中完成的。</font>
											<font style="vertical-align: inherit;">小项目不需要内存开销，因此避免了正常的慢速内存分配和释放。</font>
											<font style="vertical-align: inherit;">内存仅分配给意外大的字符串。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于具有</font>
										</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												列的</font>
											<font style="vertical-align: inherit;">每个表，</font>
											<font style="vertical-align: inherit;">动态放大缓冲区以读取更大的</font>
										</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">值。</font>
											<font style="vertical-align: inherit;">如果扫描表，缓冲区会增大到
											</font>
										</font><a class="link" href="data-types.html#blob" title="11.4.3 BLOB和TEXT类型"><code class="literal">BLOB</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">最大值。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MySQL需要表缓存的内存和描述符。</font>
											<font style="vertical-align: inherit;">所有正在使用的表的处理程序结构都保存在表缓存中，并作为</font>
										</font><span class="quote">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">“ </font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">先进先出</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;"> ”</font>
											</font>
										</span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">（FIFO）进行管理。</font>
											<font style="vertical-align: inherit;">所述
											</font>
										</font><a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">系统变量定义初始表高速缓存大小; </font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="optimization.html#table-cache" title="8.4.3.1 MySQL如何打开和关闭表">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.4.3.1节“MySQL如何打开和关闭表”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												MySQL还需要内存用于表定义缓存。</font>
											<font style="vertical-align: inherit;">所述
											</font>
										</font><a class="link" href="server-administration.html#sysvar_table_definition_cache"><code class="literal">table_definition_cache</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												系统变量定义的，可以存储在表中定义的高速缓存表的定义的数量。</font>
											<font style="vertical-align: inherit;">如果使用大量表，则可以创建大型表定义高速缓存以加快表的打开速度。</font>
											<font style="vertical-align: inherit;">与表缓存不同，表定义缓存占用的空间更少，不使用文件描述符。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												一个</font>
										</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句或
											</font>
										</font><a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin  - 管理MySQL服务器的客户端"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">中mysqladmin冲水表</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">命令关闭不在使用一次的所有表，并标记所有在用的表被关闭当前正在执行的线程结束时。</font>
											<font style="vertical-align: inherit;">这有效地释放了大多数使用中的内存。</font>
										</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">在所有表格关闭之前不会返回。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												服务器在内存中缓存信息的结果
											</font>
										</font><a class="link" href="sql-syntax.html#grant" title="13.7.1.6 GRANT语法"><code class="literal">GRANT</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="sql-syntax.html#create-user" title="13.7.1.3 CREATE USER语法"><code class="literal">CREATE
												USER</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="sql-syntax.html#create-server" title="13.1.18 CREATE SERVER语法"><code class="literal">CREATE
												SERVER</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，和
											</font>
										</font><a class="link" href="sql-syntax.html#install-plugin" title="13.7.4.4安装PLUGIN语法"><code class="literal">INSTALL
												PLUGIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">语句。</font>
											<font style="vertical-align: inherit;">该内存不能由相应的释放
											</font>
										</font><a class="link" href="sql-syntax.html#revoke" title="13.7.1.8 REVOKE语法"><code class="literal">REVOKE</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="sql-syntax.html#drop-user" title="13.7.1.5 DROP USER语法"><code class="literal">DROP
												USER</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，
											</font>
										</font><a class="link" href="sql-syntax.html#drop-server" title="13.1.30 DROP SERVER语法"><code class="literal">DROP
												SERVER</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">，和
											</font>
										</font><a class="link" href="sql-syntax.html#uninstall-plugin" title="13.7.4.6 UNINSTALL PLUGIN语法"><code
											 class="literal">UNINSTALL PLUGIN</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												语句，所以执行导致缓存报表的多个实例的服务器上，将有内存使用的增加。</font>
											<font style="vertical-align: inherit;">可以释放此缓存的内存</font>
										</font><a class="link" href="sql-syntax.html#flush-privileges"><code class="literal">FLUSH PRIVILEGES</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在复制拓扑中，以下设置会影响内存使用情况，可以根据需要进行调整：

											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;"></font><a class="link" href="server-administration.html#sysvar_max_allowed_packet"><code
														 class="literal">max_allowed_packet</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															复制主机上</font>
														<font style="vertical-align: inherit;">
															的
														</font>
														<font style="vertical-align: inherit;">系统变量限制主服务器发送到其从属服务器以进行处理的最大消息大小。</font>
														<font style="vertical-align: inherit;">此设置默认为64M。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;"></font><a class="link" href="replication.html#sysvar_slave_pending_jobs_size_max"><code
														 class="literal">slave_pending_jobs_size_max</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															多线程从站上</font>
														<font style="vertical-align: inherit;">
															的
														</font>
														<font style="vertical-align: inherit;">系统变量设置可用于保存等待处理的消息的最大内存量。</font>
														<font style="vertical-align: inherit;">此设置默认为128M。</font>
														<font style="vertical-align: inherit;">内存仅在需要时分配，但如果复制拓扑有时处理大型事务，则可以使用它。</font>
														<font style="vertical-align: inherit;">这是一个软限制，可以处理更大的交易。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;"></font><a class="link" href="replication.html#sysvar_rpl_read_size"><code
														 class="literal">rpl_read_size</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															复制主机或从机上</font>
														<font style="vertical-align: inherit;">
															的</font>
														<font style="vertical-align: inherit;">系统变量控制从二进制日志文件和中继日志文件中读取的最小数据量（以字节为单位）。</font>
														<font style="vertical-align: inherit;">默认值为8192个字节。</font>
														<font style="vertical-align: inherit;">为从二进制日志和中继日志文件读取的每个线程分配一个大小为此值的缓冲区，包括主服务器上的转储线程和从服务器上的协调器线程。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															所述
														</font>
													</font><a class="link" href="replication.html#sysvar_binlog_transaction_dependency_history_size"><code
														 class="literal">binlog_transaction_dependency_history_size</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															系统变量限制保持为一个内存历史行哈希的数量。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															所述
														</font>
													</font><a class="link" href="replication.html#sysvar_max_binlog_cache_size"><code class="literal">max_binlog_cache_size</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															系统变量指定由单个事务存储器使用的上限。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															该
														</font>
													</font><a class="link" href="replication.html#sysvar_max_binlog_stmt_cache_size"><code class="literal">max_binlog_stmt_cache_size</code></a>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															系统变量指定由语句缓存内存使用的上限。
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
									<p>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">ps</font>
									</font>
								</strong></span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和其他系统状态程序可能会报告</font>
							</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> mysqld</font>
										</font>
									</strong></span></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">使用大量内存。</font>
								<font style="vertical-align: inherit;">这可能是由不同内存地址上的线程堆栈引起的。</font>
								<font style="vertical-align: inherit;">例如，Solaris版本的
								</font>
							</font><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;"> ps</font>
									</font>
								</strong></span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">将堆栈之间未使用的内存计为已用内存。</font>
								<font style="vertical-align: inherit;">要验证这一点，请检查可用的交换
								</font>
							</font><code class="literal">swap -s</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">我们</font>
								<font style="vertical-align: inherit;">
									使用几个内存泄漏检测器（商业和开源）</font>
								<font style="vertical-align: inherit;">测试</font>
							</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> mysqld</font>
										</font>
									</strong></span></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，因此应该没有内存泄漏。
								</font>
							</font>
						</p>
						<div class="simplesect">

							<div class="titlepage">
								<div>

									<div class="simple">
										<h5 class="title"><a name="monitor-mysql-memory-use"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">监控MySQL内存使用情况</font>
											</font>
										</h5>
									</div>
								</div>
							</div>
							<a class="indexterm" name="idm140091702121072"></a><a class="indexterm" name="idm140091702119584"></a>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										以下示例演示如何使用
									</font>
								</font><a class="link" href="performance-schema.html" title="第26章MySQL性能架构">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">性能模式</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										和</font>
								</font><a class="link" href="sys-schema.html" title="第27章MySQL sys Schema">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">sys模式</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">来监视MySQL内存使用情况。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										默认情况下禁用大多数性能架构内存检测。</font>
									<font style="vertical-align: inherit;">可以通过更新</font>
								</font><code class="literal">ENABLED</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">Performance Schema </font>
								</font><a class="link" href="performance-schema.html#setup-instruments-table" title="26.12.2.3 setup_instruments表"><code
									 class="literal">setup_instruments</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表</font>
									<font style="vertical-align: inherit;">的</font>
									<font style="vertical-align: inherit;">列
									</font>
									<font style="vertical-align: inherit;">来启用仪器
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">记忆仪器的名称形式为
									</font>
									<font style="vertical-align: inherit;">，其中</font>
									<font style="vertical-align: inherit;">的值为</font>
									<font style="vertical-align: inherit;">或</font>
									<font style="vertical-align: inherit;">，并且
									</font>
									<font style="vertical-align: inherit;">是仪器的详细信息。
									</font>
								</font><code class="literal">memory/<em class="replaceable"><code>code_area</code></em>/<em class="replaceable"><code>instrument_name</code></em></code>
								<font style="vertical-align: inherit;"></font><em class="replaceable"><code>code_area</code></em>
								<font style="vertical-align: inherit;"></font><code class="literal">sql</code>
								<font style="vertical-align: inherit;"></font><code class="literal">innodb</code>
								<font style="vertical-align: inherit;"></font><em class="replaceable"><code>instrument_name</code></em>
								<font style="vertical-align: inherit;"></font>
							</p>
							<div class="orderedlist">
								<ol class="orderedlist" type="1">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													要查看可用的MySQL内存仪器，请查询Performance Schema
												</font>
											</font><a class="link" href="performance-schema.html#setup-instruments-table" title="26.12.2.3 setup_instruments表"><code
												 class="literal">setup_instruments</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">表。</font>
												<font style="vertical-align: inherit;">以下查询返回所有代码区域的数百个内存工具。
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%memory%';</code></strong></pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													您可以通过指定代码区域来缩小结果范围。</font>
												<font style="vertical-align: inherit;">例如，您可以</font>
											</font><code class="literal">InnoDB</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">通过指定</font>
											</font><code class="literal">innodb</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">代码区域</font>
												<font style="vertical-align: inherit;">将结果限制为
												</font>
												<font style="vertical-align: inherit;">存储器械</font>
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%memory/innodb%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- + ----- ---- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NAME | </font><font style="vertical-align: inherit;">启用| </font><font style="vertical-align: inherit;">定时|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- + ----- ---- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb /自适应哈希索引| </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ innodb / buf_buf_pool | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / dict_stats_bg_recalc_pool_t | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / dict_stats_index_map_t | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / dict_stats_n_diff_on_level | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ innodb /其他| </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / row_log_buf | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / row_merge_sort | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ innodb / std | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / trx_sys_t :: rw_trx_ids | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													根据您的MySQL安装代码区域可能包括</font>
											</font><code class="literal">performance_schema</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><code class="literal">sql</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font><code class="literal">client</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><code class="literal">innodb</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font><code class="literal">myisam</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><code class="literal">csv</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font><code class="literal">memory</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><code class="literal">blackhole</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><code class="literal">archive</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，
												</font>
											</font><code class="literal">partition</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，和其他人。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													要启用内存仪器，</font>
											</font><code class="literal">performance-schema-instrument</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">请在MySQL配置文件中</font>
												<font style="vertical-align: inherit;">添加
												</font>
												<font style="vertical-align: inherit;">规则。</font>
												<font style="vertical-align: inherit;">例如，要启用所有内存仪器，请将此规则添加到配置文件并重新启动服务器：
												</font>
											</font>
										</p>
										<pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能架构仪器=“存储器/％=计数”</font></font></pre>
										<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

											<div class="admon-title">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														注意
													</font>
												</font>
											</div>
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														启动时启用内存仪器可确保计算启动时发生的内存分配。
													</font>
												</font>
											</p>
										</div>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													重新启动服务器后，</font>
											</font><code class="literal">ENABLED</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">Performance Schema </font>
											</font><a class="link" href="performance-schema.html#setup-instruments-table" title="26.12.2.3 setup_instruments表"><code
												 class="literal">setup_instruments</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													表</font>
												<font style="vertical-align: inherit;">的
												</font>
												<font style="vertical-align: inherit;">列</font>
												<font style="vertical-align: inherit;">应报告</font>
											</font><code class="literal">YES</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">您启用的内存仪器。</font>
												<font style="vertical-align: inherit;">对于内存仪器</font>
											</font><code class="literal">TIMED</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，</font>
											</font><a class="link" href="performance-schema.html#setup-instruments-table" title="26.12.2.3 setup_instruments表"><code
												 class="literal">setup_instruments</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">表中</font>
												<font style="vertical-align: inherit;">的
												</font>
												<font style="vertical-align: inherit;">列将
												</font>
												<font style="vertical-align: inherit;">被忽略，因为内存操作没有定时。
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM performance_schema.setup_instruments</code></strong>
       <strong class="userinput"><code>WHERE NAME LIKE '%memory/innodb%';</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- + ----- ---- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">NAME | </font><font style="vertical-align: inherit;">启用| </font><font style="vertical-align: inherit;">定时|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------------------------- + ----- ---- + ------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/ innodb /自适应哈希索引| </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ innodb / buf_buf_pool | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / dict_stats_bg_recalc_pool_t | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / dict_stats_index_map_t | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / dict_stats_n_diff_on_level | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ innodb /其他| </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / row_log_buf | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / row_merge_sort | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ innodb / std | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / innodb / trx_sys_t :: rw_trx_ids | </font><font style="vertical-align: inherit;">没有| </font><font style="vertical-align: inherit;">没有|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													查询内存仪器数据。</font>
												<font style="vertical-align: inherit;">在此示例中，在Performance Schema </font>
											</font><a class="link" href="performance-schema.html#memory-summary-tables" title="26.12.16.10内存摘要表"><code
												 class="literal">memory_summary_global_by_event_name</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													表中</font>
												<font style="vertical-align: inherit;">查询内存仪器数据，该
												</font>
												<font style="vertical-align: inherit;">表汇总了数据
												</font>
											</font><code class="literal">EVENT_NAME</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">这
												</font>
											</font><code class="literal">EVENT_NAME</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">是仪器的名称。
												</font>
											</font>
										</p>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													以下查询返回</font>
											</font><code class="literal">InnoDB</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">缓冲池的</font>
												<font style="vertical-align: inherit;">内存数据
												</font>
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">有关列说明，请参见
												</font>
											</font><a class="xref" href="performance-schema.html#memory-summary-tables" title="26.12.16.10内存摘要表">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">第26.12.16.10节“内存汇总表”</font>
												</font>
											</a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM performance_schema.memory_summary_global_by_event_name</code></strong>
       <strong class="userinput"><code>WHERE EVENT_NAME LIKE 'memory/innodb/buf_buf_pool'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  EVENT_NAME：memory / innodb / buf_buf_pool</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                 COUNT_ALLOC：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                  COUNT_FREE：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SUM_NUMBER_OF_BYTES_ALLOC：137428992</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    SUM_NUMBER_OF_BYTES_FREE：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              LOW_COUNT_USED：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          CURRENT_COUNT_USED：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             HIGH_COUNT_USED：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    LOW_NUMBER_OF_BYTES_USED：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CURRENT_NUMBER_OF_BYTES_USED：137428992</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   HIGH_NUMBER_OF_BYTES_USED：137428992</font></font><font></font>
</pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													可以使用</font>
											</font><a class="link" href="sys-schema.html" title="第27章MySQL sys Schema"><code class="literal">sys</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">模式</font>
											</font><a class="link" href="sys-schema.html#sys-memory-global-by-current-bytes" title="27.4.3.19 memory_global_by_current_bytes和x $ memory_global_by_current_bytes视图"><code
												 class="literal">memory_global_by_current_bytes</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													表</font>
												<font style="vertical-align: inherit;">查询相同的基础数据，
												</font>
												<font style="vertical-align: inherit;">模式
												</font>
												<font style="vertical-align: inherit;">表显示服务器内的当前内存使用情况，按分配类型细分。
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM sys.memory_global_by_current_bytes</code></strong>
       <strong class="userinput"><code>WHERE event_name LIKE 'memory/innodb/buf_buf_pool'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       event_name：memory / innodb / buf_buf_pool</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    current_count：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    current_alloc：131.06 MiB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
current_avg_alloc：131.06 MiB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       high_count：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       high_alloc：131.06 MiB</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   high_avg_alloc：131.06 MiB</font></font><font></font>
</pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													此</font>
											</font><a class="link" href="sys-schema.html" title="第27章MySQL sys Schema"><code class="literal">sys</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">架构查询</font>
											</font><code class="literal">current_alloc</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">按代码区域</font>
												<font style="vertical-align: inherit;">聚合当前分配的内存（</font>
												<font style="vertical-align: inherit;">）：
												</font>
											</font>
										</p>
										<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT SUBSTRING_INDEX(event_name,'/',2) AS</code></strong>
       <strong class="userinput"><code>code_area, sys.format_bytes(SUM(current_alloc))</code></strong>
       <strong class="userinput"><code>AS current_alloc</code></strong>
       <strong class="userinput"><code>FROM sys.x$memory_global_by_current_bytes</code></strong>
       <strong class="userinput"><code>GROUP BY SUBSTRING_INDEX(event_name,'/',2)</code></strong>
       <strong class="userinput"><code>ORDER BY SUM(current_alloc) DESC;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">code_area | </font><font style="vertical-align: inherit;">current_alloc |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ innodb | </font><font style="vertical-align: inherit;">843.24 MiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / performance_schema | </font><font style="vertical-align: inherit;">81.29 MiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ mysys | </font><font style="vertical-align: inherit;">8.20 MiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">memory / sql | </font><font style="vertical-align: inherit;">2.47 MiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/记忆| </font><font style="vertical-align: inherit;">174.01 KiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ myisam | </font><font style="vertical-align: inherit;">46.53 KiB |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/黑洞| </font><font style="vertical-align: inherit;">512字节|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">内存/联合| </font><font style="vertical-align: inherit;">512字节|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ csv | </font><font style="vertical-align: inherit;">512字节|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">记忆/ vio | </font><font style="vertical-align: inherit;">496字节|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------------------------- + -------- +</font></font><font></font>
</pre>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													有关</font>
											</font><a class="link" href="sys-schema.html" title="第27章MySQL sys Schema"><code class="literal">sys</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">模式的</font>
												<font style="vertical-align: inherit;">更多信息
												</font>
												<font style="vertical-align: inherit;">，请参见
												</font>
											</font><a class="xref" href="sys-schema.html" title="第27章MySQL sys Schema">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">第27章，</font>
												</font><i>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">MySQL sys Schema</font>
													</font>
												</i>
											</a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
								</ol>
							</div>

						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="large-page-support"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.3.2启用大页面支持</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091702053120"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									某些硬件/操作系统体系结构支持大于默认值的内存页（通常为4KB）。</font>
								<font style="vertical-align: inherit;">此支持的实际实现取决于底层硬件和操作系统。</font>
								<font style="vertical-align: inherit;">执行大量内存访问的应用程序可能会因为减少了转换后备缓冲区（TLB）丢失而使用大页面来提高性能。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL中，InnoDB可以使用大页面来为其缓冲池和额外的内存池分配内存。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在MySQL中标准使用大页面试图使用支持的最大大小，最多4MB。</font>
								<font style="vertical-align: inherit;">在Solaris下，
								</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">超大页面</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">功能允许使用高达256MB的页面。</font>
								<font style="vertical-align: inherit;">此功能适用于最新的SPARC平台。</font>
								<font style="vertical-align: inherit;">可以使用</font>
							</font><a class="link" href="server-administration.html#option_mysqld_super-large-pages"><code class="option">--super-large-pages</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或
								</font>
							</font><a class="link" href="server-administration.html#option_mysqld_super-large-pages"><code class="option">--skip-super-large-pages</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									选项</font>
								<font style="vertical-align: inherit;">启用或禁用它
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL还支持Linux实现大页面支持（在Linux中称为HugeTLB）。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在Linux上可以使用大页面之前，必须启用内核来支持它们，并且必须配置HugeTLB内存池。</font>
								<font style="vertical-align: inherit;">作为参考，HugeTBL API记录在
								</font>
							</font><code class="filename">Documentation/vm/hugetlbpage.txt</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">Linux源文件中。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									最近一些系统（如Red Hat Enterprise Linux）的内核似乎默认启用了大页面功能。</font>
								<font style="vertical-align: inherit;">要检查内核是否为真，请使用以下命令查找包含</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">huge</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”的</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">输出行
								</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Total：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Free：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Rsvd：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Surp：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hugepagesize：4096 kB</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									非空命令输出表示存在大页面支持，但零值表示没有配置使用的页面。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果需要重新配置内核以支持大页面，请查阅该</font>
							</font><code class="filename">hugetlbpage.txt</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">文件以获取相关说明。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									假设您的Linux内核启用了大页面支持，请使用以下命令将其配置为供MySQL使用。</font>
								<font style="vertical-align: inherit;">通常，将它们放在</font>
							</font><code class="filename">rc</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">系统引导序列期间执行</font>
								<font style="vertical-align: inherit;">的
								</font>
								<font style="vertical-align: inherit;">文件或等效的启动文件中，以便每次系统启动时执行命令。</font>
								<font style="vertical-align: inherit;">在MySQL服务器启动之前，命令应该在引导序列的早期执行。</font>
								<font style="vertical-align: inherit;">请务必根据您的系统更改分配编号和组编号。
								</font>
							</font>
						</p>
						<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃设置要使用的页数。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃每个页面通常为2MB，因此值为20 = 40MB。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃这个命令实际上分配了内存，所以这么多</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
#memory必须可用。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
echo 20&gt; / proc / sys / vm / nr_hugepages</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃设置允许访问的组号</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
#memory（在这种情况下为102）。</font><font style="vertical-align: inherit;">mysql用户必须是</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃该组成员。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
echo 102&gt; / proc / sys / vm / hugetlb_shm_group</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃增加每个段允许的shmem数量</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃（在这种情况下为12G）。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
echo 1560281088&gt; / proc / sys / kernel / shmmax</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃增加共享内存总量。</font><font style="vertical-align: inherit;">价值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
＃是页数。</font><font style="vertical-align: inherit;">4KB /页，4194304 = 16GB。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
echo 4194304&gt; / proc / sys / kernel / shmall</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于MySQL的使用，通常希望值
								</font>
							</font><code class="literal">shmmax</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">接近于的值
								</font>
							</font><code class="literal">shmall</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要验证大页面配置，请</font>
							</font><code class="filename">/proc/meminfo</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">按照前面的说明再次</font>
								<font style="vertical-align: inherit;">检查
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">现在您应该看到一些非零值：
								</font>
							</font>
						</p>
						<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Total：20</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Free：20</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Rsvd：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Surp：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hugepagesize：4096 kB</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用它的最后一步
								</font>
							</font><code class="literal">hugetlb_shm_group</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是为
								</font>
							</font><code class="literal">mysql</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">用户提供</font>
								<font style="vertical-align: inherit;">
									memlock限制</font>
								<font style="vertical-align: inherit;">的</font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">“ </font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">无限</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> ”</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值。</font>
								<font style="vertical-align: inherit;">这可以通过编辑</font>
							</font><code class="filename">/etc/security/limits.conf</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或将以下命令添加到
								</font>
							</font><a class="link" href="programs.html#mysqld-safe" title="4.3.2 mysqld_safe  -  MySQL服务器启动脚本"><span class="command"><strong>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">mysqld_safe</font>
										</font>
									</strong></span></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">脚本来完成：
								</font>
							</font>
						</p>
						<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ulimit -l无限制
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									将</font>
							</font><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">ulimit</font>
									</font>
								</strong></span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">命令</font>
								<font style="vertical-align: inherit;">添加</font>
								<font style="vertical-align: inherit;">到
								</font>
							</font><a class="link" href="programs.html#mysqld-safe" title="4.3.2 mysqld_safe  -  MySQL服务器启动脚本"><span class="command"><strong>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">mysqld_safe</font>
										</font>
									</strong></span></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">会导致
								</font>
							</font><code class="literal">root</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">用户</font>
							</font><code class="literal">unlimited</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">在切换到</font>
							</font><code class="literal">mysql</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">用户</font>
								<font style="vertical-align: inherit;">之前
								</font>
								<font style="vertical-align: inherit;">将memlock限制设置为
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">（这假设
								</font>
							</font><a class="link" href="programs.html#mysqld-safe" title="4.3.2 mysqld_safe  -  MySQL服务器启动脚本"><span class="command"><strong>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">mysqld_safe</font>
										</font>
									</strong></span></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">是由</font>
							</font><code class="literal">root</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。）</font>
								<font style="vertical-align: inherit;">启动的
								</font>
								<font style="vertical-align: inherit;">。）
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									默认情况下禁用MySQL中的大页面支持。</font>
								<font style="vertical-align: inherit;">要启用它，请使用该</font>
							</font><a class="link" href="server-administration.html#option_mysqld_large-pages"><code class="option">--large-pages</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">选项</font>
								<font style="vertical-align: inherit;">启动服务器
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">例如，您可以在服务器</font>
							</font><code class="filename">my.cnf</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">文件中</font>
								<font style="vertical-align: inherit;">使用以下行
								</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大型网页</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									使用此选项，会</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">自动为其缓冲池和附加内存池使用大页面。</font>
								<font style="vertical-align: inherit;">如果</font>
							</font><code class="literal">InnoDB</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">无法执行此操作，则会回退到使用传统内存并向错误日志写入警告：</font>
							</font><span class="errortext">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">警告：使用常规内存池</font>
								</font>
							</span>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要验证是否正在使用大页面，请</font>
							</font><code class="literal">/proc/meminfo</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">再次</font>
								<font style="vertical-align: inherit;">检查
								</font>
								<font style="vertical-align: inherit;">：
								</font>
							</font>
						</p>
						<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>cat /proc/meminfo | grep -i huge</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Total：20</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Free：20</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Rsvd：2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HugePages_Surp：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hugepagesize：4096 kB</font></font><font></font>
</pre>
					</div>

				</div>

				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="optimizing-network"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.12.4优化网络使用</font>
									</font>
								</h3>

							</div>

						</div>

					</div>

					<div class="toc">
						<dl class="toc"><dt><span class="section"><a href="optimization.html#client-connections">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.4.1 MySQL如何处理客户端连接</font>
										</font>
									</a></span></dt><dt><span class="section"><a href="optimization.html#host-cache">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.4.2 DNS查找优化和主机缓存</font>
										</font>
									</a></span></dt></dl>
					</div>
					<a class="indexterm" name="idm140091702010208"></a>
					<div class="section">

						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="client-connections"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.4.1 MySQL如何处理客户端连接</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091702007568"></a><a class="indexterm" name="idm140091702006528"></a><a class="indexterm"
						 name="idm140091702005456"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									本节介绍MySQL服务器如何管理客户端连接的各个方面。
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p><a class="xref" href="optimization.html#client-connections-interfaces" title="网络接口和连接管理器线程">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">网络接口和连接管理器线程</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#client-connections-thread-management" title="客户端连接线程管理">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">客户端连接线程管理</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#client-connections-volume-management" title="连接卷管理">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">连接卷管理</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#client-connections-administrative-interface" title="管理连接管理">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">管理连接管理</font>
											</font>
										</a></p>
								</li>
							</ul>
						</div>

						<div class="simplesect">

							<div class="titlepage">
								<div>

									<div class="simple">
										<h5 class="title"><a name="client-connections-interfaces"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">网络接口和连接管理器线程</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										服务器能够侦听多个网络接口上的客户端连接。</font>
									<font style="vertical-align: inherit;">连接管理器线程处理服务器侦听的网络接口上的客户端连接请求：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在所有平台上，一个管理器线程处理TCP / IP连接请求。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在Unix上，同一个管理器线程也处理Unix套接字文件连接请求。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在Windows上，管理器线程处理共享内存连接请求，另一个处理命名管道连接请求。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													在所有平台上，可以启用其他网络接口以接受管理TCP / IP连接请求。</font>
												<font style="vertical-align: inherit;">此接口可以使用处理</font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">“ </font>
												</font><span class="quote">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">普通</font>
													</font>
												</span>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;"> ”</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;"> TCP / IP请求</font>
												<font style="vertical-align: inherit;">的管理器线程</font>
												<font style="vertical-align: inherit;">或单独的线程。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										服务器不会创建线程来处理它不听的接口。</font>
									<font style="vertical-align: inherit;">例如，不支持启用命名管道连接的Windows服务器不会创建处理它们的线程。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="client-connections-thread-management"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">客户端连接线程管理</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										连接管理器线程将每个客户端连接与专用于它的线程相关联，该线程处理该连接的身份验证和请求处理。</font>
									<font style="vertical-align: inherit;">管理器线程在必要时创建一个新线程，但首先通过查询线程缓存来查看它是否包含可用于连接的线程，从而避免这样做。</font>
									<font style="vertical-align: inherit;">当连接结束时，如果缓存未满，则将其线程返回到线程缓存。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在此连接线程模型中，存在与当前连接的客户端一样多的线程，当服务器工作负载必须扩展以处理大量连接时，这具有一些缺点。</font>
									<font style="vertical-align: inherit;">例如，线程创建和处理变得昂贵。</font>
									<font style="vertical-align: inherit;">此外，每个线程都需要服务器和内核资源，例如堆栈空间。</font>
									<font style="vertical-align: inherit;">为了容纳大量的并发连接，每个线程的堆栈大小必须保持很小，从而导致它太小或服务器消耗大量内存。</font>
									<font style="vertical-align: inherit;">也可能发生其他资源的耗尽，并且调度开销可能变得很大。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										MySQL企业版包含一个线程池插件，它提供了另一种线程处理模型，旨在减少开销并提高性能。</font>
									<font style="vertical-align: inherit;">它实现了一个线程池，通过有效管理大量客户端连接的语句执行线程来提高服务器性能。</font>
									<font style="vertical-align: inherit;">请参见</font>
								</font><a class="xref" href="server-administration.html#thread-pool" title="5.6.3 MySQL企业线程池">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第5.6.3节“MySQL Enterprise Thread Pool”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										为了控制和监视服务器如何管理处理客户端连接的线程，几个系统和状态变量是相关的。</font>
									<font style="vertical-align: inherit;">（请参见
									</font>
								</font><a class="xref" href="server-administration.html#server-system-variables" title="5.1.8服务器系统变量">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第5.1.8节“服务器系统变量”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">和
									</font>
								</font><a class="xref" href="server-administration.html#server-status-variables" title="5.1.10服务器状态变量">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第5.1.10节“服务器状态变量”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。）
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										所述</font>
								</font><a class="link" href="server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										系统变量确定线程缓存大小。</font>
									<font style="vertical-align: inherit;">默认情况下，服务器在启动时自动调整值，但可以显式设置以覆盖此默认值。</font>
									<font style="vertical-align: inherit;">值为0将禁用缓存，这会导致为每个新连接设置一个线程，并在连接终止时将其丢弃。</font>
									<font style="vertical-align: inherit;">要启用</font>
								</font><em class="replaceable"><code>N</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">非活动连接线程，
									</font>
								</font><a class="link" href="server-administration.html#sysvar_thread_cache_size"><code class="literal">thread_cache_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">请
									</font>
								</font><em class="replaceable"><code>N</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">在服务器启动时或运行时设置。</font>
									<font style="vertical-align: inherit;">当与之关联的客户端连接终止时，连接线程将变为非活动状态。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要监视缓存中的线程数以及由于无法从缓存中获取线程而创建了多少线程，请检查
									</font>
								</font><a class="link" href="server-administration.html#statvar_Threads_cached"><code class="literal">Threads_cached</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">和
									</font>
								</font><a class="link" href="server-administration.html#statvar_Threads_created"><code class="literal">Threads_created</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">状态变量。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										当线程堆栈太小时，这限制了服务器可以处理的SQL语句的复杂性，存储过程的递归深度以及其他消耗内存的操作。</font>
									<font style="vertical-align: inherit;">要</font>
								</font><em class="replaceable"><code>N</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">为每个线程</font>
									<font style="vertical-align: inherit;">设置堆栈大小的
									</font>
									<font style="vertical-align: inherit;">字节，请使用启动服务器
									</font>
								</font><a class="link" href="server-administration.html#sysvar_thread_stack"><code class="literal">thread_stack</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">设置为
									</font>
								</font><em class="replaceable"><code>N</code></em>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">服务器启动。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="client-connections-volume-management"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">连接卷管理</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要控制服务器允许同时连接的最大客户端数，请</font>
								</font><a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">在服务器启动时或运行时</font>
									<font style="vertical-align: inherit;">设置
									</font>
									<font style="vertical-align: inherit;">系统变量。</font>
								</font><a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">如果更多客户端尝试同时连接，则</font>
									<font style="vertical-align: inherit;">可能需要增加
									</font>
									<font style="vertical-align: inherit;">服务器配置为处理（请参见
									</font>
								</font><a class="xref" href="error-handling.html#too-many-connections" title="B.4.2.6连接太多">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第B.4.2.6节“连接太多”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">）。
									</font>
								</font>
							</p>
							<p>
								<a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">mysqld</font>
											</font>
										</strong></span></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">实际上允许
									</font>
								</font><a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										+ 1个客户端连接。</font>
									<font style="vertical-align: inherit;">额外连接保留供具有</font>
								</font><a class="link" href="security.html#priv_connection-admin"><code class="literal">CONNECTION_ADMIN</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">或
									</font>
								</font><a class="link" href="security.html#priv_super"><code class="literal">SUPER</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">特权的</font>
									<font style="vertical-align: inherit;">帐户使用
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">通过向管理员而不是普通用户（不应该使用它）授予权限，管理员可以连接到服务器并用于</font>
								</font><a class="link" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
										PROCESSLIST</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">诊断问题，即使连接了最大数量的非特权客户端也是如此。</font>
									<font style="vertical-align: inherit;">请参见
									</font>
								</font><a class="xref" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST语法">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第13.7.6.29节“SHOW PROCESSLIST语法”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">（服务器还允许在专用接口上进行管理连接。请参阅
									</font>
								</font><a class="xref" href="optimization.html#client-connections-administrative-interface" title="管理连接管理">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">管理连接管理</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。）
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果服务器因为</font>
								</font><a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">达到限制而</font>
									<font style="vertical-align: inherit;">拒绝连接
									</font>
									<font style="vertical-align: inherit;">，则会递增
									</font>
								</font><a class="link" href="server-administration.html#statvar_Connection_errors_max_connections"><code class="literal">Connection_errors_max_connections</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										状态变量。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										MySQL支持的最大连接数（即</font>
								</font><a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">可以设置</font>
									<font style="vertical-align: inherit;">的最大值
									</font>
									<font style="vertical-align: inherit;">）取决于几个因素：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													给定平台上的线程库的质量。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													可用的RAM量。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													RAM的数量用于每个连接。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													每个连接的工作量。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													期望的响应时间。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													可用的文件描述符数。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										Linux或Solaris应该能够支持至少500到1000个并发连接以及多达10,000个连接，如果你有许多GB的可用RAM，并且每个连接的工作负载很低或响应时间目标不高。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										增加该
									</font>
								</font><a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">值会增加</font>
								</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">mysqld</font>
											</font>
										</strong></span></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">所需的</font>
									<font style="vertical-align: inherit;">文件描述符数
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">如果所需的描述符数量不可用，则服务器会减小其值</font>
								</font><a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">有关文件描述符限制的注释，请参见
									</font>
								</font><a class="xref" href="optimization.html#table-cache" title="8.4.3.1 MySQL如何打开和关闭表">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第8.4.3.1节“MySQL如何打开和关闭表”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;"></font><a class="link" href="server-administration.html#sysvar_open_files_limit"><code
									 class="literal">open_files_limit</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">可能需要</font>
									<font style="vertical-align: inherit;">
										增加
									</font>
									<font style="vertical-align: inherit;">系统变量，这可能还需要提高操作系统对MySQL可以使用的文件描述符数量的限制。</font>
									<font style="vertical-align: inherit;">请参阅操作系统文档以确定是否可以增加限制以及如何增加限制。</font>
									<font style="vertical-align: inherit;">另请参见
									</font>
								</font><a class="xref" href="error-handling.html#not-enough-file-handles" title="B.4.2.17找不到文件和类似错误">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第B.4.2.17节“找不到文件和类似错误”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="client-connections-administrative-interface"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">管理连接管理</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										从MySQL 8.0.14开始，服务器允许专门为管理连接配置TCP / IP端口。</font>
									<font style="vertical-align: inherit;">这提供了用于普通连接的网络接口上允许的单个管理连接的替代方法，即使
									</font>
								</font><a class="link" href="server-administration.html#sysvar_max_connections"><code class="literal">max_connections</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">已建立</font>
								</font><a class="xref" href="optimization.html#client-connections-volume-management" title="连接卷管理">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">连接</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">（请参阅
									</font><a class="xref" href="optimization.html#client-connections-volume-management" title="连接卷管理">
										<font style="vertical-align: inherit;">连接卷管理</font>
									</a>
									<font style="vertical-align: inherit;">）。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										管理网络接口具有以下特征：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													仅当</font>
											</font><a class="link" href="server-administration.html#sysvar_admin_address"><code class="literal">admin_address</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">在启动时设置系统变量以指示管理接口的IP地址时，</font>
												<font style="vertical-align: inherit;">该接口才可用
												</font>
												<font style="vertical-align: inherit;">。</font>
												<font style="vertical-align: inherit;">如果未</font>
											</font><a class="link" href="server-administration.html#sysvar_admin_address"><code class="literal">admin_address</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">指定</font>
												<font style="vertical-align: inherit;">任何
												</font>
												<font style="vertical-align: inherit;">值，则服务器不维护管理界面。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													所述</font>
											</font><a class="link" href="server-administration.html#sysvar_admin_port"><code class="literal">admin_port</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">系统变量指定接口的TCP / IP端口号（默认33062）。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													管理连接的数量没有限制。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													只有拥有该</font>
											</font><a class="link" href="security.html#priv_service-connection-admin"><code class="literal">SERVICE_CONNECTION_ADMIN</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													权限的</font>
												<font style="vertical-align: inherit;">用户才允许连接
												</font>
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										该
									</font>
								</font><a class="link" href="server-administration.html#sysvar_create_admin_listener_thread"><code class="literal">create_admin_listener_thread</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										系统变量使DBA在启动时选择使用用于普通的连接监听线程的管理接口是否实现，还是有它自己的独立的线程。</font>
									<font style="vertical-align: inherit;">默认设置是使用用于普通连接的侦听器线程来实现管理接口。
									</font>
								</font>
							</p>
						</div>

					</div>
					<div class="section">
						<div class="titlepage">
							<div>
								<div>
									<h4 class="title"><a name="host-cache"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">8.12.4.2 DNS查找优化和主机缓存</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091701925168"></a><a class="indexterm" name="idm140091701924112"></a><a class="indexterm"
						 name="idm140091701923040"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									MySQL服务器在内存中维护一个主机缓存，其中包含有关客户端的信息：IP地址，主机名和错误信息。</font>
								<font style="vertical-align: inherit;">Performance Schema
								</font>
							</font><a class="link" href="performance-schema.html#host-cache-table" title="26.12.17.1 host_cache表"><code
								 class="literal">host_cache</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表公开了主机缓存的内容，以便可以使用</font>
							</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">语句</font>
								<font style="vertical-align: inherit;">对其进行检查
								</font>
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">这可以帮助您诊断连接问题的原因。</font>
								<font style="vertical-align: inherit;">请参见
								</font>
							</font><a class="xref" href="performance-schema.html#host-cache-table" title="26.12.17.1 host_cache表">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第26.12.17.1节“host_cache表”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

							<div class="admon-title">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										注意
									</font>
								</font>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										服务器仅将主机缓存用于非本地TCP连接。</font>
									<font style="vertical-align: inherit;">它不使用缓存来建立使用环回接口地址建立的TCP连接（例如，
									</font>
								</font><code class="literal">127.0.0.1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">或</font>
								</font><code class="literal">::1</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">），或者使用Unix套接字文件，命名管道或共享内存建立的连接。
									</font>
								</font>
							</p>
						</div>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p><a class="xref" href="optimization.html#host-cache-operation" title="主机缓存操作">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">主机缓存操作</font>
											</font>
										</a></p>
								</li>
								<li class="listitem">
									<p><a class="xref" href="optimization.html#host-cache-configuration" title="主机缓存配置">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">主机缓存配置</font>
											</font>
										</a></p>
								</li>
							</ul>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="host-cache-operation"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">主机缓存操作</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										服务器将主机缓存用于以下目的：
									</font>
								</font>
							</p>
							<div class="itemizedlist">
								<ul class="itemizedlist" style="list-style-type: disc; ">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													通过缓存IP到主机名称查找的结果，服务器可以避免为每个客户端连接执行域名系统（DNS）查找。</font>
												<font style="vertical-align: inherit;">相反，对于给定的主机，它只需要为该主机的第一个连接执行查找。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													缓存包含有关连接过程中发生的错误的信息。</font>
												<font style="vertical-align: inherit;">一些错误被认为是</font>
											</font><span class="quote">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">“ </font>
												</font><span class="quote">
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">阻塞”。</font>
													</font>
												</span>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">“</font>
												</font>
											</span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">如果在没有成功连接的情况下从给定主机连续发生过多这些，则服务器会阻止来自该主机的进一步连接。</font>
												<font style="vertical-align: inherit;">的
												</font>
											</font><a class="link" href="server-administration.html#sysvar_max_connect_errors"><code class="literal">max_connect_errors</code></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													系统变量决定连续误差的允许数量发生阻塞（参见前
												</font>
											</font><a class="xref" href="error-handling.html#blocked-host" title="B.4.2.5主机'host_name'被阻止">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">节B.4.2.5，“主机‘的host_name’被阻塞”</font>
												</font>
											</a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">）。
												</font>
											</font>
										</p>
									</li>
								</ul>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										对于每个新客户端连接，服务器使用客户端IP地址检查客户端主机名是否在主机缓存中。</font>
									<font style="vertical-align: inherit;">如果是，则服务器拒绝或继续处理连接请求，具体取决于主机是否被阻止。</font>
									<font style="vertical-align: inherit;">如果主机不在缓存中，则服务器会尝试解析主机名。</font>
									<font style="vertical-align: inherit;">首先，它将IP地址解析为主机名，并将该主机名解析回IP地址。</font>
									<font style="vertical-align: inherit;">然后，它将结果与原始IP地址进行比较，以确保它们相同。</font>
									<font style="vertical-align: inherit;">服务器将有关此操作结果的信息存储在主机缓存中。</font>
									<font style="vertical-align: inherit;">如果缓存已满，则丢弃最近最少使用的条目。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										服务器处理主机缓存中的条目，如下所示：
									</font>
								</font>
							</p>
							<div class="orderedlist">
								<ol class="orderedlist" type="1">
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													当第一个TCP客户端连接从给定IP地址到达服务器时，将创建一个新的缓存条目以记录客户端IP，主机名和客户端查找验证标志。</font>
												<font style="vertical-align: inherit;">最初，主机名设置为
												</font>
											</font><code class="literal">NULL</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，标志为false。</font>
												<font style="vertical-align: inherit;">此条目还用于来自同一发起IP的后续客户端TCP连接。
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果客户端IP条目的验证标志为false，则服务器尝试IP到主机的名称到IP DNS解析。</font>
												<font style="vertical-align: inherit;">如果成功，则使用已解析的主机名更新主机名，并将验证标志设置为true。</font>
												<font style="vertical-align: inherit;">如果解决方案不成功，则采取的措施取决于错误是永久性还是暂时性。</font>
												<font style="vertical-align: inherit;">对于永久性故障，主机名仍然存在</font>
											</font><code class="literal">NULL</code>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，验证标志设置为true。</font>
												<font style="vertical-align: inherit;">对于瞬态故障，主机名和验证标志保持不变。</font>
												<font style="vertical-align: inherit;">（在这种情况下，下次客户端从此IP连接时会发生另一次DNS解析尝试。）
												</font>
											</font>
										</p>
									</li>
									<li class="listitem">
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果在处理来自给定IP地址的传入客户端连接时发生错误，则服务器会更新该IP条目中的相应错误计数器。</font>
												<font style="vertical-align: inherit;">有关记录的错误的说明，请参见
												</font>
											</font><a class="xref" href="performance-schema.html#host-cache-table" title="26.12.17.1 host_cache表">
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">第26.12.17.1节“host_cache表”</font>
												</font>
											</a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">。
												</font>
											</font>
										</p>
									</li>
								</ol>
							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										服务器使用</font>
								</font><code class="function">gethostbyaddr()</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">和
									</font>
								</font><code class="function">gethostbyname()</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">系统调用</font>
									<font style="vertical-align: inherit;">执行主机名解析
									</font>
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要取消阻止被阻止的主机，请通过执行</font>
									<font style="vertical-align: inherit;">语句，截断Performance Schema </font>
									<font style="vertical-align: inherit;">表</font>
								</font><a class="link" href="sql-syntax.html#flush-hosts"><code class="literal">FLUSH HOSTS</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">的
									</font>
								</font><a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE语法"><code class="literal">TRUNCATE
										TABLE</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">语句
									</font>
								</font><a class="link" href="performance-schema.html#host-cache-table" title="26.12.17.1 host_cache表"><code
									 class="literal">host_cache</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">或
									</font>
								</font><a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin  - 管理MySQL服务器的客户端"><span class="command"><strong>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">mysqladmin flush-hosts</font>
											</font>
										</strong></span></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">命令</font>
									<font style="vertical-align: inherit;">来刷新主机缓存</font>
									<font style="vertical-align: inherit;">。
									</font>
								</font><a class="link" href="sql-syntax.html#flush-hosts"><code class="literal">FLUSH HOSTS</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">和
									</font>
								</font><a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin  - 管理MySQL服务器的客户端"><span class="command"><strong>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">mysqladmin flush-hosts</font>
											</font>
										</strong></span></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">需要
									</font>
								</font><a class="link" href="security.html#priv_reload"><code class="literal">RELOAD</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">特权。
									</font>
								</font><a class="link" href="sql-syntax.html#truncate-table" title="13.1.37 TRUNCATE TABLE语法"><code class="literal">TRUNCATE
										TABLE</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">需要</font>
									<font style="vertical-align: inherit;">表</font>
									<font style="vertical-align: inherit;">的
									</font>
								</font><a class="link" href="security.html#priv_drop"><code class="literal">DROP</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">权限
									</font>
								</font><a class="link" href="performance-schema.html#host-cache-table" title="26.12.17.1 host_cache表"><code
									 class="literal">host_cache</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果自上次连接尝试来自被阻止主机的活动后发生其他主机的活动，则即使没有刷新主机缓存，也可以解除阻塞主机的阻塞。</font>
									<font style="vertical-align: inherit;">发生这种情况的原因是，当连接从不在缓存中的客户端IP到达时，如果缓存已满，则服务器会丢弃最近最少使用的缓存条目以为新条目腾出空间。</font>
									<font style="vertical-align: inherit;">如果丢弃的条目用于被阻止的主机，则该主机将被解除阻止。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										某些连接错误与TCP连接无关，在连接过程中很早就会发生（甚至在知道IP地址之前），或者不是特定于任何特定IP地址（例如内存不足情况）。</font>
									<font style="vertical-align: inherit;">有关这些错误的信息，请检查
									</font>
									<font style="vertical-align: inherit;">
										状态变量（请参见
									</font><a class="xref" href="server-administration.html#server-status-variables" title="5.1.10服务器状态变量">
										<font style="vertical-align: inherit;">第5.1.10节“服务器状态变量”</font>
									</a>
									<font style="vertical-align: inherit;">）。
									</font>
								</font><a class="link" href="server-administration.html#statvar_Connection_errors_xxx"><code class="literal">Connection_errors_<em
										 class="replaceable"><code>xxx</code></em></code></a>
								<font style="vertical-align: inherit;"></font><a class="xref" href="server-administration.html#server-status-variables"
								 title="5.1.10服务器状态变量">
									<font style="vertical-align: inherit;"></font>
								</a>
								<font style="vertical-align: inherit;"></font>
							</p>
						</div>
						<div class="simplesect">
							<div class="titlepage">
								<div>
									<div class="simple">
										<h5 class="title"><a name="host-cache-configuration"></a>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">主机缓存配置</font>
											</font>
										</h5>

									</div>

								</div>

							</div>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										默认情况下启用主机缓存。</font>
									<font style="vertical-align: inherit;">该
									</font>
								</font><a class="link" href="server-administration.html#sysvar_host_cache_size"><code class="literal">host_cache_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">系统变量控制它的大小，以及绩效模式的大小</font>
								</font><a class="link" href="performance-schema.html#host-cache-table" title="26.12.17.1 host_cache表"><code
									 class="literal">host_cache</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										暴露缓存目录。</font>
									<font style="vertical-align: inherit;">可以在服务器启动时设置缓存大小，并在运行时更改。</font>
									<font style="vertical-align: inherit;">例如，要在启动时将大小设置为100，请将这些行放在服务器</font>
								</font><code class="filename">my.cnf</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">文件中：
									</font>
								</font>
							</p>
							<pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的[mysqld]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
host_cache_size = 200</font></font><font></font>
</pre>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要在运行时将大小更改为300，请执行以下操作：
									</font>
								</font>
							</p>
							<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET GLOBAL host_cache_size = 300;
</font></font></pre>
							<p>
								<font style="vertical-align: inherit;"></font><code class="literal">host_cache_size</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">在服务器启动或运行时</font>
									<font style="vertical-align: inherit;">
										设置</font>
									<font style="vertical-align: inherit;">为0会禁用主机缓存。</font>
									<font style="vertical-align: inherit;">禁用缓存后，服务器会在每次客户端连接时执行DNS查找。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在运行时更改缓存大小会导致隐式
									</font>
								</font><a class="link" href="sql-syntax.html#flush-hosts"><code class="literal">FLUSH HOSTS</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">操作清除主机缓存，从而截断
									</font>
								</font><a class="link" href="performance-schema.html#host-cache-table" title="26.12.17.1 host_cache表"><code
									 class="literal">host_cache</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表并取消阻止任何被阻止的主机。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										使用该</font>
								</font><a class="link" href="server-administration.html#option_mysqld_skip-host-cache"><code class="option">--skip-host-cache</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										选项类似于将</font>
								</font><a class="link" href="server-administration.html#sysvar_host_cache_size"><code class="literal">host_cache_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">系统变量</font>
									<font style="vertical-align: inherit;">设置
									</font>
									<font style="vertical-align: inherit;">为0，但
									</font>
								</font><a class="link" href="server-administration.html#sysvar_host_cache_size"><code class="literal">host_cache_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">更灵活，因为它还可用于在运行时调整大小，启用和禁用主机缓存，而不仅仅是在服务器启动时。</font>
									<font style="vertical-align: inherit;">启动服务器
									</font>
								</font><a class="link" href="server-administration.html#option_mysqld_skip-host-cache"><code class="option">--skip-host-cache</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">并不会阻止更改值
									</font>
								</font><a class="link" href="server-administration.html#sysvar_host_cache_size"><code class="literal">host_cache_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，但这些更改不起作用，即使</font>
								</font><a class="link" href="server-administration.html#sysvar_host_cache_size"><code class="literal">host_cache_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">在运行时将大于0设置</font>
									<font style="vertical-align: inherit;">为高速缓存，也不会重新启用高速缓存</font>
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要禁用DNS主机名查找，请使用该</font>
								</font><a class="link" href="server-administration.html#option_mysqld_skip-name-resolve"><code class="option">--skip-name-resolve</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">选项</font>
									<font style="vertical-align: inherit;">启动服务器
									</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">在这种情况下，服务器仅使用IP地址而不使用主机名来匹配连接主机与MySQL授权表中的行。</font>
									<font style="vertical-align: inherit;">只能使用使用IP地址在这些表中指定的帐户。</font>
									<font style="vertical-align: inherit;">（如果不存在指定客户端IP地址的帐户，则客户端可能无法连接。）
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										如果您的DNS和许多主机速度非常慢，您可以通过使用</font>
								</font><a class="link" href="server-administration.html#option_mysqld_skip-name-resolve"><code class="option">--skip-name-resolve</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">或通过增加
									</font>
									<font style="vertical-align: inherit;">DNS查找</font>
								</font><a class="link" href="server-administration.html#sysvar_host_cache_size"><code class="literal">host_cache_size</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">来使主机缓存更大</font>
									<font style="vertical-align: inherit;">来提高性能</font>
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										要完全禁止TCP / IP连接，请使用该</font>
								</font><a class="link" href="server-administration.html#option_mysqld_skip-networking"><code class="option">--skip-networking</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										选项</font>
									<font style="vertical-align: inherit;">启动服务器</font>
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</div>

					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="resource-groups"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.12.5资源组</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091701851344"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								MySQL支持资源组的创建和管理，并允许将服务器内运行的线程分配给特定组，以便线程根据组可用的资源执行。</font>
							<font style="vertical-align: inherit;">组属性可以控制其资源，以启用或限制组中线程的资源消耗。</font>
							<font style="vertical-align: inherit;">DBA可以根据不同的工作负载修改这些属性。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								目前，CPU时间是可管理的资源，由</font>
						</font><span class="quote">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">“ </font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">虚拟CPU</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> ”</font>
							</font>
						</span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">的概念表示</font>
							<font style="vertical-align: inherit;">为包括CPU核心，超线程，硬件线程等的术语。</font>
							<font style="vertical-align: inherit;">服务器在启动时确定可用的虚拟CPU数量，具有适当权限的数据库管理员可以将这些CPU与资源组关联，并将线程分配给组。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								例如，要管理不需要以高优先级执行的批处理作业的执行，DBA可以创建
							</font>
						</font><code class="literal">Batch</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">资源组，并根据服务器的繁忙程度向上或向下调整其优先级。</font>
							<font style="vertical-align: inherit;">（也许分配给该组的批处理作业应该在白天以较低的优先级运行，在夜间以较高的优先级运行。）DBA还可以调整该组可用的CPU集。</font>
							<font style="vertical-align: inherit;">可以启用或禁用组来控制线程是否可分配给它们。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下部分描述了MySQL中资源组使用的各个方面：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p><a class="xref" href="optimization.html#resource-group-components" title="资源组组件">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组组件</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#resource-group-attributes" title="资源组属性">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组属性</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#resource-group-management" title="资源组管理">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组管理</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#resource-group-replication" title="资源组复制">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组复制</font>
										</font>
									</a></p>
							</li>
							<li class="listitem">
								<p><a class="xref" href="optimization.html#resource-group-restrictions" title="资源组限制">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组限制</font>
										</font>
									</a></p>
							</li>
						</ul>
					</div>

					<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

						<div class="admon-title">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									重要
								</font>
							</font>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在某些平台或MySQL服务器配置上，资源组不可用或具有限制。</font>
								<font style="vertical-align: inherit;">特别是，对于某些安装方法，Linux系统可能需要手动步骤。</font>
								<font style="vertical-align: inherit;">有关详细信息，请参阅
								</font>
							</font><a class="xref" href="optimization.html#resource-group-restrictions" title="资源组限制">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">资源组限制</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="resource-group-components"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组组件</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这些功能为MySQL中的资源组管理提供了SQL接口：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												SQL语句支持创建，更改和删除资源组，并允许将线程分配给资源组。</font>
											<font style="vertical-align: inherit;">优化程序提示可以将单个语句分配给资源组。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												资源组权限可控制哪些用户可以执行资源组操作。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该
											</font>
										</font><a class="link" href="information-schema.html#resource-groups-table" title="25.22 INFORMATION_SCHEMA RESOURCE_GROUPS表"><code
											 class="literal">INFORMATION_SCHEMA.RESOURCE_GROUPS</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												表公开有关资源组定义的信息，而Performance Schema
											</font>
										</font><a class="link" href="performance-schema.html#threads-table" title="26.12.17.5线程表"><code class="literal">threads</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表显示每个线程的资源组分配。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												状态变量为每个管理SQL语句提供执行计数。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="resource-group-attributes"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组属性</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091701828512"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									资源组具有定义组的属性。</font>
								<font style="vertical-align: inherit;">可以在创建组时设置所有属性。</font>
								<font style="vertical-align: inherit;">某些属性在创建时被修复; </font>
								<font style="vertical-align: inherit;">其他人可以在此后的任何时间修改。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这些属性在资源组创建时定义，无法修改：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												每个组都有一个名字。</font>
											<font style="vertical-align: inherit;">资源组名称是表和列名称之类的标识符，不需要在SQL语句中引用，除非它们包含特殊字符或保留字。</font>
											<font style="vertical-align: inherit;">组名称不区分大小写，最长可达64个字符。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												每个组都有一个类型，或者是
											</font>
										</font><code class="literal">SYSTEM</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">或者</font>
										</font><code class="literal">USER</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">资源组类型会影响可分配给组的优先级值范围，如稍后所述。</font>
											<font style="vertical-align: inherit;">此属性与允许的优先级的差异一起使得能够识别系统线程，以便保护它们免于针对用户线程争用CPU资源。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												系统和用户线程对应于Performance Schema </font>
										</font><a class="link" href="performance-schema.html#threads-table" title="26.12.17.5线程表"><code class="literal">threads</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">表中</font>
											<font style="vertical-align: inherit;">列出的后台和前台线程
											</font>
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这些属性在资源组创建时定义，并且可以在以后的任何时间进行修改：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												CPU亲缘关系是资源组可以使用的一组虚拟CPU。</font>
											<font style="vertical-align: inherit;">亲和关系可以是可用CPU的任何非空子集。</font>
											<font style="vertical-align: inherit;">如果组没有亲缘关系，则可以使用所有可用的CPU。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												线程优先级是分配给资源组的线程的执行优先级。</font>
											<font style="vertical-align: inherit;">优先级值范围从-20（最高优先级）到19（最低优先级）。</font>
											<font style="vertical-align: inherit;">系统组和用户组的默认优先级均为0。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												系统组的优先级高于用户组，确保用户线程的优先级不会高于系统线程：
											</font>
										</font>
									</p>
									<div class="itemizedlist">
										<ul class="itemizedlist" style="list-style-type: circle; ">
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															对于系统资源组，允许的优先级范围是-20到0。
														</font>
													</font>
												</p>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															对于用户资源组，允许的优先级范围是0到19。
														</font>
													</font>
												</p>
											</li>
										</ul>
									</div>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												可以启用或禁用每个组，从而使管理员可以控制线程分配。</font>
											<font style="vertical-align: inherit;">线程只能分配给已启用的组。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="resource-group-management"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组管理</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091701811440"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									默认情况下，有一个系统组和一个用户组</font>
								<font style="vertical-align: inherit;">，分别</font>
								<font style="vertical-align: inherit;">名为</font>
							</font><code class="literal">SYS_default</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">USR_default</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。</font>
								<font style="vertical-align: inherit;">无法删除这些默认组，并且无法修改其属性。</font>
								<font style="vertical-align: inherit;">每个默认组都没有CPU关联，优先级为0。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									新创建的系统和用户线程分别分配给
								</font>
							</font><code class="literal">SYS_default</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">和
								</font>
							</font><code class="literal">USR_default</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">组。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									对于用户定义的资源组，将在创建组时分配所有属性。</font>
								<font style="vertical-align: inherit;">创建组后，可以修改其属性，但名称和类型属性除外。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要创建和管理用户定义的资源组，请使用以下SQL语句：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<a class="link" href="sql-syntax.html#create-resource-group" title="13.7.2.2 CREATE RESOURCE GROUP语法"><code
											 class="literal">CREATE RESOURCE GROUP</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												创建一个新组。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#create-resource-group" title="13.7.2.2 CREATE RESOURCE GROUP语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.7.2.2节“CREATE RESOURCE GROUP语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<a class="link" href="sql-syntax.html#alter-resource-group" title="13.7.2.1 ALTER RESOURCE GROUP语法"><code
											 class="literal">ALTER RESOURCE GROUP</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												修改现有组。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#alter-resource-group" title="13.7.2.1 ALTER RESOURCE GROUP语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.7.2.1节“ALTER RESOURCE GROUP语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<a class="link" href="sql-syntax.html#drop-resource-group" title="13.7.2.3 DROP RESOURCE GROUP语法"><code class="literal">DROP
												RESOURCE GROUP</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">删除现有组。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#drop-resource-group" title="13.7.2.3 DROP RESOURCE GROUP语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.7.2.3节“DROP RESOURCE GROUP语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这些陈述需要
								</font>
							</font><a class="link" href="security.html#priv_resource-group-admin"><code class="literal">RESOURCE_GROUP_ADMIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">特权。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要管理资源组分配，请使用以下功能：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<a class="link" href="sql-syntax.html#set-resource-group" title="13.7.2.4 SET RESOURCE GROUP语法"><code class="literal">SET
												RESOURCE GROUP</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">将线程分配给组。</font>
											<font style="vertical-align: inherit;">请参见
											</font>
										</font><a class="xref" href="sql-syntax.html#set-resource-group" title="13.7.2.4 SET RESOURCE GROUP语法">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第13.7.2.4节“SET RESOURCE GROUP语法”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												该</font>
										</font><a class="link" href="optimization.html#optimizer-hints-resource-group" title="资源组提示语法"><code class="literal">RESOURCE_GROUP</code></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												优化程序提示指定单个语句的一组。</font>
											<font style="vertical-align: inherit;">请参见</font>
										</font><a class="xref" href="optimization.html#optimizer-hints" title="8.9.3优化器提示">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">第8.9.3节“优化程序提示”</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。
											</font>
										</font>
									</p>
								</li>
							</ul>
						</div>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									这些操作需要
								</font>
							</font><a class="link" href="security.html#priv_resource-group-admin"><code class="literal">RESOURCE_GROUP_ADMIN</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">或
								</font>
							</font><a class="link" href="security.html#priv_resource-group-user"><code class="literal">RESOURCE_GROUP_USER</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">特权。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									资源组定义存储在
								</font>
							</font><code class="literal">resource_groups</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">数据字典表中，以便组在服务器重新启动时保持不变。</font>
								<font style="vertical-align: inherit;">因为
								</font>
							</font><code class="literal">resource_groups</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">它是数据字典的一部分，所以用户无法直接访问它。</font>
								<font style="vertical-align: inherit;">使用</font>
							</font><a class="link" href="information-schema.html#resource-groups-table" title="25.22 INFORMATION_SCHEMA RESOURCE_GROUPS表"><code
								 class="literal">INFORMATION_SCHEMA.RESOURCE_GROUPS</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表</font>
								<font style="vertical-align: inherit;">可以获得资源组信息，该
								</font>
								<font style="vertical-align: inherit;">表作为数据字典表上的视图实现。</font>
								<font style="vertical-align: inherit;">请参见</font>
							</font><a class="xref" href="information-schema.html#resource-groups-table" title="25.22 INFORMATION_SCHEMA RESOURCE_GROUPS表">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">第25.22节“INFORMATION_SCHEMA RESOURCE_GROUPS表”</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									最初，该</font>
							</font><a class="link" href="information-schema.html#resource-groups-table" title="25.22 INFORMATION_SCHEMA RESOURCE_GROUPS表"><code
								 class="literal">RESOURCE_GROUPS</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									表具有描述默认组的这些行：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.RESOURCE_GROUPS\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   RESOURCE_GROUP_NAME：USR_default</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   RESOURCE_GROUP_TYPE：USER</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RESOURCE_GROUP_ENABLED：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              VCPU_IDS：0-3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       THREAD_PRIORITY：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 2.排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   RESOURCE_GROUP_NAME：SYS_default</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   RESOURCE_GROUP_TYPE：SYSTEM</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RESOURCE_GROUP_ENABLED：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              VCPU_IDS：0-3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       THREAD_PRIORITY：0</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									的</font>
							</font><code class="literal">THREAD_PRIORITY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值是0，表示默认的优先级。</font>
								<font style="vertical-align: inherit;">的
								</font>
							</font><code class="literal">VCPU_IDS</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值示出了包括所有可用CPU的范围内。</font>
								<font style="vertical-align: inherit;">对于默认组，显示的值会根据运行MySQL服务器的系统而有所不同。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									前面的讨论提到了一个涉及一个资源组的场景，该资源组命名</font>
							</font><code class="literal">Batch</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">为管理不需要以高优先级执行的批处理作业的执行。</font>
								<font style="vertical-align: inherit;">要创建这样的组，请使用与此类似的语句：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE RESOURCE GROUP批处理</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  TYPE = USER</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  VCPU = 2-3  - 假设系统至少有4个CPU</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  THREAD_PRIORITY = 10;</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要验证资源组是否按预期创建，请检查</font>
							</font><a class="link" href="information-schema.html#resource-groups-table" title="25.22 INFORMATION_SCHEMA RESOURCE_GROUPS表"><code
								 class="literal">RESOURCE_GROUPS</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">表：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT * FROM INFORMATION_SCHEMA.RESOURCE_GROUPS</code></strong>
       <strong class="userinput"><code>WHERE RESOURCE_GROUP_NAME = 'Batch'\G</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
*************************** 1。排******************** *******</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   RESOURCE_GROUP_NAME：批处理</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   RESOURCE_GROUP_TYPE：USER</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RESOURCE_GROUP_ENABLED：1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              VCPU_IDS：2-3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       THREAD_PRIORITY：10</font></font><font></font>
</pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果</font>
							</font><code class="literal">THREAD_PRIORITY</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">值为0而不是10，请检查您的平台或系统配置是否限制资源组功能; </font>
								<font style="vertical-align: inherit;">请参阅
								</font>
							</font><a class="xref" href="optimization.html#resource-group-restrictions" title="资源组限制">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">资源组限制</font>
								</font>
							</a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要将线程分配给</font>
							</font><code class="literal">Batch</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">组，请执行以下操作：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET RESOURCE GROUP Batch FOR </font></font><em class="replaceable"><code>thread_id</code></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									此后，命名线程中的语句将使用</font>
							</font><code class="literal">Batch</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">组资源</font>
								<font style="vertical-align: inherit;">执行
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									如果会话自己的当前线程应该在
								</font>
							</font><code class="literal">Batch</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">组中，请在会话中执行以下语句：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET RESOURCE GROUP Batch;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									此后，会话中的语句将使用</font>
							</font><code class="literal">Batch</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">组资源</font>
								<font style="vertical-align: inherit;">执行
								</font>
								<font style="vertical-align: inherit;">。
								</font>
							</font>
						</p>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									要使用</font>
							</font><code class="literal">Batch</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">组</font>
								<font style="vertical-align: inherit;">执行单个语句
								</font>
								<font style="vertical-align: inherit;">，请使用
								</font>
							</font><a class="link" href="optimization.html#optimizer-hints-resource-group" title="资源组提示语法"><code class="literal">RESOURCE_GROUP</code></a>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">优化程序提示：
								</font>
							</font>
						</p>
						<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSERT / * + RESOURCE_GROUP（批量）* / INTO t2 VALUES（2）;
</font></font></pre>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									分配给</font>
							</font><code class="literal">Batch</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">组的</font>
								<font style="vertical-align: inherit;">线程</font>
								<font style="vertical-align: inherit;">使用其资源执行，可以根据需要进行修改：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于系统高负载的时间，减少分配给该组的CPU数量，降低其优先级，或者（如图所示）：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER RESOURCE GROUP批处理</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  VCPU = 3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  THREAD_PRIORITY = 19;</font></font><font></font>
</pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												对于系统负载较轻的时间，增加分配给组的CPU数量，提高其优先级，或者（如图所示）：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER RESOURCE GROUP批处理</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  VCPU = 0-3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  THREAD_PRIORITY = 0;</font></font><font></font>
</pre>
								</li>
							</ul>
						</div>

					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="resource-group-replication"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组复制</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091701748576"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									资源组管理是发生它的服务器的本地管理。</font>
								<font style="vertical-align: inherit;">资源组SQL语句和对</font>
							</font><code class="literal">resource_groups</code>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">数据字典表的</font>
								<font style="vertical-align: inherit;">修改
								</font>
								<font style="vertical-align: inherit;">不会写入二进制日志，也不会被复制。
								</font>
							</font>
						</p>
					</div>
					<div class="simplesect">
						<div class="titlepage">
							<div>
								<div class="simple">
									<h4 class="title"><a name="resource-group-restrictions"></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">资源组限制</font>
										</font>
									</h4>

								</div>

							</div>

						</div>
						<a class="indexterm" name="idm140091701744448"></a><a class="indexterm" name="idm140091701742960"></a>
						<p>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">
									在某些平台或MySQL服务器配置上，资源组不可用或具有限制：
								</font>
							</font>
						</p>
						<div class="itemizedlist">
							<ul class="itemizedlist" style="list-style-type: disc; ">
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果安装了线程池插件，则资源组不可用。
											</font>
										</font>
									</p><a class="indexterm" name="idm140091701739920"></a>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												资源组在macOS上不可用，它不提供用于将CPU绑定到线程的API。
											</font>
										</font>
									</p>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在FreeBSD和Solaris上，忽略资源组线程优先级。</font>
											<font style="vertical-align: inherit;">（实际上，所有线程都以优先级0运行。）尝试更改优先级会导致警告：
											</font>
										</font>
									</p>
									<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>ALTER RESOURCE GROUP abc THREAD_PRIORITY = 10;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
查询正常，0行受影响，1警告（0.18秒）</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQL的&gt; </font></font><strong class="userinput"><code>SHOW WARNINGS;</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + ------ + -------------------------------- ----------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">等级| </font><font style="vertical-align: inherit;">代码| </font><font style="vertical-align: inherit;">消息|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + ------ + -------------------------------- ----------------------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">警告| </font><font style="vertical-align: inherit;">4560 | </font><font style="vertical-align: inherit;">忽略属性thread_priority（使用默认值）。</font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ --------- + ------ + -------------------------------- ----------------------------- +</font></font><font></font>
</pre>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在Linux上，除非</font>
										</font><code class="literal">CAP_SYS_NICE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">设置</font>
											<font style="vertical-align: inherit;">了</font>
											<font style="vertical-align: inherit;">功能，</font>
											<font style="vertical-align: inherit;">否则将忽略资源组线程优先级</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">授予</font>
										</font><code class="literal">CAP_SYS_NICE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">流程功能可以实现一系列权限; </font>
											<font style="vertical-align: inherit;">
												有关完整列表，</font>
											<font style="vertical-align: inherit;">请参阅
											</font>
										</font><a class="ulink" href="http://man7.org/linux/man-pages/man7/capabilities.7.html" target="_top">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">http://man7.org/linux/man-pages/man7/capabilities.7.html</font>
											</font>
										</a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">启用此功能时请小心。
											</font>
										</font>
									</p>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在使用systemd和内核支持Ambient Capabilities（Linux 4.3或更高版本）的Linux平台上，启用</font>
										</font><code class="literal">CAP_SYS_NICE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">功能</font>
											<font style="vertical-align: inherit;">的推荐方法</font>
											<font style="vertical-align: inherit;">是修改MySQL服务文件并保持</font>
										</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysqld</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">二进制</font>
											<font style="vertical-align: inherit;">文件不被
											</font>
											<font style="vertical-align: inherit;">修改。</font>
											<font style="vertical-align: inherit;">要调整MySQL的服务文件，请使用以下过程：
											</font>
										</font>
									</p>
									<div class="orderedlist">
										<ol class="orderedlist" type="1">
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															为您的平台运行适当的命令：
														</font>
													</font>
												</p>
												<div class="itemizedlist">
													<ul class="itemizedlist" style="list-style-type: circle; ">
														<li class="listitem">
															<p>
																<font style="vertical-align: inherit;">
																	<font style="vertical-align: inherit;">
																		Oracle Linux，Red Hat和Fedora系统：
																	</font>
																</font>
															</p>
															<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>sudo systemctl edit mysqld</code></strong>
</pre>
														</li>
														<li class="listitem">
															<p>
																<font style="vertical-align: inherit;">
																	<font style="vertical-align: inherit;">
																		SUSE，Ubuntu和Debian系统：
																	</font>
																</font>
															</p>
															<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳&gt; </font></font><strong class="userinput"><code>sudo systemctl edit mysql</code></strong>
</pre>
														</li>
													</ul>
												</div>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															使用编辑器，将以下文本添加到服务文件中：
														</font>
													</font>
												</p>
												<pre data-lang="ini" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[服务]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AmbientCapabilities = CAP_SYS_NICE</font></font><font></font>
</pre>
											</li>
											<li class="listitem">
												<p>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">
															重启MySQL服务。
														</font>
													</font>
												</p>
											</li>
										</ol>
									</div>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												如果您无法启用</font>
										</font><code class="literal">CAP_SYS_NICE</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												刚才描述</font>
											<font style="vertical-align: inherit;">的</font>
											<font style="vertical-align: inherit;">功能，可以使用</font>
										</font><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">setcap</font>
												</font>
											</strong></span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">命令</font>
											<font style="vertical-align: inherit;">手动设置</font>
											<font style="vertical-align: inherit;">，指定</font>
										</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysqld</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">可执行文件</font>
											<font style="vertical-align: inherit;">的路径名</font>
											<font style="vertical-align: inherit;">（这需要</font>
										</font><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">sudo</font>
												</font>
											</strong></span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">访问权限）。</font>
											<font style="vertical-align: inherit;">您可以使用</font>
										</font><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">getcap</font>
												</font>
											</strong></span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">检查功能</font>
											<font style="vertical-align: inherit;">。</font>
											<font style="vertical-align: inherit;">例如：
											</font>
										</font>
									</p>
									<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font><font style="vertical-align: inherit;">
shell&gt; </font><font style="vertical-align: inherit;">= cap_sys_nice + ep
</font></font><strong class="userinput"><code>sudo setcap cap_sys_nice+ep <em class="replaceable"><code>/path/to/mysqld</code></em></code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>getcap <em class="replaceable"><code>/path/to/mysqld</code></em></code></strong>
<em class="replaceable"><code>/path/to/mysqld</code></em><font style="vertical-align: inherit;"></font></pre>
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												作为安全措施，将</font>
										</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">mysqld</font>
													</font>
												</strong></span></a>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">二进制文件的</font>
											<font style="vertical-align: inherit;">执行限制为
											</font>
										</font><code class="literal">root</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">具有</font>
										</font><code class="literal">mysql</code>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">组成员身份</font>
											<font style="vertical-align: inherit;">的
											</font>
											<font style="vertical-align: inherit;">用户和用户
											</font>
											<font style="vertical-align: inherit;">：
											</font>
										</font>
									</p>
									<pre data-lang="terminal" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell&gt; </font><font style="vertical-align: inherit;">
shell&gt;</font></font><strong class="userinput"><code>sudo chown root:mysql <em class="replaceable"><code>/path/to/mysqld</code></em></code></strong><font style="vertical-align: inherit;"></font><strong class="userinput"><code>sudo chmod 0750 <em class="replaceable"><code>/path/to/mysqld</code></em></code></strong>
</pre>
									<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

										<div class="admon-title">
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													重要
												</font>
											</font>
										</div>
										<p>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">
													如果需要手动使用</font>
											</font><span class="command"><strong>
													<font style="vertical-align: inherit;">
														<font style="vertical-align: inherit;">setcap</font>
													</font>
												</strong></span>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">，则必须在每次重新安装后执行。
												</font>
											</font>
										</p>
									</div>
								</li>
								<li class="listitem">
									<p>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">
												在Windows上，线程以五个线程优先级之一运行。</font>
											<font style="vertical-align: inherit;">资源组线程优先级范围-20到19映射到这些级别，如下表所示。
											</font>
										</font>
									</p>
									<div class="table">
										<a name="windows-thread-priority-table"></a>
										<p class="title"><b>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">表8.3 Windows上的资源组线程优先级</font>
												</font>
											</b></p>
										<div class="table-contents">
											<table summary="Priority ranges for resource group threads on Windows.">
												<colgroup>
													<col width="20%">
													<col width="40%">
												</colgroup>
												<thead>
													<tr>
														<th scope="col">
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">优先范围</font>
															</font>
														</th>
														<th scope="col">
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">Windows优先级</font>
															</font>
														</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td scope="row">
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">-20到-10</font>
															</font>
														</td>
														<td><code class="literal">THREAD_PRIORITY_HIGHEST</code></td>
													</tr>
													<tr>
														<td scope="row">
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">-9到-1</font>
															</font>
														</td>
														<td><code class="literal">THREAD_PRIORITY_ABOVE_NORMAL</code></td>
													</tr>
													<tr>
														<td scope="row">
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">0</font>
															</font>
														</td>
														<td><code class="literal">THREAD_PRIORITY_NORMAL</code></td>
													</tr>
													<tr>
														<td scope="row">
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">1到10</font>
															</font>
														</td>
														<td><code class="literal">THREAD_PRIORITY_BELOW_NORMAL</code></td>
													</tr>
													<tr>
														<td scope="row">
															<font style="vertical-align: inherit;">
																<font style="vertical-align: inherit;">11至19</font>
															</font>
														</td>
														<td><code class="literal">THREAD_PRIORITY_LOWEST</code></td>
													</tr>
												</tbody>
											</table>
										</div>

									</div>
									<br class="table-break">
								</li>
							</ul>
						</div>

					</div>

				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="optimize-benchmarking"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.13衡量绩效（基准）</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#select-benchmarking">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.13.1测量表达式和函数的速度</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#custom-benchmarks">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.13.2使用您自己的基准</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#monitoring-performance-schema">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.13.3使用performance_schema测量性能</font>
									</font>
								</a></span></dt></dl>
				</div>
				<a class="indexterm" name="idm140091701678416"></a>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							要衡量绩效，请考虑以下因素：
						</font>
					</font>
				</p>
				<div class="itemizedlist">
					<ul class="itemizedlist" style="list-style-type: disc; ">
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										无论您是在安静系统上测量单个操作的速度，还是</font>
									<font style="vertical-align: inherit;">在一段时间内</font>
									<font style="vertical-align: inherit;">如何操作一组操作（
									</font>
								</font><span class="quote">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">“ </font>
									</font><span class="quote">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">工作负载</font>
										</font>
									</span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;"> ”</font>
									</font>
								</span>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">）。</font>
									<font style="vertical-align: inherit;">通过简单的测试，您通常可以测试更改一个方面（配置设置，表上的索引集，查询中的SQL子句）如何影响性能。</font>
									<font style="vertical-align: inherit;">基准测试通常是长时间运行和精心设计的性能测试，其结果可能决定高级选择，例如硬件和存储配置，或者升级到新MySQL版本的时间。
									</font>
								</font>
							</p>
						</li>
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										对于基准测试，有时您必须模拟繁重的数据库工作负载才能获得准确的图像。
									</font>
								</font>
							</p>
						</li>
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										表现可能会因许多不同的因素而有所不同，因为几个百分点的差异可能不是决定性的胜利。</font>
									<font style="vertical-align: inherit;">在不同的环境中进行测试时，结果可能会发生相反的变化。
									</font>
								</font>
							</p>
						</li>
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										某些MySQL功能根据工作负载提供帮助或无法帮助提高性能。</font>
									<font style="vertical-align: inherit;">为了完整性，请始终在打开和关闭这些功能的情况下测试性能。</font>
									<font style="vertical-align: inherit;">尝试与每个工作负载最重要的特点是
									</font>
								</font><a class="link" href="innodb-storage-engine.html#innodb-adaptive-hash" title="15.5.3自适应哈希索引">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">适应性的散列索引</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">的</font>
								</font><code class="literal">InnoDB</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表。
									</font>
								</font>
							</p>
						</li>
					</ul>
				</div>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							本节从单个开发人员可以执行的简单和直接测量技术发展到需要额外专业知识来执行和解释结果的更复杂测量技术。
						</font>
					</font>
				</p>
				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="select-benchmarking"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.13.1测量表达式和函数的速度</font>
									</font>
								</h3>
							</div>
						</div>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								要测量特定MySQL表达式或函数的速度，请</font>
						</font><a class="link" href="functions.html#function_benchmark"><code class="literal">BENCHMARK()</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">使用</font>
						</font><a class="link" href="programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行客户端"><span class="command"><strong>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">mysql</font>
									</font>
								</strong></span></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">客户端程序</font>
							<font style="vertical-align: inherit;">调用该</font>
							<font style="vertical-align: inherit;">函数</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">它的语法是
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">返回值始终为零，但</font><a class="link" href="programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行客户端"><span
								 class="command"><strong>
										<font style="vertical-align: inherit;">mysql</font>
									</strong></span></a>
							<font style="vertical-align: inherit;">
								打印一行显示语句执行的时间。</font>
							<font style="vertical-align: inherit;">例如：
							</font>
						</font><a class="link" href="functions.html#function_benchmark"><code class="literal">BENCHMARK(<em class="replaceable"><code>loop_count</code></em>,<em
								 class="replaceable"><code>expr</code></em>)</code></a>
						<font style="vertical-align: inherit;"></font><a class="link" href="programs.html#mysql" title="4.5.1 mysql  -  MySQL命令行客户端"><span
							 class="command"><strong>
									<font style="vertical-align: inherit;"></font>
								</strong></span></a>
						<font style="vertical-align: inherit;"></font>
					</p>
					<pre data-lang="sql" class="programlisting"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL的&gt; </font></font><strong class="userinput"><code>SELECT BENCHMARK(1000000,1+1);</code></strong><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">基准（1000000,1 + 1）|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">0 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ ------------------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1排（0.32秒）</font></font><font></font>
</pre>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								该结果在Pentium II 400MHz系统上获得。</font>
							<font style="vertical-align: inherit;">它表明MySQL可以在0.32秒内在该系统上执行1,000,000个简单的加法表达式。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								内置的MySQL函数通常是高度优化的，但可能有一些例外。
							</font>
						</font><a class="link" href="functions.html#function_benchmark"><code class="literal">BENCHMARK()</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">是一个很好的工具，用于查明某些功能是否是您的查询的问题。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="custom-benchmarks"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.13.2使用您自己的基准</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091701655728"></a><a class="indexterm" name="idm140091701654688"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								对您的应用程序和数据库进行基准测试，以找出瓶颈所在。</font>
							<font style="vertical-align: inherit;">在修复一个瓶颈（或者用</font>
						</font><span class="quote">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">“ </font>
							</font><span class="quote">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">虚拟</font>
								</font>
							</span>
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;"> ”</font>
							</font>
						</span>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">模块</font>
							<font style="vertical-align: inherit;">替换它</font>
							<font style="vertical-align: inherit;">）之后，您可以继续识别下一个瓶颈。</font>
							<font style="vertical-align: inherit;">即使您的应用程序的整体性能目前是可以接受的，您至少应该为每个瓶颈做一个计划，并决定如果有一天您真的需要额外的性能，如何解决它。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								免费的基准测试套件是开源数据库基准测试，可从</font>
						</font><a class="ulink" href="http://osdb.sourceforge.net/" target="_top">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">http://osdb.sourceforge.net/获得</font>
							</font>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								仅在系统负载很重时才会出现问题。</font>
							<font style="vertical-align: inherit;">我们有许多客户在生产（已测试）系统并遇到负载问题时与我们联系。</font>
							<font style="vertical-align: inherit;">在大多数情况下，性能问题最终是由于基本数据库设计问题（例如，高负载下的表扫描不好）或操作系统或库的问题。</font>
							<font style="vertical-align: inherit;">大多数情况下，如果系统尚未投入生产，这些问题将更容易解决。
							</font>
						</font>
					</p>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								为了避免这样的问题，在最糟糕的负载下对整个应用程序进行基准测试：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该</font>
									</font><a class="link" href="programs.html#mysqlslap" title="4.5.8 mysqlslap  - 加载仿真客户端"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">mysqlslap</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">程序可以是用于模拟由多个客户端同时发出查询产生的高负载有帮助的。</font>
										<font style="vertical-align: inherit;">请参见</font>
									</font><a class="xref" href="programs.html#mysqlslap" title="4.5.8 mysqlslap  - 加载仿真客户端">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第4.5.8节“ </font>
										</font><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">mysqlslap</font>
												</font>
											</strong></span>
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;"> - 加载仿真客户端”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您还可以尝试使用基准测试程序包，例如SysBench和DBT2，可在
										</font>
									</font><a class="ulink" href="https://launchpad.net/sysbench" target="_top">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">https://launchpad.net/sysbench</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><a class="ulink" href="http://osdldbt.sourceforge.net/#dbt2" target="_top">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">http://osdldbt.sourceforge.net/#dbt2获得</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								这些程序或软件包可以使系统瘫痪，因此请务必仅在开发系统上使用它们。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="monitoring-performance-schema"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.13.3使用performance_schema测量性能</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091701642128"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								您可以查询</font>
						</font><code class="literal">performance_schema</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">数据库中</font>
							<font style="vertical-align: inherit;">的表，
							</font>
							<font style="vertical-align: inherit;">以查看有关服务器及其运行的应用程序的性能特征的实时信息。</font>
							<font style="vertical-align: inherit;">有关</font>
							<font style="vertical-align: inherit;">详细信息</font>
						</font><a class="xref" href="performance-schema.html" title="第26章MySQL性能架构">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">，</font>
							</font><i>
								<font style="vertical-align: inherit;"></font>
							</i>
						</a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">请参见
							</font><a class="xref" href="performance-schema.html" title="第26章MySQL性能架构">
								<font style="vertical-align: inherit;">第26章，</font>
							</a><a class="xref" href="performance-schema.html" title="第26章MySQL性能架构"><i>
									<font style="vertical-align: inherit;">MySQL性能架构</font>
								</i></a>
							<font style="vertical-align: inherit;">。
							</font>
						</font>
					</p>
				</div>

			</div>
			<div class="section">
				<div class="titlepage">
					<div>
						<div>
							<h2 class="title" style="clear: both"><a name="thread-information"></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">8.14检查线程信息</font>
								</font>
							</h2>

						</div>

					</div>

				</div>
				<div class="toc">
					<dl class="toc"><dt><span class="section"><a href="optimization.html#thread-commands">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.1线程命令值</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#general-thread-states">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.2一般线程状态</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#master-thread-states">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.3复制主线程状态</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#slave-io-thread-states">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.4复制从站I / O线程状态</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#slave-sql-thread-states">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.5复制从属SQL线程状态</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#slave-connection-thread-states">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.6复制从站连接线程状态</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#mysql-cluster-thread-states">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.7 NDB群集线程状态</font>
									</font>
								</a></span></dt><dt><span class="section"><a href="optimization.html#event-scheduler-thread-states">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.8事件调度程序线程状态</font>
									</font>
								</a></span></dt></dl>
				</div>
				<a class="indexterm" name="idm140091701637248"></a><a class="indexterm" name="idm140091701635792"></a><a class="indexterm"
				 name="idm140091701634304"></a>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							当您尝试确定MySQL服务器正在执行的操作时，检查进程列表会很有帮助，该列表是当前在服务器中执行的线程集。</font>
						<font style="vertical-align: inherit;">可从以下来源获取流程列表信息：
						</font>
					</font>
				</p>
				<div class="itemizedlist">
					<ul class="itemizedlist" style="list-style-type: disc; ">
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										该</font>
								</font><code class="literal">SHOW [FULL] PROCESSLIST</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">语句：
									</font>
								</font><a class="xref" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST语法">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第13.7.6.29，“SHOW PROCESSLIST语法”</font>
									</font>
								</a>
							</p>
						</li>
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										该</font>
								</font><a class="link" href="sql-syntax.html#show-profile" title="13.7.6.30 SHOW PROFILE语法"><code class="literal">SHOW
										PROFILE</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">语句：
									</font>
								</font><a class="xref" href="sql-syntax.html#show-profiles" title="13.7.6.31 SHOW PROFILES语法">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第13.7.6.31，“显示配置文件语法”</font>
									</font>
								</a>
							</p>
						</li>
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										该</font>
								</font><code class="literal">INFORMATION_SCHEMA</code>
								<a class="link" href="information-schema.html#processlist-table" title="25.19 INFORMATION_SCHEMA PROCESSLIST表"><code
									 class="literal">PROCESSLIST</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表：
									</font>
								</font><a class="xref" href="information-schema.html#processlist-table" title="25.19 INFORMATION_SCHEMA PROCESSLIST表">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第25.19，“该INFORMATION_SCHEMA PROCESSLIST表”</font>
									</font>
								</a>
							</p>
						</li>
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										在</font>
								</font><a class="link" href="programs.html#mysqladmin" title="4.5.2 mysqladmin  - 管理MySQL服务器的客户端"><span class="command"><strong>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">中mysqladmin processlist的</font>
											</font>
										</strong></span></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">命令：
									</font>
								</font><a class="xref" href="programs.html#mysqladmin" title="4.5.2 mysqladmin  - 管理MySQL服务器的客户端">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第4.5.2节“ </font>
									</font><span class="command"><strong>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">中mysqladmin</font>
											</font>
										</strong></span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;"> -客户端管理MySQL服务器”</font>
									</font>
								</a>
							</p>
						</li>
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										性能模式</font>
								</font><a class="link" href="performance-schema.html#threads-table" title="26.12.17.5线程表"><code class="literal">threads</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										表，阶段表和锁定表：
									</font>
								</font><a class="xref" href="performance-schema.html#performance-schema-miscellaneous-tables" title="26.12.17性能模式其他表">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第26.12.17节“性能模式杂项表”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><a class="xref" href="performance-schema.html#performance-schema-stage-tables" title="26.12.5性能模式阶段事件表">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第26.12.5节“性能模式阶段事件表”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">，
									</font>
								</font><a class="xref" href="performance-schema.html#performance-schema-lock-tables" title="26.12.12性能模式锁表">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第26.12.12节“性能模式锁定表”</font>
									</font>
								</a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</li>
					</ul>
				</div>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							访问</font>
					</font><a class="link" href="performance-schema.html#threads-table" title="26.12.17.5线程表"><code class="literal">threads</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">不需要互斥锁，对服务器性能的影响最小。
						</font>
					</font><a class="link" href="information-schema.html#processlist-table" title="25.19 INFORMATION_SCHEMA PROCESSLIST表"><code
						 class="literal">INFORMATION_SCHEMA.PROCESSLIST</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">并且</font>
					</font><a class="link" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
							PROCESSLIST</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">因为它们需要互斥量</font>
						<font style="vertical-align: inherit;">而
						</font>
						<font style="vertical-align: inherit;">产生负面的性能影响。
						</font>
					</font><a class="link" href="performance-schema.html#threads-table" title="26.12.17.5线程表"><code class="literal">threads</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">还显示有关后台线程的信息，有哪些
						</font>
					</font><a class="link" href="information-schema.html#processlist-table" title="25.19 INFORMATION_SCHEMA PROCESSLIST表"><code
						 class="literal">INFORMATION_SCHEMA.PROCESSLIST</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">，
						</font>
					</font><a class="link" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
							PROCESSLIST</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">有时没有。</font>
						<font style="vertical-align: inherit;">这意味着</font>
					</font><a class="link" href="performance-schema.html#threads-table" title="26.12.17.5线程表"><code class="literal">threads</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">可以用来监视其他线程信息源不能的活动。
						</font>
					</font>
				</p>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							您始终可以查看有关自己的线程的信息。</font>
						<font style="vertical-align: inherit;">要查看有关正在为其他帐户执行的线程的信息，您必须具有该</font>
					</font><a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">权限。
						</font>
					</font>
				</p>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							每个进程列表条目包含几条信息：
						</font>
					</font>
				</p>
				<div class="itemizedlist">
					<ul class="itemizedlist" style="list-style-type: disc; ">
						<li class="listitem">
							<p>
								<code class="literal">Id</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;"> 是与线程关联的客户端的连接标识符。
									</font>
								</font>
							</p>
						</li>
						<li class="listitem">
							<p>
								<code class="literal">User</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">并</font>
								</font><code class="literal">Host</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">指明与该线程关联的帐户。
									</font>
								</font>
							</p>
						</li>
						<li class="listitem">
							<p>
								<code class="literal">db</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">是线程的默认数据库，或者</font>
								</font><code class="literal">NULL</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">如果未选择任何一个。
									</font>
								</font>
							</p>
						</li>
						<li class="listitem">
							<p>
								<code class="literal">Command</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">并</font>
								</font><code class="literal">State</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										指出线程正在做什么。
									</font>
								</font>
							</p>
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										大多数州对应于非常快速的操作。</font>
									<font style="vertical-align: inherit;">如果一个线程在给定状态下停留很多秒，则可能存在需要调查的问题。
									</font>
								</font>
							</p>
						</li>
						<li class="listitem">
							<p>
								<code class="literal">Time</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表示线程处于当前状态的时间。</font>
									<font style="vertical-align: inherit;">在某些情况下，线程的当前时间概念可能会改变：线程可以改变时间</font>
									<font style="vertical-align: inherit;">。</font>
									<font style="vertical-align: inherit;">对于正在处理来自主站的事件的从站上运行的线程，线程时间设置为在事件中找到的时间，因此反映了主站而不是从站的当前时间。
									</font>
								</font><a class="link" href="sql-syntax.html#set-variable" title="13.7.5.1变量赋值的SET语法"><code class="literal">SET
										TIMESTAMP = <em class="replaceable"><code>value</code></em></code></a>
								<font style="vertical-align: inherit;"></font>
							</p>
						</li>
						<li class="listitem">
							<p>
								<code class="literal">Info</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">包含线程正在执行的语句的文本，或者</font>
								</font><code class="literal">NULL</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">它是否正在执行。</font>
									<font style="vertical-align: inherit;">默认情况下，此值仅包含语句的前100个字符。</font>
									<font style="vertical-align: inherit;">要查看完整的语句，请使用
									</font>
								</font><a class="link" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST语法"><code class="literal">SHOW
										FULL
										PROCESSLIST</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">。
									</font>
								</font>
							</p>
						</li>
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										该</font>
								</font><code class="literal">sys</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">架构
									</font>
								</font><a class="link" href="sys-schema.html#sys-processlist" title="27.4.3.22 processlist和x $ processlist视图"><code
									 class="literal">processlist</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">视图，呈现从性能架构信息
									</font>
								</font><a class="link" href="performance-schema.html#threads-table" title="26.12.17.5线程表"><code class="literal">threads</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">表中更方便的格式：</font>
								</font><a class="xref" href="sys-schema.html#sys-processlist" title="27.4.3.22 processlist和x $ processlist视图">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第27.4.3.22，“ProcessList中和X $ PROCESSLIST意见”</font>
									</font>
								</a>
							</p>
						</li>
						<li class="listitem">
							<p>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">
										该</font>
								</font><code class="literal">sys</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">架构
									</font>
								</font><a class="link" href="sys-schema.html#sys-session" title="27.4.3.33会话和x $会话视图"><code class="literal">session</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">视图，其中介绍有关用户会话的信息（如
									</font>
								</font><code class="literal">sys</code>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">架构
									</font>
								</font><a class="link" href="sys-schema.html#sys-processlist" title="27.4.3.22 processlist和x $ processlist视图"><code
									 class="literal">processlist</code></a>
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">视图，但是过滤掉后台进程）：
									</font>
								</font><a class="xref" href="sys-schema.html#sys-session" title="27.4.3.33会话和x $会话视图">
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">第27.4.3.33，“会议和X $会话视图”</font>
									</font>
								</a>
							</p>
						</li>
					</ul>
				</div>
				<p>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							以下部分列出了可能的
						</font>
					</font><code class="literal">Command</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">值以及</font>
					</font><code class="literal">State</code>
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;">
							按类别分组的值。</font>
						<font style="vertical-align: inherit;">其中一些价值观的含义是不言而喻的。</font>
						<font style="vertical-align: inherit;">对于其他人，提供了额外的描述。
						</font>
					</font>
				</p>
				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="thread-commands"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.1线程命令值</font>
									</font>
								</h3>
							</div>
						</div>
					</div>
					<a class="indexterm" name="idm140091701575184"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								线程可以具有以下任何
							</font>
						</font><code class="literal">Command</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">值：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701572160"></a>

									<a class="indexterm" name="idm140091701570672"></a>

									<code class="literal">Binlog Dump</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											这是主服务器上的一个线程，用于将二进制日志内容发送到从属服务器。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701567200"></a>

									<a class="indexterm" name="idm140091701565712"></a>

									<code class="literal">Change user</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在执行更改用户操作。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701562288"></a>

									<a class="indexterm" name="idm140091701560800"></a>

									<code class="literal">Close stmt</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在关闭准备好的声明。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701557392"></a>

									<a class="indexterm" name="idm140091701555904"></a>

									<code class="literal">Connect</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											复制从站连接到其主站。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701552496"></a>

									<a class="indexterm" name="idm140091701551008"></a>

									<code class="literal">Connect Out</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											复制从站正在连接到其主站。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701547584"></a>

									<a class="indexterm" name="idm140091701546096"></a>

									<code class="literal">Create DB</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在执行create-database操作。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701542672"></a>

									<a class="indexterm" name="idm140091701541184"></a>

									<code class="literal">Daemon</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											此线程是服务器的内部线程，而不是为客户端连接提供服务的线程。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701537712"></a>

									<a class="indexterm" name="idm140091701536224"></a>

									<code class="literal">Debug</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在生成调试信息。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701532816"></a>

									<a class="indexterm" name="idm140091701531328"></a>

									<code class="literal">Delayed insert</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程是一个延迟插入处理程序。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701527920"></a>

									<a class="indexterm" name="idm140091701526432"></a>

									<code class="literal">Drop DB</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在执行drop-database操作。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701523008"></a>

									<a class="indexterm" name="idm140091701521520"></a>

									<code class="literal">Error</code>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701518576"></a>

									<a class="indexterm" name="idm140091701517088"></a>

									<code class="literal">Execute</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在执行预准备语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701513680"></a>

									<a class="indexterm" name="idm140091701512192"></a>

									<code class="literal">Fetch</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在从执行预准备语句中获取结果。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701508736"></a>

									<a class="indexterm" name="idm140091701507248"></a>

									<code class="literal">Field List</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在检索表列的信息。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701503824"></a>

									<a class="indexterm" name="idm140091701502336"></a>

									<code class="literal">Init DB</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在选择默认数据库。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701498928"></a>

									<a class="indexterm" name="idm140091701497440"></a>

									<code class="literal">Kill</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在杀死另一个线程。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701494032"></a>

									<a class="indexterm" name="idm140091701492544"></a>

									<code class="literal">Long Data</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在检索执行预准备语句的结果中的长数据。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701489088"></a>

									<a class="indexterm" name="idm140091701487600"></a>

									<code class="literal">Ping</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在处理服务器ping请求。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701484192"></a>

									<a class="indexterm" name="idm140091701482704"></a>

									<code class="literal">Prepare</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该主题正在准备一份准备好的声明。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701479296"></a>

									<a class="indexterm" name="idm140091701477808"></a>

									<code class="literal">Processlist</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在生成有关服务器线程的信息。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701474384"></a>

									<a class="indexterm" name="idm140091701472896"></a>

									<code class="literal">Query</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在执行一个语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701469488"></a>

									<a class="indexterm" name="idm140091701468000"></a>

									<code class="literal">Quit</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在终止。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701464608"></a>

									<a class="indexterm" name="idm140091701463120"></a>

									<code class="literal">Refresh</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在刷新表，日志或缓存，或重置状态变量或复制服务器信息。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701459632"></a>

									<a class="indexterm" name="idm140091701458144"></a>

									<code class="literal">Register Slave</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在注册从服务器。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701454736"></a>

									<a class="indexterm" name="idm140091701453248"></a>

									<code class="literal">Reset stmt</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在重置预准备语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701449840"></a>

									<a class="indexterm" name="idm140091701448352"></a>

									<code class="literal">Set option</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在设置或重置客户端语句执行选项。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701444896"></a>

									<a class="indexterm" name="idm140091701443408"></a>

									<code class="literal">Shutdown</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在关闭服务器。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701440000"></a>

									<a class="indexterm" name="idm140091701438512"></a>

									<code class="literal">Sleep</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在等待客户端向其发送新语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701435072"></a>

									<a class="indexterm" name="idm140091701433584"></a>

									<code class="literal">Statistics</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在生成服务器状态信息。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701430160"></a>

									<a class="indexterm" name="idm140091701428672"></a>

									<code class="literal">Table Dump</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在将表内容发送到从属服务器。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701425248"></a>

									<a class="indexterm" name="idm140091701423760"></a>

									<code class="literal">Time</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											没用过。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="general-thread-states"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.2一般线程状态</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091701419488"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下列表描述了</font>
						</font><code class="literal">State</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								与常规查询处理相关联的</font>
							<font style="vertical-align: inherit;">线程</font>
							<font style="vertical-align: inherit;">值，而不是更具体的活动（如复制）。</font>
							<font style="vertical-align: inherit;">其中许多仅用于查找服务器中的错误。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701415872"></a>

									<a class="indexterm" name="idm140091701414384"></a>

									<code class="literal">After create</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当线程在创建表的函数末尾创建表（包括内部临时表）时，会发生这种情况。</font>
										<font style="vertical-align: inherit;">即使由于某些错误而无法创建表，也会使用此状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701410768"></a>

									<a class="indexterm" name="idm140091701409280"></a>

									<code class="literal">Analyzing</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在计算</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表键分布（例如，for
										</font>
									</font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code class="literal">ANALYZE
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701403888"></a>

									<a class="indexterm" name="idm140091701402400"></a>

									<code class="literal">checking permissions</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在检查服务器是否具有执行语句所需的权限。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701398928"></a>

									<a class="indexterm" name="idm140091701397440"></a>

									<code class="literal">Checking table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在执行表检查操作。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701394016"></a>

									<a class="indexterm" name="idm140091701392528"></a>

									<code class="literal">cleaning up</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程已经处理了一个命令，并准备释放内存并重置某些状态变量。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701389040"></a>

									<a class="indexterm" name="idm140091701387552"></a>

									<code class="literal">closing tables</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在将更改的表数据刷新到磁盘并关闭已使用的表。</font>
										<font style="vertical-align: inherit;">这应该是一个快速的操作。</font>
										<font style="vertical-align: inherit;">如果没有，请验证您没有完整磁盘并且磁盘使用不是很大。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701383936"></a>

									<a class="indexterm" name="idm140091701382432"></a>

									<code class="literal">converting HEAP to ondisk</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在将内部临时表从
										</font>
									</font><code class="literal">MEMORY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表转换为磁盘表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701378240"></a>

									<a class="indexterm" name="idm140091701376752"></a>

									<code class="literal">copy to tmp table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在处理一个</font>
									</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句。</font>
										<font style="vertical-align: inherit;">在创建具有新结构的表但在将行复制到其中之前，将发生此状态。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于处于此状态的线程，可以使用性能模式来获取有关复制操作的进度。</font>
										<font style="vertical-align: inherit;">请参见
										</font>
									</font><a class="xref" href="performance-schema.html#performance-schema-stage-tables" title="26.12.5性能模式阶段事件表">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第26.12.5节“性能模式阶段事件表”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701370672"></a>

									<a class="indexterm" name="idm140091701369184"></a>

									<code class="literal">Copying to group table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果语句具有不同的</font>
										<font style="vertical-align: inherit;">条件</font>
									</font><code class="literal">ORDER BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">和
										</font>
									</font><code class="literal">GROUP BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">标准，则按组对行进行排序并将其复制到临时表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701364272"></a>

									<a class="indexterm" name="idm140091701362784"></a>

									<code class="literal">Copying to tmp table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在复制到内存中的临时表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701359360"></a>

									<a class="indexterm" name="idm140091701357872"></a>

									<code class="literal">altering table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在执行就地
										</font>
									</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701353264"></a>

									<a class="indexterm" name="idm140091701351760"></a>

									<code class="literal">Copying to tmp table on disk</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在复制到磁盘上的临时表。</font>
										<font style="vertical-align: inherit;">临时结果集变得太大（请参见
										</font>
									</font><a class="xref" href="optimization.html#internal-temporary-tables" title="8.4.4 MySQL中的内部临时表使用">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.4.4节“MySQL中的内部临时表使用”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">）。</font>
										<font style="vertical-align: inherit;">因此，线程正在将临时表从内存更改为基于磁盘的格式以节省内存。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701347360"></a>

									<a class="indexterm" name="idm140091701345872"></a>

									<code class="literal">Creating index</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在处理</font>
									</font><code class="literal">ALTER TABLE ... ENABLE
										KEYS</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">一个</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701341088"></a>

									<a class="indexterm" name="idm140091701339600"></a>

									<code class="literal">Creating sort index</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在处理</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">使用内部临时表解析</font>
										<font style="vertical-align: inherit;">的线程
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701334912"></a>

									<a class="indexterm" name="idm140091701333424"></a>

									<code class="literal">creating table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在创建一个表。</font>
										<font style="vertical-align: inherit;">这包括创建临时表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701329968"></a>

									<a class="indexterm" name="idm140091701328480"></a>

									<code class="literal">Creating tmp table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在内存或磁盘上创建临时表。</font>
										<font style="vertical-align: inherit;">如果表在内存中创建但稍后转换为磁盘表，则该操作期间的状态将为</font>
									</font><code class="literal">Copying to tmp table on
										disk</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701324160"></a>

									<a class="indexterm" name="idm140091701322640"></a>

									<code class="literal">committing alter table to storage engine</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器已完成就地
										</font>
									</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">并提交结果。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701317904"></a>

									<a class="indexterm" name="idm140091701316400"></a>

									<code class="literal">deleting from main table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在执行多表删除的第一部分。</font>
										<font style="vertical-align: inherit;">它仅从第一个表中删除，并保存用于从其他（引用）表中删除的列和偏移量。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701312768"></a>

									<a class="indexterm" name="idm140091701311264"></a>

									<code class="literal">deleting from reference tables</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在执行多表删除的第二部分，并从其他表中删除匹配的行。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701307728"></a>

									<a class="indexterm" name="idm140091701306224"></a>

									<code class="literal">discard_or_import_tablespace</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在处理</font>
									</font><code class="literal">ALTER TABLE ... DISCARD
										TABLESPACE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或</font>
									</font><code class="literal">ALTER TABLE ... IMPORT
										TABLESPACE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">声明。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701301296"></a>

									<a class="indexterm" name="idm140091701299840"></a>

									<code class="literal">end</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											这发生在结束，但的清理之前
										</font>
									</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#create-view" title="13.1.23创建视图语法"><code class="literal">CREATE
											VIEW</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，或
										</font>
									</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701289088"></a>

									<a class="indexterm" name="idm140091701287600"></a>

									<code class="literal">executing</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程已开始执行语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701284192"></a>

									<a class="indexterm" name="idm140091701282688"></a>

									<code class="literal">Execution of init_command</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在执行</font>
									</font><code class="literal">init_command</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">系统变量</font>
										<font style="vertical-align: inherit;">值中的语句
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701278496"></a>

									<a class="indexterm" name="idm140091701277008"></a>

									<code class="literal">freeing items</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程执行了一个命令。</font>
										<font style="vertical-align: inherit;">这种状态通常紧随其后</font>
									</font><code class="literal">cleaning up</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701272848"></a>

									<a class="indexterm" name="idm140091701271360"></a>

									<code class="literal">FULLTEXT initialization</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正准备执行自然语言全文搜索。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701267904"></a>

									<a class="indexterm" name="idm140091701266416"></a>

									<code class="literal">init</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											出现这种情况的初始化之前
										</font>
									</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE语法"><code class="literal">DELETE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#insert" title="13.2.6 INSERT语法"><code class="literal">INSERT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，
										</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，或
										</font>
									</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句。</font>
										<font style="vertical-align: inherit;">服务器在此状态下执行的操作包括刷新二进制日志和</font>
									</font><code class="literal">InnoDB</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">日志。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于</font>
									</font><code class="literal">end</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">州，可能会发生以下操作：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														将事件写入二进制日志
													</font>
												</font>
											</p>
										</li>
										<li class="listitem">
											<p>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">
														释放内存缓冲区，包括blob
													</font>
												</font>
											</p>
										</li>
									</ul>
								</div>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701252768"></a>

									<a class="indexterm" name="idm140091701251280"></a>

									<code class="literal">Killed</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有人</font>
									</font><a class="link" href="sql-syntax.html#kill" title="13.7.7.4 KILL语法"><code class="literal">KILL</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											向线程</font>
										<font style="vertical-align: inherit;">发送了一个</font>
										<font style="vertical-align: inherit;">语句，它应该在下次检查kill标志时中止。</font>
										<font style="vertical-align: inherit;">在MySQL的每个主循环中检查该标志，但在某些情况下，线程可能仍然需要很短的时间才能死掉。</font>
										<font style="vertical-align: inherit;">如果线程被某个其他线程锁定，则一旦另一个线程释放其锁定，kill就会生效。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701246288"></a>

									<a class="indexterm" name="idm140091701244800"></a>

									<code class="literal">Locking system tables</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在尝试锁定系统表（例如，时区或日志表）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701241328"></a>

									<a class="indexterm" name="idm140091701239840"></a>

									<code class="literal">logging slow query</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在向慢查询日志写一条语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701236416"></a>

									<a class="indexterm" name="idm140091701234928"></a>

									<code class="literal">login</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											连接线程的初始状态，直到客户端成功通过身份验证。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701231456"></a>

									<a class="indexterm" name="idm140091701229968"></a>

									<code class="literal">manage keys</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在启用或禁用表索引。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701226544"></a>

									<a class="indexterm" name="idm140091701225056"></a>

									<code class="literal">NULL</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该状态用于该</font>
									</font><a class="link" href="sql-syntax.html#show-processlist" title="13.7.6.29 SHOW PROCESSLIST语法"><code
										 class="literal">SHOW
											PROCESSLIST</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701220416"></a>

									<a class="indexterm" name="idm140091701218928"></a>

									<code class="literal">Opening system tables</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在尝试打开系统表（例如，时区或日志表）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701215456"></a>

									<a class="indexterm" name="idm140091701213968"></a>

									<code class="literal">Opening tables</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在尝试打开一个表。</font>
										<font style="vertical-align: inherit;">这应该是非常快的程序，除非有什么东西阻止打开。</font>
										<font style="vertical-align: inherit;">例如，一个</font>
									</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或一个
										</font>
									</font><a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES和UNLOCK TABLES语法"><code
										 class="literal">LOCK
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句可以阻止在语句结束之前打开表。</font>
										<font style="vertical-align: inherit;">还值得检查您的</font>
									</font><a class="link" href="server-administration.html#sysvar_table_open_cache"><code class="literal">table_open_cache</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">价值是否足够大。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于系统表，使用</font>
									</font><code class="literal">Opening system
										tables</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701205440"></a>

									<a class="indexterm" name="idm140091701203952"></a>

									<code class="literal">optimizing</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在对查询执行初始优化。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701200528"></a>

									<a class="indexterm" name="idm140091701199040"></a>

									<code class="literal">preparing</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在查询优化期间发生此状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701195632"></a>

									<a class="indexterm" name="idm140091701194144"></a>

									<code class="literal">Purging old relay logs</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在删除不需要的中继日志文件。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701190720"></a>

									<a class="indexterm" name="idm140091701189232"></a>

									<code class="literal">query end</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											处理查询后但在</font>
									</font><code class="literal">freeing items</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">状态</font>
										<font style="vertical-align: inherit;">之前发生此
										</font>
										<font style="vertical-align: inherit;">状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701185088"></a>

									<a class="indexterm" name="idm140091701183600"></a>

									<code class="literal">Receiving from client</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在从客户端读取数据包。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701180192"></a>

									<a class="indexterm" name="idm140091701178704"></a>

									<code class="literal">Removing duplicates</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该查询使用
										</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT
											DISTINCT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">的方式是MySQL无法在早期阶段优化掉不同的操作。</font>
										<font style="vertical-align: inherit;">因此，在将结果发送到客户端之前，MySQL需要额外的阶段来删除所有重复的行。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701173824"></a>

									<a class="indexterm" name="idm140091701172336"></a>

									<code class="literal">removing tmp table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程在处理</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											语句</font>
										<font style="vertical-align: inherit;">后删除内部临时表</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">如果未创建临时表，则不使用此状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701167568"></a>

									<a class="indexterm" name="idm140091701166080"></a>

									<code class="literal">rename</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在重命名一个表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701162688"></a>

									<a class="indexterm" name="idm140091701161200"></a>

									<code class="literal">rename result table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在处理一个</font>
									</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句，创建了新表，并重命名它以替换原始表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701156480"></a>

									<a class="indexterm" name="idm140091701154992"></a>

									<code class="literal">Reopen tables</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程获得了表的锁定，但在获取锁定之后注意到基础表结构发生了变化。</font>
										<font style="vertical-align: inherit;">它释放了锁，关闭了桌子，并试图重新打开它。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701151408"></a>

									<a class="indexterm" name="idm140091701149920"></a>

									<code class="literal">Repair by sorting</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											修复代码使用排序来创建索引。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701146496"></a>

									<a class="indexterm" name="idm140091701144992"></a>

									<code class="literal">preparing for alter table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正准备执行就地
										</font>
									</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701140304"></a>

									<a class="indexterm" name="idm140091701138816"></a>

									<code class="literal">Repair done</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程已完成对</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表</font>
										<font style="vertical-align: inherit;">的多线程修复
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701134672"></a>

									<a class="indexterm" name="idm140091701133184"></a>

									<code class="literal">Repair with keycache</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											修复代码通过密钥缓存逐个创建密钥。</font>
										<font style="vertical-align: inherit;">这比慢得多</font>
									</font><code class="literal">Repair by
										sorting</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701128976"></a>

									<a class="indexterm" name="idm140091701127488"></a>

									<code class="literal">Rolling back</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在回滚一个事务。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701124080"></a>

									<a class="indexterm" name="idm140091701122592"></a>

									<code class="literal">Saving state</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">诸如修复或分析的表操作，线程将新表状态保存到</font>
									</font><code class="filename">.MYI</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">文件头。</font>
										<font style="vertical-align: inherit;">状态包括诸如行数，
										</font>
									</font><code class="literal">AUTO_INCREMENT</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">计数器和密钥分发之类的信息。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701116864"></a>

									<a class="indexterm" name="idm140091701115360"></a>

									<code class="literal">Searching rows for update</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在进行第一阶段以在更新之前查找所有匹配的行。</font>
										<font style="vertical-align: inherit;">如果
										</font>
									</font><a class="link" href="sql-syntax.html#update" title="13.2.12 UPDATE语法"><code class="literal">UPDATE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">要更改用于查找所涉及行的索引，则必须执行此操作。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<code class="literal">Sending data</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在读取和处理</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句的</font>
										<font style="vertical-align: inherit;">行
										</font>
										<font style="vertical-align: inherit;">，并将数据发送到客户端。</font>
										<font style="vertical-align: inherit;">由于在此状态期间发生的操作往往会执行大量磁盘访问（读取），因此它通常是给定查询生命周期中运行时间最长的状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701107120"></a>

									<a class="indexterm" name="idm140091701105632"></a>

									<code class="literal">Sending to client</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在向客户端写入数据包。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701102224"></a>

									<a class="indexterm" name="idm140091701100736"></a>

									<code class="literal">setup</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在开始一个</font>
									</font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code class="literal">ALTER
											TABLE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">操作。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701096112"></a>

									<a class="indexterm" name="idm140091701094624"></a>

									<code class="literal">Sorting for group</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在进行排序以满足a </font>
									</font><code class="literal">GROUP
										BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701090512"></a>

									<a class="indexterm" name="idm140091701089024"></a>

									<code class="literal">Sorting for order</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在进行排序以满足</font>
									</font><code class="literal">ORDER
										BY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701084912"></a>

									<a class="indexterm" name="idm140091701083424"></a>

									<code class="literal">Sorting index</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在对索引页面进行排序，以便在</font>
									</font><code class="literal">MyISAM</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">表优化操作</font>
										<font style="vertical-align: inherit;">期间进行更有效的</font>
										<font style="vertical-align: inherit;">访
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701079232"></a>

									<a class="indexterm" name="idm140091701077744"></a>

									<code class="literal">Sorting result</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于</font>
									</font><a class="link" href="sql-syntax.html#select" title="13.2.10 SELECT语法"><code class="literal">SELECT</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">声明，这类似于</font>
									</font><code class="literal">Creating sort index</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">非临时表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701072368"></a>

									<a class="indexterm" name="idm140091701070880"></a>

									<code class="literal">statistics</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在计算统计信息以开发查询执行计划。</font>
										<font style="vertical-align: inherit;">如果线程长时间处于此状态，则服务器可能是磁盘绑定执行其他工作。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701067296"></a>

									<a class="indexterm" name="idm140091701066224"></a>

									<a class="indexterm" name="idm140091701064736"></a>

									<a class="indexterm" name="idm140091701063248"></a>

									<code class="literal">System lock</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程已调用</font>
									</font><code class="literal">mysql_lock_tables()</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											，并且线程状态尚未更新。</font>
										<font style="vertical-align: inherit;">这是一个非常普遍的状态，可能由于多种原因而发生。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											例如，线程将请求或正在等待表的内部或外部系统锁定。</font>
									</font><a class="link" href="innodb-storage-engine.html" title="第15章InnoDB存储引擎"><code class="literal">InnoDB</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在执行期间等待表级锁定</font>
										<font style="vertical-align: inherit;">时</font>
										<font style="vertical-align: inherit;">会
										</font>
										<font style="vertical-align: inherit;">发生这种情况</font>
									</font><a class="link" href="sql-syntax.html#lock-tables" title="13.3.6 LOCK TABLES和UNLOCK TABLES语法"><code
										 class="literal">LOCK TABLES</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">如果此状态是由外部锁的请求引起的，并且您没有使用多个</font>
										<font style="vertical-align: inherit;">访问相同</font>
										<font style="vertical-align: inherit;">
											表的</font>
									</font><a class="link" href="programs.html#mysqld" title="4.3.1 mysqld  -  MySQL服务器"><span class="command"><strong>
												<font style="vertical-align: inherit;">
													<font style="vertical-align: inherit;">mysqld</font>
												</font>
											</strong></span></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">服务器，则</font>
									</font><a class="link" href="storage-engines.html#myisam-storage-engine" title="16.2 MyISAM存储引擎"><code class="literal">MyISAM</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">可以使用该</font>
									</font><a class="link" href="server-administration.html#option_mysqld_external-locking"><code class="option">--skip-external-locking</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											选项</font>
										<font style="vertical-align: inherit;">禁用外部系统锁
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">但是，默认情况下禁用外部锁定，因此该选项很可能无效。</font>
										<font style="vertical-align: inherit;">对于
										</font>
									</font><a class="link" href="sql-syntax.html#show-profile" title="13.7.6.30 SHOW PROFILE语法"><code class="literal">SHOW
											PROFILE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，这个状态意味着线程正在请求锁定（不等待它）。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											对于系统表，使用</font>
									</font><code class="literal">Locking system
										tables</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701049616"></a>

									<a class="indexterm" name="idm140091701048128"></a>

									<code class="literal">update</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正准备开始更新表。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701044704"></a>

									<a class="indexterm" name="idm140091701043216"></a>

									<code class="literal">Updating</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在搜索要更新的行并正在更新它们。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701039776"></a>

									<a class="indexterm" name="idm140091701038288"></a>

									<code class="literal">updating main table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在执行多表更新的第一部分。</font>
										<font style="vertical-align: inherit;">它仅更新第一个表，并保存用于更新其他（引用）表的列和偏移量。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701034688"></a>

									<a class="indexterm" name="idm140091701033184"></a>

									<code class="literal">updating reference tables</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在执行多表更新的第二部分，并更新其他表中的匹配行。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701029648"></a>

									<a class="indexterm" name="idm140091701028160"></a>

									<code class="literal">User lock</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程将要求或正在等待通过</font>
									</font><a class="link" href="functions.html#function_get-lock"><code class="literal">GET_LOCK()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">呼叫</font>
										<font style="vertical-align: inherit;">请求的咨询锁
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">对于
										</font>
									</font><a class="link" href="sql-syntax.html#show-profile" title="13.7.6.30 SHOW PROFILE语法"><code class="literal">SHOW
											PROFILE</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">，此状态表示线程正在请求锁定（不等待它）。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701022128"></a>

									<a class="indexterm" name="idm140091701020640"></a>

									<code class="literal">User sleep</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程已经调用了一个
										</font>
									</font><a class="link" href="functions.html#function_sleep"><code class="literal">SLEEP()</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">调用。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701015840"></a>

									<a class="indexterm" name="idm140091701014352"></a>

									<code class="literal">Waiting for commit lock</code>
								</p>
								<p>
									<a class="link" href="sql-syntax.html#flush-tables-with-read-lock"><code class="literal">FLUSH TABLES WITH
											READ LOCK</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											正在等待提交锁定。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701009712"></a>

									<a class="indexterm" name="idm140091701008208"></a>

									<code class="literal">Waiting for global read lock</code>
								</p>
								<p>
									<a class="link" href="sql-syntax.html#flush-tables-with-read-lock"><code class="literal">FLUSH TABLES WITH
											READ LOCK</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											正在等待全局读锁定或</font>
									</font><a class="link" href="server-administration.html#sysvar_read_only"><code class="literal">read_only</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">正在设置</font>
										<font style="vertical-align: inherit;">全局
										</font>
										<font style="vertical-align: inherit;">系统变量。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091701002240"></a>

									<a class="indexterm" name="idm140091701000752"></a>

									<code class="literal">Waiting for tables</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程得到一个通知，表明表的底层结构已经改变，它需要重新打开表以获得新结构。</font>
										<font style="vertical-align: inherit;">但是，要重新打开表，它必须等到所有其他线程关闭了相关表。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该通知发生如果另一个线程已使用
										</font>
									</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或有问题的表下面的语句之一：
										</font>
										<font style="vertical-align: inherit;">，
										</font>
										<font style="vertical-align: inherit;">，
										</font>
										<font style="vertical-align: inherit;">，
										</font>
										<font style="vertical-align: inherit;">，
										</font>
										<font style="vertical-align: inherit;">，或
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font><code class="literal">FLUSH TABLES
										<em class="replaceable"><code>tbl_name</code></em></code>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code
										 class="literal">ALTER TABLE</code></a>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#rename-table" title="13.1.36 RENAME TABLE语法"><code
										 class="literal">RENAME TABLE</code></a>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#repair-table" title="13.7.3.5 REPAIR TABLE语法"><code
										 class="literal">REPAIR TABLE</code></a>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code
										 class="literal">ANALYZE TABLE</code></a>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE语法"><code
										 class="literal">OPTIMIZE TABLE</code></a>
									<font style="vertical-align: inherit;"></font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700987808"></a>

									<a class="indexterm" name="idm140091700986320"></a>

									<code class="literal">Waiting for table flush</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在执行 </font>
									</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH
											TABLES</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">并且正在等待所有线程关闭它们的表，或者线程得到一个表的基础结构已经更改的通知，并且它需要重新打开表以获取新结构。</font>
										<font style="vertical-align: inherit;">但是，要重新打开表，它必须等到所有其他线程关闭了相关表。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该通知发生如果另一个线程已使用
										</font>
									</font><a class="link" href="sql-syntax.html#flush-tables"><code class="literal">FLUSH TABLES</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">或有问题的表下面的语句之一：
										</font>
										<font style="vertical-align: inherit;">，
										</font>
										<font style="vertical-align: inherit;">，
										</font>
										<font style="vertical-align: inherit;">，
										</font>
										<font style="vertical-align: inherit;">，
										</font>
										<font style="vertical-align: inherit;">，或
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font><code class="literal">FLUSH TABLES
										<em class="replaceable"><code>tbl_name</code></em></code>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#alter-table" title="13.1.9 ALTER TABLE语法"><code
										 class="literal">ALTER TABLE</code></a>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#rename-table" title="13.1.36 RENAME TABLE语法"><code
										 class="literal">RENAME TABLE</code></a>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#repair-table" title="13.7.3.5 REPAIR TABLE语法"><code
										 class="literal">REPAIR TABLE</code></a>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#analyze-table" title="13.7.3.1 ANALYZE TABLE语法"><code
										 class="literal">ANALYZE TABLE</code></a>
									<font style="vertical-align: inherit;"></font><a class="link" href="sql-syntax.html#optimize-table" title="13.7.3.4 OPTIMIZE TABLE语法"><code
										 class="literal">OPTIMIZE TABLE</code></a>
									<font style="vertical-align: inherit;"></font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700972384"></a>

									<a class="indexterm" name="idm140091700970880"></a>

									<a class="indexterm" name="idm140091700969376"></a>

									<a class="indexterm" name="idm140091700967872"></a>

									<a class="indexterm" name="idm140091700966368"></a>

									<a class="indexterm" name="idm140091700964864"></a>

									<a class="indexterm" name="idm140091700963344"></a>

									<a class="indexterm" name="idm140091700961824"></a>

									<a class="indexterm" name="idm140091700960304"></a>

									<a class="indexterm" name="idm140091700958784"></a>

									<a class="indexterm" name="idm140091700957280"></a>

									<a class="indexterm" name="idm140091700955776"></a>

									<a class="indexterm" name="idm140091700954272"></a>

									<a class="indexterm" name="idm140091700952768"></a>

									<a class="indexterm" name="idm140091700951264"></a>

									<code class="literal">Waiting for <em class="replaceable"><code>lock_type</code></em>
										lock</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在等待</font>
									</font><code class="literal">THR_LOCK</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">从元数据锁定子系统</font>
										<font style="vertical-align: inherit;">获取
										</font>
										<font style="vertical-align: inherit;">锁定或锁定，其中
										</font>
									</font><em class="replaceable"><code>lock_type</code></em>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">指示锁定的类型。
										</font>
									</font>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											此状态表示等待
										</font>
									</font><code class="literal">THR_LOCK</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">Waiting for table level lock</code>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											这些状态表示等待元数据锁定：
										</font>
									</font>
								</p>
								<div class="itemizedlist">
									<ul class="itemizedlist" style="list-style-type: circle; ">
										<li class="listitem">
											<p>
												<code class="literal">Waiting for event metadata lock</code>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">Waiting for global read lock</code>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">Waiting for schema metadata lock</code>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">Waiting for stored function metadata
													lock</code>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">Waiting for stored procedure metadata
													lock</code>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">Waiting for table metadata lock</code>
											</p>
										</li>
										<li class="listitem">
											<p>
												<code class="literal">Waiting for trigger metadata lock</code>
											</p>
										</li>
									</ul>
								</div>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											有关表锁指示器的信息，请参见
										</font>
									</font><a class="xref" href="optimization.html#internal-locking" title="8.11.1内部锁定方法">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.11.1节“内部锁定方法”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">有关元数据锁定的信息，请参见</font>
									</font><a class="xref" href="optimization.html#metadata-locking" title="8.11.4元数据锁定">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第8.11.4节“元数据锁定”</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">要查看哪些锁阻止了锁请求，请使用
										</font>
									</font><a class="xref" href="performance-schema.html#performance-schema-lock-tables" title="26.12.12性能模式锁表">
										<font style="vertical-align: inherit;">
											<font style="vertical-align: inherit;">第26.12.12节“性能模式锁表”中所述的性能模式锁表</font>
										</font>
									</a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700928976"></a>

									<a class="indexterm" name="idm140091700927488"></a>

									<code class="literal">Waiting on cond</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在等待条件变为真的通用状态。</font>
										<font style="vertical-align: inherit;">没有具体的州信息。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700923968"></a>

									<a class="indexterm" name="idm140091700922480"></a>

									<code class="literal">Writing to net</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器正在将数据包写入网络。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="master-thread-states"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.3复制主线程状态</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091700918240"></a><a class="indexterm" name="idm140091700916784"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下列表显示了您可能在</font>
						</font><code class="literal">State</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">主</font>
						</font><code class="literal">Binlog Dump</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">线程</font>
							<font style="vertical-align: inherit;">的</font>
							<font style="vertical-align: inherit;">列中
							</font>
							<font style="vertical-align: inherit;">看到的最常见状态</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">如果</font>
						</font><code class="literal">Binlog Dump</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">在主服务器</font>
							<font style="vertical-align: inherit;">上看不到任何
							</font>
							<font style="vertical-align: inherit;">线程，则表示复制未运行; </font>
							<font style="vertical-align: inherit;">也就是说，当前没有连接任何从属设备。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700911728"></a>

									<a class="indexterm" name="idm140091700910208"></a>

									<code class="literal">Finished reading one binlog; switching to next
										binlog</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程已经读完二进制日志文件并打开下一个发送给从属的文件。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700906656"></a>

									<a class="indexterm" name="idm140091700905120"></a>

									<code class="literal">Master has sent all binlog to slave; waiting for
										more updates</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程已从二进制日志中读取所有剩余更新并将其发送给从属。</font>
										<font style="vertical-align: inherit;">该线程现在处于空闲状态，等待主事件上发生的新更新导致二进制日志中出现新事件。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700901392"></a>

									<a class="indexterm" name="idm140091700899888"></a>

									<code class="literal">Sending binlog event to slave</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											二进制日志由</font>
									</font><span class="emphasis"><em>
											<font style="vertical-align: inherit;">
												<font style="vertical-align: inherit;">事件</font>
											</font>
										</em></span>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">组成</font>
										<font style="vertical-align: inherit;">，其中事件通常是更新以及一些其他信息。</font>
										<font style="vertical-align: inherit;">线程已从二进制日志中读取事件，现在将其发送到从站。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700895856"></a>

									<a class="indexterm" name="idm140091700894352"></a>

									<code class="literal">Waiting to finalize termination</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程停止时发生的非常短暂的状态。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="slave-io-thread-states"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.4复制从站I / O线程状态</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091700890016"></a><a class="indexterm" name="idm140091700888560"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下列表显示了在</font>
						</font><code class="literal">State</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">从属服务器I / O线程</font>
							<font style="vertical-align: inherit;">的</font>
							<font style="vertical-align: inherit;">列中</font>
							<font style="vertical-align: inherit;">看到的最常见状态
							</font>
							<font style="vertical-align: inherit;">。</font>
							<font style="vertical-align: inherit;">此状态也出现在</font>
						</font><code class="literal">Slave_IO_State</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								显示</font>
							<font style="vertical-align: inherit;">的</font>
							<font style="vertical-align: inherit;">列中</font>
						</font><a class="link" href="sql-syntax.html#show-slave-status" title="13.7.6.34 SHOW SLAVE STATUS语法"><code class="literal">SHOW
								SLAVE
								STATUS</code></a>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">，因此您可以通过使用该语句很好地了解正在发生的情况。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700882976"></a>

									<a class="indexterm" name="idm140091700881488"></a>

									<code class="literal">Checking master version</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在建立与主站的连接之后非常短暂地发生的状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700878016"></a>

									<a class="indexterm" name="idm140091700876528"></a>

									<code class="literal">Connecting to master</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在尝试连接到主服务器。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700873104"></a>

									<a class="indexterm" name="idm140091700871600"></a>

									<code class="literal">Queueing master event to the relay log</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程已读取事件并将其复制到中继日志，以便SQL线程可以处理它。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700868080"></a>

									<a class="indexterm" name="idm140091700866560"></a>

									<code class="literal">Reconnecting after a failed binlog dump
										request</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在尝试重新连接到主服务器。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700863056"></a>

									<a class="indexterm" name="idm140091700861536"></a>

									<code class="literal">Reconnecting after a failed master event
										read</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在尝试重新连接到主服务器。</font>
										<font style="vertical-align: inherit;">当再次建立连接时，状态变为
										</font>
									</font><code class="literal">Waiting for master to send event</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700857232"></a>

									<a class="indexterm" name="idm140091700855728"></a>

									<code class="literal">Registering slave on master</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											建立与主站连接后非常短暂的状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700852240"></a>

									<a class="indexterm" name="idm140091700850752"></a>

									<code class="literal">Requesting binlog dump</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											在建立与主站的连接之后非常短暂地发生的状态。</font>
										<font style="vertical-align: inherit;">线程从请求的二进制日志文件名和位置开始向主机发送对其二进制日志内容的请求。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700847120"></a>

									<a class="indexterm" name="idm140091700845616"></a>

									<code class="literal">Waiting for its turn to commit</code>
								</p>
								<p>
									<font style="vertical-align: inherit;"></font><a class="link" href="replication.html#sysvar_slave_preserve_commit_order"><code
										 class="literal">slave_preserve_commit_order</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											启用</font>
										<font style="vertical-align: inherit;">
											了从属线程等待较旧的工作线程提交时发生的状态
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700840816"></a>

									<a class="indexterm" name="idm140091700839312"></a>

									<code class="literal">Waiting for master to send event</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程已连接到主服务器并正在等待二进制日志事件到达。</font>
										<font style="vertical-align: inherit;">如果主站空闲，这可能会持续很长时间。</font>
										<font style="vertical-align: inherit;">如果等待持续
										</font>
									</font><a class="link" href="replication.html#sysvar_slave_net_timeout"><code class="literal">slave_net_timeout</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">几秒钟，则发生超时。</font>
										<font style="vertical-align: inherit;">此时，线程认为连接被破坏并尝试重新连接。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700834272"></a>

									<a class="indexterm" name="idm140091700832816"></a>

									<code class="literal">Waiting for master update</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											之前的初始状态</font>
									</font><code class="literal">Connecting to
										master</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700828672"></a>

									<a class="indexterm" name="idm140091700827168"></a>

									<code class="literal">Waiting for slave mutex on exit</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程停止时短暂发生的状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700823712"></a>

									<a class="indexterm" name="idm140091700822176"></a>

									<code class="literal">Waiting for the slave SQL thread to free enough
										relay log space</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											您正在使用非零
										</font>
									</font><a class="link" href="replication.html#sysvar_relay_log_space_limit"><code class="literal">relay_log_space_limit</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											值，并且中继日志已经增长到足以使其组合大小超过此值。</font>
										<font style="vertical-align: inherit;">I / O线程正在等待，直到SQL线程通过处理中继日志内容释放足够的空间，以便它可以删除一些中继日志文件。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700817072"></a>

									<a class="indexterm" name="idm140091700815552"></a>

									<code class="literal">Waiting to reconnect after a failed binlog dump
										request</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											如果二进制日志转储请求失败（由于断开连接），则线程在休眠时进入此状态，然后尝试定期重新连接。</font>
										<font style="vertical-align: inherit;">可以使用</font>
									</font><a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1更改主语法"><code class="literal">CHANGE
											MASTER TO</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句</font>
										<font style="vertical-align: inherit;">指定重试之间的间隔
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700810656"></a>

									<a class="indexterm" name="idm140091700809136"></a>

									<code class="literal">Waiting to reconnect after a failed master event
										read</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											读取时发生错误（由于断开连接）。</font>
									</font><a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1更改主语法"><code class="literal">CHANGE
											MASTER TO</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">在尝试重新连接之前</font>
										<font style="vertical-align: inherit;">，线程正在休眠该</font>
										<font style="vertical-align: inherit;">语句</font>
										<font style="vertical-align: inherit;">设置的秒数
										</font>
										<font style="vertical-align: inherit;">（默认为60）。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="slave-sql-thread-states"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.5复制从属SQL线程状态</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091700803312"></a><a class="indexterm" name="idm140091700801856"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								以下列表显示了您可能在</font>
						</font><code class="literal">State</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">从属服务器SQL线程</font>
							<font style="vertical-align: inherit;">的</font>
							<font style="vertical-align: inherit;">列中</font>
							<font style="vertical-align: inherit;">看到的最常见状态</font>
							<font style="vertical-align: inherit;">：
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700798368"></a>

									<a class="indexterm" name="idm140091700796880"></a>

									<code class="literal">Killing slave</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在处理一个</font>
									</font><code class="literal">STOP SLAVE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700792752"></a>

									<a class="indexterm" name="idm140091700791216"></a>

									<code class="literal">Making temporary file (append) before replaying
										LOAD DATA INFILE</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在执行一个</font>
									</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
											DATA</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句，并将数据附加到一个临时文件中，该文件包含从属将从中读取行的数据。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700786368"></a>

									<a class="indexterm" name="idm140091700784832"></a>

									<code class="literal">Making temporary file (create) before replaying
										LOAD DATA INFILE</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在执行一个</font>
									</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
											DATA</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句，并且正在创建一个临时文件，其中包含从属将从中读取行的数据。</font>
										<font style="vertical-align: inherit;">只有在</font>
									</font><a class="link" href="sql-syntax.html#load-data" title="13.2.7 LOAD DATA语法"><code class="literal">LOAD
											DATA</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">运行MySQL版本低于MySQL 5.0.3的主服务器记录</font>
										<font style="vertical-align: inherit;">原始</font>
										<font style="vertical-align: inherit;">语句时</font>
										<font style="vertical-align: inherit;">才会遇到此状态
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700778608"></a>

									<a class="indexterm" name="idm140091700777104"></a>

									<code class="literal">Reading event from the relay log</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程已从中继日志中读取事件，以便可以处理事件。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700773616"></a>

									<a class="indexterm" name="idm140091700772096"></a>

									<code class="literal">Slave has read all relay log; waiting for more
										updates</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程已处理中继日志文件中的所有事件，现在正在等待I / O线程将新事件写入中继日志。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700768496"></a>

									<a class="indexterm" name="idm140091700766992"></a>

									<code class="literal">Waiting for an event from Coordinator</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											使用多线程从属（</font>
									</font><a class="link" href="replication.html#sysvar_slave_parallel_workers"><code class="literal">slave_parallel_workers</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">大于1），其中一个从属工作线程正在等待来自协调器线程的事件。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700762112"></a>

									<a class="indexterm" name="idm140091700760656"></a>

									<code class="literal">Waiting for slave mutex on exit</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程停止时发生的非常短暂的状态。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700757200"></a>

									<a class="indexterm" name="idm140091700755680"></a>

									<code class="literal">Waiting for Slave Workers to free pending
										events</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											当Workers正在处理的事件的总大小超过</font>
									</font><a class="link" href="replication.html#sysvar_slave_pending_jobs_size_max"><code class="literal">slave_pending_jobs_size_max</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											系统变量</font>
										<font style="vertical-align: inherit;">的大小时，会发生此等待操作
										</font>
										<font style="vertical-align: inherit;">。</font>
										<font style="vertical-align: inherit;">当大小低于此限制时，协调器将恢复计划。</font>
										<font style="vertical-align: inherit;">仅当</font>
									</font><a class="link" href="replication.html#sysvar_slave_parallel_workers"><code class="literal">slave_parallel_workers</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">设置大于0 </font>
										<font style="vertical-align: inherit;">时才会出现此状态
										</font>
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700749344"></a>

									<a class="indexterm" name="idm140091700747888"></a>

									<code class="literal">Waiting for the next event in relay log</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											之前的初始状态</font>
									</font><code class="literal">Reading event from the
										relay log</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700743728"></a>

									<a class="indexterm" name="idm140091700742192"></a>

									<code class="literal">Waiting until MASTER_DELAY seconds after master
										executed event</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											SQL线程已读取事件，但正在等待从属延迟失效。</font>
										<font style="vertical-align: inherit;">此延迟通过
										</font>
									</font><code class="literal">MASTER_DELAY</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">选项设置
										</font>
									</font><a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1更改主语法"><code class="literal">CHANGE
											MASTER TO</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>
					<p>
						<font style="vertical-align: inherit;"></font><code class="literal">Info</code>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">SQL线程</font>
							<font style="vertical-align: inherit;">
								的</font>
							<font style="vertical-align: inherit;">列也可以显示语句的文本。</font>
							<font style="vertical-align: inherit;">这表明线程已从中继日志中读取事件，从中提取语句，并可能正在执行它。
							</font>
						</font>
					</p>
				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="slave-connection-thread-states"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.6复制从站连接线程状态</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091700734288"></a><a class="indexterm" name="idm140091700732800"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								这些线程状态出现在复制从属服务器上，但与连接线程相关联，而不是与I / O或SQL线程相关联。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700729120"></a>

									<a class="indexterm" name="idm140091700727632"></a>

									<code class="literal">Changing master</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在处理一个</font>
									</font><a class="link" href="sql-syntax.html#change-master-to" title="13.4.2.1更改主语法"><code class="literal">CHANGE
											MASTER TO</code></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700723040"></a>

									<a class="indexterm" name="idm140091700721552"></a>

									<code class="literal">Killing slave</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在处理一个</font>
									</font><code class="literal">STOP SLAVE</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											语句。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700717424"></a>

									<a class="indexterm" name="idm140091700715920"></a>

									<code class="literal">Opening master dump table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											此状态发生在</font>
									</font><code class="literal">Creating table from master
										dump</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700711760"></a>

									<a class="indexterm" name="idm140091700710256"></a>

									<code class="literal">Reading master dump table data</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											此状态发生在</font>
									</font><code class="literal">Opening master dump
										table</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700706112"></a>

									<a class="indexterm" name="idm140091700704592"></a>

									<code class="literal">Rebuilding the index on master dump table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											此状态发生在</font>
									</font><code class="literal">Reading master dump table
										data</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>

				<div class="section">

					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="mysql-cluster-thread-states"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.7 NDB群集线程状态</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091700699456"></a><a class="indexterm" name="idm140091700697968"></a>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700694912"></a>

									<a class="indexterm" name="idm140091700693408"></a>

									<code class="literal">Committing events to binlog</code>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700690432"></a>

									<a class="indexterm" name="idm140091700688928"></a>

									<code class="literal">Opening mysql.ndb_apply_status</code>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700685952"></a>

									<a class="indexterm" name="idm140091700684464"></a>

									<code class="literal">Processing events</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在处理二进制日志记录的事件。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700681040"></a>

									<a class="indexterm" name="idm140091700679536"></a>

									<code class="literal">Processing events from schema table</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											该线程正在进行模式复制的工作。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700676080"></a>

									<a class="indexterm" name="idm140091700674592"></a>

									<code class="literal">Shutting down</code>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700671648"></a>

									<a class="indexterm" name="idm140091700670128"></a>

									<code class="literal">Syncing ndb table schema operation and
										binlog</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											这用于为NDB提供正确的模式操作二进制日志。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700666592"></a>

									<a class="indexterm" name="idm140091700665056"></a>

									<code class="literal">Waiting for allowed to take ndbcluster global
										schema lock</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在等待获取全局模式锁的权限。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700661520"></a>

									<a class="indexterm" name="idm140091700660016"></a>

									<code class="literal">Waiting for event from ndbcluster</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											服务器充当NDB群集中的SQL节点，并连接到群集管理节点。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700656496"></a>

									<a class="indexterm" name="idm140091700654992"></a>

									<code class="literal">Waiting for first event from ndbcluster</code>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700652016"></a>

									<a class="indexterm" name="idm140091700650480"></a>

									<code class="literal">Waiting for ndbcluster binlog update to reach
										current position</code>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700647424"></a>

									<a class="indexterm" name="idm140091700645904"></a>

									<code class="literal">Waiting for ndbcluster global schema lock</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在等待另一个线程持有的全局模式锁定被释放。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700642368"></a>

									<a class="indexterm" name="idm140091700640864"></a>

									<code class="literal">Waiting for ndbcluster to start</code>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700637888"></a>

									<a class="indexterm" name="idm140091700636384"></a>

									<code class="literal">Waiting for schema epoch</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程正在等待架构时代（即全局检查点）。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>
				<div class="section">
					<div class="titlepage">
						<div>
							<div>
								<h3 class="title"><a name="event-scheduler-thread-states"></a>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">8.14.8事件调度程序线程状态</font>
									</font>
								</h3>

							</div>

						</div>

					</div>
					<a class="indexterm" name="idm140091700631952"></a><a class="indexterm" name="idm140091700630464"></a>
					<p>
						<font style="vertical-align: inherit;">
							<font style="vertical-align: inherit;">
								这些状态发生在Event Scheduler线程，为执行调度事件而创建的线程或终止调度程序的线程中。
							</font>
						</font>
					</p>
					<div class="itemizedlist">
						<ul class="itemizedlist" style="list-style-type: disc; ">
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700627632"></a>

									<a class="indexterm" name="idm140091700626144"></a>

									<code class="literal">Clearing</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											调度程序线程或正在执行事件的线程正在终止并即将结束。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700622672"></a>

									<a class="indexterm" name="idm140091700621184"></a>

									<code class="literal">Initialized</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											调度程序线程或将执行事件的线程已初始化。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700617728"></a>

									<a class="indexterm" name="idm140091700616224"></a>

									<code class="literal">Waiting for next activation</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											调度程序具有非空事件队列，但下一次激活是将来的。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700612736"></a>

									<a class="indexterm" name="idm140091700611232"></a>

									<code class="literal">Waiting for scheduler to stop</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											线程已发出</font>
									</font><code class="literal">SET GLOBAL
										event_scheduler=OFF</code>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">并正在等待调度程序停止。
										</font>
									</font>
								</p>
							</li>
							<li class="listitem">
								<p>
									<a class="indexterm" name="idm140091700607024"></a>

									<a class="indexterm" name="idm140091700605536"></a>

									<code class="literal">Waiting on empty queue</code>
								</p>
								<p>
									<font style="vertical-align: inherit;">
										<font style="vertical-align: inherit;">
											调度程序的事件队列为空并且正在休眠。
										</font>
									</font>
								</p>
							</li>
						</ul>
					</div>

				</div>

			</div>

		</div>
		<div class="copyright-footer">

		</div>
		<div class="navfooter">
			<hr>
			<table width="100%" summary="Navigation footer">
				<tbody>
					<tr>
						<td width="40%" align="left"><a accesskey="p" href="backup-and-recovery.html">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">上一页</font>
								</font>
							</a></td>
						<td width="20%" align="center"><a accesskey="u" href="">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">向上</font>
								</font>
							</a></td>
						<td width="40%" align="right">&nbsp;<a accesskey="n" href="language-structure.html">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">下一个</font>
								</font>
							</a></td>
					</tr>
					<tr>
						<td width="40%" align="left" valign="top">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第7章备份和恢复</font>
							</font>
						</td>
						<td width="20%" align="center"><a accesskey="h" href="index.html">
								<font style="vertical-align: inherit;">
									<font style="vertical-align: inherit;">家</font>
								</font>
							</a></td>
						<td width="40%" align="right" valign="top">
							<font style="vertical-align: inherit;">
								<font style="vertical-align: inherit;">第9章语言结构</font>
							</font>
						</td>
					</tr>
				</tbody>
			</table>
		</div>


		<div id="goog-gt-tt" class="skiptranslate" dir="ltr">
			<div style="padding: 8px;">
				<div>
					<div class="logo"><img src="/doc/MySQL8_Dev/translate_24dp.png" width="20"
						 height="20" alt="Google 翻译"></div>
				</div>
			</div>
			<div class="top" style="padding: 8px; float: left; width: 100%;">
				<h1 class="title gray">原文</h1>
			</div>
			<div class="middle" style="padding: 8px;">
				<div class="original-text"></div>
			</div>
			<div class="bottom" style="padding: 8px;">
				<div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div>
				<div class="started-activity-container">
					<hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;">
					<div class="activity-root"></div>
				</div>
			</div>
			<div class="status-message" style="display: none;"></div>
		</div>
		<div id="cntvlive2-is-installed"></div>
		<div class="goog-te-spinner-pos">
			<div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px"
				 height="96px" viewBox="0 0 66 66">
					<circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle>
				</svg></div>
		</div>
	</body>
</html>
